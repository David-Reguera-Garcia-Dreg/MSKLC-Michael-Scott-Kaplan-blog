<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2012/08/15/10339749.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:30 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>It may be easier to get your GEO on, instead...</title></head><body>
<h1>It may be easier to get your GEO on, instead...</h1>
<p><em>by Michael S. Kaplan, published on 2012/08/15 07:01 -04:00, original URI: http://blogs.msdn.com/b/michkap/archive/2012/08/15/10339749.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostNew -->
<p>The latest question that passed through the gauntlet was:</p>
<p style="padding-left: 60px;"><span style="font-family: times new roman,times; font-size: medium;">I&rsquo;m working with .NET and I need to be able to map a set of two-letter country codes (e.g. US, IE) into the appropriate RegionInfo object. I&rsquo;ve got this working correctly for all regions defined in .NET, but we&rsquo;ve recently discovered that there are a number of regions which are not present in .NET including Andorra and Antigua and Barbuda.</span><br />&nbsp;<br /><span style="font-family: times new roman,times; font-size: medium;">I realise we can overcome this problem by creating custom cultures, but this seems like it might be a maintainability issue.&nbsp;<br /></span>&nbsp;<br /><span style="font-family: times new roman,times; font-size: medium;">In case it&rsquo;s relevant, my team is using .NET 3.5 due to various limitations for now.</span></p>
<p>What a nightmare to create that&nbsp;many custom cultures, none of which would likely have useful data..</p>
<p>All without getting reviewed the way we review data now! :-(</p>
<p>I think the wider list can be picked up with a simple p/invoke call to EnumSystemGeoID instead.</p>
<p>GEO stuff has limitations (as I mentioned in the past), especially around time zones and such, but for names it should work pretty well!</p>
<p>Say code like the folllowing:</p>
<p style="padding-left: 60px;"><strong><span style="font-family: courier new,courier;">using System;</span></strong><br /><strong><span style="font-family: courier new,courier;">using System.Text;</span></strong><br /><strong><span style="font-family: courier new,courier;">using System.Runtime.InteropServices;</span></strong></p>
<p style="padding-left: 60px;"><strong><span style="font-family: courier new,courier;">class Program {</span></strong><br /><strong><span style="font-family: courier new,courier;">&nbsp;private static string stTarget;</span></strong></p>
<p style="padding-left: 60px;"><strong><span style="font-family: courier new,courier;">&nbsp;static void Main(string[] args) {</span></strong><br /><strong><span style="font-family: courier new,courier;">&nbsp;&nbsp;if(args.Length &gt; 0) {</span></strong><br /><strong><span style="font-family: courier new,courier;">&nbsp;&nbsp;&nbsp;stTarget = args[0];</span></strong><br /><strong><span style="font-family: courier new,courier;">&nbsp;&nbsp;}</span></strong><br /><strong><span style="font-family: courier new,courier;">&nbsp;&nbsp;else {</span></strong><br /><strong><span style="font-family: courier new,courier;">&nbsp;&nbsp;&nbsp;stTarget = string.Empty;</span></strong><br /><strong><span style="font-family: courier new,courier;">&nbsp;&nbsp;}</span></strong><br /><strong><span style="font-family: courier new,courier;">&nbsp;&nbsp;EnumSystemGeoID(GEOCLASS_NATION, 0, GeoInfoProc);</span></strong><br /><strong><span style="font-family: courier new,courier;">&nbsp;}</span></strong></p>
<p style="padding-left: 60px;"><strong><span style="font-family: courier new,courier;">&nbsp;private static bool GeoInfoProc(Int32 geoID) {</span></strong><br /><strong><span style="font-family: courier new,courier;">&nbsp;&nbsp;int len = GetGeoInfo(geoID, GEO_FRIENDLYNAME, null, 0, 0);</span></strong><br /><strong><span style="font-family: courier new,courier;">&nbsp;&nbsp;if(len &gt; 0) {</span></strong><br /><strong><span style="font-family: courier new,courier;">&nbsp;&nbsp;&nbsp;StringBuilder data = new StringBuilder(len);</span></strong><br /><strong><span style="font-family: courier new,courier;">&nbsp;&nbsp;&nbsp;len = GetGeoInfo(geoID, GEO_FRIENDLYNAME, data, len, 0);</span></strong><br /><strong><span style="font-family: courier new,courier;">&nbsp;&nbsp;&nbsp;if(len &gt; 0) {</span></strong><br /><strong><span style="font-family: courier new,courier;">&nbsp;&nbsp;&nbsp;&nbsp;string stIsoCode = data.ToString(0, len - 1);</span></strong><br /><strong><span style="font-family: courier new,courier;">&nbsp;&nbsp;&nbsp;&nbsp;bool fFound = string.Compare(stIsoCode,</span></strong></p>
<p style="padding-left: 60px;"><strong><span style="font-family: courier new,courier;">stTarget, StringComparison.OrdinalIgnoreCase) == 0;</span></strong><br /><strong><span style="font-family: courier new,courier;">&nbsp;&nbsp;&nbsp;&nbsp;if(stTarget.Length == 0 || fFound) {</span></strong><br /><strong><span style="font-family: courier new,courier;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Console.WriteLine(string.Format("{0} = {1}", stIsoCode, geoID));</span></strong><br /><strong><span style="font-family: courier new,courier;">&nbsp;&nbsp;&nbsp;&nbsp;}</span></strong><br /><strong><span style="font-family: courier new,courier;">&nbsp;&nbsp;&nbsp;&nbsp;return !fFound;</span></strong><br /><strong><span style="font-family: courier new,courier;">&nbsp;&nbsp;&nbsp;}</span></strong><br /><strong><span style="font-family: courier new,courier;">&nbsp;&nbsp;}</span></strong><br /><strong><span style="font-family: courier new,courier;">&nbsp;&nbsp;return false;</span></strong><br /><strong><span style="font-family: courier new,courier;">&nbsp;}</span></strong></p>
<p style="padding-left: 60px;"><strong><span style="font-family: courier new,courier;">&nbsp;// Geo Type</span></strong><br /><strong><span style="font-family: courier new,courier;">&nbsp;private const uint GEO_NATION = 0x0001;</span></strong><br /><strong><span style="font-family: courier new,courier;">&nbsp;private const uint GEO_LATITUDE = 0x0002;</span></strong><br /><strong><span style="font-family: courier new,courier;">&nbsp;private const uint GEO_LONGITUDE = 0x0003;</span></strong><br /><strong><span style="font-family: courier new,courier;">&nbsp;private const uint GEO_ISO2 = 0x0004;</span></strong><br /><strong><span style="font-family: courier new,courier;">&nbsp;private const uint GEO_ISO3 = 0x0005;</span></strong><br /><strong><span style="font-family: courier new,courier;">&nbsp;private const uint GEO_RFC1766 = 0x0006;</span></strong><br /><strong><span style="font-family: courier new,courier;">&nbsp;private const uint GEO_LCID = 0x0007;</span></strong><br /><strong><span style="font-family: courier new,courier;">&nbsp;private const uint GEO_FRIENDLYNAME = 0x0008;</span></strong><br /><strong><span style="font-family: courier new,courier;">&nbsp;private const uint GEO_OFFICIALNAME = 0x0009;</span></strong><br /><strong><span style="font-family: courier new,courier;">&nbsp;private const uint GEO_TIMEZONES = 0x000A;</span></strong><br /><strong><span style="font-family: courier new,courier;">&nbsp;private const uint GEO_OFFICIALLANGUAGES = 0x000B;</span></strong></p>
<p style="padding-left: 60px;"><strong><span style="font-family: courier new,courier;">&nbsp;// Geo Class</span></strong><br /><strong><span style="font-family: courier new,courier;">&nbsp;private const uint GEOCLASS_NATION = 16;</span></strong><br /><strong><span style="font-family: courier new,courier;">&nbsp;private const uint GEOCLASS_REGION = 14;</span></strong></p>
<p style="padding-left: 60px;"><strong><span style="font-family: courier new,courier;">&nbsp;private delegate bool EnumGeoInfoProc(int geoID);</span></strong></p>
<p style="padding-left: 60px;"><strong><span style="font-family: courier new,courier;">&nbsp;[DllImport("kernel32.dll")]</span></strong><br /><strong><span style="font-family: courier new,courier;">&nbsp;private static extern bool EnumSystemGeoID(uint geoClass, int parentGeoID, </span></strong><strong><span style="font-family: courier new,courier;">EnumGeoInfoProc enumGeoInfoProc);</span></strong></p>
<p style="padding-left: 60px;"><strong><span style="font-family: courier new,courier;">&nbsp;[DllImport("kernel32.dll", CharSet = CharSet.Unicode, EntryPoint ="GetGeoInfoW")]</span></strong><br /><strong><span style="font-family: courier new,courier;">&nbsp;private static extern int GetGeoInfo(int geoID, uint geoType, StringBuilder geoData, int size, int langID);</span></strong></p>
<p style="padding-left: 60px;"><strong><span style="font-family: courier new,courier;">}</span></strong></p>
<p>It will build a nice list that happens to include all of the various names requested....</p>
<p>This code or code like it&nbsp;should work just fine with 3.5 or 4.0 or even 4.5.</p>
<p>So screw R56egionInfo! You can get your GEO on, instead....</p>
<hr/><div style="margin-left: 1em"><em>no comments</em></div><hr/><p><em>go to <a id="newer" href="../16/10340297.html" title="In the land of the unsupported, previous blogs and tools can be king">newer</a> or <a id="older" href="../14/10338893.html" title="Getting your spidey senses FIXED">older</a> post, or back to <a href="../../../index-2.html">index</a> or <a href="../../../index-2.html#2012-08">month</a> or <a href="../../../index-2.html#2012-08-15">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2012/08/15/10339749.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:30 GMT -->
</html>