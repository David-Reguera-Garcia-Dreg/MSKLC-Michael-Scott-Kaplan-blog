<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2012/01/13/10256391.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:34 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>How to detect if a locale is Bidi, Windows 7/8 edition</title></head><body>
<h1>How to detect if a locale is Bidi, Windows 7/8 edition</h1>
<p><em>by Michael S. Kaplan, published on 2012/01/13 09:31 -05:00, original URI: http://blogs.msdn.com/b/michkap/archive/2012/01/13/10256391.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostNew -->
<p>The other day, I was forwarded a question by a colleague.</p>  <p><strong>They wanted to know why the following cod was not letting them detect Bidi properly:</strong></p>  <blockquote>   <p><font face="Courier New"><strong>UINT ret = GetLocaleInfoEx(LOCALE_NAME_USER_DEFAULT, LOCALE_IREADINGLAYOUT, Layout, ARRAYSIZ(Layout));         <br /></strong></font><font face="Courier New"><strong>if(ret &amp;&amp; (Layout[0] != L'0')) {         <br /></strong></font><font face="Courier New"><strong>&#160;&#160;&#160; // Treat the locale as Bidi: <font color="#ff0000">WARNING: THIS CODE IS WRONG!</font>          <br /></strong></font><font face="Courier New"><strong>}</strong></font></p> </blockquote>  <p>Now this code is bad for <strong>several</strong> reasons.</p>  <p>First of all, let’s look at the doc topic for <a href="http://msdn.microsoft.com/en-us/library/windows/desktop/dd373806(v=vs.85).aspx" target="_blank">LOCALE_IREADINGLAYOUT</a>:</p>  <p><strong>Windows 7 and later:</strong> The reading layout for text. Possible values are defined in the following table. </p>  <table border="1" cellspacing="2" cellpadding="2" width="784"><tbody>     <tr>       <td valign="top" width="54"><strong>Value</strong></td>        <td valign="top" width="722">         <p><strong>Meaning</strong></p>       </td>     </tr>      <tr>       <td valign="top" width="54">0</td>        <td valign="top" width="722">Read from left to right, as for the English (United States) locale.</td>     </tr>      <tr>       <td valign="top" width="54">1</td>        <td valign="top" width="722">Read from right to left, as for Arabic locales.</td>     </tr>      <tr>       <td valign="top" width="54">2</td>        <td valign="top" width="722">Read vertically from top to bottom with columns to the right, and read from right to left, as for the Japanese (Japan) locale.</td>     </tr>      <tr>       <td valign="top" width="54">3</td>        <td valign="top" width="722">Read vertically from top to bottom with columns proceeding to the right, as for the Mongolian (Mongolian) locale.</td>     </tr>   </tbody></table>  <p>Now obviously code that assumes everything other than 0 is RTL is going to have problems.</p>  <p>But okay, that is an easy fix.</p>  <p>There is a deeper problem, one that is a bit more insidious….</p>  <p>Let’s start by looking at what locales fall into each category:</p>  <table border="1" cellspacing="2" cellpadding="2" width="400"><tbody>     <tr>       <td valign="top" width="200"><strong>Value</strong></td>        <td valign="top" width="200"><strong>Locales that have this value</strong></td>     </tr>      <tr>       <td valign="top" width="200">0</td>        <td valign="top" width="200">English, Russian, Thai, etc.</td>     </tr>      <tr>       <td valign="top" width="200">1</td>        <td valign="top" width="200">Hebrew, Arabic, Persian, etc.</td>     </tr>      <tr>       <td valign="top" width="200">2</td>        <td valign="top" width="200">Japanese, Chinese, Korean</td>     </tr>      <tr>       <td valign="top" width="200">3</td>        <td valign="top" width="200">Mongolian</td>     </tr>   </tbody></table>  <p>Now in practice, vertical support in applications is such that the majority of text in Mongolian, Japanese, Chinese, and Korean should be treated as if it was in that first category slong with English. Therefore, returning 2 or 3 is a kind of unrealistic idealism, which ultimately makes the code even more flawed than previously thought!</p>  <p>There is more to the story beyond this one buglet, and I’ll be talking about this further, soon….</p>
<hr/><div style="margin-left: 1em"><em>no comments</em></div><hr/><p><em>referenced by</em></p><div style="margin-left: 1em"><p>2012/01/16 <a href="http://archives.miloush.net/michkap/archive/2012/01/16/10256752.html">I'm reasonably certain that those who disagree with me here are wrong!</a></p></div><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2012/01/16/10256752.html" title="I&#39;m reasonably certain that those who disagree with me here are wrong!">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2012/01/12/10255965.html" title="No, I am your father, Chris!">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2012-01">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2012-01-13">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2012/01/13/10256391.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:34 GMT -->
</html>