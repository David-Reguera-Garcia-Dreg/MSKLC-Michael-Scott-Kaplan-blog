<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2007/08/31/4661705.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:37 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>Elegant? Beyond compare...</title></head><body>
<h1>Elegant? Beyond compare...</h1>
<p><em>by Michael S. Kaplan, published on 2007/08/31 03:01 -04:00, original URI: http://blogs.msdn.com/b/michkap/archive/2007/08/31/4661705.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostNew -->
<P>Sometimes I wonder if the posts I write are not clear.</P>
<P>The good thing about the blog is that it is a lot like me talking to people.</P>
<P>Of course the bad thing about the blog is that it is a lot like me talking to people....</P>
<P>I was thinking about this when I read Jan Kucers contribution to the Suggestion Box:</P>
<BLOCKQUOTE>
<P><EM><FONT face="times new roman,times">Hello!<BR><BR>I'm reading your blog for couple of months and I've learned a lot of things.<BR><BR>We've seen a couple of examples what we really should not do and some hints what is better.<BR><BR>I'd like to know what is the most right way to compare strings while ignoring the case. (I work with managed classes but others could welcome unmanaged way as well.)<BR><BR>From some of your posts it is clear that lower-casing is better than upper-casing, since there are lower case characters without upper case equivavalents.<BR><BR>Also StringComparison.OrdinalIgnoreCase seems to be not the best win.<BR><BR>So strA.ToLower() == strB.ToLower() ?<BR><BR>or strA.ToLowerInvariant() == strB.ToLowerInvariant() ?<BR><BR>or string.Compare(strA, strB, true) ?<BR><BR>or string.Compare(strA, strB, StrinComparison.InvariantCultureIgnoreCase)?<BR><BR>Does using CultureInfo.CurrentCulture for string operations mean that the code will behave differently over the same data when running under different culture? If so, wouldn't it be better to choose any particular culture?<BR><BR>Well...is trustworthy case unaware comparation possible at all? :-)<BR><BR>Thanks for any hints on this topics. Or have you already answered this in past?<BR><BR>Jan</FONT></EM></P></BLOCKQUOTE>
<P>There is a lot in there that does not represent best practices, unfortunately.</P>
<P>There is a post&nbsp;in which&nbsp;I&nbsp;suggested a few guiding principles, entitled <STRONG><A class="" href="http://archives.miloush.net/michkap/archive/2005/06/12/428429.html" mce_href="http://archives.miloush.net/michkap/archive/2005/06/12/428429.html">Browsing the shoals of managed string comparisons</A></STRONG>. In particular there is the bit at the bottom:</P>
<UL>
<LI><FONT face=Tahoma>If you are trying to compare symbolic identifiers or operating system objects like filenames or named pipes, use an Ordinal type method (or an OrdinalIgnoreCase type method in Whidbey).</FONT> 
<LI><FONT face=Tahoma>If you need appropriate linguistic results that work with the myriad of methods that Unicode supports for entering identically appearing&nbsp;strings, then use either a Culture-based comparison or an Invariant culture-based&nbsp;comparison if you need unchanging results.</FONT> 
<LI><FONT face=Tahoma>Be aware of how the comparisons are being done in the technologies you are using, and <EM>do your best to match their behavior</EM>.</FONT></LI></UL>
<P>That third rule is the most important one....</P>
<P>For a slightly more complex breakout of items, you can see the post I mention in <STRONG><A class="" href="http://archives.miloush.net/michkap/archive/2007/05/31/3019659.html" mce_href="http://archives.miloush.net/michkap/archive/2007/05/31/3019659.html">Something .NET does less intuitively than they ought</A></STRONG> that Josh Free wrote. Though for every person who has told me they found the table helpful, I have talked to at least one other person who found it made things more confusing -- the same way having all those different methods does.</P>
<P>But using the above three principles one should be able to resolve just about any question about appropriate string comparisons (whether case sensitive or insensitive)....</P>
<P mce_keep="true">&nbsp;</P>
<P><FONT color=#ff00ff><EM>This post brought to you by</EM> <FONT size=5>Ω</FONT> <EM>and</EM> <FONT size=5>Ω</FONT>&nbsp;<EM>(<A class="" href="http://www.fileformat.info/info/unicode/char/2216" mce_href="http://www.fileformat.info/info/unicode/char/2216">U+2216</A> and <A class="" href="http://www.fileformat.info/info/unicode/char/03a9" mce_href="http://www.fileformat.info/info/unicode/char/03a9">U+03a9</A>, a.k.a. OHM SIGN and GREEK CAPITAL LETTER OMEGA)</EM></FONT></P>
<hr/><p><a id="4672127" href="#4672127">#</a> <strong>josh</strong> on 31 Aug 2007 1:13 PM:</p><div style="margin-left: 1em"><p>&quot;From some of your posts it is clear that lower-casing is better than upper-casing, since there are lower case characters without upper case equivalents.&quot;</p>
<p>Hm... &nbsp;I've gotten the impression that uppercasing is better because there are characters where &quot;a&quot; and &quot;b&quot; both use &quot;C&quot; as their uppercase form. &nbsp;(of course, this is only for environments without Windows' magical repository of linguistic data, so I'm more worried about being less wrong than correct) &nbsp;If you ask to lowercase &quot;C&quot; you have to invent data or do nothing, either of which will produce a meaningless comparison. &nbsp;Meanwhile, if you have some characters that have no uppercase form, uppercasing can safely do nothing (or delete the char, as long as it's consistent) without ambiguity.</p>
<p>Of course if there are also characters where &quot;A&quot; and &quot;B&quot; both use &quot;c&quot; as their lowercase form then you lose either way, but then winning wasn't on the plate to begin with.</p></div>
<p><a id="4673269" href="#4673269">#</a> <strong>Michael S. Kaplan</strong> on 31 Aug 2007 2:29 PM:</p><div style="margin-left: 1em"><p>You are correct -- uppercase is preferred to lowercase (and it is the underlying way that OrdinalIgnoreCase works, FWIW). Lowercasing can be evil for at least one character....</p>
</div>
<p><strong>Jan Kučera</strong> on 4 Sep 2007 1:01 PM:</p><div style="margin-left: 1em"><p>Hello Michael,</p>
<p> &nbsp;well first thank you for getting into my question. Now I feel a little bit (actually a lot) ashamed for examples I have written and also discovered the very obvious thing - interpreting my understanding of things as understanding of others is absolutely bad idea - thanks to josh's comment.</p>
<p> &nbsp;I found your links and linked articles very useful and I would probably not asked if I had found them before. For others, if there is anybody though, updated link to the &quot;New Recommendations for Using Strings in Microsoft .NET 2.0&quot;: <a rel="nofollow" target="_new" href="http://msdn2.microsoft.com/en-us/library/ms973919.aspx">http://msdn2.microsoft.com/en-us/library/ms973919.aspx</a>.</p>
<p> &nbsp;Now, to problem which originally rised my question (I have begun to wonder if I get the things right enough). I have general strings from several cultures (and I know from which ones). I'd like to provide case insensitive search over these data to the user.</p>
<p> &nbsp;I thought, I would search every piece of data in context of the culture it belongs to. That means, if the user is running my application in any culture he wants and is looking for I. It would much I and ı in turkish texts and I, i, İ, but not ı in english text.</p>
<p> &nbsp;Honestly, is this stupid behaviour?</p>
<p> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Thanks, Jan</p>
<p>PS. Actually I'm not sure if I want the Ohm sign and Omega letter to match or not... which does not foretell anything good. :-/</p>
<p>Oh yes, and please accept my apologizes for making you wondering about your posts. I find them clear and useful and they really bring a lot to me. I've just started to take interest in international things as I came to your blog few months ago and I have huge amount of things learn. My wrong lowercase preference was just because I did not came to any post like josh's comment since I am here, but I did to some of yours about missing uppercased letters.</p>
</div>
<p><strong>Michael S. Kaplan</strong> on 4 Sep 2007 6:32 PM:</p><div style="margin-left: 1em"><p>Hi Jan, </p>
<p>I do not expect that they will be updating that document, because I have been asking them to do so since before it was initially published and they never have. :-(</p>
<p>But in the case of multilingual data, serach should in most cases still be based on the expectations of the person doing the search, not on that of the target culture of the data.</p>
<p>But I did not really take it too personally, so don't worry -- I have people tell me that they are confused by the area all the time and that sometimes it is only six months later that something I wrote makes sense. I am doing my best to help to shorten that time, for all sorts of reasons....</p>
</div>
<p><strong>Jan Kučera</strong> on 5 Sep 2007 2:15 AM:</p><div style="margin-left: 1em"><p>Okay, so you mean that if a turkish guy searches for &quot;I&quot;, he doesn't want to include &quot;i&quot; in (english texts) results?</p>
</div>
<p><strong>Michael S. Kaplan</strong> on 5 Sep 2007 2:34 AM:</p><div style="margin-left: 1em"><P>Well, better to put it as they will not be as surprised/unhappy if their prefernces ARE respected then if you try to fold all of them (Iiİı) together and do not distinguish them....</P>
<P>You could make an exception for the Turkic case given that Windows has way over a decade of history doing it wrong -- so people masy be expecting it to keep being wrong (note that CompareString by default will still do it wrong today).</P>
<P>Although you can find targetted exceptions, they represent the exception, not the rule, as I mentioned <STRONG><A class="" href="http://archives.miloush.net/michkap/archive/2006/01/01/508503.html">here</A></STRONG>&nbsp;(note links to examples there). And the exceptions don't tend to scale all that well since most people do not know all of the comparison rules of all languages!</P></div>
<p><strong>Jan Kučera</strong> on 5 Sep 2007 10:21 AM:</p><div style="margin-left: 1em"><p>Fair enough, so it seems I'll just leave the comparing (and sorting) on the .NET Framework and believe that it will know what the user expects to see.</p>
<p>Thank you for your help and opinions!</p>
</div>
<p><strong>Jan Kučera</strong> on 13 Sep 2007 10:45 AM:</p><div style="margin-left: 1em"><p>One question more Michael, maybe a little bit OT. If the user expects the sorting and stuff in his locale, does it meen I should keep non-latin names in their native script? I mean I have a sorted list of authors. Should I keep the Russian authors in cyrillic or transcribe them to latin? Or add both to the list? </p>
</div>
<p><strong>Michael S. Kaplan</strong> on 13 Sep 2007 11:37 AM:</p><div style="margin-left: 1em"><P>Those kinds of items have to be based on actual user feedback -- as the answer will vary depending on the customers in question....</P></div>
<hr/><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2007/09/01/4683342.html" title="There is no &#39;I&#39; in MUI... errr, never mind!">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2007/08/30/4641553.html" title="The main criteria in determing whether a code page sucks? Suckage, of course!">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2007-08">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2007-08-31">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2007/08/31/4661705.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:37 GMT -->
</html>