<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2007/11/20/6420601.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:37 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>Michael's Keyboard Laws for Developers, Part 3</title></head><body>
<h1>Michael's Keyboard Laws for Developers, Part 3</h1>
<p><em>by Michael S. Kaplan, published on 2007/11/20 10:16 -05:00, original URI: http://blogs.msdn.com/b/michkap/archive/2007/11/20/6420601.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostNew -->
<P><EM>See also the first law (<A class="" href="http://archives.miloush.net/michkap/archive/2007/11/15/6252257.html" mce_href="http://archives.miloush.net/michkap/archive/2007/11/15/6252257.html"><STRONG>VK_A is not always 'A'</STRONG></A></EM><EM>) and the second law (<A class="" href="http://archives.miloush.net/michkap/archive/2007/11/16/6298366.html" mce_href="http://archives.miloush.net/michkap/archive/2007/11/16/6298366.html"><STRONG>Not every keyboard contains every VK_* value</STRONG></A>).</EM></P>
<P>Thought you had escaped the long arm of the law, didn't you? :-)</P>
<P>Sorry, there is no&nbsp;escaping it!</P>
<P>Like the first two laws, you might read it and assume it is completely obvious:</P>
<BLOCKQUOTE>
<P><FONT size=4>Not every keyboard contains every character</FONT></P></BLOCKQUOTE>
<P>Given that there are over 100,000 characters in Unicode this one seems like it really does not need to be said.</P>
<P>But there are applications like&nbsp;Microsoft&nbsp;Telnet Client. You can run it and you will see something like the following:</P>
<P><IMG height=227 src="http://trigeminal.fmsinc.com/images/thirdlaw01.png" width=668></P>
<P>In case that isn't seem cool enough, there is literally code in telnet.exe that figured out that keystroke for the escape character based on the current keyboard.</P>
<P>Let's look at MSKLC 1.4 to see what it is looking for:</P>
<P><IMG src="http://trigeminal.fmsinc.com/images/thirdlaw02.png"></P>
<P>S there you go, telnet.exe is assuming that <A class="" href="http://www.fileformat.info/info/unicode/char/001d" mce_href="http://www.fileformat.info/info/unicode/char/001d">U+001d</A> is a part of every keyboard layout, in the control shift state.</P>
<P>Usually, it just so happens that it is. </P>
<P>Not on always on <EM>that</EM> key, mind you.</P>
<P>But on some key.</P>
<P>But you will notice that I have not quoted any law about that -- and I won't.</P>
<P>Because telnet.exe requiring every keyboard layout on Windows to support a specific Unicode code point is a major case of the tail wagging the dog. And as any dog owner will tell you, that isn't how tails work....</P>
<P>For specifc keyboards where this won't work, you can look at the keyboard for Belarusian, and others. And you will never see a <STRONG>^]</STRONG>, even if you wanted to.</P>
<P>And this principle can be extended to any character, any character at all.</P>
<P>If your application assumes that a particular character is there no matter what the keyboard, then it is broken.</P>
<P>And what is worse is that it is breaking the law....</P>
<P mce_keep="true">&nbsp;</P>
<P><FONT color=#ff00ff><EM>This post brought to you by <A class="" href="http://www.fileformat.info/info/unicode/char/001d" mce_href="http://www.fileformat.info/info/unicode/char/001d">U+001d</A> (a.k.a. INFORMATION SEPARATOR THREE)</EM></FONT></P>
<hr/><p><a id="6437592" href="#6437592">#</a> <strong>Name required</strong> on 20 Nov 2007 12:00 PM:</p><div style="margin-left: 1em"><P>Well, telnet uses CTRL-] as its standard key for escaping into command mode. They were requiring it to be able to support the 7-bit ASCII range, so any special telnet keys had to be outside that. I can't find any RFC requirement that it be THAT key, I think it's just something the implementations settled on, so it's become something any user of telnet would expect.</P>
<P>If you look at the telnet RFCs, they specifically say the NVT (network virtual terminal) is to be using ASCII, and that the remote user be able to type any ASCII 7-bit character, specifically including ESC, which would be the usual suspect for this sort of function.</P>
<P>How else would you do it? What's the "right way"? IIRC, you can't really test to see if ^] is "available" and even if you could, how would you pick a fallback?</P>
<P>Built-in telnet only goes back to the Win 3.11 days, doesn't it?</P>
<P>(and yeah, I've been in situations not involving any MS software where I wasn't able to type that character, for one reason or another)</P>
<P>&gt; If your application assumes that a particular character is there no matter<BR>&gt; what the keyboard, then it is broken.</P>
<P>This isn't much different than EMACS assuming "help" is ^H, which most UNIX boxes use for backspace. They even have a FAQ "Why does hitting backspace bring up help?" trying to defend why that isn't broken, and why "your system is set up improperly"</P></div>
<p><a id="6437762" href="#6437762">#</a> <strong>Name required</strong> on 20 Nov 2007 12:07 PM:</p><div style="margin-left: 1em"><p>Oh yeah, and speaking of keyboard mappings and EMACS, it was developed on the MIT LISP machines that were &quot;equipped with no fewer than seven shift keys: four keys for bucky bits (‘control’, ‘meta’, ‘hyper’, and ‘super’) and three regular shift keys, called ‘shift’, ‘top’, and ‘front’.&quot;</p>
<p>See <a rel="nofollow" target="_new" href="http://www.faqs.org/docs/jargon/S/space-cadet-keyboard.html">http://www.faqs.org/docs/jargon/S/space-cadet-keyboard.html</a></p>
<p>Fortunately EMACS didn't use hyper &amp; super much, and meta is usually mapped to the left alt key, or to ctrl-esc.</p></div>
<p><a id="6438611" href="#6438611">#</a> <strong>Michael S. Kaplan</strong> on 20 Nov 2007 12:44 PM:</p><div style="margin-left: 1em"><P>The unfortunate side effect in the MS code here is the assumption of the character always being on whatever key held the <STRONG>]</STRONG> (beyond the obvious flaw in assuming there always would be a <STRONG>]</STRONG> since that is not a requirement, either).</P></div>
<p><a id="6443806" href="#6443806">#</a> <strong>Dean Harding</strong> on 20 Nov 2007 4:26 PM:</p><div style="margin-left: 1em"><p>Ah, but telnet.exe has the &quot;-e&quot; command-line option so that you can change the escape character. I'm assuming they chose &quot;Ctrl+]&quot; as the default because, &quot;most&quot; keyboards have it, and you gotta have SOMETHING as the default...</p>
</div>
<p><a id="6443957" href="#6443957">#</a> <strong>Michael S. Kaplan</strong> on 20 Nov 2007 4:33 PM:</p><div style="margin-left: 1em"><p>Ah, but that is [part of] my point -- the implementation is actually based on this random control character (which may not be there) and claims to be baded on this particular character (which may also not bethered, though that may be less likely to be true unless you are in places like Belarus!)....</p>
</div>
<p><a id="6446537" href="#6446537">#</a> <strong>Kalle Olavi Niemitalo</strong> on 20 Nov 2007 6:48 PM:</p><div style="margin-left: 1em"><p>I wonder why they didn't use e.g. F2 or Shift+Esc as the command key. &nbsp;If I understand correctly, this would require using low-level console functions rather than high-level, and CSRSS built-in line editing might then be lost; but the command key isn't needed in command mode anyway.</p>
<p>Is there a specific reason why the Belarusian keyboard layout does not include all control characters 0-31?</p></div>
<p><a id="6446644" href="#6446644">#</a> <strong>Michael S. Kaplan</strong> on 20 Nov 2007 6:53 PM:</p><div style="margin-left: 1em"><P>Well, Belarusian doesn't happen to have a <STRONG>]</STRONG>, which makes the text that telnet.exe pops up kind of amusing, but there are some other keyboards that have a <STRONG>]</STRONG> without the control character -- and it that case telnet.exe's text is incredibly amusing (and something of a support hit)....</P></div>
<p><a id="6448038" href="#6448038">#</a> <strong>Rosyna</strong> on 20 Nov 2007 8:21 PM:</p><div style="margin-left: 1em"><p>Apple, for it's part, has special rules for defining keyboard shortcuts. With a huge warning (<a rel="nofollow" target="_new" href="http://developer.apple.com/documentation/UserExperience/Conceptual/OSXHIGuidelines/XHIGUserInput/chapter_11_section_3.html#//apple_ref/doc/uid/TP30000361-TPXREF54">http://developer.apple.com/documentation/UserExperience/Conceptual/OSXHIGuidelines/XHIGUserInput/chapter_11_section_3.html#//apple_ref/doc/uid/TP30000361-TPXREF54</a>):</p>
<p>&quot;Note: Not all the keys described here exist on all keyboards. Don’t depend on a key as the only way for users to accomplish a task. You cannot assume anything about which keyboard (if any) is connected to a computer.&quot;</p>
<p>and</p>
<p>&quot;Remember that other languages may require modifier keys to generate certain characters. For example, on a French keyboard, Option-5 generates the “{“ character. You can safely use the Command key as a modifier, but avoid using Command and an additional modifier with characters not available on all keyboards. If you must use a modifier key in addition to the Command key, try to use it only with the alphabetic characters (a through z).&quot;</p>
<p>Which I think is the more important notice. Basically, never, ever try to set Control Shift [ as a command sequence. &nbsp;The [ key might be part of a shift modifier on some keyboards, making it impossible to &quot;double shift&quot; the keyboard on some layouts. If you wanted this, use Control {. Although [ and { are in weird locations on my Japanese Keyboard compared to my US keyboard.</p>
<p>It's odd that most keyboard commands were made based on their location on the ANSI keyboard layout. Well, not &quot;odd&quot; as in unexpected but &quot;odd&quot; as in &quot;silly programmers, q isn't in that location for the french&quot;.</p>
</div>
<p><a id="6451964" href="#6451964">#</a> <strong>Peter Karlsson</strong> on 21 Nov 2007 3:27 AM:</p><div style="margin-left: 1em"><p>Intereting. With my heavily KLC-modified Swedish-Norwegian hybrid keyboard currently running on an English version of XP, I get:</p>
<p>&#160;&#160;Welcome to Microsoft Telnet Client</p>
<p>&#160;&#160;Escape Character is ']'</p>
<p>I doubt that is much better than Ctrl+] (which would be Ctrl+AltGr+9 for me).</p></div>
<p><a id="6451974" href="#6451974">#</a> <strong>Centaur</strong> on 21 Nov 2007 3:28 AM:</p><div style="margin-left: 1em"><p>The part about Belarusian (and other Cyrillic) keyboards is a red herring. On Cyrillic keyboards each key is labeled with a Latin character and a Cyrillic character. And a Cyrillic keyboard layout is almost always installed as secondary, with primary being US, if only for the sake of entering URLs and shell commands.</p>
<p>The Windows edit control uses Ctrl+X Ctrl+C Ctrl+V for clipboard operations. They all work regardless of which layout is active. They work in Russian, although, by your reasoning, the Russian layout does not have X, C or V. It just so happens that Ctrl+Ч, Ctrl+С and Ctrl+М generate the expected key codes.</p>
<p>Which begs a question. For some reason, in my homebrewn MSKLC layouts, the Ctrl+[ Ctrl+] Ctrl+\ combinations seem to not do the right thing in Telnet and PuTTY. (I have to resort to the -e switch for Telnet to reassign the escape code.) Ctrl+letter combinations work as expected, though. Why is that? Do I need to explicitly lay out all the non-letter Ctrl codes?</p>
</div>
<p><a id="6456867" href="#6456867">#</a> <strong>Michael S. Kaplan</strong> on 21 Nov 2007 10:39 AM:</p><div style="margin-left: 1em"><p>Hi Centaur,</p>
<p>Not all layouts have such control characters assigned -- so apps expecting them are disappointed....</p>
<p>MSKLC 1.3 will not only fail to load them from existing layouts but will warn you in the validation phase if you add them later (1.4 does not warn you and willl load them if they are there, but will not add them spontaneously).</p>
</div>
<p><strong>John Cowan</strong> on 4 Nov 2008 6:27 PM:</p><div style="margin-left: 1em"><p>As a historical note, Ctrl+] goes back to the Berkeley implementation of Telnet for Unix, from which the Microsoft implementation is cloned. &nbsp; It was chosen precisely because it *was* a 7-bit ASCII value, U+001D. &nbsp;It is not prescribed by the Telnet RFC.</p></div>
<hr/><p><em>referenced by</em></p><div style="margin-left: 1em"><p>2012/05/02 <a href="http://archives.miloush.net/michkap/archive/2012/05/02/10299780.html">Who owns keyboard testing?</a></p><p>2012/04/26 <a href="http://archives.miloush.net/michkap/archive/2012/04/26/10297903.html">Michael's Keyboard Laws for Developers, Part 5</a></p><p>2008/11/04 <a href="http://archives.miloush.net/michkap/archive/2008/11/04/9037027.html">Strange control over CTRL and control characters</a></p><p>2008/09/03 <a href="http://archives.miloush.net/michkap/archive/2008/09/03/8921419.html">Need to know the VK for A, ay?</a></p><p>2007/11/21 <a href="http://archives.miloush.net/michkap/archive/2007/11/21/6456468.html">Michael's Keyboard Laws for Developers, Part 4</a></p></div><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2007/11/20/6424929.html" title="Install your language packs like you put on your socks -- ONE AT A TIME!">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2007/11/19/6387630.html" title="The incredible missing Language Bar">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2007-11">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2007-11-20">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2007/11/20/6420601.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:37 GMT -->
</html>