<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2007/11/07/5958318.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:37 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>Often 'X doesn't work' in the docs actually implies 'We couldn't get X to work' :-)</title></head><body>
<h1>Often 'X doesn't work' in the docs actually implies 'We couldn't get X to work' :-)</h1>
<p><em>by Michael S. Kaplan, published on 2007/11/07 10:01 -05:00, original URI: http://blogs.msdn.com/b/michkap/archive/2007/11/07/5958318.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostNew -->
<P>It is often the case that code does even more than the&nbsp;developers of the code describe, so much so that by the time they are done describing the limitations that the documentation writers lay out and someone else finds out how much more is possible,&nbsp;there is little one can do&nbsp;but shake one's head and wonder if the original team knew what the code could really do and felt it would be too hard to describe, or whether they would be just as surprised at the later contribution. </P>
<P>Or what one of their own members was able to later describe!</P>
<P>Like the other day, when Irfan asked:</P>
<BLOCKQUOTE>
<P><FONT face="times new roman,times">Hi All,<BR><BR>One of my Customer has a windows application(VS2005, VB.NET) where they are trying to print the Malayalam language string (Kartika font). As recommended they are using the TextRenderer class to view the string and it works fine.<BR><BR>It mentioned in the MSDN that </FONT><A class="" href="http://msdn2.microsoft.com/en-us/library/system.windows.forms.textrenderer.aspx" mce_href="http://msdn2.microsoft.com/en-us/library/system.windows.forms.textrenderer.aspx"><FONT face="times new roman,times">TextRenderer</FONT></A><FONT face="times new roman,times"> is not used for printing:<BR><BR></FONT><FONT face="times new roman,times"><EM>&nbsp;&nbsp;&nbsp; The DrawText methods of TextRenderer are not supported for printing. You should always use the DrawString methods of the Graphics class<BR><BR></EM>So to print the Malayalam string we have following two options<BR><BR>1.&nbsp;&nbsp;&nbsp;We can save the string in a bitmap image and print it using the Graphics.DrawImage function.<BR>2.&nbsp;&nbsp;&nbsp;We can directly print the string from textbox using the Graphics.DrawString.<BR><BR>Now when we print with the first option it does print but the output looks like a dotmatix printer output.( this is rejected by the customer’s client) and now when we tried to use the second option it gave an error "A generic error occurred in GDI+"</FONT></P></BLOCKQUOTE>
<P>Now the conventional wisdom has always gone along with the way that Irfan laid out the options.</P>
<P>And I certainly never have (either in some of the <A class="" href="http://archives.miloush.net/michkap/archive/2005/06/27/432986.html" mce_href="http://archives.miloush.net/michkap/archive/2005/06/27/432986.html"><STRONG>previous</STRONG></A> <A class="" href="http://archives.miloush.net/michkap/archive/2005/06/27/433208.html" mce_href="http://archives.miloush.net/michkap/archive/2005/06/27/433208.html"><STRONG>times</STRONG></A> I have talked about TextRenderer here in the blog or in conversation or email) suggested anything beyond this before (other than perhaps changing the image type to be something less grainy than a bitmap!).</P>
<P>But&nbsp;colleague Aldo pointed out the article from MSDN Magazine entitled <A class="" href="http://msdn.microsoft.com/msdnmag/issues/06/03/TextRendering/" mce_href="http://msdn.microsoft.com/msdnmag/issues/06/03/TextRendering/">Text Rendering: Build World-Ready Apps Using Complex Scripts In Windows Forms Controls</A> by Miguel A. Lacouture (a developer on the WinForms team!), with a section entitled <A class="" href="http://msdn.microsoft.com/msdnmag/issues/06/03/TextRendering/#S6" mce_href="http://msdn.microsoft.com/msdnmag/issues/06/03/TextRendering/#S6">Printing with TextRenderer</A> not listed under the Limitations of TextRenderer section earlier in the article -- a section that was quite eye-opening:</P>
<BLOCKQUOTE>
<BLOCKQUOTE>
<P><EM>When working with System.Drawing.Printing, you are usually interested in handling the PrintPage event of the PrintDocument object. You can use the Graphics object of the PrintPageEventArgs in the same way you use the Graphics object obtained from the PaintEventArgs when handling a control's paint event. In many cases, you want to use a common method to draw—for example, drawing into a Form, the printer, and a print-preview dialog box. This ensures consistency between what the user sees on screen and on the printed page.</EM></P>
<P><EM>This technique, however, does not work with TextRenderer. The reason is that the Graphics object in the PrintPageEventArgs object is set up with the resolution of the printer and also works with a different coordinate unit—it is usually set for the coordinate unit to be hundredths of an inch. How does it work for the Graphics object? That is where GDI+ displays its beauty. GDI+ is a device-independent graphics library and knows how to scale units properly in this case. TextRenderer assumes all units are at 100 percent. In other words, no scaling is needed.</EM></P>
<P><EM>To make TextRenderer work with the printing API, unit scaling needs to be performed beforehand. </EM><A class=clsFigs onclick="OpenUrl('default.aspx?loc=&amp;fig=true#fig5'); return false;" href="http://msdn.microsoft.com/msdnmag/issues/06/03/TextRendering/default.aspx?loc=&amp;fig=true#fig5" target=_self xmlns:user="http://msdn.microsoft.com/"><EM>Figure&nbsp;5</EM></A><EM> shows how to scale a Point and a Font to be used with TextRenderer when the Graphics object comes from the printing library. Units are converted from hundredths of an inch to pixels using the resolution of the device, which is obtained from the Graphics object DpiX and DpiY properties.</EM></P>
<P><EM>In </EM><A class=clsFigs onclick="OpenUrl('default.aspx?loc=&amp;fig=true#fig6'); return false;" href="http://msdn.microsoft.com/msdnmag/issues/06/03/TextRendering/default.aspx?loc=&amp;fig=true#fig6" target=_self xmlns:user="http://msdn.microsoft.com/"><EM>Figure&nbsp;6</EM></A><EM>, the printing flag is set to true in the printDoc_Print-Page event handler method for the PrintPage event, and false in the control_Paint event handler method for the Paint event. The PaintWorker method checks this flag and, if printing, calls the scaling methods in </EM><A class=clsFigs onclick="OpenUrl('default.aspx?loc=&amp;fig=true#fig5'); return false;" href="http://msdn.microsoft.com/msdnmag/issues/06/03/TextRendering/default.aspx?loc=&amp;fig=true#fig5" target=_self xmlns:user="http://msdn.microsoft.com/"><EM>Figure&nbsp;5</EM></A><EM>.</EM></P>
<P><EM>Even though this approach solves the problem encountered when using TextRenderer for printing and print-previewing, it does not guarantee that you will obtain the same WYSIWYG results you get with the Graphics class. The main reason is that the GDI character-spacing and word-breaking algorithm is not linear—the text rendered using the scaled values may end up with a different layout. Other reasons include the loss of precision when scaling the values and the possibility of obtaining a scaled font that is different from the intended scaling. This can occur if the intended scaled font does not exist and the font-mapping algorithm selects what it thinks is the closest match.</EM></P></BLOCKQUOTE></BLOCKQUOTE>
<P>That changes everything!&nbsp;</P>
<P>This information really&nbsp;knocks the documentation right over, doesn't it?</P>
<P>One has to wonder if the originally documented limitation was added after some tester found the bug and they just decided it was better to document that things don't work and call it a day? :-)</P>
<P>I have never been more happy to be mistaken about something than after I read that article, with its reminder that folks here at Microsoft are often:</P>
<UL>
<LI>not perfect, and are quite capable of being mistaken, and</LI>
<LI>unaware at times of the power of what we provide!</LI></UL>
<P>The reminder that saying something doesn't work is often a translation for "<STRONG>we couldn't get it working here</STRONG>". :-)</P>
<P>Very cool! Someone remind me to buy Miguel A. Lacouture a round of whatever he's drinking some day....</P>
<P mce_keep="true">&nbsp;</P>
<P><FONT color=#ff00ff><EM>This post brought to you by</EM><FONT size=6> ക </FONT><EM>(<A class="" href="http://www.fileformat.info/info/unicode/char/0d15" mce_href="http://www.fileformat.info/info/unicode/char/0d15">U+0d15</A>, a.k.a. MALAYALAM LETTER KA)</EM></FONT></P>
<hr/><p><a id="5969453" href="#5969453">#</a> <strong>Gene</strong> on 7 Nov 2007 4:32 PM:</p><div style="margin-left: 1em"><p>Sigh. Printing gets the short end of the stick just about everywhere except maybe Apple.</p>
<p>In UNIX, if you're lucky you get &quot;everything's a Postscript printer&quot; (except then of course half the time they generate invalid Postscript) and if you're not, you get &quot;everything's an ASR-33 TTY&quot;</p>
<p>More on topic, it seems &quot;not supported&quot; is code for &quot;making it work is non-trivial and we're not going to explain it here&quot;. So who's going to submit a bug on the MSDN docs, and are they going to include example code? &nbsp;:-)</p>
<p>(I do have to say that MSDN article has some of the best design &amp; layout I've ever seen on a web page.)</p></div>
<p><a id="5969502" href="#5969502">#</a> <strong>Gene</strong> on 7 Nov 2007 4:35 PM:</p><div style="margin-left: 1em"><p>Oh, and &quot;Text-rendering libraries must excel at rendering text&quot; is priceless. :-)</p></div>
<hr/><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2007/11/08/5976233.html" title="The [non-]progress of the über-fixed width fonts">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2007/11/07/5952884.html" title="Font don&#39;t have none, Uniscribe won&#39;t be none (aka Garbage in, exception out)">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2007-11">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2007-11-07">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2007/11/07/5958318.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:37 GMT -->
</html>