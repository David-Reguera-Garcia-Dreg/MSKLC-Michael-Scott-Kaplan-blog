<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2007/11/09/6006868.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:37 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>If you get a yen for something a bit wider you might be out of luck</title></head><body>
<h1>If you get a yen for something a bit wider you might be out of luck</h1>
<p><em>by Michael S. Kaplan, published on 2007/11/09 10:16 -05:00, original URI: http://blogs.msdn.com/b/michkap/archive/2007/11/09/6006868.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostNew -->
<P>It was just yesterday that former colleague from way back in the 20th century Scott McMaster asked me a question via email.</P>
<P>He and I got back in touch recently via LinkedIn (which I think we both use in a passive mode<FONT size=1><SUP>1</SUP></FONT>). </P>
<P>Anyway, his question:</P>
<BLOCKQUOTE>
<P><FONT face=Calibri>Why doesn’t .NET parse full-width Yen as a valid currency symbol in the ja-JP culture?<SPAN style="mso-spacerun: yes">&nbsp; </SPAN>I’m seeing it in some data files, and it’s really screwing me up.<SPAN style="mso-spacerun: yes">&nbsp; I'm not really excited about my idea of blindly replacing it with half-width.&nbsp; </SPAN>I read your related blog entries on the subject, and I didn’t see anything there (although it sounds like SQL/S actually does respect FFE5).</FONT></P>
<P class=MsoNormal style="MARGIN: 0in 0in 0pt"><FONT face=Calibri>Here is some sample code:<?xml:namespace prefix = o ns = "urn:schemas-microsoft-com:office:office" /><o:p></o:p></FONT></P>
<P class=MsoNormal style="MARGIN: 0in 0in 0pt"><o:p><FONT face=Calibri>&nbsp;</FONT></o:p></P>
<P class=MsoNormal style="MARGIN: 0in 0in 0pt; mso-layout-grid-align: none"><SPAN style="FONT-SIZE: 8pt; FONT-FAMILY: 'Courier New'; mso-no-proof: yes"><SPAN style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN><SPAN style="COLOR: #2b91af">CultureInfo</SPAN> culture = <SPAN style="COLOR: #2b91af">CultureInfo</SPAN>.GetCultureInfo(<SPAN style="COLOR: #a31515">"ja-JP"</SPAN>);<o:p></o:p></SPAN></P>
<P class=MsoNormal style="MARGIN: 0in 0in 0pt; mso-layout-grid-align: none"><SPAN style="FONT-SIZE: 8pt; FONT-FAMILY: 'Courier New'; mso-no-proof: yes"><SPAN style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN><SPAN style="COLOR: blue">string</SPAN> yen = <SPAN style="COLOR: #a31515">"¥"</SPAN>;<SPAN style="mso-spacerun: yes">&nbsp; </SPAN><SPAN style="COLOR: green">// U+00A5<o:p></o:p></SPAN></SPAN></P>
<P class=MsoNormal style="MARGIN: 0in 0in 0pt; mso-layout-grid-align: none"><SPAN style="FONT-SIZE: 8pt; FONT-FAMILY: 'Courier New'; mso-no-proof: yes"><SPAN style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN><SPAN style="COLOR: blue">string</SPAN> fullWidthYen = <SPAN style="COLOR: #a31515">"</SPAN></SPAN><SPAN style="FONT-SIZE: 8pt; COLOR: #a31515; FONT-FAMILY: 'MS Gothic'; mso-bidi-font-family: 'MS Gothic'; mso-no-proof: yes">￥</SPAN><SPAN style="FONT-SIZE: 8pt; COLOR: #a31515; FONT-FAMILY: 'Courier New'; mso-no-proof: yes">"</SPAN><SPAN style="FONT-SIZE: 8pt; FONT-FAMILY: 'Courier New'; mso-no-proof: yes">;<SPAN style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp; </SPAN><SPAN style="COLOR: green">// U+FFE5<o:p></o:p></SPAN></SPAN></P>
<P class=MsoNormal style="MARGIN: 0in 0in 0pt; mso-layout-grid-align: none"><SPAN style="FONT-SIZE: 8pt; COLOR: green; FONT-FAMILY: 'Courier New'; mso-no-proof: yes"><o:p>&nbsp;</o:p></SPAN></P>
<P class=MsoNormal style="MARGIN: 0in 0in 0pt; mso-layout-grid-align: none"><SPAN style="FONT-SIZE: 8pt; FONT-FAMILY: 'Courier New'; mso-no-proof: yes"><SPAN style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN><SPAN style="COLOR: blue">bool</SPAN> halfWidthIsDefault = culture.NumberFormat.CurrencySymbol == yen;<o:p></o:p></SPAN></P>
<P class=MsoNormal style="MARGIN: 0in 0in 0pt; mso-layout-grid-align: none"><SPAN style="FONT-SIZE: 8pt; FONT-FAMILY: 'Courier New'; mso-no-proof: yes"><o:p>&nbsp;</o:p></SPAN></P>
<P class=MsoNormal style="MARGIN: 0in 0in 0pt; mso-layout-grid-align: none"><SPAN style="FONT-SIZE: 8pt; FONT-FAMILY: 'Courier New'; mso-no-proof: yes"><SPAN style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN><SPAN style="COLOR: green">// OK.<o:p></o:p></SPAN></SPAN></P>
<P class=MsoNormal style="MARGIN: 0in 0in 0pt; mso-layout-grid-align: none"><SPAN style="FONT-SIZE: 8pt; FONT-FAMILY: 'Courier New'; mso-no-proof: yes"><SPAN style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN><SPAN style="COLOR: #2b91af">Decimal</SPAN> value = <SPAN style="COLOR: #2b91af">Decimal</SPAN>.Parse(yen + <SPAN style="COLOR: #a31515">"5"</SPAN>,<o:p></o:p></SPAN></P>
<P class=MsoNormal style="MARGIN: 0in 0in 0pt; mso-layout-grid-align: none"><SPAN style="FONT-SIZE: 8pt; FONT-FAMILY: 'Courier New'; mso-no-proof: yes"><SPAN style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN><SPAN style="COLOR: #2b91af">NumberStyles</SPAN>.AllowThousands | <SPAN style="COLOR: #2b91af">NumberStyles</SPAN>.AllowCurrencySymbol | <SPAN style="COLOR: #2b91af">NumberStyles</SPAN>.AllowDecimalPoint,<o:p></o:p></SPAN></P>
<P class=MsoNormal style="MARGIN: 0in 0in 0pt; mso-layout-grid-align: none"><SPAN style="FONT-SIZE: 8pt; FONT-FAMILY: 'Courier New'; mso-no-proof: yes"><SPAN style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>culture);<o:p></o:p></SPAN></P>
<P class=MsoNormal style="MARGIN: 0in 0in 0pt; mso-layout-grid-align: none"><SPAN style="FONT-SIZE: 8pt; FONT-FAMILY: 'Courier New'; mso-no-proof: yes"><SPAN style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN><SPAN style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN style="COLOR: #2b91af">Console</SPAN>.WriteLine(value);<o:p></o:p></SPAN></P>
<P class=MsoNormal style="MARGIN: 0in 0in 0pt; mso-layout-grid-align: none"><SPAN style="FONT-SIZE: 8pt; FONT-FAMILY: 'Courier New'; mso-no-proof: yes"><o:p>&nbsp;</o:p></SPAN></P>
<P class=MsoNormal style="MARGIN: 0in 0in 0pt; mso-layout-grid-align: none"><SPAN style="FONT-SIZE: 8pt; FONT-FAMILY: 'Courier New'; mso-no-proof: yes"><SPAN style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN><SPAN style="COLOR: green">// KABLOOEY!<o:p></o:p></SPAN></SPAN></P>
<P class=MsoNormal style="MARGIN: 0in 0in 0pt; mso-layout-grid-align: none"><SPAN style="FONT-SIZE: 8pt; FONT-FAMILY: 'Courier New'; mso-no-proof: yes"><SPAN style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>value = <SPAN style="COLOR: #2b91af">Decimal</SPAN>.Parse(fullWidthYen + <SPAN style="COLOR: #a31515">"5"</SPAN>,<o:p></o:p></SPAN></P>
<P class=MsoNormal style="MARGIN: 0in 0in 0pt; mso-layout-grid-align: none"><SPAN style="FONT-SIZE: 8pt; FONT-FAMILY: 'Courier New'; mso-no-proof: yes"><SPAN style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN><SPAN style="COLOR: #2b91af">NumberStyles</SPAN>.AllowThousands | <SPAN style="COLOR: #2b91af">NumberStyles</SPAN>.AllowCurrencySymbol | <SPAN style="COLOR: #2b91af">NumberStyles</SPAN>.AllowDecimalPoint,<o:p></o:p></SPAN></P>
<P class=MsoNormal style="MARGIN: 0in 0in 0pt; mso-layout-grid-align: none"><SPAN style="FONT-SIZE: 8pt; FONT-FAMILY: 'Courier New'; mso-no-proof: yes"><SPAN style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>culture);<o:p></o:p></SPAN></P>
<P class=MsoNormal style="MARGIN: 0in 0in 0pt; mso-layout-grid-align: none"><SPAN style="FONT-SIZE: 8pt; FONT-FAMILY: 'Courier New'; mso-no-proof: yes"><SPAN style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN><SPAN style="COLOR: #2b91af">Console</SPAN>.WriteLine(value);<o:p></o:p></SPAN></P>
<P class=MsoNormal style="MARGIN: 0in 0in 0pt"><o:p><FONT face=Calibri>&nbsp;</FONT></o:p></P>
<P class=MsoNormal style="MARGIN: 0in 0in 0pt"><FONT face=Calibri>Any insight would be greatly appreciated.<SPAN style="mso-spacerun: yes">&nbsp; </SPAN>Thanks!</FONT></P>
<P class=MsoNormal style="MARGIN: 0in 0in 0pt"><FONT face=Calibri></FONT>&nbsp;</P>
<P class=MsoNormal style="MARGIN: 0in 0in 0pt"><FONT face=Calibri>--scott</FONT></P></BLOCKQUOTE>
<P>Much of the answer to this question can be found buried in the .NET piece of <A class="" href="http://archives.miloush.net/michkap/archive/2005/11/07/489978.html" mce_href="http://archives.miloush.net/michkap/archive/2005/11/07/489978.html"><STRONG>SQL Server and the CLR have different ways of getting the money</STRONG></A>,&nbsp;with perhaps a bit lore info in&nbsp;<A class="" href="http://archives.miloush.net/michkap/archive/2005/07/22/441633.html" mce_href="http://archives.miloush.net/michkap/archive/2005/07/22/441633.html"><STRONG>Show me the [small]money!</STRONG></A> and <A class="" href="http://archives.miloush.net/michkap/archive/2005/10/12/479561.html" mce_href="http://archives.miloush.net/michkap/archive/2005/10/12/479561.html"><STRONG>I'd rather call it the path separator</STRONG></A>, as well.</P>
<P>Although most of the post was criticizing the SQL Server behavior,&nbsp;in truth I find the .NET support (as vaguely described in the AllowCurrencySymbol or Currency <A class="" href="http://msdn2.microsoft.com/library/system.globalization.numberstyles.aspx" mce_href="http://msdn2.microsoft.com/library/system.globalization.numberstyles.aspx">NumberStyles enumeration</A>&nbsp;topic) to be even more disappointing, especially as it fails to extend to numbers and number-like things as discussed in <A class="" href="http://archives.miloush.net/michkap/archive/2007/03/01/1777676.html" mce_href="http://archives.miloush.net/michkap/archive/2007/03/01/1777676.html"><STRONG>That's funny, they look like digits!</STRONG></A>. Though perhaps SQL Server is just as "broken" in that case, I haven't really tried it but I suspect that it does not work....</P>
<P>SQL Server is this case has started in SQL Server 2000 and continued in SQL Server 2005 with an incomplete (and thus ultimately&nbsp;somewhat inadequate) attempt to capture every possible currency symbol in order to know what to ignore in insertion of text to its <STRONG>money</STRONG> and <STRONG>smallmoney</STRONG> columns. Functionality that makes sense until you think about how it is&nbsp;incomplete in even what it tries to do.</P>
<P><FONT color=#ff0000><EM>By the way, if your name is either Brandon or Goldie and you are reading this, could you&nbsp;make sure&nbsp;a bug gets put in to get the list updated as discussed <A class="" href="http://archives.miloush.net/michkap/archive/2005/07/22/441633.html" mce_href="http://archives.miloush.net/michkap/archive/2005/07/22/441633.html"><STRONG>here</STRONG></A>? If you are someone else on the SQL Server team, feel free to send them over here. </EM>:-)</FONT></P>
<P>Beyond that, the feature is generally broken since it encourages people&nbsp;to make currency conversion mistakes.</P>
<P>And .NET has gone in the other direction and is only willing to handle a single currency symbol and format as defined in a NumberFormatInfo instance, and is entire unwilling to accept either:</P>
<UL>
<LI>The full width variants of valid half width characters given in the table from <A class="" href="http://archives.miloush.net/michkap/archive/2005/10/12/479561.html" mce_href="http://archives.miloush.net/michkap/archive/2005/10/12/479561.html"><STRONG>this post</STRONG></A>, or </LI>
<LI>The REVERSE SOLIDUS (<A class="" href="http://www.fileformat.info/info/unicode/char/005C/" mce_href="http://www.fileformat.info/info/unicode/char/005C/">U+005c</A>) except possibly in&nbsp;some specific instances that I&nbsp;am too wracked by moral despair to verify right&nbsp;now....&nbsp;</LI></UL>
<P>But doesn't this seem like the sort of problem that could have been ideally solved via a Parse/ParseExact distinction, rather than always forcing such a locked down parse operation?</P>
<P>And imagine what this does for the SQLCLR side of things here -- wouldn't everyone be much happier if this was not yet another difference between SQL Server and the CLR when it is hosted within SQL Server? </P>
<P>I think a more integrated SQLCLR experience that felt less like a "bolt-on" might make people more willing to accept the feature, a topic that deserves its own blog post to try to get my full list of things missing from SQLCLR down in one place....</P>
<P mce_keep="true">&nbsp;</P>
<P><FONT size=1>1 - By LinkedIn passive mode, I mean we both mostly just wait until someone adds us, and then we go in and look at their contact list to see if there is someone we ought to add from their contacts list. This keeps it from feeling like an MLM/Amway kind of thing.:-)</FONT></P>
<P mce_keep="true">&nbsp;</P>
<P><FONT color=#ff00ff><EM>This post brought to you by</EM><FONT size=5> ￥ </FONT><EM>(<A class="" href="http://www.fileformat.info/info/unicode/char/ffe5" mce_href="http://www.fileformat.info/info/unicode/char/ffe5">U+ffe5</A>, a.k.a. FULLWIDTH YEN SIGN)</EM></FONT></P>
<hr/><p><strong>JM</strong> on 9 Nov 2007 2:16 PM:</p><div style="margin-left: 1em"><p>OK, going off on a tangent here, but the whole &quot;CLR in SQL Server&quot; is just wrong. I say this as a member of the old school that believes that the database is the database and the application is the application and never the twain should meet through anything but SQL, so take that as an admission of bigotry if you want.</p>
<p>Still, the SQL Server team appears to agree with this philosophy, as evidenced by the many restrictions and caveats of CLR code hosted in SQL Server (&quot;OK, .NET code, you can come in, but stay over there in the corner and keep quiet, papa RDBMS has work to do&quot;). The whole SQLCLR affair is defined by what you *cannot* do far more than it is defined by what you *can* do, and in what you can do it's much more defined by what *isn't* easy to do.</p>
<p>At present, you are still far better off keeping your SQL Server code restricted to T-SQL, and using the full power of the CLR on the client side. That way the different philosophies can do their work without getting in each other's way, and you can let other people spill their blood on the cutting edge. CLR in SQL has great potential for when it's a first-class citizen, but it's just not there yet.</p></div>
<p><strong>Michael S. Kaplan</strong> on 9 Nov 2007 2:37 PM:</p><div style="margin-left: 1em"><p>I would argue that better interop and more consistent behavior on the CLIENT side would also be desirable here -- so even if you don't like SQLCLR the pure SQLS server an pure .NET client still suffers from incompatibility issues t present (I'll be blogging more about this soon).</p>
</div>
<hr/><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2007/11/10/6038269.html" title="What would they call a Black and White milkshake at Jackrabbit Slim&#39;s?">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2007/11/09/6003541.html" title="Respect the power of Limonata and Cap&#39;n Crunch&#39;s Crunch Berries">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2007-11">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2007-11-09">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2007/11/09/6006868.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:37 GMT -->
</html>