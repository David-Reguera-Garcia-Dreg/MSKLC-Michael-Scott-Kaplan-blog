<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2007/11/02/5808539.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:37 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>Predictably (in retrospect), aka Where Wild^H^H^Hindows-Only Things Are, aka SHORT [on ]TIME for a LONG TIME</title></head><body>
<h1>Predictably (in retrospect), aka Where Wild^H^H^Hindows-Only Things Are, aka SHORT [on ]TIME for a LONG TIME</h1>
<p><em>by Michael S. Kaplan, published on 2007/11/02 10:16 -04:00, original URI: http://blogs.msdn.com/b/michkap/archive/2007/11/02/5808539.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostNew -->
<P>Oli reported what he thought was a bug:</P>
<BLOCKQUOTE><FONT face="times new roman,times" size=2>
<P><EM>Hi Michael, <BR><BR>I found some inconsistencies in the culture info provided on XP. For example, some cultures have a short time pattern with seconds in the pattern (e.g. Welsh). It seems that overall the only distinction between a long and a short time pattern is that the prior includes seconds, and the latter doesn't, so I'd take the Welsh case as an inconsistency. <BR><BR>Also for Welsh the (default) short time pattern is equivalent to the long time pattern, and none of the culture info date/time patterns includes a time pattern without seconds. <BR><BR>The same is the case for some other locales/cultures.<BR><BR>Let me know whether to file bugs through MS Connect (which usually are ignored or classified "by design") or whether you'd like me to send you more information about the inconsistencies directly. <BR><BR>Cheers, Oli<BR><BR>PS: The most annoying bug "by design" is that .Net's regular expression evaluator applies a shortest match strategy (instead of the usual longest match) on disjunctions. "a|ab" applied on "ab" will only match/consume "a", while "ab|a" applied on "ab" will match the whole input. The response I got was that perl does it just like that... My suggestion to then add a "longest match" variant of the disjunction operator so that one would have some control over what's going on was unfortunately ignored.</EM></P></FONT></BLOCKQUOTE>
<P>Let's leave aside that RegEx thing as&nbsp;I have no strong opinion on it and this blog is all about my strong opinions. :-)</P>
<P>The issue with the culture differences is by design.</P>
<P>A basic difference between Windows-Only cultures and built-in .NET Framework cultures, especially as they relate to the fundamental problems with that abomination the SHORT TIME that I have taunted previously in posts like <A class="" href="http://archives.miloush.net/michkap/archive/2005/12/18/505141.html" mce_href="http://archives.miloush.net/michkap/archive/2005/12/18/505141.html"><STRONG>Customizing the SHORT time format?</STRONG></A> and <A class="" href="http://archives.miloush.net/michkap/archive/2006/07/21/673813.html" mce_href="http://archives.miloush.net/michkap/archive/2006/07/21/673813.html"><STRONG>We do seem to be short on time...</STRONG></A>.</P>
<P>In short, Windows-Only cultures are synthetic objects built from the built-in support within Windows, and since Windows does not distinguish between long time and short time as two unique settings, there is no option that has been reviewed by the owners of the data that is available.</P>
<P>Now given that the equivalent functionality of the "short time" format is available in Windows via flags to <A class="" href="http://msdn2.microsoft.com/library/ms776299.aspx" mce_href="http://msdn2.microsoft.com/library/ms776299.aspx">GetTimeFormat</A> that I discussed in <A class="" href="http://archives.miloush.net/michkap/archive/2006/07/21/673813.html" mce_href="http://archives.miloush.net/michkap/archive/2006/07/21/673813.html"><STRONG>We do seem to be short on time...</STRONG></A>, it is possible to hypothesize working backward from it -- using <A class="" href="http://msdn2.microsoft.com/library/ms776299.aspx" mce_href="http://msdn2.microsoft.com/library/ms776299.aspx">GetTimeFormat</A>&nbsp;with the TIME_NOSECONDS flag to format any string using a short time format,&nbsp;or better yet&nbsp;providing the short time format itself by revere engineering the results of that call.</P>
<P>But that is also a lot of work to support a time format which <STRONG>frankly speaking&nbsp;is really awful</STRONG>&nbsp;and has nothing to do with anything other than maintaining a legacy VB feature that has nothing to do with internationalization.... :-)</P>
<P>But let me take a step back and talk about Windows Only cultures. :-)</P>
<P>Ignoring occasional <A class="" href="http://archives.miloush.net/michkap/archive/2007/10/22/5590751.html" mce_href="http://archives.miloush.net/michkap/archive/2007/10/22/5590751.html"><STRONG>heroics</STRONG></A> that I find myself involved with (which, let's be honest are really the exception, not the rule!), there are a handful of times that I feel like I've&nbsp;been involved in&nbsp;something really unique, and these beasts are one of them....</P>
<P>It was back in the early days of MSKLC, and Igor (then an NLS tester) had happened to randomly try to combine the <A class="" href="http://archives.miloush.net/michkap/archive/2005/01/26/360685.html" mce_href="http://archives.miloush.net/michkap/archive/2005/01/26/360685.html"><STRONG>Enabled Language Kits (ELK)</STRONG></A> feature (also in beta&nbsp;at the time)&nbsp;with MSKLC. And this was before the update to the .NET Framework that kept managed applications from crashing if you&nbsp;used an ELK locale for the user locale -- crashing becasuse it was unable to create a CultureInfo from the validated return value of GetUserDefaultLCID....</P>
<P>So, <STRONG>predictably (in retrospect)<FONT size=1><SUP>1</SUP></FONT></STRONG>, MSKLC crashed.</P>
<P>The short term fix was to just make CurrentCulture something else entirely so the call would succeed and just fill in some other locale. One that was valid.</P>
<P>But the scenario was an intuitively compelling one, much more compelling than supporting Indic locale data on platforms that did not contain fonts&nbsp;-- because in this case the support was there and users would have a good faith basis for expecting them to work.</P>
<P>But everyone dreaded the long term fix, as the path that everyone's mind seemed to be on involved maintaining two huge dynamic data sets and updating the .NET ones any time the Windows ones were. In perpetuity (or whatever the "supported platform" definition of perpetuity entailed....</P>
<P>Everyone hated this road, but they felt like it was the only responsible one to take. We walked down this path, resigned.</P>
<P>I thought of another idea one night. What I was doing that night was really amusing and I might talk about it another day, if I am ever again as drunk as I was that night and able to blog at the same time.</P>
<P>The next morning I was at work,&nbsp;I put on a PM hat that was lying around (people tell me my office is a mess and they aren't wrong when they tell me that) and wrote a doc suggesting a feature of <STRONG>synthetic cultures</STRONG> -- any time Windows knew of a locale and .NET didn't, the managed code would just build its own synthetic CultureInfo by asking Windows for all of the information. </P>
<P>Though the PM hat on me was not a 100% fit then. So though&nbsp;the doc&nbsp;was more than a spec since it had actual implementation suggestions,&nbsp;it was&nbsp;also less than a spec since it did not have the&nbsp;feature name, general terminology suggestiona, &nbsp;explicit justification, or&nbsp;scenarios filled in (all crucial to getting it approved as a feature!) - luckily there were real PMs to&nbsp;finish&nbsp;it up and turn the document into an actual spec.</P>
<P>Thusly,&nbsp;synthetic cultures became <STRONG>Windows only cultures</STRONG>!</P>
<P>And Tarek (yes, <A class="" href="http://archives.miloush.net/michkap/archive/2006/09/01/735817.html" mce_href="http://archives.miloush.net/michkap/archive/2006/09/01/735817.html"><STRONG>that</STRONG></A> Tarek, the one who wrote the cool GetDateFormat wrapper!) put on his developer hat and implemented almost everything from that spec, including just about every feature I suggeted even though I assumed it would get whittled down at the time.</P>
<P>Now he was able to do this because the testers (who were wearing their tester hats already)&nbsp;actually felt would be EASIER to test with the fuller coverage of the feature was since there was a rich suite of tests covering managed vs. unmanaged functional parity to leverage. Every different behavior would be a special case that would be more work to test.</P>
<P>A great example of cross-discipline teamwork to solve a genuine problem originally found almost&nbsp;entirely by accident by noticing two unrelated features not working well with each other!</P>
<P>And an important functional direction to properly handle a world where both the Framework and an underlying platform exist, both have locale/culture support,&nbsp;and there can be a reasonable expectation of parity between them -- <EM>more on this&nbsp;(and some of the unexpected challenges) another time</EM>. :-)</P>
<P mce_keep="true">&nbsp;</P>
<P><FONT size=1>1 - Predictably (in retorospect) is a phrase that really captures the spirtit of the kind of problem that you completely understand (just as soon as you understand it), with no new knowledge required in order to realize the cause -- just having the problem described allows you to imediately understand what is happening.</FONT></P>
<P mce_keep="true">&nbsp;</P>
<P><FONT color=#ff00ff><EM>This post brought to you by</EM> <FONT size=5>h</FONT> <EM>(<A class="" href="http://www.fileformat.info/info/unicode/char/0068" mce_href="http://www.fileformat.info/info/unicode/char/0068">U+0068</A>, a.k.a. LATIN SMALL LETTER H)</EM></FONT></P>
<hr/><p><a id="5900173" href="#5900173">#</a> <strong>Maurits [MSFT]</strong> on 5 Nov 2007 12:26 AM:</p><div style="margin-left: 1em"><p>RE: regex:</p>
<p>It has nothing to do with shortest vs. longest. &nbsp;If there's a series of options separated by |, the regex engine will try to match each option /in turn/.</p>
<p>For example, consider these two patterns:</p>
<p>1) a(b|bc)d</p>
<p>2) a(bc|b)d</p>
<p>And these two strings:</p>
<p>I) abdabcd</p>
<p>II) abcdabd</p>
<p>1) and 2) will both match I) on the &quot;abd&quot;; and they will both match II) on &quot;abcd&quot;. &nbsp;So it has nothing to do with the length of the match, but rather the positioning of the matches in the string.</p>
<p>It is possible to generate silly regexes, of course. &nbsp;Take the final d off of 1), and it will *always* match the first &quot;ab&quot; sequence... never using the &quot;c&quot;.</p>
</div>
<hr/><p><em>referenced by</em></p><div style="margin-left: 1em"><p>2010/01/27 <a href="http://archives.miloush.net/michkap/archive/2010/01/27/9953946.html">We do seem to be short on time... (Windows 7 edition)</a></p><p>2008/10/19 <a href="http://archives.miloush.net/michkap/archive/2008/10/19/9006393.html">I see LONG TIME and SHORT TIME; where are SHORTER TIME and SHORTEST TIME?</a></p><p>2008/09/25 <a href="http://archives.miloush.net/michkap/archive/2008/09/25/8964291.html">You're not my type if you have no culture</a></p><p>2008/03/16 <a href="http://archives.miloush.net/michkap/archive/2008/03/16/8238240.html">On changing the world, or at least the way people order things in it</a></p><p>2007/12/22 <a href="http://archives.miloush.net/michkap/archive/2007/12/22/6833199.html">CultureInfo subsetting attempts that suck</a></p><p>2007/11/26 <a href="http://archives.miloush.net/michkap/archive/2007/11/26/6527833.html">When yesterday's workaround becomes tomorrow's potential solution...</a></p></div><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2007/11/02/5827059.html" title="In JavaScript? That just doesn&#39;t Scan[ Code]!">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2007/11/01/5807844.html" title="The inventory shows a truly unexpected ten-item surplus">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2007-11">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2007-11-02">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2007/11/02/5808539.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:37 GMT -->
</html>