<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2007/09/10/4847780.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:37 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>A&P of Sort Keys, part 0 (aka The empty string sorts the same in every language)</title></head><body>
<h1>A&P of Sort Keys, part 0 (aka The empty string sorts the same in every language)</h1>
<p><em>by Michael S. Kaplan, published on 2007/09/10 03:31 -04:00, original URI: http://blogs.msdn.com/b/michkap/archive/2007/09/10/4847780.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostNew -->
<P>So I was talking with Brett the other day (yes, <A class="" href="http://blogs.msdn.com/brettsh/" mce_href="http://blogs.msdn.com/brettsh/">that Brett</A>, the one whose blog is only occasionally written to!), I can't remember what the original purpose if the conversation was.</P>
<P>Though I did not mind, because our conversations and really anything he feels like talking or writing about is&nbsp;always interesting (even when he is talking about <A class="" href="http://blogs.msdn.com/brettsh/archive/2006/06/12/631516.aspx" mce_href="http://blogs.msdn.com/brettsh/archive/2006/06/12/631516.aspx">the size of someone's DIT</A>, a blog post title after my own heart!).</P>
<P>I did take the opportunity while we were talking anyway to congratulate him on his promotion (he was surprised I knew; I guess not everyone is used to that whole address book title transparency thing as it gets rolled out to the company bit by bit!), and we talked about that whole SP/Server issue that is on its way to solved.</P>
<P>Now I remember what the call was about.&nbsp;He had a question for me, one that he was trying to&nbsp;ask in mail but I was having trouble understanding his question and then he was having trouble with my answer, too. Surprisingly, it turns out we were both clearer than we realized....</P>
<P>He was trying to figure out two things, essentially:</P>
<UL>
<LI>Understanding the various features in collation and how each one relates to sort key size;</LI>
<LI>Knowing how to apply this theoretical knowledge and actually generate the strings for each feature.</LI></UL>
<P>The more I thought about it, the more I realized that both of these things might be of more general interest to readers here who like that whole "peek behind the curtain" that SiaO enjoys providing so much.</P>
<P>So think of this post as the introduction to an exciting new series of posts, one per day!</P>
<P>Now I am talking about going beyond that old <STRONG><A class="" href="http://archives.miloush.net/michkap/archive/2004/12/30/344389.html" mce_href="http://archives.miloush.net/michkap/archive/2004/12/30/344389.html">How do sort keys work?</A></STRONG> post and the later ones that point to it, and get into real nitty gritty.</P>
<P>Of course the best place to start is at the theoretical beginning string -- the empty string.</P>
<P>I actually have talked about this before (see <STRONG><A class="" href="http://archives.miloush.net/michkap/archive/2005/05/19/419981.html" mce_href="http://archives.miloush.net/michkap/archive/2005/05/19/419981.html">The string is freaking empty!</A></STRONG> for details), but the theoretical sort key for the zero length string would be:</P>
<BLOCKQUOTE>
<P><STRONG><FONT face="Consolas,Lucida Console,Courier New,Courier">01 01 01 01 00</FONT></STRONG></P></BLOCKQUOTE>
<P mce_keep="true">&nbsp;</P>
<P>The reason I call this a theoretical sort key is that in practice (as <A class="" href="http://archives.miloush.net/michkap/archive/2005/05/19/419981.html" mce_href="http://archives.miloush.net/michkap/archive/2005/05/19/419981.html"><STRONG>The string is freaking empty!</STRONG></A> pointed out) you will get an error trying to get a sort key from an empty string. But you can easily fake it, though -- just pass only symbols and also include the NORM_IGNORESYMBOLS flag.</P>
<P>Those numbers are bytes, and the 0x01 byte values are sentinels that split up the various pieces of the key, as follows:</P>
<BLOCKQUOTE>
<P><STRONG><FONT face="Consolas,Lucida Console,Courier New,Courier" size=1><FONT color=#999966>[all Unicode sort weights]</FONT> 01 <FONT color=#999966>[all Diacritic weights]</FONT> 01 <FONT color=#999966>[all Case weights]</FONT> 01 <FONT color=#999966>[all Special weights]</FONT> 01 <FONT color=#999966>[Punctuation weights]</FONT> 00</FONT></STRONG></P></BLOCKQUOTE>
<P mce_keep="true">The numbers will be hexadecimal always (but I will often skip the 0x prefix to save space), and I will make the sentinel values black for the rest of the series (other pieces of weights will be different colors).</P>
<P mce_keep="true">Now ideally no weight will ever use either 0x00 or 0x01, but there are a few times that bugs will put these values into sort keys that are either bugs (<STRONG><A class="" href="http://archives.miloush.net/michkap/archive/2005/06/15/429279.html#429360" mce_href="http://archives.miloush.net/michkap/archive/2005/06/15/429279.html#429360">e.g. this one</A></STRONG>)&nbsp;or design flaws (e.g. <STRONG><A class="" href="http://archives.miloush.net/michkap/archive/2006/03/07/545097.html" mce_href="http://archives.miloush.net/michkap/archive/2006/03/07/545097.html">this other one</A></STRONG>). If you ignore these bugs (one of which has limited use linguistically and the other one of which is fixed in Vista) then it actually makes a great frame work for&nbsp;evetyone's&nbsp;future.</P>
<P mce_keep="true">When I am all done, I will give one of the possible answers to the questions raised in <A href="http://archives.miloush.net/michkap/archive/2007/09/04/4734456.html"><STRONG>I am not a nudist, but I do support stripping when it is appropriate, part 1</STRONG></A>. With a full explanation of how the sort key can help there....</P>
<P mce_keep="true">This particular post has very little of linguistic value (because the empty string is the same in every language!), but many other posts in the series will.</P>
<P mce_keep="true">I hope the series sounds interesting to you if you are a regular reader, otherwise half the posts over the next while will bore the living snot out of you. :-)</P>
<P mce_keep="true">&nbsp;</P>
<P mce_keep="true"><FONT color=#ff00ff><EM>This post brought to you by</EM> <FONT size=5>0</FONT>&nbsp;<A class="" href="http://www.fileformat.info/info/unicode/char/0030" mce_href="http://www.fileformat.info/info/unicode/char/0030"><EM>U+0030</EM></A><EM>, a.k.a. DIGIT ZERO)</EM></FONT></P>
<hr/><div style="margin-left: 1em"><em>no comments</em></div><hr/><p><em>referenced by</em></p><div style="margin-left: 1em"><p>2008/10/09 <a href="http://archives.miloush.net/michkap/archive/2008/10/09/8992427.html">Making a point without explaining the whole point of the point? *That* is the point!</a></p><p>2008/08/21 <a href="http://archives.miloush.net/michkap/archive/2008/08/21/8883467.html">A&P of Sort Keys, part 14: The Hangul is really getting OLD</a></p><p>2008/01/25 <a href="http://archives.miloush.net/michkap/archive/2008/01/25/7228941.html">On reversing the irreversible (grabbing the data, part I)</a></p><p>2007/10/09 <a href="http://archives.miloush.net/michkap/archive/2007/10/09/5375754.html">A&P of Sort Keys, part 13 (About the function that is too lazy to get it right every time)</a></p><p>2007/10/08 <a href="http://archives.miloush.net/michkap/archive/2007/10/08/5270854.html">A&P of Sort Keys, part 12 (aka Han sorts first!)</a></p><p>2007/09/24 <a href="http://archives.miloush.net/michkap/archive/2007/09/24/5085893.html">A&P of Sort Keys, part 11 (aka It's not like ideographic sorts were developed idiopathically)</a></p><p>2007/09/21 <a href="http://archives.miloush.net/michkap/archive/2007/09/21/5027338.html">A&P of Sort Keys, part 10 (aka I've kana wanted to start talking about Japanese)</a></p><p>2007/09/20 <a href="http://archives.miloush.net/michkap/archive/2007/09/20/5008305.html">A&P of Sort Keys, part 9 (aka Not always transitive, but punctual and punctuating)</a></p><p>2007/09/18 <a href="http://archives.miloush.net/michkap/archive/2007/09/18/4971376.html">A&P of Sort Keys, part 8 (aka You can often think of ignoring weights as a form of ignorance)</a></p><p>2007/09/17 <a href="http://archives.miloush.net/michkap/archive/2007/09/17/4950008.html">A&P of Sort Keys, part 7 (aka You're very thin now, but I can still recognize you)</a></p><p>2007/09/16 <a href="http://archives.miloush.net/michkap/archive/2007/09/16/4937196.html">A&P of Sort Keys, part 6 (aka Relax, be calm, and deCOMPRESS if you are feeling out of sorts)</a></p><p>2007/09/15 <a href="http://archives.miloush.net/michkap/archive/2007/09/15/4924008.html">A&P of Sort Keys, part 5 (aka EXPANSIONing your horizons)</a></p><p>2007/09/14 <a href="http://archives.miloush.net/michkap/archive/2007/09/14/4905625.html">A&P of Sort Keys, part 4 (aka It isn't a race but let's make an EXCEPTION and cross the Finnish line)</a></p><p>2007/09/13 <a href="http://archives.miloush.net/michkap/archive/2007/09/13/4889199.html">A&P of Sort Keys, part 3 (aka Should you let a string make it's case? If so, Y?)</a></p><p>2007/09/12 <a href="http://archives.miloush.net/michkap/archive/2007/09/12/4875560.html">A&P of Sort Keys, part 2 (aka The string that won? Didn't have a mark on him!)</a></p><p>2007/09/11 <a href="http://archives.miloush.net/michkap/archive/2007/09/11/4861436.html">A&P of Sort Keys, part 1 (aka The law of the letter -- e.g. Latin < Greek < Cyrillic)</a></p></div><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2007/09/10/4850360.html" title="The SendKeys *blog post* juice was definitely not worth the squeeze">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2007/09/09/4845383.html" title="A dash of this, a dash of that (aka MS v. Adobe? Shaping engines v. fonts? Typographers v. Unicode? Everyone v. everyone else!)">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2007-09">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2007-09-10">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2007/09/10/4847780.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:37 GMT -->
</html>