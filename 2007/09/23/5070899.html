<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2007/09/23/5070899.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:37 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>If it isn't Unicode, it isn't ANY code!</title></head><body>
<h1>If it isn't Unicode, it isn't ANY code!</h1>
<p><em>by Michael S. Kaplan, published on 2007/09/23 05:51 -04:00, original URI: http://blogs.msdn.com/b/michkap/archive/2007/09/23/5070899.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostNew -->
<P>Raymond makes a good point in <A class="" href="http://blogs.msdn.com/oldnewthing/archive/2007/09/19/4988589.aspx" mce_href="http://blogs.msdn.com/oldnewthing/archive/2007/09/19/4988589.aspx">What happens if you pass a source length greater than the actual string length?</A> about the potential dangers of the NLS semantic for length parameters....</P>
<P>I make a similar point about the potential problems in <A class="" href="http://archives.miloush.net/michkap/archive/2005/04/20/410043.html" mce_href="http://archives.miloush.net/michkap/archive/2005/04/20/410043.html"><STRONG>Encoding APIs and Security Concerns, APIs and Security Decisions</STRONG></A>, though I stand by my point in <A class="" href="http://archives.miloush.net/michkap/archive/2004/12/19/325199.html" mce_href="http://archives.miloush.net/michkap/archive/2004/12/19/325199.html"><STRONG>API Consistency and Developer Comfort</STRONG></A> about how (since you cannot rely on consistency across the Win32 API, at least you can often rely on consistency within families of functions (usually).</P>
<P>In the end, the real errors are fourfold from the NLS point of view in the scenario Raymond talks about, in addition to the actual semantic differences with how length parameters are handled:</P>
<UL>
<LI>You should never convert the case of file names -- <STRONG>preserve the case, always</STRONG>, as I talk about <A class="" href="http://archives.miloush.net/michkap/archive/2007/06/18/3374502.html" mce_href="http://archives.miloush.net/michkap/archive/2007/06/18/3374502.html"><STRONG>here</STRONG></A>;</LI>
<LI>You should never pass file names to a function that uses CompareString since that is a linguistic comparisons, which the file system does not use. CompareStringOrdinal is much more appropriate as I mention <A class="" href="http://archives.miloush.net/michkap/archive/2006/08/12/696284.html" mce_href="http://archives.miloush.net/michkap/archive/2006/08/12/696284.html"><STRONG>here</STRONG></A> and in other posts;</LI>
<LI>Even if the theoretical invariant_strnicmp Raymond posited were calling the right function, the fact that it assumes the two strings passed to CompareString are of the same length, which they don't have to be in that function (the simplification used in many Shell, CRT,&nbsp;and other functions is a dangerous over-simplification;</LI>
<LI>Unicode is not being used!</LI></UL>
<P>How is the title for a new advertising slogan? :-)</P>
<P mce_keep="true">&nbsp;</P>
<P><FONT color=#ff00ff><EM>This post brought to you by</EM> à¤“ <EM>(<A class="" href="http://www.fileformat.info/info/unicode/char/0913" mce_href="http://www.fileformat.info/info/unicode/char/0913">U+0913</A>, a.k.a. DEVANAGARI LETTER O)</EM></FONT></P>
<hr/><div style="margin-left: 1em"><em>no comments</em></div><hr/><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2007/09/23/5071210.html" title="Docs can whet SiaO&#39;s appetite, but where&#39;s the blog?">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2007/09/23/5066252.html" title="[In/Out]laws can be a great news source (aka Maybe Alaska Air should sacrifice more goats?)">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2007-09">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2007-09-23">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2007/09/23/5070899.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:37 GMT -->
</html>