<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2007/09/02/4701403.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:37 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>When the NLS keyboard's notions about LCIDs aren't the same as in NLS, part #1</title></head><body>
<h1>When the NLS keyboard's notions about LCIDs aren't the same as in NLS, part #1</h1>
<p><em>by Michael S. Kaplan, published on 2007/09/02 04:46 -04:00, original URI: http://blogs.msdn.com/b/michkap/archive/2007/09/02/4701403.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostNew -->
<P>Following up on yet another of those fun issues that spins out of the architecture for custom keyboard layouts based on custom languages that I described in <STRONG><A class="" href="http://archives.miloush.net/michkap/archive/2007/08/23/4535058.html" mce_href="http://archives.miloush.net/michkap/archive/2007/08/23/4535058.html">Getting the language (and more!) of an LCID-less keyboard</A></STRONG> and continued in <STRONG><A class="" href="http://archives.miloush.net/michkap/archive/2007/08/25/4564548.html" mce_href="http://archives.miloush.net/michkap/archive/2007/08/25/4564548.html">MSKLC keyboard layout names in your own language</A></STRONG>....</P>
<P>Every custom locale/culture has an assumed LCID value of 0x00001000, which is also known as LOCALE_CUSTOM_UNSPECIFIED in winnt.h, defined as follows:</P>
<BLOCKQUOTE>
<P><FONT face="consolas,lucida console,courier new,courier"><STRONG>#define LOCALE_CUSTOM_UNSPECIFIED&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; \<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (MAKELCID(MAKELANGID(LANG_NEUTRAL, SUBLANG_CUSTOM_UNSPECIFIED), SORT_DEFAULT))</STRONG></FONT></P></BLOCKQUOTE>
<P mce_keep="true">You might not like this, and if you don't then you are not alone; this is a controversial thing that even today some people still think could have and should have been done differently.</P>
<P mce_keep="true">But that is not what this post is about, so I'll talk about that another day.</P>
<P mce_keep="true">Now there are two other "custom culture" LCID values, defined in that same header file:</P>
<BLOCKQUOTE>
<P mce_keep="true"><FONT face="consolas,lucida console,courier new,courier"><STRONG>#define LOCALE_CUSTOM_DEFAULT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; \<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (MAKELCID(MAKELANGID(LANG_NEUTRAL, SUBLANG_CUSTOM_DEFAULT), SORT_DEFAULT))<BR><BR>#define LOCALE_CUSTOM_UI_DEFAULT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; \<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (MAKELCID(MAKELANGID(LANG_NEUTRAL, SUBLANG_UI_CUSTOM_DEFAULT), SORT_DEFAULT))</STRONG></FONT></P></BLOCKQUOTE>
<P mce_keep="true">Both of these values: LOCALE_CUSTOM_DEFAULT (a.k.a. 0x00000c000) and LOCALE_CUSTOM_UI_DEFAULT (a.k.a. 0x00001400) are kind of dumb-seeming, as any time they are valid you can get the same data back and the same locale used by asking for LOCALE_USER_DEFAULT or querying for the user default UI language via a call to <A class="" href="http://msdn2.microsoft.com/library/ms776286.aspx" mce_href="http://msdn2.microsoft.com/library/ms776286.aspx">GetUserDefaultUILanguage</A>. </P>
<P mce_keep="true">So why do they exist?</P>
<P mce_keep="true">Well that way a call to <A class="" href="http://msdn2.microsoft.com/library/ms776286.aspx" mce_href="http://msdn2.microsoft.com/library/ms776286.aspx">GetUserDefaultUILanguage</A>&nbsp;or <A class="" href="http://msdn2.microsoft.com/library/ms776244.aspx" mce_href="http://msdn2.microsoft.com/library/ms776244.aspx">GetUserDefaultLCID</A> has some value to return, a value that can be passed to LCID&nbsp;taking functions and still actually do something useful.</P>
<P mce_keep="true">Fair enough.</P>
<P mce_keep="true">So now, to get back to keyboards for a moment, all of the above is fine and dandy, but the real question that all of this is able to inspire is simple -- <STRONG>why do custom keyboards with custom language all use 0x0c00 as their LANGID value?</STRONG></P>
<P mce_keep="true">This is after all the value for LOCALE_CUSTOM_DEFAULT, which is not the LCID value of the custom culture that MSKLC lets you pick to work from a custom culture, and it is pretty guaranteed to not return correct data.</P>
<P mce_keep="true">The answer is&nbsp;simple&nbsp;enough -- most people take the HKL value they get back from <A class="" href="http://msdn2.microsoft.com/library/ms646305.aspx" mce_href="http://msdn2.microsoft.com/library/ms646305.aspx">LoadKeyboardLayout</A> or <A class="" href="http://msdn2.microsoft.com/library/ms646289.aspx" mce_href="http://msdn2.microsoft.com/library/ms646289.aspx">ActivateKeyboardLayout</A>, call the <A class="" href="http://msdn2.microsoft.com/library/ms632659.aspx" mce_href="http://msdn2.microsoft.com/library/ms632659.aspx">LOWORD</A> macro to extract the LANGID value, and then use it.</P>
<P mce_keep="true">But the one advantage that both LOCALE_CUSTOM_DEFAULT and LOCALE_CUSTOM_UI_DEFAULT have over LOCALE_CUSTOM_UNSPECIFIED is that if you do pass them one of those other functions, the other function will likely still be able to work. Even if the value is probably going to be wrong sometimes.</P>
<P mce_keep="true">Now this is yet another of those decisions that another group made (in this case the Language Bar/Text Services Framework people), as i kind of&nbsp;oscillate between occasionally thinking this decision was brilliant, occasionally thinking is was awful/terrible, and usually falling somewhere in between.</P>
<P mce_keep="true">The real answer is to use names rather than LANGID values, and with the architecture info described in <A class="" href="http://archives.miloush.net/michkap/archive/2007/08/23/4535058.html" mce_href="http://archives.miloush.net/michkap/archive/2007/08/23/4535058.html"><STRONG>Getting the language (and more!) of an LCID-less keyboard</STRONG></A>, adding a function to return this info in some future version of Windows would not be too terribly hard to do. </P>
<P mce_keep="true">But since some value had to be returned, and ideally it should not be a value that breaks the myriad of <A class="" href="http://msdn2.microsoft.com/library/ms632659.aspx" mce_href="http://msdn2.microsoft.com/library/ms632659.aspx">LOWORD</A>(<A class="" href="http://msdn2.microsoft.com/library/ms646296.aspx" mce_href="http://msdn2.microsoft.com/library/ms646296.aspx">GetKeyboardLayout</A>(0)) callers out there. So now we have 0x0c00 as the LANGID that in the NLS world means "custom user default" and in the keyboarding world means "any custom language whatsoever"....</P>
<P mce_keep="true">&nbsp;</P>
<P mce_keep="true"><FONT color=#ff00ff><EM>This post brought to you by</EM> <FONT size=5>âˆ«</FONT> <EM>(<A class="" href="http://www.fileformat.info/info/unicode/char/222b" mce_href="http://www.fileformat.info/info/unicode/char/222b">U+222b</A>, a.k.a. INTEGRAL)</EM></FONT></P>
<hr/><p><strong>Ivan Petrov</strong> on 2 Sep 2007 5:29 PM:</p><div style="margin-left: 1em"><p>Hi Michael,</p>
<p>Did the Language Bar/Text Services Framework people have their own blog or someone working in that group his own blog, like you?</p>
<p>Regards,</p>
<p>Ivan.</p></div>
<p><strong>Eric C Brown</strong> on 3 Oct 2007 2:30 PM:</p><div style="margin-left: 1em"><p>I have a Text Services Framework related blog (linked), but I don't actually work in that group - I work on speech &amp; dictation, but I spend a lot of time working with Text Services Framework.</p>
</div>
<hr/><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2007/09/02/4712047.html" title="Acronyms vs. initialisms, across languages">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2007/09/01/4696229.html" title="There is no function to return the culturally sensitive length of time before the duration functionality will be finished">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2007-09">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2007-09-02">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2007/09/02/4701403.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:37 GMT -->
</html>