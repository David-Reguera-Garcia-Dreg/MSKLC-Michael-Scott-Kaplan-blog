<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2007/09/17/4950008.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:37 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>A&P of Sort Keys, part 7 (aka You're very thin now, but I can still recognize you)</title></head><body>
<h1>A&P of Sort Keys, part 7 (aka You're very thin now, but I can still recognize you)</h1>
<p><em>by Michael S. Kaplan, published on 2007/09/17 03:31 -04:00, original URI: http://blogs.msdn.com/b/michkap/archive/2007/09/17/4950008.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostNew -->
<P>Previous posts in this series:</P>
<UL>
<LI>Part 0: <STRONG><A class="" href="http://archives.miloush.net/michkap/archive/2007/09/10/4847780.html" mce_href="http://archives.miloush.net/michkap/archive/2007/09/10/4847780.html">The empty string sorts the same in every language</A></STRONG> 
<LI>Part 1: <STRONG><A class="" href="http://archives.miloush.net/michkap/archive/2007/09/11/4861436.html" mce_href="http://archives.miloush.net/michkap/archive/2007/09/11/4861436.html">The law of the letter -- e.g. Latin &lt; Greek &lt; Cyrillic</A></STRONG> 
<LI>Part 2: <A class="" href="http://archives.miloush.net/michkap/archive/2007/09/12/4875560.html" mce_href="http://archives.miloush.net/michkap/archive/2007/09/12/4875560.html"><STRONG>The string that won? Didn't have a mark on him!</STRONG></A> 
<LI>Part 3: <A class="" href="http://archives.miloush.net/michkap/archive/2007/09/13/4889199.html" mce_href="http://archives.miloush.net/michkap/archive/2007/09/13/4889199.html"><STRONG>Should you let a string make it's case? If so, Y?</STRONG></A> 
<LI>Part 4: <A class="" href="http://archives.miloush.net/michkap/archive/2007/09/14/4905625.html" mce_href="http://archives.miloush.net/michkap/archive/2007/09/14/4905625.html"><STRONG>It isn't a race but let's make an EXCEPTION and cross the Finnish line</STRONG></A> 
<LI>Part 5: <A class="" href="http://archives.miloush.net/michkap/archive/2007/09/15/4924008.html" mce_href="http://archives.miloush.net/michkap/archive/2007/09/15/4924008.html"><STRONG>EXPANSIONing your horizons</STRONG></A></LI>
<LI>Part 6: <A class="" href="http://archives.miloush.net/michkap/archive/2007/09/16/4937196.html" mce_href="http://archives.miloush.net/michkap/archive/2007/09/16/4937196.html"><STRONG>Relax, be calm, and deCOMPRESS if you are feeling out of sorts</STRONG></A></LI></UL>
<P>Here at Microsoft, there are a whole bunch of people who do the 20/20 program to help them lose a lot of weight. And a lot of people finish up the program a <STRONG>lot</STRONG> thinner than when they started. Of course even if you become tons thinner you are still the same person (it is almost like one of those Comcast phone service commercials everyone hates!), and&nbsp;everyone can still recognize you. It is to all the people I know who have gone through that this post in the series is dedicated to....</P>
<P>Prior to Unicode, the concept if the <STRONG>width</STRONG> of a character was in at least the sense of amount of space needed to store the character, pretty fundamental -- wide characters took literally twice as much space to store as their narrower counterparts (1 byte vs. 2&nbsp; bytes).</P>
<P>Now over time the difference also tended to show visual distinction as well, thus </P>
<BLOCKQUOTE>
<P><FONT face="Gulim,SimSun,MingLiU,MS Gothic" size=5>ＡＢＣＤＥＦＧＨＩＪＫＬＭＮＯＰＱＲＳＴＵＶＷＸＹＺ</FONT></P></BLOCKQUOTE>
<P>would be about twice as wide (if the same font was used) as&nbsp;</P>
<BLOCKQUOTE>
<P><FONT face="Gulim,SimSun,MingLiU,MS Gothic" size=5>ABCDEFGHIJKLMNOPQRSTUVWXYZ</FONT></P></BLOCKQUOTE>
<P>Though of course the magic of font linking can make the two look less distinct depending on you browser and OS language settings. :-)</P>
<P>Now although the two sets of characters are far apart in Unicode, no one ever expected anyone to not sort them together -- there is something fundamentally A-like<FONT size=1><SUP>1</SUP></FONT> about both <STRONG>Ａ</STRONG> and <STRONG>A</STRONG>, and there are very good reasons to expect both of them to sort before <STRONG>B</STRONG>.</P>
<P>But obviously they are not completely equivalent to each other.</P>
<P>And thus the notion of character width was brought to sorting -- it used to (but no longer) affects the storage size, it still affects fonts if you use the same font, and affects collation in regards to the "width" piece of the sort weight.</P>
<P>Our sample strings are just going to be plain old ASCII compared to the fullwidth versions of the same characters (future posts will get into Korean, Japanese, and Chinese examples that also deal with width, never fear!).</P>
<P>You can choose to ignore width differences via the NORM_IGNOREWIDTH flag, which literally just removes the bit on the sort key that indicates the character is full width. This has the additional benefit of shrinking sort key size if wide characters are there.</P>
<P>Also, generally speaking, in some cases but not all we tend to move the full width versions of characters when the half-width versions are moved -- as the examples below will show. There is some debate as to whether what we do here is in fact correct, since the main difference between them in the eyes of most people is display, and thus they are either not used in a language or are used in some way that the correct sorting behavior would be expected. </P>
<P>I tend to believe that what we do is incorrect any time we don't move them (in other words I believe moving is the correct thing to do), but no one is really complaining loudly enough at this point to make the change worthwhile. It is a similar point to whether one should move every letter with a particular base if one moves the base, and I am inclined to think we ought to, consistently.</P>
<P>I'll show examples where it gets weird just so you see what I am talking about....</P>
<P>And here are&nbsp;some samples:</P>
<BLOCKQUOTE>
<P mce_keep="true"><FONT face="consolas,lucida console,courier new,courier"><B><A class="" href="http://www.fileformat.info/info/unicode/char/ff21" mce_href="http://www.fileformat.info/info/unicode/char/ff21">U+ff21</A>&nbsp; Ａ &nbsp;<FONT color=#009900>0e 02</FONT> 01 01 <FONT color=#0000ff>13</FONT> 01 01 00<BR><A class="" href="http://www.fileformat.info/info/unicode/char/ff41" mce_href="http://www.fileformat.info/info/unicode/char/ff41">U+ff41</A>&nbsp; ａ&nbsp; <FONT color=#009900>0e 02</FONT> 01 01 <FONT color=#0000ff>03</FONT> 01 01 00<BR><A class="" href="http://www.fileformat.info/info/unicode/char/ff21" mce_href="http://www.fileformat.info/info/unicode/char/ff21">U+ff21</A>&nbsp; Ａ &nbsp;<FONT color=#009900>0e 02</FONT> 01 01 <FONT color=#0000ff>12</FONT> 01 01 00&nbsp;&nbsp; (w/NORM_IGNOREWIDTH)<BR><A class="" href="http://www.fileformat.info/info/unicode/char/ff21" mce_href="http://www.fileformat.info/info/unicode/char/ff21">U+ff21</A>&nbsp; Ａ&nbsp; <FONT color=#009900>0e 02</FONT> 01 01&nbsp;<FONT color=#0000ff>03</FONT> 01 01 00&nbsp;&nbsp; (w/NORM_IGNORECASE)<BR><A class="" href="http://www.fileformat.info/info/unicode/char/0041" mce_href="http://www.fileformat.info/info/unicode/char/0041">U+0041</A>&nbsp; A&nbsp; &nbsp;<FONT color=#009900>0e 02 </FONT>01 01 <FONT color=#0000ff>12</FONT> 01 01 00</B></FONT></P></BLOCKQUOTE>
<P mce_keep="true">Now&nbsp;a few things are immediately obvious -- like that WIDTH is stored in the CASE weight, but NORM_IGNORECASE has no effect on it. And also that it just adds <STRONG>01</STRONG> to the case weight any place one has a full width character.</P>
<P mce_keep="true">How about with different languages? Well here is a Danish example:</P>
<BLOCKQUOTE><FONT face="consolas,lucida console,courier new,courier"><FONT face=Arial><STRONG><FONT face=Consolas>en-US <A class="" href="http://www.fileformat.info/info/unicode/char/ff21" mce_href="http://www.fileformat.info/info/unicode/char/ff21">U+ff21</A> <A class="" href="http://www.fileformat.info/info/unicode/char/ff21" mce_href="http://www.fileformat.info/info/unicode/char/ff21">U+ff21</A>&nbsp; ＡＡ&nbsp; </FONT></STRONG></FONT><STRONG><FONT color=#009900>0e 02 0e 02</FONT> 01 01 <FONT color=#0000ff>13 13</FONT> 01 01 00<BR>en-US <A class="" href="http://www.fileformat.info/info/unicode/char/0041" mce_href="http://www.fileformat.info/info/unicode/char/0041">U+0041</A> <A class="" href="http://www.fileformat.info/info/unicode/char/0041" mce_href="http://www.fileformat.info/info/unicode/char/0041">U+0041</A>&nbsp; AA&nbsp;&nbsp;&nbsp; <FONT color=#009900>0e 02 0e 02</FONT> 01 01 <FONT color=#0000ff>12 12</FONT> 01 01 00<BR>da-DK <A class="" href="http://www.fileformat.info/info/unicode/char/ff21" mce_href="http://www.fileformat.info/info/unicode/char/ff21">U+ff21</A> <A class="" href="http://www.fileformat.info/info/unicode/char/ff21" mce_href="http://www.fileformat.info/info/unicode/char/ff21">U+ff21</A>&nbsp; ＡＡ &nbsp;<FONT color=#009900>0e 02 0e 02</FONT> 01 01 <FONT color=#0000ff>13 13</FONT> 01 01 00<BR>da-DK <A class="" href="http://www.fileformat.info/info/unicode/char/0041" mce_href="http://www.fileformat.info/info/unicode/char/0041">U+0041</A> <A class="" href="http://www.fileformat.info/info/unicode/char/0041" mce_href="http://www.fileformat.info/info/unicode/char/0041">U+0041</A>&nbsp; AA&nbsp;&nbsp;&nbsp; <FONT color=#009900>0e b1</FONT> 01 <FONT color=#ff0000>03</FONT> 01 <FONT color=#0000ff>1a</FONT> 01 01 00</STRONG></FONT></BLOCKQUOTE>
<P mce_keep="true">And here is a Lithuanian example:</P>
<BLOCKQUOTE><FONT face="consolas,lucida console,courier new,courier"><B>
<P mce_keep="true">en-US <A class="" href="http://www.fileformat.info/info/unicode/char/ff29" mce_href="http://www.fileformat.info/info/unicode/char/ff29">U+ff29</A>&nbsp; Ｉ &nbsp;<FONT color=#009900>0e 32</FONT> 01 01 <FONT color=#0000ff>13</FONT> 01 01 00<BR>en-US <A class="" href="http://www.fileformat.info/info/unicode/char/0069" mce_href="http://www.fileformat.info/info/unicode/char/0069">U+0069</A>&nbsp; I&nbsp;&nbsp; <FONT color=#009900>0e 32</FONT> 01 01 <FONT color=#0000ff>12</FONT> 01 01 00<BR>en-US <A class="" href="http://www.fileformat.info/info/unicode/char/ff38" mce_href="http://www.fileformat.info/info/unicode/char/ff38">U+ff38</A>&nbsp; Ｘ &nbsp;<FONT color=#009900>0e a6</FONT> 01 01 <FONT color=#0000ff>13</FONT> 01 01 00<BR>en-US <A class="" href="http://www.fileformat.info/info/unicode/char/0058" mce_href="http://www.fileformat.info/info/unicode/char/0058">U+0058</A>&nbsp; X&nbsp;&nbsp; <FONT color=#009900>0e a6</FONT> 01 01 <FONT color=#0000ff>12</FONT> 01 01 00<BR>en-US <A class="" href="http://www.fileformat.info/info/unicode/char/ff39" mce_href="http://www.fileformat.info/info/unicode/char/ff39">U+ff39</A>&nbsp; Ｙ &nbsp;<FONT color=#009900>0e a7</FONT> 01 01 <FONT color=#0000ff>13</FONT> 01 01 00<BR>en-US <A class="" href="http://www.fileformat.info/info/unicode/char/0059" mce_href="http://www.fileformat.info/info/unicode/char/0059">U+0059</A>&nbsp; Y&nbsp;&nbsp; <FONT color=#009900>0e a7</FONT> 01 01 <FONT color=#0000ff>12</FONT> 01 01 00<BR>lt-LT <A class="" href="http://www.fileformat.info/info/unicode/char/ff29" mce_href="http://www.fileformat.info/info/unicode/char/ff29">U+ff29</A>&nbsp; Ｉ &nbsp;<FONT color=#009900>0e 32</FONT> 01 01 <FONT color=#0000ff>13</FONT> 01 01 00<BR>lt-LT <A class="" href="http://www.fileformat.info/info/unicode/char/0069" mce_href="http://www.fileformat.info/info/unicode/char/0069">U+0069</A>&nbsp; I&nbsp;&nbsp; <FONT color=#009900>0e 32</FONT> 01 01 <FONT color=#0000ff>12</FONT> 01 01 00<BR>lt-LT <A class="" href="http://www.fileformat.info/info/unicode/char/ff38" mce_href="http://www.fileformat.info/info/unicode/char/ff38">U+ff38</A>&nbsp; Ｘ &nbsp;<FONT color=#009900>0e a6</FONT> 01 01 <FONT color=#0000ff>13</FONT> 01 01 00<BR>lt-LT <A class="" href="http://www.fileformat.info/info/unicode/char/0058" mce_href="http://www.fileformat.info/info/unicode/char/0058">U+0058</A>&nbsp; X&nbsp;&nbsp; <FONT color=#009900>0e a6</FONT> 01 01 <FONT color=#0000ff>12</FONT> 01 01 00<BR>lt-LT <A class="" href="http://www.fileformat.info/info/unicode/char/ff39" mce_href="http://www.fileformat.info/info/unicode/char/ff39">U+ff39</A>&nbsp; Ｙ &nbsp;<FONT color=#009900>0e 33</FONT> 01 01 <FONT color=#0000ff>13</FONT> 01 01 00<BR>lt-LT <A class="" href="http://www.fileformat.info/info/unicode/char/0059" mce_href="http://www.fileformat.info/info/unicode/char/0059">U+0059</A>&nbsp; Y&nbsp;&nbsp; <FONT color=#009900>0e 33</FONT> 01 01 <FONT color=#0000ff>12</FONT> 01 01 00</P></B></FONT></BLOCKQUOTE>
<P mce_keep="true">See how in the case of Lithuanian the <STRONG>Y-like</STRONG> characters were moved including the fullwidth ones, while for Danish they were not?</P>
<P mce_keep="true">Now I know this is part of a bigger philosophical issue of what to do with letters that are generally not used in a language but which look a bit or more than a bit like ones that are.In general whether it comes to width, diacritic, or alternate case forms we have no consistent story -- some we move and some we do not.</P>
<P mce_keep="true">Is it a bug? Well, maybe not, but it seems like it ought to be, since we kind of halfway do it. I doubt that the fullwidth Y moving was done at the behest of the Lithuanian Microsoft subsidiary. :-)</P>
<P mce_keep="true">&nbsp;</P>
<P><EM><FONT size=1>1 - I have been encouraged to stop using the term A-ness in public to avoid what I will henceforth refer to as the 'Beavis Effect', preferring instead the term A-like.</FONT></EM></P>
<P><EM></EM>&nbsp;</P>
<P><FONT color=#ff00ff><EM>This post brought to you by</EM> <FONT size=5>6</FONT> <EM>and</EM>&nbsp;<FONT size=5>7</FONT> <EM>(<A class="" href="http://www.fileformat.info/info/unicode/char/0036" mce_href="http://www.fileformat.info/info/unicode/char/0036">U+0036</A> and <A class="" href="http://www.fileformat.info/info/unicode/char/0037" mce_href="http://www.fileformat.info/info/unicode/char/0037">U+0037</A>, a.k.a. DIGIT SIX and DIGIT SEVEN)</EM></FONT></P>
<hr/><div style="margin-left: 1em"><em>no comments</em></div><hr/><p><em>referenced by</em></p><div style="margin-left: 1em"><p>2010/02/17 <a href="http://archives.miloush.net/michkap/archive/2010/02/17/9964066.html">Knock knock! Who's there? Kana! Kana Who? I Kana got something wrong!</a></p><p>2008/08/21 <a href="http://archives.miloush.net/michkap/archive/2008/08/21/8883467.html">A&P of Sort Keys, part 14: The Hangul is really getting OLD</a></p><p>2007/10/09 <a href="http://archives.miloush.net/michkap/archive/2007/10/09/5375754.html">A&P of Sort Keys, part 13 (About the function that is too lazy to get it right every time)</a></p><p>2007/10/08 <a href="http://archives.miloush.net/michkap/archive/2007/10/08/5270854.html">A&P of Sort Keys, part 12 (aka Han sorts first!)</a></p><p>2007/09/24 <a href="http://archives.miloush.net/michkap/archive/2007/09/24/5085893.html">A&P of Sort Keys, part 11 (aka It's not like ideographic sorts were developed idiopathically)</a></p><p>2007/09/21 <a href="http://archives.miloush.net/michkap/archive/2007/09/21/5027338.html">A&P of Sort Keys, part 10 (aka I've kana wanted to start talking about Japanese)</a></p><p>2007/09/20 <a href="http://archives.miloush.net/michkap/archive/2007/09/20/5008305.html">A&P of Sort Keys, part 9 (aka Not always transitive, but punctual and punctuating)</a></p><p>2007/09/18 <a href="http://archives.miloush.net/michkap/archive/2007/09/18/4971376.html">A&P of Sort Keys, part 8 (aka You can often think of ignoring weights as a form of ignorance)</a></p></div><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2007/09/17/4950277.html" title="The torrents of U+fffd (aka When security and conformance trump compatibility and reality)">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2007/09/16/4942873.html" title="That&#39;s not German, is it? (aka This kind of thing happens a lot...)">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2007-09">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2007-09-17">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2007/09/17/4950008.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:37 GMT -->
</html>