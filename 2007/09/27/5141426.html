<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2007/09/27/5141426.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:37 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>Wouldn't you bet, Fret (aka You've got 50 ways to fix your characters)</title></head><body>
<h1>Wouldn't you bet, Fret (aka You've got 50 ways to fix your characters)</h1>
<p><em>by Michael S. Kaplan, published on 2007/09/27 03:31 -04:00, original URI: http://blogs.msdn.com/b/michkap/archive/2007/09/27/5141426.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostNew -->
<P>Via the Contact link, 'Fret' comments:</P>
<BLOCKQUOTE><FONT face="times new roman,times" size=2>
<P><EM>I've been debugging why my app doesn't accept 0x0218 and 0x021B characters from the keyboard on Vista.<BR><BR>You say it's not a windows bug. What I'm seeing in the debugger is that first I get a WM_KEYDOWN, which I translate to 0x0218 via ToUnicode and then after that I get a WM_CHAR, and the wParam is 0x003f, where is where our question mark comes from. So I'm thinking that windows is trying to convert the WM_KEYDOWN into a WM_CHAR and failing because it's not in the ANSI codepage? Applications that process just the WM_KEYDOWN work properly, but if you happen to like processing WM_CHAR's then your out of luck.<BR><BR>At least thats what I think is going on. I could be wrong.<BR><BR>I'm seriously considering rewriting my apps so they don't use WM_CHAR at all. But maybe that is overkill and there are less drastic fixes available.<BR><BR>Regards</EM></P></FONT></BLOCKQUOTE>
<P>No need to fret, er... Fret!&nbsp;</P>
<P>Of course it isn't a Windows bug, and you definitely do not have to stop processing <A class="" href="http://msdn2.microsoft.com/library/ms646276.aspx" mce_href="http://msdn2.microsoft.com/library/ms646276.aspx">WM_CHAR</A> notifications and move processing to <A class="" href="http://msdn2.microsoft.com/library/ms646280.aspx" mce_href="http://msdn2.microsoft.com/library/ms646280.aspx">WM_KEYDOWN</A>.</P>
<P>All you have to do is compile your applications to use UNICODE/_UNICODE, and then you won't see everything being converted out of Unicode and into a code missing the characters you want to use.</P>
<P>Now if you really don't want the applications to support Unicode then you are out of luck a little and have to go to those extreme measures (I say extreme since you either have to define the mappings yourself or you have to still call a bunch of Unicode keyboarding functions within your non-Unicode applications to be able to query what characters the keystrokes map to -- a painful fallback plan, all things considered....</P>
<P>It is one of the reasons that the issues in <A class="" href="http://archives.miloush.net/michkap/archive/2007/05/01/2367135.html" mce_href="http://archives.miloush.net/michkap/archive/2007/05/01/2367135.html"><STRONG>Not everyone does the right thing for Romanian</STRONG></A>&nbsp;are so painful and why the moves in usage from</P>
<UL>
<LI><FONT face=tahoma,arial,helvetica,sans-serif>ş (</FONT><A class="" href="http://www.fileformat.info/info/unicode/char/015f" mce_href="http://www.fileformat.info/info/unicode/char/015f">U+015f</A>, LATIN SMALL LETTER S WITH CEDILLA) to <FONT face=tahoma,arial,helvetica,sans-serif>ș </FONT>(<A class="" href="http://www.fileformat.info/info/unicode/char/0219" mce_href="http://www.fileformat.info/info/unicode/char/0219">U+0219</A>, LATIN SMALL LETTER S WITH COMMA BELOW)</FONT></LI>
<LI><FONT face=tahoma,arial,helvetica,sans-serif>Ş (<A class="" href="http://www.fileformat.info/info/unicode/char/015e" mce_href="http://www.fileformat.info/info/unicode/char/015e">U+015e</A>, LATIN CAPITAL LETTER S WITH CEDILLA) to <FONT face=tahoma,arial,helvetica,sans-serif>Ș </FONT>(<A class="" href="http://www.fileformat.info/info/unicode/char/0218" mce_href="http://www.fileformat.info/info/unicode/char/0218">U+0218</A>, LATIN CAPITAL LETTER S WITH COMMA BELOW)</FONT> </LI>
<LI><FONT face=tahoma,arial,helvetica,sans-serif>ţ </FONT>(<A class="" href="http://www.fileformat.info/info/unicode/char/0163" mce_href="http://www.fileformat.info/info/unicode/char/0163">U+0163</A>, LATIN SMALL LETTER T WITH CEDILLA) to <FONT face=tahoma,arial,helvetica,sans-serif>ț </FONT>(<A class="" href="http://www.fileformat.info/info/unicode/char/021b" mce_href="http://www.fileformat.info/info/unicode/char/021b">U+021b</A>, LATIN SMALL LETTER T WITH COMMA BELOW)&nbsp; </LI>
<LI><FONT face=tahoma,arial,helvetica,sans-serif>Ţ </FONT>(<A class="" href="http://www.fileformat.info/info/unicode/char/0162" mce_href="http://www.fileformat.info/info/unicode/char/0162">U+0162</A>, LATIN CAPITAL LETTER T WITH CEDILLA) to <FONT face=tahoma,arial,helvetica,sans-serif>Ț </FONT>(<A class="" href="http://www.fileformat.info/info/unicode/char/021a" mce_href="http://www.fileformat.info/info/unicode/char/021a">U+021a</A>, LATIN CAPITAL LETTER T WITH COMMA BELOW) </LI></UL>
<P>have problems for so many applications that were never moved to Unicode since people figured they never had to make the move....</P>
<P>So moving the fonts and the keyboards to use the newer characters due to the linguistic pressure but not putting that same pressure on the applications is bound to lead us to where we are now. </P>
<P>It is time to fix those applications!</P>
<P>In the end, people in Romania are as unlikely to speak fluent question mark (which is that handy 0x3F that Fret is seeing) as anyone else in the world,which is why it is unfortunate that there are so many common applications out there that still aren't doing the right thing in regard to Unicode....</P>
<P mce_keep="true">&nbsp;</P>
<P><FONT color=#ff00ff><EM>This post brought to you by</EM> <FONT size=5>?</FONT> <EM>(<A class="" href="http://www.fileformat.info/info/unicode/char/003f" mce_href="http://www.fileformat.info/info/unicode/char/003f">U+003f</A>, a.k.a. QUESTION MARK)</EM></FONT></P>
<hr/><p><a id="5169452" href="#5169452">#</a> <strong>Aaron Ballman</strong> on 27 Sep 2007 11:26 AM:</p><div style="margin-left: 1em"><p>I ran into this issue myself (back when our application had to have a single binary to support Windows 98 and up), and the issue turned out to be the fact we were using Unicode in most places (such as defining the window and within the WndProc), with an accidental ANSI call to GetMessage/DispatchMethod in our mesage pump.</p>
<p>I am so happy we changed our requirements to Win2k and up so this sort of weirdness doesn't happen anymore! &nbsp;;-)</p>
</div>
<p><a id="5171391" href="#5171391">#</a> <strong>Mihai</strong> on 27 Sep 2007 1:48 PM:</p><div style="margin-left: 1em"><p>Although Windows might try and convert the WM_CHAR Unicode to ANSI using best fit. Then U+0219 would be converted to 0xBA cp1250 (U+015F).</p>
<p>But well ...</p>
<p>Sometime I wish that some change of change that requires Unicode would badly break English functionality :-)</p>
<p>Everybody will be unhappy for a while, move to Unicode, but in the end we will be in a better state.</p>
<p>Just be patient, everybody will be Unicode sooner or later (right after U.S. finally adopts the metric system :-)</p></div>
<p><a id="5171470" href="#5171470">#</a> <strong>Michael S. Kaplan</strong> on 27 Sep 2007 1:54 PM:</p><div style="margin-left: 1em"><p>The only way to do that would be to change the code page to add new best fit mappings, which we cannot do for stability reasons....</p>
</div>
<p><a id="5171652" href="#5171652">#</a> <strong>Aaron Ballman</strong> on 27 Sep 2007 2:07 PM:</p><div style="margin-left: 1em"><p>&quot;Just be patient, everybody will be Unicode sooner or later (right after U.S. finally adopts the metric system :-)&quot;</p>
<p>Don't forget about converting everyone in Liberia and Myanmar too. &nbsp;;-)</p>
</div>
<hr/><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2007/09/28/5178248.html" title="Upgrade no machine[ to Vista] before its (or your) time">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2007/09/27/5132462.html" title="Don&#39;t look directly at the 951 code page if you can avoid it">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2007-09">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2007-09-27">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2007/09/27/5141426.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:37 GMT -->
</html>