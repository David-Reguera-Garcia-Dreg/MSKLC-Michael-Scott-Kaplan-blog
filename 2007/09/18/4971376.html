<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2007/09/18/4971376.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:37 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>A&P of Sort Keys, part 8 (aka You can often think of ignoring weights as a form of ignorance)</title></head><body>
<h1>A&P of Sort Keys, part 8 (aka You can often think of ignoring weights as a form of ignorance)</h1>
<p><em>by Michael S. Kaplan, published on 2007/09/18 03:01 -04:00, original URI: http://blogs.msdn.com/b/michkap/archive/2007/09/18/4971376.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostNew -->
<P>Previous posts in this series:</P>
<UL>
<LI>Part 0: <STRONG><A class="" href="http://archives.miloush.net/michkap/archive/2007/09/10/4847780.html" mce_href="http://archives.miloush.net/michkap/archive/2007/09/10/4847780.html">The empty string sorts the same in every language</A></STRONG> 
<LI>Part 1: <STRONG><A class="" href="http://archives.miloush.net/michkap/archive/2007/09/11/4861436.html" mce_href="http://archives.miloush.net/michkap/archive/2007/09/11/4861436.html">The law of the letter -- e.g. Latin &lt; Greek &lt; Cyrillic</A></STRONG> 
<LI>Part 2: <A class="" href="http://archives.miloush.net/michkap/archive/2007/09/12/4875560.html" mce_href="http://archives.miloush.net/michkap/archive/2007/09/12/4875560.html"><STRONG>The string that won? Didn't have a mark on him!</STRONG></A> 
<LI>Part 3: <A class="" href="http://archives.miloush.net/michkap/archive/2007/09/13/4889199.html" mce_href="http://archives.miloush.net/michkap/archive/2007/09/13/4889199.html"><STRONG>Should you let a string make it's case? If so, Y?</STRONG></A> 
<LI>Part 4: <A class="" href="http://archives.miloush.net/michkap/archive/2007/09/14/4905625.html" mce_href="http://archives.miloush.net/michkap/archive/2007/09/14/4905625.html"><STRONG>It isn't a race but let's make an EXCEPTION and cross the Finnish line</STRONG></A> 
<LI>Part 5: <A class="" href="http://archives.miloush.net/michkap/archive/2007/09/15/4924008.html" mce_href="http://archives.miloush.net/michkap/archive/2007/09/15/4924008.html"><STRONG>EXPANSIONing your horizons</STRONG></A> 
<LI>Part 6: <A class="" href="http://archives.miloush.net/michkap/archive/2007/09/16/4937196.html" mce_href="http://archives.miloush.net/michkap/archive/2007/09/16/4937196.html"><STRONG>Relax, be calm, and deCOMPRESS if you are feeling out of sorts</STRONG></A></LI>
<LI>Part 7: <A class="" href="http://archives.miloush.net/michkap/archive/2007/09/17/4950008.html" mce_href="http://archives.miloush.net/michkap/archive/2007/09/17/4950008.html"><STRONG>You're very thin now, but I can still recognize you</STRONG></A></LI></UL>
<P>You should think of Part 8 as kind of a seventh inning stretch in this series, where I sit back and you sit back and I impart some of the wisdom I have acquired over the years I have used, worked on, owned, and then assisted with as a "developer emeritus" the collation functionality in Windows.</P>
<P>I'm also going to take potshots at some product designs, mainly pointing at a single Microsoft product when in reality it applies to many MS and non-MS products....</P>
<P>Feel free to disregard it</P>
<P>Feel free to disagree with it.</P>
<P>But don't skip reading it, because I am right. :-)</P>
<P>The issue is one that causes&nbsp;at least half&nbsp;of the possible collation operations done in products like SQL Server to be wrong.</P>
<P>It&nbsp;is one I have discussed previously, in posts like <A class="" href="http://archives.miloush.net/michkap/archive/2006/04/29/586726.html" mce_href="http://archives.miloush.net/michkap/archive/2006/04/29/586726.html"><STRONG>'Which comes first?' vs. 'Are they equal?'</STRONG></A>.</P>
<P>The central problem is that IGNORING WEIGHTS in ordering decisions is just plain ignorant.</P>
<P>Just like I pointed out how <A class="" href="http://archives.miloush.net/michkap/archive/2007/06/18/3374502.html" mce_href="http://archives.miloush.net/michkap/archive/2007/06/18/3374502.html"><STRONG>If you don't always preserve case, you don't always preserve meaning</STRONG></A>, distinctions in the data should not be ignored, or folded away, or treated as un-needed. They are distinctions -- in case, in width, in diacritics, in Kana. When you order the data, you should keep those distinctions in mind, as ignoring them is requesting that the items be put in random, non-deterministic&nbsp;order.</P>
<P>In short, it is ignorant.</P>
<P>Of course, when doing identity checks, it can make sense to ignore distinctions. </P>
<P>Even when querying for a subset of the data, it can also make sense as an option.</P>
<P>Neither of those two uses is ignorant.</P>
<P>But ordering data (even the data that comes from that subset query) and ignoring distinctions is ignorant.</P>
<P>So why I was on picking on SQL Server a minute ago?</P>
<P>Well, I guess I am picking on most databases here, not just SQLS. Since most of them:</P>
<UL>
<LI>do not provide a good way to look at the data in these two distinct ways, or </LI>
<LI>they do provide them both they don't provide a way to do both operations in an indexed way, or </LI>
<LI>they do provide them both in an indexed way but the way is not intuitive and requires one to build two different indexes.</LI></UL>
<P>Let's ignore the IGNORANT nature of the first and second of those bullet points, since the reasons should pretty obvious.</P>
<P>And also they don't apply to SQL Server except perhaps in some earlier, lamer versions that came along when it was less of a product that it has managed to become.</P>
<P>Instead let's think about that third bullet point. </P>
<P>This one an my answer don't (strictly speaking) apply to SQL Server since they don't use our sort keys for their indexes (as I pointed out in <A class="" href="http://archives.miloush.net/michkap/archive/2005/03/11/394359.html" mce_href="http://archives.miloush.net/michkap/archive/2005/03/11/394359.html"><STRONG>When good SQL queries have trouble...</STRONG></A>), they build their own using their borrowed <A class="" href="http://msdn2.microsoft.com/library/ms647476.aspx" mce_href="http://msdn2.microsoft.com/library/ms647476.aspx">CompareString</A> call. Though you could always hold them responsible too if their solution does not allow what I am about to suggest. :-)</P>
<P>Now if you look back on that very first post, <A class="" href="http://archives.miloush.net/michkap/archive/2007/09/10/4847780.html" mce_href="http://archives.miloush.net/michkap/archive/2007/09/10/4847780.html"><STRONG>Part 0</STRONG></A>, where I gave how the sort key looked:</P>
<BLOCKQUOTE>
<P><STRONG><FONT face="Consolas,Lucida Console,Courier New,Courier" size=1><FONT color=#999966>[all Unicode sort weights]</FONT> 01 <FONT color=#999966>[all Diacritic weights]</FONT> 01 <FONT color=#999966>[all Case weights]</FONT> 01 <FONT color=#999966>[all Special weights]</FONT> 01 <FONT color=#999966>[Punctuation weights]</FONT> 00</FONT></STRONG></P></BLOCKQUOTE>
<P mce_keep="true">Passing NORM_IGNORENONSPACE or NORM_IGNOREWIDTH/NORM_IGNORECASE or NORM_IGNOREKANA is telling <A class="" href="http://msdn2.microsoft.com/library/ms776290.aspx" mce_href="http://msdn2.microsoft.com/library/ms776290.aspx">LCMapString</A>/<A class="" href="http://msdn2.microsoft.com/library/ms776387.aspx" mce_href="http://msdn2.microsoft.com/library/ms776387.aspx">LCMapStringEx</A> with the LCMAP_SORTKEY flag to basically take the <STRONG>diacritic</STRONG> or <STRONG>case</STRONG> or <STRONG>special</STRONG> weights and just skipping them.</P>
<P mce_keep="true">In other words, when you pass those flags, everything relevant between the appropriate <STRONG>01</STRONG> sentinels is removed.</P>
<P>Now if in SQL Server you use the method I talked about in <A class="" href="http://archives.miloush.net/michkap/archive/2005/05/06/415199.html" mce_href="http://archives.miloush.net/michkap/archive/2005/05/06/415199.html"><STRONG>Making SQL Server index usage a bit more deterministic</STRONG></A>, which&nbsp;is essentially the only way around the problem of supporting two different methods of indexing, you are STILL required to have&nbsp;separate indexes,&nbsp;even if one of the indexes is a literal and complete subset of another (i.e. an index that ignores case and diacritics vs. one that denies neither).</P>
<P>When there is a clear way to use the same index value and not create the huge space burden of mainly duplicated indexes via a non-intuitive and not very well documented syntax with no good user interface support?</P>
<P>Ignoring the multi-language issue for a moment (since those indexes are usually <EM>not</EM> subsets), providing an intuitive way to support the different views of the data for identity/subset vs. ordering operations via a single index is actually more work to decide how to expose the feature to customers then it would be to provide the technical solution....</P>
<P>Hmmm.... some features to think about for future versions, huh? :-)</P>
<P>On the other hand, they are still at least half a hundred collations behind Windows on the language side with some terrible defaults in the Unicode collation side, let alone providing proper results for scenarios that are only well-understood by regular readers of <A class="" href="http://archives.miloush.net/michkap/archive/tags/Collation_2F00_Casing/default.aspx" mce_href="../../../../archive/tags/Collation_2F00_Casing/default.aspx">collation/case posts</A> in this blog. So I don't think we're talking about <EM>next</EM> version here.</P>
<P>But one day, ignorance of collation can perhaps be cured in products....</P>
<P mce_keep="true">&nbsp;</P>
<P><FONT color=#ff00ff><EM>This post brought to you by</EM> <FONT size=5>8</FONT> <EM>(<A class="" href="http://www.fileformat.info/info/unicode/char/0038" mce_href="http://www.fileformat.info/info/unicode/char/0038">U+0038</A>, a.k.a. DIGIT EIGHT)</EM></FONT></P>
<hr/><div style="margin-left: 1em"><em>no comments</em></div><hr/><p><em>referenced by</em></p><div style="margin-left: 1em"><p>2008/08/21 <a href="http://archives.miloush.net/michkap/archive/2008/08/21/8883467.html">A&P of Sort Keys, part 14: The Hangul is really getting OLD</a></p><p>2007/10/09 <a href="http://archives.miloush.net/michkap/archive/2007/10/09/5375754.html">A&P of Sort Keys, part 13 (About the function that is too lazy to get it right every time)</a></p><p>2007/10/08 <a href="http://archives.miloush.net/michkap/archive/2007/10/08/5347670.html">Wanna take a look at the collation bug Kim pointed out? You're in for a hell of a Tripp!</a></p><p>2007/10/08 <a href="http://archives.miloush.net/michkap/archive/2007/10/08/5270854.html">A&P of Sort Keys, part 12 (aka Han sorts first!)</a></p><p>2007/09/24 <a href="http://archives.miloush.net/michkap/archive/2007/09/24/5085893.html">A&P of Sort Keys, part 11 (aka It's not like ideographic sorts were developed idiopathically)</a></p><p>2007/09/21 <a href="http://archives.miloush.net/michkap/archive/2007/09/21/5027338.html">A&P of Sort Keys, part 10 (aka I've kana wanted to start talking about Japanese)</a></p><p>2007/09/20 <a href="http://archives.miloush.net/michkap/archive/2007/09/20/5008305.html">A&P of Sort Keys, part 9 (aka Not always transitive, but punctual and punctuating)</a></p></div><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2007/09/18/4971899.html" title="Depending on when/where/who you ask, that character may not be your [c]type">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2007/09/17/4950277.html" title="The torrents of U+fffd (aka When security and conformance trump compatibility and reality)">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2007-09">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2007-09-18">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2007/09/18/4971376.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:37 GMT -->
</html>