<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2007/09/14/4905625.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:37 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>A&P of Sort Keys, part 4 (aka It isn't a race but let's make an EXCEPTION and cross the Finnish line)</title></head><body>
<h1>A&P of Sort Keys, part 4 (aka It isn't a race but let's make an EXCEPTION and cross the Finnish line)</h1>
<p><em>by Michael S. Kaplan, published on 2007/09/14 03:31 -04:00, original URI: http://blogs.msdn.com/b/michkap/archive/2007/09/14/4905625.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostNew -->
<P>Previous posts in this series:</P>
<UL>
<LI>Part 0: <STRONG><A class="" href="http://archives.miloush.net/michkap/archive/2007/09/10/4847780.html" mce_href="http://archives.miloush.net/michkap/archive/2007/09/10/4847780.html">The empty string sorts the same in every language</A></STRONG> 
<LI>Part 1: <STRONG><A class="" href="http://archives.miloush.net/michkap/archive/2007/09/11/4861436.html" mce_href="http://archives.miloush.net/michkap/archive/2007/09/11/4861436.html">The law of the letter -- e.g. Latin &lt; Greek &lt; Cyrillic</A></STRONG> 
<LI>Part 2: <A class="" href="http://archives.miloush.net/michkap/archive/2007/09/12/4875560.html" mce_href="http://archives.miloush.net/michkap/archive/2007/09/12/4875560.html"><STRONG>The string that won? Didn't have a mark on him!</STRONG></A></LI>
<LI>Part 3: <A class="" href="http://archives.miloush.net/michkap/archive/2007/09/13/4889199.html" mce_href="http://archives.miloush.net/michkap/archive/2007/09/13/4889199.html"><STRONG>Should you let a string make it's case? If so, Y?</STRONG></A></LI></UL>
<P>So far, I have been using the default table for every sort key.</P>
<P>And I don't want to knock the default table -- it is good enough for&nbsp;like 80 different locales on Vista.</P>
<P>But of course that does mean there are quite a few that it is not good enough for....</P>
<P>The way this works is simple&nbsp;-- every locale in Windows has a pointer to an EXCEPTION table, a pointer that for&nbsp;about 80&nbsp;of them is NULL. For the rest, it is a list of exceptions with the new weights that should be used....</P>
<P>Exceptions are very powerful -- just using the information we have so far:</P>
<UL>
<LI>A character that is weightless can be given weight;</LI>
<LI>A character with weight can be made weightless;</LI>
<LI>A character's place in the locale's "alphabetical order" can be moved;</LI>
<LI>A character's weight difference can be changed (primary to secondary or vice versa -- even case weight status can be changed though this is seldom done).</LI></UL>
<P>The net effect is the ability to handle the fact that every person in the world intuitively understands the meaning of <STRONG>alphabetical order</STRONG> even though many of those intuitions conflict with each other....</P>
<P>So looking at the weights of <STRONG>i</STRONG>, <STRONG>j</STRONG>, <STRONG>x</STRONG>, and <STRONG>y</STRONG> in English&nbsp;versus Lithuanian is:</P>
<BLOCKQUOTE>
<P><FONT face="consolas,lucida console,courier new,courier"><STRONG>en-US&nbsp; i &nbsp;0e <FONT color=#009900>32</FONT> 01 01 01 01 00<BR>en-US&nbsp; j &nbsp;0e <FONT color=#009900>35</FONT> 01 01 01 01 00<BR>en-US&nbsp; x &nbsp;0e <FONT color=#009900>a6</FONT> 01 01 01 01 00<BR>en-US&nbsp; y&nbsp; 0e&nbsp;<FONT color=#009900>a7</FONT> 01 01 01 01 00<BR><BR>lt-LT&nbsp; i&nbsp; 0e <FONT color=#009900>32</FONT> 01 01 01 01 00<BR>lt-LT&nbsp; j&nbsp; 0e <FONT color=#009900>35</FONT> 01 01 01 01 00<BR>lt-LT&nbsp; x&nbsp; 0e&nbsp;<FONT color=#009900>a6</FONT> 01 01 01 01 00<BR>lt-LT&nbsp; y&nbsp; 0e <FONT color=#009900>33</FONT> 01 01 01 01 00</STRONG></FONT> </P></BLOCKQUOTE>
<P>See how that <STRONG>y</STRONG> moved between the <STRONG>i</STRONG> and the <STRONG>j</STRONG> for Lithuanian? Just slid right into the space....</P>
<P>Or (to take another case), how about the <STRONG>w</STRONG> and the <STRONG>v</STRONG> in Finnish vs. English?</P>
<BLOCKQUOTE>
<P><FONT face="consolas,lucida console,courier new,courier"><STRONG>en-US&nbsp; v&nbsp; 00000409 0e <FONT color=#009900>a2</FONT> 01 01 01 01 00<BR>en-US&nbsp; w&nbsp; 00000409 0e <FONT color=#009900>a4</FONT> 01 01 01 01 00<BR>fi-FI&nbsp; v&nbsp; 0000041d 0e <FONT color=#009900>a2</FONT> 01 01 01 01 00<BR>fi-FI&nbsp; w&nbsp; 0000041d 0e <FONT color=#009900>a2</FONT> 01 <FONT color=#ff0000>03</FONT> 01 01 01 00</STRONG></FONT></P></BLOCKQUOTE>
<P>See how the <STRONG>w</STRONG> in Finnish moves to just have a secondary distinction? </P>
<P>The same thing could have been done in Swedish, but I figured since the Swedish Academy wants to see that change (as I pointed out <STRONG><A class="" href="http://archives.miloush.net/michkap/archive/2006/04/25/583307.html" mce_href="http://archives.miloush.net/michkap/archive/2006/04/25/583307.html">here</A></STRONG>)&nbsp;I won't go out of my way to show the behavior they want to see changed. :-)</P>
<P>As for moving in the other direction, I have shown this in the past in Polish vs. the default table in <STRONG><A class="" href="http://archives.miloush.net/michkap/archive/2005/02/05/367666.html" mce_href="http://archives.miloush.net/michkap/archive/2005/02/05/367666.html">You can't ignore diacritics when a language does not give them diacritic weight</A></STRONG>.</P>
<P>Microsoft has never yet made a character that had weight into something weightless by simply changing locales, but we have gone in the other direction on one occasion....</P>
<P>It was back in early 2005, I posted about it in <A class="" href="http://archives.miloush.net/michkap/archive/2005/02/02/365993.html" mce_href="http://archives.miloush.net/michkap/archive/2005/02/02/365993.html"><STRONG>Doing a little more in Sri Lanka</STRONG></A>. We were in difficult place since those Sinhalese characters <A class="" href="http://archives.miloush.net/michkap/archive/2005/01/18/355210.html" mce_href="http://archives.miloush.net/michkap/archive/2005/01/18/355210.html"><STRONG>had no weight</STRONG></A>, but Cathy Wissink and I were brainstorming since we knew we had to have some weights so that lists would be able to sort but couldn't figure out how to do it without breaking everything. Then&nbsp;one of us had a great idea&nbsp;(I cannot remember who, we both had a lot of bad ideas prior to this good one I am about to mention), wondering whether we could give these characters weight but only in the exception table, even if they had no weight in the default table.</P>
<P>It was a very novel idea for us, and one that had honestly never been done before in Windows. But it was being done in SQL Server (then in beta, I believe) as you moved between the older collations and the newer ones, with the same potential problems (if you switched your settings&nbsp;to an older collation,&nbsp;then some&nbsp;characters would suddenly not be able to be sorted). So in the end we did some testing to look at the behavior and after some review by us and others and some native speakers, we did it.</P>
<P>There was no backcompat issue since no existing&nbsp;locale's sort was changed, and given the fact that the people&nbsp;the patch was really intended for would be unlikely to be changing their user locale settings while still needing to sort the data (a fact we probably couldn't assume generically), we decided to go for it. Very unique circumstances, and we decided to make it less likely to be needed in the future by adding all of Unicode 5.0 in Vista (since the circumstances are unlikely to recur). But it is possible....</P>
<P>And now we kind of come to the end of the post, though there will be another tomorrow. Stay tuned!</P>
<P mce_keep="true">&nbsp;</P>
<P><FONT color=#ff00ff><EM>This post brought to you by</EM> <FONT size=5>4</FONT> </FONT><EM><FONT color=#ff00ff>(</FONT><A class="" href="http://www.fileformat.info/info/unicode/char/0034" mce_href="http://www.fileformat.info/info/unicode/char/0034">U+0034</A><FONT color=#ff00ff>, DIGIT FOUR)</FONT></EM></P>
<hr/><div style="margin-left: 1em"><em>no comments</em></div><hr/><p><em>referenced by</em></p><div style="margin-left: 1em"><p>2010/09/13 <a href="http://archives.miloush.net/michkap/archive/2010/09/13/10060986.html">Olive, the other reindeer, gets to Sort it all Out too....</a></p><p>2008/08/21 <a href="http://archives.miloush.net/michkap/archive/2008/08/21/8883467.html">A&P of Sort Keys, part 14: The Hangul is really getting OLD</a></p><p>2008/07/06 <a href="http://archives.miloush.net/michkap/archive/2008/07/06/8694239.html">You must have heard wrong, Jesse\ I don't know about tailoring\ But about the algorithm Jesse\ That is used by Microsoft...</a></p><p>2007/10/09 <a href="http://archives.miloush.net/michkap/archive/2007/10/09/5375754.html">A&P of Sort Keys, part 13 (About the function that is too lazy to get it right every time)</a></p><p>2007/10/08 <a href="http://archives.miloush.net/michkap/archive/2007/10/08/5270854.html">A&P of Sort Keys, part 12 (aka Han sorts first!)</a></p><p>2007/09/24 <a href="http://archives.miloush.net/michkap/archive/2007/09/24/5085893.html">A&P of Sort Keys, part 11 (aka It's not like ideographic sorts were developed idiopathically)</a></p><p>2007/09/21 <a href="http://archives.miloush.net/michkap/archive/2007/09/21/5027338.html">A&P of Sort Keys, part 10 (aka I've kana wanted to start talking about Japanese)</a></p><p>2007/09/20 <a href="http://archives.miloush.net/michkap/archive/2007/09/20/5008305.html">A&P of Sort Keys, part 9 (aka Not always transitive, but punctual and punctuating)</a></p><p>2007/09/18 <a href="http://archives.miloush.net/michkap/archive/2007/09/18/4971376.html">A&P of Sort Keys, part 8 (aka You can often think of ignoring weights as a form of ignorance)</a></p><p>2007/09/17 <a href="http://archives.miloush.net/michkap/archive/2007/09/17/4950008.html">A&P of Sort Keys, part 7 (aka You're very thin now, but I can still recognize you)</a></p><p>2007/09/16 <a href="http://archives.miloush.net/michkap/archive/2007/09/16/4937196.html">A&P of Sort Keys, part 6 (aka Relax, be calm, and deCOMPRESS if you are feeling out of sorts)</a></p><p>2007/09/15 <a href="http://archives.miloush.net/michkap/archive/2007/09/15/4924008.html">A&P of Sort Keys, part 5 (aka EXPANSIONing your horizons)</a></p></div><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2007/09/15/4924008.html" title="A&amp;P of Sort Keys, part 5 (aka EXPANSIONing your horizons)">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2007/09/14/4904644.html" title="Look at the shiny happy people laughing -- push and pull aside, they&#39;re beautiful">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2007-09">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2007-09-14">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2007/09/14/4905625.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:37 GMT -->
</html>