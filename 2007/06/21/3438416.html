<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2007/06/21/3438416.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:38 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>Oops! Somebody did broken it!</title></head><body>
<h1>Oops! Somebody did broken it!</h1>
<p><em>by Michael S. Kaplan, published on 2007/06/21 03:31 -04:00, original URI: http://blogs.msdn.com/b/michkap/archive/2007/06/21/3438416.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostNew -->
<P>Some times, things get broken and nobody notices.</P>
<P>Other times, things have been broken for years and nobody noticed that, either!</P>
<P>As an example, back at the end of May,&nbsp;Arunaabh asked over in the microsoft.public.win32.programmer.international newsgroup:</P>
<BLOCKQUOTE><FONT size=2>
<P><FONT face="times new roman,times"><EM>In my application I am converting a string in one charset to other charset. I am using GetCPInfoEx() API to fill the CPINFOEX structure corresponding to the codepage number I am providing. I am using the following lines of code : </EM></FONT></P>
<P><FONT face="times new roman,times"><EM>...<BR></EM></FONT><FONT face="times new roman,times"><EM>BOOL bNLS_Exist=GetCPInfoEx(nCodePage,0,&amp;cpInfoEx);<BR></EM></FONT><FONT face="times new roman,times"><EM>DWORD err=GetLastError();<BR></EM></FONT><FONT face="times new roman,times"><EM>...</EM></FONT></P>
<P><FONT face="times new roman,times"><EM>For nCodePage = 1147 which corresponds to charset 'ibm-1147' , GetCPInfoEx() returns me false even if it fills the CPINFOEX structure properly . The </EM></FONT><FONT face="times new roman,times"><EM>GetLastError() also returns zero. The corresponding nls file C_1147.nls is also present in the registry.</EM></FONT></P>
<P><FONT face="times new roman,times"><EM>For nCodePage = 20949 which corresponds to charset 'X_CP20949' , </EM></FONT><FONT face="times new roman,times"><EM>GetCPInfoEx() returns me false even if it fills the CPINFOEX structure properly . </EM></FONT></P>
<P><FONT face="times new roman,times"><EM>In this case GetLastError() returns with a value of '1814' which is "The specified resource name cannot be found in the image file" . The corresponding nls file C_20949.nls is also present in the registry.</EM></FONT></P>
<P><FONT face="times new roman,times"><EM>Please help me out for the abrupt behaviour of GetCPInfoEx() API for the above two cases.</EM></FONT></P></FONT></BLOCKQUOTE>
<P>What can I say, Arunaabh&nbsp;is right.</P>
<P>Code page 20949 appears to have been failing for years (I could not get it to work on XP or Server 2003 or Vista. The GetCPInfo() pieces all work, but the string is not there (which actually explains the 1814 error, since the resource couldn't be found.</P>
<P>Now code page 1147 appears to be&nbsp;a more recent break -- it fails on Vista just as Arunaabh&nbsp;described, but on prior versions it used to work.</P>
<P>Someone should probably get a bug or two in to add a string and to figure out why the function is failing to show a string that is there that it used to load....</P>
<P mce_keep="true">&nbsp;</P>
<P><FONT color=#ff00ff><EM>This post brought to you by</EM> <FONT size=5>à·…</FONT> <EM>(<A class="" href="http://www.fileformat.info/info/unicode/char/0dc5" mce_href="http://www.fileformat.info/info/unicode/char/0dc5">U+0dc5</A>, a.k.a. SINHALA LETTER MUURDHAJA LAYANNA)</EM></FONT></P>
<hr/><p><strong>Mihai</strong> on 21 Jun 2007 4:35 AM:</p><div style="margin-left: 1em"><p>Actually, noticed so long ago, that somehow I got used to it and did not complain :-)</p>
<p>On XP SP2 with all the possible i18n support installed, there are 4 code pages that fail: 1047, 1146, 1148 and 20949.</p></div>
<p><strong>Michael S. Kaplan</strong> on 21 Jun 2007 5:54 PM:</p><div style="margin-left: 1em"><P>Well, probably worth fixing at some point, I think....</P></div>
<p><strong>Watches</strong> on 22 Jun 2007 12:05 AM:</p><div style="margin-left: 1em"><P>Yes but when is it going to be fixed???</P></div>
<hr/><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2007/06/22/3452969.html" title="TTC indexes, the hard way...">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2007/06/21/3431070.html" title="RTF is a terrible, horrible, no good, very bad file format">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2007-06">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2007-06-21">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2007/06/21/3438416.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:38 GMT -->
</html>