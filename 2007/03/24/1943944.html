<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2007/03/24/1943944.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:38 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>It was déjà vu all over again, this time in quite an oymoronic way</title></head><body>
<h1>It was déjà vu all over again, this time in quite an oymoronic way</h1>
<p><em>by Michael S. Kaplan, published on 2007/03/24 18:08 -04:00, original URI: http://blogs.msdn.com/b/michkap/archive/2007/03/24/1943944.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostNew -->
<P>It was just the other day that I got the message via the contact link:</P>
<BLOCKQUOTE><FONT size=2>
<P><FONT face="times new roman,times"><EM>Michael,<BR><BR>Hi. <BR><BR>I'm a Neurologist in Dallas, TX, and a computer person.<BR><BR>My Internet Explorer 6 (running on Win98) suddenly started using a strange font where the html page coding was PRE{font-family:sans-serif} Text between &lt;PRE&gt; &lt;/PRE&gt; was coming out in Noam New Hebrew (file name is _AE4B263.TTF) instead of Arial.<BR><BR>Interestingly, that became the default font for Write 3.1 (old 16 bit Windows 3.1 word processor). As I understand it, IE picks the generic CSS fonts such as serif, sans-serif, etc., and gives you no direct control over which it chooses.<BR><BR>I followed some advise on the internet to:</EM></FONT></P>
<OL>
<LI><FONT face="times new roman,times"><EM>shut down IE</EM></FONT></LI>
<LI><FONT face="times new roman,times"><EM>uninstall the font from Control Panel (made a copy of the file in another directory)</EM></FONT></LI>
<LI><FONT face="times new roman,times"><EM>re-start IE and confirmed it has switched to another font (in this case Temp Installer Font, almost as bad)</EM></FONT></LI>
<LI><FONT face="times new roman,times"><EM>cold boot to make change permanent</EM></FONT></LI>
<LI><FONT face="times new roman,times"><EM>re-install Noam New Hebrew</EM></FONT></LI></OL>
<P><FONT face="times new roman,times"><EM>Now IE6 and write3.1 use Temp Installer Font<BR><BR>Where is the info kept on what is the system's generic font.<BR><BR>I tracked changes and couldn't find it in the registry, nor ini files. The changes of deleting the ttf file just show in c:\WINDOWS\FONTS\ and HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\Fonts<BR><BR>I'd like to be able to manually tell it Arial.<BR><BR>It must be a true system object since write3.1 picked it up.</EM></FONT></P></FONT></BLOCKQUOTE>
<P>An interesting problem, and not just because I knew what was behind about half of what our neurologist was running into and had a strong hunch about the other half. :-)</P>
<P>First, the half that I knew about....</P>
<P>It is never really fully understood by many people how font selection works on Windows. The truth is that whether one is a programmer calling <A class="" href="http://msdn2.microsoft.com/library/ms534214.aspx" mce_href="http://msdn2.microsoft.com/library/ms534214.aspx">CreateFont</A> or <A class="" href="http://msdn2.microsoft.com/library/ms534009.aspx" mce_href="http://msdn2.microsoft.com/library/ms534009.aspx">CreateFontIndirect</A> or <A class="" href="http://msdn2.microsoft.com/library/ms534035.aspx" mce_href="http://msdn2.microsoft.com/library/ms534035.aspx">CreateFontIndirectEx</A> or the GDI+ <A class="" href="http://msdn2.microsoft.com/library/system.drawing.font.aspx" mce_href="http://msdn2.microsoft.com/library/system.drawing.font.aspx">System.Drawing.Font class</A> or the WPF/Avalon <A class="" href="http://msdn2.microsoft.com/library/system.windows.media.fontfamily.aspx" mce_href="http://msdn2.microsoft.com/library/system.windows.media.fontfamily.aspx">System.Windows.Medua.FontFamily class</A>&nbsp;or&nbsp;someone&nbsp;font face authoring a web page or even someone using the Shell Font Picker common dialog, the truth is that when pick a font, you&nbsp;are not really picking a font.</P>
<P>What you are actually doing is picking some descriptive attributes that will describe something that the system will try to map to a font.</P>
<P>Now sometimes you can't tell the difference. Like when the descriptive attributes are so specific that you end up right on the money.</P>
<P>And other times, not so much. Like this time.</P>
<P>When you give a generic description for a font, then the first one that the system believes is a good enough match will be the one that you get.</P>
<P>Which kind of leads us to the other half. The half relating to the post from earlier today.</P>
<P>Not since the events of <A class="" href="http://archives.miloush.net/michkap/archive/2007/03/24/1941034.html" mce_href="http://archives.miloush.net/michkap/archive/2007/03/24/1941034.html"><STRONG>It was déjà vu, man. Pure déjà vu...</STRONG></A> has the feeling of having been there before been so strong.</P>
<P>You see, the various duplicated font caches built up by the various technologies build up their data from the font list in the registry -- a font list that is read in via an order that is subject to the same less-than-intuitive registry value ordering logic that I was talking about yesterday.</P>
<P>This allows for&nbsp;reasonably deterministic behavior in font selection on a given machine, behavior that is subject to the fonts one adds and removes from the font folder, of course. :-)</P>
<P>As a side point, there are currently only two ways to get the actual order that is in the registry that will be used by the system when looking for fonts:</P>
<OL>
<LI>Get it programmatically via a series of&nbsp;<A class="" href="http://msdn2.microsoft.com/library/ms724865.aspx" mce_href="http://msdn2.microsoft.com/library/ms724865.aspx">RegEnumValue</A>&nbsp;calls</LI>
<LI>Export the registry key in question to text -- the values will be in that&nbsp;same order.</LI></OL>
<P>If you try to do this with <STRONG>HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Fonts</STRONG>, then you will see an important change between prior versions of Windows and Vista. And by important I don't mean intentional or feature-filled, I mean significantly different. In a way that&nbsp;can really impact font selection in the new operating system.</P>
<P>As I mentioned, the change was not intentional, it just has to do with the way that the new setup in Vista accomplishes its goals via the installation of different components, and the fact that the ordering of font components was not done with the impact that the order can have in mind. I suspect there may yet be a bug or two reported by customers due to side effects from this change....</P>
<P>So now we know why the behavior is consistent and why it can easily be changed by removing and adding fonts and why adding a font back after removing it does not mean that you will always get back the same behavior. And why you may end up with odd choices if you have been doing a lot of adding and/or removing of fonts.</P>
<P>So now let's look at the last bit and try to explain the actual behavior....</P>
<P>Let's start by taking a closer look at what was being requested in this case.</P>
<P>The <A class="" href="http://msdn.microsoft.com/workshop/author/dhtml/reference/objects/pre.asp" mce_href="http://msdn.microsoft.com/workshop/author/dhtml/reference/objects/pre.asp">PRE Element</A> in HTML&nbsp;is defined quite clearly -- it <STRONG>Renders text in a fixed-width font.</STRONG> Which is clearly something that Arial is not. </P>
<P>The only possible way to get Arial to be selected when a fixed width font is requested is when every better possible choice is unavailable....</P>
<P>So&nbsp;to be honest, if one is looking for Arial, then the <A class="" href="http://msdn.microsoft.com/workshop/author/dhtml/reference/objects/pre.asp" mce_href="http://msdn.microsoft.com/workshop/author/dhtml/reference/objects/pre.asp">PRE Element</A> is the wrong thing to be use anyway. Although other aspects of the element are what often lead people to want to use it, such as the way the text is directly rendered, including spaces which would otherwise be truncated. Which makes it unfortunate that the functionality of these two different attributes are combined into one element, but perhaps understandable why people might want to try....</P>
<P mce_keep="true">&nbsp;</P>
<P><FONT color=#ff00ff><EM>This post brought to you by</EM> <FONT size=4>й</FONT> </FONT><EM><FONT color=#ff00ff>(</FONT><A class="" href="http://www.fileformat.info/info/unicode/char/0439" mce_href="http://www.fileformat.info/info/unicode/char/0439">U+0439</A><FONT color=#ff00ff>, a.k.a. CYRILLIC SMALL LETTER SHORT I)</FONT></EM></P>
<hr/><p><strong>Björn</strong> on 25 Mar 2007 12:02 PM:</p><div style="margin-left: 1em"><p>Well, the neurologists PRE { font-family: sans-serif } CSS rule overrides the default PRE { font-family: monospace }, so he should get the space preserving behavior of the PRE element with the default Sans-serif font (which is not selectable through the UI of IE, though).</p>
</div>
<hr/><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2007/03/25/1945659.html" title="Will the real Unicode character message please stand up?">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2007/03/24/1941034.html" title="It was déjà vu, man. Pure déjà vu....">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2007-03">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2007-03-24">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2007/03/24/1943944.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:38 GMT -->
</html>