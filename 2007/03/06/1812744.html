<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2007/03/06/1812744.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:38 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>The T's are crossed, but not all of the I's are dotted...</title></head><body>
<h1>The T's are crossed, but not all of the I's are dotted...</h1>
<p><em>by Michael S. Kaplan, published on 2007/03/06 03:01 -05:00, original URI: http://blogs.msdn.com/b/michkap/archive/2007/03/06/1812744.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostNew -->
<P>Localizer Michel from down the hall and one floor down had been asked about a potential bug, so&nbsp;after that&nbsp;provided me with some screenshots and asked:</P>
<BLOCKQUOTE>
<P><FONT face="times new roman,times"><EM>Hi Michael,<BR><BR>Not sure if this is a bug or by design (legacy keyboard).<BR><BR>Is there an alias to report and investigate this bug?<BR><BR>This is obviously not linked to Turkish Vista SW localization as I first thought it was.<BR><BR>Thanks,<BR>Michel</EM></FONT></P></BLOCKQUOTE>
<P>You can get to the same place as the screenshot would take you if you have Vista. Just open up the Text Services and Input Languages dialog&nbsp;(ignore the Russian keyboard under Ukrainian and the Ukrainian keyboard under Russian, that is for a different bug!):</P>
<P><IMG src="http://trigeminal.fmsinc.com/images/tsail.png"></P>
<P>It is a little known but undeniably cool fact that either double-clicking on a keyboard name of clicking the <STRONG>Properties...</STRONG> button while one is&nbsp;selected&nbsp;will launch a preview window, like the two shown below for the <STRONG>Turkish Q</STRONG> and <STRONG>Turkish F</STRONG> keyboards:</P>
<P><IMG src="http://trigeminal.fmsinc.com/images/turkishq_preview.png"></P>
<P><IMG src="http://trigeminal.fmsinc.com/images/turkishf_preview.png"></P>
<P>You may notice the problem now, or maybe not if you don't know the Turkish keyboards all that well. I'll give you the <A class="" href="http://www.microsoft.com/globaldev/tools/msklc.mspx" mce_href="http://www.microsoft.com/globaldev/tools/msklc.mspx">MSKLC</A> versions in the base, shift, and CAPS LOCK state to see it helps.</P>
<P>First the Turkish Q keyboard:</P>
<P><IMG src="http://trigeminal.fmsinc.com/images/turkishq.png">&nbsp;&nbsp;<BR><IMG src="http://trigeminal.fmsinc.com/images/turkishq_shift.png"><BR><IMG src="http://trigeminal.fmsinc.com/images/turkishq_caps.png"></P>
<P>&nbsp;<IMG src="http://trigeminal.fmsinc.com/images/turkishf.png"></P>
<P>Then the Turkish F keyboard:<BR><IMG src="http://trigeminal.fmsinc.com/images/turkishf_shift.png"><BR><IMG src="http://trigeminal.fmsinc.com/images/turkishf_caps.png"></P>
<P>Did you see&nbsp;it? There&nbsp;is something really wrong going on with the I (dotless and/or otherwise!).&nbsp;Just on the previews, though....</P>
<P>The problem has a lot to do with the fact that the way the preview dialog works is (instead of getting the characters by using the actual data in the keyboard layout like&nbsp;MSKLC does)&nbsp;to use&nbsp;the same&nbsp;info that feeds the&nbsp;<A class="" href="http://msdn2.microsoft.com/library/ms646300.aspx" mce_href="http://msdn2.microsoft.com/library/ms646300.aspx">GetKeyNameText function</A>, which itself depends on the data that&nbsp;feeds the&nbsp;<A class="" href="http://msdn2.microsoft.com/library/ms646307.aspx" mce_href="http://msdn2.microsoft.com/library/ms646307.aspx">MapVirtualKeyEx function</A>. In fact, when dealing&nbsp;with the function itself&nbsp;<A class="" href="http://msdn2.microsoft.com/library/ms646300.aspx" mce_href="http://msdn2.microsoft.com/library/ms646300.aspx">GetKeyNameText</A>&nbsp;calls <A class="" href="http://msdn2.microsoft.com/library/ms646307.aspx" mce_href="http://msdn2.microsoft.com/library/ms646307.aspx">MapVirtualKeyEx</A>&nbsp;twice:</P>
<UL>
<LI>First&nbsp;with the MAPVK_VSC_TO_VK flag, mapping the scan code to a virtual key on the given keyboard</LI>
<LI>Second with the MAPVK_VK_TO_CHAR flag, mapping the virtual key to a character</LI></UL>
<P>The resulting string is then uppercased, though unfortunately the uppercasing is done without using the LCID attached to the KLID and the&nbsp;LCMAP_UPPERCASE | LCMAP_LINGUISTIC_CASING flags.</P>
<P>This means that Turkic casing is&nbsp;not done. </P>
<P>In the generic casing table, <A class="" href="http://www.fileformat.info/info/unicode/char/0131" mce_href="http://www.fileformat.info/info/unicode/char/0131">U+0131</A> (LATIN SMALL LETTER DOTLESS I) uppercases to itself, and <A class="" href="http://www.fileformat.info/info/unicode/char/0069" mce_href="http://www.fileformat.info/info/unicode/char/0069">U+0069</A> (LATIN SMALL LETTER I) uppercases to <A class="" href="http://www.fileformat.info/info/unicode/char/0049" mce_href="http://www.fileformat.info/info/unicode/char/0049">U+0049</A> (LATIN&nbsp;CAPITAL LETTER I).... </P>
<P>So&nbsp;we are left with previews of&nbsp;mostly capitalized keyboards that contains cased variants of the dotless I....</P>
<P>Okay, now picking this apart and complaining about it&nbsp;is easy. But deciding on the easiest way to address it is a bit harder.</P>
<P>As you can see, the code can't pick any one shift state with the actual keyboard data as the results they want do not exactly match any of them. Even the CAPS LOCK won't always work -- try out the Hebrew keyboard layout with the CAPS LOCK in MSKLC if you don't believe me:</P>
<P><IMG src="http://trigeminal.fmsinc.com/images/hebrew_preview.png"><BR><BR><IMG src="http://trigeminal.fmsinc.com/images/hebrew_caps.png"></P>
<P>So perhaps just making sure to do linguistic casing with the appropriate LCID is the easiest way to go and always return the results one would expect. And until then having a bit of a problem with the T's being crossed but the I's not being dotted is a small price to pay for doing so well in every other case.</P>
<P><EM>(Now&nbsp;coming up with the best way to create such a preview would probably not make an interesting&nbsp;interview question, even with someone who claimed to have good knowledge of these functions in USER, given how even the experts have to really work this one all the way through and either test it out or look at source!)</EM></P>
<P mce_keep="true">&nbsp;</P>
<P><FONT color=#ff00ff><EM>This post brought to you by</EM>&nbsp;<FONT size=4>Ä±</FONT> <EM>(<A class="" href="http://www.fileformat.info/info/unicode/char/0131" mce_href="http://www.fileformat.info/info/unicode/char/0131">U+0131</A>, a.k.a. LATIN SMALL LETTER DOTLESS I)</EM></FONT></P>
<hr/><div style="margin-left: 1em"><em>no comments</em></div><hr/><p><em>referenced by</em></p><div style="margin-left: 1em"><p>2008/06/25 <a href="http://archives.miloush.net/michkap/archive/2008/06/25/8652525.html">Seeing the tears, my heart went out to her as I asked her "Why the Long S?"</a></p><p>2007/07/26 <a href="http://archives.miloush.net/michkap/archive/2007/07/26/4057259.html">Report of blank previews of unknown etiology</a></p><p>2007/03/26 <a href="http://archives.miloush.net/michkap/archive/2007/03/26/1950492.html">Flirting with a strange keyboard, will you remember its language in the morning?</a></p></div><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2007/03/08/1838231.html" title="Double Secret ANSI, part 1 (Somewhere between ANSI and Unicode)">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2007/03/05/1810677.html" title="It&#39;s not just returning 1; it&#39;s returning -1">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2007-03">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2007-03-06">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2007/03/06/1812744.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:38 GMT -->
</html>