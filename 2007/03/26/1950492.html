<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2007/03/26/1950492.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:38 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>Flirting with a strange keyboard, will you remember its language in the morning?</title></head><body>
<h1>Flirting with a strange keyboard, will you remember its language in the morning?</h1>
<p><em>by Michael S. Kaplan, published on 2007/03/26 03:01 -04:00, original URI: http://blogs.msdn.com/b/michkap/archive/2007/03/26/1950492.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostNew -->
<P>If you use the <A class="" href="http://msdn2.microsoft.com/library/ms646300.aspx" mce_href="http://msdn2.microsoft.com/library/ms646300.aspx">GetKeyNameText</A> function, you can get the name of a key -- like the name that you might want to put on a soft keyboard (assuming you did not want to change what was on the key when you changed shift states or something -- the static nature of this function's behavior within the framework of dynamic keyboard layout selection is unavoidable with <A class="" href="http://msdn2.microsoft.com/library/ms646300.aspx" mce_href="http://msdn2.microsoft.com/library/ms646300.aspx">GetKeyNameText</A>).</P>
<P>Okay, the expository text above about <A class="" href="http://msdn2.microsoft.com/library/ms646300.aspx" mce_href="http://msdn2.microsoft.com/library/ms646300.aspx">GetKeyNameText</A>&nbsp;that is designed to make the function look stupid and inadequate to the task. Unworthy of your fine application. :-)</P>
<P>Of course, judge not yet lest ye be judged, as they say; it takes just one reminder of when <A class="" href="http://archives.miloush.net/michkap/archive/2007/03/06/1812744.html" mce_href="http://archives.miloush.net/michkap/archive/2007/03/06/1812744.html"><STRONG>The T's are crossed, but not all of the I's are dotted...</STRONG></A> to remind us that if we get to smug about what we choose to call stupid (where a "wrong" solution will actually be correct more often than the right one), we can look pretty stupid ourselves without working up a sweat.</P>
<P>Besides, there is one case where <A class="" href="http://msdn2.microsoft.com/library/ms646300.aspx" mce_href="http://msdn2.microsoft.com/library/ms646300.aspx">GetKeyNameText</A> is actually pretty good at what it does -- in looking&nbsp;at the entirely static buttons like the control keys and the shift keys and such. Maybe it is just that there is no other way to do it, but suddenly in our drunken stupor of frustration our beer goggles notice <A class="" href="http://msdn2.microsoft.com/library/ms646300.aspx" mce_href="http://msdn2.microsoft.com/library/ms646300.aspx">GetKeyNameText</A> and realize that there is more to this fine function than we first thought....</P>
<P>Not convinced that you want to take <A class="" href="http://msdn2.microsoft.com/library/ms646300.aspx" mce_href="http://msdn2.microsoft.com/library/ms646300.aspx">GetKeyNameText</A> home yet?</P>
<P>Well, I'll tell you a secret about this little function -- the key names are actually localized....</P>
<P>Because what the French call&nbsp;<STRONG>RET.ARR</STRONG> and the Finns call&nbsp;<STRONG>ASKELPALUTIN</STRONG> and the Swedes call <STRONG>BACKSTEG</STRONG> and the Danes call <STRONG>TILBAGE</STRONG> at the same time as the Americans call it <STRONG>Backspace</STRONG> may just be a "you say po-tay-to, I say poh-tah-to" issue to some, but to others it is a significant issue to get wrong. In a bad way.</P>
<P>Of course, they are not localized the same way that most of Windows is localized. </P>
<P><EM>(If there is anything I have learned about keyboards over the last few years, it is that keyboards <STRONG>always</STRONG> have to be different!)</EM></P>
<P>What is different here is not the most impressive sort of issue; it&nbsp;is that the names are actually stored right in the keyboard layout DLL.</P>
<P>Thus the names that are returned by <A class="" href="http://msdn2.microsoft.com/library/ms646300.aspx" mce_href="http://msdn2.microsoft.com/library/ms646300.aspx">GetKeyNameText</A> are firmly connected to the layout choice based on the KLID (keyboard layout identifier)&nbsp;which does not in any way need to be tied to the user interface language or even the input language (HKL).</P>
<P>This can actually lead to problems anytime a keyboard layout DLL is reused for multiple, different languages. Which can lead to problems like <A class="" href="https://connect.microsoft.com/VisualStudio/feedback/ViewFeedback.aspx?FeedbackID=100929" mce_href="https://connect.microsoft.com/VisualStudio/feedback/ViewFeedback.aspx?FeedbackID=100929">this one</A> reported on the MSDN Product Feedback Center (it happens due to the fact that Catalan uses the Spanish keyboard layout DLL, a fact that would not matter at all if not for this issue).</P>
<P>Workarounds? Well, you can't just use <A class="" href="http://www.microsoft.com/globaldev/tools/msklc.mspx" mce_href="http://www.microsoft.com/globaldev/tools/msklc.mspx">MSKLC</A>, since those key names are not exposed via the tool. But you can edit the names in the .KLC file directly, as long as you remember to put any name that contains a space in quotes first. You can then load the file in <A class="" href="http://www.microsoft.com/globaldev/tools/msklc.mspx" mce_href="http://www.microsoft.com/globaldev/tools/msklc.mspx">MSKLC</A>, build it, save it, whatever you want to do....</P>
<P>This is obviously not the best or most scalable of all possible models, so people can give some thought to what we might do in the future.&nbsp;One thing to keep in mind&nbsp;-- this is a problem where the first few solutions that occur to us may actually be the wrong answer, too.</P>
<P>Now the only thing you have to remember the morning after is what the keyboard layout DLL's language was, since the DLL may not be able to tell us. If that notion cares you then don't take strange functions like <A class="" href="http://msdn2.microsoft.com/library/ms646300.aspx" mce_href="http://msdn2.microsoft.com/library/ms646300.aspx">GetKeyNameText</A> home at night....</P>
<P mce_keep="true">&nbsp;</P>
<P><FONT color=#ff00ff><EM>This post brought to you by</EM> <FONT size=5>Â¿</FONT> <EM>(<A class="" href="http://www.fileformat.info/info/unicode/char/00bf" mce_href="http://www.fileformat.info/info/unicode/char/00bf">U+00bf</A>, a.k.a. INVERTED QUESTION MARK)</EM></FONT></P>
<hr/><p><strong>Satchmo</strong> on 9 Aug 2010 2:15 AM:</p><div style="margin-left: 1em"><p>Hi Michael, So why API GetKeyNameText() returns &quot;Sys Req&quot; instead of &quot;Print Scrn&quot; when using VK_SNAPSHOT? And why does it return &quot;Num +&quot; instead of &quot;+&quot; when using VK_ADD? I was thinking about using this function to display the keys in a settings window, so international users can customize the hotkeys of my program. -Satchmo</p>
</div>
<p><strong>Michael S. Kaplan</strong> on 10 Aug 2010 7:23 AM:</p><div style="margin-left: 1em"><p>Satchmo: see <a href="http://archives.miloush.net/michkap/archive/2010/08/10/10047945.html">this</a> blog for the answer to your question....</p></div>
<hr/><p><em>referenced by</em></p><div style="margin-left: 1em"><p>2012/02/22 <a href="http://archives.miloush.net/michkap/archive/2012/02/22/10271073.html">If it's incorrect and out of sync, someone should step up and try to fix it...</a></p><p>2010/08/10 <a href="http://archives.miloush.net/michkap/archive/2010/08/10/10047945.html">What's up with the name of the "Print Screen" key?</a></p><p>2010/04/13 <a href="http://archives.miloush.net/michkap/archive/2010/04/13/9994062.html">Now *that* gets localized, sometimes</a></p><p>2007/08/10 <a href="http://archives.miloush.net/michkap/archive/2007/08/10/4322536.html">I've been to the desert on a dead key with no name</a></p></div><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2007/03/26/1952689.html" title="Hello, Mr. TrueType Font. Do you support Bengali?">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2007/03/25/1949369.html" title="Somebody turned 50 this weekend!">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2007-03">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2007-03-26">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2007/03/26/1950492.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:38 GMT -->
</html>