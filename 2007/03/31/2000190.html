<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2007/03/31/2000190.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:38 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>Rotate it when vertical?</title></head><body>
<h1>Rotate it when vertical?</h1>
<p><em>by Michael S. Kaplan, published on 2007/03/31 10:17 -04:00, original URI: http://blogs.msdn.com/b/michkap/archive/2007/03/31/2000190.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostNew -->
<P>It was quite a while ago that I first posted <A class="" href="http://archives.miloush.net/michkap/archive/2005/08/04/447759.html" mce_href="http://archives.miloush.net/michkap/archive/2005/08/04/447759.html"><STRONG>Let's get vertical</STRONG></A> and talked about how prepending&nbsp;a font name with an <STRONG>@</STRONG> would signal a font with knowledge of verticality to properly decide when to rotate glyphs 90 degrees.</P>
<P>I have been asked whether those samples from the "Far East Win32 SDK" still existed. It seems that they do not (though the GlobalDev web site still talks about the TATE sample in this <A class="" href="http://www.microsoft.com/globaldev/getWR/steps/wrg_cscripts.mspx" mce_href="http://www.microsoft.com/globaldev/getWR/steps/wrg_cscripts.mspx">article</A>). Mildly disappointing, as it always is when samples seem to go away....</P>
<P>Anyway, a question came up a while back related to <A class="" href="http://msdn2.microsoft.com/library/ms534013.aspx" mce_href="http://msdn2.microsoft.com/library/ms534013.aspx">GetGlyphOutline</A>. A customer wanted to know how to determine programatically whether a glyph would be rotated or not, in a vertical font.</P>
<P>They noticed that when they passed the text (fo a vertical font in the HDC), they would get back&nbsp;a rotated glyph, but when they passed the glyphid and the GGO_GLYPH_INDEX flag, they would not get a rotated glyph. It was causing them trouble when they were just storing the glyphid values, and seemed a strange thing to depend on for determining whether rotation was happening.</P>
<P>Nobody seemed aware of the reasoning behind the two different behaviors here, though no one has ever expected a whole of explanation about <A class="" href="http://msdn2.microsoft.com/library/ms534013.aspx" mce_href="http://msdn2.microsoft.com/library/ms534013.aspx">GetGlyphOutline</A>&nbsp;behavior or details; articles like <A class="" href="http://www.codeguru.com/cpp/w-p/system/systeminformation/print.php/c10621/" mce_href="http://www.codeguru.com/cpp/w-p/system/systeminformation/print.php/c10621/">this one</A> from CodeGuru are typical in their explanations about this proc:</P>
<BLOCKQUOTE>
<H3><EM>A Function from Hell</EM></H3>
<P><EM>I guess it was the mere challenge that made me design this class. In Windows, simply outputting characters generally isn't exactly fun, with all these complex functions and structs, but it's nothing compared to retrieving basic character data from the system's depths.<BR><BR>You have to deal with GetGlyphOutine(), a function from hell, probably made up by the nastiest member of the Windows design team when he was suffering from a really, really bad temper. To use it, you have to struggle with horribly complex nested structs of varying sizes, bearing data in weird formats. The documentation is very dense and sketchy, and only recently more or less free of errors and inconsistencies. Only in some remote, dim corners of the huge MSDN library one or two small, partly outdated articles can be found.<BR><BR>No wonder most programmers tend to give this part of Windows GDI a wide berth. It's almost as if Microsoft doesn't want you to play with text. It wouldn't have something to do with the fact that </EM><A href="http://www.microsoft.com/typography/TrueTypeHistory.mspx" target=new><EM>it was Apple</EM></A><EM>, who originally designed the core font technology for Windows, wouldn't it?</EM></P></BLOCKQUOTE>
<P>Anyway, like I said nobody seemed to really understand/recall the reason for the difference (and comments in the code were reported as beung less than helpful in resolving the issue).</P>
<P>Though it does provide an interesting and only slightly kludgey&nbsp;way to determine whether a glyph is rotated without having to dig into the OpenType&nbsp;<A class="" href="http://www.microsoft.com/typography/otspec/features_uz.htm#vert" mce_href="http://www.microsoft.com/typography/otspec/features_uz.htm#vert">vert</A> or <A class="" href="http://www.microsoft.com/typography/otspec/features_uz.htm#vrt2" mce_href="http://www.microsoft.com/typography/otspec/features_uz.htm#vrt2">vrt2</A> features. It is fair to say that the behavior could not be changed without breaking a ton of people, so even though it is not specifically documented (something true of the bulk of <A class="" href="http://msdn2.microsoft.com/library/ms534013.aspx" mce_href="http://msdn2.microsoft.com/library/ms534013.aspx">GetGlyphOutline</A>&nbsp;behavior), it is pretty much set in stone.</P>
<P>The one place whether this is pretty unfortunate is when one is dealing with supplementary ideographs in Extension B, since <A class="" href="http://msdn2.microsoft.com/library/ms534013.aspx" mce_href="http://msdn2.microsoft.com/library/ms534013.aspx">GetGlyphOutline</A>&nbsp;can only take a single WCHAR or a single glyphid. and even using Uniscribe's <A class="" href="http://msdn2.microsoft.com/library/ms776482.aspx" mce_href="http://msdn2.microsoft.com/library/ms776482.aspx">ScriptGetCMap</A> won't help here in figuring out the rotation issue even when it will help with the Extension B glyphid retrieval....</P>
<P>There seems to be no good way around it -- one needs to dig into the OpenType features if one wants the real answers here!</P>
<P mce_keep="true">&nbsp;</P>
<P><FONT color=#ff00ff><EM>This post brought to you by</EM> <FONT size=5>ï¼ </FONT> <EM>(U+ff20, FULLWIDTH COMMERCIAL AT)</EM></FONT></P>
<hr/><p><strong>Si</strong> on 31 Mar 2007 11:58 PM:</p><div style="margin-left: 1em"><p>&gt;it was Apple, who originally designed the core font technology for Windows,</p>
<p>Microsoft licensed TrueType from Apple. TueType is a &quot;core font technology&quot; for sure, but how does that explain the annoying APIs? I don't think you can blame Apple in this case.</p></div>
<p><strong>Michael S. Kaplan</strong> on 1 Apr 2007 12:05 AM:</p><div style="margin-left: 1em"><p>Well, that was a quote, of someone else's opinion.... </p>
<p>But there are a whole lot of GDI functions related to fonts that are pretty nightmarish, and one almost has to believe that it is the hideously complex nature of what is underneasth that makes it so hard on top. :-)</p>
</div>
<hr/><p><em>referenced by</em></p><div style="margin-left: 1em"><p>2012/09/07 <a href="http://archives.miloush.net/michkap/archive/2012/09/07/10347167.html">Let's stand up a moment. You know, Vertically...</a></p><p>2010/09/22 <a href="http://archives.miloush.net/michkap/archive/2010/09/22/10066037.html">Looking at life a bit more vertically, for a moment...</a></p><p>2008/01/17 <a href="http://archives.miloush.net/michkap/archive/2008/01/17/7141157.html">Expertise isn't always everything (aka When the one who is learning teaches us something important)</a></p><p>2007/12/01 <a href="http://archives.miloush.net/michkap/archive/2007/12/01/6632929.html">A whole new spin on the term 'Vertical markets' (aka in SiaO we trust?)</a></p></div><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2007/04/01/2004424.html" title="I Kana understand you, could you repeater that? (Part 2)">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2007/03/31/1999022.html" title="If you think speaking with an accent is a challenge, try doing it over a wire service....">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2007-03">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2007-03-31">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2007/03/31/2000190.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:38 GMT -->
</html>