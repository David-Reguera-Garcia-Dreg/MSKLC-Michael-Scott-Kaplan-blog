<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2007/03/28/1977465.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:38 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>Like Cartman, that 'W' letter isn't fat; it's big boned!</title></head><body>
<h1>Like Cartman, that 'W' letter isn't fat; it's big boned!</h1>
<p><em>by Michael S. Kaplan, published on 2007/03/28 11:36 -04:00, original URI: http://blogs.msdn.com/b/michkap/archive/2007/03/28/1977465.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostNew -->
<P>Eli's question was simple enough:</P>
<BLOCKQUOTE><FONT face="Times New Roman,Times"><I>
<P>Is there a way to tell if a System.Drawing.Font object that I’ve created is fixed width or not? Also, once I know whether or not my font is fixed width, is there a way to tell what the width is? The only approach I could find was to use the System.Drawing.Font.ToLogFont function, and pass in a managed LogFont class:</P></I><FONT face="Consolas,Lucida Console,Courier New,Courier"><B>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; [StructLayout( LayoutKind.Sequential, CharSet = CharSet.Auto )]<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; class LOGFONT {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public int lfHeight;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public int lfWidth;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public int lfEscapement;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public int lfOrientation;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public int lfWeight;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public byte lfItalic;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public byte lfUnderline;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public byte lfStrikeOut;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public byte lfCharSet;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public byte lfOutPrecision;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public byte lfClipPrecision;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public byte lfQuality;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public byte lfPitchAndFamily;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; [MarshalAs( UnmanagedType.ByValTStr, SizeConst = 32 )]<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public string lfFaceName;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</P></B></FONT><I>
<P>After I call ToLogFont, the lfFaceName string is filled in appropriately, with the name of my fixed width font: “Courier New”.&nbsp; However, the lfPitchAndFamily is 0. I would have expected to see the low order bit to be set, indicating a FIXED_PITCH. Also, width is set to 0. Am I using this method incorrectly?<BR><BR>Thanks,<BR>Eli</P></I></FONT></BLOCKQUOTE>
<P mce_keep="true">Eli is right -- the call to <A class="" href="http://msdn2.microsoft.com/en-us/library/system.drawing.font.tologfont.aspx" mce_href="http://msdn2.microsoft.com/en-us/library/system.drawing.font.tologfont.aspx">Font.ToLogFont</A> produces a <A class="" href="http://msdn2.microsoft.com/en-us/library/ms533931.aspx" mce_href="http://msdn2.microsoft.com/en-us/library/ms533931.aspx">LOGFONT structure</A>&nbsp;that is woefully incomplete if your goal is to be able to query this sort of information.</P>
<P mce_keep="true">But let's not feel too bad, since even when this information is filled in, it is far from perfect. You may recall reading <A class="" href="http://archives.miloush.net/michkap/archive/2005/09/11/463672.html" mce_href="http://archives.miloush.net/michkap/archive/2005/09/11/463672.html"><STRONG>Fonts that are 'fixed-width' even if they do not claim to be</STRONG></A> if you have been around for a while, and it shows an example of a specific case that fails here. So let's put together something that will work in a wider variety of cases....</P>
<P mce_keep="true">Now I am going to use <A class="" href="http://msdn2.microsoft.com/en-us/library/y4xdbe66(VS.80).aspx" mce_href="http://msdn2.microsoft.com/en-us/library/y4xdbe66(VS.80).aspx">TextRenderer.MeasureText</A> in the sample rather than <A class="" href="http://msdn2.microsoft.com/en-us/library/system.drawing.graphics.measurestring.aspx" mce_href="http://msdn2.microsoft.com/en-us/library/system.drawing.graphics.measurestring.aspx">Graphics.MeasureString</A> since a <A class="" href="http://msdn2.microsoft.com/en-us/library/system.drawing.graphics.aspx" mce_href="http://msdn2.microsoft.com/en-us/library/system.drawing.graphics.aspx">Graphics</A> object is much harder to get if you don't already have one (if you do have one then you can safely substitute one method for the other):</P>
<BLOCKQUOTE><FONT face="Consolas,Lucida Console,Courier New,Courier"><B>
<P mce_keep="true">using System;<BR>using System.Drawing;<BR>using System.Windows.Forms;<BR><BR>public class FixedWidthTest {<BR>&nbsp;&nbsp;&nbsp; public static void Main(string[] args) {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Console.WriteLine(IsFixedWidth(args[0]));<BR>&nbsp;&nbsp;&nbsp; }<BR><BR>&nbsp;&nbsp;&nbsp; public static&nbsp; bool IsFixedWidth(string stFontName) {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Font fnt = new Font(stFontName, 16);<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return (TextRenderer.MeasureText("W", fnt).Width - TextRenderer.MeasureText("i", fnt).Width) == 0;<BR>&nbsp;&nbsp;&nbsp; }<BR>}</P></B></FONT></BLOCKQUOTE>
<P mce_keep="true">Then you can easily compile&nbsp;and test this sample with all manner of fonts:</P>
<BLOCKQUOTE><FONT face="Consolas,Lucida Console,Courier New,Courier"><B>
<P mce_keep="true">e:\test&gt;csc fnt.cs<BR>Microsoft (R) Visual C# 2005 Compiler version 8.00.50727.42<BR>for Microsoft (R) Windows (R) 2005 Framework version 2.0.50727<BR>Copyright (C) Microsoft Corporation 2001-2005. All rights reserved.<BR><BR>e:\test&gt;fnt.exe "Courier New"<BR>True<BR><BR>e:\test&gt;fnt.exe "Segoe UI"<BR>False<BR><BR>e:\test&gt;fnt.exe "Tahoma"<BR>False<BR><BR>e:\test&gt;fnt.exe "Consolas"<BR>True<BR><BR>e:\test&gt;fnt.exe "MS Mincho"<BR>True<BR><BR>e:\test&gt;fnt.exe "MS PMincho"<BR>False</P></B></FONT></BLOCKQUOTE>
<P mce_keep="true">So in the end, I think this technique does a better job then trying to rely on a method that gives you a structure that even if it were complete would not really get the whole job done....</P>
<P mce_keep="true">I think I'll post the completely unmanaged version of this method tomorrow (the managed one came first since that is where the question came from!).</P>
<P mce_keep="true">&nbsp;</P>
<P mce_keep="true"><FONT color=#ff00ff><EM>This post brought to you by</EM> <FONT size=6>W</FONT> <EM>(U+0057, a.k.a. LATIN CAPITAL LETTER W)</EM></FONT></P>
<hr/><p><a id="1979341" href="#1979341">#</a> <strong>Dirk</strong> on 28 Mar 2007 2:48 PM:</p><div style="margin-left: 1em"><p>The tmAveCharWidth and tmMaxCharWidth members of the TEXTMETRIC structure for &quot;Courier New&quot; are different. I ran TextRenderer.MeasureText for the Chars from 0 to 2000 to see whether they are any differences. The maximum was returned for 0x713. What character is this?</p>
<p>The otmPanoseNumber of the OUTLINETEXTMETRIC structure has PAN_PROP_MONOSPACED for bProportion. This value seems to be set for the fonts that return true in your test. But I do not know if this is consistent and using IsFixedWidth is a lot simpler.</p></div>
<p><a id="1980055" href="#1980055">#</a> <strong>Michael S. Kaplan</strong> on 28 Mar 2007 4:09 PM:</p><div style="margin-left: 1em"><p>That is SYRIAC LETTER GAMAL, which is not in the font -- you are hitting font linking/fallback, which is not useful here (only characters in the font are)....</p>
</div>
<p><a id="1986565" href="#1986565">#</a> <strong>Dirk</strong> on 29 Mar 2007 5:39 AM:</p><div style="margin-left: 1em"><p>Thanks for the explanation. Looking at &quot;Courier New&quot; in charmap I could not find this code point and I suspected some substitution must take place. I just saw your link to the Unicode Character Search.</p>
<p>Is there an easy way in managed code to test whether a particular code point is supported by a font?</p></div>
<p><a id="1987100" href="#1987100">#</a> <strong>Michael S. Kaplan</strong> on 29 Mar 2007 7:14 AM:</p><div style="margin-left: 1em"><p>In managed code? Not so much. But you can p/invoke to GetGlyphOutline....</p>
</div>
<p><a id="1987910" href="#1987910">#</a> <strong>Rosyna</strong> on 29 Mar 2007 8:37 AM:</p><div style="margin-left: 1em"><p>Hmm, your last post was about the Yen, and this post is about a W which is the base of won (₩). I wonder if these are connected or if you just like making fun of chubby letters.</p>
</div>
<p><a id="1987932" href="#1987932">#</a> <strong>Michael S. Kaplan</strong> on 29 Mar 2007 8:44 AM:</p><div style="margin-left: 1em"><p>They aren't chubby; they're big-boned!</p>
</div>
<hr/><p><em>referenced by</em></p><div style="margin-left: 1em"><p>2008/06/09 <a href="http://archives.miloush.net/michkap/archive/2008/06/09/8583404.html">Did you lose some WIDTH or something?</a></p></div><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2007/03/29/1985735.html" title="I Kana understand you, could you repeater that? (Part 1)">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2007/03/28/1972239.html" title="A yen for Yen may be left unsatiated">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2007-03">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2007-03-28">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2007/03/28/1977465.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:38 GMT -->
</html>