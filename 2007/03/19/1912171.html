<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2007/03/19/1912171.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:38 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>A way better model for features, part 2</title></head><body>
<h1>A way better model for features, part 2</h1>
<p><em>by Michael S. Kaplan, published on 2007/03/19 06:31 -04:00, original URI: http://blogs.msdn.com/b/michkap/archive/2007/03/19/1912171.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostNew -->
<P>You may have seen the first part of this series (<STRONG><A class="" href="http://archives.miloush.net/michkap/archive/2007/03/16/1895610.html" mce_href="http://archives.miloush.net/michkap/archive/2007/03/16/1895610.html">A way better model for features</A></STRONG>). Think of this as part 2....</P>
<P>This time I am going to use as a <FONT color=#999999><STRIKE>victim</STRIKE></FONT>example the <A class="" href="http://www.microsoft.com/downloads/details.aspx?FamilyId=EB72CDA0-834E-4C35-9419-FF14BC349C9D&amp;displaylang=en" mce_href="http://www.microsoft.com/downloads/details.aspx?FamilyId=EB72CDA0-834E-4C35-9419-FF14BC349C9D&amp;displaylang=en">Microsoft National Language Support Downlevel APIs 1.0</A>, which I have talked about previously in posts like <STRONG><A class="" href="http://archives.miloush.net/michkap/archive/2006/07/16/667622.html" mce_href="http://archives.miloush.net/michkap/archive/2006/07/16/667622.html">this one</A></STRONG>.</P>
<P>Now I am not going to complain about the fact that they are tagging a small subset of functions from the NLS API as "APIs", though clearly someone is not paying attention to the fact that API stands for <STRONG>A</STRONG>pplication <STRONG>P</STRONG>rogramming <STRONG>I</STRONG>nterface, and thus a function is not an API, and neither is a small set of functions APIs, plural. </P>
<P>But this is just one of those minor language issues I try not to become all mavenesque about. And the other&nbsp;reason I won't complain about this is that I used to make the same mistake. I don't anymore and I hopeful that all of my colleagues will come to the same realization one day. :-)</P>
<P>To see what my complaint is, let's look at the functions in this library:</P>
<LI><FONT face=Garamond><A href="http://msdn.microsoft.com/library/en-us/intl/nls_DownlevelLCIDToLocaleName.asp"><STRONG>DownlevelLCIDToLocaleName</STRONG></A> - converts an LCID to a locale name. </FONT>
<LI><FONT face=Garamond><A href="http://msdn.microsoft.com/library/en-us/intl/nls_DownlevelLocaleNameToLCID.asp"><STRONG>DownlevelLocaleNameToLCID</STRONG></A> - converts a locale name to an LCID. </FONT>
<LI><FONT face=Garamond><A href="http://msdn.microsoft.com/library/en-us/intl/nls_DownlevelGetParentLocaleLcid.asp"><STRONG>DownlevelGetParentLocaleLCID</STRONG></A> - retrieves the parent LCID for a locale. </FONT>
<LI><FONT face=Garamond><A href="http://msdn.microsoft.com/library/en-us/intl/nls_DownlevelGetParentLocaleName.asp"><STRONG>DownlevelGetParentLocaleName</STRONG></A> - retrieves the locale name for the parent of the indicated locale.</FONT></LI>
<P>Now let's compare that little set of functions to the ones they replace in the downlevel situation:</P>
<UL>
<LI><A class="" href="http://msdn.microsoft.com/library/en-us/intl/nls_LCIDToLocaleName.asp" mce_href="http://msdn.microsoft.com/library/en-us/intl/nls_LCIDToLocaleName.asp">LCIDToLocaleName</A></LI>
<LI><A class="" href="http://msdn.microsoft.com/library/en-us/intl/nls_LocaleNameToLCID.asp" mce_href="http://msdn.microsoft.com/library/en-us/intl/nls_LocaleNameToLCID.asp">LocaleNameToLCID</A></LI>
<LI><A class="" href="http://msdn.microsoft.com/library/en-us/intl/nls_34rz.asp" mce_href="http://msdn.microsoft.com/library/en-us/intl/nls_34rz.asp">GetLocaleInfo</A>&nbsp;with the LOCALE_SPARENT LCTYPE, followed by&nbsp;<A class="" href="http://msdn.microsoft.com/library/en-us/intl/nls_LocaleNameToLCID.asp" mce_href="http://msdn.microsoft.com/library/en-us/intl/nls_LocaleNameToLCID.asp">LocaleNameToLCID</A></LI>
<LI><A class="" href="http://msdn.microsoft.com/library/en-us/intl/nls_34rz.asp" mce_href="http://msdn.microsoft.com/library/en-us/intl/nls_34rz.asp">GetLocaleInfo</A>&nbsp;with the LOCALE_SPARENT LCTYPE</LI></UL>
<P>At this point, you may see what the problem is -- you need to write two different kinds of code to use the two different functions!</P>
<P>Do what is the benefit to use locale names downlevel if all of the code that is going to be written has to be special cased anyway? There is no real benefit to moving the code to use names here, one may as well either</P>
<OL>
<LI>have the special case code use LCIDs downlevel and names on Vista, or</LI>
<LI>just stick with LCIDs on all platforms.</LI></OL>
<P>Since the whole goal of nlsdl.dll is to try to make sure people don't do #2, this particular set of functions fail the basic requirements that led to the DLL being created.</P>
<P>A&nbsp;much better model here is code that can look identical on all platforms. What I would do is one of the following, instead:</P>
<UL>
<LI>Ideally, add downlevel wrapper functions with the same names to kernel32.lib so that one can just compile always and the code in the .LIB will either use the stub or call the OS function;</LI>
<LI>As a fallback, do the same thing with stubs but put them in a separate .LIB file and then put in MSLU loader style rules to get the downlevel functions used.</LI></UL>
<P>This way, there is a good and easy way to write the new code, not the old code. To use names and not LCIDs. And there is no eventual fear of needing to revisit code based on changes.</P>
<P>To be honest, I would extend the model and add stub versions of all of the locale name based Ex functions added in Vista (discussed previously <STRONG><A class="" href="http://archives.miloush.net/michkap/archive/2006/01/31/520694.html" mce_href="http://archives.miloush.net/michkap/archive/2006/01/31/520694.html">here</A></STRONG>) and put them in that same library. Because no one is going to want to write "If on Vista do this entirely different operation" type code, so the best thing to do is add these wrappers and call it a day.</P>
<P>The existing DLL is simply not such a hot model for helping&nbsp;developers migrate to using locale names rather than LCIDs....</P>
<P>So it looks like <A class="" href="http://www.microsoft.com/globaldev/handson/dev/mslu_announce.mspx" mce_href="http://www.microsoft.com/globaldev/handson/dev/mslu_announce.mspx">MSLU</A> wins again, this time&nbsp;when it comes to model decisions for migration and giving developers a clean migration path. Barry Bond wrote the first prototype that did this for MSLU, so I am technically just saying it is Barry's ideas that trump nlsdl.dll's ideas, not mine. I just had the good luck to be the one to take his prototype and run with it. :-)</P>
<P mce_keep="true">&nbsp;</P>
<P><FONT color=#ff00ff><EM>This post brought to you by</EM> <FONT face=Lashio size=5>á€‰</FONT> </FONT><EM><FONT color=#ff00ff>(</FONT><A class="" href="http://www.fileformat.info/info/unicode/char/1009" mce_href="http://www.fileformat.info/info/unicode/char/1009">U+1009</A><FONT color=#ff00ff>, a.k.a. MYANMAR LETTER NYA)</FONT></EM></P>
<hr/><p><a id="1928161" href="#1928161">#</a> <strong>Miral</strong> on 21 Mar 2007 8:56 PM:</p><div style="margin-left: 1em"><p>The use of &quot;APIs&quot; in that context is really just an abbreviation for &quot;functions from the API&quot;. &nbsp;I don't consider it a mistake.</p></div>
<p><a id="1928298" href="#1928298">#</a> <strong>Michael S. Kaplan</strong> on 21 Mar 2007 9:44 PM:</p><div style="margin-left: 1em"><p>Hmm.... I don't think that &quot;APIs == functions from the API&quot; is a natural thing here. </p>
<p>Though as I pointed out that is not why I'm upset here, not where I think the failure lies.... </p>
</div>
<hr/><p><em>referenced by</em></p><div style="margin-left: 1em"><p>2010/11/08 <a href="http://archives.miloush.net/michkap/archive/2010/11/08/10087179.html">Header files are the wrong place to be less than helpful</a></p><p>2007/06/11 <a href="http://archives.miloush.net/michkap/archive/2007/06/11/3221177.html">LCID vs. Powerman and the Locale-name-go-round</a></p><p>2007/04/29 <a href="http://archives.miloush.net/michkap/archive/2007/04/29/2330455.html">A way better model for features, part 3 (a.k.a. downlevel LoadMUILibrary)</a></p></div><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2007/03/20/1917161.html" title="Double Secret ANSI, part 2 (the brokenest one yet, sorry &#39;bout that!)">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2007/03/19/1911309.html" title="Hidden via the purloined post-it technique">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2007-03">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2007-03-19">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2007/03/19/1912171.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:38 GMT -->
</html>