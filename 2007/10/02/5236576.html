<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2007/10/02/5236576.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:37 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>What happens when people don't consistently preserve case? They cause bugs!</title></head><body>
<h1>What happens when people don't consistently preserve case? They cause bugs!</h1>
<p><em>by Michael S. Kaplan, published on 2007/10/02 10:31 -04:00, original URI: http://blogs.msdn.com/b/michkap/archive/2007/10/02/5236576.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostNew -->
<P>It is all well and good for me to spin theoretical advice about important issues related to internationalization and the various best practices thereof, sure.</P>
<P>And there are a bunch of you who seem to find it entertaining to have me blather on this way.</P>
<P>But having real examples seems to work better, I think. :-)</P>
<P>Take for example the lessons in <A class="" href="http://archives.miloush.net/michkap/archive/2007/06/13/3280569.html" mce_href="http://archives.miloush.net/michkap/archive/2007/06/13/3280569.html"><STRONG>In any CASE, it is somewhat INSENSITIVE to point out to someone how well PRESERVED they are</STRONG></A> and <A class="" href="http://archives.miloush.net/michkap/archive/2007/06/18/3374502.html" mce_href="http://archives.miloush.net/michkap/archive/2007/06/18/3374502.html"><STRONG>If you don't always preserve case, you don't always preserve meaning</STRONG></A>.</P>
<P>The other day, Jeffrey asked:</P>
<BLOCKQUOTE>
<P><EM><FONT face="times new roman,times">I am trying to use BeginUpdateResource API to bind a ReadMe.txt as resource into a Exe. But after performing the task, I find I can not use VS IDE to examine the resource of the Exe. So I assume my code corrupted the Exe. Am I doing anything wrong in the code below?</FONT></EM></P></BLOCKQUOTE>
<P><EM>(I did not include the code he did since it was not relevant to the actual problem.)</EM></P>
<P>Ace developer Jay Krell tracked down the problem after a few iterations via email:</P>
<BLOCKQUOTE>
<P><FONT face="times new roman,times">I guessed and..<BR><BR>The problem is that kernel32!EnumResourceTypesW =&gt; kernel32!BaseDllMapResourceIdW&nbsp; uppercases all input strings, and ntdll!LdrpCompareResourceNames_U is case sensitive with that and whatever is in the file, and UpdateResource ferries along whatever case you give it.<BR><BR>Therefore UpdateResource with mixed or lowercase strings leads to failure to enumerate the results, and perhaps failure to load, but I didn't try that.<BR><BR>So the file really isn't corrupt, at least not significantly so, just mixed up in case.<BR><BR>Stick to all uppercase and you'll have better luck.<BR><BR>Aha..poking around the docs, the "community content", says basically the same thing:<BR></FONT><A href="http://msdn2.microsoft.com/en-us/library/ms648042.aspx"><FONT face="times new roman,times">http://msdn2.microsoft.com/en-us/library/ms648042.aspx</FONT></A></P></BLOCKQUOTE>
<P>And indeed, the added community content in the <A class="" href="http://msdn2.microsoft.com/library/ms648042.aspx" mce_href="http://msdn2.microsoft.com/library/ms648042.aspx">FindResource function</A> added by <A class="" href="http://msdn2.microsoft.com/en-us/library/user-matt+green" mce_href="http://msdn2.microsoft.com/en-us/library/user-matt+green">Matt Green</A> says it all:</P>
<BLOCKQUOTE>
<P><EM><STRONG>Having trouble loading resources by name?<BR></STRONG><BR>Unfortunately, the official documentation does not mention that loading a resource by name does not work unless you specify the name in all capital letters. The resource itself must be named with all capital letters, and the argument to FindResource[Ex] must be in all capital letters. Otherwise, FindResource[Ex] will return NULL with error code 1814. </EM></P></BLOCKQUOTE>
<P>If only there were not functions that were randomly capitalizing everything except for the functions that people might use to look up resources later -- if they had just left the case alone and used <A class="" href="http://msdn.microsoft.com/library/en-us/Kernel_r/hh/Kernel_r/k109_59d7c507-968a-4cf5-b1f0-91c8cd7ccb64.xml.asp" mce_href="http://msdn.microsoft.com/library/en-us/Kernel_r/hh/Kernel_r/k109_59d7c507-968a-4cf5-b1f0-91c8cd7ccb64.xml.asp">RtlEqualUnicodeString</A> or <A class="" href="http://msdn.microsoft.com/library/en-us/Kernel_r/hh/Kernel_r/k109_ddeef320-7510-446b-af6f-756c3999bec1.xml.asp" mce_href="http://msdn.microsoft.com/library/en-us/Kernel_r/hh/Kernel_r/k109_ddeef320-7510-446b-af6f-756c3999bec1.xml.asp">RtlCompareUnicodeString</A> or <A class="" href="http://msdn2.microsoft.com/library/ms776340.aspx" mce_href="http://msdn2.microsoft.com/library/ms776340.aspx">CompareStringOrdinal</A> allowing case insensitivity if you like, and everything will work well here.</P>
<P>So please preserve the case and avoid problems like this in your own code. It may not affect as many people but no one should ever have to deal with bugs like this....</P>
<P><FONT color=#ff00ff><EM>This post brought to you by</EM> <FONT size=7>៖</FONT> <EM>(<A class="" href="http://www.fileformat.info/info/unicode/char/17d6" mce_href="http://www.fileformat.info/info/unicode/char/17d6">U+17d6</A>, a.k.a. KHMER SIGN CAMNUC PII KUUH)</EM></FONT></P>
<hr/><div style="margin-left: 1em"><em>no comments</em></div><hr/><p><em>referenced by</em></p><div style="margin-left: 1em"><p>2008/10/29 <a href="http://archives.miloush.net/michkap/archive/2008/10/29/9022296.html">How the @#%&*! does CBS_SORT choose to sort it all out?</a></p><p>2007/10/24 <a href="http://archives.miloush.net/michkap/archive/2007/10/24/5647711.html">Getting the preserved case of a file wHeN tHe uSeRs tYpE wHaTeVeR tHe hElL tHeY wAnT tO</a></p><p>2007/10/24 <a href="http://archives.miloush.net/michkap/archive/2007/10/24/5641619.html">In Case you have problems that you might think are ǸȦȘȚȲ</a></p></div><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2007/10/02/5237783.html" title="Track Update">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2007/10/02/5234209.html" title="Living ain&#39;t wrong with an excised song (Cleveland rocks!)">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2007-10">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2007-10-02">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2007/10/02/5236576.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:37 GMT -->
</html>