<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2007/10/31/5790802.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:37 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>Making things better out from under people: the story of MUI</title></head><body>
<h1>Making things better out from under people: the story of MUI</h1>
<p><em>by Michael S. Kaplan, published on 2007/10/31 10:16 -04:00, original URI: http://blogs.msdn.com/b/michkap/archive/2007/10/31/5790802.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostNew -->
<P>Over in the Suggestion Box, Kriz asked a question related to something I have been wanting to cover for some time:</P>
<BLOCKQUOTE>
<P><FONT face="times new roman,times"><EM>Can you please shed some light on the inner workings of SHLoadIndirectString ()?<BR><BR>I'm trying to "MUI enable" some of my application and it looks like SHLoadIndirectString() plays a key role in understanding how language switching works in Windows (Explorer).<BR><BR>The documentation on MSDN (</EM></FONT><A href="http://msdn2.microsoft.com/en-us/library/ms538594.aspx"><FONT face="times new roman,times"><EM>http://msdn2.microsoft.com/en-us/library/ms538594.aspx</EM></FONT></A><FONT face="times new roman,times"><EM>) is rather lacking especially the filename part of an indirect string and how the resource dlls should be named and I need to put those dlls. </EM></FONT></P></BLOCKQUOTE>
<P>I'll start by pointing out that at the moment, that link does not work. Just a residue of some pages moving around for some reason or another. But if you use this other&nbsp;<A class="" href="http://msdn2.microsoft.com/library/bb759919.aspx" mce_href="http://msdn2.microsoft.com/library/bb759919.aspx">SHLoadIndirectString</A> link instead, you'll have much better luck.... :-)</P>
<P>Now when you look at MUI in terms of coverage, Windows 2000 claimed about 90% coverage if you look at most&nbsp;resources. The remaining 10%? As discussed in <A class="" href="http://www.microsoft.com/globaldev/DrIntl/faqs/muifaq.mspx#MUIques4" mce_href="http://www.microsoft.com/globaldev/DrIntl/faqs/muifaq.mspx#MUIques4">Question #4 of the MUI FAQ</A>:</P>
<BLOCKQUOTE>
<P mce_keep="true"><EM>Much of the additional localized coverage in Windows XP is achieved through "MUI-enabling" Windows XP system modules and applications, specifically by: </EM></P>
<OL>
<LI>
<DIV mce_keep="true"><EM>Transferring User Interface strings from the registry to Windows resource files.</EM></DIV></LI>
<LI>
<DIV mce_keep="true"><EM>Removing User Interface strings from the kernel.</EM></DIV></LI>
<LI>
<DIV mce_keep="true"><EM>Using the MUI-enabled shell to display localized strings for Start menu items, desktop shortcuts, shell menu items, file type names and shell verbs (shell's right-click menu items).</EM></DIV></LI>
<LI>
<DIV mce_keep="true"><EM>Making Windows services impersonate the current interactive user instead of the system default when displaying User Interface.</EM></DIV></LI>
<LI>
<DIV mce_keep="true"><EM>Barring the use of hard-coded file paths when loading resource files including help files, so that an alternate resource path can be used to load the resource file.</EM></DIV></LI>
<LI>
<DIV mce_keep="true"><EM>Provide special code in each component to install and load the User Interface resource if a non traditional Win-32 resource is used (such as XML or HTML based resource)</EM></DIV></LI></OL></BLOCKQUOTE>
<P mce_keep="true">Now item #1 was largely handled by taking hard-coded registry strings in the registry and changing them to&nbsp;a new format that allowed one to redirect the resource loading to a DLL somewhere (and the DLLs by supporting MUI can handle multiple different languages).</P>
<P mce_keep="true">This format works quite well not only for <A class="" href="http://msdn2.microsoft.com/library/bb759919.aspx" mce_href="http://msdn2.microsoft.com/library/bb759919.aspx">SHLoadIndirectString</A>&nbsp;but also for the new&nbsp;<A class="" href="http://msdn2.microsoft.com/library/ms724890.aspx" mce_href="http://msdn2.microsoft.com/library/ms724890.aspx">RegLoadMUIString</A> in Vista as well (since SHLWAPI is a bit higher in the food chain than some callers needed it to be for items like time zones and since in most cases the strings were indeed stored in the registry, this new function was quite a useful addition!).</P>
<P mce_keep="true">But their use is definitely not central to MUI.</P>
<P mce_keep="true">They can be thought of as one of the crucial percentages of the last 10% of MUI. :-)</P>
<P mce_keep="true">Whether&nbsp;a user would need either of these functions is not entirely clear though -- the only way either one would be needed was if you were storing resources in a non-MUI friendly format like in the registry or a text file or an INI/INF file, and you wanted to redirect that string load without re-architecting the application. Which is not the most common scenario for most applications.</P>
<P mce_keep="true">One of the most common scenarios where one wants to avoid re-architecting things is when one has a backcompat requirement. However, as I hinted at in <A class="" href="http://archives.miloush.net/michkap/archive/2006/12/22/1350684.html" mce_href="http://archives.miloush.net/michkap/archive/2006/12/22/1350684.html"><STRONG>Sometimes when sorting the index is the last thing you want to use</STRONG></A>, there is often a cost to taking this approach.</P>
<P mce_keep="true">For example, if you look at the keyboard layout names (migrated in XP to this indirect format and a <A class="" href="http://msdn2.microsoft.com/library/bb759919.aspx" mce_href="http://msdn2.microsoft.com/library/bb759919.aspx">SHLoadIndirectString</A>&nbsp;call as I&nbsp;discussed <A class="" href="http://archives.miloush.net/michkap/archive/2006/05/06/591174.html" mce_href="http://archives.miloush.net/michkap/archive/2006/05/06/591174.html"><STRONG>here</STRONG></A>) or time zone names (migrated in Vista to this indirect format and a <A class="" href="http://msdn2.microsoft.com/library/ms724890.aspx" mce_href="http://msdn2.microsoft.com/library/ms724890.aspx">RegLoadMUIString</A>&nbsp;call in Vista as I discussed <A class="" href="http://archives.miloush.net/michkap/archive/2006/12/22/1350684.html" mce_href="http://archives.miloush.net/michkap/archive/2006/12/22/1350684.html"><STRONG>here</STRONG></A>), you have to compare the two models:</P>
<UL>
<LI>
<DIV mce_keep="true">The old way of doing things allowed applications loading the strings to&nbsp;use only the initial install language of Windows;</DIV></LI>
<LI>
<DIV mce_keep="true">The new way of doing things allowed any installed UI language to be used, but apps using the old way would on;y ever load English strings.</DIV></LI></UL>
<P mce_keep="true">A good example of such an application is older versions of Outlook, which used the time zone strings in their own UI:</P>
<P mce_keep="true"><IMG src="http://trigeminal.fmsinc.com/images/outlook_tz.png"></P>
<P mce_keep="true">Now suddenly in Vista, those strings which were previously localized into the initial install language of Windows (which sucks since they did not respect the user's&nbsp;UI language of either Windows or Office) were now always English (which sucks worse since they now respected neither the initial install language nor the user's UI language) -- unless they made a code change.</P>
<P mce_keep="true">The code change is not unreasonable for new applications and/or new versions, but asking Outlook all the way back to Outlook 97 to change after the fact might cross the line of reasonable request.</P>
<P mce_keep="true">But wait a moment -- before you think of poor innocent downlevel Outlook, keep in mind that these registry keys were never documented or supported, and they were therefore just hitching an illegal ride with Windows. Nothing would have kept them from doing their own localization efforts&nbsp;in this space other than the desire to avoid the extra maintenance of keeping the strings in sync with Windows, therefore an honest an unbiased assessment of that fact will change such apps in our eyes from innocent martyrs injured by&nbsp;the big bad Vista to cynical bastards who had been existing on borrowed time for far too many versions.</P>
<P mce_keep="true">Now I will talk more about <A class="" href="http://msdn2.microsoft.com/library/bb759919.aspx" mce_href="http://msdn2.microsoft.com/library/bb759919.aspx">SHLoadIndirectString</A>&nbsp;and&nbsp;<A class="" href="http://msdn2.microsoft.com/library/ms724890.aspx" mce_href="http://msdn2.microsoft.com/library/ms724890.aspx">RegLoadMUIString</A>&nbsp;soon, as there is some interesting under-the-covers stuff to talk about there, too. :-)</P>
<P mce_keep="true">&nbsp;</P>
<P mce_keep="true"><FONT color=#ff00ff><EM>This post brought to you by</EM><FONT size=5> ‰∑ò<EM><FONT size=2>and</FONT></EM> íÅÅ </FONT><EM>(<A class="" href="http://www.fileformat.info/info/unicode/char/4dd8" mce_href="http://www.fileformat.info/info/unicode/char/4dd8">U+4dd8</A>&nbsp;and <A class="" href="http://www.fileformat.info/info/unicode/char/12041" mce_href="http://www.fileformat.info/info/unicode/char/12041">U+12041</A>, a.k.a. HEXAGRAM FOR INNOCENCE and CUNEIFORM SIGN BAD)</EM></FONT></P>
<hr/><div style="margin-left: 1em"><em>no comments</em></div><hr/><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2007/10/31/5796846.html" title="The L word (Limonata, I mean - the *other* L word)">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2007/10/30/5774614.html" title="EXPECTED is in the eye of the [non-expecting type of ]expectant">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2007-10">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2007-10-31">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2007/10/31/5790802.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:37 GMT -->
</html>