<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2007/10/08/5270854.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:37 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>A&P of Sort Keys, part 12 (aka Han sorts first!)</title></head><body>
<h1>A&P of Sort Keys, part 12 (aka Han sorts first!)</h1>
<p><em>by Michael S. Kaplan, published on 2007/10/08 10:31 -04:00, original URI: http://blogs.msdn.com/b/michkap/archive/2007/10/08/5270854.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostNew -->
<P>Previous posts in this series:</P>
<UL>
<LI>Part 0: <STRONG><A class="" href="http://archives.miloush.net/michkap/archive/2007/09/10/4847780.html" mce_href="http://archives.miloush.net/michkap/archive/2007/09/10/4847780.html">The empty string sorts the same in every language</A></STRONG> 
<LI>Part 1: <STRONG><A class="" href="http://archives.miloush.net/michkap/archive/2007/09/11/4861436.html" mce_href="http://archives.miloush.net/michkap/archive/2007/09/11/4861436.html">The law of the letter -- e.g. Latin &lt; Greek &lt; Cyrillic</A></STRONG> 
<LI>Part 2: <A class="" href="http://archives.miloush.net/michkap/archive/2007/09/12/4875560.html" mce_href="http://archives.miloush.net/michkap/archive/2007/09/12/4875560.html"><STRONG>The string that won? Didn't have a mark on him!</STRONG></A> 
<LI>Part 3: <A class="" href="http://archives.miloush.net/michkap/archive/2007/09/13/4889199.html" mce_href="http://archives.miloush.net/michkap/archive/2007/09/13/4889199.html"><STRONG>Should you let a string make it's case? If so, Y?</STRONG></A> 
<LI>Part 4: <A class="" href="http://archives.miloush.net/michkap/archive/2007/09/14/4905625.html" mce_href="http://archives.miloush.net/michkap/archive/2007/09/14/4905625.html"><STRONG>It isn't a race but let's make an EXCEPTION and cross the Finnish line</STRONG></A> 
<LI>Part 5: <A class="" href="http://archives.miloush.net/michkap/archive/2007/09/15/4924008.html" mce_href="http://archives.miloush.net/michkap/archive/2007/09/15/4924008.html"><STRONG>EXPANSIONing your horizons</STRONG></A> 
<LI>Part 6: <A class="" href="http://archives.miloush.net/michkap/archive/2007/09/16/4937196.html" mce_href="http://archives.miloush.net/michkap/archive/2007/09/16/4937196.html"><STRONG>Relax, be calm, and deCOMPRESS if you are feeling out of sorts</STRONG></A> 
<LI>Part 7: <A class="" href="http://archives.miloush.net/michkap/archive/2007/09/17/4950008.html" mce_href="http://archives.miloush.net/michkap/archive/2007/09/17/4950008.html"><STRONG>You're very thin now, but I can still recognize you</STRONG></A> 
<LI>Part 8: <A class="" href="http://archives.miloush.net/michkap/archive/2007/09/18/4971376.html" mce_href="http://archives.miloush.net/michkap/archive/2007/09/18/4971376.html"><STRONG>You can often think of ignoring weights as a form of ignorance</STRONG></A> 
<LI>Part 9: <A class="" href="http://archives.miloush.net/michkap/archive/2007/09/20/5008305.html" mce_href="http://archives.miloush.net/michkap/archive/2007/09/20/5008305.html"><STRONG>Not always transitive, but punctual and punctuating</STRONG></A></LI>
<LI>Part 10: <A class="" href="http://archives.miloush.net/michkap/archive/2007/09/21/5027338.html" mce_href="http://archives.miloush.net/michkap/archive/2007/09/21/5027338.html"><STRONG>I've kana wanted to start talking about Japanese</STRONG></A></LI>
<LI>Part 11: <A class="" href="http://archives.miloush.net/michkap/archive/2007/09/24/5085893.html" mce_href="http://archives.miloush.net/michkap/archive/2007/09/24/5085893.html"><STRONG>It's not like ideographic sorts were developed idiopathically</STRONG></A></LI></UL>
<P>Sorry for the small vacation from the series, but being in Cleveland&nbsp;for a week&nbsp;kind of threw off the schedule a bit. Hopefully if you had been following along you are still around. :-)</P>
<P>This post is not going to be about Han Solo and whether he shot first in the Star Wars scene with the bounty hunter Greedo. If you are here for that, see <A href="http://www.hanshootsfirst.org/">http://www.hanshootsfirst.org/</A>&nbsp;or the <A class="" href="http://en.wikipedia.org/wiki/Han_shot_first" mce_href="http://en.wikipedia.org/wiki/Han_shot_first">Wikipedia article</A> about the issue.</P>
<P>Or you can see the <A class="" href="http://www.hellblazer.net/2007/07/23/recursion-shot-first/" mce_href="http://www.hellblazer.net/2007/07/23/recursion-shot-first/">Recursion shot first!</A> article for am amusing photo of George Lucas wearing a t-shirt that says Han Shot First while talking to Harrison Ford.</P>
<P>This article, unlike those, is (sort of) about Chinese ideographs (which is what I promised in the last article) in part, although with a minor diversion into Korean.</P>
<P>Now if you want to be absolutely technical, Chinese ideographs (or ideograms if you prefer) actually aren't ideographs at all; they are logographs (or logograms if you prefer), since they represent morphemes (words) and not ideas. But that is neither here nor there for the purposes of this article.</P>
<P>And Unicode (which calls them ideographs)&nbsp;is not about linguistics, it is about scripts, anyway. It is how they get all into symbols without feeling like that have to take a shower afterward&nbsp;:-)</P>
<P mce_keep="true">In Korean, the Han are called Hanja, and on Windows they tend to sort after their most common Hangul pronunciation, something that has been true for quite a long time. Of course there is an occupational hazard here since the "most common pronunciation" can tend to change over time, but Hanja are not nearly as common in Korean as Hangul (they are even less common in North Korea, a place for which Windows ships with no locale of its own for Wassenaar Arrangement reasons....</P>
<P mce_keep="true"><EM>Speaking of which, there is not a whole lot Microsoft can do to support the North Korean view on Hangul compared to the South Korean one, as I disussed in <A class="" href="http://archives.miloush.net/michkap/archive/2006/03/12/549951.html" mce_href="http://archives.miloush.net/michkap/archive/2006/03/12/549951.html"><STRONG>Traditional versus mondern sorts</STRONG></A>, and which would make for a fascinating technical problem if it were not such a stifling political one....</EM></P>
<P mce_keep="true">It is also a little known fact that pre-Vista, on Windows the Hanja (along with the Hangul) tends to sort before all of the other scripts (something not true of CJK Extension A or CJK Extension B, but true of most of the rest in the table). I mentioned this years ago in <A class="" href="http://archives.miloush.net/michkap/archive/2004/12/31/344888.html" mce_href="http://archives.miloush.net/michkap/archive/2004/12/31/344888.html"><STRONG>Unlike LCMapString, the sort keys for English characters precede the sort keys for Korean</STRONG></A>, where I also explained that this order changes does not happen in .NET. </P>
<P mce_keep="true">In Vista, the new sort version was an opportunity to fix this inconsistency (which was particularly painful for its effect on the ,.NET Compact Framework, which used the built-in CE tables and thus would have different results than the regular .NET Framework).</P>
<P mce_keep="true">It is particularly jarring even in Windows if you aren't expecting it (as seen in the sort key values for these items, mostly from the top of the table:</P>
<BLOCKQUOTE><FONT face="Consolas,Lucida Console,Courier New,Courier">
<P mce_keep="true"><STRONG><A class="" href="http://www.fileformat.info/info/unicode/char/ffa1" mce_href="http://www.fileformat.info/info/unicode/char/ffa1">U+ffa1</A>&nbsp;&nbsp;&nbsp; </STRONG><FONT size=3>ﾡ</FONT><STRONG>&nbsp;&nbsp;&nbsp; &nbsp;HALFWIDTH HANGUL LETTER KIYEOK<BR><A class="" href="http://www.fileformat.info/info/unicode/char/3131" mce_href="http://www.fileformat.info/info/unicode/char/3131">U+3131</A>&nbsp;&nbsp;&nbsp; </STRONG><FONT size=3>ㄱ</FONT><STRONG>&nbsp; &nbsp;&nbsp;HANGUL LETTER KIYEOK<BR><A class="" href="http://www.fileformat.info/info/unicode/char/3200" mce_href="http://www.fileformat.info/info/unicode/char/3200">U+3200</A>&nbsp;&nbsp;&nbsp; </STRONG><FONT size=3>㈀</FONT><STRONG> &nbsp;&nbsp;&nbsp;PARENTHESIZED HANGUL KIYEOK<BR><A class="" href="http://www.fileformat.info/info/unicode/char/3260" mce_href="http://www.fileformat.info/info/unicode/char/3260">U+3260</A>&nbsp;&nbsp;&nbsp; </STRONG><FONT size=3>㉠</FONT><STRONG>&nbsp;&nbsp;&nbsp; CIRCLED HANGUL KIYEOK<BR><A class="" href="http://www.fileformat.info/info/unicode/char/ac00" mce_href="http://www.fileformat.info/info/unicode/char/ac00">U+ac00</A>&nbsp;&nbsp;&nbsp; </STRONG><FONT size=3>가</FONT><STRONG>&nbsp;&nbsp;&nbsp; HANGUL SYLLABLE KIYEOK A<BR><A class="" href="http://www.fileformat.info/info/unicode/char/320e" mce_href="http://www.fileformat.info/info/unicode/char/320e">U+320e</A>&nbsp;&nbsp;&nbsp; </STRONG><FONT size=3>㈎</FONT><STRONG>&nbsp;&nbsp;&nbsp; PARENTHESIZED HANGUL KIYEOK A<BR><A class="" href="http://www.fileformat.info/info/unicode/char/326e" mce_href="http://www.fileformat.info/info/unicode/char/326e">U+326e</A>&nbsp;&nbsp;&nbsp; </STRONG><FONT size=3>㉮</FONT><STRONG>&nbsp;&nbsp;&nbsp; CIRCLED HANGUL KIYEOK A<BR><A class="" href="http://www.fileformat.info/info/unicode/char/4f3d" mce_href="http://www.fileformat.info/info/unicode/char/4f3d">U+4f3d</A>&nbsp;&nbsp;&nbsp; </STRONG><FONT size=3>伽</FONT><STRONG>&nbsp;&nbsp;&nbsp; CJK UNIFIED IDEOGRAPH <BR><A class="" href="http://www.fileformat.info/info/unicode/char/4f73" mce_href="http://www.fileformat.info/info/unicode/char/4f73">U+4f73</A>&nbsp;&nbsp;&nbsp; </STRONG><FONT size=3>佳</FONT><STRONG>&nbsp;&nbsp;&nbsp; CJK UNIFIED IDEOGRAPH<BR><A class="" href="http://www.fileformat.info/info/unicode/char/0041" mce_href="http://www.fileformat.info/info/unicode/char/0041">U+0041</A>&nbsp;&nbsp;&nbsp; </STRONG><FONT size=3>A</FONT><STRONG> &nbsp;&nbsp;&nbsp; LATIN CAPITAL LETTER A</STRONG></P></FONT></BLOCKQUOTE>
<P mce_keep="true">Some of you may notice a <A class="" href="http://www.fileformat.info/info/unicode/char/ffa1" mce_href="http://www.fileformat.info/info/unicode/char/ffa1">U+ffa1</A> that faces the opposite direction of the other KIYEOK values -- no font seems to want to claim this reversed character, which is very weird. But it is right in Arial Unicode MS so there is some random font GDI is getting a glyph from sometimes that is just wrong....</P>
<P mce_keep="true">Anyway, looking at the sort keys, in English vs. in Korean:</P>
<BLOCKQUOTE><FONT face="Consolas,Lucida Console,Courier New,Courier">
<P mce_keep="true">en-US&nbsp; ﾡ&nbsp;&nbsp;&nbsp;&nbsp; <FONT color=#009900>80 02</FONT> 01 01 <FONT color=#0000ff>06</FONT> 01 01 00 (or <FONT color=#009900>52 02</FONT> 01 01 <FONT color=#0000ff>06</FONT> 01 01 00 on&nbsp;Server 2003)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ㄱ&nbsp;&nbsp;&nbsp; <FONT color=#009900>80 02</FONT> 01 01 <FONT color=#0000ff>07</FONT> 01 01 00 (or <FONT color=#009900>52 02</FONT> 01 01 <FONT color=#0000ff>07</FONT> 01 01 00 on&nbsp;Server 2003)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ㈀&nbsp;&nbsp;&nbsp; <FONT color=#009900>80 02</FONT> 01 <FONT color=#ff0000>0a</FONT> 01 01 01 00 (or <FONT color=#009900>52 02</FONT> 01 <FONT color=#ff0000>0a </FONT>01 01 01 00 on&nbsp;Server 2003)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ㉠&nbsp;&nbsp;&nbsp; <FONT color=#009900>80 02</FONT> 01 <FONT color=#ff0000>0c</FONT> 01 01 01 00 (or <FONT color=#009900>52 02</FONT> 01&nbsp;<FONT color=#ff0000>0c</FONT> 01 06 01 01 00 on&nbsp;Server 2003)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 가&nbsp;&nbsp;&nbsp; <FONT color=#009900>80 03</FONT> 01 01 01 01 00&nbsp;&nbsp;&nbsp; (or <FONT color=#009900>52 03</FONT> 01 01 01 01 00 on&nbsp;Server 2003)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ㈎&nbsp;&nbsp;&nbsp; <FONT color=#009900>80 03</FONT> 01 <FONT color=#ff0000>0a</FONT> 01 01 01 00 (or <FONT color=#009900>52 03</FONT> 01&nbsp;<FONT color=#ff0000>0a</FONT> 01 01 01 00 on&nbsp;Server 2003)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ㉮&nbsp;&nbsp;&nbsp; <FONT color=#009900>80 03</FONT> 01 <FONT color=#ff0000>0c</FONT> 01 01 01 00 (or <FONT color=#009900>52 03</FONT> 01&nbsp;<FONT color=#ff0000>0c</FONT> 01&nbsp;01 01 00 on&nbsp;Server 2003)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 伽&nbsp;&nbsp;&nbsp; <FONT color=#009900>9f 60</FONT> 01 01 01 01 00&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 佳&nbsp;&nbsp;&nbsp; <FONT color=#009900>9f 96</FONT> 01 01 01 01 00<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; A&nbsp;&nbsp;&nbsp;&nbsp; <FONT color=#009900>0e 02</FONT> 01 01&nbsp;<FONT color=#0000ff>12</FONT> 01 01 00<BR><BR>ko-KR&nbsp; ﾡ&nbsp; &nbsp;&nbsp; <FONT color=#009900>0e 02</FONT> 01 01&nbsp;<FONT color=#0000ff>06</FONT> 01 01 00<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ㄱ&nbsp;&nbsp;&nbsp; <FONT color=#009900>0e 02</FONT> 01 01&nbsp;<FONT color=#0000ff>07</FONT> 01 01 00<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ㈀&nbsp;&nbsp;&nbsp; <FONT color=#009900>0e 02</FONT> 01 <FONT color=#ff0000>0a</FONT> 01 01 01 00<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ㉠&nbsp;&nbsp;&nbsp; <FONT color=#009900>0e 02</FONT> 01 <FONT color=#ff0000>0c</FONT> 01 01 01 00<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 가&nbsp;&nbsp;&nbsp; <FONT color=#009900>0e 03</FONT> 01 01 01 01 00<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ㈎&nbsp;&nbsp;&nbsp; <FONT color=#009900>0e 03</FONT> 01 <FONT color=#ff0000>0a</FONT> 01 01 01 00<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ㉮&nbsp;&nbsp;&nbsp; <FONT color=#009900>0e 03</FONT> 01 <FONT color=#ff0000>0c</FONT> 01 01 01 00<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 伽&nbsp;&nbsp;&nbsp; <FONT color=#009900>0e 03</FONT> 01 <FONT color=#ff0000>41</FONT> 01 01 01 00<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 佳&nbsp;&nbsp;&nbsp; <FONT color=#009900>0e 03</FONT> 01 <FONT color=#ff0000>43</FONT> 01 01 01 00<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; A&nbsp;&nbsp; &nbsp; <FONT color=#009900>80 02</FONT> 01 01 <FONT color=#0000ff>12</FONT> 01 01 00</P></FONT></BLOCKQUOTE>
<P mce_keep="true">Notice the changes that literally swap the first letter in the DEFAULT table (A) with the first character in the Korean table in the Korean sort? It is easy if you live in the USA and English is your native language to claim that the script positions are arbitrary and use that as the basis to object to this re-ordering in Korean, but I can understand the original desire to put Korean first in a Korean sort (as someone who happens to be from a place that has always listed first and a person who's last name never shows up first or last in an alphabetized list!).</P>
<P mce_keep="true">Notice also how the Hangul do something fairly&nbsp;consistently always, even if the Hanja only follow for Korean.</P>
<P mce_keep="true">And finally, did you see the change in Server 2003? Although no substantive comment or bug or spec came with the change, it happened in the same checkin as the one I mentioned in <A class="" href="http://archives.miloush.net/michkap/archive/2007/08/28/4605786.html" mce_href="http://archives.miloush.net/michkap/archive/2007/08/28/4605786.html"><STRONG>Every character has a story #29: U+1000^H^H^H^H0f40, (TIBETAN or MYANMAR LETTER KA, depending on when you ask)</STRONG></A>, although unlike the parts I discussed in that post, the changes here have very little to do with Unicode conformance; they relate to a desire to not have Hangul to sort in with the same weight range that is shared among all of the East Asian collations (because even though Hangul does not mean much within Chinese or Japanese, it can still be unsettling if you have Hangul within your data and you see it showing up randomly inside your Han or your Kanji.</P>
<P mce_keep="true">And I know that the upset is not just my assumption, since after this change was reverted in Vista (we could not afford that much space in the weight table to support such a complete non-scenario), we received several internal bug reports from people who had such data (either accidentally or as a set of test data) who were curious about the strange interspersion of Korean....</P>
<P mce_keep="true">BONUS INFO (feel free to file it under "How to be incompatible with everybody!"): </P>
<BLOCKQUOTE>
<P mce_keep="true">SQL Server has managed to skip all of this shifting around done in Server 2003 and Vista since its tables are based on the Win2000 off-Beta data (as I explained in detail <A class="" href="http://archives.miloush.net/michkap/archive/2005/09/13/463962.html" mce_href="http://archives.miloush.net/michkap/archive/2005/09/13/463962.html"><STRONG>here</STRONG></A>); on the negative side of that is the fact that SQLCLR results between&nbsp;SQL Server and the Common Language Runtime and completely inconsistent in every possible way (since the managed tables are based on Server 2003 plus losing the "Korean first" code)....</P></BLOCKQUOTE>
<P mce_keep="true">&nbsp;</P>
<P><FONT color=#ff00ff><EM>This post brought to you by</EM> <FONT size=5>⑫</FONT> <EM>(<A class="" href="http://www.fileformat.info/info/unicode/char/246b" mce_href="http://www.fileformat.info/info/unicode/char/246b">U+246b</A>, a.k.a. CIRCLED NUMBER TWELVE)</EM></FONT></P>
<hr/><div style="margin-left: 1em"><em>no comments</em></div><hr/><p><em>referenced by</em></p><div style="margin-left: 1em"><p>2010/11/09 <a href="http://archives.miloush.net/michkap/archive/2010/11/09/10087473.html">I [will have] told you so! Well, perhaps too late (all things considered)...</a></p><p>2008/08/21 <a href="http://archives.miloush.net/michkap/archive/2008/08/21/8883467.html">A&P of Sort Keys, part 14: The Hangul is really getting OLD</a></p><p>2008/02/19 <a href="http://archives.miloush.net/michkap/archive/2008/02/19/7791306.html">The most important language in the whole wide world is yours, and you hardly even know yours! -- NOT!</a></p><p>2007/10/09 <a href="http://archives.miloush.net/michkap/archive/2007/10/09/5375754.html">A&P of Sort Keys, part 13 (About the function that is too lazy to get it right every time)</a></p></div><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2007/10/08/5320425.html" title="The roadꂸ to the solution starts with identifying the actual problem.NET">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2007/10/07/5349626.html" title="Three kinds of people I know (differences defined by their connection to this blog)">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2007-10">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2007-10-08">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2007/10/08/5270854.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:37 GMT -->
</html>