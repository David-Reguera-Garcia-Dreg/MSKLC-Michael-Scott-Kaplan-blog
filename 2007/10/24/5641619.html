<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2007/10/24/5641619.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:37 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>In Case you have problems that you might think are ǸȦȘȚȲ</title></head><body>
<h1>In Case you have problems that you might think are ǸȦȘȚȲ</h1>
<p><em>by Michael S. Kaplan, published on 2007/10/24 10:31 -04:00, original URI: http://blogs.msdn.com/b/michkap/archive/2007/10/24/5641619.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostNew -->
<P>People often don't understand the consequences of the case insensitive file system provided by NTFS.</P>
<P>So today I will show an extreme example of a [im]possibly complicated situation....</P>
<P>So, we'll start with our characters:</P>
<UL>
<LI><FONT size=4>Ǹ/ǹ</FONT> &nbsp;&nbsp; <FONT face="courier new,courier"><A class="" href="http://www.fileformat.info/info/unicode/char/01f8" mce_href="http://www.fileformat.info/info/unicode/char/01f8">U+01f8</A>/<A class="" href="http://www.fileformat.info/info/unicode/char/01f9" mce_href="http://www.fileformat.info/info/unicode/char/01f9">U+01f9</A>&nbsp;&nbsp;&nbsp; LATIN [CAPITAL|SMALL] LETTER N WITH GRAVE</FONT></LI>
<LI><FONT size=4>Ȧ/ȧ</FONT>&nbsp; &nbsp; <FONT face="courier new,courier"><A class="" href="http://www.fileformat.info/info/unicode/char/0226" mce_href="http://www.fileformat.info/info/unicode/char/0226">U+0226</A>/<A class="" href="http://www.fileformat.info/info/unicode/char/0227" mce_href="http://www.fileformat.info/info/unicode/char/0227">U+0227</A>&nbsp;&nbsp;&nbsp; LATIN [CAPITAL|SMALL] LETTER A WITH DOT ABOVE</FONT></LI>
<LI><FONT size=4>Ș/ș</FONT>&nbsp;&nbsp; &nbsp;<FONT face="courier new,courier"><A class="" href="http://www.fileformat.info/info/unicode/char/0218" mce_href="http://www.fileformat.info/info/unicode/char/0218">U+0218</A>/<A class="" href="http://www.fileformat.info/info/unicode/char/0219" mce_href="http://www.fileformat.info/info/unicode/char/0219">U+0219</A>&nbsp;&nbsp;&nbsp; LATIN [CAPITAL|SMALL] LETTER S WITH COMMA BELOW</FONT></LI>
<LI><FONT size=4>Ț/ț</FONT>&nbsp; &nbsp; <FONT face="courier new,courier"><A class="" href="http://www.fileformat.info/info/unicode/char/021a" mce_href="http://www.fileformat.info/info/unicode/char/021a">U+021a</A>/<A class="" href="http://www.fileformat.info/info/unicode/char/021b" mce_href="http://www.fileformat.info/info/unicode/char/021b">U+021b</A>&nbsp;&nbsp;&nbsp; LATIN [CAPITAL|SMALL] LETTER T WITH COMMA BELOW</FONT></LI>
<LI><FONT size=4>Ȳ/ȳ</FONT> &nbsp;&nbsp; <FONT face="courier new,courier"><A class="" href="http://www.fileformat.info/info/unicode/char/0232" mce_href="http://www.fileformat.info/info/unicode/char/0232">U+0232</A>/<A class="" href="http://www.fileformat.info/info/unicode/char/0233" mce_href="http://www.fileformat.info/info/unicode/char/0233">U+0233</A>&nbsp;&nbsp;&nbsp; LATIN [CAPITAL|SMALL] LETTER Y WITH MACRON</FONT></LI></UL>
<P>Then we'll take two jump drives that are 500mb each, and format them both with NTFS (one in XP and one with Vista -- the one with <A class="" href="http://archives.miloush.net/michkap/archive/2005/08/20/454071.html" mce_href="http://archives.miloush.net/michkap/archive/2005/08/20/454071.html"><STRONG>the updated casing table</STRONG></A>)....</P>
<P><IMG height=660 src="http://trigeminal.fmsinc.com/images/nasty01.png" width=457></P>
<P>Now we will take those ten characters above and combine them in various five character blocks, creating files on the NTFS 5.1 partition:</P>
<P><IMG height=653 src="http://trigeminal.fmsinc.com/images/nasty02.png" width=748></P>
<P>Note that this is on a Vista platform....</P>
<P>Of course the innocent NTFS 6.0 jump drive is sitting there, empty and anxious:</P>
<P><IMG src="http://trigeminal.fmsinc.com/images/nasty03.png"></P>
<P>What happens if we try and copy our thirty files to this other drive?</P>
<P>Well, the first one will work (any one of them). But any attempt to copy a second file will give a nice prompt:</P>
<P><IMG height=823 src="http://trigeminal.fmsinc.com/images/nasty04.png" width=1102></P>
<P>So how can the world of file systems survive the changes here?</P>
<P>Well, for the most part because the whole scenario is NASTY.</P>
<P>Who on earth but a tester or an ornery language person like me would put those thirty files on a drive, just to prove he could, just to write a blog post?</P>
<P>Back on planet earth, people are disappointed if case pairs are not recognized; this is not a feature they hate.</P>
<P>But there is another aspect here too; if you have a built-in drive on the machine that has a casing table unlike the one on the machine, at boot time you will often see a CHKDSK run replacing the casing tale on the drive with the one on the OS itself (in fact if you dual boot between XP and Vista you can even see each of them "fixing up" the drive this way at boot time). Imagine the consequences if you keep an MRU list and then try to use it after a reboot -- you could easily be selecting&nbsp;a different file than you did prior to that reboot!</P>
<P>(Shades of what to do with <A class="" href="http://archives.miloush.net/michkap/archive/2007/10/24/5647711.html" mce_href="http://archives.miloush.net/michkap/archive/2007/10/24/5647711.html"><STRONG>Getting the preserved case of a file wHeN tHe uSeRs tYpE wHaTeVeR tHe hElL tHeY wAnT tO</STRONG></A> in the above, right?)</P>
<P>But even if that drive with the thirty files is updated to the NTFS 6.0 casing table, no files are lost. They are all right there.</P>
<P>Even though you could not create that bunch of files yourself on the drive, you will see an issue similar to the one we saw with that <A class="" href="http://archives.miloush.net/michkap/archive/2005/09/28/474756.html" mce_href="http://archives.miloush.net/michkap/archive/2005/09/28/474756.html"><STRONG>FAT/FAT32 oddness on Win2000</STRONG></A> issue where the files are fine and you can access them and use them, even though you can't create them in a neighboring directory yourself.</P>
<P>It is why I harp on issues like&nbsp;I do with <A class="" href="http://archives.miloush.net/michkap/archive/2007/06/13/3280569.html" mce_href="http://archives.miloush.net/michkap/archive/2007/06/13/3280569.html"><STRONG>In any CASE, it is somewhat INSENSITIVE to point out to someone how well PRESERVED they are</STRONG></A> and <A class="" href="http://archives.miloush.net/michkap/archive/2007/06/18/3374502.html" mce_href="http://archives.miloush.net/michkap/archive/2007/06/18/3374502.html"><STRONG>If you don't always preserve case, you don't always preserve meaning</STRONG></A>&nbsp;and <A class="" href="http://archives.miloush.net/michkap/archive/2007/10/02/5236576.html" mce_href="http://archives.miloush.net/michkap/archive/2007/10/02/5236576.html"><STRONG>What happens when people don't consistently preserve case? They cause bugs!</STRONG></A>. </P>
<P>Because NTFS is intrinsically case sensitive underneath it all, and the illusion of case <STRONG>in</STRONG>sensitivity that is there is a layer atop the drive.</P>
<P>It is why so many of the <A class="" href="http://msdn2.microsoft.com/library/ms795378.aspx" mce_href="http://msdn2.microsoft.com/library/ms795378.aspx"><STRONG>IFS File System Runtime Library Routines</STRONG></A> take an optional&nbsp;pointer to an UpcaseTable -- because in this world where those things can change, it is important for the OS to accept those changes and respect that they can (and have, and will) happen.</P>
<P>The illusion of case insensitivity (ref: <A class="" href="http://support.microsoft.com/kb/100625" mce_href="http://support.microsoft.com/kb/100625">KB100625</A> and&nbsp;<A class="" href="http://techsupt.winbatch.com/TS/T000001036004F26.html" mce_href="http://techsupt.winbatch.com/TS/T000001036004F26.html">How Case Sensitive Filenames are Handled in the POSIX Subsystem under NTFS</A>)&nbsp;is one that is quite hard to maintain, and it is one that you can easily destroy in an application that tries to duplicate a behavior at higher levels without fully understand what is happening at lower levels....</P>
<P><EM>Now as I pointed out in </EM><A class="" href="http://archives.miloush.net/michkap/archive/2007/10/24/5647711.html" mce_href="http://archives.miloush.net/michkap/archive/2007/10/24/5647711.html"><STRONG><EM>Getting the preserved case of a file wHeN tHe uSeR tYpEs wHaTeVeR tHe hElL tHeY wAnT to</EM></STRONG></A><EM>, the rules for URLs are completely different, and I will talk about them soon as many people find them complicated and in some cases genuinely disturbing!</EM></P>
<P mce_keep="true">&nbsp;</P>
<P><EM><FONT color=#ff00ff>This post brought to you by those&nbsp;ten letters I mentioned above....</FONT></EM></P>
<hr/><p><a id="5680233" href="#5680233">#</a> <strong>Jeff</strong> on 25 Oct 2007 6:18 PM:</p><div style="margin-left: 1em"><p>Holy crap. Wouldn't it be just easier (and more useful) to be case sensitive?</p>
<p>I've had it invisibly destroy data, where the files happened to be the same characters, but different case.</p>
<p>Why be a throwback to the FORTRAN days of 5-bit characters?</p></div>
<p><a id="5681048" href="#5681048">#</a> <strong>Michael S. Kaplan</strong> on 25 Oct 2007 7:19 PM:</p><div style="margin-left: 1em"><P>Short answer?</P>
<P>Because Windows has to for your mom, or someone's mom, a typical mom. One who does not understand people who claim that "A" is not "a" and so on.</P>
<P>More complicated? Sure. But that's why they don't pay us minimum wage to do it....</P></div>
<p><a id="5707879" href="#5707879">#</a> <strong>Cristian Secar&#196;ƒ</strong> on 27 Oct 2007 5:46 AM:</p><div style="margin-left: 1em"><p>&gt; Who on earth but a tester or an ornery language person [...]</p>
<p>Cannot remember how, but some time ago I noticed thst on a WinXP system, when I used the correct Romanain characters for some filenames. That's why I avoid them today in filenmes :)</p>
<p>I mentioned the case sensitive strange thing in my post here <a rel="nofollow" target="_new" href="http://archives.miloush.net/michkap/archive/2006/12/07/1232365.html#1236058">http://blogs.msdn.com/michkap/archive/2006/12/07/1232365.aspx#1236058</a> (strange how the RAR archiver can also handle them, while at the same time the WinZIP archiver cannot, as far as I remember)</p>
<p>Cristi</p></div>
<p><strong>Jan Kučera</strong> on 3 Dec 2007 7:58 AM:</p><div style="margin-left: 1em"><p>Although this scenario might seem quite NASTY, why does Vista the same thing when copying folders/files beginning/ending with space?</p>
<p>One question is whether to allow user to create such folders/files, but not be able to copy them when they are there is another one I think (which I feel should be supported).</p>
<p>I came to this just when I wanted to copy &quot;Folder&quot; and &quot; Folder&quot; from XP HDD to Vista's one. XP had no problems copying this by dragging in Explorer, but Vista refused. What was the reason for this change?</p>
<p>I am aware this is not a NTFS versioning related problem, though (sorry) (it can by workarounded by copying using the command line).</p>
</div>
<p><strong>Rosyna</strong> on 8 Dec 2007 2:35 AM:</p><div style="margin-left: 1em"><p>So what happens when you have a bunch of ignorable characters fighting it out?</p>
<p><a rel="nofollow" target="_new" href="http://xn--sailor-1ba3np0a.com/imgs/ignorable.png">http://sailor月.com/imgs/ignorable.png</a></p>
<p>Screenshot from a disk image I made.</p>
</div>
<p><strong>Michael S. Kaplan</strong> on 8 Dec 2007 5:24 PM:</p><div style="margin-left: 1em"><p>I am unable to see the screenshot -- the URL doesn't resolve....</p>
</div>
<p><strong>Rosyna</strong> on 8 Dec 2007 5:52 PM:</p><div style="margin-left: 1em"><p>Hm, resolves without issue on Safari. But if the browser you use cannot handle unicode domain names:</p>
<p>http://xn--sailor-183m.com/imgs/ignorable.png</p>
</div>
<p><strong>Michael S. Kaplan</strong> on 8 Dec 2007 5:58 PM:</p><div style="margin-left: 1em"><P>Okay, I see it now (and on my other machine!).</P>
<P>Well, they aren't really ignorable in the filesystem sense, on Windows <STRONG>or</STRONG> on the Mac. So they aren't really fighting it out at all, really!</P>
<P>You can do the same thing on Windows, too -- I was just focusing on the case insensitiviry across versions issue....</P></div>
<p><strong>Rosyna</strong> on 8 Dec 2007 7:08 PM:</p><div style="margin-left: 1em"><p>Oh, perhaps I should have clarified. This is only possible on Mac OS X if you have a case-sensitive file system. If you have a case-insensitive file system (HFS+), ignorables are ignored and basically case-folded (same end result as case-folding, at least). This makes it impossible to have these files in the same directory. You can't even make them at the lowest-level.</p>
<p>The screenshot I posted was from a case-sensitive file system (HFS+, Case-sensitive) where ignorables aren't ignored.</p>
<p>Ignorables not being ignored becomes a slight issue when round-tripping APIs. Some Web apps (like AIM, it seems) and servers will strip ignorables for security reasons and then give you back the string without the ignorables in them.</p>
</div>
<p><strong>Michael S. Kaplan</strong> on 8 Dec 2007 7:19 PM:</p><div style="margin-left: 1em"><P>Yep, we have those problems on Windows too if you call the higher level functions expecting the lower level fidelity....</P></div>
<hr/><p><em>referenced by</em></p><div style="margin-left: 1em"><p>2007/12/27 <a href="http://archives.miloush.net/michkap/archive/2007/12/27/6875879.html">No upproblems with $UpCase when you do a upVista upgrade</a></p><p>2007/12/08 <a href="http://archives.miloush.net/michkap/archive/2007/12/08/6708151.html">Social engineering in Windows Explorer....</a></p><p>2007/10/26 <a href="http://archives.miloush.net/michkap/archive/2007/10/26/5683410.html">All things being equal, your mom probably has an easier time with case insensitivity than not</a></p><p>2007/10/24 <a href="http://archives.miloush.net/michkap/archive/2007/10/24/5647711.html">Getting the preserved case of a file wHeN tHe uSeRs tYpE wHaTeVeR tHe hElL tHeY wAnT tO</a></p></div><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2007/10/24/5647711.html" title="Getting the preserved case of a file wHeN tHe uSeRs tYpE wHaTeVeR tHe hElL tHeY wAnT tO">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2007/10/24/5634778.html" title="Blog: 1; Blogger: 0 (aka You must think carefully before devoting yourself to a lifetime of blogging)">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2007-10">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2007-10-24">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2007/10/24/5641619.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:37 GMT -->
</html>