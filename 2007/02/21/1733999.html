<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2007/02/21/1733999.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:38 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>If we must be inconsistent, we should endeavor to be consistent about it</title></head><body>
<h1>If we must be inconsistent, we should endeavor to be consistent about it</h1>
<p><em>by Michael S. Kaplan, published on 2007/02/21 04:31 -05:00, original URI: http://blogs.msdn.com/b/michkap/archive/2007/02/21/1733999.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostNew -->
<P>The GEO stuff in the .NET Framework is not very consistent.</P>
<P>I mean, there is a <A class="" href="http://msdn2.microsoft.com/library/system.globalization.regioninfo.geoid.aspx" mce_href="http://msdn2.microsoft.com/library/system.globalization.regioninfo.geoid.aspx">RegionInfo.GeoId property</A> that will return the same GEOID value as a call to <A class="" href="http://msdn.microsoft.com/library/en-us/intl/nls_34rz.asp" mce_href="http://msdn.microsoft.com/library/en-us/intl/nls_34rz.asp">GetLocaleInfo</A> with an <A class="" href="http://msdn.microsoft.com/library/en-us/intl/nls_8rse.asp" mce_href="http://msdn.microsoft.com/library/en-us/intl/nls_8rse.asp">LCTYPE</A> value of LOCALE_IGEOID (0x0000005B for those who don''t have the latest copy of winnls.h) for a given locale.</P>
<P>But what about <A class="" href="http://msdn2.microsoft.com/library/system.globalization.regioninfo.currentregion.aspx" mce_href="http://msdn2.microsoft.com/library/system.globalization.regioninfo.currentregion.aspx">RegionInfo.CurrentRegion</A> and it's GeoId property? </P>
<P>After all, the GEOID value is the whole "Location" that is overrideable in Regional and Language Options. </P>
<P>And any time&nbsp;you look at data that can be overridden in the <A class="" href="http://msdn2.microsoft.com/library/system.globalization.cultureinfo.aspx" mce_href="http://msdn2.microsoft.com/library/system.globalization.cultureinfo.aspx">CultureInfo class</A> when accessed via <A class="" href="http://msdn2.microsoft.com/library/system.globalization.cultureinfo.currentculture.aspx" mce_href="http://msdn2.microsoft.com/library/system.globalization.cultureinfo.currentculture.aspx">CultureInfo.CurrentCulture</A>, you get the override. so why doesn't CurrentRegion give the same consideration?</P>
<P>Well, for starters there is no RegionInfo constructor that&nbsp;includes a parameter to control whether&nbsp;you allow overrides. And CultureInfo with overrides for the culture that happens to be the same as CurrentCulture. So if CurrentRegion allowed overrides to affect its value and CurrentRegion had the same behavior, then it would be impossible to get the GeoId for the current region if it is changed in Regional Options.</P>
<P>If an extra constructor were added, it would probably be too late to affect what CurrentRegion does since it would require changing the current behavior.</P>
<P>So RegionInfo and CultureInfo are not entirely consistent in the way they handle data that can be overridden.</P>
<P>Though on the other hand, <A class="" href="http://msdn.microsoft.com/library/en-us/intl/nls_34rz.asp" mce_href="http://msdn.microsoft.com/library/en-us/intl/nls_34rz.asp">GetLocaleInfo</A> is not very consistent with the way it handles LOCALE_IGEOID as opposed to all the other overrideable fields, either.</P>
<P>Which I guess means that <A class="" href="http://msdn2.microsoft.com/library/system.globalization.regioninfo.currentregion.aspx" mce_href="http://msdn2.microsoft.com/library/system.globalization.regioninfo.currentregion.aspx">RegionInfo.CurrentRegion</A> and it's <A class="" href="http://msdn2.microsoft.com/library/system.globalization.regioninfo.geoid.aspx" mce_href="http://msdn2.microsoft.com/library/system.globalization.regioninfo.geoid.aspx">RegionInfo.GeoId property</A>&nbsp;are consistent with their unmanaged cousin. So at least they are consistently inconsistent.</P>
<P>And on top of that, those user settings are per-thread in .NET; is there any real need for a per-thread GEOID? The other user data being per thread is weird enough, trust me.</P>
<P>You can always pinvoke to GetUserGeoID to get the current user's GEOID, after all:</P>
<BLOCKQUOTE><FONT face="Consolas,Lucida Console,Courier New,Courier"><B>
<P mce_keep="true">using System;<BR>using System.Runtime.InteropServices;<BR><BR>public class Test {<BR><BR>&nbsp;&nbsp;&nbsp; private enum GEOCLASS : int {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; NATION&nbsp; = 16,<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; REGION&nbsp; = 14,<BR>&nbsp;&nbsp;&nbsp; };<BR><BR>&nbsp;&nbsp;&nbsp; [DllImport("kernel32.dll", ExactSpelling=true, CallingConvention=CallingConvention.StdCall, SetLastError=true)]<BR>&nbsp;&nbsp;&nbsp; private static extern int GetUserGeoID(GEOCLASS GeoClass);<BR><BR>&nbsp;&nbsp;&nbsp; public static void Main() {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Console.WriteLine(GetUserGeoID(GEOCLASS.NATION));<BR>&nbsp;&nbsp;&nbsp; }<BR>}</P></B></FONT></BLOCKQUOTE>
<P mce_keep="true">Maybe the next version of the .NET Framework needs a <STRONG>GeoInfo class</STRONG> and that class needs a static <STRONG>CurrentGeo</STRONG> property? :-)</P>
<P mce_keep="true">&nbsp;</P>
<P mce_keep="true"><FONT color=#ff00ff><EM>This post brought to you by</EM>&nbsp;<FONT size=5>âˆº</FONT> <EM>(<A class="" href="http://www.fileformat.info/info/unicode/char/223a" mce_href="http://www.fileformat.info/info/unicode/char/223a">U+223a</A>, a.k.a. GEOMETRIC PROPORTION)</EM></FONT></P>
<hr/><p><a id="1737920" href="#1737920">#</a> <strong>Miral</strong> on 21 Feb 2007 7:27 PM:</p><div style="margin-left: 1em"><p>The culture stuff being per-thread is intended mainly for server applications, so that they can ask their clients what their culture is and then set the culture of the thread to match, so that they end up talking in the same language. &nbsp;Since a server will be processing multiple connections, each of which could be in different cultures, the culture settings are per-thread since usually a single thread does all the processing for a given connection.</p>
<p>I haven't looked at the RegionInfo stuff at all, but if there's an option that lets you set the current region (without affecting the Control Panel) then it'll be per-thread for exactly the same reason.</p></div>
<hr/><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2007/02/21/1736611.html" title="Here is what&#39;s up with localized paths in Vista (and in Windows!)">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2007/02/20/1724946.html" title="Dumb quotes... or maybe they are just smart-ass quotes">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2007-02">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2007-02-21">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2007/02/21/1733999.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:38 GMT -->
</html>