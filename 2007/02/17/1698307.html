<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2007/02/17/1698307.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:38 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>Giving a character a new identity (by giving it some secondary weight)</title></head><body>
<h1>Giving a character a new identity (by giving it some secondary weight)</h1>
<p><em>by Michael S. Kaplan, published on 2007/02/17 17:00 -05:00, original URI: http://blogs.msdn.com/b/michkap/archive/2007/02/17/1698307.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostNew -->
<P>Hatter Jiang asks over on the MSDN Forums:</P>
<BLOCKQUOTE>
<P><SPAN>I found a bug when I am programing:<BR>when I use like this:<BR><BR><FONT face="courier new,courier"><STRONG>"ｱｶｻﾀﾅﾊﾏﾔﾗﾜﾞ".IndexOf("ﾜ")<BR></STRONG></FONT><BR>is returns -1,when it should return 9;<BR>but <BR><BR><FONT face="courier new,courier"><STRONG>"ｱｶｻﾀﾅﾊﾏﾔﾗﾜﾞ".IndexOf('ﾜ') <BR></STRONG></FONT><BR>is OK.<BR><BR>and belows all worked well:<BR><BR><FONT face="courier new,courier"><STRONG>"ｱｶｻﾀﾅﾊﾏﾔﾗﾜ".IndexOf("ﾜ");<BR>"ｱｶｻﾀﾅﾊﾏﾔﾗﾜﾞ".IndexOf("ﾞ");<BR>"ｱｶｻﾀﾅﾊﾏﾔﾗﾜﾞ".IndexOf("ﾗ");<BR></STRONG></FONT><BR>My environment is :<BR>Windows XP SP2(English Edition + Mutil-Language Pack) + .NET Framework v2.0.50727+Visual Studio 2005<BR><BR><SPAN style="FONT-STYLE: italic">PS: It works well in javascript.</SPAN></SPAN></P></BLOCKQUOTE>
<P mce_keep="true">Although at least one other person also confirmed this&nbsp;to be&nbsp;a "bug", the truth is that it is entirely by design, and the way collation works on Windows and the .NET Framework.</P><SPAN>
<P>The trailing character at the end of the string is <A class="" href="http://www.fileformat.info/info/unicode/char/ff9e" mce_href="http://www.fileformat.info/info/unicode/char/ff9e">U+ff9e</A>, a.k.a. HALFWIDTH KATAKANA VOICED SOUND MARK. It is treated as a diacritic attached to the preceding character, and as such it modifies it's identity, the same way that a latin letter plus a diacritic is not equal to the latin letter by itself.</P>
<P>It is the same issue that causes people to mistakenly identify <A title=http://blogs.msdn.com/michkap/archive/2006/09/19/762106.aspx href="http://archives.miloush.net/michkap/archive/2006/09/19/762106.html"><STRONG>this issue</STRONG></A> as a bug.</P>
<P>In fairness to Hatter Jiang, this is not strictly speaking quite as clearcut of an issue as the other one when the&nbsp;TAB is used as the base character, since&nbsp;the HALFWIDTH KATAKANA VOICED SOUND MARK&nbsp;is not really identical to the European notion of a diacritic. But it is given a secondary weight, and this is the way secondary sort weights are handled in both managed and unmanaged code....</P>
<P>And if you want, you can always use the IgnoreDiacritic flag on the&nbsp;<A class="" href="http://msdn2.microsoft.com/library/ms143030(VS.80).aspx" mce_href="http://msdn2.microsoft.com/library/ms143030(VS.80).aspx">CompareInfo.IndexOf</A> method. :-)</P>
<P mce_keep="true">&nbsp;</P>
<P><FONT color=#ff00ff><EM>This post brought to you by</EM><FONT size=5> ﾞ </FONT><EM>(<A class="" href="http://www.fileformat.info/info/unicode/char/ff9e" mce_href="http://www.fileformat.info/info/unicode/char/ff9e">U+ff9e</A>, a.k.a. HALFWIDTH KATAKANA VOICED SOUND MARK)</EM></FONT></P></SPAN>
<hr/><p><a id="1700029" href="#1700029">#</a> <strong>dono</strong> on 17 Feb 2007 9:31 PM:</p><div style="margin-left: 1em"><p>Not to mention that attaching U+FF9E to wa is entirely meaningless. Also, it goes without saying that the velar glide /w/ is already voiced.</p></div>
<p><a id="1700042" href="#1700042">#</a> <strong>Jason Truesdell</strong> on 17 Feb 2007 9:34 PM:</p><div style="margin-left: 1em"><p>It's probably also important to point out that the reported behavior is more linguistically appropriate than what Hatter expects. ﾜﾞ should not match ﾜ. If the katakana were fullwidth, we wouldn't want to match ワ　for ヷ (not sure if that's actually in common use; see the brief <a rel="nofollow" target="_new" href="http://ja.wiktionary.org/wiki/ヷ">http://ja.wiktionary.org/wiki/%E3%83%B7</a>, which is in Japanese, for information); &quot;va&quot; does not contain &quot;wa&quot;. The default behavior of IndexOf seems to be consistent with Unicode KC normalization, which is almost always going to be more linguistically appropriate than a codepoint-only comparison.</p>
<p>Generally, ヷ will be substituted with ヴァ in Japanese typography anyway, so the issue is almost moot.</p>
<p>Of course, the character specified is tricky because this form is a fairly recent use of katakana, attempting to represent v sounds more faithfully in Japanese, and there are inconsistencies in actual usage. （バイオリン、ヴァイオリン, maybe even ヷイオリン could be imagined).</p>
<p>Some people argue that a search for バイオリン should include matches for ヴァイオリン, since they are relatively simple orthographic variants.</p>
<p>However, I doubt even they would want to have ヴァイ match ワイ　(vie/why). Accordingly, the default behavior of .IndexOf seems reasonable to me, and more appropriate than JavaScript's behavior.</p></div>
<hr/><p><em>referenced by</em></p><div style="margin-left: 1em"><p>2007/07/06 <a href="http://archives.miloush.net/michkap/archive/2007/07/06/3722803.html">A non-spacing mark and a diacritic are not always the same thing</a></p><p>2007/02/17 <a href="http://archives.miloush.net/michkap/archive/2007/02/17/1701561.html">Why I think System.String.IndexOf(Char) sucks</a></p></div><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2007/02/17/1701561.html" title="Why I think System.String.IndexOf(Char) sucks">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2007/02/16/1686988.html" title="The rumor was that SQL Server passwords are case insensitive?">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2007-02">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2007-02-17">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2007/02/17/1698307.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:38 GMT -->
</html>