<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2007/02/22/1738882.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:38 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>Getting the resource info you want</title></head><body>
<h1>Getting the resource info you want</h1>
<p><em>by Michael S. Kaplan, published on 2007/02/22 03:31 -05:00, original URI: http://blogs.msdn.com/b/michkap/archive/2007/02/22/1738882.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostNew -->
<P>Developer Eric asked on one of the internal aliases:</P>
<BLOCKQUOTE><FONT face="Times New Roman,Times" size=2><I>
<P>The following code fragment to query the original filename of notepad.exe will set pValue to “NOTEPAD.EXE.MUI” on Vista. Is this expected? I’m apparently getting the original file name of the language resources. I was expecting to get “NOTEPAD.EXE”. Is this the standard for all MUI apps, or could some be built to return “APP.EXE” and others “APP.EXE.MUI” ?</P></I>
<BLOCKQUOTE><FONT face="Consolas,Lucida Console,Courier New,Courier"><B>
<P>dwSize= GetFileVersionInfoSize( “C:\\windows\\system32\\notepad.exe”, &amp;dwHandle);<BR>buf= malloc( dwSize);<BR>GetFileVersionInfo( sPath, dwHandle, dwSize, buf);<BR>VerQueryValue( buf, L"\\StringFileInfo\\040904b0\\OriginalFilename", (LPVOID*)&amp;pValue, &amp;uLen);</P></B></FONT></BLOCKQUOTE><I>
<P>Thanks for any info.</P></I></FONT></BLOCKQUOTE>
<P mce_keep="true">To be honest I had no idea, but I forwarded it to the MUI dev team, and Sunggook knew the answer:</P>
<BLOCKQUOTE><FONT face="Times New Roman,Times" size=2><I>
<P mce_keep="true">Yes, it is expected behavior on Vista with MUI’ized files. <BR><BR>The default behavior of GetFileVersionInfo return merged info of LN and MUI file. Fixed information from LN and variable from MUI.&nbsp; <BR><BR>If you want to see LN file name like Notepad.exe, please use GetFileVersionInfoEx(FILE_VER_GET_NEUTRAL..).</P></I></FONT></BLOCKQUOTE>
<P mce_keep="true">And that does look to be the trick -- <A class="" href="http://msdn2.microsoft.com/library/aa969435.aspx" mce_href="http://msdn2.microsoft.com/library/aa969435.aspx">GetFileVersionInfoSizeEx</A>/<A class="" href="http://msdn2.microsoft.com/library/aa969434.aspx" mce_href="http://msdn2.microsoft.com/library/aa969434.aspx">GetFileVersionInfoEx</A> rather than <A class="" href="http://msdn2.microsoft.com/library/ms647005.aspx" mce_href="http://msdn2.microsoft.com/library/ms647005.aspx">GetFileVersionInfoSize</A>/<A class="" href="http://msdn2.microsoft.com/library/ms647003.aspx" mce_href="http://msdn2.microsoft.com/library/ms647003.aspx">GetFileVersionInfo</A>, using the appropriate flag to specify whether you want the language neutral resources or the localized ones....</P>
<P mce_keep="true">Please note that <A class="" href="http://msdn2.microsoft.com/library/aa969435.aspx" mce_href="http://msdn2.microsoft.com/library/aa969435.aspx">GetFileVersionInfoSizeEx</A>&nbsp;and <A class="" href="http://msdn2.microsoft.com/library/aa969434.aspx" mce_href="http://msdn2.microsoft.com/library/aa969434.aspx">GetFileVersionInfoEx</A>&nbsp;are new for Vista and they only have Unicode versions, something that you will see more and more of as the team I am on communicates the need for this approach going forward, <STRONG><A class="" href="http://archives.miloush.net/michkap/archive/2005/10/02/476213.html" mce_href="http://archives.miloush.net/michkap/archive/2005/10/02/476213.html">this way</A></STRONG> rather than <A class="" href="http://archives.miloush.net/michkap/archive/2006/10/24/867880.html" mce_href="http://archives.miloush.net/michkap/archive/2006/10/24/867880.html"><STRONG>this other way</STRONG></A>. :-)</P>
<P mce_keep="true">&nbsp;</P>
<P mce_keep="true"><FONT color=#ff00ff><FONT color=#ff0080><EM>This post brought to you by</EM>&nbsp;<FONT size=6>ꄰ</FONT>&nbsp;<EM>(</EM></FONT><A class="" href="http://www.fileformat.info/info/unicode/char/a130" mce_href="http://www.fileformat.info/info/unicode/char/a130"><EM>U+a130</EM></A></FONT><FONT color=#ff0080><EM>, a.k.a. YI SYALLABLE TUT)</EM></FONT></P>
<hr/><p><a id="1759561" href="#1759561">#</a> <strong>Miral</strong> on 25 Feb 2007 6:52 PM:</p><div style="margin-left: 1em"><p>I hope there's a backwards compatibility layer where it'll give you the old answer if you don't have a Vista manifest or something. &nbsp;Otherwise you could break things. &nbsp;Not that too many things should be relying on the OriginalFilename, but I've seen it happen.</p></div>
<p><a id="1760021" href="#1760021">#</a> <strong>Michael S. Kaplan</strong> on 25 Feb 2007 8:55 PM:</p><div style="margin-left: 1em"><p>I do not know of one, myself. Though I imagine the same problem exists any time the file list changes in an OS version, and it is not like there can be a backcompat layer for every file....</p>
</div>
<p><a id="8619644" href="#8619644">#</a> <strong>Lewis Balentine</strong> on 18 Jun 2008 9:18 PM:</p><div style="margin-left: 1em"><p>unfortunately the constants &quot;FILE_VER_GET_NEUTRAL&quot; and &quot;FILE_VER_GET_LOCALISED&quot; are undefined in the MSDN library. &nbsp;As the function REQUIRES a parameter for dwFlags and there if not information on what those parameters should be the function is totally useless.</p>
<p>P.S.</p>
<p>If you do not believe me ... try searching for one of them.</p></div>
<p><a id="8619936" href="#8619936">#</a> <strong>Michael S. Kaplan</strong> on 18 Jun 2008 10:58 PM:</p><div style="margin-left: 1em"><P>From verrsrc.h in the Platform SDK:</P>
<P><FONT face="consolas,lucida console,courier new,courier"><B>/*&nbsp;<BR>&nbsp;&nbsp;&nbsp;FILE_VER_GET_... flags are for use by&nbsp;<BR>&nbsp;&nbsp;&nbsp;GetFileVersionInfoSizeEx<BR>&nbsp;&nbsp;&nbsp;GetFileVersionInfoExW<BR>*/<BR><BR>#define FILE_VER_GET_LOCALISED &nbsp;0x01<BR>#define FILE_VER_GET_NEUTRAL &nbsp; &nbsp;0x02<BR>#define FILE_VER_GET_PREFETCHED 0x04</B></FONT></P></div>
<p><a id="8897505" href="#8897505">#</a> <strong>Grek3591@yahoo.fr</strong> on 26 Aug 2008 10:41 AM:</p><div style="margin-left: 1em"><p>"random stuff of dubious value"...but if you can make head and tail when you read it, you know a lot I don't !</p></div>
<hr/><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2007/02/23/1745885.html" title="The failure of 1124">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2007/02/22/1738656.html" title="My Comcast picks up SoapNet (finally)">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2007-02">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2007-02-22">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2007/02/22/1738882.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:38 GMT -->
</html>