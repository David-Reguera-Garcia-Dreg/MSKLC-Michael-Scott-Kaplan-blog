<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2007/04/23/2250029.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:38 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>How long is it in the console?</title></head><body>
<h1>How long is it in the console?</h1>
<p><em>by Michael S. Kaplan, published on 2007/04/23 16:51 -04:00, original URI: http://blogs.msdn.com/b/michkap/archive/2007/04/23/2250029.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostNew -->
<P>The width of a string in the console can be a tricky question to calculate. So&nbsp;earlier today&nbsp;when Eugene asked:</P>
<BLOCKQUOTE>
<P><FONT face="times new roman,times"><EM>What is the right way to figure out how many columns on a console will be needed to display a Unicode string? I believe wcwidth does that for some Unix systems. What is the right way to do it on Windows?</EM></FONT></P></BLOCKQUOTE>
<P>I have to admit there is no perfect answer.</P>
<P>I mean first of all there are the issues I talked about in <STRONG><A class="" href="http://archives.miloush.net/michkap/archive/2005/09/11/463672.html" mce_href="http://archives.miloush.net/michkap/archive/2005/09/11/463672.html">Fonts that are 'fixed-width' even if they do not claim to be</A></STRONG>, and that post even has a partial solution to the question which simply uses the results of the code page to determine whether a character takes up one space or two.</P>
<P>But this is not a solution for arbitrary Unicode strings, since for example there are plenty of ideographs that cannot be found in one of those DBCS code pages.</P>
<P>There are also several other flaws in this approach I cited that Buck Hodges's post&nbsp;<A class="" href="http://blogs.msdn.com/buckh/archive/2005/09/11/463427.aspx" mce_href="http://blogs.msdn.com/buckh/archive/2005/09/11/463427.aspx">suggested</A>, such as the fact that code pages like 932 contain several characters like U+0410 (CYRILLIC CAPITAL LETTER A) that are actually double byte on the code page even though they will be single byte in the console.</P>
<P>So as a method it is only useful for a small range of characters (arguably the ones most commonly used, of course, but even still...).</P>
<P>So we will set aside the code page method given that the question was trying to imply arbitrary Unicode strings.</P>
<P>One could perhaps veer into the typographic method of using a fixed width font (and simply dividing the total width by the single character width), though then one&nbsp;to worry about the problems pointed out in <STRONG><A class="" href="http://archives.miloush.net/michkap/archive/2006/05/09/593108.html" mce_href="http://archives.miloush.net/michkap/archive/2006/05/09/593108.html">The font width is broken? Well, fix it!</A></STRONG> and <A class="" href="http://archives.miloush.net/michkap/archive/2006/02/19/535046.html" mce_href="http://archives.miloush.net/michkap/archive/2006/02/19/535046.html"><STRONG>Where are the IE plain text fonts?</STRONG></A> and <A class="" href="http://archives.miloush.net/michkap/archive/2006/08/23/712587.html" mce_href="http://archives.miloush.net/michkap/archive/2006/08/23/712587.html"><STRONG>What would a 'Kartika Fixed' font for Malayalam DO, exactly?</STRONG></A>.</P>
<P>In the end, this two would limit t he number of characters that can be supported to a subset -- though in this case a slightly more acceptable subset since it is the same one defined by the console itself (since neither can handle complex scripts properly!).</P>
<P>To be honest, this does not suggest a superior UNIX via a wcwidth call, since it too has the same limitations and does not return the actual console column widths in these same cases in any implementation I have seen.</P>
<P>It just happens to be a hard problem!</P>
<P>In the end you may just have to pick your poison, and choose which limitation you want to (or are able to) live with. Well, that or stop using the console. :-)&nbsp;</P>
<P mce_keep="true">&nbsp;</P>
<P><FONT color=#ff00ff><EM>This post brought to you by</EM>&nbsp;<FONT size=5>–ê</FONT> <EM>(<A class="" href="http://www.fileformat.info/info/unicode/char/0410" mce_href="http://www.fileformat.info/info/unicode/char/0410">U+0410</A> a.k.a. CYRILLIC CAPITAL LETTER A)</EM></FONT></P>
<hr/><p><a id="2251412" href="#2251412">#</a> <strong>Ben Karas</strong> on 23 Apr 2007 6:40 PM:</p><div style="margin-left: 1em"><p>It sounds to me like they want to know how many columns (out of the default 80) would get used up during a printf() to a command console. &nbsp;Character widths don't have anything to do with that question. &nbsp;</p>
<p>Would it work if you call WideCharToMultiByte passing CP_OEM?</p></div>
<p><a id="2251466" href="#2251466">#</a> <strong>Michael S. Kaplan</strong> on 23 Apr 2007 6:46 PM:</p><div style="margin-left: 1em"><p>Well, character widths do enter into it with trying to figure out what will happen in the console -- what happens if the output codepage of the console is changed to 65001? You will get back 1, 2, 3, an sometimes even 4 bytes per character when the console will never use more than 1 or 2 columns per character....</p>
<p>The first solution solves the problem is the string is in the right subset. Otherwise it just gets harder. :-(</p>
</div>
<p><strong>Evan Lavelle</strong> on 12 Feb 2010 3:09 AM:</p><div style="margin-left: 1em"><p>The question specifically asked about Unicode strings, and 'columns' on a 'console'. If there is no MS-specific answer (and I haven't found it yet) then the answer is to use Markus Kuhn's wc[s]width implementations at <a rel="nofollow" target="_new" href="http://www.cl.cam.ac.uk/~mgk25/ucs/wcwidth.c">http://www.cl.cam.ac.uk/~mgk25/ucs/wcwidth.c</a>.</p></div>
<hr/><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2007/04/24/2255195.html" title="Sometimes, the shortcuts give better AND faster results">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2007/04/23/2248563.html" title="EUDC does not require ADMIN">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2007-04">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2007-04-23">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2007/04/23/2250029.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:38 GMT -->
</html>