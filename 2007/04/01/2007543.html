<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2007/04/01/2007543.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:38 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>There is no spoon^H^H^H^H^HGDI Font Cache</title></head><body>
<h1>There is no spoon^H^H^H^H^HGDI Font Cache</h1>
<p><em>by Michael S. Kaplan, published on 2007/04/01 13:24 -07:00, original URI: http://blogs.msdn.com/michkap/archive/2007/04/01/2007543.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostOld -->
<P>People often talk about the "GDI Font Cache" as if it were a real entity.</P>
<P>And those same people may explain how a call to <A class="" href="http://msdn2.microsoft.com/library/ms534231.aspx" mce_href="http://msdn2.microsoft.com/library/ms534231.aspx">AddFontResource</A> will dynamically update the font cache, session wide.</P>
<P>Some of them may even how explain&nbsp;how the font list under HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Fonts&nbsp;isn't monitored for changes at runtime.</P>
<P>Most of this is crap, based on people not really looking at the bigger picture....</P>
<P>The truth is, GDI has nothing to do with the registry or the font folder or any direct use of these things. Ever. Not for drawing with fonts, not for enumerating them. not even for informing people of when they were added (the good old <A class="" href="http://msdn2.microsoft.com/library/ms533930.aspx" mce_href="http://msdn2.microsoft.com/library/ms533930.aspx">WM_FONTCHANGE</A> message).</P>
<P>All it knows is what people ask it to load (whether via <A class="" href="http://msdn2.microsoft.com/library/ms534231.aspx" mce_href="http://msdn2.microsoft.com/library/ms534231.aspx">AddFontResource</A>&nbsp;or <A class="" href="http://msdn2.microsoft.com/library/ms533937.aspx" mce_href="http://msdn2.microsoft.com/library/ms533937.aspx">AddFontResourceEx</A> or <A class="" href="http://msdn2.microsoft.com/library/ms533942.aspx" mce_href="http://msdn2.microsoft.com/library/ms533942.aspx">AddFontMemResourceEx</A>), and it relies on everyone else to load up fonts, whether at session initialization time when someone goes through that big list in the registry and loads them all or whether someone adds the font file to the folder&nbsp;later, or removes it. Or calls one of the functions to add or remove the font in their own application code.</P>
<P>So what we call the "GDI Font Cache" is just the list of loaded fonts. Like as if we would call the "installed keyboard list" the "USER Keyboard Cache" or the locales that have been accessed within a session the "KERNEL32 Locale Cache." It is just a list of things that have been loaded.</P>
<P>This is why the docs point out how you have to not only call the function to add the font; you also have to add it to the registry so it will keep getting loaded in the future. The same way that&nbsp;<A class="" href="http://msdn2.microsoft.com/library/ms646305.aspx" mce_href="http://msdn2.microsoft.com/library/ms646305.aspx">LoadKeyboardLayout</A> works for keyboards, since it does not update the registry with the keyboards that the user might want to keep loading in the future.</P>
<P>What it means is that loading a font is good enough within a session, but to see the font in other sessions one would probably have to reboot, or in Vista or in Terminal Server at least logoff and restart the session.</P>
<P>The "GDI Font Cache" has no in-between setting to distinguish between the fonts one uses and the fonts one keeps available for potential future use -- and unfortunately the differentiation between fonts that are available and fonts that are not on a permanent basis requires HKLM registry permissions -- this is why one had to be an admin to install new fonts (well that and the fact that the Fonts folder requires permissions too).</P>
<P>This is in fact why <STRONG><A class="" href="http://archives.miloush.net/michkap/archive/2006/10/10/813347.html" mce_href="http://archives.miloush.net/michkap/archive/2006/10/10/813347.html">The fonts directory is freaking huge in Vista</A></STRONG> -- because requiring Admin permissions here is unreasonable but so is not allowing fonts to be available.</P>
<P>But imagine how easy it would be for there to a per-user fonts folder -- all you would need is</P>
<UL>
<LI>a location for the files (or even the actual Fonts folder but without registering the file)</LI>
<LI>a registry key listing the fonts to load (HKCU\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Fonts would probably do)</LI>
<LI>a process to make a bunch of <A class="" href="http://msdn2.microsoft.com/library/ms534231.aspx" mce_href="http://msdn2.microsoft.com/library/ms534231.aspx">AddFontResource</A>&nbsp;calls when a user logs in, ideally one that is smart enough to not bother trying to load what has already been loaded</LI></UL>
<P>So for all the huffing and puffing about how Mac has all of those different fonts folders, discussed in <A class="" href="http://archives.miloush.net/michkap/archive/2006/06/25/646701.html" mce_href="http://archives.miloush.net/michkap/archive/2006/06/25/646701.html"><STRONG>About the Fonts folder in Windows, Part 1 (aka What are we talking about?)</STRONG></A>, and Windows doesn't, there is no massive technology issue here that is beyond the ability of Windows to support. A model to allow all of the following:</P>
<UL>
<LI>conditional font install with no administrative user requirement to change font choices later</LI>
<LI>ability for users to install their own fonts without being admins</LI></UL>
<P>is all do-able, whether by someone from Microsoft or someone writing their own Shell extension (or if they want to be less fancy they can do it in a command line application).</P>
<P>The fact that no one ever mentions any of this is further proof that <A class="" href="http://archives.miloush.net/michkap/archive/2005/05/13/417167.html" mce_href="http://archives.miloush.net/michkap/archive/2005/05/13/417167.html"><STRONG>if it ain't in the default install, it ain't there at all</STRONG></A>&nbsp;as far as users are concerned....</P>
<P>Maybe someone from Microsoft needs to hook up something like the above in a future version and just get everything working here. It would probably make everyone's lives easier....</P>
<P mce_keep="true">&nbsp;</P>
<P><FONT color=#ff00ff><EM>This post brought to you by</EM> <FONT size=5>ነ</FONT> <EM>(<A class="" href="http://www.fileformat.info/info/unicode/char/1290" mce_href="http://www.fileformat.info/info/unicode/char/1290">U+1290</A>, a.k.a. ETHIOPIC SYLLABLE NA)</EM></FONT></P>
<hr/><p><a id="2010678" href="#2010678">#</a> <strong>James</strong> on Monday, April 02, 2007 4:43 AM:</p><div style="margin-left: 1em"><p>What is 'c:\Users\Me\AppData\Local\GDIPFONTCACHEV1.DAT'? I suppose a GDI+ font cache is not a GDI font cache?</p>
<p>Moreover, what has whether there is such a thing as a GDI font cache got to do with your point that a per user font folder would be trivial to implement?</p></div>
<hr/><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2007/04/03/2020799.html" title="ᗷIᔓY ᗷΑСKᔓΟN">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2007/04/01/2004424.html" title="I Kana understand you, could you repeater that? (Part 2)">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2007-04">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2007-04-01">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2007/04/01/2007543.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:38 GMT -->
</html>