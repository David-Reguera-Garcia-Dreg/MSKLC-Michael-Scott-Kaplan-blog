<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2007/05/07/2464778.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:38 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>The Unicode train? It left the station....</title></head><body>
<h1>The Unicode train? It left the station....</h1>
<p><em>by Michael S. Kaplan, published on 2007/05/07 11:45 -04:00, original URI: http://blogs.msdn.com/b/michkap/archive/2007/05/07/2464778.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostNew -->
<P>Heiko Braeske asks in the microsoft.public.win32.programmer.international newsgroup:</P>
<BLOCKQUOTE>
<P><FONT face="times new roman,times"><EM>I have a Non-Unicode-Application and I want to show text in the common controls (e.g. CEdit) with a specific character set. I thought I could manage this by setting the font, which was created from a LOGFONT with the lfCharSet member set to the desired value.<BR><BR>But in fact this works only if I use the old common controls version 5. If I use a manifest to use the common controls version 6, obviously the system locale is used to show the text and the lfCharSet of the font has no effect.<BR><BR>Is there a way to influence the new common controls which character set they use? But it should be a per user setting!<BR><BR>Thanks for your help.<BR><BR>Heiko </EM></FONT></P></BLOCKQUOTE>
<P>A little sad when shades of "Double Secret ANSI" (ref: <A class="" href="http://archives.miloush.net/michkap/archive/2007/03/08/1838231.html" mce_href="http://archives.miloush.net/michkap/archive/2007/03/08/1838231.html"><STRONG>part 1</STRONG></A> and <A class="" href="http://archives.miloush.net/michkap/archive/2007/03/20/1917161.html" mce_href="http://archives.miloush.net/michkap/archive/2007/03/20/1917161.html"><STRONG>part 2</STRONG></A>) seem to come and go, and I sympathize with the nature of something that for intents and purposes appears to be a regression.</P>
<P>But the original functionality never seems to have been documented in the older control, which would tend to make this a bit less interesting (especially considering how long it and the v.6 controls have been there).</P>
<P>Maybe it is just another proof that if you're not using Unicode, you're missing out, that <STRONG><A class="" href="http://archives.miloush.net/michkap/archive/2005/10/02/476213.html" mce_href="http://archives.miloush.net/michkap/archive/2005/10/02/476213.html">the Unicode train has been leaving the station</A></STRONG> for long enough that it has in fact left?</P>
<P>If the folks on the Shell team asked me which was more important: improving Unicode support, or fixing this particular "ANSI" regression, which do you think I would choose? </P>
<P>In the end, I guess I'd just rather be a defender of making what works behave better than a defender of making what is broken be slightly less broken. :-)</P>
<P>Would you choose the same? Or in your opinion is the ANSI legacy more important here?</P>
<P mce_keep="true">&nbsp;</P>
<P><FONT color=#ff00ff><EM>This post brought to you by</EM> <FONT size=5>U</FONT> <EM>(<A class="" href="http://www.fileformat.info/info/unicode/char/0055" mce_href="http://www.fileformat.info/info/unicode/char/0055">U+0055</A>, a.k.a. LATIN CAPITAL LETTER U)</EM></FONT></P>
<hr/><p><a id="2465829" href="#2465829">#</a> <strong>Aaron Ballman</strong> on 7 May 2007 1:32 PM:</p><div style="margin-left: 1em"><p>I'm in the unique position of needing to write one source base which supports Windows 98 thru Vista, and be &quot;unicode savvy&quot; even on systems without support. &nbsp;My source code it littered with A versions and W versions of calls. &nbsp;So ANSI support is important to me -- but even *I* agree that time is better spent improving for the future instead of patching up the past.</p></div>
<p><a id="2467288" href="#2467288">#</a> <strong>Ben Bryant</strong> on 7 May 2007 3:36 PM:</p><div style="margin-left: 1em"><p>Tough call, but I say move on. if I understand right, using the lfCharset of the font of a common edit control to switch from the CP_ACP is almost a hack, at least an unintended, undocumented and half-hearted feature used at your own risk. Using the font to change the charset of a control seems like such a bad architectural choice that I would have never thought to look for it.</p>
<p>Better to use a Unicode edit control that can work in your non-Unicode build (3rd party if necessary -- I sell one at firstobject.com) and switch to your charset of choice where necessary.</p>
<p>Backwards compatibility is of utmost importance, but every case must be weighed. If it is a bug or unintended behavior that many apps have grown to depend on, then you have to maintain it. But if it wasn't a promoted usage, you might be justified in moving on.</p></div>
<p><a id="2470556" href="#2470556">#</a> <strong>Mike Dimmick</strong> on 7 May 2007 7:49 PM:</p><div style="margin-left: 1em"><p>Give up on ANSI. Web usage share statistics at <a rel="nofollow" target="_new" href="http://marketshare.hitslink.com/report.aspx?qprid=2">http://marketshare.hitslink.com/report.aspx?qprid=2</a> suggest that Windows 98 is now used by under 1.5% of users. Even if you add Windows ME, the non-Unicode operating systems are still under 2%. Windows Vista has more users, less than four months after release.</p>
<p>It would be more rational to pursue Mac users than to persist with compatibility with Windows 9X.</p>
</div>
<p><a id="2470957" href="#2470957">#</a> <strong>Dean Harding</strong> on 7 May 2007 8:11 PM:</p><div style="margin-left: 1em"><p>I say move on as well. If the feature is really that important, you can still use version 5.</p>
</div>
<p><a id="2476821" href="#2476821">#</a> <strong>Heiko Braeske</strong> on 8 May 2007 4:55 AM:</p><div style="margin-left: 1em"><p>If &quot;to be state of the art&quot; would be the only determining factor the descision would be clear to move to Unicode. We don't care about Windows 98 or anything below XP or 2003 server. It is not relevant for our business. But a limiting factor of our server application is memory. And as long as you can't convince me that wchar doesn't need more memory than a char it will remain an argument against Unicode.</p>
<p>From MS point of view it is clear to simply suggest Unicode. Because if our application needs 5GB RAM instead of 3GB because of Unicode our customers will be forced to buy Enterprise server licenses instead of Standard. Hardware sellers will be also happy. Increase of costs without an increase of value for most of European/American customers! This is Unicode!</p>
<p>Now coming to the &quot;undocumented&quot; feature: The documentation of LOGFONT states for lfCharSet: &quot;This parameter is important in the font mapping process. To ensure consistent results, specify a specific character set.&quot; And this sentence is true for v.5 controls but not for v.6 controls.</p>
<p>Yes, I agree, it is a hack and a bad architectural choice. I would prefer to choose the relevant codepage application wide via some API call like e.g. setlocale. But Windows allows only to change this setting manually, system wide and force you to reboot. And this is from my point of view &quot;bad architecture&quot;.</p>
<p>But finally I want to make clear that I don't lock up totally against Unicode. Globalization is not an utopia and we have to respect our future customers in Asia were Unicode of course has a huge value added. But the world is not that simple to just answer &quot;Move on...&quot;</p></div>
<p><a id="2478328" href="#2478328">#</a> <strong>mpz</strong> on 8 May 2007 8:08 AM:</p><div style="margin-left: 1em"><p>Fvck &quot;ANSI&quot;. Fvck all the developers who keep artificially lengthening the lifespan of their dying breed of codebases that cause endless problems to people who happen to use a single non-&quot;ANSI&quot; character in their filenames.</p>
<p>In the year 2007, Thunderbird (the mail client) errors out when trying to attach a file that has a non-&quot;ANSI&quot; character even if it's only in the path.</p></div>
<p><a id="2478384" href="#2478384">#</a> <strong>Michael S. Kaplan</strong> on 8 May 2007 8:18 AM:</p><div style="margin-left: 1em"><p>Hello Heiko -- </p>
<p>As I pointed out in the newsgroups, your APP is using *more* memory if you do not use Unicode, in the long run -- because behind the scenes the OS has to allocate memory to convert your stuff to Unicode anyway. The illusion that you have &quot;saved memory&quot; is just that -- an illusion. So your app is jut slowly fragmenting your process heap with this constant allocation/destruction of memory, hurting performance, and stunting functionality.</p>
<p>But if one wants to move forward (and use the v.6 controls) then one must mobve forward (and use Unicode) for your scenario....</p>
</div>
<p><a id="2490508" href="#2490508">#</a> <strong>Dean Harding</strong> on 8 May 2007 8:03 PM:</p><div style="margin-left: 1em"><p>I also find it hard to believe that an app (even a &quot;server app&quot;) has 2GB of characters strings in memory at any one time... If you really have that much data in memory, why would you NOT be using a database?</p>
</div>
<p><a id="2498834" href="#2498834">#</a> <strong>Heiko Braeske</strong> on 9 May 2007 4:57 AM:</p><div style="margin-left: 1em"><p>Michael, is there any documented benchmark that proofs your statement? I was just taught not to rely on undocumented features. ;-)</p></div>
<p><a id="2502889" href="#2502889">#</a> <strong>Michael S. Kaplan</strong> on 9 May 2007 9:03 AM:</p><div style="margin-left: 1em"><p>:-)</p>
<p>Given that the entire underlying architecture of the OS has been documented as being Unicode, the conversion requirement is obvious (as is the results of srings off the default system or indeed any code page).</p>
<p>The fact that allocation of the memory used to hold the results of the conversion is on the default process heap is an implementation detail which is not documented and therefore technically *could* change, if someone felt like updating the code in thousands of functions, but given the effort involved this seems like a fairly safe thing to not worry about....</p>
<p>The fact that calling function A (whose job is to allocate, convert the parameters to Unicode, call function W, if needed convert back out params, and then free the memory) is more expensive than calling function W directly is basic computer science. :-)</p>
</div>
<p><strong>John Daintree</strong> on 16 Jan 2008 10:24 AM:</p><div style="margin-left: 1em"><p>OK fine, I understand, but where is this documented? I've just struggled to figure out why an application is broken. No mention of this change in the docs for LOGFONT, or int the discussion of manifest files. *That* is the irritation, not in the change itself.</p></div>
<p><strong>Michael S. Kaplan</strong> on 16 Jan 2008 10:54 AM:</p><div style="margin-left: 1em"><p>A lot of me blogging is specifically because of wrinkles and issues and bugs and such that are not yet in documentation, and me being impatient about the lack. </p>
<p>So it ends up about me being irritated and doing something about it! :-)</p>
</div>
<p><strong>Yuhong Bao</strong> on 9 Oct 2008 2:09 AM:</p><div style="margin-left: 1em"><p>Heiko: UTF-8 would be a good compromise in this case, though you will need to manually convert UTF-8 to UTF-16 when calling Windows APIs.</p></div>
<hr/><p><em>referenced by</em></p><div style="margin-left: 1em"><p>2012/03/26 <a href="http://archives.miloush.net/michkap/archive/2012/03/26/10286723.html">The Unicode train left the station YEARS ago, in fact! (2012 edition)</a></p><p>2007/10/18 <a href="http://archives.miloush.net/michkap/archive/2007/10/18/5512709.html">Trying to get people to use Unicode? Lock and load, baby!</a></p></div><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2007/05/07/2473828.html" title="Can&#39;t say sh*t, now can I? (aka On not biting the hand, yada yada yada)">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2007/05/06/2448753.html" title="One product&#39;s feature is another product&#39;s bug -- just ask &#39;em!">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2007-05">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2007-05-07">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2007/05/07/2464778.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:38 GMT -->
</html>