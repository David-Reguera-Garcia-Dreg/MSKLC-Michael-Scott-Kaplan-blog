<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2007/05/14/2629747.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:38 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>Stripping is an interesting job (aka On the meaning of meaningless, aka All Mn characters are non-spacing, but some are more non-spacing than others)</title></head><body>
<h1>Stripping is an interesting job (aka On the meaning of meaningless, aka All Mn characters are non-spacing, but some are more non-spacing than others)</h1>
<p><em>by Michael S. Kaplan, published on 2007/05/14 13:51 -04:00, original URI: http://blogs.msdn.com/b/michkap/archive/2007/05/14/2629747.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostNew -->
<P><EM>(apologies to George Orwell, of course!)</EM>&nbsp;</P>
<P>Val asks:</P>
<BLOCKQUOTE>
<P><FONT face="times new roman,times"><EM>Michael,<BR><BR>I've been reading your "Striping Diacritics" post, and it's been a great help. I've also been comparing it with another version I've seen. This other version is similar to yours, except that it breaks up the original string into characters, then normalizes the characters individually.<BR><BR>I threw a few languages at the two functions. I found yours handled Vietnamese while the other one did not.<BR><BR>However I have a problem where I don't know the code page of the string before I feed it to the function. It may be a far-east language, it may be an european language, or it may be a far-east + european language. Further more it may be a katakana or hiragana character set (i think I got those right)<BR><BR>Your function corrupted japanese, chinese, and especially korean. The other function did not. However I'm hesitant to use the other function because of the problems it has with vietnamese (which is a latin character set, so it worries me that it's hiding other issues with other languages)<BR><BR>Is there a way to modify your function to be friendlier to languages that don't have diacritics? Right now, I've modified it that if it finds a non-latin character (based on unicode value ranges), it aborts the whole processing and returns the original string, but this obviously can't handle strings that have multiple character sets.<BR><BR>Fyi: the problems I've seen with yours is that if I run JP through it, it strips out things that LOOK like accents but are not. For example, on of the JP characters looks like a reverse V with a small circle on top right. After your function, the small circl on top right is missing. With korean, it seemed like it inserted blanks between each character after we run it through Normalize() function.</EM></FONT></P></BLOCKQUOTE>
<P>It's funny, I never know when I get questions like this one if people fully understand what they are asking for (no offense to Val!).</P>
<P>And&nbsp;I am not helped in this case by the fact that <STRONG>Val</STRONG> is the name of both </P>
<UL>
<LI>a male software consultant in Toronto dealing a great deal with FoxPro who ran a whole bunch of conferences I have spoken at over the last decade&nbsp;and </LI>
<LI>a&nbsp;female college student&nbsp;in Columbus working part-time as an exotic dancer to cover her tuition I dated for several months over a decade and a half ago</LI></UL>
<P>The latter being a stripper is&nbsp;interesting given that this new Val is asking me about stripping, albeit an entirely different kind of stripping!). The fact that&nbsp;Valerie found things about programming to be interesting only further clouds the situation.&nbsp;</P>
<P>I have literally no sense of the person asking the question and am somewhat certain that neither of my previous <STRONG>Val</STRONG> experiences will properly guide me in this respect. :-)</P>
<P>I'll start with the Japanese case, which really is not a bug, or a shortcoming in the code.</P>
<P>After all, to me the conversion from <STRONG>å</STRONG> to <STRONG>a</STRONG> is a normal "diacritic stripping" operation, while a Swedish user&nbsp; would probably throw something heavy at my head were it not for the fact that all the Swedes I have met are so bleeding polite.</P>
<P>I don't find that Swede's reaction to be any more or less reasonable that the Japanese user's suggestion (mirroring Val's) that the change from <STRONG>ピ</STRONG> to <STRONG>ヒ</STRONG> is "corrupting Japanese text."</P>
<P>In both cases, you can see why it happens:</P>
<P><A class="" href="http://www.fileformat.info/info/unicode/char/00e5" mce_href="http://www.fileformat.info/info/unicode/char/00e5">U+00e5</A> (å) decomposes to <A class="" href="http://www.fileformat.info/info/unicode/char/0061" mce_href="http://www.fileformat.info/info/unicode/char/0061">U+0061</A> <A class="" href="http://www.fileformat.info/info/unicode/char/030a" mce_href="http://www.fileformat.info/info/unicode/char/030a">U+030a</A>, and <A class="" href="http://www.fileformat.info/info/unicode/char/030a" mce_href="http://www.fileformat.info/info/unicode/char/030a">U+030a</A> is Mn (Mark, Nonspacing), which the code is designed to strip.</P>
<P><A class="" href="http://www.fileformat.info/info/unicode/char/30d4" mce_href="http://www.fileformat.info/info/unicode/char/30d4">U+30d4</A> (ピ) decomposes to <A class="" href="http://www.fileformat.info/info/unicode/char/30d2" mce_href="http://www.fileformat.info/info/unicode/char/30d2">U+30d2</A> <A class="" href="http://www.fileformat.info/info/unicode/char/309a" mce_href="http://www.fileformat.info/info/unicode/char/309a">U+309a</A>, and <A class="" href="http://www.fileformat.info/info/unicode/char/309a" mce_href="http://www.fileformat.info/info/unicode/char/309a">U+309a</A> is&nbsp; Mn (Mark, Nonspacing), which the code is designed to strip.</P>
<P>So in essence what Val is asking for here is a way to say get at the sentiment expressed in the title: that all Mn characters are non-spacing, but some are more non-spacing than others. Which really does not exist in any kind of automated sense.</P>
<P>Now the Korean problem is a bit easier to describe and deal with. After all <A class="" href="http://www.fileformat.info/info/unicode/char/d3fc" mce_href="http://www.fileformat.info/info/unicode/char/d3fc">U+d3fc</A>&nbsp;(폼) decomposes to <A class="" href="http://www.fileformat.info/info/unicode/char/1111" mce_href="http://www.fileformat.info/info/unicode/char/1111">U+1111</A> <A class="" href="http://www.fileformat.info/info/unicode/char/1169" mce_href="http://www.fileformat.info/info/unicode/char/1169">U+1169</A> <A class="" href="http://www.fileformat.info/info/unicode/char/11b7" mce_href="http://www.fileformat.info/info/unicode/char/11b7">U+11b7</A>, and although none of them are non-spacing, if you don't have a font that can handle the conjoining Jamo (e.g. <STRONG>Gulim Old Hangul</STRONG>, the font I have on this machine), it will look like three separate Jamo rather than one single modern Hangul syllable.</P>
<P>Of course, with just a minor change to the code I first presented in <STRONG><A class="" href="http://archives.miloush.net/michkap/archive/2005/02/19/376617.html" mce_href="http://archives.miloush.net/michkap/archive/2005/02/19/376617.html">Stripping diacritics....</A></STRONG> to take the decomposed text and recompose it by converting it to Unicode Normalization Form&nbsp;C. The new code would look something like this:</P>
<BLOCKQUOTE>
<P><FONT face="Consolas,Lucida Console,Courier New,Courier"><B>namespace Remove {<BR>using System;<BR>using System.Text;<BR>using System.Globalization;<BR>&nbsp; class Remove {<BR>&nbsp;&nbsp;&nbsp; [STAThread]<BR>&nbsp;&nbsp;&nbsp; static void Main(string[] args) {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; foreach(string st in args) {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Console.WriteLine(RemoveDiacritics(st));<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<BR>&nbsp;&nbsp;&nbsp; }<BR><BR>&nbsp;&nbsp;&nbsp; static string RemoveDiacritics(string stIn) {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; string stFormD = stIn.Normalize(NormalizationForm.FormD);<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; StringBuilder sb = new StringBuilder();<BR><BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; for(int ich = 0; ich &lt; stFormD.Length; ich++) {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; UnicodeCategory uc = CharUnicodeInfo.GetUnicodeCategory(stFormD[ich]);<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if(uc != UnicodeCategory.NonSpacingMark) {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; sb.Append(stFormD[ich]);<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<BR><BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return(sb.ToString().Normalize(NormalizationForm.FormC));<BR>&nbsp;&nbsp;&nbsp; }<BR>&nbsp; }<BR>}</P></B></FONT></BLOCKQUOTE>
<P mce_keep="true">I don't know what in particular in the Chinese text was going wrong, and without an example it is hard to say; perhaps the new code will resolve the problem.</P>
<P mce_keep="true">But the first case (the one with Japanese) is obviously the more interesting one in terms of functionality -- the request being for a way to strip diacritics that are considered to be meaningless does demand that a bit of rigor be applied to the meaning of the term meaningless, which could be linguistically derived from the meaning of the term corrupted (by assuming that anything that is called <STRONG>corrupted</STRONG> would have been meaningful had corruption not taken place!).</P>
<P mce_keep="true">&nbsp;</P>
<P mce_keep="true"><FONT color=#ff00ff><EM>This post brought to you by</EM> ピ <EM>(<A class="" href="http://www.fileformat.info/info/unicode/char/30d4" mce_href="http://www.fileformat.info/info/unicode/char/30d4">U+30d4</A>, a.k.a. KATAKANA LETTER PI)</EM></FONT></P>
<hr/><p><a id="2635201" href="#2635201">#</a> <strong>Dean Harding</strong> on 14 May 2007 6:50 PM:</p><div style="margin-left: 1em"><p>The ultimate solution would be to build up your own table of &quot;non-non-spacing marks.&quot; Bonus points if you make it locale-specific (so &#229; would be in the English one but not the Swedish). Of course, this may be a case of overengineering ;)</p>
</div>
<p><a id="3156826" href="#3156826">#</a> <strong>Peter Karlsson</strong> on 8 Jun 2007 3:21 AM:</p><div style="margin-left: 1em"><p>Of course, in the Swedish case, a “proper” RemoveDiacritics(&quot;w&#252;&#233;&#229;&#228;&#246;&#230;&#248;&#224;&quot;) should produce “vy&#233;&#229;&#228;&#246;&#228;&#246;a”. But I guess implementing that could be a bit more difficult…</p></div>
<p><a id="3163717" href="#3163717">#</a> <strong>Michael S. Kaplan</strong> on 8 Jun 2007 10:37 AM:</p><div style="margin-left: 1em"><p>Hey Peter -- very good point. I'll have to talk about this soon....</p>
</div>
<p><a id="8519155" href="#8519155">#</a> <strong>Steven Sudit</strong> on 19 May 2008 11:34 AM:</p><div style="margin-left: 1em"><P>For another approach to normalization, take a look at: <A href="http://www.codeproject.com/KB/cs/UnicodeNormalization.aspx" target=_new rel=nofollow>http://www.codeproject.com/KB/cs/UnicodeNormalization.aspx</A></P>
<P>I'm not sure if it's faster or slower than the method mentioned in this blog, but it is smart enough to remove diacritics only when they're attached to Latin characters, which leaves such things as Han radicals alone.</P></div>
<p><a id="9021275" href="#9021275">#</a> <strong>Jan Kučera</strong> on 28 Oct 2008 8:38 PM:</p><div style="margin-left: 1em"><p>Any way for the .NET Compact Framework people out there? (as the normalization does not seem to be available for them...)</p></div>
<p><a id="9026286" href="#9026286">#</a> <strong>mkukik</strong> on 31 Oct 2008 5:38 AM:</p><div style="margin-left: 1em"><p>In case of stripping diacritics from Latin characters:</p>
<p>Combining above method with converting Unicode to Western codepage, strips even more diarcritics... Like Polish Łł</p>
<p>However it is still not 100%</p>
<p>string unicodeStringOrig = &quot;SE:&#197;&#229;&#196;&#228;&#214;&#246;; PL:ĄąĆćĘęŁłŃń&#211;&#243;ŚśŹźŻż; SK:ľščťž&#253;&#225;&#237;&#233;&#250;&#228;&#244;ňďĽŠČŤŽ&#221;&#193;&#205;&#201;&#218;&#196;&#212;ŇĎ; HU:&#235;ő&#252;űŐ&#220;Ű; ES:&#209;&#241;&#191;; CA:&#224;&#232;&#242;&#231;&#239;&quot;;</p>
<p>string unicodeString = RemoveDiacritics(unicodeStringOrig);</p>
<p>Encoding nonunicode = Encoding.GetEncoding(850);</p>
<p>Encoding unicode = Encoding.Unicode;</p>
<p>byte[] unicodeBytes = unicode.GetBytes(unicodeString);</p>
<p>byte[] nonunicodeBytes = Encoding.Convert(unicode, nonunicode, unicodeBytes);</p>
<p>char[] nonunicodeChars = new char[nonunicode.GetCharCount(nonunicodeBytes, 0, nonunicodeBytes.Length)];</p>
<p>nonunicode.GetChars(nonunicodeBytes, 0, nonunicodeBytes.Length, nonunicodeChars, 0);</p>
<p>string nonunicodeString = new string(nonunicodeChars);</p></div>
<p><strong>Amino</strong> on 17 Dec 2009 1:54 AM:</p><div style="margin-left: 1em"><p>Is it possible to work arround it, meaning addingDiacritics?</p></div>
<p><strong>James White</strong> on 23 Jul 2010 8:16 AM:</p><div style="margin-left: 1em"><p>Or, in roughly the same readability, in Linq &amp; extension method</p>
<p> &nbsp; &nbsp; public static string RemoveDiacritics(this string stIn)</p>
<p> &nbsp; &nbsp; {</p>
<p> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;var sb = new StringBuilder();</p>
<p> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;sb.Append(</p>
<p> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;stIn.Normalize(NormalizationForm.FormD)</p>
<p> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;.Where(c =&gt; CharUnicodeInfo.GetUnicodeCategory(c)</p>
<p> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;!= UnicodeCategory.NonSpacingMark)</p>
<p> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;.ToArray());</p>
<p> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;return (sb.ToString().Normalize(NormalizationForm.FormC));</p>
<p> &nbsp; &nbsp; }</p>
</div>
<p><strong>G&#246;khan Berberoglu</strong> on 16 Mar 2011 6:42 AM:</p><div style="margin-left: 1em"><p>Thanks for the code. </p>
<p>However, this is not enough to save humanity from a problematic turkish characther : i without a dot.</p>
<p>the char somehow does not decomposes. I found bliss in .Replace(&quot;ı&quot;, &quot;i&quot;);</p>
<p>btw, english and other latin languages is wrong! You should have a dot in uppercase i (that would have solved our ToLowerCase(&quot;I&quot;) problems :)</p>
</div>
<hr/><p><em>referenced by</em></p><div style="margin-left: 1em"><p>2015/09/14 <a href="http://archives.miloush.net/michkap/archive/2015/09/14/8770668856267197219.html">A few sorta random things I recall about some of my past memorable, unorthodox relationships, part #1</a></p><p>2009/05/27 <a href="http://archives.miloush.net/michkap/archive/2009/05/27/9644420.html">The whole truth about MB_PRECOMPOSED and MB_COMPOSITE</a></p><p>2008/10/29 <a href="http://archives.miloush.net/michkap/archive/2008/10/29/9021615.html">Wonder why something is not in the Compact Framework? The answer is in the question!</a></p><p>2007/09/04 <a href="http://archives.miloush.net/michkap/archive/2007/09/04/4734456.html">I am not a nudist, but I do support stripping when it is appropriate, part 1</a></p><p>2007/08/17 <a href="http://archives.miloush.net/michkap/archive/2007/08/17/4424917.html">Normalize Wide Shut</a></p><p>2007/06/08 <a href="http://archives.miloush.net/michkap/archive/2007/06/08/3162451.html">año del ano, a.k.a. This sentence has several non-skarklish Spanish flutzpahs....</a></p><p>2005/02/19 <a href="http://archives.miloush.net/michkap/archive/2005/02/19/376617.html">Stripping diacritics....</a></p></div><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2007/05/17/2692362.html" title="If a bunch of specific Unicode characters can no longer live in the same apartment together, can they really claim that they needed their space?">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2007/05/13/2590479.html" title="Keyboards that map any language to any other language, or the lack thereof">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2007-05">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2007-05-14">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2007/05/14/2629747.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:38 GMT -->
</html>