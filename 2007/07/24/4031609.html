<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2007/07/24/4031609.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:38 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>TAV is in the public use area</title></head><body>
<h1>TAV is in the public use area</h1>
<p><em>by Michael S. Kaplan, published on 2007/07/24 13:06 -04:00, original URI: http://blogs.msdn.com/b/michkap/archive/2007/07/24/4031609.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostNew -->
<P>Some time yesterday, Chris Shearer Cooper asked in a whole mess of newsgroups (microsoft.public.il.hebrew.vc, microsoft.public.il.hebrew.windows2000, <STRONG>microsoft.public.win32.programmer.international</STRONG>, and microsoft.public.win32.programmer.kernelI:</P>
<BLOCKQUOTE>
<P><FONT face="times new roman,times"><EM>Can anyone tell me what MultiByteToWideChar() does if you pass it an invalid input character but do not set the MB_ERR_INVALID_CHARS flag?<BR><BR>By "invalid character" I have a specific test case, which is trying to convert character 0xFA in code page 1255 (Hebrew) into Unicode.&nbsp; There is no character at that position in that code page.<BR><BR>I'm trying to understand the documentation for MultiByteToWideChar(), it says an invalid character is "a character that is not the default character in the source string but translates to the default character when MB_ERR_INVALID_CHARS is not set".&nbsp; How do I know what "the default character" is in the source string, and I assume that "the default character" could be a different value in the destination string?<BR><BR>What I see on my machine, is that MultiByteToWideChar() succeeds (as it should, I didn't set the MB_ERR_INVALID_CHARS flag) and in my output string it has placed the Unicode character 0xF894 which is in the "Private Use" area of Unicode.&nbsp; Can I rely on MultiByteToWideChar() to convert invalid 8-bit characters to Unicode characters in the range E000-F8FF?&nbsp; Or is there <BR>a Windows function to get the value of "the default character"?<BR><BR>Thanks,<BR>Chris</EM></FONT></P></BLOCKQUOTE>
<P>Thankfully, one of those newsgroups was one I follow. :-)</P>
<P>Anyway, Bob Eaton got there first and pointed out a bunch of facts to help explain what appears there in this case:</P>
<BLOCKQUOTE>
<P><EM>On my XP/SP2 system, the code page 1255 (Ansi--Hebrew) shows the following information:<BR><BR>Max bytes/character: 1<BR>Default legacy character: (?) (i.e. question mark = d63)<BR>Default Unicode character: (?) (i.e. the same = u003f)<BR><BR>and it does have a Unicode equivalent for d250 (=0xFA) which is ת (u05ea).<BR><BR>But I think the answer to your question is if you were to pass it an invalid input character (which I don't think 0xFA is), then it should return a question mark character at that position.<BR><BR>The Windows function to get the default character information is: GetCPInfoEx<BR><BR>Bob</EM></P></BLOCKQUOTE>
<P>I was also unable to repro the problems that Chris was reporting, and <A class="" href="http://www.microsoft.com/globaldev/reference/sbcs/1255.mspx" mce_href="http://www.microsoft.com/globaldev/reference/sbcs/1255.mspx">Windows code page 1255</A> does have a character there. And I never saw any private use character in the mix, <A class="" href="http://www.fileformat.info/info/unicode/char/f894" mce_href="http://www.fileformat.info/info/unicode/char/f894">U+f894</A> or other. Given the valid character (<A class="" href="http://www.fileformat.info/info/unicode/char/05ea" mce_href="http://www.fileformat.info/info/unicode/char/05ea">U+05ea</A>, HEBREW LETTER TAV) is very much in public use I am not sure where the PUA character might have come from for Chris. It is certainly not expected.</P>
<P>I responded a bit after that to talk a bit about MB_ERR_INVALID_CHARS (or not) and how it affected things (or not), not much else to say since Bob had really covered the major points.</P>
<P>And then funnily enough, Ken "Skywing" Johnson,&nbsp;the Windows SDK MVP who&nbsp;is behind <A class="" href="http://www.nynaeve.net/" mce_href="http://www.nynaeve.net/">Nynaeve</A> (Adventures in Windows debugging and reverse engineering),&nbsp;who I didn't even knew had any idea that I existed (but probably would have if I had looked at his blogroll any of the times I had dropped in on his blog!), put in a small postscript:</P>
<BLOCKQUOTE>
<P>&lt;OffTopic&gt;<BR>Funny.&nbsp; I was just thinking "you know, this would be a great Michael Kaplan <BR>blog question", and here you are following the newsgroups.<BR>&lt;/OffTopic&gt;</P></BLOCKQUOTE>
<P>Well I can't ignore something like that, can I? :-)</P>
<P>Anyway, looking at the tables for cp1255, while 0xFA does indeed map to TAV, 0xFB (which is undefined) maps to the PUA (you cannot see it <A class="" href="http://www.microsoft.com/globaldev/reference/sbcs/1255.mspx" mce_href="http://www.microsoft.com/globaldev/reference/sbcs/1255.mspx">here</A> but you cane see it <A class="" href="http://www.unicode.org/Public/MAPPINGS/VENDORS/MICSFT/WindowsBestFit/bestfit1255.txt" mce_href="http://www.unicode.org/Public/MAPPINGS/VENDORS/MICSFT/WindowsBestFit/bestfit1255.txt">here</A>. This is part of a misguided attempt long ago to let invalid data roundtrip:</P>
<BLOCKQUOTE>
<P><FONT face="consolas,lucida console,courier new,courier"><STRONG>0xf88d 0xd9 ;EUDC -&gt; Undefined<BR>0xf88e 0xda ;EUDC -&gt; Undefined<BR>0xf88f 0xdb ;EUDC -&gt; Undefined<BR>0xf890 0xdc ;EUDC -&gt; Undefined<BR>0xf891 0xdd ;EUDC -&gt; Undefined<BR>0xf892 0xde ;EUDC -&gt; Undefined<BR>0xf893 0xdf ;EUDC -&gt; Undefined<BR>0xf894 0xfb ;EUDC -&gt; Undefined<BR>0xf895 0xfc ;EUDC -&gt; Undefined<BR>0xf896 0xff ;EUDC -&gt; Undefined&nbsp;</STRONG></FONT></P></BLOCKQUOTE>
<P>(I do not imagine that EUDC usage is all that comnmon in Hebrew!)</P>
<P>So, mystery solved -- a classicvc off-by-one error! :-)</P>
<P mce_keep="true">&nbsp;</P>
<P><FONT color=#ff00ff><EM>This post brought to you by</EM>&nbsp; <EM>(<A class="" href="http://www.fileformat.info/info/unicode/char/05ea" mce_href="http://www.fileformat.info/info/unicode/char/05ea">U+05ea</A>, a.k.a. HEBREW LETTER TAV), the first letter in <A class="" href="http://en.wikipedia.org/wiki/Tisha_B%27Av" mce_href="http://en.wikipedia.org/wiki/Tisha_B%27Av">תשעה באב</A>, which (apropos of nothing)&nbsp;is actually today.</EM></FONT></P>
<hr/><div style="margin-left: 1em"><em>no comments</em></div><hr/><p><em>referenced by</em></p><div style="margin-left: 1em"><p>2007/07/25 <a href="http://archives.miloush.net/michkap/archive/2007/07/25/4037646.html">What's up with MB_ERR_INVALID_CHARS?</a></p></div><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2007/07/24/4034548.html" title="Product [Un]fair?">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2007/07/24/4022881.html" title="Pluralization(s) can be singularly difficult">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2007-07">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2007-07-24">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2007/07/24/4031609.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:38 GMT -->
</html>