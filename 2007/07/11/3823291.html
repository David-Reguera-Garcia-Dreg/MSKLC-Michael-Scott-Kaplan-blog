<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2007/07/11/3823291.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:38 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>GB18030 isn't an ACP, either</title></head><body>
<h1>GB18030 isn't an ACP, either</h1>
<p><em>by Michael S. Kaplan, published on 2007/07/11 23:45 -04:00, original URI: http://blogs.msdn.com/b/michkap/archive/2007/07/11/3823291.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostNew -->
<P>The question went something like this:</P>
<BLOCKQUOTE>
<P><EM><FONT face="times new roman,times">I'm trying to display GB18030 text (say unicode 0x3400 character) using DrawTextA and WideCharToMultiByte.&nbsp;I am using the code page for GB18030 which is 54936. <BR><BR>Why doesn't this work?&nbsp; Originally, I thought it had to do with font linking.<BR>&nbsp;<BR>Thanks for the help.</FONT></EM></P></BLOCKQUOTE>
<P>You can see what is going on here -- the general assumption that the non-Unicode Win32 API will handle any/every code page that isn't Unicode. Which we know isn't true from the many times UTF-8 support in "A" functions has been discussed (if you look at Raymond's <A class="" href="http://blogs.msdn.com/oldnewthing/archive/2007/07/03/3665338.aspx" mce_href="http://blogs.msdn.com/oldnewthing/archive/2007/07/03/3665338.aspx">recent post</A>&nbsp;that&nbsp;points out&nbsp;so many of the times I have talked about it, the subject has come up way too many times!).</P>
<P>Once I pointed out UTF-8 and Gb18030 at the same time (in <STRONG><A class="" href="http://archives.miloush.net/michkap/archive/2007/01/03/1392379.html" mce_href="http://archives.miloush.net/michkap/archive/2007/01/03/1392379.html">UTF-8 and GB18030 are both 'NT' code pages, they just aren't 'ANSI' code pages</A></STRONG>).</P>
<P>Now GDI is fundamentally a Unicode thing internally and was even back in Windows 95, mainly because most of the plumbing is Unicode anyway.</P>
<P>The issue of&nbsp;which code page is used is not a simple answer like CP_ACP, as I pointed out in <STRONG><A class="" href="http://archives.miloush.net/michkap/archive/2005/05/13/417060.html" mce_href="http://archives.miloush.net/michkap/archive/2005/05/13/417060.html">What code page does MSLU convert with?</A></STRONG>. The MS Layer for Unicode was designed to map to what the OS does in so many cases, including the GDI ones that were kind of based on the charset of a device context.</P>
<P>But all of the underlying code pages that the charset values map to are ACPs, and GB18030 cannot&nbsp;be an ACP, for much the same reasons that UTF-8 cannot.</P>
<P>Obviously, the quick answer is to use <A class="" href="http://msdn2.microsoft.com/library/ms533909.aspx" mce_href="http://msdn2.microsoft.com/library/ms533909.aspx">DrawTextW</A> with the original Unicode text that isn't converted at all, rather than converting it and not being able to&nbsp;display all of the data that DrawTextA won't recognize....</P>
<P mce_keep="true">&nbsp;</P>
<P><FONT color=#ff00ff><EM>This post brought to you by</EM> <FONT size=5>„êÄ</FONT> <EM>(<A class="" href="http://www.fileformat.info/info/unicode/char/3400" mce_href="http://www.fileformat.info/info/unicode/char/3400">U+3400</A>, the first CJK ideograph in CJK Extension A)</EM></FONT></P>
<hr/><div style="margin-left: 1em"><em>no comments</em></div><hr/><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2007/07/11/3824400.html" title="Offense in depth">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2007/07/11/3820654.html" title="They don&#39;t [font] associate with font linkers, among others">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2007-07">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2007-07-11">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2007/07/11/3823291.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:38 GMT -->
</html>