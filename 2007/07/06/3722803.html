<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2007/07/06/3722803.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:38 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>A non-spacing mark and a diacritic are not always the same thing</title></head><body>
<h1>A non-spacing mark and a diacritic are not always the same thing</h1>
<p><em>by Michael S. Kaplan, published on 2007/07/06 08:01 -04:00, original URI: http://blogs.msdn.com/b/michkap/archive/2007/07/06/3722803.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostNew -->
<P>Ben asked me the other day via email:</P>
<BLOCKQUOTE>
<P class=MsoNormal><FONT face="times new roman,times"><EM>This isn’t something I’m blocked on, but if you’re curious (I am!) –<BR><BR>I’m wondering about the expected behavior of CompareInfo.IndexOf.&nbsp; I found that when searching for a Kannada string (“<SPAN style="FONT-FAMILY: Tunga">ಕನ್ನಡ</SPAN>”) I match versus a longer version that ends with what appears to be a non-spacing mark: “<SPAN style="FONT-FAMILY: Tunga">ಕನ್ನಡಿ</SPAN>” (hex dump below).&nbsp; I can work around that by checking for trailing non-spacing marks at the end of the match.<BR><BR>However, I also experimented with searching for ‘e’ (0x65) in the text ‘e’ + combining acute { 0x65, 0x301 }.&nbsp; In this case, IndexOf returns -1.&nbsp; In both cases, I have a trailing NonSpacingMark, but in only one do I get a match.&nbsp; Any idea what gives?<?xml:namespace prefix = o ns = "urn:schemas-microsoft-com:office:office" /><o:p>&nbsp;</o:p></EM></FONT></P>
<P class=MsoNormal><SPAN style="FONT-SIZE: 7pt; FONT-FAMILY: 'Courier New'">&nbsp;&nbsp;&nbsp; <SPAN style="COLOR: blue">string</SPAN> text =&nbsp;&nbsp;&nbsp; <SPAN style="COLOR: blue">new</SPAN> <SPAN style="COLOR: blue">string</SPAN>(<SPAN style="COLOR: blue">new</SPAN> <SPAN style="COLOR: blue">char</SPAN> [] { (<SPAN style="COLOR: blue">char</SPAN>)0xc95, (<SPAN style="COLOR: blue">char</SPAN>)0xca8, (<SPAN style="COLOR: blue">char</SPAN>)0xccd, (<SPAN style="COLOR: blue">char</SPAN>)0xca8, (<SPAN style="COLOR: blue">char</SPAN>)0xca1, (<SPAN style="COLOR: blue">char</SPAN>)0xcbf });<BR></SPAN><SPAN style="FONT-SIZE: 7pt; FONT-FAMILY: 'Courier New'">&nbsp;&nbsp;&nbsp; <SPAN style="COLOR: blue">string</SPAN> pattern = <SPAN style="COLOR: blue">new</SPAN> <SPAN style="COLOR: blue">string</SPAN>(<SPAN style="COLOR: blue">new</SPAN> <SPAN style="COLOR: blue">char</SPAN> [] { (<SPAN style="COLOR: blue">char</SPAN>)0xc95, (<SPAN style="COLOR: blue">char</SPAN>)0xca8, (<SPAN style="COLOR: blue">char</SPAN>)0xccd, (<SPAN style="COLOR: blue">char</SPAN>)0xca8, (<SPAN style="COLOR: blue">char</SPAN>)0xca1 });<BR></SPAN><SPAN style="FONT-SIZE: 7pt; FONT-FAMILY: 'Courier New'">&nbsp;&nbsp;&nbsp; <SPAN style="COLOR: #2b91af">CompareInfo</SPAN> compareInfo = <SPAN style="COLOR: #2b91af">CompareInfo</SPAN>.GetCompareInfo(<SPAN style="COLOR: #a31515">"kn-IN"</SPAN>);<BR></SPAN><SPAN style="FONT-SIZE: 7pt; FONT-FAMILY: 'Courier New'">&nbsp;&nbsp;&nbsp; <SPAN style="COLOR: blue">int</SPAN> index = compareInfo.IndexOf(text, pattern, 0); <SPAN style="COLOR: green">// returns 0<BR><BR></SPAN></SPAN><SPAN style="FONT-SIZE: 7pt; FONT-FAMILY: 'Courier New'">&nbsp;&nbsp;&nbsp; text =&nbsp;&nbsp;&nbsp; <SPAN style="COLOR: blue">new</SPAN> <SPAN style="COLOR: blue">string</SPAN>(<SPAN style="COLOR: blue">new</SPAN> <SPAN style="COLOR: blue">char</SPAN> [] { (<SPAN style="COLOR: blue">char</SPAN>)0x65, (<SPAN style="COLOR: blue">char</SPAN>)0x301 });<BR></SPAN><SPAN style="FONT-SIZE: 7pt; FONT-FAMILY: 'Courier New'">&nbsp;&nbsp;&nbsp; pattern = <SPAN style="COLOR: blue">new</SPAN> <SPAN style="COLOR: blue">string</SPAN>(<SPAN style="COLOR: blue">new</SPAN> <SPAN style="COLOR: blue">char</SPAN> [] { (<SPAN style="COLOR: blue">char</SPAN>)0x65 });<BR></SPAN><SPAN style="FONT-SIZE: 7pt; FONT-FAMILY: 'Courier New'">&nbsp;&nbsp;&nbsp; compareInfo = <SPAN style="COLOR: #2b91af">CompareInfo</SPAN>.GetCompareInfo(<SPAN style="COLOR: #a31515">"en-us"</SPAN>);<BR></SPAN><SPAN style="FONT-SIZE: 7pt; FONT-FAMILY: 'Courier New'">&nbsp;&nbsp;&nbsp; index = compareInfo2.IndexOf(text, pattern, 0); <SPAN style="COLOR: green">// returns -1<BR><BR></SPAN></SPAN><EM><FONT face="times new roman,times">Ben</FONT></EM></P></BLOCKQUOTE>
<P mce_keep="true">Well, the second case Ben describes is by design and is similar to issue I mentioned <STRONG><A class="" href="http://archives.miloush.net/michkap/archive/2007/02/17/1698307.html" mce_href="http://archives.miloush.net/michkap/archive/2007/02/17/1698307.html">here</A></STRONG> and <STRONG><A class="" href="http://archives.miloush.net/michkap/archive/2006/09/19/762106.html" mce_href="http://archives.miloush.net/michkap/archive/2006/09/19/762106.html">here</A></STRONG>.</P>
<P mce_keep="true">Though this case is more convincing/compelling, since it really is a diacritic on a letter, etc.</P>
<P mce_keep="true">The first case, however, although the additional character is <A class="" href="http://www.fileformat.info/info/unicode/char/0cbf" mce_href="http://www.fileformat.info/info/unicode/char/0cbf">U+0cbf</A> (a.k.a. ಿ, KANNADA VOWEL SIGN I) is technically general category == Mn (Mark, Nonspacing), it takes more than that to impact collation -- in this case because the letter has primary weight.</P>
<P mce_keep="true">Anyone want to guess what that reason might be? :-)</P>
<P mce_keep="true">(I'll give people a chance to respond for this question, and I'll give some answers tomorrow or the next day)</P>
<P mce_keep="true">&nbsp;</P>
<P mce_keep="true"><FONT color=#ff00ff><EM>This post brought to you by</EM> <FONT size=5>ಿ</FONT> <EM>(<A class="" href="http://www.fileformat.info/info/unicode/char/0cbf" mce_href="http://www.fileformat.info/info/unicode/char/0cbf">U+0cbf</A>, a.k.a. KANNADA VOWEL SIGN I)</EM></FONT></P>
<hr/><p><strong>harrymc</strong> on 25 Nov 2010 4:21 AM:</p><div style="margin-left: 1em"><p>&quot;tomorrow or the next day&quot; was more than 3 years ago ...</p>
</div>
<p><strong>Michael S. Kaplan</strong> on 25 Nov 2010 6:13 AM:</p><div style="margin-left: 1em"><p>Holding out hope for a response, I guess? :-)</p>
</div>
<hr/><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2007/07/06/3723277.html" title="Look out for Font Rage">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2007/07/06/3720057.html" title="Upgrading the rank of the people we talk about calendars with">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2007-07">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2007-07-06">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2007/07/06/3722803.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:38 GMT -->
</html>