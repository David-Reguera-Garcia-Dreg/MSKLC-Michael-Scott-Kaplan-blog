<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2007/07/29/4117994.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:38 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>A difference that makes no difference, makes no difference (aka IRQL <= APC_LEVEL vs IRQL < DISPATCH_LEVEL)</title></head><body>
<h1>A difference that makes no difference, makes no difference (aka IRQL <= APC_LEVEL vs IRQL < DISPATCH_LEVEL)</h1>
<p><em>by Michael S. Kaplan, published on 2007/07/29 10:11 -04:00, original URI: http://blogs.msdn.com/b/michkap/archive/2007/07/29/4117994.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostNew -->
<P>It was about a year ago that someone was looking at the Windows Developer Kit documentation and had a question.</P>
<P>They were comparing <A class="" href="http://msdn2.microsoft.com/library/ms803022.aspx" mce_href="http://msdn2.microsoft.com/library/ms803022.aspx">RtlUpcaseUnicodeChar</A>/<A class="" href="http://msdn2.microsoft.com/library/ms803011.aspx" mce_href="http://msdn2.microsoft.com/library/ms803011.aspx">RtlUpcaseUnicodeString</A>/<A class="" href="http://msdn2.microsoft.com/library/ms804309.aspx" mce_href="http://msdn2.microsoft.com/library/ms804309.aspx">RtlUpperChar</A>/<A class="" href="http://msdn2.microsoft.com/library/ms802964.aspx" mce_href="http://msdn2.microsoft.com/library/ms802964.aspx">RtlUpperString</A> versus <A class="" href="http://msdn2.microsoft.com/library/ms796892.aspx" mce_href="http://msdn2.microsoft.com/library/ms796892.aspx">RtlUpcaseUnicodeStringToCountedOemString</A>, in particular wondering why the first four were documented as requiring IRQL = PASSIVE_LEVEL while the latter was documented as requiring IRQL &lt; DISPATCH_LEVEL.</P>
<P>Apparently they were just confused as to the difference.</P>
<P>To me it made some sense that <A class="" href="http://msdn2.microsoft.com/library/ms796892.aspx" mce_href="http://msdn2.microsoft.com/library/ms796892.aspx">RtlUpcaseUnicodeStringToCountedOemString</A>, which is part of the IFS (Installable File System) document set and the kind of function (uppercase and convert to the OEM charset) that is most likely to be even possibly needed at APC_LEVEL anyway.</P>
<P>I decided not to say anything at the time (I was mostly cured of desire to clarify at this level after all the back-story in the research that came up in the comments of <STRONG><A class="" href="http://archives.miloush.net/michkap/archive/2005/02/18/376225.html" mce_href="http://archives.miloush.net/michkap/archive/2005/02/18/376225.html">Ready... set... Reboot!</A></STRONG>), and someone else from the team pointed out the obvious fact that the documentation was really not so far off from the truth anyway.</P>
<P>Though to be honest all five of them could be called at APC_LEVEL if needed. It is just that most of them would not be. So perhaps no change was really needed.</P>
<P>As <A class="" href="http://blogs.msdn.com/doronh/" mce_href="http://blogs.msdn.com/doronh/">Doron</A> pointed out last Spring in&nbsp;not entirely unrelated&nbsp;<A class="" href="http://blogs.msdn.com/doronh/archive/2006/03/03/543140.aspx#741245" mce_href="http://blogs.msdn.com/doronh/archive/2006/03/03/543140.aspx#741245">comments</A> to&nbsp;<A class="" href="http://blogs.msdn.com/doronh/archive/2006/03/03/543140.aspx" mce_href="http://blogs.msdn.com/doronh/archive/2006/03/03/543140.aspx">String buffers and IRQL</A>:</P>
<BLOCKQUOTE>
<P><EM><FONT face="times new roman,times">APC_LEVEL is probably OK since you can handle paging i/o at that IRQL, i don't think there is anything special in the NLS tables that would preclude APC_LEVEL.&nbsp; I don't mention APC_LEVEL much because for a non FS related driver, you don't deal with APC_LEVEL much, so talking about it leads to more confusion then if we just talk about IRQL as PASSIVE_LEVEL, DISPATCH_LEVEL, or DIRQL.</FONT></EM></P></BLOCKQUOTE>
<P>Anyway, they made changes to the documentation after this conversation, with the former four functions now being documented as requiring IRQL &lt;= APC_LEVEL and the latter requiring IRQL &lt; DISPATCH_LEVEL (the latter did not change, while the former four did).</P>
<P>Which to me is weird, since the two directives are essentially identical, though the one that is theoretically more likely to find APC_LEVEL interesting given functionality requirements makes no mention of APC_LEVEL, while the four that probably are not going to need it explicitly mention it.</P>
<P>Not a big deal, and maybe not even worth changing, since a difference that makes no difference, makes no difference.</P>
<P>It just seems weird to me....</P>
<P mce_keep="true">&nbsp;</P>
<P><FONT color=#ff00ff><EM>This post brought to you by</EM> <FONT size=5>à¹†</FONT> <EM>(<A class="" href="http://www.fileformat.info/info/unicode/char/0e46" mce_href="http://www.fileformat.info/info/unicode/char/0e46">U+0e46</A>, a.k.a. THAI CHARACTER MAIYAMOK)</EM></FONT></P>
<hr/><div style="margin-left: 1em"><em>no comments</em></div><hr/><p><em>referenced by</em></p><div style="margin-left: 1em"><p>2011/03/17 <a href="http://archives.miloush.net/michkap/archive/2011/03/17/10142495.html">Even when everything is in Unicode, some things won't be in Unicode</a></p></div><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2007/07/29/4119108.html" title="Whether or not you&#39;re my &#39;type&#39; you might see me at TypeCon 2007">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2007/07/29/4115581.html" title="Falling less is not always better">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2007-07">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2007-07-29">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2007/07/29/4117994.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:38 GMT -->
</html>