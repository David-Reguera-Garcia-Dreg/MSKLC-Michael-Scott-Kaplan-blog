<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2007/01/02/1395703.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:38 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>Converting a Project to Unicode: Part 6 (Upon the road not traveled)</title></head><body>
<h1>Converting a Project to Unicode: Part 6 (Upon the road not traveled)</h1>
<p><em>by Michael S. Kaplan, published on 2007/01/02 06:01 -05:00, original URI: http://blogs.msdn.com/b/michkap/archive/2007/01/02/1395703.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostNew -->
<P>Previous posts in this series (including today's!): 
<UL>
<LI><A href="http://archives.miloush.net/michkap/archive/2006/12/27/1368334.html" mce_href="http://archives.miloush.net/michkap/archive/2006/12/27/1368334.html">Part 0 (The introduction)</A> 
<LI><A href="http://archives.miloush.net/michkap/archive/2006/12/28/1372747.html" mce_href="http://archives.miloush.net/michkap/archive/2006/12/28/1372747.html">Part 1 (Business before pleasure)</A> 
<LI><A class="" href="http://archives.miloush.net/michkap/archive/2006/12/29/1377788.html" mce_href="http://archives.miloush.net/michkap/archive/2006/12/29/1377788.html">Part 2 ('Sorry, you're not my type.' 'Um,&nbsp;maybe&nbsp;I could change that?)</A> 
<LI><A class="" href="http://archives.miloush.net/michkap/archive/2006/12/30/1382886.html" mce_href="http://archives.miloush.net/michkap/archive/2006/12/30/1382886.html">Part 3 (Can I quote you on that?)</A> 
<LI><A class="" href="http://archives.miloush.net/michkap/archive/2006/12/31/1386486.html" mce_href="http://archives.miloush.net/michkap/archive/2006/12/31/1386486.html">Part 4 (/Delightful, /Delicious, /DUnicode!)</A> 
<LI><A class="" href="http://archives.miloush.net/michkap/archive/2007/12/01/1391798.html" mce_href="http://archives.miloush.net/michkap/archive/2007/12/01/1391798.html">Part 5 (Are we there yet? Well, not just yet)</A></LI>
<LI><A class="" href="http://archives.miloush.net/michkap/archive/2007/01/02/1395703.html" mce_href="http://archives.miloush.net/michkap/archive/2007/01/02/1395703.html">Part 6 (Upon&nbsp;the road not traveled)</A></LI></UL>
<P>(If you are&nbsp;just tuning&nbsp;in and want to start&nbsp;now you can grab the current source from <A class="" href="http://www.trigeminal.com/samples/SETUP_SOURCE/part05.zip" mce_href="http://www.trigeminal.com/samples/SETUP_SOURCE/part05.zip">here</A>&nbsp;-- no changes since it was posted yesterday)</P>
<P>Now if you have read Parts <STRONG><A class="" href="http://archives.miloush.net/michkap/archive/2006/12/29/1377788.html" mce_href="http://archives.miloush.net/michkap/archive/2006/12/29/1377788.html">2</A></STRONG>, <STRONG><A class="" href="http://archives.miloush.net/michkap/archive/2006/12/30/1382886.html" mce_href="http://archives.miloush.net/michkap/archive/2006/12/30/1382886.html">3</A></STRONG>, <STRONG><A class="" href="http://archives.miloush.net/michkap/archive/2006/12/31/1386486.html" mce_href="http://archives.miloush.net/michkap/archive/2006/12/31/1386486.html">4</A></STRONG>, and <A class="" href="http://archives.miloush.net/michkap/archive/2007/12/01/1391798.html" mce_href="http://archives.miloush.net/michkap/archive/2007/12/01/1391798.html"><STRONG>5</STRONG></A> then you know how we went from a purely ANSI application to a purely Unicode one.</P>
<P>The binary itself has been tested with the MSKLC update and it resolves the bug I talked about back in <A class="" href="http://archives.miloush.net/michkap/archive/2006/12/27/1368334.html" mce_href="http://archives.miloush.net/michkap/archive/2006/12/27/1368334.html"><STRONG>Part 0</STRONG></A>. And the Unicode Bootstrap EXE works for the scenarios in which it will be used.</P>
<P>(which, as the lessons of Part <A class="" href="http://archives.miloush.net/michkap/archive/2007/12/01/1391798.html" mce_href="http://archives.miloush.net/michkap/archive/2007/12/01/1391798.html"><STRONG>5</STRONG></A>&nbsp;hopefully taught everyone, means that there could still be bugs in the other scenarios like internet downloads -- these will have to be tested by somebody at some point!).</P>
<P>But perhaps people who have done this type of thing&nbsp;before felt uncomfortable with the route I took -- all of those global changes in parts <STRONG><A class="" href="http://archives.miloush.net/michkap/archive/2006/12/29/1377788.html" mce_href="http://archives.miloush.net/michkap/archive/2006/12/29/1377788.html">2</A></STRONG> and <STRONG><A class="" href="http://archives.miloush.net/michkap/archive/2006/12/30/1382886.html" mce_href="http://archives.miloush.net/michkap/archive/2006/12/30/1382886.html">3</A></STRONG> might seem quite different from the way of just compiling with UNICODE and _UNICODE and fixing errors as they come. Certainly the experience I set people up for earlier in <STRONG><A class="" href="http://archives.miloush.net/michkap/archive/2006/12/28/1372747.html" mce_href="http://archives.miloush.net/michkap/archive/2006/12/28/1372747.html">Part 1</A></STRONG> was a lot uglier than what actually happened. So why would I have done it that way, and what is the experience like if it is not done that way?</P>
<P>Well, you start with a lot more errors, obviously. And due to the many dependencies in the files (like the header files, and&nbsp;all the functions in util.cpp used throughout the code), you can easily find yourself revisiting the same&nbsp;files over and over again as you compile all and continually break files that you just fixed.</P>
<P>As to why I prepared for much more dire experiences, the Bootstrap EXE sample project was as pretty tame one, with a reasonably small number of changes to make beyond datatypes. Some cases are not quite as clean as that and can have many more -- some project you my apply the same plan to could be a lot more brutal in terms of number of errors...</P>
<P>I really prefer not to take the harder&nbsp;route though, since you can easily miss cases -- for example think of all the times that you have to catch sizeof(char) or sizeof(CHAR) and change it to sizeof(TCHAR). All you have to do is miss one and you'll hit bugs like the one in <A class="" href="http://archives.miloush.net/michkap/archive/2007/12/01/1391798.html" mce_href="http://archives.miloush.net/michkap/archive/2007/12/01/1391798.html"><STRONG>Part&nbsp;5</STRONG></A> caused by your Unicode migration rather than by pre-existing bugs. Because bugs like that are not found at compile time, so you have to pay the price later in terms of bugs or problems you catch in unit testing. And in the rush to make changes, compile, make more changes, compile again, and so on, it is easier to miss things.</P>
<P>Like is just a lot easier if the global changes can be made upfront so you can focus on the special cases....</P>
<P>Of course you are welcome to try it if you like -- just do Part&nbsp;<A class="" href="http://archives.miloush.net/michkap/archive/2006/12/31/1386486.html" mce_href="http://archives.miloush.net/michkap/archive/2006/12/31/1386486.html"><STRONG>4</STRONG></A>&nbsp;after skipping parts&nbsp;<STRONG><A class="" href="http://archives.miloush.net/michkap/archive/2006/12/29/1377788.html" mce_href="http://archives.miloush.net/michkap/archive/2006/12/29/1377788.html">2</A></STRONG>&nbsp;and <A class="" href="http://archives.miloush.net/michkap/archive/2006/12/30/1382886.html" mce_href="http://archives.miloush.net/michkap/archive/2006/12/30/1382886.html"><STRONG>3</STRONG></A>....</P>
<P><EM>Tomorrow,&nbsp;Part&nbsp;7 will be going up to do more than just jabber about stuff like this post did!</EM></P>
<P mce_keep="true">&nbsp;</P>
<P><FONT color=#ff00ff><EM>This post brought to you by</EM>&nbsp;<FONT size=4>ܛ</FONT> <EM>(<A class="" href="http://www.fileformat.info/info/unicode/char/071b" mce_href="http://www.fileformat.info/info/unicode/char/071b">U+071b</A>, a.k.a. SYRIAC LETTER TETH)</EM></FONT></P>
<hr/><p><a id="1405409" href="#1405409">#</a> <strong>Erzengel</strong> on 3 Jan 2007 12:34 PM:</p><div style="margin-left: 1em"><p>&gt;&gt;As to why I prepared for much more dire experiences, the Bootstrap EXE sample project was as pretty tame one, with a reasonably small number of changes to make beyond datatypes. Some cases are not quite as clean as that and can have many more -- some project you my apply the same plan to could be a lot more brutal in terms of number of errors...&lt;&lt;</p>
<p>I just did this, I was converting OGRE ( <a rel="nofollow" target="_new" href="http://www.ogre3d.org/">http://www.ogre3d.org</a> ) to TCHAR (well, half of it so far). One problem I ran into is that, several times, they used char* as a byte buffer. Wholesale char to OgreChar (or TCHAR) was not a good idea.</p>
<p>Writing a VS macro to properly encase all strings with &quot;OgreText()&quot; (or &quot;_TEXT()&quot;) was a good idea though. </p></div>
<p><a id="1406394" href="#1406394">#</a> <strong>Michael S. Kaplan</strong> on 3 Jan 2007 2:32 PM:</p><div style="margin-left: 1em"><P>That feature to search for "whole words only" can really come in handy.... :-)</P></div>
<p><a id="1406884" href="#1406884">#</a> <strong>Erzengel</strong> on 3 Jan 2007 3:54 PM:</p><div style="margin-left: 1em"><p>I actually used match whole word only and match case.</p>
<p>The problem is when char* is used as a byte buffer, for example when writing *data* to and from a file, or to a memory stream (like D3D's ID3D10Buffer). In this case it's required to be a certain number of bytes, so I had to make a byte typedef.</p>
<p>Also Ogre uses &quot;GetProcAddress(module, SymbolName.c_str())&quot;. When SymbolName is a std::wstring, I needed to make a change (in this case, WideCharToMultiByte it into a UTF8 string (probably not a good idea, but when I export a function called 殺すfrom VS and use GetProcAddress on the UTF8 string, it works) and then pass to GetProcAddress).</p></div>
<p><a id="1407057" href="#1407057">#</a> <strong>Michael S. Kaplan</strong> on 3 Jan 2007 4:38 PM:</p><div style="margin-left: 1em"><p>Ah, for that case the handy &quot;review each change, don't use REPLACE ALL&quot; is your friend. :-)</p>
</div>
<p><a id="1407090" href="#1407090">#</a> <strong>Erzengel</strong> on 3 Jan 2007 4:52 PM:</p><div style="margin-left: 1em"><p>Indeed. This was before you started your series. Your advice might have changed things. :)</p>
<p>Like I said, wholesale replace of &quot;char&quot; with &quot;OgreChar&quot; was probably not the best of ideas.</p>
<p>Building a VS IDE Macro that fixes all quoted strings that aren't after a #include, nor already fixed, was a good idea.</p>
<p>Although I might want to modify it to also ignore Assert(i == 0 &amp;&amp; &quot;The assertion failed for such and such a reason&quot;) because the message &quot;Assertion &quot;i ==0 &amp;&amp; _TEXT(&quot;The assertion failed for such and such a reason&quot;)&quot; failed&quot; is a bit... odd.</p>
<p>But OGRE is a case where reviewing takes a large amount of time because there is a _lot_ of chars that should have been OgreChars, and far fewer that should have been bytes.</p></div>
<hr/><p><em>referenced by</em></p><div style="margin-left: 1em"><p>2007/12/24 <a href="http://archives.miloush.net/michkap/archive/2007/12/24/6843995.html">VS just got served!, aka The ??? Shift, aka 'Converting a project to Unicode???' No, it's 'Converting a project??? ToUnicode!!!'</a></p><p>2007/01/05 <a href="http://archives.miloush.net/michkap/archive/2007/01/05/1413001.html">Converting a project to Unicode: Part 9 (The project's postpartum postmortem)</a></p><p>2007/01/04 <a href="http://archives.miloush.net/michkap/archive/2007/01/04/1409380.html">Converting a project to Unicode: Part 8 (Fitting MSLU into the mix)</a></p><p>2007/01/03 <a href="http://archives.miloush.net/michkap/archive/2007/01/03/1395788.html">Converting a Project to Unicode: Part 7 (What does it mean to fit things to a 'T', anyway?)</a></p></div><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2007/01/02/1396598.html" title="Right behavior, wrong scenario">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2007/01/01/1391798.html" title="Converting a Project to Unicode: Part 5 (Are we there yet? Well, not *just* yet)">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2007-01">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2007-01-02">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2007/01/02/1395703.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:38 GMT -->
</html>