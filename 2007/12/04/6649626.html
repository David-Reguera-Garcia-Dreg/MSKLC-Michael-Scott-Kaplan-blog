<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2007/12/04/6649626.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:37 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>Span of influence not quite as big as a TimeSpan (aka TimeSpan shot first!)</title></head><body>
<h1>Span of influence not quite as big as a TimeSpan (aka TimeSpan shot first!)</h1>
<p><em>by Michael S. Kaplan, published on 2007/12/04 10:16 -05:00, original URI: http://blogs.msdn.com/b/michkap/archive/2007/12/04/6649626.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostNew -->
<P>It starts simple.</P>
<P>Beyond the obvious confusion of the meaning of the word <STRONG>Span</STRONG> in the title, intended to be vaguely reminiscent of a classic mistake in distance vs. time found in the original Star Wars movie involving parsecs originally intended to prove that Han Solo was braggart who talked out of his ass at times to try to get a job, later retcon'ed into an outrageous explanation (possibly in an effort to rehabilitate Han's character&nbsp;just like&nbsp;Lucas did with having him not shoot Greedo first!).</P>
<P>Unfortunately I think the stretch here is too great and I should just get on with the post and stop trying to rehabilitate the title's allusion; that goal is as flawed as that of George Lucas vis-a-vis Han.... :-)</P>
<P>Anyway, as it said, it (the technical issue being discussed today) starts simple.</P>
<P>With <A class="" href="http://msdn2.microsoft.com/library/ms776372.aspx" mce_href="http://msdn2.microsoft.com/library/ms776372.aspx">GetDurationFormat</A> and <A class="" href="http://msdn2.microsoft.com/library/ms776364.aspx" mce_href="http://msdn2.microsoft.com/library/ms776364.aspx">GetDurationFormatEx</A>, two functions added to Vista and Server 2008 by the NLS team.</P>
<P>Very handy functionality when you need something that "<EM>Formats a duration of time as a time string for a locale specified by identifier.</EM>".</P>
<P>Now of course you can pass your own format string which kind of then ignores the locale, but it is obviously intended to most often represent results that any to be properly respectful to user settings.</P>
<P>Let's contrast it with&nbsp;the nearest managed analogue, the <A class="" href="http://msdn2.microsoft.com/library/system.timespan.aspx" mce_href="http://msdn2.microsoft.com/library/system.timespan.aspx">TimeSpan structure</A>, which is described as something that "<EM>Represents a time interval</EM>."</P>
<P>Unfortunately, unlike the ToString() overrides for other such classes -- e.g. <A class="" href="http://msdn2.microsoft.com/library/system.datetime.tostring.aspx" mce_href="http://msdn2.microsoft.com/library/system.datetime.tostring.aspx">DateTime.ToString()</A> -- the&nbsp;<A class="" href="http://msdn2.microsoft.com/library/system.timespan.tostring.aspx" mce_href="http://msdn2.microsoft.com/library/system.timespan.tostring.aspx">TimeSpan.ToString()</A> has&nbsp;no override taking an IFormatProvider, which means no culture-sensitive formatting for TimeSpan, despite the obvious need for it.</P>
<P>The one bit of happiness -- the number of ticks in TimeSpan (retrievable as <A class="" href="http://msdn2.microsoft.com/library/system.timespan.ticks.aspx" mce_href="http://msdn2.microsoft.com/library/system.timespan.ticks.aspx">TimeSpan.Ticks</A>) is defined as</P>
<BLOCKQUOTE>
<P><EM>The smallest unit of time is the tick, which is equal to 100 nanoseconds. A tick can be negative or positive.</EM></P></BLOCKQUOTE>
<P>And&nbsp;the ullDuration parameter to <A class="" href="http://msdn2.microsoft.com/library/ms776372.aspx" mce_href="http://msdn2.microsoft.com/library/ms776372.aspx">GetDurationFormat</A> is defined as:</P>
<BLOCKQUOTE>
<P><EM>[in] 64-bit unsigned integer that represents the number of 100-nanosecond intervals in the duration. If both lpDuration and ullDuration are present, then lpDuration takes precedence. If lpDuration is NULL and illustration is zero, then the duration is zero. </EM></P></BLOCKQUOTE>
<P>So it looks like you can&nbsp;format a TimeSpan using the ulDuration parameter of <A class="" href="http://msdn2.microsoft.com/library/ms776372.aspx" mce_href="http://msdn2.microsoft.com/library/ms776372.aspx">GetDurationFormat</A>&nbsp;if you are willing to live with the &gt;= Vista limitation on formatting (TimeSpan has been around at least since 1.1 of the .NET Framework, so you can use this on many more versions than exist for the unmanaged function).</P>
<P><EM>(One caveat -- the managed function can be negative or positive, while the unmanaged function takes an unsigned value -- so you are limited in that way as well, by the need to store the sign separately and figure out how to integrate it in later, conceptually!)</EM></P>
<P>So as the title indicates, the NLS team's scope of influence does not extend as far as a TimeSpan.... since the class seems to have stayed below the System.Globalization radar almost since the beginning of the .NET Framework....</P>
<P mce_keep="true">&nbsp;</P>
<P><FONT color=#ff00ff><EM>This post brought to you by</EM><FONT size=5> áž¿ </FONT><EM>(<A class="" href="http://www.fileformat.info/info/unicode/char/17bf" mce_href="http://www.fileformat.info/info/unicode/char/17bf">U+17bf</A>, a.k.a. KHMER VOWEL SIGN YA)</EM></FONT></P>
<hr/><p><a id="6692123" href="#6692123">#</a> <strong>Andrew Webb</strong> on 7 Dec 2007 6:50 AM:</p><div style="margin-left: 1em"><p>Not only does TimeSpan's ToString not allow you to control formatting, but it also assumes that the decimal point is always the &quot;.&quot; character. &nbsp;Changing the current thread's current culture to fr-FR did not cause TimeSpan.ToString to use &quot;,&quot; instead. &nbsp;Naughty. &nbsp;And given the way of things, unlikely to ever be fixed.</p></div>
<p><a id="6853905" href="#6853905">#</a> <strong>Tanveer Badar</strong> on 24 Dec 2007 11:18 AM:</p><div style="margin-left: 1em"><p>Why not file a bug on connect.microsoft.com about it?</p>
</div>
<p><a id="6859376" href="#6859376">#</a> <strong>Michael S. Kaplan</strong> on 25 Dec 2007 1:00 AM:</p><div style="margin-left: 1em"><p>For an in-built design limitation that has existed for the last five versions of the product? Hmmm...</p>
</div>
<hr/><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2007/12/05/6648893.html" title="No way to get that script info I was looking for earlier">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2007/12/04/6644773.html" title="Living on the top floor of a 3-story walk-up, and signing my name on every email....">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2007-12">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2007-12-04">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2007/12/04/6649626.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:37 GMT -->
</html>