<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2007/12/08/6708151.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:37 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>Social engineering in Windows Explorer....</title></head><body>
<h1>Social engineering in Windows Explorer....</h1>
<p><em>by Michael S. Kaplan, published on 2007/12/08 14:31 -08:00, original URI: http://blogs.msdn.com/michkap/archive/2007/12/08/6708151.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostOld -->
<P>Regular reader Jan Kučera suggested in response to <A class="" href="http://archives.miloush.net/michkap/archive/2007/10/24/5641619.html" mce_href="http://archives.miloush.net/michkap/archive/2007/10/24/5641619.html"><STRONG>In Case you have problems that you might think are ǸȦȘȚȲ</STRONG></A> in a <A class="" href="http://archives.miloush.net/michkap/archive/2007/10/24/5641619.html#6645710" mce_href="http://archives.miloush.net/michkap/archive/2007/10/24/5641619.html#6645710">comment</A>:</P>
<BLOCKQUOTE>
<P><EM><FONT face="times new roman,times">Although this scenario might seem quite NASTY, why does Vista the same thing when copying folders/files beginning/ending with space?<BR><BR>One question is whether to allow user to create such folders/files, but not be able to copy them when they are there is another one I think (which I feel should be supported).<BR><BR>I came to this just when I wanted to copy "Folder" and " Folder" from XP HDD to Vista's one. XP had no problems copying this by dragging in Explorer, but Vista refused. What was the reason for this change?<BR><BR>I am aware this is not a NTFS versioning related problem, though (sorry) (it can by workarounded by copying using the command line).</FONT></EM></P></BLOCKQUOTE>
<P>This is an interesting case, almost a bit of social engineering for end users, similar in spirit to the developer bit of social engineering I have discussed previously in posts like <A class="" href="http://archives.miloush.net/michkap/archive/2006/05/31/612544.html" mce_href="http://archives.miloush.net/michkap/archive/2006/05/31/612544.html"><STRONG>Keeping out the undesirables?</STRONG></A> and others I have talked about in the past.</P>
<P>Where things that are legal at the lower levels are disallowed at the levels above.</P>
<P>This particular change, I kind of like -- if you ignore the people who test edge cases and the ornery folk like me, who else would ever hit this sort of problem other than somebody making a mistake -- accidentally typing the space bar, a genuine typo?</P>
<P>It is interesting that if you try to create the folder " FOO" in Explorer in&nbsp;Vista it will be&nbsp;created without the space -- so the warnings that may come up are expected.</P>
<P>If you create the folder with the prepended space in CMD and then try to create one without the space in Explorer, the creation succeeds!</P>
<P>So really it is just inside Explorer (and probably most Shell-related file/folder handling functions) that you would be blocked from the extra shenanigans (most likely via a SHLWAPI <A class="" href="http://msdn2.microsoft.com/library/bb773454.aspx" mce_href="http://msdn2.microsoft.com/library/bb773454.aspx">StrTrim</A> call), though of course the Unicode-savvy among us will find all kinds of spaces in the Unicode <A class="" href="http://www.fileformat.info/info/unicode/category/Zs/list.htm" mce_href="http://www.fileformat.info/info/unicode/category/Zs/list.htm">Zs</A> (Separator, Space) general category, most of which will not be trimmed by this particular feature -- since in all likelihood it is a <A class="" href="http://msdn2.microsoft.com/library/bb773454.aspx" mce_href="http://msdn2.microsoft.com/library/bb773454.aspx">StrTrim</A> call that is not listing all of those characters!).</P>
<P>Now I myself like to use fullwidth characters like <STRONG>：</STRONG>, <STRONG>／</STRONG>, and <STRONG>＼</STRONG> when I want to use these characters in filenames because they are in titles and I don't want to be hampered by the filesystem rules (this is also a fun way to find non-Unicode applications since they will best fit map to their regular halfwidth counterparts that are illegal in file and folder names.</P>
<P>And I like spotting non-Unicode applications. :-)</P>
<P>Would I be bothered if some future version of Explorer decided to make it harder to create files and folders like that? Probably not.</P>
<P>Would others? Would this&nbsp;keep a person from wanting to&nbsp;upgrade if confusable characters that looked a lot like illegal characters were also blocked? Perhaps it would!</P>
<P>So I tend to think of the Shell behavior as intending to center itself on operations that probably are typos, rather than the ones that are more intentional -- so maybe my strange acts are safe here.</P>
<P>But putting all that aside, it is an interesting philosophical question -- how much to blur the line between the character identity a function&nbsp;as <A class="" href="http://msdn2.microsoft.com/library/ms776340.aspx" mce_href="http://msdn2.microsoft.com/library/ms776340.aspx">CompareStringOrdinal</A> would understand it as opposed to international domain names, or to a regular user or the <A class="" href="http://msdn2.microsoft.com/library/ms647477.aspx" mce_href="http://msdn2.microsoft.com/library/ms647477.aspx">CompareStringEx</A> function. Do you stop at the "avoiding typos" level or would you extend it to the "avoiding confusables" level?</P>
<P>And when you answer, keep in mind all of the rules surrounding international domain names -- does your answer change when you think about the creation of folders and files in the non-virtualized directories and files on a web server? Would you like for Explorer to behave differently in that case, to avoid the creation of files on a web server that could not be accessed by others through the web interface?</P>
<P>Of course I don't speak for the Shell team so I have no idea if they would want to expand this behavior or not. Though if they do ask, you might now have some insight into what I'll tell them. :-)</P>
<P mce_keep="true">&nbsp;</P>
<P><FONT color=#ff00ff><EM>This post brought to you by</EM> <FONT size=5>／</FONT>,&nbsp; <FONT size=5>：</FONT>, and <FONT size=5>＼</FONT> <EM>(<A class="" href="http://www.fileformat.info/info/unicode/char/ff0f" mce_href="http://www.fileformat.info/info/unicode/char/ff0f">U+ff0f</A>, <A class="" href="http://www.fileformat.info/info/unicode/char/ff1a" mce_href="http://www.fileformat.info/info/unicode/char/ff1a">U+ff1a</A>,&nbsp;and&nbsp;<A class="" href="http://www.fileformat.info/info/unicode/char/ff3c" mce_href="http://www.fileformat.info/info/unicode/char/ff3c">U+ff3c</A>, aka FULLWIDTH SOLIDUS,&nbsp;FULLWIDTH COLON, nd FULLWIDTH REVERSE SOLIDUS)</EM></FONT></P>
<hr/><p><a id="6709042" href="#6709042">#</a> <strong>Zooba</strong> on Saturday, December 08, 2007 8:03 PM:</p><div style="margin-left: 1em"><p>Am I the only one who sniggered at &quot;fullwidth colon&quot;?</p>
<p>Growing up appears to be on my to do list...</p></div>
<p><a id="6709551" href="#6709551">#</a> <strong>Dean Harding</strong> on Saturday, December 08, 2007 9:24 PM:</p><div style="margin-left: 1em"><p>I think the problem is not when *creating* the files -- explorer in XP will silently trim spaces before and after the name as well -- the problem is when you go to copy such files that you've created through some other means.</p>
<p>In Windows XP, you can copy &quot; Foo&quot; and &quot;Foo&quot; to the same folder by dragging-and-dropping. In Vista it thinks they've got the same name and asks whether you want to overwrite one with the other.</p></div>
<p><a id="6709646" href="#6709646">#</a> <strong>Michael S. Kaplan</strong> on Saturday, December 08, 2007 9:34 PM:</p><div style="margin-left: 1em"><P>My Vista doesn't do that at all for me in creation if the "space" version is created from CMD.</P>
<P>So far every behavior I have seen looks right. I do get offersto merge folders when they are the same, but never an overwrite request.</P>
<P>Perhaps someone could provide the reproducible steps if they say something different?</P></div>
<p><a id="6710799" href="#6710799">#</a> <strong>Dean Harding</strong> on Sunday, December 09, 2007 1:30 AM:</p><div style="margin-left: 1em"><p>OK, here's my steps:</p>
<p>From the command prompt, type:</p>
<p>echo test1 &gt; &quot;hello.txt&quot;</p>
<p>echo test2 &gt; &quot; hello.txt&quot;</p>
<p>Then, in explorer, drag those two files to a different folder. I get the &quot;There is already a file with the same name in this location&quot; prompt. If you choose the &quot;Copy &amp; keep both files&quot; option, it copies one as &quot;hello.txt&quot; and the other as &quot;hello (2).txt&quot; -- no space.</p></div>
<p><a id="6710813" href="#6710813">#</a> <strong>Dean Harding</strong> on Sunday, December 09, 2007 1:31 AM:</p><div style="margin-left: 1em"><p>The point is that this is different to explorer in XP. If you drag the two files to another location in XP, it just copies/moves them without complaint.</p></div>
<p><a id="6737116" href="#6737116">#</a> <strong>Michael S. Kaplan</strong> on Tuesday, December 11, 2007 1:04 PM:</p><div style="margin-left: 1em"><p>Igor is unhappy about new behavior that reportedly isn't new? :-)</p>
<p>I can repro with Dean's steps, though I don't see this change as all that bad, myself -- the fact that you can't create them in Explorer makes this an edge case for most people....</p></div>
<p><a id="6745612" href="#6745612">#</a> <strong>Dean Harding</strong> on Wednesday, December 12, 2007 6:24 AM:</p><div style="margin-left: 1em"><p>I agree it's an edge-case, and to be honest, I didn't even know about it until I read your post. I was just making sure we understood what Jan was talking about :-)</p>
<p>I'm not sure what Igor is talking about either. The behaviour he describes has not changed since (at least) XP. Maybe it was true in 2000 but I don't have w2k to test on anymore... I prefer the stripping space thing myself, because it's usually UNintentional for me. What's wrong with using numbers to order things in a list?</p></div>
<p><a id="6751053" href="#6751053">#</a> <strong>Igor Levicki</strong> on Wednesday, December 12, 2007 3:57 PM:</p><div style="margin-left: 1em"><P>I thought that explorer in XP allowed spaces before the name but it seems I was wrong.</P>
<P>For me it is strange that the computer doesn't do what you tell it to do.</P>
<P>If I type spaces before the name that is because I want them there. I hate it when the software plays smart on me because usually neither the software nor the one who wrote it are smarter than me.</P>
<P>Software _is_ stupid, here's the most recent example of the top of my head:</P>
<P>Recently I had to troubleshoot bluetooth USB dongle installation problem and I lost enormous amount of time doing it. Installation was failing with the "access denied" error. No explanation what it was denied access to, nothing. setupapi.log, regmon.log, nothing. It turned out that it was failing because it couldn't create a shortcut in the Start Menu!!!</P>
<P>Shortcut was already there and it was read only.</P>
<P>Smart software would do one of the following:</P>
<OL>
<LI>give more sensible error message to user</LI>
<LI>ask you if it is ok to overwrite read only file</LI>
<LI>check if the files are byte identical and if so continue</LI>
<LI>create new shortcut by appending number to the name</LI>
<LI>complain and offer to create a shortcut on the desktop instead</LI>
<LI>perform this step at the very end after all hardware was installed</LI></OL>
<P>And yet, with so many smarter choices available, it simply died with a cryptic "access denied" message and I spent 5+ days troubleshooting it with a colleague of yours until we finally figured it out.</P>
<P>In my opinion, if space is a valid character in a file/folder name (which it is), then Explorer should not prevent you from using it. Period.</P></div>
<p><a id="6751209" href="#6751209">#</a> <strong>Igor Levicki</strong> on Wednesday, December 12, 2007 4:12 PM:</p><div style="margin-left: 1em"><p>Dean,</p>
<p>As for numbering, if you use numbers and you make a mistake in ordering things you have more work to do to fix it:</p>
<p>1jkl</p>
<p>2def</p>
<p>3abc</p>
<p>To put 3abc on the second position you need to rename 3abc to 2abc (providing you don't have 2abc already), then rename 2def to 3def (providing that you don't have 3def already).</p>
<p>On the other hand if you had (-=space so you can count them):</p>
<p>---jkl</p>
<p>--def</p>
<p>-abc</p>
<p>Then you would just have to add one space to abc.</p></div>
<p><a id="6786846" href="#6786846">#</a> <strong>Michael S. Kaplan</strong> on Monday, December 17, 2007 2:07 AM:</p><div style="margin-left: 1em"><p>Hi Igor,</p>
<p>This is a little contrived, in my opinion. It is not realistic to expect a regular user to create such a set of files in Explorer (and if it is done programatically then it will work just fine). So I really have trouble seeing that as a bug....</p></div>
<p><a id="6795267" href="#6795267">#</a> <strong>Jan Kučera</strong> on Tuesday, December 18, 2007 4:19 AM:</p><div style="margin-left: 1em"><p>Okay guys, my question, so I should give some explanation and thougs.</p>
<p>First of all, I don't mind that Vista's Explorer trimms the name upon creation/rename. You see this immediately and I expect that if you need to create a file/folder beginning/ending with space or whatever, you are experienced enough to use the command line.</p>
<p>Then, I did not do any special kind of trick to find out this behaviour. I was just blindly using 3rd party software as my grandmum would, which creates folders named the same as your project and guess what, it allows you to start your project name with space and does not trim that. Later, when I just wanted to copy whole application's user folder to another location - here we are. Somewhere deep in the structure, the copy failed. :(</p>
<p>Finally I agree with Dean. I mean it is okay for me to not allow occasional user to enter such names, but once they are there, no matter how it happened, do not break the system when manipulating them. Windows allowed me to create these, so they should also allow me to move/copy/whatever them.</p>
<p>Unless however, the file copy API are okay with it, which I can't test now. That way its back up to you - you created them, you have to manipulate them.</p>
<p>However, this topic is more for The Old New Thing then for Sorting It All Out, don't you think? ;-)</p>
<p>Jan</p></div>
<p><a id="6795295" href="#6795295">#</a> <strong>Michael S. Kaplan</strong> on Tuesday, December 18, 2007 4:23 AM:</p><div style="margin-left: 1em"><p>Yes, technically it might be. But it is still interesting to me, which means is is on-topic for here. :-)</p></div>
<p><a id="6795907" href="#6795907">#</a> <strong>Jan Kučera</strong> on Tuesday, December 18, 2007 6:47 AM:</p><div style="margin-left: 1em"><p>Then it's all right. :-)</p>
<p>Okay I checked some APIs, and they seem to work properly (both managed and unmanaged), as actually suggests the command line workaround.</p>
<p>So, either the Vista's Explorer does its own checking and trimming before copying/moving (as this does not come from the CreateDirectory's ERROR_ALREADY_EXISTS)(and this seems very strange to me) or uses some API I have no idea of.</p>
<p>Well I don't think I can do much more here, any further ideas?</p></div>
<p><a id="6797373" href="#6797373">#</a> <strong>Michael S. Kaplan</strong> on Tuesday, December 18, 2007 10:34 AM:</p><div style="margin-left: 1em"><p>The Shell/shlwapi keeps a consistent interface for the stuff it does itself, so it would make sense if move/copy/create all want through a consistent interface. </p>
<p>I sort of see the exception here, though I guess if I had ever run across it myself or somebody gave me a more convincing example a non irregular user like myself ran/runs into I'd be more swayed.... :-)</p></div>
<p><a id="6814036" href="#6814036">#</a> <strong>Dean Harding</strong> on Thursday, December 20, 2007 1:34 AM:</p><div style="margin-left: 1em"><p>Well, it's still possible for a regular user, depending on what programs they use. For example, say you play a game, and this game lets you type in a name for your savegames, and then it saves them as a file with whatever name you specified. It probably will not trim the spaces from the name you type in. If you then want to copy your savegame from one place to another, you might run into a problem with explorer renaming the file as you copy it.</p>
<p>Perhaps not entirely &quot;regular&quot; but not really in the realms of &quot;irregularity&quot; either...</p>
<p>From what I can see, I think it has to do with the new IFileOperation interface introduced in Vista. Since this new interface handles copy, move, delete, creating new items, renaming items and so on, my guess is that it was HERE that the trimming code was added -- and it was added to ALL operations that IFileOperation can perform. I guess I could try it out by writing a sample myself, but I'm too lazy :-)</p></div>
<p><a id="6888167" href="#6888167">#</a> <strong>Igor</strong> on Friday, December 28, 2007 3:05 PM:</p><div style="margin-left: 1em"><p>Any file manager (Total Commander, Directory Opus, etc) will also allow you to create files and folders with a leading space. Not being able to access them without having one of those managers installed is inconvenience for the user.</p>
<p>As I said, my main issue with this behavior is -- computer should do what you tell him to do, not what it feels like doing.</p></div>
<p><a id="7647083" href="#7647083">#</a> <strong>Jan Kučera</strong> on Tuesday, February 12, 2008 11:51 AM:</p><div style="margin-left: 1em"><p>Dean, this is exactly the repro how I came to the problem. Thank you for the IFileOperation hint, as I did not have the success with shlwapi either. Though, being not a C++ developer (yet) I cannot test IFileOperation myself. ;-)</p></div>
<hr/><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2007/12/09/6673424.html" title="In SQL Server, the alphabet does not end at Z!">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2007/12/08/6669846.html" title="In SQL Server, your ranges also need to ACCENT-uate the positives!">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2007-12">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2007-12-08">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2007/12/08/6708151.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:37 GMT -->
</html>