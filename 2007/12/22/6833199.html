<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2007/12/22/6833199.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:36 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>CultureInfo subsetting attempts that suck</title></head><body>
<h1>CultureInfo subsetting attempts that suck</h1>
<p><em>by Michael S. Kaplan, published on 2007/12/22 10:01 -05:00, original URI: http://blogs.msdn.com/b/michkap/archive/2007/12/22/6833199.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostNew -->
<P>When you think about locales (or make that cultures for those of you who are into managed code), you are basically looking at, for lack of a better bit of terminology, buckets of information. Buckets that vary according to language or region or dialect or script or&nbsp;a combination of some or all of these things.</P>
<P>In Win32, for years people complained for years about how the locale "buckets" were simply too huge and that data should be cut up into smaller bundles. So two separate items were added, starting in the earliest&nbsp;version of the .NET Framework's System.Globalization namespace:</P>
<UL>
<LI>The <A class="" href="http://msdn2.microsoft.com/library/system.globalization.regioninfo.aspx" mce_href="http://msdn2.microsoft.com/library/system.globalization.regioninfo.aspx">RegionInfo class</A>, whose intent is to take data from locales that are specific to location and separate them out from the large bucket of locales/cultures, and</LI>
<LI>Neutral cultures, whose intent is to support only the properties within a <A class="" href="http://msdn2.microsoft.com/library/system.globalization.cultureinfo.aspx" mce_href="http://msdn2.microsoft.com/library/system.globalization.cultureinfo.aspx">CultureInfo object</A> that&nbsp;are specific to language and separate them out from the large bucket of locales/cultures;</LI></UL>
<P>In the end, both of these intents met with both implementation flaws and an overarching fundamental design flaw that limits their usefulness in the globalization problem space.</P>
<P>First the technical flaws: many of the properties and methods, from <A class="" href="http://msdn2.microsoft.com/library/94sw3wd3.aspx" mce_href="http://msdn2.microsoft.com/library/94sw3wd3.aspx">CultureInfo.CompareInfo</A> to&nbsp;<A class="" href="http://msdn2.microsoft.com/library/yb1az4ad.aspx" mce_href="http://msdn2.microsoft.com/library/yb1az4ad.aspx">RegionInfo.IsMetric</A> to <A class="" href="http://msdn2.microsoft.com/library/s81yd899.aspx" mce_href="http://msdn2.microsoft.com/library/s81yd899.aspx">CultureInfo.Calendar</A> to <A class="" href="http://msdn2.microsoft.com/library/z4cyyh56.aspx" mce_href="http://msdn2.microsoft.com/library/z4cyyh56.aspx">RegionInfo.NativeName</A> to <A class="" href="http://msdn2.microsoft.com/library/thw3z214.aspx" mce_href="http://msdn2.microsoft.com/library/thw3z214.aspx">CultureInfo.TextInfo</A> and more, all supported by these objects that are intended to isolate language-specific and region-specific data, all require the context of language/region/script bundle known as a&nbsp;specific <A class="" href="http://msdn2.microsoft.com/library/system.globalization.cultureinfo.aspx" mce_href="http://msdn2.microsoft.com/library/system.globalization.cultureinfo.aspx">CultureInfo</A>&nbsp;in order to provide appropriate data.</P>
<P>Basically they all return information from a "default" specific culture, and the results imply a full <A class="" href="http://msdn2.microsoft.com/library/system.globalization.cultureinfo.aspx" mce_href="http://msdn2.microsoft.com/library/system.globalization.cultureinfo.aspx">CultureInfo</A>.</P>
<P>You can look at these properties and methods and imagine the problems with assigning full <A class="" href="http://msdn2.microsoft.com/library/system.globalization.cultureinfo.aspx" mce_href="http://msdn2.microsoft.com/library/system.globalization.cultureinfo.aspx">CultureInfo</A>&nbsp;specific information to them.</P>
<P>But rather than get into those, I'd like to avoid swinging&nbsp;at a pitch in the dirt.</P>
<P>We'll move on to the bigger problem, the conceptual one.</P>
<P>A locale has like maybe 150 pieces of information attached to it.</P>
<P><EM>The exact number varies from version to version of Windows, but let's just call it 150 for the sake of argument.</EM></P>
<P>Now there are maybe 10 of those tied specifically to language that do not need the context of a region or script to obtain the appropriate data.</P>
<P>And similarly, there are maybe 10 of those tied specifically to region/country that do not need the context of a language or script to obtain the appropriate data.</P>
<P>Now if the problem was that the one object was too big because it captured 150 pieces of info, then having it capture 130 pieces instead has not really solved the problem.</P>
<P mce_keep="true">Add to that the fact that neutral cultures are in theory quite useful if you ignore there size when it comes to resource loading, though the size is one of the reasons that it sucks for those purposes too (as I mentioned back in January of this year in <A class="" href="http://archives.miloush.net/michkap/archive/2007/01/10/1442340.html" mce_href="http://archives.miloush.net/michkap/archive/2007/01/10/1442340.html"><STRONG>Two things that suck about CurrentUICulture (Part 1, aka It's just too much!)</STRONG></A>.</P>
<P mce_keep="true">Of course even for resource fallback it has limitations -- look how easily important issues like the underlying native name and code page change hugely as one follows the fall back chain with code like this:</P>
<BLOCKQUOTE>
<P mce_keep="true"><FONT face="consolas,lucida console,courier new,courier"><STRONG>using System;<BR>using System.Globalization;<BR><BR>public class Test {<BR>&nbsp;&nbsp;&nbsp; public static void Main() {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; foreach(CultureInfo ci in CultureInfo.GetCultures(CultureTypes.SpecificCultures)) {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if(ci.TextInfo.ANSICodePage != ci.Parent.TextInfo.ANSICodePage)&nbsp;{<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Console.WriteLine("'{0}' is using '{1}', which is not the as its parent ({2}) is ({3}).", <BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ci.Name, <BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ci.TextInfo.ANSICodePage, <BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ci.Parent.Name, <BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ci.Parent.TextInfo.ANSICodePage);<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<BR>&nbsp;&nbsp;&nbsp; }<BR>}</STRONG></FONT></P></BLOCKQUOTE>
<P mce_keep="true">And the results make one sad that the code is written the way it is because of yet another problem that pops up:</P>
<BLOCKQUOTE>
<P mce_keep="true"><FONT face="consolas,lucida console,courier new,courier"><STRONG><FONT color=#ff0000>'sr-Latn-CS' is using '1250', which is not the as its parent (sr) is (1251).<BR>'az-Cyrl-AZ' is using '1251', which is not the as its parent (az) is (1254).<BR>'uz-Cyrl-UZ' is using '1251', which is not the as its parent (uz) is (1254).<BR></FONT>'bn-BD' is using '0', which is not the as its parent () is (1252).<BR>'bs-Cyrl-BA' is using '1251', which is not the as its parent () is (1252).<BR>'tg-Cyrl-TJ' is using '1251', which is not the as its parent () is (1252).<BR><FONT color=#ff0000>'mn-Mong-CN' is using '0', which is not the as its parent (mn) is (1251).<BR></FONT>'prs-AF' is using '1256', which is not the as its parent () is (1252).<BR>'sah-RU' is using '1251', which is not the as its parent () is (1252).<BR>'mi-NZ' is using '0', which is not the as its parent () is (1252).<BR>'ug-CN' is using '1256', which is not the as its parent () is (1252).<BR>'ii-CN' is using '0', which is not the as its parent () is (1252).<BR><FONT color=#ff0000>'sr-Latn-BA' is using '1250', which is not the as its parent (sr) is (1251).<BR></FONT>'ba-RU' is using '1251', which is not the as its parent () is (1252).<BR>'ps-AF' is using '0', which is not the as its parent () is (1252).<BR>'ne-NP' is using '0', which is not the as its parent () is (1252).<BR>'am-ET' is using '0', which is not the as its parent () is (1252).<BR>'iu-Cans-CA' is using '0', which is not the as its parent () is (1252).<BR>'si-LK' is using '0', which is not the as its parent () is (1252).<BR>'lo-LA' is using '0', which is not the as its parent () is (1252).<BR>'km-KH' is using '0', which is not the as its parent () is (1252).<BR>'bo-CN' is using '0', which is not the as its parent () is (1252).<BR>'as-IN' is using '0', which is not the as its parent () is (1252).<BR>'ml-IN' is using '0', which is not the as its parent () is (1252).<BR>'or-IN' is using '0', which is not the as its parent () is (1252).<BR>'bn-IN' is using '0', which is not the as its parent () is (1252).<BR>'tk-TM' is using '1250', which is not the as its parent () is (1252).<BR>'mt-MT' is using '0', which is not the as its parent () is (1252).<BR>'bs-Latn-BA' is using '1250', which is not the as its parent () is (1252).</STRONG></FONT></P></BLOCKQUOTE>
<P mce_keep="true">Now the ones marked in red were originally my main point, where the process of normal language resource fallback would massively change the identity of chosen resources as entire code pages shifts help to represent shifts in the&nbsp;underlying script -- Cyrillic to Latin, Mongolian to Cyrillic, Latin to Cyrillic.</P>
<P mce_keep="true">But notice how the small number of these is overwhelmed by all of the Windows-only cultures that hasve no neutral culture to fall back on they fall back directly to invariant. Even though a neutral culture in many of these would make a lot of intuitive sense to use --nd of course the code skips all of the Windows-only cultures that happen to be using code page 1252.</P>
<P mce_keep="true">Looking at Windows-only cultures (<A class="" href="http://archives.miloush.net/michkap/archive/2007/11/02/5808539.html" mce_href="http://archives.miloush.net/michkap/archive/2007/11/02/5808539.html"><STRONG>discussed previously</STRONG></A>), this could be considered a very real limitation, one that I was not so down on <A class="" href="http://archives.miloush.net/michkap/archive/2007/01/12/1454385.html" mce_href="http://archives.miloush.net/michkap/archive/2007/01/12/1454385.html"><STRONG>previously</STRONG></A> but whivch I have chasnged my mind about as the limintations in resource fallback became clearer and clearer.</P>
<P mce_keep="true">There is also that big name shift that <A class="" href="http://blogs.msdn.com/kierans" mce_href="http://blogs.msdn.com/kierans">Kieran</A> mentioned in <A class="" href="http://blogs.msdn.com/kierans/archive/2006/08/02.aspx" mce_href="http://blogs.msdn.com/kierans/archive/2006/08/02.aspx">this post</A> and <A class="" href="http://blogs.msdn.com/shawnste" mce_href="http://blogs.msdn.com/shawnste">Shawn</A> mentioned in <A class="" href="http://blogs.msdn.com/shawnste/archive/2006/06/02.aspx" mce_href="http://blogs.msdn.com/shawnste/archive/2006/06/02.aspx">this post</A>&nbsp;to think about.</P>
<P mce_keep="true">It is all well and good to decide to change <STRONG>sr-SP-Cyrl</STRONG> to <STRONG>sr-Cyrl-CP</STRONG> in the name of consistency with international standards. </P>
<P mce_keep="true">The reason that the standard wanted to do things differedntly was to embrace the fallback identity of locales like <STRONG>sr-Cyrl</STRONG> when one is using string parsing to figure out fallback. Trying to be consistent with their naming while being simultaneously inconsistent with the principal reasons for it and occasionally even breaking people who would try and do it (like in <A class="" href="http://archives.miloush.net/michkap/archive/2007/12/19/6792635.html" mce_href="http://archives.miloush.net/michkap/archive/2007/12/19/6792635.html"><STRONG>NO doesn't mean maybe, and it certainly doesn't means NB!</STRONG></A>) kind of defeats some of the purpose behind being consistent when one takes the whole end-to-end scenario into mind, doesn't it?</P>
<P mce_keep="true">It suggests that to rehabilitate neutral cultures, some changes would have to be made:</P>
<UL>
<LI>
<DIV mce_keep="true">Add additional neutral cultures for the language-script cases when they exist, and</DIV></LI>
<LI>
<DIV mce_keep="true">Come up with a solution for neutral fallbacks for Windows-only cultures -- by parsing and filling in from the parent if needed, but <STRONG>some</STRONG> solution so resource fallback works better.</DIV></LI></UL>
<P mce_keep="true">Though there is no full rehabilitation given all the functionality in neutral cultures that will keep right on working even when it shouldn't since it requires locale//culture-specific behavior.</P>
<P mce_keep="true">&nbsp;</P>
<P mce_keep="true"><EM><FONT color=#ff00ff>All of the characters in Unicode have taken off for Grand Cayman for the Christmas holiday weekend<BR><FONT size=1>(they are staying at the Mariott Grand Cayman Beach Hotel in case you are there and are curious at all the characters hanging out by the pool!)</FONT></FONT></EM></P>
<hr/><p><a id="6847073" href="#6847073">#</a> <strong>Jeroen Ruigrok van der Werven</strong> on 23 Dec 2007 1:09 PM:</p><div style="margin-left: 1em"><p>which is not the as its parent -&gt; which is not the same as its parent, I reckon?</p></div>
<p><a id="6847252" href="#6847252">#</a> <strong>Michael S. Kaplan</strong> on 23 Dec 2007 1:50 PM:</p><div style="margin-left: 1em"><p>More or less. :-)</p>
</div>
<hr/><p><em>referenced by</em></p><div style="margin-left: 1em"><p>2011/03/16 <a href="http://archives.miloush.net/michkap/archive/2011/03/16/10141835.html">Reporting one casualty in the operation; luckily it was the stupidest member of the unit</a></p><p>2010/02/14 <a href="http://archives.miloush.net/michkap/archive/2010/02/14/9963164.html">Whither RegionInfo?</a></p></div><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2007/12/22/6834163.html" title="Incomplete Scenarios: They don&#39;t know everything that&#39;s up with number sorting">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2007/12/21/6825236.html" title="Shticks and stones">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2007-12">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2007-12-22">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2007/12/22/6833199.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:36 GMT -->
</html>