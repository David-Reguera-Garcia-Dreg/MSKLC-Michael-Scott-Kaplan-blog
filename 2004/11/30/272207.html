<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2004/11/30/272207.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:42 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>They ask me "why is my Korean text in random order?"</title></head><body>
<h1>They ask me "why is my Korean text in random order?"</h1>
<p><em>by Michael S. Kaplan, published on 2004/11/30 03:57 -08:00, original URI: http://blogs.msdn.com/michkap/archive/2004/11/30/272207.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostOld -->
<P>I get this question on a regular basis -- people wonder if I know that Korean shows up in a random order. People expect this to be the case&nbsp;when the Korean LCID (0x0412, or 1042 in decimal) is not passed, but when it is they expect things to be in some kind of correct order, and as far as they&nbsp;can tell, they are not.</P>
<P>My first big question (to help set expectations properly) is to ask what order they expect to be used. They almost always have trouble explaining what they thought would happen. But usually with a little help they make it through this part. The order is based on the most common Hangul pronunciation of the character, whether it is Hangul or Hanja (the Korean name for Han ideographs). </P>
<P>At this point they start to see some pattern to the results but it still seems random within a particular pronunciation.</P>
<P>My second big question is to ask how they are getting an order. This varies -- if they are a developer then they are calling <A title=LCMapString href="http://msdn.microsoft.com/library/en-us/intl/nls_5s2v.asp" target=_blank>LCMapString</A> or <A title=CompareString href="http://msdn.microsoft.com/library/en-us/winui/winui/windowsuserinterface/resources/strings/stringreference/stringfunctions/comparestring.asp" target=_blank>CompareString</A> (or some API that calls CompareString), otherwise if its in an application (Access or Excel or whatever) then they do not know what API is being called (but usually I know what the application is doing). Or they are using managed code and the CompareInfo or SortKey classes are being used. The problem is usually that they are passing the NORM_IGNORENONSPACE flag (or the CompareOptions.IgnoreNonSpace flag in managed code). And herein is where the problem lies....</P>
<P>You see, modern Korean Hangul and Hanja do not have the notion of non-spacing characters (like ˆˇˉ˘˙˚˛˜˝&nbsp;diacritics seen in Latin), so that part of the "collation weight space" is used for Hanja that most commonly have the same Hangul pronunciation. Telling the API or method to ignore this weight is basically asking it to treat (for example) such ideographs as 渴, 噶, and 鶡 as randomly sorting together in a non-deterministic way, since the API will report that the two strings are equal. The same thing happens to letters with diacritics in Latin -- passing the flag will cause (for example) A, Ā, Ă, Ą, À, Á, Â, Ã, Ä, and Å to sort together randomly in the same sort of non-deterministic way.</P>
<P>Ah, the light begins to dawn -- the order was not actually so random as they thought. They should not be passing this flag!</P>
<P>The next question they ask is "what is so special about Korean that it is the only language where this is done?" The answer to this is simple: <STRONG>its not</STRONG>. </P>
<P>The names for the flags NORM_IGNORENONSPACE/NORM_IGNORECASE (or IgnoreNonSpace/IgnoreCase) are really misleading, since it really meant to refer to Latin script diacritics&nbsp;and case, which need to weigh between 'A' and 'Ă' as having a secondary difference and between 'A' and 'a' as having a tertiary difference. There are a myriad of languages that have the same linguistic need to express secondary and tertiary differences, so they need to use those types of weights. Passing the flags can harm the accuracy/specificity of Thai, Hindi, Tamil, Telugu, Arabic, Hebrew, and a whole lot more. </P>
<P>The final question that they ask is "But I am doing searches and I need to pass those flags for the Latin/Cyrillic/Greek text. How can I have the results work properly in <EM>those</EM> searches without finding the wrong characters for these other languages?" The answer here is to use the flags to do the search operation but then order them <EM>without using the flags</EM>. If you do this then you will get the longer list of candidates, but just as in typical web searches the closest matches will appear higher on the list!</P>
<hr/><p><a id="272459" href="#272459">#</a> <strong>Scott Hanselman</strong> on Tuesday, November 30, 2004 11:56 AM:</p><div style="margin-left: 1em">I just wanted to let you know that I'm totally digging your posts. Keep it up.<br><br><a target="_new" href="http://www.hanselman.com/blog/SearchView.aspx?q=internationalization">http://www.hanselman.com/blog/SearchView.aspx?q=internationalization</a></div>
<p><a id="272545" href="#272545">#</a> <strong>michkap</strong> on Tuesday, November 30, 2004 2:13 PM:</p><div style="margin-left: 1em">Always good to know people are having fun... after eight years at Microsoft (six as a vendor, two as a full-time employee) I could probably have a post a day for some time. :-)</div>
<p><a id="329443" href="#329443">#</a> <strong>Norman Diamond</strong> on Tuesday, December 21, 2004 6:41 PM:</p><div style="margin-left: 1em">You need to use separate flags for those cases.  Not every combination of Korean and French text is a Korean-Japanese dictionary, but even if it were, you should not overload one flag in that manner.<br><br>A decision on whether or not to ignore nonspace is separate from a decision on whether or not to ignore spaces (or what C calls whitespace) is separate from a decision on whether or not to ignore casing (upper/lower/title) is separate from a decision on whether or not to ignore width (at least in Japanese character sets) is separate from a decision on whether or not to ignore accents is separate from a decision on whether or not to ignore bug reports.</div>
<p><a id="329598" href="#329598">#</a> <strong>Michael Kaplan</strong> on Tuesday, December 21, 2004 10:12 PM:</p><div style="margin-left: 1em">I think you missed my point here. If you pass these flags for Korean text then you will destroy meaningful comparisons.<br><br>So if you care about Korean (and many other language) text then these flags may not be in your best interest....</div>
<p><a id="329630" href="#329630">#</a> <strong>Norman Diamond</strong> on Tuesday, December 21, 2004 11:16 PM:</p><div style="margin-left: 1em">12/21/2004 10:12 PM Michael Kaplan<br><br>&gt; I think you missed my point here.<br><br>I think not.<br><br>&gt; If you pass these flags for Korean text then<br>&gt; you will destroy meaningful comparisons.<br><br>Yes, because your company abused those flags by squashing multiple meanings into a single flag when separate flags are really necessary.  Yes users suffer when they do not know how to contend with that design, and I think I got your point.  You know how to improve this part of the design (plus I reminded you of how) and I think you missed my point.</div>
<p><a id="329641" href="#329641">#</a> <strong>Michael Kaplan</strong> on Tuesday, December 21, 2004 11:36 PM:</p><div style="margin-left: 1em">So lets stop picking on the person trying to document the issues, shall we? :-)<br><br>Seriously, the purpose of this blog is not discuss the evils of Microsoft. I would seriously recommend that you find a better forum to advance that agenda than the comment section of my blog?</div>
<p><a id="330196" href="#330196">#</a> <strong>Norman Diamond</strong> on Wednesday, December 22, 2004 1:54 PM:</p><div style="margin-left: 1em">&gt; So lets stop picking on the person trying to<br>&gt; document the issues<br><br>If you don't have the power to fix them, then I understand.  Sorry if I misunderstood.<br><br>But please let me add a bit to the explanation because this was really bugging me all night, it is not really a trivial issue.  This will be highly imperfect as an analogy, but I hope it will still point out why the issue is not trivial.<br><br>Suppose function ToUpper converted &quot;Jan&quot; to &quot;JANUARY&quot;.  The person who designed ToUpper that way could warn people about it, and you could warn people about it, but people who don't know about the warning will be surprised.  Next suppose function ToUpper converts &quot;1&quot; to &quot;UNO&quot;.  People who really only want an uppercasing function will have to roll their own in order to get it.<br><br>Yes the warning from the documenter is valuable.  But please also teach developers not to repeat this kind of mistake.  Separate meanings need separate flags or need separate functions.</div>
<p><a id="330200" href="#330200">#</a> <strong>Michael Kaplan</strong> on Wednesday, December 22, 2004 2:05 PM:</p><div style="margin-left: 1em">Norman, i have the power to fix many things.<br><br>I do not, however, have the authority to break applications that exist, nor do I have the desire to. So I would not do that.<br><br>Now I do recognize the problem here. I have identified it, put the identification in a public plsce, suggested both the solution to the problem and a workaround for the situations where the solution would break other behavior.<br><br>I am also looking at other possible options for the future.<br><br>In my opinion, there is absolutely nothing more that even someone more important than I *could* do, or should do.</div>
<p><a id="331549" href="#331549">#</a> <strong>Norman Diamond</strong> on Thursday, December 23, 2004 5:37 PM:</p><div style="margin-left: 1em">OK, thank you.</div>
<hr/><p><em>referenced by</em></p><div style="margin-left: 1em"><p>2006/11/17 <a href="http://archives.miloush.net/michkap/archive/2006/11/17/1097532.html">Korean + French == ????</a></p><p>2006/11/01 <a href="http://archives.miloush.net/michkap/archive/2006/11/01/916477.html">If you add enough characters to a sort, intuitive distinction can suffer</a></p><p>2005/12/29 <a href="http://archives.miloush.net/michkap/archive/2005/12/29/508045.html">What's a secondary distinction?</a></p><p>2005/08/02 <a href="http://archives.miloush.net/michkap/archive/2005/08/02/446522.html">New in Vista Beta 1: more use of the word 'linguistic'</a></p><p>2005/06/30 <a href="http://archives.miloush.net/michkap/archive/2005/06/30/434223.html">Query collation source data?</a></p><p>2005/05/11 <a href="http://archives.miloush.net/michkap/archive/2005/05/11/416293.html">Case/kana/accent/width sensitive SQL Server, for testing</a></p></div><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2004/12/01/272864.html" title="Crossing the &lt;b>DIGIT&lt;/b>al divide...">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2004/11/29/271476.html" title="Normalization and Microsoft -- whats the story?">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2004-11">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2004-11-30">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2004/11/30/272207.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:42 GMT -->
</html>