<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2004/11/29/271476.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:42 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>Normalization and Microsoft -- whats the story?</title></head><body>
<h1>Normalization and Microsoft -- whats the story?</h1>
<p><em>by Michael S. Kaplan, published on 2004/11/29 05:51 -05:00, original URI: http://blogs.msdn.com/b/michkap/archive/2004/11/29/271476.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostNew -->
<P class=MsoNormal style="MARGIN: 3pt 0in; mso-margin-top-alt: auto; mso-margin-bottom-alt: auto"><SPAN style="mso-fareast-language: ZH-CN">This is a word that has been <I>way</I> too overloaded. To date I have heard&nbsp;of four specific uses since I have come to Microsoft:<?xml:namespace prefix = o ns = "urn:schemas-microsoft-com:office:office" /><o:p></o:p></SPAN></P>
<UL type=disc>
<LI class=MsoNormal style="MARGIN: 3pt 0in; mso-margin-top-alt: auto; mso-margin-bottom-alt: auto; mso-list: l2 level1 lfo1; tab-stops: list .5in"><SPAN style="mso-fareast-language: ZH-CN">It is used by some folks on the SQL Server team when they talk about string comparisons <o:p></o:p></SPAN>
<LI class=MsoNormal style="MARGIN: 3pt 0in; mso-margin-top-alt: auto; mso-margin-bottom-alt: auto; mso-list: l2 level1 lfo1; tab-stops: list .5in"><SPAN style="mso-fareast-language: ZH-CN">It is used by the NLS collation APIs for the same reason (the NORM_* flags), in reference to potentially ignorable differences in string comparison <o:p></o:p></SPAN>
<LI class=MsoNormal style="MARGIN: 3pt 0in; mso-margin-top-alt: auto; mso-margin-bottom-alt: auto; mso-list: l2 level1 lfo1; tab-stops: list .5in"><SPAN style="mso-fareast-language: ZH-CN">Robert A. Wlodarczyk has used the the terms <I><A href="http://weblogs.asp.net/rwlodarc/archive/2003/05/05/6461.aspx">string normalization</A></I> to refer to the broader type of search that others call fuzzy searches <o:p></o:p></SPAN>
<LI class=MsoNormal style="MARGIN: 3pt 0in; mso-margin-top-alt: auto; mso-margin-bottom-alt: auto; mso-list: l2 level1 lfo1; tab-stops: list .5in"><SPAN style="mso-fareast-language: ZH-CN">Unicode has a technical report entitled <A title="Unicode Normalization Forms" href="http://www.unicode.org/reports/tr15/" target=_blank>Unicode Normalization Forms</A> that defines a technique for folding out differences in equivalent sequences<o:p></o:p></SPAN></LI></UL>
<P class=MsoNormal style="MARGIN: 3pt 0in; mso-margin-top-alt: auto; mso-margin-bottom-alt: auto"><SPAN style="mso-fareast-language: ZH-CN">Looking at definitions for the word from dictionary.com:<o:p></o:p></SPAN></P>
<UL type=disc>
<LI class=MsoNormal style="MARGIN: 3pt 0in; mso-margin-top-alt: auto; mso-margin-bottom-alt: auto; mso-list: l0 level1 lfo2; tab-stops: list .5in"><SPAN style="mso-fareast-language: ZH-CN">To make normal, especially to cause to conform to a standard or norm <o:p></o:p></SPAN>
<LI class=MsoNormal style="MARGIN: 3pt 0in; mso-margin-top-alt: auto; mso-margin-bottom-alt: auto; mso-list: l0 level1 lfo2; tab-stops: list .5in"><SPAN style="mso-fareast-language: ZH-CN">To make (a text or language) regular and consistent, especially with respect to spelling or style <o:p></o:p></SPAN>
<LI class=MsoNormal style="MARGIN: 3pt 0in; mso-margin-top-alt: auto; mso-margin-bottom-alt: auto; mso-list: l0 level1 lfo2; tab-stops: list .5in"><SPAN style="mso-fareast-language: ZH-CN">To remove strains and reduce coarse crystalline structures in (metal), especially by heating and cooling <o:p></o:p></SPAN>
<LI class=MsoNormal style="MARGIN: 3pt 0in; mso-margin-top-alt: auto; mso-margin-bottom-alt: auto; mso-list: l0 level1 lfo2; tab-stops: list .5in"><SPAN style="mso-fareast-language: ZH-CN">Reduction to a standard or normal state<o:p></o:p></SPAN></LI></UL>
<P class=MsoNormal style="MARGIN: 3pt 0in; mso-margin-top-alt: auto; mso-margin-bottom-alt: auto"><SPAN style="mso-fareast-language: ZH-CN">I guess its really only Unicode that is using the word correctly, though maybe that "string normalization" usage is not too far off. Ah well, bad on over in SQL Server (they have the advantage of it not being splattered all over their public header files and documentation -- only their customer contacts tend to hear about it, and only when it comes up). And of course on those of us working on NLS. Oops!<o:p></o:p></SPAN></P>
<P class=MsoNormal style="MARGIN: 3pt 0in; mso-margin-top-alt: auto; mso-margin-bottom-alt: auto"><SPAN style="mso-fareast-language: ZH-CN">But moving past the terminology issue, does collation as an operation support the concepts being described in Unicode normalization?&nbsp;In other words, does the <A title=CompareString href="http://msdn.microsoft.com/library/en-us/winui/winui/windowsuserinterface/resources/strings/stringreference/stringfunctions/comparestring.asp" target=_blank>CompareString</A> API consider&nbsp;U+00c5 (Å, LATIN CAPITAL LETTER A WITH RING ABOVE)&nbsp;to be equivalent to U+0041 U+030a (A</SPAN><SPAN style="FONT-FAMILY: Tahoma; mso-fareast-language: ZH-CN">̊</SPAN><SPAN style="mso-fareast-language: ZH-CN">, LATIN CAPITAL LETTER A + COMBINING RING ABOVE)?<o:p></o:p></SPAN></P>
<P class=MsoNormal style="MARGIN: 3pt 0in; mso-margin-top-alt: auto; mso-margin-bottom-alt: auto"><SPAN style="mso-fareast-language: ZH-CN">The&nbsp;answer is that it does. But not because Unicode&nbsp;Normalization was being used.<o:p></o:p></SPAN></P>
<P class=MsoNormal style="MARGIN: 3pt 0in; mso-margin-top-alt: auto; mso-margin-bottom-alt: auto"><SPAN style="mso-fareast-language: ZH-CN">Like yesterday's blog entry, which pointed out how the UCA was written up many years after Microsoft (and others) were doing the work, Unicode Normalization was first proposed as a DRAFT in the Spring of 1998. It was not until the Summer of 1999 that it was given the status of a Technical Report. The collation functions (CompareString and <A title=LCMapString href="http://msdn.microsoft.com/library/en-us/intl/nls_5s2v.asp" target=_blank>LCMapString</A>) had been supporting this type of operation for many years before that.<o:p></o:p></SPAN></P>
<P class=MsoNormal style="MARGIN: 3pt 0in; mso-margin-top-alt: auto; mso-margin-bottom-alt: auto"><SPAN style="mso-fareast-language: ZH-CN">It is worth mentioning that support is not perfect. As Microsoft Typography discovered when they first ran their font validation tools on their existing fonts, and as I discovered when I ran MSKLC's keyboard validation on on Microsoft's existing keyboard layouts, once there was a concerted effort to validate everything that collation does against all of the various Unicode operations such as Unicode Normalization, there were holes found. The holes fall into two basic categories:<o:p></o:p></SPAN></P>
<UL type=disc>
<LI class=MsoNormal style="MARGIN: 3pt 0in; mso-margin-top-alt: auto; mso-margin-bottom-alt: auto; mso-list: l1 level1 lfo3; tab-stops: list .5in"><SPAN style="mso-fareast-language: ZH-CN">in the Arabic presentation forms (where many precomposed ligatures are not considered to be equal to their combined forms) <o:p></o:p></SPAN>
<LI class=MsoNormal style="MARGIN: 3pt 0in; mso-margin-top-alt: auto; mso-margin-bottom-alt: auto; mso-list: l1 level1 lfo3; tab-stops: list .5in"><SPAN style="mso-fareast-language: ZH-CN">in Korean Old Hangul (where Jamo sequences are given weights that are calculated to be close but not identical to their 'combined' Hangul forms)<o:p></o:p></SPAN></LI></UL>
<P class=MsoNormal style="MARGIN: 3pt 0in; mso-margin-top-alt: auto; mso-margin-bottom-alt: auto"><SPAN style="mso-fareast-language: ZH-CN">I was once again struck by the differences that a 'linguistic' approach can lead to when compared to a 'technical' one, even when nominally working to service the same (or similar) customers. In the above two categories, there were specific reasons for the differences relating to customer feedback. In a few cases it will make sense to pick up some of these differences (several of the Arabic ligatures, for example), but for the most part those differences will likely stay as there is no compelling customer scenario to try to pick up all of the differences.<o:p></o:p></SPAN></P>
<P class=MsoNormal style="MARGIN: 3pt 0in; mso-margin-top-alt: auto; mso-margin-bottom-alt: auto"><SPAN style="mso-fareast-language: ZH-CN">There is another (some would say more relevant) way in which Microsoft supports Unicode Normalization -- in the FoldString API, with its MAP_PRECOMPOSED, MAP_COMPOSITE, MAP_FOLDCZONE flags. While the tables that are used for these various foldings are a bit out of date, their goal is obviously the same. In the long run it completely makes sense to update this information.<o:p></o:p></SPAN></P>
<P class=MsoNormal style="MARGIN: 3pt 0in; mso-margin-top-alt: auto; mso-margin-bottom-alt: auto"><SPAN style="mso-fareast-language: ZH-CN">Which is not to say that Unicode Normalization is not important -- it is. As a standard it has been picked up by the IETF, the W3C, and many others. Folks working with the Whidbey beta have already seen String.IsNormalized and String.Normalize in their Intellisense, and folks who have seen the PDC or later builds of Longhorn have noticed IsNormalized and Normalize APIs. There may well be people who will work to make sure text is properly put into a specific Unicode normalization form prior to storing or transmitting it. <o:p></o:p></SPAN></P>
<P class=MsoNormal style="MARGIN: 3pt 0in; mso-margin-top-alt: auto; mso-margin-bottom-alt: auto"><SPAN style="mso-fareast-language: ZH-CN">But since all of the methods of text input on Windows tend to use the same normalization form already (form C), and since it obviously is an operation that takes some time and space to do no matter how fast it is, it is an optional task that can be used when it is important to do so. Especially since it mostly works already, anyway.<o:p></o:p></SPAN></P>
<P class=MsoNormal style="MARGIN: 3pt 0in; mso-margin-top-alt: auto; mso-margin-bottom-alt: auto"><SPAN style="mso-fareast-language: ZH-CN">(This was an area I walked into dismayed that we do not support <A title="the Unicode Standard" href="http://www.unicode.org/" target=_blank>the Unicode Standard</A> but walked out of pleased at how much we suck at the job of <I>not</I> supporting it. Usually when I am not supporting something I do a much better job of failing to meet expectations!)<o:p></o:p></SPAN></P>
<P class=MsoNormal style="MARGIN: 3pt 0in; mso-margin-top-alt: auto; mso-margin-bottom-alt: auto"><SPAN style="mso-fareast-language: ZH-CN">So do we support Unicode normalization today? Well, sort of. At least in FoldString and in collation. Not 100% but we hit all of the common scenarios.<o:p></o:p></SPAN></P>
<P class=MsoNormal style="MARGIN: 3pt 0in; mso-margin-top-alt: auto; mso-margin-bottom-alt: auto"><SPAN style="mso-fareast-language: ZH-CN">Do we plan to support it in the future products we release? Absolutely. Folks watching the betas can see it now (and the rest can find it in public web searches, which surprised me maybe more than it should have).<o:p></o:p></SPAN></P>
<P class=MsoNormal style="MARGIN: 3pt 0in"><o:p>&nbsp;</o:p></P>
<hr/><p><a id="271512" href="#271512">#</a> <strong>Sreejumon</strong> on 29 Nov 2004 5:22 AM:</p><div style="margin-left: 1em">Hi Kaplan,<br><br>You didn't mention the database normalization in first para :) <br>In relational database design, the process of organizing data to minimize redundancy. Normalization usually involves dividing a database into two or more tables and defining relationships between the tables.</div>
<p><a id="271522" href="#271522">#</a> <strong>michkap</strong> on 29 Nov 2004 5:43 AM:</p><div style="margin-left: 1em">Yes, that is an excellent point! That would be yet another usage (and one that I dealt with with in my former, pre-Microsoft life). <br><br>But I limited myself to meanings that I have been exposed to since I came to Microsoft, and none of them brought that one up. <br><br>Plus, I figured it did not really help the point of the article much since database normalization is ever further from the dictionary definitions. :-)</div>
<hr/><p><em>referenced by</em></p><div style="margin-left: 1em"><p>2010/08/17 <a href="http://archives.miloush.net/michkap/archive/2010/08/17/10050816.html">It would be like spelling it Anerica or something.</a></p><p>2008/10/29 <a href="http://archives.miloush.net/michkap/archive/2008/10/29/9021615.html">Wonder why something is not in the Compact Framework? The answer is in the question!</a></p><p>2007/08/17 <a href="http://archives.miloush.net/michkap/archive/2007/08/17/4424917.html">Normalize Wide Shut</a></p><p>2006/02/02 <a href="http://archives.miloush.net/michkap/archive/2006/02/02/522919.html">What is equal to some may not be equal to others</a></p><p>2005/06/23 <a href="http://archives.miloush.net/michkap/archive/2005/06/23/431909.html">What normalization form does SQL Server use, REDUX</a></p><p>2005/06/23 <a href="http://archives.miloush.net/michkap/archive/2005/06/23/431866.html">What normalization form does SQL Server use?</a></p><p>2005/01/31 <a href="http://archives.miloush.net/michkap/archive/2005/01/31/363701.html">FoldString.NET? No, but Whidbey has Normalization (which is kinda more cooler)</a></p></div><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2004/11/30/272207.html" title="They ask me &quot;why is my Korean text in random order?&quot;">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2004/11/28/271121.html" title="Microsoft does not use the Unicode Collation Algorithm">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2004-11">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2004-11-29">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2004/11/29/271476.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:42 GMT -->
</html>