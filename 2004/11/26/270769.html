<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2004/11/26/270769.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:42 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>'Evil date parsing', Parse, and ParseExact</title></head><body>
<h1>'Evil date parsing', Parse, and ParseExact</h1>
<p><em>by Michael S. Kaplan, published on 2004/11/26 12:30 -05:00, original URI: http://blogs.msdn.com/b/michkap/archive/2004/11/26/270769.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostNew -->
<P>'Evil date parsing' has quite an ignoble history. Rooted in COM (which was itself rooted to older versions of Visual Basic), converions from string to date had the simple job of making a string into&nbsp;a date, no matter what the cost. The benefits are obvious, but the problems range from performance issues to the cost of getting bad data by improper parsing. The latter is in fact why the parsing was considered <STRONG>evil</STRONG> for many purposes, because when the format is dd/mm/yy there are just as many people who wanted "01/13/2008" to fail as who wanted it to succeed. The fact that it would succeed simply clouded the issue of the meaning of "01/06/2004" since the difference between January&nbsp;6th and June 1st are obvious and frightening for some applications.</P>
<P>The .NET Framework's DateTime.Parse method has goals not unlike those from older products, but because of this often suffers from the same problems. This road leads to less performant code that for every customer who loves that it parsed their dated will find another who will be unhappy that it missed an entirely reasonable format. They did solve some of the <EM>evil</EM> problems, but there were still plenty more that came out. By trying to work for everyone, the method ends up with four groups of customers:</P>
<OL>
<LI>those who are unhappy, 
<LI>those who are happy, 
<LI>those who are happy now but will be unhappy when they find out how screwed up their wrong data is due to incorrect parsing. 
<LI>those who are unhappy now since the code that used to work in VB5 or VB6 does not work since the parsing changed.</LI></OL>
<P>ParseExact, on the other hand, takes the exact formats specified in the DateTimeFormatInfo object and uses them -- it uses <EM>nothing else</EM>. There is no forgiveness for data that does not match, and the issue of whether or not gratuitous spaces should be forgiven makes for an interesting argument in the hallways of some buildings at Microsoft. Its goal that is more along the lines of "I gave you the format, now I will give you the strings in that format; just do the freaking job." This makes it faster and more exact as a semantic, and as such is much more suited if the flexibility of the other method is not desired. As a veteran of bugs implicit in evil date parsing, I am quite fond of a method with none of the problems it can cause.</P>
<P>In order to protect your own code, you may want to consider using ParseExact when you can, to help avoid those other problems. Flexibility is great when you need it, but when you don't its better not to risk the problems that are the price of flexibility....</P>
<hr/><p><a id="270798" href="#270798">#</a> <strong>Adrian</strong> on 26 Nov 2004 12:23 PM:</p><div style="margin-left: 1em">I always use '6 jun 2004' format in code, be it sql,c# and when ever possible enforce this thru ui controls.<br>I seen systems require the user to set his/her date format in regional settings becuase the original programers couldn't cope with database asuming mmddyy where the local tradition is ddmmyy [shudder]</div>
<p><a id="270851" href="#270851">#</a> <strong>AndrewSeven</strong> on 26 Nov 2004 3:51 PM:</p><div style="margin-left: 1em">Recently, I had an xml file that had a date in it.<br>I don't know what the name of the date format was.<br><br>I would have liked to be able to pass a format string and the date string to get a date.<br></div>
<p><a id="271010" href="#271010">#</a> <strong>James Hancock</strong> on 27 Nov 2004 11:51 AM:</p><div style="margin-left: 1em">I've run into this all of the time. My solution is to use MMM/d/yyyy as the forced date format at all times, because it appears to be the only format that the .net framework won't screw up if the region changes (i.e. Canada versus the US, Japan versus the US etc.)<br><br>My biggest problem now is getting a nice UTC date /time stored and actually get it to come back at the right time even with day light's savings shifts.  The only way I have been able to do this is to have a separate date field and an int for the number of minutes from Midnight and make everything relative to Jan 1st 1900 which shouldn't change. Otherwise we end up with head aches.<br><br>I really really really wish there was a format that .net would parse with time zone info on it. (i.e. that used by POP3 mail servers)<br><br>2004/01/06 1:00 -0500 should be parsed and it should parse correctly and consistantly. Currently .net will throw an error trying to parse that, which is ironic because it's the standard for POP3.<br><br>That in EVERY format and semantic should always translate to:<br><br>January 6th 2004 1:00 AM in EST (or CDT)<br><br>Given this information we can then handle appointments that are not time zone centric and  act accordingly even if two offices sharing data are in two different time zones using two different regional settings.<br><br>I hear that SQL Server 2005 is going to handle Time zone information finally, now I wish .net did string date parsing correctly with it. (asside from it would save me a lot of frustration with Email messages...)<br><br>Oh and a tip for everyone because I think I get asked this more often than anything else.  When writting inserts and updates to SQL Server or any other database server, always use yyyy-MM-dd HH:mm:ss as your format that you pass the date string because it will always be recognized by the SQL Server correctly, unlike every other format that just formats it however it feels like and often just fails entirely, especially with MM/dd/yy or dd/MM/yy (yes, both of these should be abolished... we need one world wide standard!)</div>
<p><a id="275385" href="#275385">#</a> <strong>michkap</strong> on 5 Dec 2004 4:15 PM:</p><div style="margin-left: 1em">To Adrian and James -- note that both of your solutions ('d mmm yyyy' and 'mmm/d/yyyy') can suffer from three problems:<br><br>1) The &quot;abbreviated month&quot; in many cultures is not really abbreviated and thus you get full month names. This may be okay but sometimes people assume the behavior will be different<br><br>2) They both rely on the legacy behvior in the Parse method, which will consistently be able to understand the format. It may have extra performance penalty because of that.<br><br>3) Users may not like either format, and one common requirement of parsing is getting user input and converting it to actual data. Users will often expect the formst they put into Regional Options.<br><br>Time zones are a huge subject on all on their own -- I will probably take them up some day....<br><br>Finally, to Andrew -- see the ParseExact method, it may be exactly what you need.</div>
<p><a id="329425" href="#329425">#</a> <strong>Norman Diamond</strong> on 21 Dec 2004 6:11 PM:</p><div style="margin-left: 1em">On Linux systems I frequently see dates displayed in a format that looks like an equivalent to Windows MMM d yyyy.  MMM is one or two digits with the Kanji meaning &quot;month&quot;.  d is one or two digits without the Kanji meaning &quot;day&quot;, and yyyy is four digits without the Kanji meaning &quot;year&quot;.  In addition to the strange ordering, it is really disconcerting to have Kanji attached to exactly one of these three components.<br><br>The usual human readable forms are variations of y M d, in which:<br>y is either an era name followed by one or two digits for the year and the Kanji meaning &quot;year&quot;, or optionally a designation of the Christian era with four digits for the year and the Kanji meaning &quot;year&quot;;<br>M is one or two digits followed by the Kanji meaning &quot;month&quot;; and<br>d is one or two digits followed by the Kanji meaning &quot;day&quot;.<br>If a month or day only needs one digit, it is optional to do two digits with a leading zero.  I haven't seen that done with a year though.<br><br>I usually abbreviate it to yyyy.M.dd.  Though just now I notice that at least one Windows XP system has lost the personalized regional setting that I set around a year ago.  (If I recall correctly, Windows 95 used to forget it very frequently.)</div>
<p><a id="329600" href="#329600">#</a> <strong>Michael Kaplan</strong> on 21 Dec 2004 10:15 PM:</p><div style="margin-left: 1em">I know of no issue that causes settings to be lost. Given how they are stored in the registry, the only way I know of that they could be lost other than either than (1) the entire user profile bing lost or (2) some app calling <a title="SetLocaleInfo" href="http://msdn.microsoft.com/library/en-us/intl/nls_7w1b.asp" target="_blank">SetLocaleInfo</a> to change settings.<br><br>#2 is likely if you run misbehaving applications that do not respect user settings, unfortunstely.</div>
<p><strong>BugBuster</strong> on 5 Nov 2009 11:55 PM:</p><div style="margin-left: 1em"><p>This article only scratches the surface. The truth is, it is even more evil than described, because UI controls like the datepicker aren't doing things quite right. And I am talking about a functionality like - specify a format string as parameter in web.config describing the desired date format, read it and feed the datepicker with it and allow to use the same format for display and conversion between string and datetime.</p>
<p>If you're trying to implement that in a multi-cultural world (as we live in, in case you haven't noticed yet), you are opening a can of worms turning development into a coding hell.</p></div>
<p><strong>Michael S. Kaplan</strong> on 7 Nov 2009 5:38 PM:</p><div style="margin-left: 1em"><P>Since I was referring to&nbsp;things that are pretty far underneath while you are referring to high level UI controls, it would be more accurate to say that I am *not* scratching the surface whiule you are. :-)</P></div>
<p><strong>BugBuster</strong> on 10 Nov 2009 4:02 AM:</p><div style="margin-left: 1em"><p>I didn't want to criticize your article, only the inconsistent way date/time format is handled. </p>
<p>And yes, I am scratching the (UI)-surface, since you need to present dates properly to the end-user, wich isn't easy to do it in a consistent way when multi-language support is needed.</p></div>
<p><strong>Michael S. Kaplan</strong> on 10 Nov 2009 8:06 AM:</p><div style="margin-left: 1em"><p>I didn't think you were criticizing, I was just calling attention to the fact that this nearly 5-year-old resurrection of the post was not entirely the same topic -- it is related, but only tangentially.... :-)</p>
<p>On the other hand, nothing much else was going on with it, so no harm in the re-purpose!</p>
</div>
<p><strong>jj</strong> on 20 Sep 2011 5:34 AM:</p><div style="margin-left: 1em"><p>ujh</p>
</div>
<p><strong>X-man</strong> on 15 Feb 2012 8:47 PM:</p><div style="margin-left: 1em"><p>Good 1...</p>
<p>Titillated my tiny brain.. ;)</p>
</div>
<hr/><p><em>referenced by</em></p><div style="margin-left: 1em"><p>2010/02/11 <a href="http://archives.miloush.net/michkap/archive/2010/02/11/9962007.html">Evil Date Parsing lives! Viva Evil Date Parsing!</a></p><p>2006/01/13 <a href="http://archives.miloush.net/michkap/archive/2006/01/13/512408.html">Some date conversions are evil in other ways</a></p><p>2005/12/26 <a href="http://archives.miloush.net/michkap/archive/2005/12/26/507402.html">COleDateTime's ParseDateTime and locales....</a></p><p>2005/11/17 <a href="http://archives.miloush.net/michkap/archive/2005/11/17/492197.html">Parse vs. ParseExact, revisited</a></p><p>2004/12/20 <a href="http://archives.miloush.net/michkap/archive/2004/12/20/328040.html">The Time [Zone] is Right...</a></p></div><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2004/11/27/270931.html" title="Some keyboarding terms">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2004/11/13/257049.html" title="Using MSLU with ATL/WTL">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2004-11">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2004-11-26">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2004/11/26/270769.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:42 GMT -->
</html>