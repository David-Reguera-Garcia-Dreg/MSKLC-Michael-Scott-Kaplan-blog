<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2004/12/29/344136.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:42 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>Comparison confusion: INVARIANT vs. ORDINAL</title></head><body>
<h1>Comparison confusion: INVARIANT vs. ORDINAL</h1>
<p><em>by Michael S. Kaplan, published on 2004/12/30 01:58 -05:00, original URI: http://blogs.msdn.com/b/michkap/archive/2004/12/29/344136.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostNew -->
<P>There is a great deal of confusion surrounding the meaning of these two different things in the .NET Framework, and when to use each. If you have suffered, are suffering, or think may suffer in the future from such&nbsp;a confusion, then read on!</P>
<P><EM><FONT size=2>(Otherwise, I guess you can go away and come back another time)</FONT></EM></P>
<P>The invariant culture's direct ancestor is the invariant locale. Officially added to the Windows source tree at 10:23am on May 12, 2001, its intention was not to be used as an actual locale (which would explain why no locale data was added until a month later; until then no one was using it in <A title=GetLocaleInfo href="http://msdn.microsoft.com/library/en-us/intl/nls_34rz.asp" target=_blank>GetLocaleInfo</A>!). </P>
<P>Originally, LOCALE_INVARIANT had&nbsp;just one noble purpose&nbsp;-- to allow one to use <A title=CompareString href="http://msdn.microsoft.com/library/en-us/winui/winui/windowsuserinterface/resources/strings/stringreference/stringfunctions/comparestring.asp" target=_blank>CompareString</A> (and <A title=LCMapString href="http://msdn.microsoft.com/library/en-us/intl/nls_5s2v.asp" target=_blank>LCMapString</A> with the LCMAP_SORTKEY flag) in a way that would only use the "Default" Windows sorting table as mentioned a little bit <a href="http://archives.miloush.net/michkap/archive/2004/11/28/271121.html">here</A>&nbsp;and especially <a href="http://archives.miloush.net/michkap/archive/2004/12/08/278170.html">here</A>. The results, as that second article mentioned, would not vary when the user or system locale settings did; they would be invariant within that installation of Windows.</P>
<P>The data was added for this locale a month later, as I said, for obvious reasons -- if you have an LCID that one function considers to be valid, you must have a very good reason if another will not. And it cannot duplicate any other locale, either. Much weird data was added so that no one would be tempted to try to act like they spoke a language called "Invariant" and then all was good.</P>
<P>Note that these string comparisons still had much linguistic value -- half of the locales in Windows use that default table, so an invariant sort would not only avoid varying, it would also look&nbsp;right to a lot of the world.</P>
<P>The .NET framework had similar requirements (with the additional need for invariant parsing/formatting support)&nbsp;and thus <A title=CultureInfo href="http://msdn.microsoft.com/library/en-us/cpref/html/frlrfsystemglobalizationcultureinfoclasstopic.asp" target=_blank>CultureInfo</A>.<A title=InvariantCulture href="http://msdn.microsoft.com/library/en-us/cpref/html/frlrfsystemglobalizationcultureinfoclassinvariantculturetopic.asp" target=_blank>InvariantCulture</A> was created. As with the locale, any string comparions made with InvariantCulture's <A title=CompareInfo href="http://msdn.microsoft.com/library/en-us/cpref/html/frlrfsystemglobalizationcompareinfoclasstopic.asp" target=_blank>CompareInfo</A> object would have linguistic validity in a lot of places, and would not vary within that installation of the .NET Framework.</P>
<P>So everyone had what they needed, right?</P>
<P>Well, no.</P>
<P>A bunch of people wanted a method of doing a more binary type of comparison, instead of one that would be based on the "linguistically appropriate" approach gven a particular culture<SUP><FONT size=1>1</FONT></SUP>. </P>
<P>The difference between what we had and what they wanted was akin to the difference between the C Runtime's <A title=strcoll href="http://msdn.microsoft.com/library/en-us/vclib/html/_crt_strcoll_functions.asp" target=_blank>strcoll</A>/<A title=wcscoll href="http://msdn.microsoft.com/library/en-us/vclib/html/_crt_strcoll_functions.asp" target=_blank>wcscoll</A> versus <A title=strcmp href="http://msdn.microsoft.com/library/en-us/vclib/html/_crt_strcmp.2c_.wcscmp.2c_._mbscmp.asp" target=_blank>strcmp</A>/<A title=wcscmp href="http://msdn.microsoft.com/library/en-us/vclib/html/_crt_strcmp.2c_.wcscmp.2c_._mbscmp.asp" target=_blank>wcscmp</A> (in the CRT documentation they refer to the difference as being locale based versus lexicographic). </P>
<P>The other advantage to such a "lexicographic" comparison is that it would be faster since a simple binary comparison of the code point values was being used.</P>
<P>To meet this need, the notion of an <EM>Ordinal</EM> sort was added and an <EM>Ordinal</EM> member was added&nbsp;to the <A title=CompareOptions href="http://msdn.microsoft.com/library/en-us/cpref/html/frlrfsystemglobalizationcompareoptionsclasstopic.asp" target=_blank>CompareOptions</A> enumeration. Selecting it would ignore all of those cultural collation features and give you a binary sort that would also, incidentally, not vary. </P>
<P>The only remaining problem at this point is that there were now two&nbsp;useful ways to do these different "niche" type of comparisons but neither name really jumps out at the developers who were looking for such solutions. </P>
<P>That problem remains to this day, though every single time I speak at a conference or answer a question in a newsgroup or get someone to look at posts like this one, then there is at least one less developer who has this problem. Maybe this time it is you? :-)</P>
<P>Now the story does not end here; many people have wanted to do things in a case-insensitive way. Of course if you wanted a case-insensitive invariant comparison then you could have done that all along -- just use the InvariantCulture's CompareInfo methods with the CompareOptions.IgnoreCase flag passed in. Easy!</P>
<P>But some people wanted a case-insensitive ordinal comparison?!?</P>
<P>Now the closet linguist in me shudders at this concept since a casing operation is essentially a linguistic one while an ordinal one is specifically not -- it's lexicographic. </P>
<P>So people are asking for a linguistic non-linguistic support, a request that for me brings to mind the comedian Steven Wright's dog<FONT size=1><SUP>2</SUP></FONT>. </P>
<P>However, the technical half of me understands the need and so I got over my linguistic fetish as&nbsp;one of my colleagues on the <a href="http://blogs.msdn.com/BCLTeam">BCL team</A> worked in Whidbey to add a new OrdinalIgnoreCase member to the CompareOptions enumeration. </P>
<P>The behavior is basically to do the casing operation using the default casing tables prior to doing the binary comparison. This feature has been in the "Whidbey"&nbsp;version of the .NET Framework&nbsp;for some time (first checked into the source code tree on February 7, 2003), so you can try it out today if you have just about any build of Whidbey underfoot.</P>
<P>Hopefully this post will help clear up some of the confusion about these two interesting comparison types.</P>
<P><EM><FONT size=2></FONT></EM>&nbsp;</P>
<P><EM><FONT size=2>1 - What can I say? Some people are Некультурные (uncultured) though not in the culturally offensive sense.<BR></FONT></EM><EM><FONT size=2>2 - Steven Wright claimed to have named his dog <STRONG>Stay</STRONG> so that he could call out "Come here, Stay! Come here, Stay!" and watch the dog walk toward him in a stuttery fashion.</FONT></EM></P>
<P><FONT color=#800080><EM></EM></FONT>&nbsp;</P>
<P><FONT color=#800080><EM>This post brought to you by</EM> "Ω" <EM>(U+03a9, GREEK CAPITAL LETTER OMEGA)<BR></EM><FONT size=1>I talked to Omega just before this post went live. She said that as the last letter in the Greek alphabet (who was pretty much always therefore last in the queue), she understood the&nbsp;cost of keeping letters in order. Any performance benefit is&nbsp; good one, to her mind. Especially since a binary sort would let her&nbsp;come before her little sister (U+03c9, GREEK SMALL LETTER OMEGA) for once. </FONT></FONT></P>
<hr/><p><a id="344323" href="#344323">#</a> <strong>Panos Theofanopoulos</strong> on 30 Dec 2004 8:29 AM:</p><div style="margin-left: 1em">for 1000000 comparisons<br><br>Ordinal : 47 mseconds<br><a title="InvariantCulture" href="http://msdn.microsoft.com/library/en-us/cpref/html/frlrfsystemglobalizationcultureinfoclassinvariantculturetopic.asp" target="_blank">InvariantCulture</a> : 299 mseconds<br><br>OrdinalIgnoreCase : 188 mseconds<br>InvariantCultureIgnoreCase : 245 mseconds<br><br>This post brought to you by &quot;Ώ&quot; (U+038F, GREEK CAPITAL LETTER OMEGA WITH TONOS) which beats Ω, ω and ώ in a binary sort :-)</div>
<p><a id="344331" href="#344331">#</a> <strong>Michael Kaplan</strong> on 30 Dec 2004 8:36 AM:</p><div style="margin-left: 1em">Heh heh heh -- see what I mean?<br><br>You do have to be careful with the perf testing in an actual app situation to use representative strings. The reason is that in both cases (ordinal *and* invariant) the code will exit as soon as it finds the winner. <br><br>In order (therefore) to get the most effective test you have to craft the strings to match the kind of comparisons you will see in your app.<br><br>I'll get more into how it works internally in a future post. :-)</div>
<p><a id="344339" href="#344339">#</a> <strong>Michael Kaplan</strong> on 30 Dec 2004 8:48 AM:</p><div style="margin-left: 1em">BTW -- Panos, in answer to your suggestion to the MSDN Feedback Center:<br><br><a target="_new" href="http://lab.msdn.microsoft.com/ProductFeedback/viewfeedback.aspx?feedbackid=2682c87e-5c46-4697-bbed-6f0de0047a7d">http://lab.msdn.microsoft.com/ProductFeedback/viewfeedback.aspx?feedbackid=2682c87e-5c46-4697-bbed-6f0de0047a7d</a> <br><br>True benchmarks for these methods under load, with indications of where the true slowdowns are, is the way to proceed here. IMHO, all perf. work has to be done that way....<br><br></div>
<p><a id="346625" href="#346625">#</a> <strong>Norman Diamond</strong> on 4 Jan 2005 5:10 PM:</p><div style="margin-left: 1em">&gt; Note that these string comparisons still had<br>&gt; much linguistic value -- half of the locales<br>&gt; in Windows use that default table, so an<br>&gt; invariant sort would not only avoid varying,<br>&gt; it would also look right to a lot of the<br>&gt; world.<br><br>Isn't linguistic value counterproductive for the intended value of the invariant locale?  Didn't you say in an earlier posting that people shouldn't use the invariant locale for human-oriented operations?  Surely the way to discourage people from using the invariant locale for sorting is to make the results appear wrong for every known culture in the world?</div>
<p><a id="346630" href="#346630">#</a> <strong>Michael Kaplan</strong> on 4 Jan 2005 5:20 PM:</p><div style="margin-left: 1em">&gt; Isn't linguistic value counterproductive for the intended value of the invariant locale? <br><br>No, not at all. I have explained the exact purpose of the invariant locale, and that is NOT it.<br><br>&gt; you say in an earlier posting that people shouldn't use the invariant locale for human-oriented operations?<br><br>No, I said that about ORDINAL comparisons.<br><br>&gt; Surely the way to discourage people from using the invariant locale for sorting is to make the results appear wrong for every known culture in the world?<br><br>Well, no one is trying to discourage invariant sorting. So I have to reject the premise here.</div>
<p><a id="346746" href="#346746">#</a> <strong>Norman Diamond</strong> on 4 Jan 2005 10:51 PM:</p><div style="margin-left: 1em">In page<br><a target="_new" href="http://weblogs.asp.net/michkap/archive/2004/12/08/278170.aspx">http://weblogs.asp.net/michkap/archive/2004/12/08/278170.aspx</a><br>you said:<br>&gt; The invariant locale is pretty weird. Lets<br>&gt; take a look at its interesting<br>&gt; chracteristics.<br>[...]<br>&gt; Its data was chosen to dissuade people from<br>&gt; trying to use it as a locale. And that is<br>&gt; putting it charitably.<br><br>That did not say ordinal comparisons, that said the invariant locale.  Please look at your own posting an un-reject the premise here.<br><br>Now, to help dissaude people from trying to use the invariant locale as a locale, would it not have been beneficial to avoid giving it linguistic values?  Would it not have been better if sort results were wrong for every human language?</div>
<p><a id="346768" href="#346768">#</a> <strong>Michael Kaplan</strong> on 5 Jan 2005 12:01 AM:</p><div style="margin-left: 1em">It was intended to be used for sorting, we want it used for sorting. This was the REASON it was added. It will not change, and we would not want it to change even if we had the option.<br><br>When I spoke of trying to make it less appealing as a locale, I am referring to EVERYTHING ELSE beyond collation.<br><br>I hope these words are plain enough.</div>
<p><a id="347334" href="#347334">#</a> <strong>Norman Diamond</strong> on 5 Jan 2005 4:38 PM:</p><div style="margin-left: 1em">Yes it is clearer this time.<br><br>Though I still think it would be better if the invariant locale's sort ordering differed from every human language so that no one would be tempted to use it for human-oriented sorting.  For internal ordering of databases and finding hash keys and running scripts in a uniform manner it would still be fine (which I thought its intended purpose was).</div>
<p><a id="347347" href="#347347">#</a> <strong>Michael Kaplan</strong> on 5 Jan 2005 5:03 PM:</p><div style="margin-left: 1em">Norman, I understand you think this.<br><br>Do you understand that we do not and that we intend it to be used and we have no ingtention of telling people not to use it? <br><br>It is basically the same as saying &quot;use English&quot; or whatever -- the default table. Thats what its job is, and it does that well. <br><br>Its not fair to change the requirement based on what you think it ought to do, and thus make it nor perform well. :-(</div>
<p><a id="347483" href="#347483">#</a> <strong>Norman Diamond</strong> on 5 Jan 2005 11:05 PM:</p><div style="margin-left: 1em">Then you should call it the English locale and not the invariant locale.  (Unless you really meant the en-US locale.)  Attaching a non-provincial label for the purpose of appearing non-provincial while still making the factual behavior every bit as provincial as your other thread said you were trying to avoid, just yields another bit of pretense with continued provincialism.  Also since facts of the invariant locale look like en-US, it will no longer be surprsing when US developers overuse it and use it for undesirable purposes.</div>
<p><a id="347525" href="#347525">#</a> <strong>Michael Kaplan</strong> on 6 Jan 2005 1:08 AM:</p><div style="margin-left: 1em">Norman, you are wrong once again. Over half othe languages there are also in the defualt table. I can say use Hebrew. Or German. Or any number of locales instead. Thinking it is provincial to take the word &quot;English&quot; out of it is plain silly.<br><br>No if you look at the REST of the data, it looks nothing like English. Or Arabic. Or German. Or Hebrew. Or any of the other 50 locales that use the table. So go ahead and try to claim it is a provincial attempt to push a particular culture if you must -- but those who are reading will have long seen who gets it.<br><br>What we do here with invariant has a valid and explainable purpose.</div>
<p><a id="348083" href="#348083">#</a> <strong>Michael Kaplan</strong> on 6 Jan 2005 5:13 PM:</p><div style="margin-left: 1em">Further comments that find to be inappopriate the intended purpose and use of the invariant locale's collation behavior (to use the DEFAULT collation table used by half of the locales in Windows) will not be accepted.<br><br>Those with dissenting opinions on the topic are invited to create their own blogs or web pages where they can explain the amount of evil-ness (evility?) in Microsoft's implementaion choices.</div>
<p><a id="349029" href="#349029">#</a> <strong>Norman Diamond</strong> on 7 Jan 2005 7:41 PM:</p><div style="margin-left: 1em">1/6/2005 1:08 AM Michael Kaplan<br><br>&gt; Thinking it is provincial to take the<br>&gt; word &quot;English&quot; out of it is plain silly. <br><br>Of course it is.  That's why I didn't use the word provincial that way.  I used the word provincial in the way you used it in page<br><a target="_new" href="http://weblogs.asp.net/michkap/archive/2004/12/08/278170.aspx">http://weblogs.asp.net/michkap/archive/2004/12/08/278170.aspx</a><br>and I agree with the way you used it there.</div>
<p><a id="349031" href="#349031">#</a> <strong>Michael Kaplan</strong> on 7 Jan 2005 7:56 PM:</p><div style="margin-left: 1em">Yes, but did you read the whole article?<br><br>&quot;...since the only real goal anyway was to &quot;use the default table&quot; for sorting...&quot;<br><br>Our point is therefore entirely clear here for all to see (and read).<br><br>Microsoft Windows and the .NET Framework work as designed in regard to the INVARIANT locale/culture. The only bug we have now is the inappropriate expectations of one Norman Diamond. :-)</div>
<p><a id="8920180" href="#8920180">#</a> <strong>Phil Hackett</strong> on 2 Sep 2008 12:00 PM:</p><div style="margin-left: 1em"><p>Thanks Michael - that article was -really- useful. &nbsp;It's a shame the official Microsoft help/documentation doesn't explain this, really, as it's such an obvious question that people are bound to ask.</p></div>
<hr/><p><em>referenced by</em></p><div style="margin-left: 1em"><p>2007/05/12 <a href="http://archives.miloush.net/michkap/archive/2007/05/12/2562871.html">The exception that proves the rule that was the exception that proves another rule (aka On the variability of the Invariant)</a></p><p>2007/04/25 <a href="http://archives.miloush.net/michkap/archive/2007/04/25/2273289.html">The nature of OrdinalIgnoreCase vs. intuitive expectations</a></p><p>2007/04/10 <a href="http://archives.miloush.net/michkap/archive/2007/04/10/2071471.html">When methods use collation to 'disturb the peace' we charge them with being 'out of sorts'</a></p><p>2006/08/27 <a href="http://archives.miloush.net/michkap/archive/2006/08/27/727607.html">It has not always been so invariant</a></p><p>2006/05/24 <a href="http://archives.miloush.net/michkap/archive/2006/05/24/605599.html">Invariant vs. Ordinal, the third</a></p><p>2005/12/22 <a href="http://archives.miloush.net/michkap/archive/2005/12/22/506595.html">New in Windows Vista: OrdinalIgnoreCase for Win32</a></p><p>2005/10/15 <a href="http://archives.miloush.net/michkap/archive/2005/10/15/481314.html">If you are using INVARIANT then you are probably MISusing it, #1</a></p><p>2005/04/26 <a href="http://archives.miloush.net/michkap/archive/2005/04/26/412079.html">Intelligent unmanaged string comparison</a></p><p>2005/04/13 <a href="http://archives.miloush.net/michkap/archive/2005/04/13/407823.html">Invariant and Ordinal Redux</a></p><p>2005/04/03 <a href="http://archives.miloush.net/michkap/archive/2005/04/03/405071.html">TechEd Bloggers does not work for this site?</a></p><p>2005/02/11 <a href="http://archives.miloush.net/michkap/archive/2005/02/11/371010.html">Surrogate pairs and binary (Ordinal) comparisons</a></p><p>2005/01/23 <a href="http://archives.miloush.net/michkap/archive/2005/01/23/358946.html">SQL Server has its own version of .NET "ordinal" comparisons</a></p><p>2004/12/30 <a href="http://archives.miloush.net/michkap/archive/2004/12/30/344389.html">How do sort keys work?</a></p></div><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2004/12/30/344389.html" title="How do sort keys work?">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2004/12/29/344107.html" title="My New Year&#39;s Resolutions">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2004-12">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2004-12-29">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2004/12/29/344136.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:42 GMT -->
</html>