<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2004/12/22/329657.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:42 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>%WINDIR%\system32\kbd*.dll</title></head><body>
<h1>%WINDIR%\system32\kbd*.dll</h1>
<p><em>by Michael S. Kaplan, published on 2004/12/22 02:04 -05:00, original URI: http://blogs.msdn.com/b/michkap/archive/2004/12/22/329657.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostNew -->
<P>Jonathan Wilson suggested as a topic that I "Talk about the keyboard layout dlls (kbd*.dll), how they relate to <A title=MSKLC href="http://www.microsoft.com/globaldev/tools/msklc.mspx" target=_blank>MSKLC</A> " and so I figured that might be a nice thing to spend a cycle or two on. Not just because its an interesting question, but also that people will be able to think of me as being responsive to entries in my <a href="http://archives.miloush.net/michkap/archive/2004/11/27/271003.html">Suggest a Topic</A> link (assuming of course that people follow the rules in my <a href="http://archives.miloush.net/michkap/archive/2004/11/27/270995.html">Comment Policy</A> link!).</P>
<P>Anyway, back to keyboard DLLs....</P>
<P>The relationship between MSKLC and these DLLs is pretty easy to describe... the former creates the latter. Well, the ones created by MSKLC are slightly cooler than the ones in the OS since they support Unicode names for the resource strings where the description and copyright are stored. Those DLLs basically contain the information that you synthesize in the user interface of MSKLC. One of those DLLs actually shows up in the i386 subdirectory of your setup package, and the reason that the name of the file you create may not be named kbd*.dll is that neither I nor anyone else at Microsoft wanted to limit you to a mere five letters to express your creative needs. :-)</P>
<P>The operating system files always use the 8.3 kbd*.dll&nbsp;naming convention, because on the whole Microsoft is unlikely to ever ship enough keyboards for that to cause a problem. Therefore, if you are using MSKLC you have the perfect opportunity to avoid overlapping existing keyboard DLLs that are shipped by Microsoft if you avoid the "kbd" prefix.</P>
<P>But what, in fact,&nbsp;are these DLLs?</P>
<P>Well, the full answer to that question can be a topic for another day, but....&nbsp;</P>
<P>For the NT-based platforms, a lot of information can be found in the Windows DDK (which also has samples), but its not in the most easy to read form. Basically, each of these DLLs created by MSKLC exports a function named KbdLayerDescriptor which returns a single big structure that has lots of data in it (the structure is defined in kbd.h). And that data is the very information that was defined in MSKLC, in an even less understandable form. </P>
<P>The DLLs themselves are written in C, but given how little they do in terms of code, that fact probably does not matter too much. :-)</P>
<P>For Windows 95, 98, and Me the format was actually very different and the DLLs were written in assembly language. But the principles are the same -- a bunch of data tables that the OS uses to figure out what the layout it.</P>
<P>Like I said, the full topic can be covered other days (along with some other functions that show up in a couple of these DLLs like KbdLayerMultiDescriptor, KbdLayerRealDllFile, KbdLayerRealDllFileNT4, and KbdNlsLayerDescriptor). Its definitely on my internal list of future topics, so stay tuned if you are interested....</P>
<P><EM><FONT size=2>Please note that this posting has nothing to do with IMEs whatsoever. I will deal with the myriad of issues relating to IMEs and their associated keyboards in a future posting, and all comments about IMEs may find themselves not being made public if this is fact is ignored in the comment! :-)</FONT></EM></P>
<P><FONT color=#800080><EM>This post brought to you by </EM>"àªš" (U+0a9a, a.k.a. GUJARATI LETTER CA)<FONT size=1></P></FONT></FONT>
<hr/><div style="margin-left: 1em"><em>no comments</em></div><hr/><p><em>referenced by</em></p><div style="margin-left: 1em"><p>2007/11/13 <a href="http://archives.miloush.net/michkap/archive/2007/11/13/6122573.html">I know that header file is around here somewhere</a></p><p>2005/10/06 <a href="http://archives.miloush.net/michkap/archive/2005/10/06/477930.html">I will stipulate that 64-bit is the future</a></p></div><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2004/12/23/331112.html" title="Accessibility, Internationalization, and Keyboards (#1: Shortcuts)">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2004/12/21/328259.html" title="An &#39;Access Hero&#39;, sorta">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2004-12">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2004-12-22">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2004/12/22/329657.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:42 GMT -->
</html>