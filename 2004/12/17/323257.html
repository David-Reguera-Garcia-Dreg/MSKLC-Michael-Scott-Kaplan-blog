<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2004/12/17/323257.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:42 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>Dead keys are not intuitive</title></head><body>
<h1>Dead keys are not intuitive</h1>
<p><em>by Michael S. Kaplan, published on 2004/12/17 02:27 -05:00, original URI: http://blogs.msdn.com/b/michkap/archive/2004/12/17/323257.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostNew -->
<P>The dead key mechanism in keyboard layouts is rooted in European typewriters. One would type the accent character and the typewriter's head would not advance, then one would type the base character and it would. The term dead key refers to the fact that the position is not advanced after typing the diacritic mark.</P>
<P>So since people are used to this from typewriters, adding a similar mechanism to Windows should be easy, right?</P>
<P>Well, no. </P>
<P>After all, if you are used to Unicode then you know that one first types the base character and then the diacritic. If you are used to typewriters, you expect to see the diacritic. And in both cases you expect that what is finally produced is always made up of the constituent parts that were typed.</P>
<P>In keyboard layouts on Windows, none of these assumptions are true. Nothing is visible after typing the dead key. The layout defines what is to appear when the combination of the dead key and the base character is typed and there is no rule guiding what must appear.</P>
<P>This is a mechanism that is very easy and intuitive if you know about it, otherwise it is as confusing as hell. </P>
<P>Also, you can only have each pairing of keystrokes produce a single UTF-16 code point. I would not have believed it, but this limitation is one of the most common questions I am asked about (not #1 but definitly in the top five -- most often to do with user-created Polytonic Greek keyboards since there is no precomposed form in Unicode). This is not an <A title=MSKLC href="http://www.microsoft.com/globaldev/tools/msklc.mspx" target=_blank>MSKLC</A> limitation, it is a core limitation in the keyboard layout architecture, as one can find in the kbd.h header file from the Windows DDK (available to all for a mere $199 plus s/h):</P>
<P><FONT face="Courier New"><STRONG>/***************************************************************************\<BR>*<BR>* Dead Key (diaresis) tables<BR>*<BR>* LATER #####: supplant by an NLS API that composes Diacritic+Base -&gt; WCHAR<BR>*<BR>\***************************************************************************/<BR>typedef struct {<BR>&nbsp;&nbsp;&nbsp; DWORD&nbsp; dwBoth;&nbsp; // diacritic &amp; char<BR>&nbsp;&nbsp;&nbsp; WCHAR&nbsp; wchComposed;<BR>&nbsp;&nbsp;&nbsp; USHORT uFlags;<BR>} DEADKEY, *KBD_LONG_POINTER PDEADKEY;</STRONG></FONT><BR></P>
<P>There is only room for a single WCHAR for the precomposed character. Sorry!&nbsp; </P>
<P>There is also a comment above the struct by someone who no longer works on keyboards (their name removed from above for obvious reasons!), and no NLS API was ever added for the sake of keyboards that would combine the two characters to create the dead key. Technically one already exists -- the <A href="http://msdn.microsoft.com/library/en-us/winui/winui/windowsuserinterface/resources/strings/stringreference/stringfunctions/foldstring.asp">FoldString</A> API with the MAP_PRECOMPOSED flag. However, such an API could never be used at this point, since there has been many years of potential keyboard layouts shipped that allow one to attach to two unrelated characters a third unrelated character. </P>
<P>(I'll see about talking to someone about removing the comment!)</P>
<P>Now one thing that is possible in the Windows architecture is chaining dead keys together, so that a dead key plus a base character will then wait treat the combination as another dead key waiting for yet a third base character. One could then chain that as well, and so on -- adding more and more keystrokes to produce in the end a single code point. This feature is not currently supported by MSKLC since the demand for combinations of three or more keystrokes always involve multiple characters being produced -- one is simply not enough here for anyone who has ever asked....</P>
<P>On the whole, my earlier words about dead keys sum up the situation best:</P>
<P>This is a mechanism that is very easy and intuitive if you know about it, otherwise it is as confusing as hell. </P>
<P>Luckily there are many ways to produce input with keyboards that is much more intuitive to potential users. Lets leave dead keys for the people who are used to them.<BR></P>
<P>&nbsp;</P>
<hr/><p><a id="323553" href="#323553">#</a> <strong>Anonymous</strong> on 17 Dec 2004 6:56 AM:</p><div style="margin-left: 1em">I know that the feature of using random keys exists, but it seems like a pretty stupid feature. <br><br>Couldn't you make your keyboard creator use that API call or maybe normalization form C to validate smart dead key usage?</div>
<p><a id="323554" href="#323554">#</a> <strong>Jake</strong> on 17 Dec 2004 6:58 AM:</p><div style="margin-left: 1em">I saw you and Cathy Wissink talking about keyboards at a conference last year. I remember a great line you guys had &quot;Dead keys -- neither dead nor keys&quot;. Great stuff, keep the posts coming!</div>
<p><a id="323585" href="#323585">#</a> <strong>Michael Kaplan</strong> on 17 Dec 2004 8:04 AM:</p><div style="margin-left: 1em">Validating dead keys to make sure that base character and diacritic equal the combining character -- that is a very interesting idea. Definitely something to look into for v.Next of <a title="MSKLC" href="http://www.microsoft.com/globaldev/tools/msklc.mspx" target="_blank">MSKLC</a>!</div>
<p><a id="323586" href="#323586">#</a> <strong>Michael Kaplan</strong> on 17 Dec 2004 8:05 AM:</p><div style="margin-left: 1em">Hi Jake,<br><br>Thanks for the kind words, and glad you liked the presentation!</div>
<p><a id="323603" href="#323603">#</a> <strong>Ben Hutchings</strong> on 17 Dec 2004 8:28 AM:</p><div style="margin-left: 1em">&quot;Also, you can only have each pairing of keystrokes produce a single UTF-16 code point.&quot;<br><br>Surely the limitation is to one code unit (WCHAR), not one code point, which means anything outside the BMP is unavailable.</div>
<p><a id="323613" href="#323613">#</a> <strong>Michael Kaplan</strong> on 17 Dec 2004 8:42 AM:</p><div style="margin-left: 1em">Yes, that is the limitation -- one WCHAR. <br><br>I figured that most people do not know what a code unit is but lots of people can guess at the meaning of a &quot;UTF-16 code point&quot; (since anything outside the BMP would require a pair of UTF-16 code points!).</div>
<p><a id="323947" href="#323947">#</a> <strong>Chris Nahr</strong> on 18 Dec 2004 1:13 AM:</p><div style="margin-left: 1em">Maybe they're difficult to implement, but how are dead keys not intuitive to the user? Are you saying that pressing a clearly labeled accent key and then &quot;a&quot; is less intuitive than hunting for some crazy Ctrl/Shift combo, or pasting from the Character Map? Sorry, I'm not following you there...</div>
<p><a id="323981" href="#323981">#</a> <strong>Michael Kaplan</strong> on 18 Dec 2004 3:52 AM:</p><div style="margin-left: 1em">As I said in the fourth paragraph:<br><br>After all, if you are used to Unicode then you know that one first types the base character and then the diacritic. If you are used to typewriters, you expect to see the diacritic. And in both cases you expect that what is finally produced is always made up of the constituent parts that were typed.<br><br>I have seen how most users try this -- they either hit the letter before the diacritic (which does not work right) or they hit the diacritic twice since nothing appears (and then they get two dicritics). The current design is understandable if explained; it does not help a user who tries to use the pictures on the keyboard.</div>
<p><a id="325657" href="#325657">#</a> <strong>Chris Nahr</strong> on 19 Dec 2004 12:58 AM:</p><div style="margin-left: 1em">That makes sense, I didn't think that people would try to type the letter first and then the accent. You're also right that the accent not showing up immediately might be confusing to some users.<br><br>Regardless, speaking as a German whose keyboard has accent keys to produce French accents, I do believe the dead key method is the optimal solution for this problem, even if it would be even nicer if the above issues were resolved.</div>
<p><strong>Michael Everson</strong> on 19 Jun 2009 10:26 AM:</p><div style="margin-left: 1em"><p>Dead keys were not confined to European typewriters. </p></div>
<hr/><p><em>referenced by</em></p><div style="margin-left: 1em"><p>2011/04/23 <a href="http://archives.miloush.net/michkap/archive/2011/04/23/10157359.html">Solution: The Dead Keys Conundrum: An Encyclopedia Brown Mystery</a></p><p>2011/04/16 <a href="http://archives.miloush.net/michkap/archive/2011/04/16/10154700.html">Chain Chain Chain, Chain of Dead Keys</a></p><p>2009/06/18 <a href="http://archives.miloush.net/michkap/archive/2009/06/18/9773077.html">Those keys aren't going to be extended; they're dead!</a></p><p>2007/11/21 <a href="http://archives.miloush.net/michkap/archive/2007/11/21/6456468.html">Michael's Keyboard Laws for Developers, Part 4</a></p><p>2007/02/11 <a href="http://archives.miloush.net/michkap/archive/2007/02/11/1657463.html">MSKLC can't do everything, even in the 1.4 version</a></p><p>2006/12/24 <a href="http://archives.miloush.net/michkap/archive/2006/12/24/1355642.html">Despite a report to the contrary, >1000 seems to work</a></p><p>2006/03/28 <a href="http://archives.miloush.net/michkap/archive/2006/03/28/561725.html">Only ONE WCHAR per dead key</a></p><p>2006/03/24 <a href="http://archives.miloush.net/michkap/archive/2006/03/24/559169.html">Getting all you can out of a keyboard layout, Part #3</a></p><p>2005/11/15 <a href="http://archives.miloush.net/michkap/archive/2005/11/15/492200.html">It is not easy to chain dead keys on Windows</a></p><p>2005/08/05 <a href="http://archives.miloush.net/michkap/archive/2005/08/05/448006.html">What MSKLC can't do</a></p><p>2005/02/24 <a href="http://archives.miloush.net/michkap/archive/2005/02/24/379466.html">The keyboard does not do what I tell it to!</a></p><p>2005/01/19 <a href="http://archives.miloush.net/michkap/archive/2005/01/19/355870.html">He's dead [keys], Jim.</a></p></div><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2004/12/18/323941.html" title="Putting your ducks in a row">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2004/12/16/318271.html" title="Thursday morning wrestling: LCID vs. HKL">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2004-12">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2004-12-17">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2004/12/17/323257.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:42 GMT -->
</html>