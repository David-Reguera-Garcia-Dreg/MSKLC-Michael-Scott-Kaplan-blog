<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2011/09/28/10217550.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:34 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>Whodvethunk it'd be GDI+ injecting a little sanity into digit shenanigans?</title></head><body>
<h1>Whodvethunk it'd be GDI+ injecting a little sanity into digit shenanigans?</h1>
<p><em>by Michael S. Kaplan, published on 2011/09/28 07:01 -04:00, original URI: http://blogs.msdn.com/b/michkap/archive/2011/09/28/10217550.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostNew -->
<p>Reader Angel asked about Digit Substitution:</p>
<p style="padding-left: 60px;"><span style="font-family: times new roman,times; font-size: small;">Hello Michael!</span></p>
<p style="padding-left: 60px;"><span style="font-family: times new roman,times; font-size: small;">I randomly found your blog while googling about digit substitution. I read all the entries in your blog about this subject, but didn&rsquo;t find an answer for my problem. However, I think you might be able to help me.</span></p>
<p style="padding-left: 60px;"><span style="font-family: times new roman,times; font-size: small;">I&rsquo;m working on a MFC application which uses several custom controls. One of those custom control displays text using the DrawString method from GDI+, and digit substitution is not working very well on it. I&rsquo;m getting the following results:</span></p>
<p style="padding-left: 120px;"><strong><span style="font-family: courier new,courier; font-size: small;">|User Locale (Format)| Standard digits&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; | Use native digits | Displayed digits |</span></strong><br /><strong><span style="font-family: courier new,courier; font-size: small;">&nbsp;--------------- --------------------------- ------------------- ------------------</span></strong><br /><strong><span style="font-family: courier new,courier; font-size: small;">| English (USA)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; | Arabic&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; | National&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; | Arabic&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |</span></strong><br /><strong><span style="font-family: courier new,courier; font-size: small;">| English (USA)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; | Hindi&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; | National&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; | Arabic&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |</span></strong><br /><strong><span style="font-family: courier new,courier; font-size: small;">| Arabic (Egypt)&nbsp;&nbsp;&nbsp;&nbsp; | Arabic&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; | National&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; | Arabic&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |</span></strong><br /><strong><span style="font-family: courier new,courier; font-size: small;">| Arabic (Egypt)&nbsp;&nbsp;&nbsp;&nbsp; | Hindi&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; | National&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; | Hindi&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |</span></strong><br /><strong><span style="font-family: courier new,courier; font-size: small;">| Arabic (Egypt)&nbsp;&nbsp;&nbsp;&nbsp; | Other strange digits | National&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; | Hindi&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |</span></strong><br /><strong><span style="font-family: courier new,courier; font-size: small;">&nbsp;------------------- ---------------------- ------------------- -------------------</span></strong></p>
<p style="padding-left: 60px;"><span style="font-family: times new roman,times; font-size: small;">So for me it looks like the substitution is only performed if the selected &lsquo;Standard Digits&rsquo; are in the codepage for the locale. Because of this, digit substitution only works with the Arabic locale and Hindi or Arabic numbers. If the &lsquo;Standard Digits&rsquo; are not in the codepage, then the national default ones will be used: Arabic in the case of English and Hindi in the case of Arabic. I know codepages and unicode are very different things, but I cannot think of any other explanation.</span></p>
<p style="padding-left: 60px;"><span style="font-family: times new roman,times; font-size: small;">The application is Unicode, and digit substitution works everywhere else (buttons, window titles, etc) but in this custom control, which is used to display the static text in all the application. The TextFormat the DrawString method uses has DigitSubstitution set to StringDigitSubstituteUser (although I&rsquo;ve tried all the other values with no good results). LOCALE_IDIGITSUBSTITUTION == 2 and LOCALE_SDIGITSUBSTITUTION returns the &ldquo;Use native digits&rdquo; digits when I check their values just before DrawString.</span></p>
<p style="padding-left: 60px;"><span style="font-family: times new roman,times; font-size: small;">Any ideas?</span></p>
<p style="padding-left: 60px;"><br /><span style="font-family: times new roman,times; font-size: small;">Please, tell me if you need any additional info or clarification about the problem.</span></p>
<p style="padding-left: 60px;"><span style="font-family: times new roman,times; font-size: small;">Thank you very much!!!</span><br /><span style="font-family: times new roman,times; font-size: small;">Angel.-</span></p>
<p>It isn't exactly about code pages, since the Arabic code page,&nbsp;<a href="http://msdn.microsoft.com/en-us/goglobal/cc305149">Windows code page&nbsp;1256</a>,&nbsp;only contain the ASCII digits.</p>
<p>In fact, most of the locales that explicitly support digit sustitution don't even <strong>have</strong> code pages!</p>
<p>Thus the code page itself can't do much here.</p>
<p>The real problem (to the extent it is a problem, a point I'll discuss in a moment), is that GDI+ doesn't really play well when the digits are overridden to not be&nbsp;the kind that typically gets used for the locale.</p>
<p>By letter of the law, well of the user preference, whatever "batshit crazy nonsense" you set in the dialog is what should be used.</p>
<p>Though in practice, the indirect way the digits are used in the original GDI and Uniscribe cases (ref: <strong><a title="Digits -- there is no substitute" href="http://archives.miloush.net/michkap/archive/2006/01/18/514171.html">Digits -- there is no substitute</a></strong>&nbsp;and <strong><a title="Windows doesn't let you choose the pinch hitter in digit substitution cases" href="http://archives.miloush.net/michkap/archive/2008/04/21/8413510.html">Windows doesn't let you choose the pinch hitter in digit substitution cases</a></strong>) leads to lots of of confusion anyway.</p>
<p>I feel like the GDI+ insistence on having some consistency here is probably a forcing function to take some really potentially whacked out functionality and be a little more sensible.</p>
<p>In the end, you have to decide how much sense you think this UI really makes:</p>
<p><img src="http://msdnshared.blob.core.windows.net/media/MSDNBlogsFS/prod.evol.blogs.msdn.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/00/33/81/0458.standarddigits.jpg" /></p>
<p><em>Bonus points if you know what the last row is without setting it and programmatically checking the results, and even more bonus points if you know why they don't show up!</em></p>
<hr/><div style="margin-left: 1em"><em>no comments</em></div><hr/><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2011/09/29/10218142.html" title="I guess you can say we welched on the promise of code pages?">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2011/09/27/10217161.html" title="I&#39;m donating my birthday to Vittana. And the world....">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2011-09">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2011-09-28">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2011/09/28/10217550.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:34 GMT -->
</html>