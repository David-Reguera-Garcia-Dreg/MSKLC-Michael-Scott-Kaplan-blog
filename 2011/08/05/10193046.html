<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2011/08/05/10193046.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:34 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>Windows isn't Office (and vice versa)</title></head><body>
<h1>Windows isn't Office (and vice versa)</h1>
<p><em>by Michael S. Kaplan, published on 2011/08/05 07:01 -04:00, original URI: http://blogs.msdn.com/b/michkap/archive/2011/08/05/10193046.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostNew -->
<p>Some people view Microsoft as one big company.</p>
<p>Others view it as several different companies, rubber banded together.</p>
<p>I suppose at some level either view is reasonable, but the latter view has one advantage in particular: it helps make differences between teams and groups and divisions make more sense!</p>
<p>Like the other day, when in a late and somewhat off-topic response to <strong><a title="If you find that GetLocaleInfo is driving you crazy, it may not be the right function to use" href="http://archives.miloush.net/michkap/archive/2011/08/04/2146890.html">If you find that GetLocaleInfo is driving you crazy, it may not be the right function to use</a></strong>,&nbsp;Jacob Sch&auml;ffer commented:</p>
<p style="padding-left: 60px;"><span style="font-family: times new roman,times; font-size: medium;">I'm using the GetLocaleInfoW function to return the &lt;language&gt;-&lt;Script&gt;-&lt;REGION&gt; pattern for a specific LCID using the LOCALE_SNAME constant (in VB6 and Office VBA). While doing so I found that looking up LCID's 2072 (&amp;H818) for Moldov Romanian and 2073 (&amp;H819) for Moldov Russian fail, while any other LCID I try returns the expected pattern.</span></p>
<p style="padding-left: 60px;"><span style="font-family: times new roman,times; font-size: medium;">The same thing happens when I use the LOCALE_SISO639LANGNAME and LOCALE_SISO3166CTRYNAME instead of LOCALE_SNAME.</span></p>
<p style="padding-left: 60px;"><span style="font-family: times new roman,times; font-size: medium;">I cannot find the LCID's 2072 (&amp;H818) and 2073 (&amp;H819) in the <a href="http://msdn.microsoft.com/library/dd318693.aspx">Language Identifier Constants and Strings</a> table, so I suppose Windows (tested on Windows 7) cannot properly deal with these Moldov language variants. Can this really be true?</span></p>
<p style="padding-left: 60px;"><span style="font-family: times new roman,times; font-size: medium;">Surprisingly, MS Office 2010 declare the constants wdRomanianMoldova (2072) and wdRussianMoldova (2073) in the WdLanguageID enum, and similarly in the MsoLanguageID enum.</span></p>
<p style="padding-left: 60px;"><span style="font-family: times new roman,times; font-size: medium;">Is it possible that MS Office supports languages for both document editing and the Office GUI that doesn't exist in Windows, or do I need to use another function to get access to the complete locale info database (I need support back to Windows XP)?</span></p>
<p style="padding-left: 60px;"><span style="font-family: times new roman,times; font-size: medium;">I'm using the &lt;language&gt;-&lt;Script&gt;-&lt;REGION&gt; pattern to identify which language file (not standard ressource files, but external UTF-16LE encoded XML documents) to load strings from. Although I might never run into the need for a Moldov Romanian setup I'd prefer to have a generic and reliable function that returns meaningful &lt;language&gt;-&lt;Script&gt;-&lt;REGION&gt; patterns for all MS Office declared LCID's.</span></p>
<p style="padding-left: 60px;"><span style="font-family: times new roman,times; font-size: medium;">Finally, I also need the reverse functionality. I've been looking for an API function or a constant for GetLocaleInfoW that returns the LCID based on the input string pattern &lt;language&gt;-&lt;Script&gt;-&lt;REGION&gt;. I may have become blind and overlooked something during my searches, but I didn't find any API method for this. Does such a beast exist or do I have to build my own table (which is a highly undesirable thing to do)?</span></p>
<p style="padding-left: 60px;"><span style="font-family: times new roman,times; font-size: medium;">All the best / Jacob</span></p>
<p>Jacob had it right here - Windows has no support for a Moldova-based locale&nbsp;- either for Romanian or Russian. Either in XP or in later versions.</p>
<p>Though of course both Romanian and Russian <strong>are</strong> supported. The script is there, and all the letters.</p>
<p>People can get things done, at least.</p>
<p>If one truly needs an Office-based&nbsp;function then it's unfortunate that Office doesn't document one - especially for the sake of these edge cases that bring one so close!</p>
<p>But there it is.</p>
<p>Of course I do have to correct the notion that a &lt;language&gt;-&lt;Script&gt;-&lt;REGION&gt; pattern always makes sense; after all, most locales don't include a script.</p>
<p>And locales themselves don't have their names constructed from their constituent parts anyway -- their names are defined whole in each locale.</p>
<p>In the end, platforms like 2000, XP, and 2003 were built before Microsoft jumped into names at all, so trying to construct them after the fact will never work as well as they do now....</p>
<hr/><p><strong>Jacob Sch&#228;ffer</strong> on 8 Aug 2011 4:34 PM:</p><div style="margin-left: 1em"><p>No, most locales don&#39;t need a Script, but when you are in Eastern Europe it may be quite interesting to differ bewteen &quot;Cyrl&quot; and &quot;Latn&quot; scripts (at least in my case).</p>
<p>What exactly does the Downlevel NLS library back-port to XP and 2003 that can&#39;t be achieved with EnumSystemLocales() in combination with GetLocaleInfo() with appropriate flags? Does it implement &quot;names&quot; from newer versions or is XP/SP2 or 2003/SP1 updated so such &quot;names&quot; are returned correctly by GetLocaleInfo() with the LOCALE_SNAME flag set?</p>
<p>/Jacob</p>
</div>
<p><strong>Michael S. Kaplan</strong> on 8 Aug 2011 8:45 PM:</p><div style="margin-left: 1em"><p>It does not return any names of locales that aren&#39;t on the machine....</p>
</div>
<p><strong>Jacob Sch&#228;ffer</strong> on 12 Aug 2011 6:58 AM:</p><div style="margin-left: 1em"><p>Unfortunately not :-)</p>
<p>The LOCALE_SNAME constant seem not to exist on XP, but the constants LOCALE_SISO639LANGNAME and LOCALE_SISO3166CTRYNAME does. If not one need the &lt;Script&gt; or &lt;_sort&gt; part of the Locale Name it looks like an resonable option on XP to compose the Locale Name as &lt;Val(LOCALE_SISO639LANGNAME)&gt;-&lt;Val(LOCALE_SISO3166CTRYNAME)&gt;. This actually appear to work for the vast majority of locales, though one have to build a private &quot;exceptions&quot; table to attain 100% match and support for the &lt;Script&gt; part for certain locales.</p>
<p>XP seem - with the LCID_SUPPORTED flag set - to enumerate 167 locales, of which only a very small part seem to require special attention in the above mentioned LOCALE_SNAME simulation. However Windows 7 seem to enumerate 211 locales. Is it those extra locales you refer to when you say &quot;It does not return any names of locales that aren&#39;t on the machine...&quot;?</p>
<p>During my research I stumbled over a heterogeneity regarding return values on XP vs Windows 7 for the same LCID&#39;s. For example, Val(LOCALE_SISO3166CTRYNAME) for LCID 9225 returns &quot;CB&quot; on XP and &quot;029&quot; on Windows 7. I can&#39;t find neither &quot;CB&quot; nor &quot;029&quot; mentioned as valid country codes in online versions of the ISO 3166 standards. One place I actually could find something about this change was in &quot;.NET Compact Framework 3.5 Run-Time Breaking Changes&quot; (<a rel="nofollow" target="_new" href="http://msdn.microsoft.com/en-us/netframework/bb986636">msdn.microsoft.com/.../bb986636</a>) that clearly shows that quite a few Locale Names have changed for a given locale.</p>
<p>As I read the NLS support API&#39;s documentation at MSDN, Microsoft urge developers to use Locale Names over Locale Identifiers. This seem to be a game of chance if the naming conventions change, the ISO standards are broken or insuffient while LCID&#39;s are much more static.</p>
<p>What are your best argument(s) for using Locale Names over numeric LCID&#39;s - except for human readability?</p>
<p>All the best /Jacob</p>
</div>
<p><strong>Michael S. Kaplan</strong> on 12 Aug 2011 7:10 AM:</p><div style="margin-left: 1em"><p>Following standards?</p>
<p>Changes made were to *be* conformant, which LCIDs are not....</p>
</div>
<p><strong>Michael S. Kaplan</strong> on 12 Aug 2011 10:54 AM:</p><div style="margin-left: 1em"><p>Anyway, there are a host of reasons that we are now ten years smarter than we were then; those reasons should be embraced, not shunned.</p>
</div>
<p><strong>Jacob Sch&amp;#228;ffer</strong> on 12 Aug 2011 12:12 PM:</p><div style="margin-left: 1em"><p>I *certainly* embrace the NAMING initiative. It&#39;s fantastic to use in most cases, since it&#39;s quite readable by the human eye. And ... FWIW ... I&#39;m certainly not backward-looking (though some of my customers are)!!!</p>
<p>The fact is that I&#39;m hunting a *stable* way to use Locale Names for lookup *AND* need access to locale data on XP as well as on newer OS versions - using unique Locale Names for input. However, since the Locale Names for some locales can&#39;t be directly built on XP - even with good will - this appear to be a problem for me, since the environment I work in is VBA7 in Office 2010 (which - by the way - don&#39;t implement ANY way to lookup locale information by Locale Name, but only by LCID).</p>
<p>What I see is that the Windows environment can NOT deliver a *stable* mapping from Locale Names to Locale Identifiers unless I implement all sorts of workarounds. That&#39;s perfectly fine with me, since the world goes on and *if* I need backward compatibility I&#39;m asking for trouble. Period.</p>
<p>Anyway, please point to an ISO standard that define &quot;029&quot; as a proper country identifier. The MSDN documentation for the LOCALE_SISO3166CTRYNAME says that it should return the ISO 3166 name for a country. I&#39;d like to know which country &quot;029&quot; represent and where to find the ISO standard that says so ???</p>
<p>Now, let&#39;s assume that such a standard doesn&#39;t exist. Then, can developers rely on LOCALE_SISO3166CTRYNAME after all, or is the ISO standard insuffient in this regard ???</p>
<p>I have to point out, that I do NOT need support with this, but find the academic discussion highly interesting.</p>
<p>All the best /Jacob</p></div>
<p><strong>Michael S. Kaplan</strong> on 14 Aug 2011 9:38 AM:</p><div style="margin-left: 1em"><p>029 is the *numeric* country code for ISO 3166, and the only way that MS could rehabilitate the &quot;en-cb&quot; locale....</p>
</div>
<hr/><p><em>referenced by</em></p><div style="margin-left: 1em"><p>2011/08/16 <a href="http://archives.miloush.net/michkap/archive/2011/08/16/10196054.html">The road to standards compat is paved with app back-INcompat</a></p></div><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2011/08/07/10193388.html" title="You can&#39;t go home again, MS edition">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2011/08/04/10192772.html" title="Without fonts?">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2011-08">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2011-08-05">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2011/08/05/10193046.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:34 GMT -->
</html>