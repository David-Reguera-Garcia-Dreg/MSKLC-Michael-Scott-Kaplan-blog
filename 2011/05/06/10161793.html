<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2011/05/06/10161793.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:34 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>Compare ≠ Equals, Invariant ≠ Ordinal, readers of this blog ≠ everyone else, and so on....</title></head><body>
<h1>Compare ≠ Equals, Invariant ≠ Ordinal, readers of this blog ≠ everyone else, and so on....</h1>
<p><em>by Michael S. Kaplan, published on 2011/05/06 07:01 -04:00, original URI: http://blogs.msdn.com/b/michkap/archive/2011/05/06/10161793.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostNew -->
<p>Sometimes the questions seem like they never actually change, mainly because&nbsp;all the&nbsp;new people often find themselves saying the same things the formerly new people did.</p>
<p>Like the other day, when one of the SDETs asked:</p>
<p style="padding-left: 90px;"><em>I just noticed that it seems like people have had a variety of different preferred methods for checking string equality.&nbsp; I was wondering if anyone knows if there are any measurable performance or memory differences between the different ways of doing case insensitive string equality checks.&nbsp; </em></p>
<p style="padding-left: 90px;"><span style="font-family: consolas,lucida console,courier new,courier,fixed;"><strong>&nbsp;&nbsp;&nbsp; stringA.ToLowerInvariant() == stringB.ToLowerInvariant();<br />&nbsp;&nbsp;&nbsp; stringA.ToUpperInvariant() == stringB.ToUpperInvariant();<br />&nbsp;&nbsp;&nbsp; string.Equals(stringA, stringB, StringComparison.OrdinalIgnoreCase);<br />&nbsp;&nbsp;&nbsp; string.Compare(stringA, stringB, StringComparison.OrdinalIgnoreCase) == 0;<br />&nbsp;&nbsp;&nbsp; stringA.Equals(stringB, StringComparison.OrdinalIgnoreCase);</strong></span></p>
<p style="padding-left: 90px;"><em>Thanks</em></p>
<p>&nbsp;Now many people pointed out that perhaps the question was being asked the wrong way around.</p>
<p>After all, assuming all five methods are doing exactly the same thing would be&nbsp;a big mistake, since they aren't.</p>
<p>And obviously it is much more important for one to first get the right answer; once that happens then if there are performance issues one can start searching for the fast answer.</p>
<p>It felt good to see such responses since I remember when people didn't always jump in here as fast. It's nice to know I was a little bit of a part of that....</p>
<p>But what really caught my I was <a href="http://blogs.msdn.com/b/ericlippert/">Eric Lippert</a>'s response.</p>
<p>Well, to be accurate, the part I added the emphasis on below:</p>
<p style="padding-left: 60px;"><span style="font-family: times new roman,times;">Do we have any guarantee that all five of those techniques give the same results when given the same input strings? I see no reason why all five of those ought to give the same answers. Are they documented as doing so? I don&rsquo;t believe they are.</span></p>
<p style="padding-left: 60px;"><span style="font-family: times new roman,times;">If not, then the question you should be asking first is &ldquo;which is correct?&rdquo; not &ldquo;which is faster?&rdquo;</span></p>
<p style="padding-left: 60px;"><span style="font-family: times new roman,times;">The next thing I&rsquo;d consider before thinking about which is faster is &ldquo;which uses the right tool for the job?&rdquo;</span></p>
<p style="padding-left: 60px;"><span style="font-family: times new roman,times;">Consider the third and fourth options, for example. <strong>Clearly the purpose of &ldquo;equals&rdquo; is to determine equality. Clearly the purpose of &ldquo;compare&rdquo; is to determine order.&nbsp; You&rsquo;ve stated that you are seeking equality. Why then would you ever avoid using a method clearly documented as doing what you want, that is easy to read and understand the semantics of the code, and instead use a method designed to do some slightly different task? When I see code that has &ldquo;Compare&rdquo; in it, I assume that it is being used for determining order, not equality</strong>.</span></p>
<p style="padding-left: 60px;"><span style="font-family: times new roman,times;">Once you know which is correct, and once the code is written clearly, then you can easily determine which is faster in the common scenarios you face by using a profiler against realistic data.&nbsp; Remember, different string algorithms may be optimized for different scenarios.</span></p>
<p>&nbsp;The reason I found his "for example" to be so interesting is that the notion that <strong>Equals</strong> is not the same as <strong>Compare</strong> and the fact that virtually all of the developers and testers I talked to over the last few years did not come to the same conclusions.</p>
<p>In fact, it of often reported as a bug when the two techniques return different results.</p>
<p>Furthermore, even very experienced developers often use the wrong function, either for this issue of the <strong>lexicographic</strong> vs, <strong>linguistic</strong> issue, the <strong>invariant</strong> vs. <strong>ordinal</strong> issue, or the <strong>invariant</strong> vs. <strong>culture-specific</strong> issue.</p>
<p>And the astounding number of times that even old-timers will not only use the wrong results but will state equalities between these various&nbsp;different techniques that have consequences on correctness, performance, or security!</p>
<p><em>Simple searches in this blog will reveal several dozen articles on various aspects of those points.</em></p>
<p>The tendency of many developers to assume they are right is something we take for granted, and it only seems incongruous when they are wrong....</p>
<p>Just recently I was in a heated email conversation that was almost tending toward violence with someone's insistence that these differences did not exist, than these issues weren't issues.</p>
<p><em>For what it's worth, that person is now a regular reader who has asked many interesting follow-up questions by email. I think we both will end up a lot smrter at the other end of this "collaboration"....</em></p>
<p>Anyway, getting back to the response that interested me.</p>
<p>I knew Eric was smart before this. So it wasn't specifically him saying these things that caught my interest, exactly.</p>
<p>But now I find myself hoping that everyone can pick up this knowledge too, and that these questions will eventually seem&nbsp;as intuitive&nbsp;as the "easier"&nbsp;questions seem to be now.</p>
<p>We'll&nbsp;all seem a bit smarter when that happens.</p>
<p>And like <strong>Dogbert's New Ruling Class</strong>, my readers will have a head start.... :-)</p>
<hr/><p><strong>parkrrrr</strong> on 6 May 2011 10:30 AM:</p><div style="margin-left: 1em"><p>Dogbert&#39;s New Ruling Class. But the day you get your brain removed and turn into Scott Adams is the day I stop reading.</p>
</div>
<p><strong>JW</strong> on 6 May 2011 10:43 AM:</p><div style="margin-left: 1em"><p>It is funny that you bring the subject up. In my native language (dutch), there is no verb I can think of that has the same meaning as &#39;to equal&#39;. Rather, we use &#39;is the same as&#39;. However, &#39;to compare&#39; does have its own verb in &#39;vergelijken&#39;.</p>
<p>But, if I am to discuss the expression (a == b) in casual speech, I would likely use the same sort of speech I would use for (a &lt; b) or (a &gt; b): &#39;you would do that by comparing a to b in an if-statement.&#39; Sure, it is a very trivial example, but I feel the similarity exists even in English. :) Another example that works for both language is the concept of product and price comparison websites - no such concept of order there for the user.</p>
<p>Either way, this brings along the interesting fact that &#39;vergelijken&#39; has very little of an ordering context to it, and far more of an &#39;equalizing&#39; one. As such, what may be common sense to the former newbies such as yourself and the esteemed Eric Lippert, may not at all be that to others: even if they are as fluent in English as I am. (And although I&#39;d rather not go into the embarrasing subject: I find myself using english to dutch dictionaries when a dutch word escapes me. Go figure.)</p>
<p>[quote]Furthermore, even very experienced developers often use the wrong function, either for this issue of the lexicographic vs, linguistic issue, the invariant vs. ordinal issue, or the invariant vs. culture-specific issue.[/quote]</p>
<p>So, while I am sure you may have discussed it prior on this blog (and I apologize for not coming across it when I looked), I think I and others might benefit from a down-to-earth description of the differences in this list of things that do not equal eachother. (Do not compare sounds soo much better in that last sentence, don&#39;t you think?) There is MSDN I could look at but in my experience this is not the sort of thing it excels at explaining. Besides, you are the perfect person given your experience with languages, character sets and encodings; an expert of your domain - whereas documentation writers usually tend to be the sort that need to know a little bit of everything and as such do not always do the subject justice.</p>
<p>I hope you&#39;ll keep on blogging for a long time - you are a treasure trove of interesting information. :)</p>
</div>
<p><strong>Voo</strong> on 6 May 2011 12:56 PM:</p><div style="margin-left: 1em"><p>Okay as a silent reader of this blog, can someone relegate me to some post about compare(a,b)==0 != equals(a,b)? Because I personally always thought of that as a quite logical invariant (and made sure to not violate it in my own code) and don&#39;t see a reason where this wouldn&#39;t work out correctly.</p>
<p>@JW: Quite similar to German. &quot;vergleichen&quot; in my opinion also doesn&#39;t necessarily carry an ordering context with it. Those implicit assumptions about word connotations are often quite surprising for non-native speakers.</p>
</div>
<p><strong>Michael S. Kaplan</strong> on 6 May 2011 1:51 PM:</p><div style="margin-left: 1em"><p>You can start by searching for the words &quot;Compare Equals&quot;. You&#39;ll find lots of blogs like these two:</p>
<p><a rel="nofollow" target="_new" href="http://archives.miloush.net/michkap/archive/2005/11/22/495033.html">blogs.msdn.com/.../495033.aspx</a></p>
<p><a rel="nofollow" target="_new" href="http://archives.miloush.net/michkap/archive/2006/04/29/586726.html">blogs.msdn.com/.../586726.aspx</a></p>
<p>You can also search for &quot;invariant ordinal&quot; and you get lots there, too....</p>
</div>
<p><strong>Jeremy</strong> on 6 May 2011 6:01 PM:</p><div style="margin-left: 1em"><p>Your distinction between Compare and Equals seems a bit of a stretch to me (as a native en_US speaker). &nbsp;Compare is what you do, equals is one of the possible results of the comparison (the others being less than, greater than, and possibly null or error).</p>
<p>Consider std::set. &nbsp;We&#39;re talking about equality there, because it has to determine the uniqueness of the elements, but the interface is defined in terms of comparison (specifically less-than comparison) rather than equality. &nbsp;Perhaps a good topic for a future blog would be how to write a locale-dependant, case-insensitive comparator for std::set.</p>
</div>
<p><strong>rjcox</strong> on 8 May 2011 3:48 AM:</p><div style="margin-left: 1em"><p>@Jeremy</p>
<p>The C++ standard library defines equality in terms of std::less for /all/ comparisons, and the definitions (being a Standard) are stict: !std::less(a,b) &amp;&amp; !std::less(b,a) /is/ equality.</p>
<p>The key here is that &quot;equals&quot; and &quot;compare&quot; are defined more strictly that in English usage (however formal).</p>
</div>
<hr/><p><em>referenced by</em></p><div style="margin-left: 1em"><p>2011/05/10 <a href="http://archives.miloush.net/michkap/archive/2011/05/10/10162158.html">On Compare ≠ Equals, and the Relevance of both</a></p></div><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2011/05/09/10162156.html" title="The blame game is for the people in the cheap seats (and in the very expensive ones)">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2011/05/05/10161374.html" title="Worked like a dog trying to make Tuesday Wednesday? Maybe he just needed Windows. And Bollywood.">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2011-05">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2011-05-06">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2011/05/06/10161793.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:34 GMT -->
</html>