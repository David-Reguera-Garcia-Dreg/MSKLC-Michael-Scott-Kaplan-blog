<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2010/08/31/10056140.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:35 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>And how exactly do you justify those frigging kashidas?</title></head><body>
<h1>And how exactly do you justify those frigging kashidas?</h1>
<p><em>by Michael S. Kaplan, published on 2010/08/31 07:01 -04:00, original URI: http://blogs.msdn.com/b/michkap/archive/2010/08/31/10056140.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostNew -->
<p>Over in the Suggestion Box, DJPN asked:</p>
<p style="padding-left: 60px;"><span style="font-family: times new roman,times;"><em>Hi,<br /><br />could you describe the correct way, or maybe some ways ,of doing justification of text containing arabic characters.&nbsp; For instance, if I use ScriptJustify (using my home grown uniscribe-using library) and pass iMinKashida&gt;0 then it occasionally goes wrong when there are characters that have combining diacritic marks.&nbsp; I note that MS Word doesn't justify using kashidas.</em></span></p>
<p>Now in the past I have discussed kashidas before, in blogs like <a href="http://archives.miloush.net/michkap/archive/2010/01/26/9952907.html" title="On character justification (in *both* senses)"><strong>On character justification (in *both* senses)</strong></a> and <a href="http://archives.miloush.net/michkap/archive/2007/01/12/1454496.html" title="You've got to be kashidding me"><strong>You've got to be kashidding me</strong></a> and generally speaking unless you are doing all the work yourself, the <a href="http://msdn.microsoft.com/library/dd368558.aspx">ScriptJustify Function</a>is the way to "Kashidize" your text.</p>
<p>However, the iMinKashida, documented only as:</p>
<p style="padding-left: 30px;"><span style="font-family: times new roman,times;">Minimum width of a kashida glyph to generate.</span></p>
<p>is really just part of the story.</p>
<p>In fact if you look at the remarks, it notes that:</p>
<p style="padding-left: 60px;"><span style="font-family: times new roman,times;"><em>This function provides a simple implementation of multilingual justification. It establishes the amount of adjustment to make at each glyph position on the line. It interprets the SCRIPT_VISATTR array generated by a call to ScriptShape, giving top priority to kashida. The function uses interword spacing if no kashida points are available. It uses intercharacter spacing if no interword points are available.</em></span></p>
<p style="padding-left: 60px;"><span style="font-family: times new roman,times;"><em>Note&nbsp;&nbsp; Sophisticated text formatters might generate their own delta dx array by combining formatter-specific features with the information retrieved by ScriptShape in the SCRIPT_VISATTR array.</em></span></p>
<p style="padding-left: 60px;"><span style="font-family: times new roman,times;"><em>The application should pass the justified advance widths generated by ScriptJustify to ScriptTextOut in the piJustify parameter.</em></span></p>
<p style="padding-left: 60px;"><span style="font-family: times new roman,times;"><em>ScriptJustify creates a justified array containing updated advance widths for each glyph. When an advance width for a glyph is increased, the extra width is rendered to the right of the glyph, with a white space or, for Arabic text, a kashida.</em></span></p>
<p style="padding-left: 60px;"><span style="font-family: times new roman,times;"><em>Note&nbsp;&nbsp; Kashida insertion occurs to the right of the glyph to justify visually. Microsoft Word and Microsoft PowerPoint use this concept. Any change in the kashida placement algorithm should accompany a change in the corresponding ScriptTextOut handler for a particular script, for example, the Arabic TextOut justification handler.</em></span></p>
<p>Because&nbsp;is you modify the SCRIPT_VISATTR struct that you are going to pass in here, you will note that you can modify whether you want and/or expect to see kashidaas placed here quite easily by deciding whether psva-&gt;uJustification contains SCRIPT_JUSTIFY_ARABIC_KASHIDA or not or the other various interesting potential flags in the <a href="http://msdn.microsoft.com/en-us/library/dd374040.aspx">SCRIPT_JUSTIFY Enumeration</a>. Note for the particular case of diacritics, you know if there are diacritics present via psva-&gt;fDiacritic. What you do here can get pretty intricate!</p>
<p>Now I admit this isn't very well documented; about all I could find online is docs like <a href="http://maxradi.us/documents/uniscribe">Uniscribe: The Missing Documentation &amp; Examples</a>, which is a decent brain dump of some of the work in Google Chrome to support Uniscribe that kind of ignores this kind of issue in mixed text with specific suggestions that indicate not very much customization is happening there.</p>
<p>Doing this one yourself can be complicated. Though if you want to try it?</p>
<p>Going in with clear goals and good sample text to try different cutomizations out with could allow you to do some fairly impressive work that the default results might not do very well with....</p>
<p>Now once again this would be a great place for a Uniscribe sample. Though this one can be quite complicated to accomplish; if anyone makes the attempt and wants to discuss what they are finding, let me know and I'll writ it up in the future.</p>
<hr/><p><strong>John Cowan</strong> on 31 Aug 2010 7:16 AM:</p><div style="margin-left: 1em"><p>Nothing like making a typo in the title.</p>
</div>
<p><strong>Michael S. Kaplan</strong> on 31 Aug 2010 8:55 AM:</p><div style="margin-left: 1em"><p>There is having the nerve to fix it after several thousand views. :-)</p>
<p>What kind of stupid spell checker doesn&#39;t check the title?!?</p>
</div>
<p><strong>Brett Wilson</strong> on 31 Aug 2010 7:22 PM:</p><div style="margin-left: 1em"><p>Thanks for noticing my Chrome Uniscribe page! I enjoy reading your blog.</p>
<p>When implementing Uniscribe support in Chrome, I fount it to be somewhat of an odd match. It seems designed to support rather complicated applications using only Uniscribe for text layout. But applications with very advanced text layout needs are typically designed to handle a lot of these cases themselves. And any promise it had to support really interesting and complex cases is mostly killed by the general lack of documentation &amp; examples (as everybody notes).</p>
<p>Your comment about not being super advanced in terms of combining text is correct here. WebKit is handling a lot of this at a higher level. Justified text, for example, is done mostly at a higher level and in the &quot;complex script&quot; layer the job is mostly to just use up the space allocated to you. There are likely to be some sub-optimal cases of justification, but it seems to work quite well in general. I think the fanciest Uniscribe we did was adjusting the letter-spacing as controlled by the CSS letter-spacing attribute. At least when I wrote it, we were the only browser that did this correctly for things like Hebrew with vowel points. Of course, nobody does this because it looks stupid, so it ends up being a hollow victory.</p>
<p>I wonder if there are *any* applications that really use this stuff to its full potential? I (and I suspect many other programmers) would prefer something that makes it really easy to just get all the information out of the system, and maybe did a bit less mysterious stuff under the covers &quot;for us.&quot; Even though most of the information is available, it seems designed for &quot;living in Uniscibe&quot; rather than dropping into a advanced text layout engine like a browser. And something advanced like a browser seems like it would be the only use cases for some of the more advanced stuff.</p>
<p>Extreme example of this: Safari on Windows resorts to rendering Uniscibe to a WMF, then scanning the text version of that to see which fallback fonts were use for rendering certain text, because Uniscibe is helpfully &quot;handling it for you.&quot; Chrome&#39;s fallback code is somewhat different and doesn&#39;t do this.</p>
<p>PS: One thing I&#39;m still confused about is what you&#39;re supposed to do with pABC from ScriptPlace (I talk about this on my page). Any pointers?</p>
</div>
<hr/><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2010/09/01/10056685.html" title="Those chars aren&#39;t the UTF-8 you&#39;re looking for. Move along...">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2010/08/30/10055550.html" title="A difference that makes no difference shouldn&#39;t make a difference, but...">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2010-08">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2010-08-31">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2010/08/31/10056140.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:35 GMT -->
</html>