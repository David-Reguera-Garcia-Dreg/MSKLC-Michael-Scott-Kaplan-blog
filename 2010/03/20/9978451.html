<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2010/03/20/9978451.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:35 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>Watch your language, Michael! (aka What the @#%&*! is an Elevated Command Prompt?)</title></head><body>
<h1>Watch your language, Michael! (aka What the @#%&*! is an Elevated Command Prompt?)</h1>
<p><em>by Michael S. Kaplan, published on 2010/03/20 07:01 -04:00, original URI: http://blogs.msdn.com/b/michkap/archive/2010/03/20/9978451.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostNew -->
<P><EM>No, this is not a log about my misuse of the language of Shakespeare and Chaucer. Or about my use of the words of curse, which has been on the decline recently anyway, thank you!</EM></P>
<P>One of the downsides of working principally on Microsoft technologies is that you find yourself speaking a dialect that not everyone else will readily understand.</P>
<P>This is even worse if you work for Microsoft, since the insulation from all that is not Microsoft will just naturally be thicker.</P>
<P>And if you work for a specific product whose primary focus is on a single version, like Windows, then the&nbsp;shielding can be legion. If you know what I mean.</P>
<P>I'll give you an example.</P>
<P>In Vista&nbsp;a feature was&nbsp;added, a feature that most people feel was made much more useful/usable in Windows 7.</P>
<P>The controversial feature known as UAC (User Account Control?) or LUA (Limited User Access?). Basically a way to keep you from doing things that you can only do as an administrator unless you really intended to do so.</P>
<P>As a choice bit of irony, I found this to be much worse in Vista than Mac OS X but much worse there than in Windows 7. But that is a blog for another day. Or maybe never....</P>
<P>Anyway, I was going to talk about UAC/LUA for a minute.</P>
<P>There are many overt acts that have come up in the past&nbsp;like <STRONG>running the setup for App Locale</STRONG> or <STRONG>installing MSKLC 1.3</STRONG> or <STRONG>adding a Table Text Service TIP</STRONG> to Windows.</P>
<P>And when you do so, it is either easier or in some cases only possible if you are running from a command prompt that has received this approval from the user -- this approval to be like an administrator type person.</P>
<P>Now what this is generally referred to by the aforementioned subset of people I mentioned as an <STRONG>elevated command prompt</STRONG>.</P>
<P>I have used this phrase many times, as you can see in a simple search <A href="http://www.bing.com/search?q=site%3Ablogs.msdn.com%2Fmichkap+%22elevated+command+prompt%22&amp;form=QBLH&amp;qs=n&amp;sc=1-53" target=_blank mce_href="http://www.bing.com/search?q=site%3Ablogs.msdn.com%2Fmichkap+%22elevated+command+prompt%22&amp;form=QBLH&amp;qs=n&amp;sc=1-53">here</A>.</P>
<P>Now in almost every case my intent was that people use the simple UI you get by right-clicking a command Prompt shortcut:</P>
<P><IMG style="WIDTH: 393px; HEIGHT: 373px" title="Run as administrrator" alt="Run as administrrator" src="http://trigeminal.fmsinc.com/images/elevated.jpg" width=393 height=373 mce_src="http://trigeminal.fmsinc.com/images/elevated.jpg"></P>
<P>You know, the one that says <STRONG>Run as <U>a</U>dministrator</STRONG>, which will cause there to be an <STRONG>elevated command prompt</STRONG>.</P>
<P>If you click on it, you will be prompted to make&nbsp;sure you really wanted to do that. If you say YES then the command prompt will indicate its "Admin-ness":</P>
<P><IMG style="WIDTH: 677px; HEIGHT: 342px" src="http://trigeminal.fmsinc.com/images/administrator1.jpg" width=677 height=342 mce_src="http://trigeminal.fmsinc.com/images/administrator1.jpg"></P>
<P mce_keep="true">Anything you run from within that command prompt will now be run as if you are an administrator. So you can do these varous tasks I was talking about....</P>
<P>I had been calling it an "elevated command prompt" since Vista was called Longhorn so it never occurred to me that people might no know what this meant.</P>
<P>But if you look in the comments to some if those blogs, people often just skipped that bit and proceeded on, not realizing that this step was crucial for the support to work.</P>
<P>It was made a bit harder in the case of <STRONG>Table Text Service Tip installation</STRONG> since it would appear to work but the registry keys were put in a virtual store that was not used for the component. :-(</P>
<P>I don't know what the whole virtual store thing is really supposed to work for, but for these kinds of machine-wide, cross-process, permanent settings, it falls down rather quickly....</P>
<P>In fact, I think it is why good people like Andrew West are having trouble in Windows 7 (see the comments of <A href="http://archives.miloush.net/michkap/archive/2010/01/21/9951284.html" mce_href="http://archives.miloush.net/michkap/archive/2010/01/21/9951284.html"><STRONG>Can't I pick the candidate list font if I don't speak fluent square box?</STRONG></A> for context) in some cases...</P>
<P>Anyway, from now on I will&nbsp;recommend to people when I need them to use an elevated command prompt <STRONG>to point to this topic</STRONG>, or even better to give more detailed instructions that don't assume people will know my bizarre dialect of English....</P>
<hr/><p><strong>Andrew West</strong> on 21 Mar 2010 10:01 AM:</p><div style="margin-left: 1em"><p>D'oh, my bad -- sure enough when I run an elevated command prompt my input method installs just fine, and to my delight it uses my PUA Tangut font as specified in the source file, so I can actually see what I am typing now. Thanks so much for sorting it all out for me!</p></div>
<p><strong>Michael S. Kaplan</strong> on 21 Mar 2010 11:42 AM:</p><div style="margin-left: 1em"><p>Dude, this wasn't you -- many people had the same problem. And when I am trying to communicate ideas (which is generally what I do here!) then something not communicated properly is on me. :-)</p>
<p>But I am glad it worked out, and that I learned something too....</p>
</div>
<p><strong>Mike Dimmick</strong> on 22 Mar 2010 7:30 AM:</p><div style="margin-left: 1em"><p>The virtual store is meant to work for applications like Sage Accounts which are still writing to files and registry keys in protected areas, and can't be configured not to.</p>
<p>The underlying problem is that the way everyone used Windows Installer was different from how it was intended to be used. Specifically in the area of Custom Actions.</p>
<p>The Master Plan for Windows Installer was that packages would be registered somehow with a directory, 'advertised' to non-admin users by giving dummy icons on their Start Menus or desktops, and that users that needed to use those packages could simply click the advertised icon. The dummy icon leads to Windows Installer which installs the required feature from the advertised package.</p>
<p>Therefore Custom Actions are marked as Impersonated (runs using the user's credentials) or not (running with LocalSystem credentials). In the Master Plan, Impersonated actions don't have admin rights but can tweak the user's profile, while non-impersonated actions can't access the user's profile but can change the system.</p>
<p>In practice, most packages were designed and tested with the assumption that the user runs the package interactively, and has administrative rights. Therefore the impersonated actions *do* have admin rights, on Windows XP/2003 and before.</p>
<p>On Windows Vista and 7, with UAC, the impersonated custom actions get the rights of the token as the installer package was run. That is, if run from a non-elevated program (e.g. Explorer) they don't get admin rights, whereas from an elevated command prompt they *do* get admin rights. If you're having a problem, you need to mark the Custom Action as being non-Impersonated - binary OR the Type value in the CustomAction table with 2048 (msidbCustomActionTypeNoImpersonate).</p>
<p>Many Windows Installer authoring tools use custom actions where they shouldn't (duplicating some built-in feature of Windows Installer) and/or mark them as Impersonated by default. .NET's installer classes are usually configured incorrectly by Visual Studio (at least through 2005). Try to avoid Installer classes - the Windows Installer team's official position is that managed code custom actions are not supported. (WiX now includes Deployment Tools Foundation, a framework for writing custom actions in managed code, that runs the custom action code out-of-process rather than in-process as the Visual Studio installer code does.)</p>
</div>
<hr/><p><em>referenced by</em></p><div style="margin-left: 1em"><p>2010/05/13 <a href="http://archives.miloush.net/michkap/archive/2010/05/13/9993808.html">Minimalism isn't laziness, really; it's trying to do the job right without side effects!</a></p></div><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2010/03/21/9980256.html" title="How many presidents can you fit in a SQL Server database?">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2010/03/19/9980203.html" title="Strange how unsympathetic I was, until I was suddenly quite sympathetic">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2010-03">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2010-03-20">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2010/03/20/9978451.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:35 GMT -->
</html>