<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2010/03/09/9975184.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:35 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>Coloring outside the lines in the a-ness of the Hungarian Technical Sort</title></head><body>
<h1>Coloring outside the lines in the a-ness of the Hungarian Technical Sort</h1>
<p><em>by Michael S. Kaplan, published on 2010/03/09 07:01 -05:00, original URI: http://blogs.msdn.com/b/michkap/archive/2010/03/09/9975184.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostNew -->
<P><STRONG><FONT color=#ff0000><EM>There is almost Beavis/Butthead joke in the title of this blog, isn't there? </EM>:-)</FONT></STRONG></P>
<P>After, in the course of blogging,&nbsp;I blogged that blog on this Blog entitled <A href="http://archives.miloush.net/michkap/archive/2010/03/06/9972239.html" mce_href="http://archives.miloush.net/michkap/archive/2010/03/06/9972239.html"><STRONG>Burn Windows Burn (aka If we want to unsay *this* one, we cannot say "Mu")</STRONG></A>, regular reader and colleague and friend Mihai <A href="http://archives.miloush.net/michkap/archive/2010/03/06/9972239.html#9974942" mce_href="http://archives.miloush.net/michkap/archive/2010/03/06/9972239.html#9974942">commented</A>:</P>
<BLOCKQUOTE>
<P><FONT face="times new roman,times">There are other funny things about Hungarian technical sort when mixing the wide versions of the characters.</FONT></P>
<P><FONT face="times new roman,times">Below I will use the wide versions (U+FF21 and U+FF41) at left, and regular versions (U+0041 &amp; U+0061) at right.</FONT></P>
<P><FONT face="times new roman,times">hu-HU_technl:</FONT></P>
<P><FONT face="consolas,lucida console,courier new,courier,FIXED"><STRONG>&nbsp; &nbsp; ａ &lt; a<BR>&nbsp;&nbsp;&nbsp; ａ &gt; A<BR>&nbsp; &nbsp; Ａ &gt; A<BR>&nbsp;&nbsp;&nbsp; Ａ &gt; a</STRONG></FONT></P>
<P><FONT face="times new roman,times">Ignore NORM_IGNOREWIDTH:</FONT></P>
<P><FONT face="consolas,lucida console,courier new,courier,FIXED"><STRONG>&nbsp; &nbsp; ａ &lt; a<BR>&nbsp; &nbsp; ａ == A<BR>&nbsp; &nbsp; Ａ == a<BR>&nbsp; &nbsp; Ａ &gt; A</STRONG></FONT></P>
<P><FONT face="times new roman,times">hu-HU seem to behave as expected.</FONT></P>
<P><FONT face="times new roman,times">(All on Win 7)</FONT><BR></P></BLOCKQUOTE>
<P>Now this is all essentially by design, sort of. Because the Hungarian Technical Sort only defines what is done with the specific characters that are generally used in Hungarian. So if you move some characters around and not others, then you will get such anomalies any time you compare characters from both sets (the modified ones and the unmodified ones).</P>
<P>This has even caused specific problems before any time the defined subset is incomplete, as discussed in blogs like <A href="http://archives.miloush.net/michkap/archive/2005/08/27/457224.html" mce_href="http://archives.miloush.net/michkap/archive/2005/08/27/457224.html"><STRONG>Vietnamese is a complex language on Windows</STRONG></A>&nbsp;and&nbsp;<A href="http://archives.miloush.net/michkap/archive/2008/03/26/8337198.html" mce_href="http://archives.miloush.net/michkap/archive/2008/03/26/8337198.html"><STRONG>Vietnamese still ain't quite right</STRONG></A> that show how the same problem with the underlying cause of the subset being incomplete simply makes the results look wrong -- but wrong in a way that does not help someone outside of the process easily discern the nature of the problem (or even help them describe it in a meaningful way to help report it, sometimes!).</P>
<P>Now this problem has come up kind of on th sidelines, as it were, both when it isn't a bug like in blogs such as <A href="http://archives.miloush.net/michkap/archive/2007/07/31/4154107.html" mce_href="http://archives.miloush.net/michkap/archive/2007/07/31/4154107.html"><STRONG>See that version there? It is going down, man! #2 (aka Everybody WYNNs)</STRONG></A>, and when it is a bug like in blogs such as <A href="http://archives.miloush.net/michkap/archive/2007/07/31/4155336.html" mce_href="http://archives.miloush.net/michkap/archive/2007/07/31/4155336.html"><STRONG>If this post really describes a bug, would I actually put it in the WYNN column?</STRONG></A>.</P>
<P>Getting back to Hungarian and the Hungarian Technical Sort for a moment, my blog about it (<A href="http://archives.miloush.net/michkap/archive/2005/11/26/495072.html" mce_href="http://archives.miloush.net/michkap/archive/2005/11/26/495072.html"><STRONG>Technically it *is* a hungarian sort</STRONG></A>) didn't tell the whole story.</P>
<P>In it, I gave three characteristics of the sort:</P>
<UL>
<LI><FONT face=Tahoma>None of the compressions that I have talked about <STRONG><A href="http://archives.miloush.net/michkap/archive/2005/07/17/439742.html" mce_href="http://archives.miloush.net/michkap/archive/2005/07/17/439742.html">previously</A></STRONG></FONT> 
<LI><FONT face=Tahoma>None of those Hungarian double compressions, either</FONT> 
<LI><FONT face=Tahoma>The uppercase letters come before the lowercase ones, </FONT><A href="http://archives.miloush.net/michkap/archive/2005/11/13/492179.html" mce_href="http://archives.miloush.net/michkap/archive/2005/11/13/492179.html"><STRONG>unlike most other language</STRONG></A><FONT face=Tahoma>&nbsp;collations on Microsoft products</FONT></LI></UL>
<P>But there is a fourth characteristic that I did not mention:</P>
<UL>
<LI>All of the letters with diacritics in Hungarian that are given secondary distinctions from the same letters without are, in this alternate sort, given primary distinctions</LI></UL>
<P>Because of this, letters like <STRONG>Á</STRONG> (U+00c1, aka LATIN CAPITAL LETTER A WITH ACUTE), which would be sorted as a variation of <STRONG>A </STRONG>with a secondary distinction are treated like they are unique letters with the same kind of standing as <STRONG>B</STRONG> or any other letter.</P>
<P>Taking a quick look at the "A-type letters" or alternately the "letters with A-ness" in the Hungarian Technical Sort (via those same tables I mentioned <A href="http://archives.miloush.net/michkap/archive/2010/02/21/9966915.html" mce_href="http://archives.miloush.net/michkap/archive/2010/02/21/9966915.html"><STRONG>here</STRONG></A>):</P>
<BLOCKQUOTE>
<P><FONT face="consolas,lucida console,courier new,courier,FIXED"><STRONG>0x0041&nbsp;14&nbsp;2&nbsp;2&nbsp;2 &nbsp; ;LATIN CAPITAL LETTER A<BR>0x0061&nbsp;14&nbsp;2&nbsp;2&nbsp;18 &nbsp;;LATIN SMALL LETTER A<BR>0x00c1&nbsp;14&nbsp;<FONT color=#ff0000>3</FONT>&nbsp;2&nbsp;2 &nbsp; ;LATIN CAPITAL LETTER A WITH ACUTE<BR>0x00e1&nbsp;14&nbsp;<FONT color=#ff0000>3</FONT>&nbsp;2&nbsp;18 &nbsp;;LATIN SMALL LETTER A WITH ACUTE<BR>0x00c2&nbsp;14&nbsp;<FONT color=#ff0000>4</FONT>&nbsp;2&nbsp;2 &nbsp; ;LATIN CAPITAL LETTER A WITH CIRCUMFLEX<BR>0x00e2&nbsp;14&nbsp;<FONT color=#ff0000>4</FONT>&nbsp;2&nbsp;18 &nbsp;;LATIN SMALL LETTER A WITH CIRCUMFLEX<BR>0x00c4&nbsp;14&nbsp;<FONT color=#ff0000>5</FONT>&nbsp;2&nbsp;2 &nbsp; ;LATIN CAPITAL LETTER A WITH DIAERESIS<BR>0x00e4&nbsp;14&nbsp;<FONT color=#ff0000>5</FONT>&nbsp;2&nbsp;18 &nbsp;;LATIN SMALL LETTER A WITH DIAERESIS<BR>0x0102&nbsp;14&nbsp;<FONT color=#ff0000>6</FONT>&nbsp;2&nbsp;2 &nbsp; ;LATIN CAPITAL LETTER A WITH BREVE<BR>0x0103&nbsp;14&nbsp;<FONT color=#ff0000>6</FONT>&nbsp;2&nbsp;18 &nbsp;;LATIN SMALL LETTER A WITH BREVE<BR>0x0104&nbsp;14&nbsp;<FONT color=#ff0000>7</FONT>&nbsp;2&nbsp;2 &nbsp; ;LATIN CAPITAL LETTER A WITH OGONEK<BR>0x0105&nbsp;14&nbsp;<FONT color=#ff0000>7</FONT>&nbsp;2&nbsp;18&nbsp; ;LATIN SMALL LETTER A WITH OGONEK</STRONG></FONT></P></BLOCKQUOTE>
<P>Now these are the only letters with any kind of a-ness that this sort will flip the capitalization of. Note how each one has it's own unique alphabetic weight (AW), in red.</P>
<P>Now note that this will not break for Normalization Form D since each of these letters had their compression versions added too:</P>
<BLOCKQUOTE>
<P><STRONG><FONT face="consolas,lucida console,courier new,courier,FIXED">0x0041&nbsp;0x0301&nbsp;14&nbsp;3&nbsp;2&nbsp;2&nbsp; &nbsp;;A With Acute<BR>0x0061&nbsp;0x0301&nbsp;14&nbsp;3&nbsp;2&nbsp;18 &nbsp;;a With Acute<BR>0x0041&nbsp;0x0302&nbsp;14&nbsp;4&nbsp;2&nbsp;2&nbsp; &nbsp;;A With Circumflex<BR>0x0061&nbsp;0x0302&nbsp;14&nbsp;4&nbsp;2&nbsp;18&nbsp; ;a With Circumflex<BR>0x0041&nbsp;0x0308&nbsp;14&nbsp;5&nbsp;2&nbsp;2&nbsp; &nbsp;;A With Diaeresis<BR>0x0061&nbsp;0x0308&nbsp;14&nbsp;5&nbsp;2&nbsp;18&nbsp; ;a With Diaeresis<BR>0x0041&nbsp;0x0306&nbsp;14&nbsp;6&nbsp;2&nbsp;2&nbsp; &nbsp;;A With Breve<BR>0x0061&nbsp;0x0306&nbsp;14&nbsp;6&nbsp;2&nbsp;18&nbsp; ;a With Breve<BR>0x0041&nbsp;0x0328&nbsp;14&nbsp;7&nbsp;2&nbsp;2&nbsp; &nbsp;;A With Ogonek<BR>0x0061&nbsp;0x0328&nbsp;14&nbsp;7&nbsp;2&nbsp;18&nbsp; ;a With Ogonek</FONT></STRONG></P></BLOCKQUOTE>
<P>So everything is good, right?</P>
<P>But wait.</P>
<P>What about the letter A combined with other diacritics not on this&nbsp;small&nbsp;list (there are dozens commonly in use)?</P>
<P>Here is the table data of a bunch of those same characters and a few others nearby, including a symbol or two:</P>
<BLOCKQUOTE>
<P><FONT face="consolas,lucida console,courier new,courier,FIXED"><STRONG>0x0061&nbsp;14&nbsp;2&nbsp;2&nbsp; 2&nbsp; &nbsp;;LATIN SMALL LETTER A<BR>0xff41&nbsp;14&nbsp;2&nbsp;2&nbsp; 3&nbsp; &nbsp;;FULLWIDTH LATIN SMALL LETTER A<BR>0x0041&nbsp;14&nbsp;2&nbsp;2&nbsp; 18&nbsp; ;LATIN CAPITAL LETTER A<BR>0xff21&nbsp;14&nbsp;2&nbsp;2&nbsp; 19 &nbsp;;FULLWIDTH LATIN CAPITAL LETTER A<BR>0x00e1&nbsp;14&nbsp;2&nbsp;14&nbsp;2 &nbsp; ;LATIN SMALL LETTER A WITH ACUTE<BR>0x00c1&nbsp;14&nbsp;2&nbsp;14&nbsp;18 &nbsp;;LATIN CAPITAL LETTER A WITH ACUTE<BR>0x00e0&nbsp;14&nbsp;2&nbsp;15&nbsp;2&nbsp; &nbsp;;LATIN SMALL LETTER A WITH GRAVE<BR>0x00c0&nbsp;14&nbsp;2&nbsp;15&nbsp;18&nbsp; ;LATIN CAPITAL LETTER A WITH GRAVE<BR>0x0227&nbsp;14&nbsp;2&nbsp;16&nbsp;2&nbsp;&nbsp; ;LATIN SMALL LETTER A WITH DOT ABOVE<BR>0x0226&nbsp;14&nbsp;2&nbsp;16&nbsp;18&nbsp; ;LATIN CAPITAL LETTER A WITH DOT ABOVE<BR>0x00e2&nbsp;14&nbsp;2&nbsp;18&nbsp;2&nbsp; &nbsp;;LATIN SMALL LETTER A WITH CIRCUMFLEX<BR>0x00c2&nbsp;14&nbsp;2&nbsp;18&nbsp;18&nbsp; ;LATIN CAPITAL LETTER A WITH CIRCUMFLEX<BR>0x00e4&nbsp;14&nbsp;2&nbsp;19&nbsp;2&nbsp; &nbsp;;LATIN SMALL LETTER A WITH DIAERESIS<BR>0x00c4&nbsp;14&nbsp;2&nbsp;19&nbsp;18 &nbsp;;LATIN CAPITAL LETTER A WITH DIAERESIS<BR>0x01ce&nbsp;14&nbsp;2&nbsp;20&nbsp;2&nbsp; &nbsp;;LATIN SMALL LETTER A WITH CARON<BR>0x01cd&nbsp;14&nbsp;2&nbsp;20&nbsp;18 &nbsp;;LATIN CAPITAL LETTER A WITH CARON<BR>0x0103&nbsp;14&nbsp;2&nbsp;21&nbsp;2&nbsp; &nbsp;;LATIN SMALL LETTER A WITH BREVE<BR>0x0102&nbsp;14&nbsp;2&nbsp;21&nbsp;18&nbsp; ;LATIN CAPITAL LETTER A WITH BREVE<BR>0x0101&nbsp;14&nbsp;2&nbsp;23&nbsp;2&nbsp;&nbsp; ;LATIN SMALL LETTER A WITH MACRON<BR>0x0100&nbsp;14&nbsp;2&nbsp;23&nbsp;18&nbsp; ;LATIN CAPITAL LETTER A WITH MACRON<BR>0x00e3&nbsp;14&nbsp;2&nbsp;25&nbsp;2&nbsp; &nbsp;;LATIN SMALL LETTER A WITH TILDE<BR>0x00c3&nbsp;14&nbsp;2&nbsp;25&nbsp;18 &nbsp;;LATIN CAPITAL LETTER A WITH TILDE<BR>0x00e5&nbsp;14&nbsp;2&nbsp;26&nbsp;2&nbsp;&nbsp; ;LATIN SMALL LETTER A WITH RING ABOVE<BR>0x00c5&nbsp;14&nbsp;2&nbsp;26&nbsp;18 &nbsp;;LATIN CAPITAL LETTER A WITH RING ABOVE<BR>0x212b&nbsp;14&nbsp;2&nbsp;26&nbsp;26&nbsp; ;ANGSTROM SIGN<BR>0x0105&nbsp;14&nbsp;2&nbsp;27&nbsp;2&nbsp; &nbsp;;LATIN AMALL LETTER A WITH OGONEK<BR>0x0104&nbsp;14&nbsp;2&nbsp;27&nbsp;18&nbsp; ;LATIN CAPITAL LETTER A WITH OGONEK</STRONG></FONT></P></BLOCKQUOTE>
<P>With Normalization Form D they will have their uppercase&nbsp;forms precede their lowercase ones (since the sort fixes the base characters), while in Form C (and the fullwidth case Mihai mentioned) they won't.</P>
<P>The Microsoft collation story fails pretty firmly in such cases where you are not in the default table and you color outside the lines drawn for the particular scenario of the language?</P>
<P>Is this&nbsp;a bug?</P>
<P>I mean, the design goals of universal consistency pretty much stop with the default table - beyond that, such anomalies seem kind of by design. </P>
<P>But should that be the case? Fixing this would require either a design change or a huge explosion of the table size and a ton of testing either way. And all to support a bunch of scenarios which are undeniably not required by normal users. </P>
<P>That's a tough sell just to fix up the a-ness of Windows collation....</P>
<hr/><p><strong>Mihai</strong> on 10 Mar 2010 10:38 AM:</p><div style="margin-left: 1em"><p>Bug or not, I don't know.</p>
<p>One man's bug is another man's feature :-)</p>
<p>It probably doesn't affect anyone.</p>
<p>But somehow I would expect that when one uses NORM_IGNOREWIDTH then ａ == a and Ａ == A no matter the language.</p>
<p>Worth fixing for the 3 Hungarians that might be bothered by this once in 2 years? Probably not :-)</p></div>
<p><strong>Michael S. Kaplan</strong> on 10 Mar 2010 6:02 PM:</p><div style="margin-left: 1em"><p>Of course this bug is one example, there are many others. It is an interesting question, one I'd be tempted take up if I still worked in the area, as I have some thoughts on how it could be approached....</p>
</div>
<hr/><p><em>referenced by</em></p><div style="margin-left: 1em"><p>2010/07/13 <a href="http://archives.miloush.net/michkap/archive/2010/07/13/10037608.html">I swear the Latvian bug is fixed; it was fixed 4.5 years ago!</a></p></div><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2010/03/10/9976075.html" title="They pushed out of the formatt[ing|er]">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2010/03/08/9973914.html" title="Where&#39;d *that* name come from anyway?">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2010-03">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2010-03-09">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2010/03/09/9975184.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:35 GMT -->
</html>