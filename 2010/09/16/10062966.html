<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2010/09/16/10062966.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:35 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>Providing more information is the best way to assure correct information is received</title></head><body>
<h1>Providing more information is the best way to assure correct information is received</h1>
<p><em>by Michael S. Kaplan, published on 2010/09/16 07:01 -04:00, original URI: http://blogs.msdn.com/b/michkap/archive/2010/09/16/10062966.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostNew -->
<p>I thought a small amount of information on PDF and Unicode might make sense as a bit of&nbsp;introductory material for some of the blogs I have already written. :-)</p>
<p><em>I owe a a great deal of the centralization of the Unicode question in PDF to information from Leonard Rosenthol of Adobe, since although I knew about most of this, I was often missing correct terms and never thought about them in such a good framework of comparison until after communicating to him. Anything incorrect here is probably my fault, though!</em></p>
<p>Now there are three basic ways for Unicode data to be in PDF. And really any one, or two, or all three of these methods can be there.</p>
<p><strong>The first method </strong>is storage of the font encoding information itself (in TTF &amp; OTF). Any effort to properly display Unicode data will include this information, which can make it one of the "easiest" pieces of information to include if you are an application that is doing the work to use the font information to display the text. If you are not such an application creating PDF then it is not something you would likely have -&nbsp;but if you are doing the work to render information in an application then it can be some easily available information to include.</p>
<p>Reverse engineering from that information is obviously quite possible, though I like to think of it as being a way to extract <strong>essentially equivalent</strong> text, since there are cases -- from Unicode normalization and the way choices are made to favor composed glyphs, as well as other such mappings -- that the text you would get back from using only this data may not be exactly what was originally in the document. This is similar to the issue I pointed out in <a href="http://archives.miloush.net/michkap/archive/2007/09/24/5082103.html" title="Documented, schmockumented! It's still kind of cool...."><strong>Documented, schmockumented! It's still kind of cool....</strong></a>&nbsp;but easier since one has more information available to do the reversal if one has this information.</p>
<p>The distinction should not matter in most cases, especially if you have the same fonts as were used in creating the orginal PDFs. But in cases where you don't have the exact same fonts there can be subtle differences that might matter to you.</p>
<p>Although this is the easiest way to store "Unicode" data in the PDF since it is for the most part just embedding the work you had to do anyway to render, it is not always the easiest way to extract text, however. It can be easy to get it wrong when you do that extraction.</p>
<p><strong>The second method</strong> is the ToUnicode table, which is what it sounds like -- the actual Unicode data, with regular pointers (indexes into the text) so the data in&nbsp;the PDF information is directly referencing Unicode data. Depending on what data is stored, you can choose what data will be able to be extracted rather directly.</p>
<p>Now this give a great opportunity to work around some of the potential problems with the font encoding information, obviously (since you are putting actual Unicode text in there you are choosing what goes there). Of course a PDF writer can put in information with the same kinds of transformations as well, but it is the opportunity to do better that is interesting.</p>
<p>I have seen examples where a document would use Arabic compatibility characters -- for more on these see&nbsp;blogs like <a href="http://archives.miloush.net/michkap/archive/2005/10/07/478127.html"><strong><span style="font-family: Tahoma; color: #006bad;">It Does Not Always Pay to be Compatible</span></strong></a><span style="font-family: Tahoma;">&nbsp;and </span><a href="http://archives.miloush.net/michkap/archive/2005/12/02/498889.html"><strong><span style="font-family: Tahoma; color: #006bad;">Getting out of dodge (or at least out of the compatibility range!)</span></strong></a>&nbsp;-- and the PDF's font encoding information would have the same thing, but the ToUnicode table would have the real Unicode Arabic characters. This sort of thing is a great way to help with searching algorithms that scan PDFs so is not an unreasonable way to go here depending on the ultimate goal of the PDF itself.</p>
<p>This is not the most common way to go though -- the thing you will most often see in a ToUnicode table is the original text. If you have it anyway, it is easy to add. </p>
<p>The only "hit" to storing both is the size increase of the PDF. As Leonard specifically suggested to me, "...they require the least amount of work as the information is associated with the font itself and the page content need not be impacted. For most things, these should be sufficient..."</p>
<p><strong>The third method</strong>is&nbsp;the ActualText tag.&nbsp;This is the magical way to provide easy shortcuts to the exact data to get back when there are contextual glyphs in the PDF. </p>
<p>Now obviously you can in theory get the same information from either of the previous two methods (which is good because they are the most common!), but in the case of documents with many conceptual glyphs (only some of which might also be in Unicode, though in most cases when they are in Unicode they are compatibility characters as most of these contextual glyphs are things like the conjuncts you might see in Sanskrit, and so on -- special forms of text that can often represent explicit choices on the part of a font.</p>
<p>A great example of this is something I talked about in <a href="http://archives.miloush.net/michkap/archive/2010/07/16/10038421.html" title="Which form to use if the form keeps changing?"><strong>Which form to use if the form keeps changing?</strong></a>. Judicious use of the ActualText tag can effectively preserve these distinctions without requiring special processing to get the actual text back, something that can be required if you rely on the ToUnicode table to try get the information back.</p>
<p>When you think about cases like the "Ferrari" scenario of <a href="http://archives.miloush.net/michkap/archive/2010/09/06/10057561.html" title="Acrobat PDF: the Yugo vs. the BMW vs. the Ferrari"><strong>Acrobat PDF: the Yugo vs. the BMW vs. the Ferrari</strong></a>&nbsp;(for example), it is easy to see how not including good ActualText can make it easy to mess up cases like glyph reordering. I like to think of the ActualText (when it is available, which is comparatively rare since it does require extra work to create well) as a great list of shortcuts to get information that would otherwise be more difficult to get well.</p>
<p>And the bugs that appear in even the most sophisticated tools tend to bear me out on this opinion; things are incorrect often enough that including this data more often would be one of the best ways to get good results back. Though this does assume that PDF readers will make use of the information (not all of them do!), my general feeling is that providing more information is the best way to assure correct information is received.</p>
<p>Now, if you have PDF reading tools that can look at all of this information you can do a lot of forensic PDF work to determine the actual cause of many of the bugs that exist in PDFs today, especially for complex script cases. But forensic PDF work is really only interesting to two groups of people:</p>
<ul>
<li>Those fixing the bugs, and</li>
<li>Those trying to get correct, searchable&nbsp;data out of PDF despite the bugs.</li>
</ul>
<p>I tend to find both such processes to be <strong>very noble goals</strong> whenever they are identified, though unfortunately both tend to be a lot rarer than I would like....</p>
<hr/><p><strong>Joe Clark</strong> on 29 Sep 2010 12:56 PM:</p><div style="margin-left: 1em"><p>The problem with Leonard’s diagnosis is that you are not dealing with two character-encoding environments within a PDF, one that’s broken (the default) and one that works (ActualText). In your ActualText tag, which is in fact meant for drop caps and the like, you are using the same character encoding at work everywhere else in the PDF.</p>
<p>A PDF that has trouble with decompositions or complex scripts will have that same trouble inside ActualText because the problem is endemic to PDF. There isn’t a little panic room inside PDF you can hide complex text in.</p>
<p>Adobe, in one guise or another, has known about this for years but failed to fix it, in part because fixing it is horrendously complicated by even my estimation. PDFs work reliably in Latin-script languages, Japanese and Chinese (horizontal text only), and hugely simplified RTL text – and in no other scripts.</p>
</div>
<p><strong>Michael S. Kaplan</strong> on 29 Sep 2010 1:07 PM:</p><div style="margin-left: 1em"><p>I believe it *can* work well here though -- it just usually doesn&#39;t.</p>
</div>
<p><strong>Michael S. Kaplan</strong> on 29 Sep 2010 1:23 PM:</p><div style="margin-left: 1em"><p>An example of where PDF works -- Powerpoint 2010 --&gt; PDF via the built-in conversion, works perfectly.</p>
</div>
<hr/><p><em>referenced by</em></p><div style="margin-left: 1em"><p>2010/09/29 <a href="http://archives.miloush.net/michkap/archive/2010/09/29/10069077.html">Dotting the t's and crossing the i's is more work than that, PDF edition</a></p></div><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2010/09/17/10063606.html" title="{Insert appropriate pun/allusion to &#39;When I&#39;m 64&#39; here}">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2010/09/15/10062047.html" title="How to format? What locale?">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2010-09">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2010-09-16">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2010/09/16/10062966.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:35 GMT -->
</html>