<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2010/01/27/9953946.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:35 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>We do seem to be short on time... (Windows 7 edition)</title></head><body>
<h1>We do seem to be short on time... (Windows 7 edition)</h1>
<p><em>by Michael S. Kaplan, published on 2010/01/27 07:01 -05:00, original URI: http://blogs.msdn.com/b/michkap/archive/2010/01/27/9953946.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostNew -->
<P>The question was easy enough:</P>
<BLOCKQUOTE>
<P><FONT face="times new roman,times"><EM>Hi,</EM></FONT></P>
<P><FONT face="times new roman,times"><EM>I am trying to use the GetTimeFormat to retrieve the Time format from the system. Win7 added the new customized format. How can I get the format(as in the attached image)?<BR><BR><IMG style="WIDTH: 858px; HEIGHT: 663px" border=1 src="http://trigeminal.fmsinc.com/images/shorttime.jpg" width=858 height=663 mce_src="http://trigeminal.fmsinc.com/images/shorttime.jpg"><BR><BR>Which Locale ID should I use?</EM></FONT></P>
<P><FONT face="times new roman,times"><EM>Thanks</EM></FONT></P></BLOCKQUOTE>
<P>Well, first let's take a moment to recognize something important that this screenshot shows.</P>
<P>Do you see it?</P>
<P>Hint #1: It is from windows 7.</P>
<P>Now?</P>
<P>Hint #2: Remember blogs like <A href="http://archives.miloush.net/michkap/archive/2005/12/18/505141.html" mce_href="http://archives.miloush.net/michkap/archive/2005/12/18/505141.html"><STRONG>Customizing the SHORT time format?</STRONG></A> and&nbsp;<A href="http://archives.miloush.net/michkap/archive/2006/07/21/673813.html" mce_href="http://archives.miloush.net/michkap/archive/2006/07/21/673813.html"><STRONG>We do seem to be short on time...</STRONG></A>&nbsp;and <A href="http://archives.miloush.net/michkap/archive/2008/10/19/9006393.html" mce_href="http://archives.miloush.net/michkap/archive/2008/10/19/9006393.html"><STRONG>I see LONG TIME and SHORT TIME; where are SHORTER TIME and SHORTEST TIME?</STRONG></A>&nbsp;and&nbsp;<A href="http://archives.miloush.net/michkap/archive/2007/11/02/5808539.html" mce_href="http://archives.miloush.net/michkap/archive/2007/11/02/5808539.html"><STRONG>Predictably (in retrospect), aka Where Wild^H^H^Hindows-Only Things Are, aka SHORT [on ]TIME for a LONG TIME</STRONG></A> and such.</P>
<P>Oh, never mind. I gave it away.</P>
<P><STRONG>They added a short time format to Regional and Language Options!</STRONG></P>
<P>Awesome, right? Now there is parity between this piece of managed code and&nbsp;native code, between NLS and the Globalization classes.</P>
<P>Very cool!</P>
<P>Well, almost.</P>
<P>Getting back to that question:</P>
<BLOCKQUOTE>
<P><FONT face="times new roman,times"><EM>I am trying to use the GetTimeFormat to retrieve the Time format from the system. Win7 added the new customized format. How can I get the format</EM></FONT></P></BLOCKQUOTE>
<P>Suddenly we lose some awesomeness, here.</P>
<P>You see,&nbsp;<A href="http://msdn.microsoft.com/library/dd318130.aspx" mce_href="http://msdn.microsoft.com/library/dd318130.aspx">GetTimeFormat</A>/<A href="http://msdn.microsoft.com/library/dd318131.aspx" mce_href="http://msdn.microsoft.com/library/dd318131.aspx">GetTimeFormatEx</A> add no new flags to get at this new data item that Regional and Language Options exposes. They have the same old flags they always had, but no new meanings atre ascribed to them, and behavior changes would be bad so it is probablyh good that nothing changed here.</P>
<P>And the Windows 7 version of <STRONG>winnls.h</STRONG> adds no new flags to get at the short time, either (just in case there was some worry that the docs were falling behind the product features).</P>
<P>There is no way to directly get at this new format that you can get at the time for formatting from the time formatting functions.</P>
<P>Though you can get at it&nbsp;through <A href="http://msdn.microsoft.com/library/dd317830.aspx" mce_href="http://msdn.microsoft.com/library/dd317830.aspx">EnumTimeFormats</A>/<A href="http://msdn.microsoft.com/library/dd317831.aspx" mce_href="http://msdn.microsoft.com/library/dd317831.aspx">EnumTimeFormatsEx</A> with the new TIME_NOSECONDS flag, or <A href="http://msdn.microsoft.com/library/dd318101.aspx" mce_href="http://msdn.microsoft.com/library/dd318101.aspx">GetLocaleInfo</A>/<A href="http://msdn.microsoft.com/library/dd318103.aspx" mce_href="http://msdn.microsoft.com/library/dd318103.aspx">GetLocaleInfoEx</A> with the <A href="http://msdn.microsoft.com/library/dd373891.aspx" mce_href="http://msdn.microsoft.com/library/dd373891.aspx">LOCALE_SSHORTTIME</A> flag.</P>
<P>As a by the way, the <A href="http://msdn.microsoft.com/library/dd373891.aspx" mce_href="http://msdn.microsoft.com/library/dd373891.aspx">LOCALE_SSHORTTIME</A> flag has some really disturbing (to me, at least) information:</P>
<BLOCKQUOTE>
<P><FONT face="times new roman,times">Windows 7 and later: Short time formatting string for the locale. Patterns are typically derived by removing the "ss" (seconds) value from the long time format pattern. For example, if the long time format is "h:mm:ss tt", the short time format is most likely "h:mm tt". This constant can specify multiple formats in a semicolon-delimited list. However, the preferred short time format should be the first value listed. </FONT></P></BLOCKQUOTE>
<P>Um, if true, that means that <A href="http://msdn.microsoft.com/library/dd373891.aspx" mce_href="http://msdn.microsoft.com/library/dd373891.aspx">LOCALE_SSHORTTIME</A> does not behave like <A href="http://msdn.microsoft.com/library/dd373886.aspx" mce_href="http://msdn.microsoft.com/library/dd373886.aspx">LOCALE_SSHORTDATE</A> or <A href="http://msdn.microsoft.com/library/dd373854.aspx" mce_href="http://msdn.microsoft.com/library/dd373854.aspx">LOCALE_SLONGDATE</A>. It returns the semicolon-delimited list of short times that <A href="http://msdn.microsoft.com/library/dd317830.aspx" mce_href="http://msdn.microsoft.com/library/dd317830.aspx">EnumTimeFormats</A>/<A href="http://msdn.microsoft.com/library/dd317831.aspx" mce_href="http://msdn.microsoft.com/library/dd317831.aspx">EnumTimeFormatsEx</A>&nbsp;enumerate.</P>
<P>Now if true that would make it easy for the .NET Framework's new upcoming version to ask Windows for information since that is the format it grabs out itself anyway, but not so easy for developers in Windows or outside of Microsoft using Windows, since which entry is the (possibly customized but if nothing else "current default" is not documented and thus the Windows code that grabs formats out of <A href="http://msdn.microsoft.com/library/dd317830.aspx" mce_href="http://msdn.microsoft.com/library/dd317830.aspx">EnumTimeFormats</A>/<A href="http://msdn.microsoft.com/library/dd317831.aspx" mce_href="http://msdn.microsoft.com/library/dd317831.aspx">EnumTimeFormatsEx</A>&nbsp;can't be officially relied on (in practice it should be the first one, I suppose - maybe that should be officially documented).</P>
<P>And even if it could, parsing a semicolon delimited list of formats is easier than calling the enumeration functions which make callbacks and so forth.</P>
<P>That may be why <A href="http://msdn.microsoft.com/library/dd373891.aspx" mce_href="http://msdn.microsoft.com/library/dd373891.aspx">LOCALE_SSHORTTIME</A>&nbsp;has this unusual data return value - the fact that this keeps the .Net folks from having to call the complicated callback function. So at least someone might have had an easier job.</P>
<P>The solution to the original problem?</P>
<P>Well, <STRONG>Step 1</STRONG> is to call <A href="http://msdn.microsoft.com/library/dd318101.aspx" mce_href="http://msdn.microsoft.com/library/dd318101.aspx">GetLocaleInfo</A>/<A href="http://msdn.microsoft.com/library/dd318103.aspx" mce_href="http://msdn.microsoft.com/library/dd318103.aspx">GetLocaleInfoEx</A> with the <A href="http://msdn.microsoft.com/library/dd373891.aspx" mce_href="http://msdn.microsoft.com/library/dd373891.aspx">LOCALE_SSHORTTIME</A> flag.</P>
<P>And then <STRONG>Step 2</STRONG> is to take the string that is returned and pass it as the format to <A href="http://msdn.microsoft.com/library/dd318130.aspx" mce_href="http://msdn.microsoft.com/library/dd318130.aspx">GetTimeFormat</A>/<A href="http://msdn.microsoft.com/library/dd318131.aspx" mce_href="http://msdn.microsoft.com/library/dd318131.aspx">GetTimeFormatEx</A>.</P>
<P>And of course that last question (which locale?), is to use either the <A href="http://msdn.microsoft.com/library/dd373901.aspx" mce_href="http://msdn.microsoft.com/library/dd373901.aspx">LOCALE_USER_DEFAULT</A> or <A href="http://msdn.microsoft.com/library/dd373815.aspx" mce_href="http://msdn.microsoft.com/library/dd373815.aspx">LOCALE_NAME_USER_DEFAULT</A> constant, depending on which function you call.</P>
<P>You might get a sense of why I stopped thinking it was awesome.</P>
<P>I mean, don't get me wrong, it is better than nothing.</P>
<P>But there is a lot of room for improvement in future versions, based on the ways that developers might want to make use of the information....</P>
<P><FONT color=#ff0000><STRONG>UPDATE 12:32pm - it seems that they did the work in GetTimeFormat[Ex] to support the formatting; if you pass TIME_NOSECONDS they give you the short time in Regional and Language Options, with seconds stripped out if you added them. Though is you want what the user put in you have to go through the above steps due to the overloading of this flag that has had its meaning changed. Maybe I'll write about that tomorrow....</STRONG></FONT></P>
<hr/><p><a id="9955869" href="#9955869">#</a> <strong>Random832</strong> on 30 Jan 2010 10:45 PM:</p><div style="margin-left: 1em"><p>Under what circumstances will an item other than the first from this &quot;multiple formats in a semicolon-delimited list&quot; be used?</p>
<p>Or, put another way, what is the effect of allowing this to occur other than to gratuitously prevent semicolon from being a valid character in the short time format?</p></div>
<p><a id="9955884" href="#9955884">#</a> <strong>Michael S. Kaplan</strong> on 31 Jan 2010 12:50 AM:</p><div style="margin-left: 1em"><p>This information is not documented so there is not currently an official answer....</p>
</div>
<p><a id="9955928" href="#9955928">#</a> <strong>Michael S. Kaplan</strong> on 31 Jan 2010 6:28 AM:</p><div style="margin-left: 1em"><p>Well some of it is clear in the way of defacto behavior - like the strange setlocaleinfo behavior, which is I suspect the reason for the &quot;maybe&quot; language surrounding the semicolon....</p>
</div>
<hr/><p><em>referenced by</em></p><div style="margin-left: 1em"><p>2011/01/28 <a href="http://archives.miloush.net/michkap/archive/2011/01/28/10121371.html">Punishing a locale for its language's letter choices is just unseemly</a></p><p>2010/02/20 <a href="http://archives.miloush.net/michkap/archive/2010/02/20/9966698.html">The road not traveled (or, more to the point, the road not built) for Amharic</a></p></div><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2010/01/29/9955550.html" title="Dr. International is dead, long live Dr. International...">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2010/01/26/9952907.html" title="On character justification (in *both* senses)">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2010-01">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2010-01-27">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2010/01/27/9953946.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:35 GMT -->
</html>