<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2010/12/10/10102521.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:34 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>Anti-Microsoft conspiracy theories are fun #6 (aka If you use .Net, you may have a stupid .Parent)</title></head><body>
<h1>Anti-Microsoft conspiracy theories are fun #6 (aka If you use .Net, you may have a stupid .Parent)</h1>
<p><em>by Michael S. Kaplan, published on 2010/12/10 07:01 -05:00, original URI: http://blogs.msdn.com/b/michkap/archive/2010/12/10/10102521.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostNew -->
<p><strong><span style="color: #ff0000;"><em>Regarding the main title of&nbsp;today's blog, this still is not a @#%&amp;*!&nbsp;series.</em></span></strong></p>
<p>For today's blog's alternate title, I am relying on the fact that the vast majority of technical content on this blog refers to something with internationalization or globalization or localizability overtones.</p>
<p>I mean, I am not saying that your parents are stupid. I don't even know most of your parents, after all.</p>
<p>This is not an anti-Microsoft consp[iracy theory claiming that if you use .Net that this indicates your parents screwed something up.</p>
<p>And I am not saying that Anders Hejlsberg&nbsp; <a href="http://www.microsoft.com/presspass/exec/techfellow/hejlsberg/default.mspx"><img height="93" width="78" src="http://www.microsoft.com/presspass/images/exec/tf/Hejlsberg_bio.jpg" style="border-width: 0px;" /></a>, the man who for all intents and purposes is the father of C#, is stupid. Because he isn't.</p>
<p>And I am really not saying that most of the .Net <strong>Parent</strong> properties are stupid, because (a) I don't know every one of them, and (b) most of the ones I do know aren't stupid. Statistically speaking, some may be, but none of them I know.</p>
<p>Well, with one exception.</p>
<p><a href="http://msdn.microsoft.com/library/system.globalization.cultureinfo.parent.aspx">CultureInfo.Parent</a> is stupid. Really stupid.</p>
<p>Perhaps this would be an appropriate time (after the provocative&nbsp;eye-catching title and cutesy introduction with art and bold central statement - my basic formula) to explain the basis for the claims of the aforementioned statement.</p>
<p>I'll start from another topic, that talks about internal usage patterns of the property rather than the property itself.</p>
<p>Like <a href="http://msdn.microsoft.com/library/axt1ctd9.aspx">PropertyInfo.SetValue Method (..., CultureInfo)</a>'s description of its CultureInfo parameter:</p>
<p style="padding-left: 30px;"><span style="font-family: times new roman,times;"><em>The CultureInfo object that represents the culture for which the resource is to be localized. Note that if the resource is not localized for this culture, the CultureInfo.Parent method will be called successively in search of a match. If this value is null, the CultureInfo is obtained from the CultureInfo.CurrentUICulture property. </em></span></p>
<p>Or <a href="http://msdn.microsoft.com/library/bsb0cfet.aspx">ResourceManager.GetString Method (..., CultureInfo)</a>'s description of <em>it's </em>CultureInfo parameter:</p>
<p style="padding-left: 30px;"><span style="font-family: times new roman,times;"><em>The CultureInfo object that represents the culture for which the resource is localized. Note that if the resource is not localized for this culture, the lookup will fall back using the current thread's Parent property, stopping after looking in the neutral culture</em></span>.</p>
<p>Not for nothing, but the fact that these two descriptions and others like them are different is also a bug. As are some of the descriptions themselves.</p>
<p>Anyway, you get the idea -- the usage of this property is for <strong>resource fallback</strong>. </p>
<p>So that if you look for resources of one culture but cannot find them then it knows to fall back to another culture, and so on.</p>
<p>This is not stupid.</p>
<p>Well, it is not <em>too</em> stupid. It is a little stupid since in most cases this can also be done by simply looking at the string and chopping pieces off successively. But this potential bit of stupidity is obviated by the fact that the are exceptions to that principle, like </p>
<p style="padding-left: 60px;">zh-TW ---&gt; zh-CHT --&gt; {Invariant}</p>
<p>&nbsp;and such. Thus having it in a property is sensible.</p>
<p>Okay, now let's look at the property's own documentation and its description of this <a href="http://msdn.microsoft.com/library/system.globalization.cultureinfo.parent.aspx">CultureInfo.Parent</a>&nbsp;property whose usage is widely, if inconsistently, described:</p>
<p style="padding-left: 30px;"><span style="font-family: times new roman,times;"><em>The cultures have a hierarchy in which the parent of a specific culture is a neutral culture, the parent of a neutral culture is the InvariantCulture, and the parent of the InvariantCulture is the invariant culture itself. The parent culture encompasses only the set of information that is common among its children.<br /><br />If the resources for the specific culture are not available in the system, the resources for the neutral culture are used. If the resources for the neutral culture are not available, the resources embedded in the main assembly are used. For more information on the resource fallback process, see Packaging and Deploying Resources.</em></span></p>
<p>Um, where do I start?</p>
<p>Well there is the whole <a href="http://msdn.microsoft.com/library/sb6a8618.aspx">Packaging and Deploying Resources</a>topic that often has different rules, but we'll set that aside. Yes it makes the rules more complicated, but first let's focus on the simple design without dragging in signatures.</p>
<p>Okay, so we have established that Microsoft means for this property to support something more interesting than I can do myself parsing the name for dash delimiters.</p>
<p>But all of the interesting work that happens in LIPs to fall back like ca to es? Not in there.</p>
<p>The fact that most language (like Arabic and English and French) only ship one version despite having 5-10 or more locales yet the fallback does not fall back to that language that would help them out? That'd not in there either.</p>
<p>Office's LCID-based fallback model? Also not covered well -- they have to do their own thing.</p>
<p>And the early adopter of&nbsp;Windows language support via things like LOCALE_IDEFAULTLANGUAGE? That isn't supported, either.</p>
<p>Don't even get me started on claims in docs like</p>
<p style="padding-left: 60px;"><em>The parent culture encompasses only the set of information that is common among its children.</em></p>
<p>that fail the smell test for cases like <strong>sr-Latn-CS</strong> and <strong>sr-Cyrl-CS</strong> that have different scripts and code pages yet both fell back to <strong>sr</strong> for years. Same story with <strong>az-Cyrl-AZ</strong> and <strong>az-Latn-AZ</strong> have the same story, as does <strong>uz-Cyrl-UZ</strong> and <strong>uz-Latn-UZ</strong>.</p>
<p>Then let's talk about how everything falls back to <strong>Invariant</strong> -- which has a name of the empty string and thus cannot ever have a directory with resources in it since a directory with no name is illegal on Windows.</p>
<p>Okay. So we have a model that isn't going to match the majority of incoming or outgoing traffic. for Windows, Office, or anyone following Windows or Office (the largest and for most large scale purposes the only significant adopter of MUI on the platform -- including .Net's own defaults (that start from those of Windows). And which fails to match BCP-47 in key interesting areas for many years (as China and others might note).</p>
<p>This is just stupid. A terrible design bolted atop a platform that has a design that for better or worse supports more than 60% of Microsoft's revenue.</p>
<p>Now one could blame Windows/DEVDIV rivalries for these dumb incongruities or a slow burning dud of a Silverlight sorta fiasco later recovered, but one would be wrong in this case, since the design of CultureInfo and the <a href="http://msdn.microsoft.com/library/system.globalization.cultureinfo.parent.aspx">CultureInfo.Parent</a>&nbsp;were designed and implemented by Windows -- and they own the data as well, tho0ugh not the technoloogy that does the loading.</p>
<p><em>"But we were just following orders!" the resource loading code would claim at the "Code Crimes" trial.</em></p>
<p>Perhaps it is yet another conspiracy theory -- Microsoft screwing over the Developer Division by providing them with an unusable language resource loading model fallback plan that is not compatible with Windows even when managed components try to run on Windows?</p>
<p>Nah.</p>
<p>I'm overthinking it again like I did in <a href="http://archives.miloush.net/michkap/archive/2010/12/07/10101187.html" title="Anti-Microsoft conspiracy theories are fun #5 (aka Microsoft is not supporting the terrorists, dammit!)"><strong>Anti-Microsoft conspiracy theories are fun #5 (aka Microsoft is not supporting the terrorists, dammit!)</strong></a> and <a href="http://archives.miloush.net/michkap/archive/2010/12/06/10100616.html" title="Anti-Microsoft conspiracy theories are fun #3 (aka Why the hell can't they just update Uniscribe?)"><strong>Anti-Microsoft conspiracy theories are fun #3 (aka Why the hell can't they just update Uniscribe?)</strong></a>, ascrtibing to brilliance or malice what almost certainly&nbsp;not neither.</p>
<p>It's just stupid....</p>
<hr/><p><strong>Mihai</strong> on 10 Dec 2010 12:15 PM:</p><div style="margin-left: 1em"><p>For a bit of an outside perspective: overall I find most of the .NET globalization classes very well designed (especially when compared with other APIs/frameworks). There are some kinks in implementation? Yes. But overall the foundation is ok. And most of it was there since .NET version 1.0, which is not very often the case :-)</p>
<p>Anyway, back to the parent thing: I think the approach right now is kind of broken everywhere: RFC 4647, .NET, Java, you name it.</p>
<p>Because (for instance) nobody does any effort to match &quot;sideways&quot; or to a &quot;mutually intelligible language&quot;.</p>
<p>If I ask for zh-TW and there is no zh-Hant, nobody tries zh-MO or zh-HK. In many cases there is no fallback from mo-Latn (Moldavian which &quot;is a language&quot; just because political agendas) to ro (or ro-RO or ro-MD). Or even fallback between no (deprecated), nn and nb. Might also be ok to serve mo-Latn or ro when one asks for mo-Cyrl-MD (Moldavia switched to Latin script 20 years ago you would expect that the old guy who still prefers Cyrillic can read Latin).</p>
<p>There are areas where you can work around these limitations (copy the ro resources as mo). But if you don&#39;t control the list of what&#39;s available, you can&#39;t do that (for instance when you search for content in a certain language).</p></div>
<p><strong>Michael S. Kaplan</strong> on 10 Dec 2010 3:26 PM:</p><div style="margin-left: 1em"><p>Mihai, I entirelty agree. In fact the only thing wrong with even this one property is the data underneath it, which is the cause of all of the problems I mention. There is a lot of potential for good results here -- but not with the data used there now. :-(</p>
</div>
<p><strong>Michael S. Kaplan</strong> on 10 Dec 2010 3:32 PM:</p><div style="margin-left: 1em"><p>The one other property in the globalization classes that is truly awful is the console fallback -- which is also a plan for resource fallback. Just terrible the namespace is at resource stuff!</p></div>
<p><strong>alexcohn</strong> on 13 Dec 2010 12:53 PM:</p><div style="margin-left: 1em"><p>I beg to differ. There are too many cultural (i.e. political) issues involved, to expect that automaI beg to differ. There are too many cultural (i.e. political) issues involved, to expect that automatic choice made by software will not cause disappointment or even rage. In Moldova, there are people for whom Cyrillic script is a matter of principle. I believe that the same is true for Serbia.</p>
<p>What&#39;s wrong with application explicitly asking the user preference?</p>
<p> Well, system or &nbsp;a web browser could keep the default or ordered list of defaults - but please, don&#39;t attempt to deside FOR the user .</p>
</div>
<hr/><p><em>referenced by</em></p><div style="margin-left: 1em"><p>2011/01/05 <a href="http://archives.miloush.net/michkap/archive/2011/01/05/10111348.html">Short-sighted text processing #5: PU[A]! That pad THAI is pretty spicy....</a></p></div><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2010/12/11/10103541.html" title="The latest Windows 7 LIP: Quechua it if you can!">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2010/12/09/10102465.html" title="It&#39;s a LIP that won&#39;t cost you an arm[enia] and a leg!">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2010-12">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2010-12-10">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2010/12/10/10102521.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:34 GMT -->
</html>