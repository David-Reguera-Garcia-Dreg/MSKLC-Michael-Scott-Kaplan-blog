<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2010/07/25/10028168.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:35 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>Which code page to use? The right one, of course!</title></head><body>
<h1>Which code page to use? The right one, of course!</h1>
<p><em>by Michael S. Kaplan, published on 2010/07/25 07:01 -04:00, original URI: http://blogs.msdn.com/b/michkap/archive/2010/07/25/10028168.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostNew -->
<p>Over in the Suggestion Box, Pete asked:</p>
<p style="padding-left: 30px;"><span style="font-family: times new roman,times;"><em>I've been reading what you have to say about the deep, insatiable depravity that is CP_THREAD_ACP, and I can't say I disagree. My goal when writing Win32 string code is to start in UTF-16 and stay there as long as possible, and, when I can't start there, get there as soon as possible. Sadly, though, one must sometimes mediate between good and evil, such as when one writes a general-purpose library which needs to call an API which not only lacks a W variant but also seems to think code pages make perfect sense to everyone on all systems at all times, so doesn't bother to mention its needs or expectations. An example would be FGetComponentPath, but I think there are some cases in the old Outlook Express API as well. In these sorts of cases, we might benefit from your guidance on which to use, CP_ACP or CP_THREAD_ACP. Can one even generalize? And, if not, how might one determine the correct constant for each case?</em></span></p>
<p>I think Pete was referring to blogs like <a href="http://archives.miloush.net/michkap/archive/2007/05/28/2960411.html"><strong>Nothing stinks worse than the thread locale, other than the thread code page</strong></a>, where I am so subtle about my feelings for some constructs that one might miss the subtext....</p>
<p>But for the general scenario here, the question of what code page to use?</p>
<p>There is no "always correct" answer.</p>
<p>I mean for <a href="http://msdn.microsoft.com/library/cc815369.aspx">FGetComponentPath</a> there is a simple answer, which is use CP_ACP. Since that is what it is going to use.</p>
<p>And if the private mapi32.dll stub is to be shoved in a directory that contains off-CP_ACP or Unicode-only characters, you are basically screwed trying to do this&nbsp;in some cases (like if short file name generation is turned off).</p>
<p>Okay, I guess there is an answer here of a sort, after all.</p>
<p>You have to match the code page of whatever function you are calling!</p>
<p>Usually that will be CP_ACP but there are hundreds of exceptions out there (many of which I have written about in the past), and sometimes the only way exceptions are found is to use CP_ACP and notice the bug caused thereby. If MSLU taught me anything is that nobody bothered to document most of this stuff (beyond my occasional efforts, of course!).</p>
<p>Generally speaking, there are better answers in most cases, even with functions like <a href="http://msdn.microsoft.com/library/cc815369.aspx">FGetComponentPath</a>, depending on what you are trying to do with the function.</p>
<p>As a by-the-way,&nbsp;the docs for <a href="http://msdn.microsoft.com/library/cc815369.aspx">FGetComponentPath</a> are confusing anyway (they are all <strong>[in]</strong>parameters? Really? That would be more of an FSetComponentPath if it were true!)....</p>
<hr/><div style="margin-left: 1em"><em>no comments</em></div><hr/><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2010/07/26/10036264.html" title="You can violate the rules of decorum, just not the law of gravity">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2010/07/24/10041833.html" title="My 2 out of 119 (11 + 108) trips around the Chilkur Balaji Temple&#39;s inner shrine">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2010-07">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2010-07-25">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2010/07/25/10028168.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:35 GMT -->
</html>