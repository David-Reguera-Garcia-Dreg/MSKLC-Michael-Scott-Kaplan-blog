<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2010/11/17/10092336.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:34 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>Every character has a story #32: There are CJK Compatibility Ideographs, and then there are CJK Compatibility Ideographs</title></head><body>
<h1>Every character has a story #32: There are CJK Compatibility Ideographs, and then there are CJK Compatibility Ideographs</h1>
<p><em>by Michael S. Kaplan, published on 2010/11/17 07:01 -05:00, original URI: http://blogs.msdn.com/b/michkap/archive/2010/11/17/10092336.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostNew -->
<p>Now the line from <strong>Finding Forrester</strong> is what ran through my head. The one near the end. Earlier, Jamal had missed two free throws despite having a nearly perfect record for free throws, mainly to prove that he was not going to "dance" for the bigwigs on the board. After the climactic scene, Forrester asks him "So, those free throws....did you miss them, or did you miss them?"</p>
<p>When I read the line that became the title of this blog, I knew I had to write this blog....</p>
<p>You see, Unicode has a history.</p>
<p>The whole <a href="http://archives.miloush.net/michkap/archive/tags/every+character+has+a+story/default.aspx" title="Every Character Has a Story"><strong>Every Character Has a Story</strong></a> category is all about the colorful histories of some of the characters in Unicode. And what real characters they can be.</p>
<p><em>The experts in Unicode are also "characters" in another sense, and perhaps a new series with biographies called <strong>Every Unicode Expert is a Character</strong>. But masybe that can be a subject for another day.</em></p>
<p>Anyway,&nbsp;the other day, a complaint made while looking at the current state of a particular bit of the standard without the benefit of history, helped us get from Ken Whistler the real story of <strong>compatibility characters in Unicode</strong>. It was some great info, and I asked for (and received) permission to extract this information and write about it here.</p>
<p>So without further adieu....</p>
<hr />
<p><span style="font-family: times new roman,times;">&gt; &gt;&gt; FA47 is a "compatibility character", and would have a&nbsp;compatibility<br />&gt; &gt;&gt; mapping.<br />&gt; &gt; Faulty syllogism.<br />&gt; Formally correct answer but only because of something of a design <br />&gt; flaw in Unicode. When the type of mapping was decided on, people <br />&gt; didn't fully&nbsp;expect that NFC might become widely used/enforced, <br />&gt; making these&nbsp;distinctions appear wherever text is normalized in a <br />&gt; distributed&nbsp;architecture.</span></p>
<p>O.k., I'm gonna have to intervene again. *hehe* Yes, there is a design flaw here, but Asmus' explanation is also somewhat faulty, because it flattens out the history in a way that is liable to be misunderstood.</p>
<p>There is a *reason* why "when the type of mapping was decided on" that "people didn't fully expect that NFC might become widely used/enforced" -- but it wasn't that they were goofing up in understanding the implications of normalization. Rather, at that point in Unicode history NFC didn't *exist* yet, nor had the normalization algorithm been designed.</p>
<p>Here, for the benefit of the standards geeks out there, are the relevant higlights of the historical timeline involved.</p>
<p><strong>June, 1992</strong></p>
<p>&nbsp; The canonical mappings for the CJK Compatibility characters&nbsp;were *printed* (with off-by-one errors for some of them!) in Unicode 1.0, volume 2 (= Unicode 1.0.1).<br />&nbsp; <br />&nbsp; Actually, at the time, we didn't know they were "canonical" mappings, because that concept hadn't formally been invented yet, but the intention was clear. They were the mappings from the "CJK compatibility ideographs" to the "real" unified Han ideographs in the standard. The CJK compatibility characters were all considered to be duplicates in the source standards that didn't follow the unification rules.<br />&nbsp; <br /><strong>July, 1996</strong></p>
<p>&nbsp; The formal definitions of "canonical decomposition" and "compatibility decomposition" were first published in Unicode 2.0. There wasn't a data file for the CJK Compatibility Ideographs block, but the canonical mappings were *printed* (correctly, this time) on pp. 7-470 to 7-472 of the standard.<br />&nbsp; <br /><strong>August 4, 1998</strong></p>
<p>&nbsp; The first published version of UnicodeData.txt that contained the canonical mappings for the CJK Compatibility Ideographs was UnicodeData-2.1.5.txt for Unicode 2.1.5. (Actually, they got into UnicodeData-2.1.4.txt on July 9, 1998, but that wasn't a published version of the data file.)<br />&nbsp; <br /><strong>July 23, 1999</strong></p>
<p>&nbsp; This was the publication data of the first approved version of UAX #15 (Revision 15), and so is the first published definition of NFC. (Of course UAX #15 had been in draft for some time earlier than that, so the term "NFC" can be tracked back in the drafts to mid-1998.)<br />&nbsp; <br /><strong>September, 1999</strong></p>
<p>&nbsp; Release of Unicode 3.0 -- the first release of Unicode formally tied to the Unicode Normalization Algorithm. (The revision of UAX #15 for the release was actually Revision 18, dated November 11, 1999.)<br />&nbsp; <br /><strong>March 23, 2001</strong></p>
<p>&nbsp; UAX #15, Version 3.1.0. This was the version of the Unicode Normalization Algorithm that specified the composition version to be Version 3.1.0 and locked down normalization forever more.<br />&nbsp; <br />&nbsp; So essentially, there was a 9 year period between when the first mappings were defined for the CJK Compatibility Ideographs and the date beyond which it became impossible to reinterpret or change a canonical mapping because of the lockdown of normalization.</p>
<p>&nbsp; The problems resulting from the normalization for CJK Compatibility Ideographs only started to become visible to people *after* the lockdown, and when Unicode normalization started to become a regular feature of actual processing.</p>
<p>&nbsp; And it wasn't because "people didn't fully expect that NFC might become widely used/enforced" -- or at least not the people in the UTC. The UAX #15 text published with Unicode 3.0 already stated: "The W3C Character Model for the World Wide Web requires the use of Normalization Form C for XML and related standards..."</p>
<p>&nbsp; And it wasn't because of some oversight about the canonical appings involving the CJK Compatibility Ideographs per se. That same UAX #15 for Unicode 3.0 also stated: "With *all* normalization forms singleton characters (those with singleton canonical mappings) are replaced." So the ground facts for the FA10 --&gt; (NFC/NFD/NFKC/NFKD) 585C normalization pattern were well-established and explicitly stated in 1999.</p>
<p><span style="font-family: times new roman,times;">&gt; &gt; FA47 is a CJK Compatibility character, which means it was encoded <br />&gt; &gt; for compatibility purposes -- in this case to cover the round-trip<br />&gt; &gt; mapping needed for JIS X 0213.<br />&gt; &gt; However, it has a *canonical* decomposition mapping to U+6F22.<br />&gt; And that, of course, destroys the desired "round-trip" behavior if it is <br />&gt; inadvertently applied while the data are encoded in Unicode. Hence the <br />&gt; need to recreate a solution to the issue of variant forms with a different<br />&gt; mechanism, the ideographic variation sequence (and&nbsp;corresponding <br />&gt; database).</span></p>
<p>&nbsp; Yes, that is basically correct. But, this architectural "design flaw" actually results from two additional requirements that accrued to the Unicode Standard well after its initial design:</p>
<p><strong>1. The requirement to be able to carry "round-trip" behavior&nbsp;through distributed environments.</strong></p>
<p>&nbsp; In the original design, the notion of how one would deal with legacy data was conceived of primarily as a controlled and contained conversion issue. An application/system would convert legacy data to Unicode, and if it needed to convert back, it could use compatibility characters for round-trip conversion. The system would know how and when it could normalize, because it controlled the data and the conversion.</p>
<p><strong>2. The requirement to be able to maintain CJK variant glyph&nbsp;distinctions in plain text data.</strong></p>
<p>&nbsp; Again, that was not at all a part of the original Unicode Standard design.</p>
<p>&nbsp; So the essential nature of the problem is that these new requirements have mostly accrued to Unicode implementations *after* 2001, more or less at the point when the lockdown of Unicode normalization made it impossible for normalization to be adjusted in any way to account for them.</p>
<p>&nbsp; Hence the need to construct an *alternative* approach involving variation selectors, which would be robust and invariant under normalization transformations.</p>
<p><span style="font-family: times new roman,times;">&gt; &gt; The behavior in BabelPad is correct: U+6F22 is the NFC form of U+FA47.<br />&gt; &gt; Easily verified, for example, by checking the FA47 entry in<br />&gt; &gt; NormalizationTest.txt in the UCD.<br />&gt; While correct, it's something that remains a bit of a gotcha.</span></p>
<p>&nbsp; Yeah, well, the basic gotcha is that no matter how many times I say it or what the Unicode Standard says, people will continue to just assume "compatibility character" implies "compatibility decomposition". For everybody on the list, I recommend frequent re-reading of Section 2.3, Compatibility Characters, of the standard:</p>
<p><a href="http://www.unicode.org/versions/Unicode5.2.0/ch02.pdf">http://www.unicode.org/versions/Unicode5.2.0/ch02.pdf</a></p>
<p>whenever somebody mentions "compatibility" in discussion of Unicode. Yes, I suspect that people will find their heads hurting -- but this subject *is* complex, and generalizations that people make about "compatibility characters" are often wrong when they don't pay attention to the details.</p>
<p><span style="font-family: times new roman,times;">&gt; Especially&nbsp;now that Unicode has charts that go to great <br />&gt; length showing the&nbsp;different glyphs for these characters,</span></p>
<p>&nbsp; Well, even there the issue is complicated, because there are CJK Compatibility Ideographs, and then there are CJK Compatibility Ideographs. They fall into at least 3 important classes:</p>
<ol>
<li>Ones which really are *unified* ideographs, despite their names.</li>
<li>Ones which are *pronunciation* variants from KS X 1001,&nbsp;and which are *not* intended to show different glyphs.</li>
<li>Ones which are *graphical* variants from other legacy&nbsp;standards, and which *are* intended to show different glyphs.</li>
</ol>
<p>&nbsp; And even class 3 has subtypes, because some show variants that are distinguished only in one legacy standard, whereas some are themselves cross-mapped between more than one legacy standard -- putatively because each legacy standard shows the same variant glyph.</p>
<p>&nbsp; It is class 3 that may be adversely affected *visually* by the application of normalization in a distributed environment.</p>
<p><span style="font-family: times new roman,times;">&gt; I would suggest adding a note to&nbsp;the charts that make clear that these <br />&gt; distinctions are *removed* anytime&nbsp;the text is normalized, which, in a <br />&gt; distributed architecture may happen&nbsp;anytime.</span></p>
<p>&nbsp; The CJK Compatibility Ideographs already have warnings attached to them in the standard. They are repeatedly documented as "only for round-trip compatibility with XYZ" and "They should not be used for any other purpose."</p>
<p>&nbsp; However, I think your point is a valid one. Now that the clear answer for maintaining legacy CJK glyph variant distinctions in a distributed environment is via ideographic variation sequences as registered in the IVD, it would make sense to beef up the CJK Compatibility Ideograph documentation with better pointers (and with accompanying rationale text) to UTS #37 and the IVD, and to post stronger warning labels in the code charts for CJK Compatibility Ideographs.</p>
<p>&nbsp; Perhaps someone would like to make a detailed proposal to the UTC for how to fix the text and charts? ;-)</p>
<p>
<hr />
</p>
<p>Well, I won't go that far. </p>
<p>But I will capture the conversation so people can learn something about the meaning of <strong>compatibility characters</strong> in Unicode.</p>
<hr/><p><strong>Andrew West</strong> on 18 Nov 2010 1:44 AM:</p><div style="margin-left: 1em"><p>This great information didn&#39;t happen to come from a certain list that &quot;is really best to avoid&quot; by any chance?</p>
</div>
<p><strong>Michael S. Kaplan</strong> on 18 Nov 2010 6:13 AM:</p><div style="margin-left: 1em"><p>Yes -- but that doesn&#39;t change the signal-to-noise ratio there. :-p</p>
</div>
<hr/><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2010/11/18/10092981.html" title="Oriya vs. Odia?">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2010/11/16/10091632.html" title="&quot;Crap, I didn&#39;t start Schedule+&quot;, [some of] why I still don&#39;t love Outlook, and other nostalgias">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2010-11">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2010-11-17">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2010/11/17/10092336.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:34 GMT -->
</html>