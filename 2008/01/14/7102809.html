<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2008/01/14/7102809.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:36 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>On reversing the irreversible (The Set-Up)</title></head><body>
<h1>On reversing the irreversible (The Set-Up)</h1>
<p><em>by Michael S. Kaplan, published on 2008/01/14 10:16 -05:00, original URI: http://blogs.msdn.com/b/michkap/archive/2008/01/14/7102809.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostNew -->
<P>The first blog in this series was <A class="" href="http://archives.miloush.net/michkap/archive/2008/01/13/7090976.html" mce_href="http://archives.miloush.net/michkap/archive/2008/01/13/7090976.html"><STRONG>On reversing the irreversible (the introduction)</STRONG></A>.</P>
<P>First we'll lay put some requirements....</P>
<P>This is not a "call it once and then never again" kind of functionality, since the initial cost of building up the data needed to interpret sort keys is non-trivial in nature and there is a high fixed cost for that setup. So what we really need is&nbsp;just a few&nbsp;functions:</P>
<UL>
<LI><STRONG>InitializeSortkeyReverseData</STRONG> -- this function would take an LCID and the flags to be used, and returns a handle that represents an opaque&nbsp;handle to be passed on future calls.</LI>
<LI><STRONG>InitializeSortkeyReverseDataEx</STRONG> -- same as InitializeSortkeyReverseData but takes a locale name rather than an LCID, and returns a handle that represents an opaque&nbsp;handle to be passed on future calls.</LI>
<LI><STRONG>ReverseSortKey</STRONG> -- Takes a handle from InitializeSortkeyReverseData[Ex] and a byte array returned from a prior sortkey grabbing <A class="" href="http://msdn2.microsoft.com/library/ms776290.aspx" mce_href="http://msdn2.microsoft.com/library/ms776290.aspx">LCMapString</A>/<A class="" href="http://msdn2.microsoft.com/library/ms776387.aspx" mce_href="http://msdn2.microsoft.com/library/ms776387.aspx">LCMapStringEx</A> call, and returns a string that would have returned that sort key, or as close as can be managed.</LI>
<LI><STRONG>UnInitializeSortkeyReverseData</STRONG> -- frees up the data associated with a prior InitializeSortkeyReverseData[Ex] call.</LI></UL>
<P>Now there are some truths relating to collation that are kind of implicit in the contract that these functions will be promising -- such as:</P>
<UL>
<LI>Certain locales return identical results to certain other locales and that if you know what they are you can save yourself the hassle of allocating the same identical&nbsp;data multiple times.</LI>
<LI>Most locale differences amount to nothing but subtle table alterations but there are specific exceptions that are a much bigger deal and on the whole it is best to not interpret the sortkey value from one locale by using the data of another's (more on this in an upcoming blog).</LI>
<LI>Any time two strings return identical sortkeys, only one string will ever be returned by ReverseSortKey -- the string&nbsp;will be chosen deterministically, if arbitrarily.</LI>
<LI>All of the NORM_IGNORE*&nbsp;flags are essentially supersets of not calling with them, and thus it is probably better to be less restrictive and <STRONG>not</STRONG> include these flags in the InitializeSortkeyReverseData[Ex] call even if you plan to use the flags later, because otherwise those deterministic returns I just mentioned might seem a lot more random (I'll explain why in an upcoming blog).</LI>
<LI>The other flags (SORT_STRINGSORT and LCMAP_BYTEREV) both cause very different results to be returned and can legitimately be considered to be entirely different data sets, in the former for&nbsp;the whole sort key and the former for certain punctuation, as described in <A class="" href="http://archives.miloush.net/michkap/archive/2007/09/20/5008305.html" mce_href="http://archives.miloush.net/michkap/archive/2007/09/20/5008305.html"><STRONG>A&amp;P of Sort Keys, part 9 (aka Not always transitive, but punctual and punctuating)</STRONG></A>.</LI>
<LI>We're only doing Unicode strings. If you're not using Unicode then you're simply out of scope for me here, and when I say out of scope I mean under scope....</LI></UL>
<P>Anyway, if you're reading the series you can think about the kind of data you will bring to the party for the future blogs in the series.</P>
<P>Next up: initializing the data, after deciding what we want the data to look like....</P>
<P>What we really want is a good hashtable algorithm that we can give the byte&nbsp;arrays and strings&nbsp;to 9the former as index entries, the latter as content). Let me know if you have any in particular you like best....</P>
<P mce_keep="true">&nbsp;</P>
<P><FONT color=#ff00ff><EM>This post brought to you by</EM> êÑ≠ <EM>(<A class="" href="http://www.fileformat.info/info/unicode/char/1012d" mce_href="http://www.fileformat.info/info/unicode/char/1012d">U+1012d</A>, aka AEGEAN NUMBER THIRTY THOUSAND)</EM></FONT></P>
<hr/><div style="margin-left: 1em"><em>no comments</em></div><hr/><p><em>referenced by</em></p><div style="margin-left: 1em"><p>2008/03/03 <a href="http://archives.miloush.net/michkap/archive/2008/03/03/7984960.html">On reversing the irreversible (grabbing the data, part II: the weirdness not so related to locales)</a></p><p>2008/01/25 <a href="http://archives.miloush.net/michkap/archive/2008/01/25/7228941.html">On reversing the irreversible (grabbing the data, part I)</a></p></div><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2008/01/14/7104170.html" title="Hello! I am bored this afternoon. I am a nice Blog that would like to blog with you....">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2008/01/13/7097108.html" title="Brings whole new meaning to &#39;I&#39;m drawing a blank here&#39;">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2008-01">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2008-01-14">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2008/01/14/7102809.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:36 GMT -->
</html>