<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2008/04/19/8409778.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:36 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>Even if the text is right underneath, it may look wrong close up....</title></head><body>
<h1>Even if the text is right underneath, it may look wrong close up....</h1>
<p><em>by Michael S. Kaplan, published on 2008/04/19 03:01 -04:00, original URI: http://blogs.msdn.com/b/michkap/archive/2008/04/19/8409778.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostNew -->
<P><EM><FONT color=#ff0000 size=1>Content of </FONT></EM><A class="" href="http://blogs.msdn.com/michkap" mce_href="http://blogs.msdn.com/michkap"><EM><FONT size=1>Michael Kaplan's personal blog</FONT></EM></A><FONT color=#ff0000 size=1><EM> not approved by Microsoft (see </EM></FONT><A class="" href="http://archives.miloush.net/michkap/archive/2008/02/28/7934999.html" mce_href="http://archives.miloush.net/michkap/archive/2008/02/28/7934999.html"><EM><FONT size=1>disclaimer</FONT></EM></A><FONT color=#ff0000 size=1><EM>)!<BR></EM></FONT><EM><FONT color=#ff0000 size=1>Regular readers should keep in mind that all I said in <A class="" href="http://archives.miloush.net/michkap/archive/2008/03/30/8340299.html" mce_href="http://archives.miloush.net/michkap/archive/2008/03/30/8340299.html"><STRONG>The End?</STRONG></A> still applies; the allusion to the X-Files continues for people who understand such references....</FONT></EM></P>
<P>Regular reader Jan Kučera asked over in the Suggestion Box:</P>
<BLOCKQUOTE>
<P><FONT face="times new roman,times"><EM>Hi again,<BR><BR>I know the behaviour I mention here is not problem you can solve, but I'm interested in handling RTL fragments in "plain text". What I've encounted is like this.<BR><BR>I have both IMAP and web access to my e-mail. I don't have a SMTP server, so I send the mails from web and read them in Outlook 2007. One day, I wanted to know the author of Hebrew lyrics to the Maya the Bee song, so I wrote an e-mail to an Izrael TV which had a page about the series. The title of the e-mail was "Maya the Bee (הדבורה מאיה)" and I repeated these words in the message body. Need to say, I have the web mail configured to write plain text e-mails.<BR><BR>The surprise came with the answer. On the web, everything was okay, as I had written it. But in the Outlook, although the title remained ok (the hebrew phrase being selected from right to left), in the message body, I saw הדבורה first, followed by מאיה, letting the user select the row with hebrew text without troubles, char by char, from left to right.<BR><BR>When I copied it and pasted to the notepad, everything was ordered and behaving okay again.<BR><BR>The mail was encoded in 1255 and the sender used Thunderbird 2, but I don't think this is too important since in IE and other applications the text is formatted as it should.<BR><BR>What is more important is the title, encoded as "Subject: Re: Maya the Bee ( =?windows-1255?Q?=E4=E3=E1=E5=F8=E4_=EE=E0=E9?= =?windows-1255?Q?=E4=29?=" which could prevent Outlook from interpreting badly the title too.<BR><BR>E-mail reply was in HTML.<BR><BR>Now, the question is, beside whether this is a bug at all, how could be RTL phrase rendered in LTR, and what could we, as developers, do to avoid this issue in our programs.<BR><BR>PS: The answer to my question is Dan Zakai (דן זכאי). Or... דן and זכאי, as shown by Outlook? :)</EM></FONT></P></BLOCKQUOTE>
<P>It is actually not that hard to discern the relationship between</P>
<BLOCKQUOTE>
<P><FONT size=4>הדבורה מאיה</FONT></P></BLOCKQUOTE>
<P>and the weird part of the string in</P>
<BLOCKQUOTE>
<P><FONT size=1>"Subject: Re: Maya the Bee ( =?windows-1255?Q?=E4=E3=E1=E5=F8=E4_=EE=E0=E9?= =?windows-1255?Q?=E4=29?="</FONT></P></BLOCKQUOTE>
<P>Just&nbsp;look at&nbsp;that <A class="" href="https://www.microsoft.com/globaldev/reference/sbcs/1255.mspx" mce_href="https://www.microsoft.com/globaldev/reference/sbcs/1255.mspx">Windows code page 1255</A> chart:</P>
<UL>
<LI>E4&nbsp;&nbsp;&nbsp; - <A class="" href="http://www.fileformat.info/info/unicode/char/05d4" mce_href="http://www.fileformat.info/info/unicode/char/05d4">U+05d4</A>, aka <STRONG>ה</STRONG>, HEBREW LETTER HE</LI>
<LI>E3&nbsp;&nbsp;&nbsp; - <A class="" href="http://www.fileformat.info/info/unicode/char/05d3" mce_href="http://www.fileformat.info/info/unicode/char/05d3">U+05d3</A>, aka <STRONG>ד</STRONG>, HEBREW LETTER DALET</LI>
<LI>E1&nbsp;&nbsp;&nbsp; - <A class="" href="http://www.fileformat.info/info/unicode/char/05d1" mce_href="http://www.fileformat.info/info/unicode/char/05d1">U+05d1</A>, aka <STRONG>ב</STRONG>, HEBREW LETTER BET</LI>
<LI>E5&nbsp;&nbsp;&nbsp; - <A class="" href="http://www.fileformat.info/info/unicode/char/05d5" mce_href="http://www.fileformat.info/info/unicode/char/05d5">U+05d5</A>, aka <STRONG>ו</STRONG>, HEBREW LETTER VAV</LI>
<LI>F8&nbsp;&nbsp;&nbsp; - <A class="" href="http://www.fileformat.info/info/unicode/char/05e8" mce_href="http://www.fileformat.info/info/unicode/char/05e8">U+05e8</A>, aka <STRONG>ר</STRONG>, HEBREW LETTER RESH</LI>
<LI>E4&nbsp;&nbsp;&nbsp; - <A class="" href="http://www.fileformat.info/info/unicode/char/05d4" mce_href="http://www.fileformat.info/info/unicode/char/05d4">U+05d4</A>, aka <STRONG>ה</STRONG>, HEBREW LETTER HE</LI>
<LI>EE&nbsp;&nbsp;&nbsp; - <A class="" href="http://www.fileformat.info/info/unicode/char/05de" mce_href="http://www.fileformat.info/info/unicode/char/05de">U+05de</A>, aka <STRONG>מ</STRONG>, HEBREW LETTER MEM</LI>
<LI>E0&nbsp;&nbsp;&nbsp; - <A class="" href="http://www.fileformat.info/info/unicode/char/05d0" mce_href="http://www.fileformat.info/info/unicode/char/05d0">U+05d0</A>, aka <STRONG>א</STRONG>, HEBREW LETTER ALEF</LI>
<LI>E9&nbsp;&nbsp;&nbsp; - <A class="" href="http://www.fileformat.info/info/unicode/char/05d9" mce_href="http://www.fileformat.info/info/unicode/char/05d9">U+05d9</A>, aka <STRONG>י</STRONG>, HEBREW LETTER YOD</LI>
<LI>E4&nbsp;&nbsp;&nbsp; - <A class="" href="http://www.fileformat.info/info/unicode/char/05d4" mce_href="http://www.fileformat.info/info/unicode/char/05d4">U+05d4</A>, aka <STRONG>ה</STRONG>, HEBREW LETTER HE</LI>
<LI>29&nbsp;&nbsp;&nbsp; - <A class="" href="http://www.fileformat.info/info/unicode/char/0029" mce_href="http://www.fileformat.info/info/unicode/char/0029">U+0029</A>, aka <STRONG>)</STRONG>, RIGHT PARENTHESIS</LI></UL>
<P>So it is some kind of encoding of text into cp1255 with the text in appropriate logical order that anyone who understands the format should be able to use to decipher the text.</P>
<P>And on the other hand anything that doesn't understand the encoding technique is quite apt to misinterpret it and not show what us expected....</P>
<P>For the body, if whatever control is holding the body knows how to properly use the Unicode Bidi algorithm then it will properly display the text, though the behavior Jan describe that at least some pieces do not know how to interpret the text properly. The fact that it does not corrupt the text makes it somewhat easier to&nbsp;be okay with the interim display issues. :-)</P>
<P>Avoiding this kind of issue? More or less the answer us to avoid processing text in these interim stages, since it is likely way too easy to corrupt the text in the meantime.</P>
<P>Other&nbsp;recent posts of mine like <A class="" href="http://archives.miloush.net/michkap/archive/2008/04/18/8405696.html" mce_href="http://archives.miloush.net/michkap/archive/2008/04/18/8405696.html"><STRONG>this one</STRONG></A> and <A class="" href="http://archives.miloush.net/michkap/archive/2008/04/07/8364480.html" mce_href="http://archives.miloush.net/michkap/archive/2008/04/07/8364480.html"><STRONG>this one</STRONG></A> and <A class="" href="http://archives.miloush.net/michkap/archive/2007/01/06/1421178.html" mce_href="http://archives.miloush.net/michkap/archive/2007/01/06/1421178.html"><STRONG>this one</STRONG></A>&nbsp;jump into the handling of RTL fragments with LTR text and LTR fragments within RTL text. Which is not easy under the best of circumstances though tune in a I might suggest some additional methodologies to consider. :-)</P>
<P mce_keep="true">&nbsp;</P>
<P><FONT color=#ff00ff><EM>This blog brought to you by</EM><FONT size=5> ה </FONT><EM>(<A class="" href="http://www.fileformat.info/info/unicode/char/05d4" mce_href="http://www.fileformat.info/info/unicode/char/05d4">U+05d4</A>, aka HEBREW LETTER HE)</EM></FONT></P>
<hr/><p><a id="8418782" href="#8418782">#</a> <strong>Jan Kučera</strong> on 23 Apr 2008 6:39 AM:</p><div style="margin-left: 1em"><p>Thanks for answering and references.</p>
<p>Actually I get it was encoding in the title, but the way and place it was inserted caused the rendering thing to render it correctly even without the direction marks (I guess the switch to 1255 codepage works as the mark, doesn't it?).</p>
<p>What I've found strange with the selection is that the letters in individual words where actually rendered in the RTL order, just the selection worked from left.</p>
<p>Okay, I've just found the message and tried one thing more, to select only part of the text and paste it into notepad.. wow, it copied different text than selected... :) This really is a bug..but there is no place for us to file it...</p>
<p>Picture for curiosity: <a rel="nofollow" target="_new" href="http://195.122.199.198/Maya.jpg">http://195.122.199.198/Maya.jpg</a></p>
<p>The last thing I found is that for the title, RichEdit20WPT class is used, for the body... ummm... _WwG ... :-D and the whole body html is marked as 1255, no direction marks.</p>
<p>(Ctrl+Insert does not work in this strange control either :'(, by the way)</p>
<p>So If I get your post right, we can't run into this issue if we are using existing controls, like richedit, WinForms, WPF...</p></div>
<hr/><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2008/04/19/8410221.html" title="On the one who was Built on the Tale O&#39; the Twister This Way">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2008/04/18/8405696.html" title="The mythical nature of bidirectional support, and where the wheels come off the wagon">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2008-04">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2008-04-19">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2008/04/19/8409778.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:36 GMT -->
</html>