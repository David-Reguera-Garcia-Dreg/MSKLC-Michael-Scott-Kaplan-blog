<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2008/04/23/8415969.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:36 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>On the clipboard, and why sometimes the dumber you are the better you can do</title></head><body>
<h1>On the clipboard, and why sometimes the dumber you are the better you can do</h1>
<p><em>by Michael S. Kaplan, published on 2008/04/23 10:01 -04:00, original URI: http://blogs.msdn.com/b/michkap/archive/2008/04/23/8415969.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostNew -->
<P><EM><FONT color=#ff0000 size=1>Content of </FONT></EM><A class="" href="http://blogs.msdn.com/michkap" mce_href="http://blogs.msdn.com/michkap"><EM><FONT size=1>Michael Kaplan's personal blog</FONT></EM></A><FONT color=#ff0000 size=1><EM> not approved by Microsoft (see </EM></FONT><A class="" href="http://archives.miloush.net/michkap/archive/2008/02/28/7934999.html" mce_href="http://archives.miloush.net/michkap/archive/2008/02/28/7934999.html"><EM><FONT size=1>disclaimer</FONT></EM></A><FONT color=#ff0000 size=1><EM>)!<BR></EM></FONT><EM><FONT color=#ff0000 size=1>Regular readers should keep in mind that all I said in <A class="" href="http://archives.miloush.net/michkap/archive/2008/03/30/8340299.html" mce_href="http://archives.miloush.net/michkap/archive/2008/03/30/8340299.html">The End?</A> still applies; the allusion to the X-Files continues for people who understand such references....</FONT></EM></P>
<P>Over in the Suggestion Box, Bruce Rusk asked:</P>
<BLOCKQUOTE>
<P><FONT face="times new roman,times">To keep a long story long: I have an application that I need to use--it's a Chinese dictionary that I use daily and would be seriously bummed to live without. It's a badly-designed Foxpro application, targeted to Traditional Chinese Windows (Big-5), and I run it in Windows XP with AppLocale.<BR><BR>It's finicky. It doesn't display quite properly, but well enough to be used. The main issue is with input: there are two ways that I've found to input characters to search:<BR><BR>(1) via the traditional Chinese IME<BR>(2) by pasting ... but only from Notepad. Pasting from any other application (Word, a browser, everything else I've tried) results in question marks in place of the characters. Being able to paste is essential to help look things up from texts.<BR><BR>So my question is: will this rickety train continue to plod along after a Vista upgrade? Is there a way to tell beforehand whether Vista's IME will work and Vista Notepad will have the particular breed of whatever it is (braindeadness?) that makes its clipboard text paste properly? Or is there another way to massage the clipboard into the form this app seems to need?<BR><BR>Thanks!</FONT></P></BLOCKQUOTE>
<P>The rickety train should keep muddling along, especially with either the use of AppLocale (though be sure to read the&nbsp;blog I wrote entitled&nbsp;<A class="" href="http://archives.miloush.net/michkap/archive/2006/10/17/834208.html" mce_href="http://archives.miloush.net/michkap/archive/2006/10/17/834208.html"><STRONG>The version of App Locale that runs on Vista?</STRONG></A> so you know how to get AppLocale on Vista!), or by changing the default system locale to a Traditional Chinese locale&nbsp;-- either way, this non-Unicode application will process the text.</P>
<P>And now we get to the problem, which is that the&nbsp;the dictionary&nbsp;application, which does not know to accept Unicode, is asking for CF_TEXT rather than CF_UNICODETEXT. Many more intelligent applications will register multiple clipboard formats as being available and when your application asks for CF_TEXT, Word (which assumes it knows the exact code page of the system and which registers the formats it accept so it can copy later on demand) is able to give that.</P>
<P>But then silly old Notepad just offers up CF_UNICODETEXT&nbsp;(it is actually even simpler than that but this is close&nbsp;enough for now, maybe I'll get into more later)&nbsp;and lets the system take care of the&nbsp;conversion&nbsp;by creating the text synthetically -- doing its own conversion to CF_TEXT. And since your Dictionary application running under AppLocale assumes the CP_ACP (default system code page) is 950, aka Traditional Chinese. The OS does the conversion and everything is done.</P>
<P>Word and IE and others are skunked by their own cleverness; in providing "better" functionality and not using the default OS clipboard synthetic behavior, these applications do worse!</P>
<P>There is actually no documented way to find out (when <A class="" href="http://msdn2.microsoft.com/library/ms649047.aspx" mce_href="http://msdn2.microsoft.com/library/ms649047.aspx">IsClipboardFormatAvailable</A>(CF_TEXT) returns TRUE) which&nbsp;type&nbsp;of TRUE it means:</P>
<OL>
<LI>REAL TRUE -- an application registered CF_TEXT and put the text into a buffer;</LI>
<LI>PROMISED TRUE -- an application registered CF_TEXT and gave a callback which acts as an IOU for the OS to get the text later;</LI>
<LI>SYNTHETIC TRUE -- an application registered CF_OEMTEXT and/or CF_UNICODETEXT but not CF_TEXT, but the OS knows it can synthesize it later as needed.</LI></OL>
<P>Now the reason that #1 and #2 can be different is left as either an exercise for the student or for some future blog for me to write some day (and yes it is on &nbsp;my list too, with lots of the information I learned from the MSLU days, including how to use CF_LOCALE as well!).</P>
<P>Notepad (or rather the underlying control within it) only knows to send CF_UNICODETEXT, which can work anywhere via #1 when it is requested or #2 when one of the other formats is.</P>
<P>But in the end all hope is not lost and you have two easy workarounds that requires no changes to applications and no external code to be written:</P>
<UL>
<LI>You can change the default system locale to one of those code page 950-using locales, or</LI>
<LI>You can run both your Dictionary application and the other applications under AppLocale using the same locale.</LI></UL>
<P>The former will simply work everywhere, and the latter will work&nbsp;between your Dictionary application and any application you set up to work with it....</P>
<P mce_keep="true">&nbsp;</P>
<P><FONT color=#ff00ff><EM>This blog brought to you by</EM><FONT size=5> អ </FONT><EM>(<A class="" href="http://www.fileformat.info/info/unicode/char/17a2" mce_href="http://www.fileformat.info/info/unicode/char/17a2">U+17a2</A>, aka KHMER LETTER QA)</EM></FONT></P>
<hr/><p><strong>Bruce Rusk</strong> on 23 Apr 2008 6:55 PM:</p><div style="margin-left: 1em"><p>Thanks for the quick (and, as always, entertaining) answer, Michael. I'm glad that I'll be able to keep the program going in the future.</p></div>
<p><strong>Yuhong Bao</strong> on 30 Jul 2010 1:17 PM:</p><div style="margin-left: 1em"><p>Raymond Chen mentioned it:</p>
<p><a rel="nofollow" target="_new" href="http://blogs.msdn.com/b/oldnewthing/archive/2010/06/16/10025539.aspx">blogs.msdn.com/.../10025539.aspx</a></p>
</div>
<hr/><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2008/04/23/8417318.html" title="That brings new meaning to having &quot;a ç-section&quot; (Ãç§), doesn&#39;t it?">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2008/04/22/8415843.html" title="Premature keystroke processing? Don&#39;t worry, it happens to everyone....">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2008-04">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2008-04-23">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2008/04/23/8415969.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:36 GMT -->
</html>