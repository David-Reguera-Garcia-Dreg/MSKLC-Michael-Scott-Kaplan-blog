<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2008/02/28/7934894.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:36 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>Font size scaling -- GDI vs. GDI+</title></head><body>
<h1>Font size scaling -- GDI vs. GDI+</h1>
<p><em>by Michael S. Kaplan, published on 2008/02/28 10:01 -05:00, original URI: http://blogs.msdn.com/b/michkap/archive/2008/02/28/7934894.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostNew -->
<P><EM><FONT color=#ff0000>Please read the <A class="" href="http://archives.miloush.net/michkap/archive/2008/02/28/7934999.html" mce_href="http://archives.miloush.net/michkap/archive/2008/02/28/7934999.html">disclaimer</A>!</FONT></EM></P>
<P>It is probably a good thing that there are people who feel comfortable turning&nbsp;to me to get information from time to time. </P>
<P>And it is probably better for my own peace of mind that even while mired in conflict (such as is hinted at <A class="" href="http://archives.miloush.net/michkap/archive/2008/02/28/7925701.html" mce_href="http://archives.miloush.net/michkap/archive/2008/02/28/7925701.html"><STRONG>here</STRONG></A>!) that they happen to be doing it very recently, since that helps keep up both my resolve to help people and my morale while helping. :-)</P>
<P>Like the other day when that developer who managed to impress me with her insight that led to finding some interesting bugs that I mentioned <A class="" href="http://archives.miloush.net/michkap/archive/2008/01/17/7141157.html" mce_href="http://archives.miloush.net/michkap/archive/2008/01/17/7141157.html"><STRONG>previously</STRONG></A>.</P>
<P>She called the other day to ask me about a problem she was having when it came to the results she was getting back from GDI and GDI+ when trying to retrieve the size of text.</P>
<P>Obviously with two different technologies one could expect some differences, but when the font settings and the text are identical, you really wouldn't expect the differences to be <EM>too</EM> massive, right? I mean shouldn't it boil down to two different techniques that ought to come to nearly the same answer?</P>
<P>She was almost at that "guess it's by design" stage that developers get to when there doesn't seem to be a good explanation for behavior that they might have to live with, but before completely giving up she thought's she'd ask if I had any ideas about what might be behind the differences, which in one of her test cases&nbsp;was leading to two whole characters worth of difference when comparing the two sizes.</P>
<P>I immediately knew what the cause was because it was on my list of things to blog about.</P>
<P>But her call&nbsp;then accidentally saved me from embarrassing myself by actually writing that blog, since it is already explained in something I wrote back in September 2006, in <A class="" href="http://archives.miloush.net/michkap/archive/2006/09/21/765438.html" mce_href="http://archives.miloush.net/michkap/archive/2006/09/21/765438.html"><STRONG>Font sizes vary more than one might expect</STRONG></A>. So far I think I have only made that mistake once and I was quite happy to avoid doing it again. :-)</P>
<P>Many of the underlying issues are covered in the MS Knowledge Base in <A class="" href="http://support.microsoft.com/kb/307208" mce_href="http://support.microsoft.com/kb/307208">307208</A> (Why text appears different when drawn with GDIPlus versus GDI), though the KB article's principal concern is with the unusual drawing results in GDI+ in the many edge cases that lead to narrower or wider glyphs. The basics of how to scale them together are almost out of scope in this rather impressive article!</P>
<P>Anyway, back to that <A class="" href="http://archives.miloush.net/michkap/archive/2006/09/21/765438.html" mce_href="http://archives.miloush.net/michkap/archive/2006/09/21/765438.html"><STRONG>Font sizes vary more than one might expect</STRONG></A>&nbsp;post, it explains the only real&nbsp;workaround one can use for managed applications:</P>
<BLOCKQUOTE>
<P><EM>One workaround that can be used is to ALWAYS request font sizes that will be on the right pixel boundary for GDI -- thus the size that is passed will be the same as the rounded size would be. </EM></P>
<P><EM>Note that this means you have to set the font size at runtime, since the twips and pixel settings can be different depending on runtime settings....</EM></P></BLOCKQUOTE>
<P>The workaround&nbsp;reminds me more than a little bit of the <A class="" href="http://archives.miloush.net/michkap/archive/2005/11/20/494829.html" mce_href="http://archives.miloush.net/michkap/archive/2005/11/20/494829.html"><STRONG>Private fonts: for members only</STRONG></A> blog from November 2005, with the goal of providing sample that would allow manged code to consistently work with private fonts, or that <A class="" href="http://archives.miloush.net/michkap/archive/2007/04/15/2145619.html" mce_href="http://archives.miloush.net/michkap/archive/2007/04/15/2145619.html"><STRONG>Rhymes with Amharic</STRONG></A> series from April of last year that <A class="" href="http://www.hanselman.com/blog/" mce_href="http://www.hanselman.com/blog/">Scott Hanselman</A> inspired me to write about font embedding in managed code.</P>
<P>Given the mixed nature of WinForms, this workaround has a nice holistic feel about it,&nbsp;just as these other two solutions do.</P>
<P>Suggests that it might make an interesting future blog to write up a sample that does the sizing! Sound interesting to anyone?</P>
<P>And then, like Scott suggested with the font embedding sample and I have suggested to others previously about the private fonts sample, this also might actually make for an interesting core feature to consider in WinForms!</P>
<P>Imagine it -- a setting that would automatically adjust the font size at runtime to make sure that all controls (the purely managed ones,&nbsp;the managed wrappers around unmanaged ones, and the managed ones that work through TextRenderer) have a single size that will return consistent results. The only downside to such a feature is that it could easily lead to clipping based on the font size increasing a bit in that quest for the ideal GDI pixel boundary size, but that seems like a small price to pay for controls that have the same font size setting having identically sized text, right? :-)</P>
<P mce_keep="true">&nbsp;</P>
<P><FONT color=#ff00ff><EM>This&nbsp;blog brought to you by</EM><FONT size=5> ржн </FONT><EM>(<A class="" href="http://www.fileformat.info/info/unicode/char/09ad" mce_href="http://www.fileformat.info/info/unicode/char/09ad">U+09ad</A>, aka BENGALI LETTER BHA)</EM></FONT></P>
<hr/><p><strong>Doug</strong> on 28 Feb 2008 10:31 AM:</p><div style="margin-left: 1em"><p>The rendering size of text is indeed tricky.</p>
<p>According to Mr. Hill, the priority for font rendering is readability (which is a good thing).</p>
<p>One cosequence is that the size of output is different for each device. &nbsp;Finding out the exact size that the text will render when sent to the printer has not been easy to find from my web searches. &nbsp;The result is that my screen preview often does not match the printout.</p></div>
<p><strong>Michael S. Kaplan</strong> on 28 Feb 2008 10:38 AM:</p><div style="margin-left: 1em"><P>Hi Doug,</P>
<P>The issue with the difference between the screen and the printer is one I mention <A class="" href="http://archives.miloush.net/michkap/archive/2007/11/07/5958318.html"><STRONG>here</STRONG></A> in an entirely different context (TextRenderer support) but with similar principles....</P></div>
<hr/><p><em>referenced by</em></p><div style="margin-left: 1em"><p>2011/06/10 <a href="http://archives.miloush.net/michkap/archive/2011/06/10/10173190.html">What do fonts and keyboards have in common? Not "crap bag" compatibility!</a></p><p>2008/05/12 <a href="http://archives.miloush.net/michkap/archive/2008/05/12/8490406.html">What happens when you involve an unenabled Uniscribe with vertical text, given that Uniscribe doesn't handle vertical text?</a></p></div><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2008/02/28/7934999.html" title="Disclaimer for Sorting it all Out">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2008/02/28/7925701.html" title="A blog, warning you to please read the disclaimer before looking at this Blog!">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2008-02">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2008-02-28">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2008/02/28/7934894.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:36 GMT -->
</html>