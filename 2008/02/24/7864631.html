<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2008/02/24/7864631.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:36 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>The idea has to do more than just make sense to me (aka How S-Sharp are *you* feeling today?)</title></head><body>
<h1>The idea has to do more than just make sense to me (aka How S-Sharp are *you* feeling today?)</h1>
<p><em>by Michael S. Kaplan, published on 2008/02/24 10:01 -05:00, original URI: http://blogs.msdn.com/b/michkap/archive/2008/02/24/7864631.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostNew -->
<P><EM><FONT color=#ff0000 size=1>I am writing this blog from my own laptop waiting in the ER at the hospital (all of the quotes are from archives of old mails on my machine, not from memory!). It all happened when I was heading back after seeing a show in Ballard last night. By the time you read this I will actually be out again so there is no need to panic. Let's just say that Michael should not push himself too hard (especially when his scooter is in the shop) and leave it at that. I am sure that I am just fine and will probably explain what happened at some point. Crap like this keeps me humble, and anyone who knows me will claim that I can always use more of that....</FONT></EM></P>
<HR>

<P mce_keep="true">Some time near the beginning of the month, Peter Edberg of Apple asked:</P>
<BLOCKQUOTE>
<P mce_keep="true"><FONT face="times new roman,times"><EM>We have had several bug reports at Apple complaining that in case-insensitive string search, U+00DF&nbsp;"ß" matches "ss". Apparently this is&nbsp;due to the following line in CaseFolding.txt:<BR><BR></EM></FONT><FONT face="times new roman,times">&nbsp;&nbsp;&nbsp; 00DF; F; 0073 0073; # LATIN SMALL LETTER SHARP S<BR><BR></FONT><FONT face="times new roman,times"><EM>Isn't this an error? In the Unicode collation data, there is a secondary difference between U+00DF&nbsp;"ß" and "ss". The way I read the&nbsp;Unicode Collation Algorithm, case folding should preserve primary and&nbsp;secondary differences, and only eliminate differences at the tertiary&nbsp;level and below.<BR><BR></EM></FONT><FONT face="times new roman,times"><EM>Am I misunderstanding something?</EM></FONT></P></BLOCKQUOTE>
<P mce_keep="true">Peter is actually spot on here and as usual missing nothing. In fact, this is an issue I have talked about in relation to Windows before (long-time readers may recall&nbsp;<A href="http://archives.miloush.net/michkap/archive/2005/03/10/391564.html"><FONT face=Tahoma><STRONG>Dere are qvestions? In zat <EM>case</EM>...</STRONG></FONT></A> and&nbsp;<A class="" href="http://archives.miloush.net/michkap/archive/2005/04/10/406880.html" mce_href="http://archives.miloush.net/michkap/archive/2005/04/10/406880.html"><STRONG>What the %#$* is wrong with German sorting?</STRONG></A>).</P>
<P mce_keep="true">In any case,&nbsp;regular reader here John Cowan pointed out:</P>
<BLOCKQUOTE>
<P mce_keep="true"><FONT face="times new roman,times"><EM>&gt; We have had several bug reports at Apple complaining that in case-insensitive string search, U+00DF&nbsp;"ß" matches "ss". <BR><BR></EM>It pretty much has to.&nbsp; There is no way to tell (without knowing German) whether any given "SS" in text is an upcased version of "ss" or "ß". Consequently, if you want "SS" and "ss" to match, and likewise "SS" and "ß", then "ss" and&nbsp;"ß" will naturally match too.&nbsp; You could special-case this in code at the expense of making all case-folding slower.<BR><BR><EM>&gt; Isn't this an error? In the Unicode collation data, there is a&nbsp;secondary difference between U+00DF&nbsp;"ß" and "ss". <BR><BR></EM>That's because "ss" is also used as a fallback when&nbsp;"ß" is not available. It is in effect both a secondary and a tertiary difference.<BR><BR>In Unicode 5.1 there will be a capital sharp S, but that is never used in running text, only in all-caps display text, and not always then. So it doesn't solve the problem, which is simply an inescapable quirk of German orthography.&nbsp; (The real answer is not to upcase German, but that battle is long since lost.)</FONT></P></BLOCKQUOTE>
<P mce_keep="true">Microsoft specifically avoids that weirdness of the mixed secondary/tertiary difference, in part because our architecture kind of requires it, though I suspect it would have happened anyway....</P>
<P mce_keep="true">Anyway, Peter responded to John:</P>
<BLOCKQUOTE>
<P mce_keep="true"><EM><FONT face="times new roman,times">John,<BR>Thanks, that makes sense. Ken Whistler (here at the UTC meeting) also&nbsp;just clarified this. He also indicated that a particular&nbsp;implementation of case-insensitive string search could choose a&nbsp;different approach to matching of U+00DF&nbsp;"ß" and "ss" without being&nbsp;non-conformant with Unicode (It would just not be following&nbsp;CaseFolding.txt).</FONT></EM></P></BLOCKQUOTE>
<P mce_keep="true">And also Markus Scherer also added some additional interesting&nbsp;words to the mix:</P>
<BLOCKQUOTE>
<P mce_keep="true"><FONT face="times new roman,times">A couple of years ago I wrote an email to DIN proposing to change DIN 5007 so that ß and ss are a tertiary difference, to make them consistent with mostly being case-different. However, their response was that they see ß more as a ligature, and ligatures sort as secondary differences in DIN 5007. The default UCA table follows DIN 5007 with respect to this as a secondary difference.<BR><BR></FONT><FONT face="times new roman,times">For Unicode case folding, there is really no choice: ß needs to uppercase to SS (at least for most users) which lowercases to ss. Therefore, ß and ss are in the same equivalence class, and that's how case folding is constructed.<BR><BR></FONT><FONT face="times new roman,times">In addition, Germans don't always understand when to use ß vs. ss, and in Switzerland ss is always used instead of ß, so it makes sense for somewhat-lenient string comparisons to equate them.<BR><BR></FONT><FONT face="times new roman,times">In my opinion, treating ß and ss as a case difference is the best behavior for this somewhat messy situation. (I did grow up in Germany,up to and including college.)</FONT></P></BLOCKQUOTE>
<P mce_keep="true">And there you have it!</P>
<P mce_keep="true">Of course the view is likely going to get rockier soon, with Unicode 5.1 and the new CAPITAL SHARP S. The Sharp S and many of the issues surrounding it of course represents an issue that I have been blathering about for some time, considering all of the following prior posts, just for starters....</P>
<UL>
<LI>
<DIV mce_keep="true"><A class="" href="http://archives.miloush.net/michkap/archive/2005/09/25/473632.html" mce_href="http://archives.miloush.net/michkap/archive/2005/09/25/473632.html"><STRONG>Every character has a story #15: CAPITAL SHARP S (not encoded)</STRONG></A></DIV></LI>
<LI>
<DIV mce_keep="true"><STRONG><A class="" href="http://archives.miloush.net/michkap/archive/2007/05/03/2398227.html" mce_href="http://archives.miloush.net/michkap/archive/2007/05/03/2398227.html">Every character has a story #26: CAPITAL SHARP S (might be encoded?)</A></STRONG></DIV></LI>
<LI>
<DIV mce_keep="true"><A class="" href="http://archives.miloush.net/michkap/archive/2007/08/24/4536979.html" mce_href="http://archives.miloush.net/michkap/archive/2007/08/24/4536979.html"><STRONG>Every character has a story #28: U+1e9e (CAPITAL SHARP S)</STRONG></A></DIV></LI></UL>
<P mce_keep="true">That last one has in it my recommended changes for what I think Microsoft (and Windows) ought to do for both case and collation in the next version of Windows, which will be released&nbsp;at some unknown date after <A class="" href="http://www.fileformat.info/info/unicode/char/1e9e" mce_href="http://www.fileformat.info/info/unicode/char/1e9e">U+1e9e</A> (CAPITAL SHARP S) is out there in the upcoming Unicode 5.1, which are:</P>
<BLOCKQUOTE>
<P><EM>For Microsoft, it raises some interesting questions for both collation and case for the next version of Windows.</EM></P>
<P><EM>I mean, think about the issues I have already talked about in posts like </EM><A class="" href="http://archives.miloush.net/michkap/archive/2005/04/10/406880.html" mce_href="http://archives.miloush.net/michkap/archive/2005/04/10/406880.html"><STRONG><EM>What the %#$* is wrong with German sorting?</EM></STRONG></A><EM>&nbsp;where we make <STRONG>ss</STRONG> equal to <STRONG>ß</STRONG> so that the uppercase version "SS" will sort near the ß in a sort ignoring case -- where we do things that make less linguistic sense in order to give regular results that are intuitive.</EM></P>
<P><EM>So who would expect that if </EM><A class="" href="http://www.fileformat.info/info/unicode/char/00df" mce_href="http://www.fileformat.info/info/unicode/char/00df"><EM>U+00df</EM></A><EM>&nbsp;is equal to ss that </EM><A class="" href="http://www.fileformat.info/info/unicode/char/1e9e" mce_href="http://www.fileformat.info/info/unicode/char/1e9e"><EM>U+1e9e</EM></A><EM>&nbsp;wouldn't be made equal to SS? Meaning that in the collation tables, </EM><A class="" href="http://www.fileformat.info/info/unicode/char/00df" mce_href="http://www.fileformat.info/info/unicode/char/00df"><EM>U+00df</EM></A><EM>&nbsp;and </EM><A class="" href="http://www.fileformat.info/info/unicode/char/1e9e" mce_href="http://www.fileformat.info/info/unicode/char/1e9e"><EM>U+1e9e</EM></A><EM>&nbsp;would simply be case variants, with no real choice in the matter.</EM></P>
<P><EM>And as to casing....</EM></P>
<P><EM>Now just because we make the relationship in casing does not mean we make it in collation. After all, as I have pointed out <STRONG><A class="" href="http://archives.miloush.net/michkap/archive/2006/08/08/692390.html" mce_href="http://archives.miloush.net/michkap/archive/2006/08/08/692390.html">several</A></STRONG> </EM><A class="" href="http://archives.miloush.net/michkap/archive/2006/01/11/511557.html" mce_href="http://archives.miloush.net/michkap/archive/2006/01/11/511557.html"><STRONG><EM>times</EM></STRONG></A><EM> before, collation != case.</EM></P>
<P><EM>But on the other hand, the case table is used in order to enforce the case insensitivity in the NT object namespace and the file system. And one clear issue is that there is no good reason to allow one to put filenames differing only by the presence of </EM><A class="" href="http://www.fileformat.info/info/unicode/char/00df" mce_href="http://www.fileformat.info/info/unicode/char/00df"><EM>U+00df</EM></A><EM>&nbsp;and </EM><A class="" href="http://www.fileformat.info/info/unicode/char/1e9e" mce_href="http://www.fileformat.info/info/unicode/char/1e9e"><EM>U+1e9e</EM></A><EM>&nbsp;in the same directory. Users would either never try it or they would never expect it to work. So it is quite possible that in the next version of Windows (which only does simple casing) it may make the most sense to make the two characters case variants of each other -- to enforce reasonable use of&nbsp;both letters!</EM></P></BLOCKQUOTE>
<P mce_keep="true">The collation change is kind of obvious -- what else could it be, ever?</P>
<P mce_keep="true">The casing change is a bit more controversial, though, since it does not technically match Unicode. </P>
<P mce_keep="true">Though since the simple casing requirements of Windows where the length can never change keep&nbsp;<STRONG>SS</STRONG> from ever being an option there, and in a case insensitive file system the notion of putting the lower and uppercase variants of the character in the same directory just feels like the wrong answer. Having these&nbsp;four entities:</P>
<UL>
<LI>
<DIV mce_keep="true"><A class="" href="http://www.fileformat.info/info/unicode/char/00df" mce_href="http://www.fileformat.info/info/unicode/char/00df">U+00df</A>&nbsp;(LATIN SMALL LETTER SHARP S)</DIV></LI>
<LI>
<DIV mce_keep="true"><A class="" href="http://www.fileformat.info/info/unicode/char/1e9e" mce_href="http://www.fileformat.info/info/unicode/char/1e9e">U+1e9e</A>&nbsp;(LATIN CAPITAL LETTER SHARP S)</DIV></LI>
<LI>
<DIV mce_keep="true"><A class="" href="http://www.fileformat.info/info/unicode/char/0073" mce_href="http://www.fileformat.info/info/unicode/char/0073">U+0073</A> <A class="" href="http://www.fileformat.info/info/unicode/char/0073" mce_href="http://www.fileformat.info/info/unicode/char/0073">U+0073</A>&nbsp;(LATIN SMALL LETTER S, x 2)</DIV></LI>
<LI>
<DIV mce_keep="true"><A class="" href="http://www.fileformat.info/info/unicode/char/0053" mce_href="http://www.fileformat.info/info/unicode/char/0053">U+0053</A> <A class="" href="http://www.fileformat.info/info/unicode/char/0053" mce_href="http://www.fileformat.info/info/unicode/char/0053">U+0053</A>&nbsp;(LATIN&nbsp;CAPITAL LETTER S, x 2)</DIV></LI></UL>
<P mce_keep="true">all be the same in collation (when ignoring case distinctions)&nbsp;and having both&nbsp;the first two&nbsp;paired to each other and the second two&nbsp;paired to to each other in the casing tables just makes sense -- anything else will lead to unintuitive results in normal situations -- and those variations would amount to genuine bugs from a user and a linguistic&nbsp;standpoint....</P>
<P mce_keep="true">Now of course I am the developer owner of neither case nor collation at this point, which means that having it make sense to me is not necessarily the principal criteria to having the idea championed and eventually seeing the behavior updated in either case or collation. </P>
<P mce_keep="true">But I do still chat with the various owners in development, program management, and test&nbsp;from time to time.</P>
<P mce_keep="true">And some of them even read this blog now and again....</P>
<P mce_keep="true">So they will at least have the opportunity to have my opinion on the matter. :-)</P>
<P mce_keep="true">&nbsp;</P>
<P mce_keep="true"><FONT color=#ff00ff><EM>This blog brought to you by the ever-popular</EM><FONT size=5> ẞ </FONT></FONT><EM><FONT color=#ff00ff>(<A class="" href="http://www.fileformat.info/info/unicode/char/1e9e" mce_href="http://www.fileformat.info/info/unicode/char/1e9e">U+1e9e</A>, aka LATIN CAPITAL LETTER SHARP S)</FONT></EM></P>
<hr/><p><strong>John Cowan</strong> on 24 Feb 2008 4:43 PM:</p><div style="margin-left: 1em"><p>You might want to fix the encoding in my part of the text sometime. &nbsp;I don't know how that happened.</p>
<p>The important issue around capital sharp-S is that the uppercasing of ordinary sharp-S shouldn't be changed: the simple uppercasing should be to itself, the full uppercasing should be to SS. &nbsp;We need that not only for backward compatibility, but because it's what normal German text does.</p>
<p>After that, everything else can be natural: lowercasing capital sharp-S can provide ordinary sharp-S.</p></div>
<p><strong>Michael S. Kaplan</strong> on 24 Feb 2008 4:58 PM:</p><div style="margin-left: 1em"><p>On Windows, one-way casing does not work, and is a bad idea. Casing has to go in both directions. And stability there does allow one to add mappings if new characters are added, as they were here....</p>
<p>What is wrong with the encoding? It looks the same for me as it did in the email.</p>
</div>
<p><strong>Michael S. Kaplan</strong> on 24 Feb 2008 6:26 PM:</p><div style="margin-left: 1em"><p>One other important note is that the case insensitivity on Windows is designed to be case PRESERVING -- so that if you had the lowercase letter then it will stay that way; it will not become the uppercase one. All that the table entry will do is keep people from using both letters in the same directory, the same way that it stops &quot;AAA&quot; and &quot;aaa&quot; from both being there....</p>
</div>
<p><strong>John Cowan</strong> on 28 Feb 2008 2:52 PM:</p><div style="margin-left: 1em"><p>Your browser is too forgiving, then (as is mine, but less so).</p>
<p>Looking at the raw HTML, most of the sharp-S characters are mis-encoded as a C3 byte followed by &quot;&amp;#376;&quot; instead of a C3 byte followed by a 9F byte. &nbsp;Apparently both of us see this as a sharp-S instead of an encoding error mark followed by a LATIN CAPITAL LETTER Y WITH DIAERESIS.</p>
<p>But then in the quotation from me, the sharp-S is encoded with *three* bytes, EF BF BD, which is U+FFFD, the REPLACEMENT CHARACTER. &nbsp;I have no idea where or how that got inserted into the text.</p>
<p>My point about stability is that it's Just Wrong to convert a sharp-S into a capital sharp-S when uppercasing; it should always become SS unless the user requests otherwise.</p></div>
<p><strong>Michael S. Kaplan</strong> on 29 Feb 2008 11:41 AM:</p><div style="margin-left: 1em"><P>Okay, I think it is better now...</P>
<P>But in any case, Microsoft never did the upcase Sharp s to SS thing in its casing table, so there is no backcompat break in what I am suggesting. and given the case-preserving nature of Windows no existing text will be broken by the addition.</P></div>
<p><strong>John Cowan</strong> on 4 Mar 2008 1:19 PM:</p><div style="margin-left: 1em"><p>Treating standard and capital sharp-S as the same under folding is very sensible: what I am objecting to is changing sharp-S to capital sharp-S when you are explicitly converting to uppercase. &nbsp;If you don't convert it to SS, at least leave it alone. &nbsp;Capital sharp-S is a display freak, and should never appear unless explicitly asked for.</p></div>
<p><strong>Michael S. Kaplan</strong> on 4 Mar 2008 1:32 PM:</p><div style="margin-left: 1em"><p>Unless the Germans want it that way in a few years? :-)</p>
<p>The platform does not have the option of providing the functionality unless this entry is added -- it is like the ss=sharp s issue I have blogged about in the past -- yes, people can object, but if it is not there then what they do want in comparisons (won't be able to happen. So this is a building block piece that is crucial to the functionality...</p>
</div>
<hr/><p><em>referenced by</em></p><div style="margin-left: 1em"><p>2009/07/28 <a href="http://archives.miloush.net/michkap/archive/2009/07/28/9850675.html">Every character has a story #32: U+1e9e (CAPITAL SHARP S, Microsoft edition - Part 1)</a></p><p>2008/05/15 <a href="http://archives.miloush.net/michkap/archive/2008/05/15/8506679.html">A celebration of the LATIN CAPITAL LETTER SHARP S</a></p><p>2008/04/15 <a href="http://archives.miloush.net/michkap/archive/2008/04/15/8396598.html">Kind of ironic how Germany seems so okay with Capital *Letter* punishment, huh?</a></p></div><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2008/02/24/7876678.html" title="How to get it done if Microsoft does not do it?">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2008/02/23/7861817.html" title="Despite progression, the bug calls out to me quite LAOdly">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2008-02">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2008-02-24">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2008/02/24/7864631.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:36 GMT -->
</html>