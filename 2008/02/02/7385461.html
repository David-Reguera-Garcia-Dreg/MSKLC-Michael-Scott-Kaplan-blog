<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2008/02/02/7385461.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:36 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>[Confusing functionality] + [New features] = [Documentation that can be confusing]</title></head><body>
<h1>[Confusing functionality] + [New features] = [Documentation that can be confusing]</h1>
<p><em>by Michael S. Kaplan, published on 2008/02/02 10:16 -05:00, original URI: http://blogs.msdn.com/b/michkap/archive/2008/02/02/7385461.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostNew -->
<P>The question that came in:</P>
<BLOCKQUOTE>
<P><EM><FONT face="times new roman,times">...problems with the Alt Gr Key on the German keyboard layout under Windows 2000/XP but it works under Windows Vista. <BR><BR>Function calls:<BR>&nbsp;&nbsp;&nbsp; IntPtr vHkl = Win32Api.GetKeyboardLayout(Win32Api.GetWindowThreadProcessId(Win32Api.GetForegroundWindow(), IntPtr.Zero)); <BR>&nbsp;&nbsp;&nbsp; Keys virtualKey = Win32Api.MapVirtualKeyEx(0xe038, 3, vHkl); <BR><BR>Details regarding the function calls above:<BR>* &nbsp;Win32Api is customer’s own P/Invoke wrapper class around the Win32 API. <BR>*&nbsp; His current keyboard layout is Swiss German. <BR>* &nbsp;0xe038 is an extended 2 byte scancode for the Right Alt key (=Alt Gr) <BR>*&nbsp; 3 represents MAPVK_VSC_TO_VK_EX which is supposed to differentiate between left and right keys <BR>*&nbsp; vHkl is the keyboard layout handle to the foreground window. <BR><BR>Problem:<BR>*&nbsp;&nbsp;On Vista MapVirtualKey returns Keys.RMenu which is correct. <BR>*&nbsp;&nbsp;On XP/2000 it returns Keys.None (0) which is wrong.<BR><BR>Is this a known problem?&nbsp; Is there a work around?</FONT></EM></P></BLOCKQUOTE>
<P>My pre-processing thought was that it was <STRONG>not</STRONG> that the left key and the right key are different <EM>per se</EM>; it was the difference between the left alt and the right alt (which is also ALTGR, which is also CTRL+ALT). So the easiest workaround is to do CTRL+ALT to get what one wants, as this will work in all platforms.</P>
<P><EM>(Notice how the new feature provides a way for a whole generation of developers who have never heard of CTRL+ALT to find a whole new way to get at the longstanding functionality?)</EM></P>
<P>But the generic issue is still true in regard to new Vista functionality either way (even for some keys other than the ALTGR key).</P>
<P>Regular readers might see what is going on here if they remember an older blog (<A class="" href="http://archives.miloush.net/michkap/archive/2006/08/29/729476.html" mce_href="http://archives.miloush.net/michkap/archive/2006/08/29/729476.html"><STRONG>When you think it couldn't get any harder, it gets easier</STRONG></A>, where I reference how to do all of this the harder, indirect way like before this new functionality was added in Vista, in <A href="http://archives.miloush.net/michkap/archive/2006/04/12/575080.html"><STRONG>Getting all you can out of a keyboard layout, Part #9a</STRONG></A>).</P>
<P>My first thought (and indeed my first response)&nbsp;was that they should have read the documentation more carefully - this is new functionality.</P>
<P>But you can kind of see the problem here -- although the function is documented as being able to distinguish between right and left keys, it cannot do so when the difference between their scan codes is one of those extended codes (which is listed as a &gt;= Vista functionality)&nbsp;-- the very example that the new functionality was added to address.</P>
<P>This led to my second thought -- that I should report it as a documentation bug to get the issue clarified.</P>
<P>But to be perfectly honest, I have been wracking my brain trying to figure out what should be said to clarify all of this that will not confuse it further for the majority of people.</P>
<P>The issue is so uncommon that it seems scary to try to try to cover it in a place where it is almost never needed.</P>
<P>I'll report it anyway, I think -- a note explaining the case where this is important like the ALTGR case (which itself has an easier workaround anyway)....</P>
<P mce_keep="true">&nbsp;</P>
<P><FONT color=#ff00ff><EM>This post brought to you by</EM><FONT size=5> ஃ </FONT><EM>(<A class="" href="http://www.fileformat.info/info/unicode/char/0b83" mce_href="http://www.fileformat.info/info/unicode/char/0b83">U+0b83</A>, aka TAMIL SIGN VISARGA [sic])</EM></FONT></P>
<hr/><div style="margin-left: 1em"><em>no comments</em></div><hr/><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2008/02/03/7413169.html" title="When exactly will we take a hint about all of that keyboard cord cutting stuff?">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2008/02/02/7383730.html" title="Bangalore or Bengaluru (Bengalūru)?">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2008-02">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2008-02-02">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2008/02/02/7385461.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:36 GMT -->
</html>