<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2008/07/01/8674304.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:36 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>Is that character in the font or isn't it?</title></head><body>
<h1>Is that character in the font or isn't it?</h1>
<p><em>by Michael S. Kaplan, published on 2008/07/01 10:01 -04:00, original URI: http://blogs.msdn.com/b/michkap/archive/2008/07/01/8674304.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostNew -->
<P>Regular reader Yaytay asks over in the Suggestion Box:</P>
<BLOCKQUOTE>
<P><EM><FONT face="times new roman,times">How can I find out, from code, (reliably and completely:-) ) which fonts support a given character?<BR><BR>I've tried using GetGlyphIndices, but there are still some fonts that return non-zero values for glyphs they don't have.<BR><BR>My comment from your blog here: </FONT></EM><A class="" href="http://archives.miloush.net/michkap/archive/2007/01/31/1563080.html" mce_href="http://archives.miloush.net/michkap/archive/2007/01/31/1563080.html"><EM><FONT face="times new roman,times">http://blogs.msdn.com/michkap/archive/2007/01/31/1563080.aspx</FONT></EM></A><EM><FONT face="times new roman,times"> <BR><BR>The utility converts a regex into a list of unicode characters (based on their name) and then when you select one of those characters it displays that character in all installed fonts that support the character.<BR><BR>It is based on the GetGlyphIndices function.<BR><BR>Unfortunately some fonts return a non-zero value for a given character, but don't actually support it (displaying the default rectangle when used).<BR><BR>Is there a more reliable way to determine support for a code-point in a font?<BR><BR>When I've got this utility working more reliably I'll make it available if anyone wants it.</FONT></EM></P></BLOCKQUOTE>
<P>Rather than using <A class="" href="http://msdn.microsoft.com/library/ms534010.aspx" mce_href="http://msdn.microsoft.com/library/ms534010.aspx">GetGlyphIndices</A>, I always found myself using <A class="" href="http://msdn.microsoft.com/library/ms534013.aspx" mce_href="http://msdn.microsoft.com/library/ms534013.aspx">GetGlyphOutline</A>, instead.</P>
<P>The bias probably comes from the work I did in MSLU to support GetGlyphOutlineW on Win9x platforms, that I&nbsp;mentioned a few years back in <A class="" href="http://archives.miloush.net/michkap/archive/2006/02/13/530814.html" mce_href="http://archives.miloush.net/michkap/archive/2006/02/13/530814.html"><STRONG>Getting all of the localized names of a font</STRONG></A>, to date the blog that still gets the most <A class="" href="http://www.fileformat.info/info/unicode/char/fffd" mce_href="http://www.fileformat.info/info/unicode/char/fffd">U+fffd</A>-filled spam comments....</P>
<P>Though if <A class="" href="http://msdn.microsoft.com/library/ms534010.aspx" mce_href="http://msdn.microsoft.com/library/ms534010.aspx">GetGlyphIndices</A> is mapping code points to the notdef glyph, then <A class="" href="http://msdn.microsoft.com/library/ms534013.aspx" mce_href="http://msdn.microsoft.com/library/ms534013.aspx">GetGlyphOutline</A> might be as well. So this my or may not be a solution.</P>
<P>Perhaps you could take the hint from <A class="" href="http://archives.miloush.net/michkap/archive/2006/02/13/530814.html" mce_href="http://archives.miloush.net/michkap/archive/2006/02/13/530814.html"><STRONG>Getting all of the localized names of a font</STRONG></A>&nbsp;and grab the CMAP directly.</P>
<P>Or even better try by a different&nbsp;route --&nbsp;via a <A class="" href="http://msdn.microsoft.com/library/ms776482.aspx" mce_href="http://msdn.microsoft.com/library/ms776482.aspx">ScriptGetCMap</A> call? Though this could get expensive across all of Unicode, across all fonts.</P>
<P>But as the PSDK topic describes all of the information about dealing with the default glyph (aka the NOTDEF glyph), at least the function has given things some thought:</P>
<BLOCKQUOTE>
<P><FONT face="times new roman,times">This function can be used to determine the characters in a run that are supported by the selected font. The application can scan the retrieved glyph buffer, looking for the default glyph to determine characters that are not available. The application should determine the default glyph index for the selected font by calling </FONT><A class="" href="http://msdn.microsoft.com/library/ms776470.aspx" mce_href="http://msdn.microsoft.com/library/ms776470.aspx"><FONT face="times new roman,times">ScriptGetFontProperties</FONT></A><FONT face="times new roman,times">.</FONT></P>
<P><FONT face="times new roman,times">The return value for this function indicates the presence of any missing glyphs.</FONT></P>
<P><FONT face="times new roman,times">Some code points can be rendered by a combination of glyphs, as well as by a single glyph, for example, 00C9; LATIN CAPITAL LETTER E WITH ACUTE. In this case, if the font supports the capital E glyph and the acute glyph, but not a single glyph for 00C9, <A class="" href="http://msdn.microsoft.com/library/ms776482.aspx" mce_href="http://msdn.microsoft.com/library/ms776482.aspx">ScriptGetCMap</A> shows that 00C9 is unsupported. To determine the font support for a string that contains these kinds of code points, the application can call </FONT><A class="" id=ctl00_rs1_mainContentContainer_ctl05 href="http://msdn.microsoft.com/library/ms776517.aspx" mce_href="http://msdn.microsoft.com/library/ms776517.aspx"><FONT face="times new roman,times">ScriptShape</FONT></A><FONT face="times new roman,times">. If the function returns S_OK, the application should check the output for missing glyphs.</FONT></P></BLOCKQUOTE>
<P mce_keep="true">Kind of gives a roadmap to how to think about the problem, and inspires some confidence that they are on the right track. :-)</P>
<P mce_keep="true">&nbsp;</P>
<P mce_keep="true"><FONT color=#ff00ff><EM>This post brought to you by</EM> <FONT size=5>ï¿½</FONT> <EM>(</EM><A class="" href="http://www.fileformat.info/info/unicode/char/fffd" mce_href="http://www.fileformat.info/info/unicode/char/fffd"><EM>U+fffd</EM></A><EM>, a.k.a. REPLACEMENT CHARACTER)</EM></FONT></P>
<hr/><p><strong>Andrew West</strong> on 1 Jul 2008 11:27 AM:</p><div style="margin-left: 1em"><p>If GetGlyphIndices is returning a non-zero glyph index then the font must have a glyph for the character, and grabbing the CMAP directly will not help.</p>
<p>I think the problem is that some fonts define individual square box glyphs for some characters that are in the CMAP but that aren't supported -- although the resultant glyph looks like the NOTDEF glyph it isn't. The only way round this is to get the glyph outline for the character you are interested in, and compare it with the glyph outline for the NOTDEF glyph -- and if they are the same then you can exclude that character for that font ... assuming that there are no subtle differences between the real NOTDEF glyph and the fake ones.</p></div>
<p><strong>Tihiy</strong> on 1 Jul 2008 2:30 PM:</p><div style="margin-left: 1em"><p>GetGlyphIndicesW does exactly what KB241020 does. Are you the author of KB241020?</p></div>
<p><strong>Michael S. Kaplan</strong> on 1 Jul 2008 3:51 PM:</p><div style="margin-left: 1em"><p>I am not the author of 241020, no. Though I implemented a cleaned up version of the code there for MSLU's GetGlyphOutlineW wrapper to do its work....</p>
</div>
<p><strong>Yaytay</strong> on 14 Nov 2009 4:28 AM:</p><div style="margin-left: 1em"><p>I said I'd make it available, it's just taken me a little while to get around to it.</p>
<p>If anyone is interested in a tool for finding which fonts contain a non-default glyph for a given code point have a look: <a rel="nofollow" target="_new" href="http://yaytay.wordpress.com/category/stuff-and-things/">http://yaytay.wordpress.com/category/stuff-and-things/</a></p></div>
<hr/><p><em>referenced by</em></p><div style="margin-left: 1em"><p>2009/09/24 <a href="http://archives.miloush.net/michkap/archive/2009/09/24/9898852.html">Can I show the whole string or can't I?</a></p></div><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2008/07/01/8675015.html" title="Oceania is at war with WM_SETTINGCHANGE; Oceania has always been at war with WM_SETTINGCHANGE">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2008/06/30/8669810.html" title="Give people their SPACE, and most of the time they still go with the defaults">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2008-07">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2008-07-01">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2008/07/01/8674304.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:36 GMT -->
</html>