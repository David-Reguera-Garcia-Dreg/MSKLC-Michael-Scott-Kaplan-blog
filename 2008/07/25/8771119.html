<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2008/07/25/8771119.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:36 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>Let's save some time and call them all IRregular expression engines</title></head><body>
<h1>Let's save some time and call them all IRregular expression engines</h1>
<p><em>by Michael S. Kaplan, published on 2008/07/25 03:01 -04:00, original URI: http://blogs.msdn.com/b/michkap/archive/2008/07/25/8771119.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostNew -->
<P>Way back in December of 2007, aaron asked in the Suggestion Box:</P>
<BLOCKQUOTE>
<P><FONT face="times new roman,times">Your recent In </FONT><A class="" href="http://archives.miloush.net/michkap/archive/2007/12/06/6661053.html"><FONT face="times new roman,times">SQL Server, A-Z [...] might not mean the same thing</FONT></A><FONT face="times new roman,times">: <BR><BR>It got me thinking, a whole post dedicated to the problems of mixing regular expressions and i18n would be very interesting. &nbsp;Some questions i've always woried about but never tested:</FONT></P>
<UL>
<LI><FONT face="times new roman,times">'\b' word boundaries, do they incorrectly show up when surrogate pairs or combining characters are involved? </FONT></LI>
<LI><FONT face="times new roman,times">'\b' word boundaries, are there / should there be characters that form word boundaries only sometimes. &nbsp;It's plausible in some interpretations that "hy-phen" has only two word boundaries, at the begining and end, but in reality is has 4, as '-' is not a '\w' character. &nbsp;But do other unicode characters have some sort of weird identity.</FONT></LI>
<LI><FONT face="times new roman,times">If i have an accented character as two code points (combining), does / should '.' (or '?' in Win32 regex) match the character and the accent, or just the base character?</FONT></LI>
<LI><FONT face="times new roman,times">how wide is the definition of '\w' word character? &nbsp;Does it / should it ever change based on the current user locale/language?</FONT></LI></UL>
<P><FONT face="times new roman,times">Most importantly</FONT></P>
<UL>
<LI><FONT face="times new roman,times">how likely is your average regular expression going to be i18n unsafe? &nbsp;what are the common pitfalls to avoid?</FONT></LI></UL>
<P><FONT face="times new roman,times">Note: for 'should / does', i'm asking all of (a) what do you (Michael Kaplan) think it _should_ do, and (b) what do some common implementations do (for instance, the .Net System.Text.RegularExpressions.Regex class, or the new TR1 regex in Visual Studio 2008, or Win32 with FindFirstFile and friends)<BR><BR>(Oh, and your blog is awesome!)<BR><BR>#aaron</FONT></P></BLOCKQUOTE>
<P mce_keep="true">Hopefully the long delay before I got to responding did not change his opinion of the blog. :-)</P>
<P mce_keep="true">I'll start off with a quote from <A class="" href="http://en.wikipedia.org/wiki/Jamie_Zawinski" mce_href="http://en.wikipedia.org/wiki/Jamie_Zawinski">Jamie Zawinski</A>:</P>
<BLOCKQUOTE>
<P mce_keep="true"><EM><FONT size=3>Some people, when confronted with a problem, think "I know, I'll use regular expressions." Now they have two problems.</FONT></EM></P></BLOCKQUOTE>
<P mce_keep="true">This is to help set expectations realistically. :-)</P>
<P mce_keep="true">I'll start by saying that most modern regular expression implementations do&nbsp;have certain features that are particularly good for internationalization, such as Unicode storage semantics. Such features are pretty much essential in most cases. Some of them build in Unicode property type information and most of those keep up with recent versions of Unicode.</P>
<P mce_keep="true">With that said, most of the ones that I have worked with are otherwise very primitive, not properly handling Unicode normalization/canonical equivalence, known in .NET as the "text element" semantic. This leads to some problems with Aaron's first and&nbsp;third points above with sequences of characters that should be treated&nbsp;as equivalent to some other character or sequence.</P>
<P mce_keep="true">Most also have no notion of exceptional cases such as the one in Aaron's second point above -- to support these things you have to build up complex expressions to try to handle the exceptional cases. If one is lucky they are included in samples, but usually only the very simplest ones tend to be built in.</P>
<P mce_keep="true">And none that I have ever worked with properly handle locale specific differences, the thing that I have referred to here in the blog as "sort elements" -- what users in a particular language think of as a single character, the kind of thing that Aaron hints at in the fourth point above.</P>
<P mce_keep="true"><EM>For more on sort elements and text elements, blogs of mine like <A class="" href="http://archives.miloush.net/michkap/archive/2005/07/19/440320.html" mce_href="http://archives.miloush.net/michkap/archive/2005/07/19/440320.html"><STRONG>Sort element vs. text element</STRONG></A> are a good place to start.</EM></P>
<P mce_keep="true">The theory of all of that good property support often runs into the kinds of problems&nbsp;described in <A class="" href="http://archives.miloush.net/michkap/archive/2007/04/26/2286153.html" mce_href="http://archives.miloush.net/michkap/archive/2007/04/26/2286153.html"><STRONG>No Regex in the Unicode room! (and no sex in the champagne room, either!)</STRONG></A> and&nbsp;<A class="" href="http://archives.miloush.net/michkap/archive/2007/09/11/4873992.html" mce_href="http://archives.miloush.net/michkap/archive/2007/09/11/4873992.html"><STRONG>4400 (*not* 'The 4400')</STRONG></A> and <A class="" href="http://archives.miloush.net/michkap/archive/2007/04/26/2290760.html" mce_href="http://archives.miloush.net/michkap/archive/2007/04/26/2290760.html"><STRONG>'The 44' (*not* 'The 4400')</STRONG></A>, where what the engine does manges to fall short of what one might expect from an implementer of information coming out of the Unicode Character Database....</P>
<P mce_keep="true">And I'm not going to pick on Microsoft's implementation, which is probably about average here. Most suffer from the complicated nature of the data in the UCD when their comparatively simplistic implementation tries to use the data.</P>
<P mce_keep="true">Which then leads to the last question, the one about how common the "i18n unsafe" expression problem might be expected to come up. On the whole, I expect it is way more common than people realize, as the nature of the more complicated cases requires built-in expressions much more complicated than the definitions that are usually present....</P>
<P mce_keep="true">An ideal implementation <EM>plan</EM> for such an engine is covered in <A class="" href="http://www.unicode.org/reports/tr18/" mce_href="http://www.unicode.org/reports/tr18/">Unicode Technical Standard #18: Unicode Regular Expressions</A>, whose own summary states: "This document describes guidelines for how to adapt regular expression engines to use Unicode." Though many fall short of that ideal here (the only reason I don't say <STRONG>all</STRONG> here is that I have not tested every engine out there, but all the ones I have used and/or dabbled with and/or tested have issues).</P>
<P mce_keep="true">Now going back to that original series of blogs about SQL Server, it is clear that&nbsp;problems I point out in that series and in posts like <A class="" href="http://archives.miloush.net/michkap/archive/2006/10/04/788429.html" mce_href="http://archives.miloush.net/michkap/archive/2006/10/04/788429.html"><STRONG>Wild[card] thing, You make my CHAR sing</STRONG></A> and <A class="" href="http://archives.miloush.net/michkap/archive/2007/01/15/1469885.html" mce_href="http://archives.miloush.net/michkap/archive/2007/01/15/1469885.html"><STRONG>With SQL Server (and SQL itself) comes the illogic of 'trailing spaces' (and the myth of fixed width)</STRONG></A> are more than anything else to do with SQL Server choosing to draw that line between appropriate behavior and simple definitional consistency in a better place that regular expressions tend to do. Which leads to&nbsp;inconsistencies in the documentation and limitations/flaws in the syntax (which was not made to handle things this complex either).</P>
<P mce_keep="true">I must admit that I find myself more comfortable with where SQL Server sits here, rather than where regular expressions do. :-)</P>
<P mce_keep="true">&nbsp;</P>
<P mce_keep="true"><FONT color=#ff00ff><EM>This blog brought to you by</EM><FONT size=7> ‡¶ê </FONT><EM>(U+0990, aka BENGALI LETTER AI)</EM></FONT></P>
<hr/><p><a id="8772350" href="#8772350">#</a> <strong>John Cowan</strong> on 25 Jul 2008 11:18 AM:</p><div style="margin-left: 1em"><p>I think the JWZ witticism should be thus:</p>
<p>Some people, when confronted with a problem, think, &quot;I know! &nbsp;I'll use a computer.&quot; &nbsp;Now they have 10,000 problems.</p>
<p>It's pretty remarkable that since about 1965 the use of computers has not improved the productivity of the U.S. workforce one iota.</p></div>
<p><a id="8772356" href="#8772356">#</a> <strong>Michael S. Kaplan</strong> on 25 Jul 2008 11:22 AM:</p><div style="margin-left: 1em"><p>Depends on the definition of improved, maybe? :-)</p>
</div>
<p><a id="8773517" href="#8773517">#</a> <strong>Bradley Grainger</strong> on 25 Jul 2008 8:23 PM:</p><div style="margin-left: 1em"><p>To (partly) answer Aaron's question (b), from my experimentation, it appears that the .NET Regex class is pretty closely tied to the UTF-16 encoding used by .NET strings, and doesn't fulfil &quot;Level 1: Basic Unicode Support&quot; as defined by UTS #18. (Thanks for the link to that; it's a great reference when discussing this area.) I just blogged yesterday about problems you'll encounter with .NET regular expressions if you have strings containing non-BMP characters: <a rel="nofollow" target="_new" href="http://code.logos.com/blog/2008/07/net_regular_expressions_and_unicode.html">http://code.logos.com/blog/2008/07/net_regular_expressions_and_unicode.html</a></p></div>
<p><a id="8775175" href="#8775175">#</a> <strong>int19h</strong> on 26 Jul 2008 6:11 AM:</p><div style="margin-left: 1em"><P>Looks like we've got a ticket on Connect open about this now:</P>
<P><A href="https://connect.microsoft.com/VisualStudio/feedback/ViewFeedback.aspx?FeedbackID=357780" target=_new rel=nofollow>https://connect.microsoft.com/VisualStudio/feedback/ViewFeedback.aspx?FeedbackID=357780</A></P></div>
<hr/><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2008/07/25/8771255.html" title="Behold the Table Driven Text Service, Part 13 (Sinhalification proclamation!)">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2008/07/24/8768909.html" title="When you assess, you make an...">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2008-07">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2008-07-25">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2008/07/25/8771119.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:36 GMT -->
</html>