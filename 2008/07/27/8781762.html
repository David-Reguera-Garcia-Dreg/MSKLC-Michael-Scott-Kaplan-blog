<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2008/07/27/8781762.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:36 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>And you think finding presidential candidates is hard? Try getting the Vista IME candidate list!</title></head><body>
<h1>And you think finding presidential candidates is hard? Try getting the Vista IME candidate list!</h1>
<p><em>by Michael S. Kaplan, published on 2008/07/27 21:39 -04:00, original URI: http://blogs.msdn.com/b/michkap/archive/2008/07/27/8781762.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostNew -->
<P>Allan asks via the Contact link:</P>
<BLOCKQUOTE>
<P><FONT face="times new roman,times">Hi, Michael;<BR><BR>Thanks for a great blog; it's the most insightfull (and honest) look at the whole IME business. I remember running into a Mr Kaplan at one of the Microsoft Game Meltdown events; is that part of your past, before respectability and keyboards?<BR><BR>Anyways; I'm trying to port our IME code for a fullscreen D3D8 application (yes, I know.. we're almost pre-historic, but sadly we make casual games, and to that audience, DX8 is cutting edge). We're having a pain of a time getting IME to work on Vista using the IMM framework, but since functions like ImmGetCandidateListW are broken (returns with no response).<BR><BR>Are we going to need to rewrite everything to use TSF (in all it's undocumented glory?), or are there ways to beat this beast into submission.<BR><BR>Thanks,<BR>Allan</FONT></P></BLOCKQUOTE>
<P>At the time when I wrote most of my previous comments I was unaware of it, but I have since found out that the original Input Method Manager (IMM) based IME samples won't actually compile with the header files from the Vista SDK or the Vista version of the Platform SDK. and none of the IMEs that ship with Windows rely on the IMM API.</P>
<P>Now&nbsp;for a few features&nbsp;the IMM API&nbsp;provides interesting shortcuts into getting information, and there is a huge compatibility layer that is used to support applications that use the IMM API to still work properly without change, but that layer does not have 100% coverage of the functionality across Vista and later versions of Windows, so I think in the end people will really be pushed to use the Text Services Framework to get their work done.</P>
<P><EM>From a timing perspective that change will most likely happen as soon as an application runs into a blocking bug in that compatibility later provided by the IMM API, as soon as Vista is targeted.</EM></P>
<P>There is a huge investment here, so I suspect that reported bugs have a decent chance of getting fixed, especially when they block functionality of existing applications, but this is hard to rely on and will ultimately have the biggest effect on applications in China, Japan, and Korea any time they are blocked because of this issue.</P>
<P>Regular readers might recall the <A class="" href="http://msdn.microsoft.com/library/ms776101.aspx" mce_href="http://msdn.microsoft.com/library/ms776101.aspx">ImmGetCandidiateList</A>&nbsp;on Vista issue being mentioned here previously, in <A class="" href="http://archives.miloush.net/michkap/archive/2007/04/26/2281645.html" mce_href="http://archives.miloush.net/michkap/archive/2007/04/26/2281645.html"><STRONG>Sprechen Sie IME?</STRONG></A>.</P>
<P>Interestingly, the function does not fail for all IMEs, only some of them. </P>
<P>Though the ones it fails for probably aren't all that reassured by this fact.</P>
<P>Further, I was told by a few people that in some cases it is only the "ImmGetCandidateList(hIMC, dwIndex, NULL, 0)" code that is intended to get the required length that fails -- if one passes in fully sized buffers one can actually succeed, and supposedly just passing a non-NULL buffer with a 0 length can sometimes help, too.</P>
<P>People it fails for are probably not that much reassured by <EM>this</EM>, either.</P>
<P>And finally, I have been told that sometimes doing the lower level work oneself via ImmLockClientImc/ImmLockIMC/ImmLockIMCC/etc. directly can also help here, though I suspect that these are cases where the bigger buffer sizes would also do the trick, so I am skeptical.</P>
<P>In&nbsp;any case, the specific TSF interfaces involving the candidate list are:</P>
<UL>
<LI><A class="" href="http://msdn.microsoft.com/library/ms538125.aspx" mce_href="http://msdn.microsoft.com/library/ms538125.aspx">IEnumTfCandidates</A> - implemented by a text service and used by the TSF manager to provide an enumeration of candidate string objects.</LI>
<LI><A class="" href="http://msdn.microsoft.com/library/ms538492.aspx" mce_href="http://msdn.microsoft.com/library/ms538492.aspx">ITfCandidateList</A> - implemented by a text service and is used by the TSF manager or a client (application or other text service) to obtain and manipulate candidate string objects.</LI>
<LI><A class="" href="http://msdn.microsoft.com/library/ms538497.aspx" mce_href="http://msdn.microsoft.com/library/ms538497.aspx">ITfCandidateString</A> - implemented by a text service and is used by the TSF manager or a client to obtain information about a candidate string object.</LI></UL>
<P>And it is the last two that are most interesting for clients who would have wanted the results of <A class="" href="http://msdn.microsoft.com/library/ms776101.aspx" mce_href="http://msdn.microsoft.com/library/ms776101.aspx">ImmGetCandidiateList</A>&nbsp;back in the day.</P>
<P>There is more information what to do over in <A class="" href="http://blogs.msdn.com/tsfaware/" mce_href="http://blogs.msdn.com/tsfaware/">TSF Aware</A> in the <A class="" href="http://blogs.msdn.com/tsfaware/archive/2007/05/14/text-services-candidates.aspx" mce_href="http://blogs.msdn.com/tsfaware/archive/2007/05/14/text-services-candidates.aspx">Text Services: Candidates</A>&nbsp;blog -- though centered on the applications, it is at least talking about how to get the info a bit. </P>
<P>Of course the samples on <A class="" href="http://msdn.microsoft.com/library/ms629032.aspx" mce_href="http://msdn.microsoft.com/library/ms629032.aspx">this page</A> are still missing, though those samples are definitely centering around providers rather than clients so they wouldn't help here....</P>
<P mce_keep="true">&nbsp;</P>
<P><FONT color=#ff00ff><EM>This blog brought to you by</EM><FONT size=5> „ÅÆ </FONT><EM>(<A class="" href="http://www.fileformat.info/info/unicode/char/306e" mce_href="http://www.fileformat.info/info/unicode/char/306e">U+306e</A>, aka HIRAGANA LETTER NO)</EM></FONT></P>
<hr/><p><strong>Michael S. Kaplan</strong> on 27 Jul 2008 9:41 PM:</p><div style="margin-left: 1em"><p>For the record, I am not that Mr. Kaplan from the Game Meltdown event. :-)</p>
</div>
<p><strong>David Bromberg</strong> on 12 Dec 2008 3:04 PM:</p><div style="margin-left: 1em"><p>I'm seeing similar problems in XP SP3 that work with SP2. Anyone know if Microsoft did a similiar changeover of the API's here? I can't find anything in their release notes.</p></div>
<hr/><p><em>referenced by</em></p><div style="margin-left: 1em"><p>2008/12/04 <a href="http://archives.miloush.net/michkap/archive/2008/12/04/9173920.html">ImmGetDescription: another casualty of the IMM to TSF migration</a></p></div><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2008/07/28/8782341.html" title="&quot;I literally mean a format specifier&quot; causes a parse error for me">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2008/07/27/8777624.html" title="Doing virtual simulationary keyboard stuff, only for real">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2008-07">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2008-07-27">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2008/07/27/8781762.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:36 GMT -->
</html>