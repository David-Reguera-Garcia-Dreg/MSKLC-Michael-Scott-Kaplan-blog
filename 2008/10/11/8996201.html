<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2008/10/11/8996201.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:35 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>Keeping myself up at night figuring out how to delight someone by making that special part of my package smaller</title></head><body>
<h1>Keeping myself up at night figuring out how to delight someone by making that special part of my package smaller</h1>
<p><em>by Michael S. Kaplan, published on 2008/10/11 14:01 -04:00, original URI: http://blogs.msdn.com/b/michkap/archive/2008/10/11/8996201.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostNew -->
<p>Conventional wisdom tells us that size matters, and unconventional (or more accurately, inappropriate?) wisdom tends to concur.</p><p>Most of the time it refers to the idea that <b>bigger is better</b>. <br></p><p>But there are some times that it matters in the opposite way -- where the smaller something is, the happier people seem to be.</p><p>Like the other day in an interesting email conversation where somebody noted:</p><blockquote><p><i><font face="times new roman,times">However, it's a stretch to say TCHARs belong in the 1990s.&nbsp; The PC I bought new in 2000 came with Windows 98, and it lasted five years.<br><br>In the real world (i.e., outside Microsoft), you don't always have the luxury of ignoring older platforms.&nbsp; The last product I worked on before joining Microsoft still has a small but significant Win 9x user base.&nbsp; Most of the growth opportunity was outside the US, and in those countries, older OSes were even more commonplace.<br><br>We investigated Unicows, but since the product was download only, and since the users on the older machines tended to be dial-up rather than broadband, we couldn't convince product management to let us add Unicows to the download.<br><br>When I say "the product was download only", I meant the ISV's product, not the MSLU redistributable.&nbsp; Making the ISV product dependent on Unicows would mean including the redistributable in the download.<br><br>Since most of the customers who were on the Windows 9x/Me platforms also had slow dial-up connections, the cost was considered too high.</font></i></p></blockquote><p>Now I am a big fan of MSLU (the <a href="http://go.microsoft.com/fwlink/?LinkId=14851" mce_href="http://go.microsoft.com/fwlink/?LinkId=14851">Microsoft Layer for Unicode on Windows 95, 98, and Me Systems</a>), and not just because I was the developer on the project.</p><p>After all, as I mentioned in <b><a href="http://archives.miloush.net/michkap/archive/2005/02/12/371650.html" mce_href="http://archives.miloush.net/michkap/archive/2005/02/12/371650.html">Why/how MSLU came to be, and more</a></b>:</p><blockquote><p><i><font face="times new roman,times">But when she laid out the idea of a layer that would be able to let people write Unicode applications that would do incredible things on Windows 2000 while still being functional on Win9x, I was amazed. When she asked whether I would I be interested in doing this project if she could get people behind the idea of making it happen, I think I said Hell yes! or something equally coherent. It sounded like an amazing project to be involved with!</font></i></p></blockquote><p>Notice that I was amazed before I had any idea that she was trying to figure out if I'd be interested in the job. It was just amazing on its own, and would have been so even if I had nothing to do with it.</p><p><i>There are countless such projects that I have mentioned in the past that I had nothijg to do with other than as a fan. It is just my way!</i></p><p>Anyway, I have a big [erson connection to the project, since it has beedn interesting to me since the first time someone laid the idea out in front of me.</p><p>It really gave me pause to think that the download size was such a hassle, though.</p><p>The full download that the developer would need to bring on their machine that you would get from <a href="http://go.microsoft.com/fwlink/?LinkId=14851" mce_href="http://go.microsoft.com/fwlink/?LinkId=14851">here</a> is 225KB (the site erroneously claims it is 261KB, I think because an older build was). But that download includes the license, redist information, PDB file, and DLL -- which is way more than any product would ever need to ship since only the DLL is needed.</p><p>The DLL is a whooping 252KB, compressible down to a mere 108KB with WinZip legacy compression and 94.3KB with the maximum optimized compression.</p><p>This small size was not technically one of the design goals, but other goals involving minimal resources required and minimal working set increase helped to indirectly lead to the same thing.<br></p><p>Now perhaps we are talking dial up connections to Windows 95 and such an addition is just unacceptable, but I have a hard time taking it quite that far as to think that a decision is being made based on whether it would cause the download to be 100KB larger.</p><p>But clearly it was. <br></p><p>Unbelievably, I found myself wracking my brain figuring out where to re-enlist in the source project, thinking about the code itself and wondering what I could do to make it smaller, how I could magically delight a customer who is likely way past that now and who would probably not be interested anyway.</p><p>So there I am, tilting windmills and trying to solve problem that can't be solved at this point.<br></p><p>It just so happens that this all occurred at 2 AM, a time when I probably should have been sleeping.</p><p>And the punchline?</p><p>How often is it that a man is keeping himself up at night wondering how to delight someone by making that special part of his package smaller? :-)</p><p><br></p><p><font color="#ff00ff"><i>This boog brought to you by</i><font size="6"> ⪪ </font><i>(<a href="http://www.fileformat.info/info/unicode/char/2aaa" mce_href="http://www.fileformat.info/info/unicode/char/2aaa">U+2aaa</a>, aka SMALLER THAN)</i></font><br></p>
<hr/><p><strong>Tihiy</strong> on 11 Oct 2008 6:32 PM:</p><div style="margin-left: 1em"><p>Oh, as a Win9x enthusiast (yeah, sounds bizzare), the most terrible thing in MSLU (after specific API issues) is windowing layer.</p>
<p>I dunno, MSLU was supposed to preserve compatibility from inside (pseudo-NT pseudo-Unicode world) and outside (existing APIs), but it always ends terribly when those worlds mix - after subclassing window procedure ends being 0x7FFFFFFx and leads to crash when existing CallWindowProc (or direct window procedure call) is used on that function. When combined other way - i.e. first 'native' subclassing, then Unicows subclassing - MSLU just loses track of window nature.</p>
<p>Who decided that 'those who call our world from outside deserve to crash immediately'? Why that horrid 'static subclassing' with locking information inside window property referring to that memory buffer was invented? Where was Raymond Chen :\</p>
<p>And yeah, sorry, i understand that there is no rules changing in a game after the game is over.</p></div>
<p><strong>Michael S. Kaplan</strong> on 11 Oct 2008 8:17 PM:</p><div style="margin-left: 1em"><p>MSLU actually does really well in most of the scenarios (and you can crash on NT if you mix ANSI/Unicode wndproc situations and don't go through CallWindowProc so that problem isn't unique to MSLU (we inherited it from our sister model!).</p>
<p>There are some cases where it can get confused, though this is less common than you are implying, and of course none of that has anything to do with the size issue. :-)</p></div>
<p><strong>Tihiy</strong> on 12 Oct 2008 4:15 AM:</p><div style="margin-left: 1em"><p>I bet you mean 'you can crash on NT', not 'you can crash NT' :-)</p>
<p>I just believed that NT (judging from Wine) has window procedure translation array (or thunks?), not static buffer... you're right for common cases, it's just when MSLU is abused being in complex weird program it upsets itself, sorry ;).</p>
<p>As for size issue, what if instead W&lt;-&gt;A macros there could be common procedures for (LPWSTR); (LPWSTR, nMaxCount); (param, LPWSTR, nMaxCount) functions that could reduce code noticeably for simple cases!</p></div>
<p><strong>Michael S. Kaplan</strong> on 12 Oct 2008 10:36 AM:</p><div style="margin-left: 1em"><p>The work was actually tested both ways, the final model we went with had much better performance characteristics and less heap fragmentation (which in the end proved to be more compelling than just the raw size)...</p>
</div>
<hr/><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2008/10/12/8996692.html" title="I&#39;m not Arial, I&#39;m HEL-𝔉𝔲𝔠𝔨𝔦𝔫𝔤-VETICA, baby!">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2008/10/11/8991018.html" title="Exile in SIAOville, aka A Mike in Alaska">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2008-10">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2008-10-11">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2008/10/11/8996201.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:35 GMT -->
</html>