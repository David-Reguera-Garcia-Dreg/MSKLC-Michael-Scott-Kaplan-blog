<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2008/10/15/9000371.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:35 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>UCS-2 to UTF-16, Part 5: What's on the Next Level?</title></head><body>
<h1>UCS-2 to UTF-16, Part 5: What's on the Next Level?</h1>
<p><em>by Michael S. Kaplan, published on 2008/10/15 03:01 -04:00, original URI: http://blogs.msdn.com/b/michkap/archive/2008/10/15/9000371.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostNew -->
<P>Previous blogs in this series of blogs on this Blog:</P>
<UL>
<LI><B><A href="http://archives.miloush.net/michkap/archive/2008/08/30/8907667.html" mce_href="http://archives.miloush.net/michkap/archive/2008/08/30/8907667.html">Part 0: The intro, sans content</A></B> </LI>
<LI><B><A href="http://archives.miloush.net/michkap/archive/2008/09/08/8931641.html" mce_href="http://archives.miloush.net/michkap/archive/2008/09/08/8931641.html">Part 1: Getting the obvious out of the way</A></B> </LI>
<LI><B><A href="http://archives.miloush.net/michkap/archive/2008/09/15/8952073.html" mce_href="http://archives.miloush.net/michkap/archive/2008/09/15/8952073.html">Part 2: A&amp;P of a 'linguistic character'</A></B> </LI>
<LI><B><A href="http://archives.miloush.net/michkap/archive/2008/09/18/8956650.html" mce_href="http://archives.miloush.net/michkap/archive/2008/09/18/8956650.html">Part 3: It starts with cursor movement (where MS simultaneously gets better and worse)</A></B> </LI>
<LI><B><A href="http://archives.miloush.net/michkap/archive/2008/10/06/8977552.html" mce_href="http://archives.miloush.net/michkap/archive/2008/10/06/8977552.html">Part 4: Talking about the ask </A></B><B><BR></B></LI></UL>
<P>Now going through the previous parts, there are two conclusions that developers and architects can come to:</P>
<OL>
<LI>The basic problem is much simpler that it seemed at first;</LI>
<LI>The full problem is not only more complicated than it seemed, but there is currently no full, query-able support for it on the platform.</LI></OL>
<P>It was ever about UCS-2; it was never about UTF-16. It was about character identity, and the desire to not destroy meaning....<BR></P>
<P>But it is important to look at the full scope of the kinds of things that users might expect here.</P>
<P>The other day a mail thread involving the "delete" aspects of the problem inherent in how to safely truncate a string talked about several aspects of the problem.</P>
<P>In that thread, Peter Constable suggested:</P>
<BLOCKQUOTE>
<P><FONT face="times new roman,times">SCRIPT_LOGATTR::fCharStop returned by Uniscribe’s ScriptBreak() API ought to tell you valid truncation points – including not to break between surrogate pairs, between a base character and a combining mark, or within Indic clusters.</FONT></P></BLOCKQUOTE>
<P>This gives a practical suggestion to handle many of the problems pointed out earlier, problems that encompass the first two of the three major categories of linguistic characters I defined earlier in the series.</P>
<P>Peter then went on to mention:</P>
<BLOCKQUOTE>
<P><FONT face="times new roman,times">One case that won’t tell you, though: In Thai and Lao, it’s best not to break between {U+0E40..U+0E44, U+0EC0..U+0EC4} and a following consonant letter {U+0E01..U+0E2E, U+0EC1..U+0EAE}.</FONT></P></BLOCKQUOTE>
<P>Now these two cases actually also happen to fall under the third category which I named as sort elements, since these are the kinds of things that would also tend to impact collation operations.</P>
<P>Though the fact that a "collation dude" like me would call them <B>sort elements</B> while a "font dude" like Peter would not suggests that perhaps a name that encompasses a wider description of what these items would be might be in order. Otherwise we are each being partially functionally descriptive but not in any kind of robust, complete way.</P>
<P>In this case the result is the same, and plus there is no function to get all of the information, so naming it might be less important at the moment. :-)</P>
<P>There are also another aspect of truncation that was discussed in the thread, such as:</P>
<BLOCKQUOTE>
<P><FONT face="times new roman,times">Also additional support for Arabic [could be] added since when breaking in the middle of a word, the character shape would change from the medial or initial form to the final form... ...inject a ZWJ to keep the form from changing so the user has context that additional text follows and wouldn’t change the meaning/context.</FONT></P></BLOCKQUOTE>
<P>Note that this is a new idea that has not been discussed before in this series, or indeed this blog. I am still wrapping my had around the validity of the notion since to a native reader of the language the different forms really are the same letter, and I am not convinced that the confusion of truncating in the middle of a word would be mitigated appropriately by such an approach.</P>
<P>Another interesting issues related to the Thai case that Peter mentioned was that while a user might occasionally expect cursor movement and/or selection to respect those category-three <B>sort element</B> boundaries, they would for the most part actually expect the cursor to be able to put in the middle of the <B>sort element</B>, and most might never have such an expectation.</P>
<P>This is similar to the way (to use the earlier example for sort elements) a Hungarian user might expect <B>dzs</B> to be handled.</P>
<P>At this point it may be a challenge to find a user who is sophisticated enough to ask about expectations who does not have decades of experiences with typewriters and/or computers that have already built up expectations of proper behavior. and for every case where a user might expect multiple characters to be treated as one for movement/selection/deletion due to their experiences with dead keys, there can be just as many cases where the fact that the underlying entry/storage mechanism has multiple characters does not even allow for the possibility of treating the cluster as a single character.</P>
<P>Thus we have a design flaw in the platform where the underlying entry/storage mechanisms are guiding "expected" behavior, rather than the other way around.</P>
<P>Then we can look at yet another aspect of the problem: the way .NET does things.</P>
<P>You know how I quoted Peter Constable's <A href="http://msdn.microsoft.com/library/ms776474.aspx" mce_href="http://msdn.microsoft.com/library/ms776474.aspx">ScriptBreak</A> comments earlier?</P>
<P>This is an idea I mentioned before, in blogs like <B><A href="http://archives.miloush.net/michkap/archive/2005/09/23/472656.html" mce_href="http://archives.miloush.net/michkap/archive/2005/09/23/472656.html">Stick a fork in GetCharacterPlacement</A></B> and <B><A href="http://archives.miloush.net/michkap/archive/2007/05/09/2497106.html" mce_href="http://archives.miloush.net/michkap/archive/2007/05/09/2497106.html">Sometimes you need more than StringInfo</A></B>.</P>
<P>Now that blog prophetically talks about how StringInfo can't do it all here (in fact it only handles most of those first two categories of linguistic character boundaries without giving any of the word boundary information).</P>
<P>Add to it the fact that all of the methods that used to take just a System.Char -- for example <A href="http://msdn.microsoft.com/library/yyxz6h5w.aspx" mce_href="http://msdn.microsoft.com/library/yyxz6h5w.aspx">Char.IsLetter(Char)</A> -- now have a second overload that takes a string and a length -- for example <A href="http://msdn.microsoft.com/library/zff1at55.aspx" mce_href="http://msdn.microsoft.com/library/zff1at55.aspx">Char.IsLetter(String, Int32)</A>. These have only one purpose -- handling surrogate pair handling. Thus all of the other times when a user might think of it as a character or even Unicode would think it is a grapheme cluster or a character via canonical equivalence are ignored.</P>
<P>And this addition of dozens of overloads to .NET &gt;= 2.0 is a partial bandage over a perceived limitation -- the inability of functions to handle surrogate pairs properly -- that ignores all of the other scenarios here.</P>
<P>And .NET has no built-in support for the kind of things <A href="http://msdn.microsoft.com/library/ms776474.aspx" mce_href="http://msdn.microsoft.com/library/ms776474.aspx">ScriptBreak</A> can tell you, which are largely based in what Unicode and its character properties reveal (even though lots of the underlying properties are available via the <A href="http://msdn.microsoft.com/library/system.globalization.charunicodeinfo.aspx" mce_href="http://msdn.microsoft.com/library/system.globalization.charunicodeinfo.aspx">CharUnicodeInfo class</A>).</P>
<P>I guess this is what happens when the typography and rendering folks are not involved in design discussions that the core NLS folks work on. :-)</P>
<P>But you can see how lots of the pieces are available here, and can be used. Note that if in truncation you use the <A href="http://msdn.microsoft.com/library/ms776474.aspx" mce_href="http://msdn.microsoft.com/library/ms776474.aspx">ScriptBreak</A>-provided word break opportunities for your truncation then you will be able to support all three levels of <B>linguistic character</B> since none of then would survive a word-breaking opportunity!</P>
<P mce_keep="true">&nbsp;</P>
<P><FONT color=#ff00ff><I>This blog brought to you by</I><FONT size=6> එ </FONT><I>(<A href="http://www.fileformat.info/info/unicode/char/0d91" mce_href="http://www.fileformat.info/info/unicode/char/0d91">U+0d91</A>, aka SINHALA LETTER EYANNA)</I></FONT><BR></P>
<hr/><div style="margin-left: 1em"><em>no comments</em></div><hr/><p><em>referenced by</em></p><div style="margin-left: 1em"><p>2009/06/29 <a href="http://archives.miloush.net/michkap/archive/2009/06/29/9800913.html">UCS-2 to UTF-16, Part 11: Turning it up to Eleven!</a></p><p>2009/06/10 <a href="http://archives.miloush.net/michkap/archive/2009/06/10/9723321.html">UCS-2 to UTF-16, Part 10: Variation[ Selector] on a theme...</a></p><p>2008/12/16 <a href="http://archives.miloush.net/michkap/archive/2008/12/16/9223301.html">UCS-2 to UTF-16, Part 9: The torrents of breaking CharNext/CharPrev</a></p><p>2008/12/09 <a href="http://archives.miloush.net/michkap/archive/2008/12/09/9187379.html">UCS-2 to UTF-16, Part 8: It's the end of the string as we know it (and I feel ellipses)</a></p><p>2008/12/04 <a href="http://archives.miloush.net/michkap/archive/2008/12/04/9173687.html">UCS-2 to UTF-16, Part 7: If it makes the SQL Server columns too small then it made the Oracle columns either too smallER or too smallEST</a></p><p>2008/11/24 <a href="http://archives.miloush.net/michkap/archive/2008/11/24/9134826.html">UCS-2 to UTF-16, Part 6: An exercise left for whoever needs some exercise</a></p></div><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2008/10/15/9000666.html" title="What is the freaking point of LOCALE_USE_CP_ACP?">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2008/10/14/8998697.html" title="Let my tombstone read: &#39;Generally thought to be bad attrition&#39;">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2008-10">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2008-10-15">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2008/10/15/9000371.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:35 GMT -->
</html>