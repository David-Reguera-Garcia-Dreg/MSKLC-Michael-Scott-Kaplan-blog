<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2008/08/03/8819230.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:36 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>How to keep it up (or at least how to get it back up after it has gone down)</title></head><body>
<h1>How to keep it up (or at least how to get it back up after it has gone down)</h1>
<p><em>by Michael S. Kaplan, published on 2008/08/03 12:31 -04:00, original URI: http://blogs.msdn.com/b/michkap/archive/2008/08/03/8819230.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostNew -->
<P>The question is actually one that has come from a few different people, most recently from a developer named Jeff:</P>
<BLOCKQUOTE>
<P><EM>How can I keep the Language Bar up for my C# application?<BR><BR>Or if that isn't possible, how can I make it come back up after it has been minimized to the tray?</EM></P></BLOCKQUOTE>
<P>Like I said, it turns out to be a common question. :-)</P>
<P>There are two solutions here, one for each of the subquestions in Jeff's inquiry....</P>
<P>There is a thread on the WinForms forum entitled <A class="" href="http://forums.microsoft.com/MSDN/ShowPost.aspx?PostID=2578217&amp;SiteID=1" mce_href="http://forums.microsoft.com/MSDN/ShowPost.aspx?PostID=2578217&amp;SiteID=1">How do I keep Language Bar showing to the user in remote desktop application?</A> that explains how to disallow minimizing -- if&nbsp;you deny modify permissions to HKCU\software\microsoft\TSF then you can't minimize the Language Bar at all.</P>
<P>Though to be honest this is&nbsp;a bit heavy handed, in my opinion. If they want to minimize it at a given moment then I hate taking away the option to do so.</P>
<P>But I would like to make it easy to have it pop back up!</P>
<P>So let's move past that solution and think about the second one, shall we? :-)</P>
<P>To make the Language Bar do your bidding, what you really want&nbsp;an object that&nbsp;implements the&nbsp;<A class="" href="http://msdn.microsoft.com/library/ms628748.aspx" mce_href="http://msdn.microsoft.com/library/ms628748.aspx">ITfLangBarMgr interface</A>. Because you can use the <A class="" href="http://msdn.microsoft.com/library/ms628765.aspx" mce_href="http://msdn.microsoft.com/library/ms628765.aspx">ITfLangBarMgr::ShowFloating</A> method to control all of the various aspects of the language bar from how it shows up to how transparent it is to how many icons it shows to whether the text labels are there and so on.</P>
<P>The C# part will make this a bit harder, of course....</P>
<P>Now there is a <A class="" href="http://msdn.microsoft.com/library/ms629061.aspx" mce_href="http://msdn.microsoft.com/library/ms629061.aspx">TF_CreateLangBarMgr function</A> exported by msctf.dll that make it easy to get the <A class="" href="http://msdn.microsoft.com/library/ms628748.aspx" mce_href="http://msdn.microsoft.com/library/ms628748.aspx">ITfLangBarMgr</A>&nbsp;interface pointer. And obviously it is easy to enough to call <A class="" href="http://msdn.microsoft.com/library/system.runtime.interopservices.marshal.releasecomobject.aspx" mce_href="http://msdn.microsoft.com/library/system.runtime.interopservices.marshal.releasecomobject.aspx">Marshal.ReleaseComObject</A> on that object after you are done and keep the documentation in that function call which is so worried about refcounts from having a big "I told you so" moment on your code.</P>
<P>But the middle part, the one that calls <A class="" href="http://msdn.microsoft.com/library/ms628765.aspx" mce_href="http://msdn.microsoft.com/library/ms628765.aspx">ITfLangBarMgr::ShowFloating</A>&nbsp;with the TF_SFT_DHOWNORMAL flag, that requires you to actually have the interface defined if you really want to call the method from C#. Not impossible, but definitely&nbsp;some extra work made much harder by the fact that this one is in COM.</P>
<P>Personally, I'm pining for an awesome sample to do all this coming out of the <A class="" href="http://blogs.msdn.com/tsfaware/" mce_href="http://blogs.msdn.com/tsfaware/">TSF Aware Blog</A>. This is, after all, a nice, easily contained sample that would be tremendously useful to a lot of people.</P>
<P><EM>This is my subtle hint to Eric Brown to encourage him to combine his extensive TSF knowledge with the wonderful science of COM Interop to show off one of the more feasible uses of C# and the Text Services Framework that he has suggested in the past.</EM> :-)</P>
<P>I suppose I could cobble together a sample too, eventually. Everything to do the work is documented and understood, and even COM Interop is not so hard if you don't try to make it so. But I'm hoping it gets done before I get to it....</P>
<P>Anyway, that is the answer to this question that seems to come quite a bit for some reason. Perhaps also a message to the Text Services Framework team to make the "un-minimizing" support easier, too? :-)</P>
<P mce_keep="true">&nbsp;</P>
<P><FONT color=#ff00ff><EM>This blog brought to you by</EM><FONT size=6> à¬µ </FONT><EM>(<A class="" href="http://www.fileformat.info/info/unicode/char/0b35" mce_href="http://www.fileformat.info/info/unicode/char/0b35">U+0b35</A>, aka ORIYA LETTER VA)</EM></FONT></P>
<hr/><div style="margin-left: 1em"><em>no comments</em></div><hr/><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2008/08/04/8823327.html" title="Tap your heels together three times and the problem is solved?">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2008/08/02/8806350.html" title="Perhaps the commonest (if not the leastest) of the least common denominators">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2008-08">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2008-08-03">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2008/08/03/8819230.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:36 GMT -->
</html>