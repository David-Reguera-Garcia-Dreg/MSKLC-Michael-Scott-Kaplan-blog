<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2008/08/15/8869343.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:36 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>Yet another time that UTF-8 can't be the ACP</title></head><body>
<h1>Yet another time that UTF-8 can't be the ACP</h1>
<p><em>by Michael S. Kaplan, published on 2008/08/15 10:01 -04:00, original URI: http://blogs.msdn.com/b/michkap/archive/2008/08/15/8869343.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostNew -->
<p>Glenn asks:</p>
<blockquote>
<p><font face="times new roman,times">Regarding MKLC Codepages: Microsoft Keyboard Layout Creator - In the Properties, I set the Language to "English (United States)" which sets the code page to (1252). The "Validate Layout" tool generates warnings that some of the characters are not in the codepage (1252). It states that "This may cause compatibility problems in non-Unicode applications." (65001) is the codepage I need to use for non-Unicode applications. How can I set the codepage for a Microsoft Keyboard Layout Creator to codepage (65001)?</font><br></p>
</blockquote>
<p>This particular feature really has very little to do with directly assigning a code page to a keyboard.</p><p>In the MSKLC user interface, it can be found right where the cursor is in this screen shot:<br></p><p><img src="http://trigeminal.fmsinc.com/images/validation01.png" alt="http://www.trigeminal.com/images/validation01.png"> <br></p>
<p>It has to do with the feature I described how we broke in Vista RTM (as mentioned <b><a href="http://archives.miloush.net/michkap/archive/2007/03/20/1917161.html" mce_href="http://archives.miloush.net/michkap/archive/2007/03/20/1917161.html">here</a></b>) and then fixed in a hofix (as mentioned <b><a href="http://archives.miloush.net/michkap/archive/2007/06/25/3521939.html" mce_href="http://archives.miloush.net/michkap/archive/2007/06/25/3521939.html">here</a></b>) and in SP1. Of course even before we broke this, there were examples where bogus information in a locale's <a href="http://msdn.microsoft.com/library/ms776437.aspx" mce_href="http://msdn.microsoft.com/library/ms776437.aspx">LOCALESIGNATURE</a> could lead to bugs, e.g. in Hong Kong as described in <b><a href="http://archives.miloush.net/michkap/archive/2006/08/28/728336.html" mce_href="http://archives.miloush.net/michkap/archive/2006/08/28/728336.html">What the hell is wrong with TranslateCharsetInfo, anyway?</a></b>.</p>
<p>Basically, here are the steps:</p>
<ul>
<li>At keyboard load time, the code page associated with the LANGID of the layout's KLID (according to the locale's <a href="http://msdn.microsoft.com/library/ms776437.aspx" mce_href="http://msdn.microsoft.com/library/ms776437.aspx">LOCALESIGNATURE</a>) is stored;</li>
<li>That code page is used in all later conversions to non-Unicode callers and messages involve in the input queue.</li>
</ul>
<p>This is the basis of the support for ANSI-PLUS applications.</p>
<p>MSKLC's "feature" here takes the locale that the keyboard author has chosen (the one that it will later cause to become the LANGID of the KLID of the installed keyboard) and points out the characters that will not be supported by such ANSI-plus applications.</p>
<p>However, the problem with both ANSI and ANSI-plus applications is that neither of them can handle Unicode-only locales, where the code page would have to be 65001 to support the characters used by the locale.</p>
<p>But as I pointed out <b><a href="http://archives.miloush.net/michkap/archive/2006/07/14/665714.html" mce_href="http://archives.miloush.net/michkap/archive/2006/07/14/665714.html">here</a></b> and further <font color="#ccccff"><strike>blathered</strike></font>expounded on <b><a href="http://archives.miloush.net/michkap/archive/2006/10/11/816996.html" mce_href="http://archives.miloush.net/michkap/archive/2006/10/11/816996.html">here</a></b>, <b>the ACP of a locale cannot be UTF-8</b>, so there is no way to specify 65001 to be used....</p><p>Now getting the actual code page being used by an ANSI-plus applications once a keyboard is installee and gets used turns out to be much harder than it loikely ought to be; I'll discuss how to get that information in an upcoming blog....</p><p><br></p><p><font color="#ff00ff"><i>This blog brought to you by</i><font size="7"> à¦ˆ </font><i>(<a href="http://www.fileformat.info/info/unicode/char/0988" mce_href="http://www.fileformat.info/info/unicode/char/0988">U+0988</a>, aka BENGALI LETTER II)</i></font> <br></p>
<hr/><div style="margin-left: 1em"><em>no comments</em></div><hr/><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2008/08/16/8871262.html" title="Optimus: from science fiction to fiction to frustration to geek porn, in just 24 months">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2008/08/15/8869007.html" title="E7 language stuff">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2008-08">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2008-08-15">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2008/08/15/8869343.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:36 GMT -->
</html>