<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2008/09/24/8963238.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:35 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>It used to be right, dammit!</title></head><body>
<h1>It used to be right, dammit!</h1>
<p><em>by Michael S. Kaplan, published on 2008/09/24 10:01 -04:00, original URI: http://blogs.msdn.com/b/michkap/archive/2008/09/24/8963238.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostNew -->
<p>&nbsp;</p><p>The <a href="http://msdn.microsoft.com/library/ms776293.aspx" mce_href="http://msdn.microsoft.com/library/ms776293.aspx">GetDateFormat function</a> from the <a href="http://msdn.microsoft.com/library/ms776318.aspx" mce_href="http://msdn.microsoft.com/library/ms776318.aspx">NLS API</a> has been around for a while.</p>
<p>Like since NT 3.5 and Windows 95.</p>
<p>The documentation for this function has of course been expanded and modified and edited many times since it was initially added to the Platform SDK.</p>
<p>&nbsp;</p><p>One bit from the documentation has probably been around since the very beginning:</p>
<blockquote><i>dwFlags</i> 
<br>&nbsp;&nbsp;&nbsp; [in] Flags specifying various function options that can be set if 
<i>lpFormat</i> is set to a null pointer. If <i>lpFormat</i> is not set to a 
null pointer, this parameter must be set to 0. The application can specify a 
combination of the following values.</blockquote>
<p>One bit of it:</p><blockquote><p><font size="4">If lpFormat is not set to a null pointer, this parameter must be set to 0. </font></p></blockquote><p>used to be right.</p><p>And it was right for a reason -- because most of the flags relate to specifying the kind of format to use and such things are really only interesting if you aren't passing a format.</p><p>I mean, how on the earth can a function respect a request to modify th builtin format like DATE_SHORTDATE or DATE_LONGDATE or DATE_YEARMONTH or LOCALE_NOUSEROVERRIDE if you pass your own format that would ignore your request?</p><p>Better to fail fast and fail consistently!<br></p><p>But then new flags like</p><ul><li><b>LOCALE_USE_CP_ACP</b>, that only affects the encoding (code page) of the returned string when the ANSI function is called, and</li><li><b>DATE_USE_ALT_CALENDAR</b>, that mostly only affects the date value itself that will be formatted and not the underlying format used, and</li><li><b>DATE_LTRREADING</b> and <b>DATE_RTLREADING</b>, that only affects characters to insert into the resultant formatted string<br></li></ul>started getting added.<p>Any of those might make sense to want to add even when you explicitly pass a format.</p><p>It would be completely unfair if we didn't let you pass one of them if you needed the results.</p><p>Luckily, the function itself works for these cases, even though the documentation doesn't know about this!<br></p><p>Especially since there is <b><a href="http://archives.miloush.net/michkap/archive/2006/09/01/735817.html" mce_href="http://archives.miloush.net/michkap/archive/2006/09/01/735817.html">that GetDateFormat wrapper</a></b> that will add sometimes add flags even if the lpFormat is not null....<br></p><p>No worries, the documentation can be updated. The weird part is that this really has been wrong for a long time. No one ever noticed it before, even to complain about how the wrapper function might be wrong?</p><p>I guess it means no one reads the documentation either.... :-)<br></p><p><br></p><p><font><font color="#ff1493"><i>This post brought to you by <a href="http://www.fileformat.info/info/unicode/char/200f" mce_href="http://www.fileformat.info/info/unicode/char/200f"><i>U+200f</i></a><i>, 
RIGHT-TO-LEFT MARKER</i></i></font><i></i></font><br></p>
<hr/><div style="margin-left: 1em"><em>no comments</em></div><hr/><p><em>referenced by</em></p><div style="margin-left: 1em"><p>2008/12/08 <a href="http://archives.miloush.net/michkap/archive/2008/12/08/9183424.html">The "plate of shrimp" theory explains it</a></p><p>2008/10/15 <a href="http://archives.miloush.net/michkap/archive/2008/10/15/9000666.html">What is the freaking point of LOCALE_USE_CP_ACP?</a></p></div><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2008/09/25/8964094.html" title="When to make a change, when to stay the same">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2008/09/24/8963178.html" title="Tavultesoft is one of the company names mispronounced more often than Trigeminal">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2008-09">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2008-09-24">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2008/09/24/8963238.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:35 GMT -->
</html>