<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2008/09/18/8956650.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:35 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>UCS-2 to UTF-16, Part 3: It starts with cursor movement (where MS simultaneously gets better and worse)</title></head><body>
<h1>UCS-2 to UTF-16, Part 3: It starts with cursor movement (where MS simultaneously gets better and worse)</h1>
<p><em>by Michael S. Kaplan, published on 2008/09/18 03:01 -04:00, original URI: http://blogs.msdn.com/b/michkap/archive/2008/09/18/8956650.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostNew -->
<p>Previous blogs in this series of blogs on this Blog:</p>
<ul>
<li><b><a href="http://archives.miloush.net/michkap/archive/2008/08/30/8907667.html" mce_href="http://archives.miloush.net/michkap/archive/2008/08/30/8907667.html">Part 0: The intro, sans content</a></b></li>
<li><b><a href="http://archives.miloush.net/michkap/archive/2008/09/08/8931641.html" mce_href="http://archives.miloush.net/michkap/archive/2008/09/08/8931641.html">Part 1: Getting the obvious out of the way</a></b></li>
<li><b><a href="http://archives.miloush.net/michkap/archive/2008/09/15/8952073.html" mce_href="http://archives.miloush.net/michkap/archive/2008/09/15/8952073.html">Part 2: A&amp;P of a 'linguistic character'</a></b><br></li>
</ul>
<p>Okay, so far we have introduced the topic, pointed out that 9/10's of what a person was going to run off and do is probably too much, and then jumped into define the things that are sequences of storage characters that meet the definition of what a user calls a character.</p>
<p>So what are the things you can do with them, if you are armed with this knowledge?</p>
<p>Well, since we are focusing on "user" characters, we'll start there -- with users moving through a text stream. You know, using the arrow keys to move either forward or backward through the text, and watching the cursor as they go.</p>
<p>The ideal behavior that the user expects without thinking about it is not too complicated: if they think of something as a single character, then the do not expect it to tale multiple arrow keypresses to move through it.</p>
<p>In other words, they want the computer to understand the text in the same way that they do.</p>
<p>Now although that is simple conceptually, it os not always supportable by software today -- especially when one considers <b>sort elements</b>, where there is no easy function to call that finds those boundaries. The underlying data exists in collation algorithms (for example Microsoft's and the UCA's) and is used in order to define the sorting behavior of those elements, but when they are independent letters like the Traditional Spanish <b>ch</b> or the Hungarian <b>dzs</b>, there generally isn't an easy way ti query for the information.</p>
<p>Now in this case there has not been such a method for as long as computers or even typewriters have been there, so it may be stretching the definition of <b>expectation</b> to assume that people would expect computers to understand the boundaries of a <b>sort element</b> when it comes to cursor movement. At best they would be pleasantly surprised if this happened, and at worst they would think of it as a bug.</p>
<p>Finding out whether this is learned behavior or an intuitive expectation would make for fascinating study if the parameters for determining the truth could be defined. It makes me jealous of the ClearType folks when I think of the number of studies they do related to reading when I think about how large the budget is to commission such a study in Windows International.</p>
<p>$0. <br></p>
<p>So realistically we can put that third type of <b>linguistic character</b> aside for now.</p>
<p>And possibly forever. :-)</p>
<p>Looking at the other two types of <b>linguistic characters</b> -- <b>surrogate pairs</b> (aka <b>supplementary characters</b>) and <b>grapheme clusters</b> (aka <b>text elements</b>), generally users don't want want or expect to require multiple keypresses to get through what they think of a single character.</p>
<p>This raises an interesting question for a developer performing an operation that is enumerating a string.</p>
<p>Should the developer ever care about the answer on the length of a string or substrinfg when they are scrolling through a character?</p>
<p>I mean, take the word êéÄêéáêéñ (this is not a word so much as a stream of Ugaritic letters).</p>
<p>êéÄêéáêéñ</p>
<p>Now this is three "characters": </p>
<p>U+10380 U+10387 U+10396</p>
<p>Using a modern browser like FireFox I have no problem seeing the string treated as three characters, despite the fact that under the covers it is actually:</p>
<p> U+d800 U+df80 U+d800 U+df87 U+d800 U+df96</p>
<p>And if you try to click in the middle of a letter you are never given the opportunity -- it always picks a side and puts you in one spot or the other.</p>
<p>So clearly there are times that a developer might need to care about this fact, and therefore there should be a good way to provide this.</p>
<p>Unfortunately, generally speaking, there isn't one inline with the text.</p>
<p>But there are things like .NET's <a href="http://msdn2.microsoft.com/library/system.globalization.stringinfo.aspx" mce_href="http://msdn2.microsoft.com/library/system.globalization.stringinfo.aspx">StringInfo</a> class, which will help map the <b>storage characters</b> to the <b>linguistic characters</b> -- something I have <b><a href="http://archives.miloush.net/michkap/archive/2005/02/07/368570.html" mce_href="http://archives.miloush.net/michkap/archive/2005/02/07/368570.html">talked</a></b> <b><a href="http://archives.miloush.net/michkap/archive/2005/04/28/413019.html" mce_href="http://archives.miloush.net/michkap/archive/2005/04/28/413019.html">about</a></b> <b><a href="http://archives.miloush.net/michkap/archive/2005/04/29/413366.html" mce_href="http://archives.miloush.net/michkap/archive/2005/04/29/413366.html">before</a></b>.</p>
<p>Though as I pointed out <b><a href="http://archives.miloush.net/michkap/archive/2007/05/09/2497106.html" mce_href="http://archives.miloush.net/michkap/archive/2007/05/09/2497106.html">Sometimes you need more than StringInfo</a></b>, there are cases in between the second and third category that actually do have data somewhere.</p>
<p>Thus in Assamese ‡¶Æ‡ßç‡¶™‡¶æ is four Unicode code points (U+09ae U+09cd U+09aa U+09be), two text elements according to <a href="http://msdn2.microsoft.com/library/system.globalization.stringinfo.aspx" mce_href="http://msdn2.microsoft.com/library/system.globalization.stringinfo.aspx">StringInfo</a>, but we know from prior "Virama-esque" posts like <b><a href="http://archives.miloush.net/michkap/archive/2005/04/09/406765.html" mce_href="http://archives.miloush.net/michkap/archive/2005/04/09/406765.html">this one</a></b> that this is actually a conjunct. So as <b><a href="http://archives.miloush.net/michkap/archive/2007/05/09/2497106.html" mce_href="http://archives.miloush.net/michkap/archive/2007/05/09/2497106.html">Sometimes you need more than StringInfo</a></b> points out, there is a construct that the computer understands that is not being provided as easily to developers.</p>
<p>Now I am tempted to call this yet another category, and it really is a <b>grapheme cluster</b> that is not a <b>text element</b>,.</p>
<p>I think in the long run it would be better if Microsoft treated this as a limitation/bug in <a href="http://msdn2.microsoft.com/library/system.globalization.stringinfo.aspx" mce_href="http://msdn2.microsoft.com/library/system.globalization.stringinfo.aspx">StringInfo</a> and its definiton of <b>text element</b> and either fixef it or added a new construct to handle this additional understanding of "characterness" that Uniscribe clearly understands even if <a href="http://msdn2.microsoft.com/library/system.globalization.stringinfo.aspx" mce_href="http://msdn2.microsoft.com/library/system.globalization.stringinfo.aspx">StringInfo</a> does not.</p>
<p>In other words. Microsoft ought to provide the mechanisms that it actually <b>does</b> expose in easier ways here.</p>
<p>Because no method should break up a conjunct, or put a cursor in the middle of one. But how is a developer supposed to support all that without a way to get at the data?</p>
<p>Now in <b><a href="http://archives.miloush.net/michkap/archive/2007/05/09/2497106.html" mce_href="http://archives.miloush.net/michkap/archive/2007/05/09/2497106.html">Sometimes you need more than StringInfo</a></b> I actually asked if samples for this kind of data would be desirable and nobody responded, but I'll ask again to see if I have inspired interest. Any takers? :-)</p>
<p>&nbsp;</p>
<p><font color="#ff00ff"><i>This post brought to you by</i> <font size="6">‡¶§</font> 
<i>(<a href="http://www.fileformat.info/info/unicode/char/09a4" class="" mce_href="http://www.fileformat.info/info/unicode/char/09a4">U+09a4</a>, a.k.a. 
BENGALI LETTER TA)</i></font></p>
<hr/><p><strong>Steven Wittens</strong> on 18 Sep 2008 4:11 PM:</p><div style="margin-left: 1em"><p>I realize you're only 3 blog posts into this series, but coming from the web side of things (where UTF-8 is king), I find your description pretty puzzling.</p><blockquote><p><i>Sorry about that! -- Michael</i> <br></p></blockquote>
<p>The transition from UCS-2 to UTF-16 could considered analogous to the transition from e.g. ISO-8859-1 (or any other 8-bit encoding) to UTF-8: instead of processing fixed-width units, you process variable width-units. And, in order to migrate old data to new data, you need to convert it/clean it up. In the case of UTF-16, this means making sure there are no unpaired surrogate units around. In the case of UTF-8, this means converting any 0x80-0xFF byte to a two-byte sequence.</p><blockquote><p><i>Over here, we consider it to be much more than that... -- Michael</i><br></p></blockquote>
<p>In the case of UTF-8, I've never really seen anyone talk about treating the individual bytes as a series of 'characters' to skip over. That is, the notion of having the cursor in the middle of a multi-byte UTF-8 sequence seems absurd: characters only exist above the encoding level, and the UTF-8 bytes are merely a storage mechanism.</p><blockquote><p><i>Well, the issue is that people doing Unicode in Win32 still often keeps the <b>storage character</b> and the <b>linguistic character</b> together, and the fact is that moving from UCS-2 to UTF-16 is best thought of as separating the two -- Michael</i><br></p></blockquote>
<p>From this point of view, it seems weird that you're mixing the storage aspects of UTF-16 surrogates with the linguistic aspects of handling characters. The former is encoding specific (and doesn't happen with UTF-32) while the latter applies regardless of the Unicode encoding used.</p><blockquote><p><i>I'm not mixing them up, I am introducing a concept that a distressing number of programs do not handle, all! -- Michael</i><br></p></blockquote>
<p>Saying that 'under the covers', U+10380 U+10387 U+10396 is really just U+d800 U+df80 U+d800 U+df87 U+d800 U+df96 (in UTF-16) seems as absurd to me as saying that 'under the covers' in UTF-8, U+00ff is really U+00c3 U+00bf.</p><blockquote><p><i>The main difference is that your statement would not be true, since those byte sequences would not be represented that way! :-)</i> <br></p></blockquote>
<p>On a sort-of related note, it's always bugged me that the convention is to denote Unicode codepoints as U+xxxx by default, even though the range extends to U+10FFFF. I know about Unicode's 16-bit origins, but it seems silly today to write U+00ff instead of either U+ff (no padding) or U+0000ff (full padding). It certainly doesn't help when you're trying to explain that Unicode is not 16-bit when pretty much every technical document out there writes out BMP codepoints as if it is.</p><blockquote><p><i>I will probably blog about this topic, it has been on my list for a while now - Michael</i><br></p></blockquote></div>
<p><strong>jmdesp</strong> on 19 Sep 2008 6:23 AM:</p><div style="margin-left: 1em"><p>What is the win32 way of getting the same kind of info asStringInfo ?</p>
<p>It seems you haven't noticed that IE handles cursor movements around ‡¶Æ‡ßç‡¶™‡¶æ perfectly well (try ‡¶Æ‡ßç‡¶™‡¶æ‡¶Æ‡ßç‡¶™‡¶æ, it's only two blocs for IE, even with version 6), so using win32 it manages to get an even better result than StringInfo.</p>
<p>About Fx ? Well, I'll enter the bug about it being two trains behind IE ASAP.</p></div>
<p><strong>Michael S. Kaplan</strong> on 19 Sep 2008 7:51 AM:</p><div style="margin-left: 1em"><p>IE is using Uniscribe here, I believe -- which does better than StringInfo. The Win32 way would be that, or to get StringInfo type results to use GetStringTypeW to roll one's own support (plus doing surrogate pairs oneself in &lt; Vista).</p>
</div>
<p><strong>Jan Kuƒçera</strong> on 27 Sep 2008 4:28 PM:</p><div style="margin-left: 1em"><p>I think 'ch' falls into your third category in Czech as well, and I would feel it was absolutely weird if I could not put a cursor between c and h. Not sure if this is only because we don't have 'ch' on keyboard, though. I've asked five people I have with me at the moment (different skills and age) and nobody thinks 'ch' should be single character from the cursor movement point of view (one said she doesn't care). Though I'm sure some people think so, which makes this behavior not-that-easy at all, and would probably need to be configurable at least...</p></div>
<hr/><p><em>referenced by</em></p><div style="margin-left: 1em"><p>2009/06/29 <a href="http://archives.miloush.net/michkap/archive/2009/06/29/9800913.html">UCS-2 to UTF-16, Part 11: Turning it up to Eleven!</a></p><p>2009/06/10 <a href="http://archives.miloush.net/michkap/archive/2009/06/10/9723321.html">UCS-2 to UTF-16, Part 10: Variation[ Selector] on a theme...</a></p><p>2008/12/16 <a href="http://archives.miloush.net/michkap/archive/2008/12/16/9223301.html">UCS-2 to UTF-16, Part 9: The torrents of breaking CharNext/CharPrev</a></p><p>2008/12/09 <a href="http://archives.miloush.net/michkap/archive/2008/12/09/9187379.html">UCS-2 to UTF-16, Part 8: It's the end of the string as we know it (and I feel ellipses)</a></p><p>2008/12/04 <a href="http://archives.miloush.net/michkap/archive/2008/12/04/9173687.html">UCS-2 to UTF-16, Part 7: If it makes the SQL Server columns too small then it made the Oracle columns either too smallER or too smallEST</a></p><p>2008/11/24 <a href="http://archives.miloush.net/michkap/archive/2008/11/24/9134826.html">UCS-2 to UTF-16, Part 6: An exercise left for whoever needs some exercise</a></p><p>2008/10/15 <a href="http://archives.miloush.net/michkap/archive/2008/10/15/9000371.html">UCS-2 to UTF-16, Part 5: What's on the Next Level?</a></p><p>2008/10/06 <a href="http://archives.miloush.net/michkap/archive/2008/10/06/8977552.html">UCS-2 to UTF-16, Part 4: Talking about the ask</a></p></div><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2008/09/19/8958026.html" title="Sorting the DPRK all Out">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2008/09/17/8954928.html" title="Behind the Proposed Change to Tamil in Unicode (five different ways)">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2008-09">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2008-09-18">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2008/09/18/8956650.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:35 GMT -->
</html>