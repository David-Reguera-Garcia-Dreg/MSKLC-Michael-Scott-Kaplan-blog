<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2008/05/14/8502723.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:36 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>Windows is too busy being consistent with the user to be consistent with itself!</title></head><body>
<h1>Windows is too busy being consistent with the user to be consistent with itself!</h1>
<p><em>by Michael S. Kaplan, published on 2008/05/14 10:01 -04:00, original URI: http://blogs.msdn.com/b/michkap/archive/2008/05/14/8502723.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostNew -->
<P>The mail that came on the other day was:</P>
<BLOCKQUOTE>
<P><EM><FONT face="times new roman,times">We’re seeing an issue that doesn’t seem correct to me, but I just wanted to confirm. In debugging the issue, the developer found that operating system shows the special genitive month name for Hebrew locale and Hebrew lunar calendar only.&nbsp; Does the Hebrew lunar calendar even have special genitive month names? We don’t think so.&nbsp; <BR><BR>Can you shed any light on why Windows would show the special genitive month name only&nbsp; when the user locale is Hebrew and calendar is Hebrew lunar?&nbsp; Is there something we’re calling incorrectly? A Windows bug? ???<BR><BR>Thanks so much for your help,</FONT></EM></P></BLOCKQUOTE>
<P>The repro steps were then provided, but those aren't to relative here. :-)</P>
<P>First, and most importantly, Hebrew does not have genitive month names, or any kind of genitive form that would impact dates. In fact, looking at the Wikipedia on the <A class="" href="http://en.wikipedia.org/wiki/Hebrew_language#Grammar" mce_href="http://en.wikipedia.org/wiki/Hebrew_language#Grammar">Hebrew language</A>:</P>
<BLOCKQUOTE>
<P><FONT face="times new roman,times">Hebrew grammar is partly analytic, expressing such forms as dative, ablative, and accusative using prepositional particles rather than grammatical cases. However, inflection plays a decisive role in the formation of the verbs and nouns. E.g. nouns have a construct state, called "smikhut", to denote the relationship of "belonging to": this is the converse of the genitive case of more inflected languages. Words in smikhut are often combined with hyphens. In modern speech, the use of the construct is sometimes interchangeable with the preposition "shel", meaning "of". There are many cases, however, where older declined forms are retained (especially in idiomatic expressions and the like), and "person"-enclitics are widely used to "decline" prepositions.</FONT></P></BLOCKQUOTE>
<P>There is also a link to more information that explains there is&nbsp;(in a sense)&nbsp;a genitive case -- but if you look at how it is constructed you will see why dates in general and month names in particular are affected.</P>
<P>The interesting issue here is that even though </P>
<UL>
<LI>people on one side were pretty insistent in explaining that Hebrew had no genitive case here</LI>
<LI>there were people on the other side who&nbsp;were equally insistent that there must be one</LI></UL>
<P>since they were seeing the same apparent net effect -- different format strings used in calls to GetDateFormat with the same date values returning different month names.</P>
<P>Interesting conclusion, right? Not terribly accurate, but still kind of astute!</P>
<P>Now I have talked about genitive forms&nbsp;a lot in the past:</P>
<LI><A class="" href="http://archives.miloush.net/michkap/archive/2004/12/25/332259.html" mce_href="http://archives.miloush.net/michkap/archive/2004/12/25/332259.html"><STRONG><FONT size=1>What the %$#! are genitive dates?</FONT></STRONG></A><FONT size=1>&nbsp;(25 December 2004) </FONT>
<LI><A class="" href="http://archives.miloush.net/michkap/archive/2005/07/15/439223.html" mce_href="http://archives.miloush.net/michkap/archive/2005/07/15/439223.html"><STRONG><FONT size=1>Don't roll your own GetDateFormat</FONT></STRONG></A><FONT size=1> (15 July 2005) </FONT>
<LI><STRONG><A class="" href="http://archives.miloush.net/michkap/archive/2005/11/10/491187.html" mce_href="http://archives.miloush.net/michkap/archive/2005/11/10/491187.html"><FONT size=1>Genitive dates, revisited</FONT></A></STRONG><FONT size=1> (10 November 2005) </FONT>
<LI><STRONG><A class="" href="http://archives.miloush.net/michkap/archive/2005/11/10/491199.html" mce_href="../../../2005/11/10/491199.html "><FONT size=1>Do genitive dates always work properly for Greek?</FONT></A></STRONG><FONT size=1> (10 November 2005) </FONT>
<LI><STRONG><A class="" href="http://archives.miloush.net/michkap/archive/2005/11/11/491211.html" mce_href="http://archives.miloush.net/michkap/archive/2005/11/11/491211.html"><FONT size=1>Any Sami speakers reading this blog? :-)</FONT></A></STRONG><FONT size=1> (11 November 2005) </FONT>
<LI><A class="" href="http://archives.miloush.net/michkap/archive/2005/11/12/491274.html" mce_href="http://archives.miloush.net/michkap/archive/2005/11/12/491274.html"><STRONG><FONT size=1>One last post about genitive dates</FONT></STRONG></A><FONT size=1> (12 November 2005) </FONT>
<LI><STRONG><A class="" href="http://archives.miloush.net/michkap/archive/2006/03/20/555288.html" mce_href="http://archives.miloush.net/michkap/archive/2006/03/20/555288.html"><FONT size=1>Practical Uses for Replacement Cultures/Locales</FONT></A></STRONG><FONT size=1> (20 March 2006) </FONT>
<LI><STRONG><A class="" href="http://archives.miloush.net/michkap/archive/2006/04/08/571353.html" mce_href="http://archives.miloush.net/michkap/archive/2006/04/08/571353.html"><FONT size=1>It may not always end with ի</FONT></A></STRONG><FONT size=1> (08 April 2006) </FONT>
<LI><STRONG><A class="" href="http://archives.miloush.net/michkap/archive/2006/04/09/571628.html" mce_href="http://archives.miloush.net/michkap/archive/2006/04/09/571628.html"><FONT size=1>It may not always end with ის or ისა, either</FONT></A></STRONG><FONT size=1> (09 April 2006)</FONT></LI>
<LI><A class="" href="http://archives.miloush.net/michkap/archive/2007/08/04/4218583.html" mce_href="http://archives.miloush.net/michkap/archive/2007/08/04/4218583.html"><STRONG><FONT size=1>A re-genitive post</FONT></STRONG></A><FONT size=1> (04 August 2007)</FONT></LI>
<P>And I wonder whether one or more&nbsp;of them contributed here. In all of those posts I have never gotten too deep into how they are constructed in language.</P>
<P>I probably will talk about this at some point, though not today, since it is not relevant to the problem this team was seeing. :-)</P>
<P>The problem here had a very different cause....</P>
<P>I'll give you a&nbsp;hint what it is.</P>
<P>Consider the blog <A class="" href="http://archives.miloush.net/michkap/archive/2006/09/29/776495.html" mce_href="http://archives.miloush.net/michkap/archive/2006/09/29/776495.html"><STRONG>.NET is too busy being consistent with Windows to be consistent with itself....</STRONG></A>, noting that this is not the actual problem here,&nbsp;though the&nbsp;root cause is&nbsp;similar.</P>
<P>You see, in that blog, the discussion is about how the calendar chosen by the user in Regional and Language Options is causing the calendar being used by the CurrentCulture in the .NET Framework to not be the new, cool&nbsp;default calendar in .NET. The user preference overrides things.</P>
<P>This bug in the reported Hebrew case was that the month names were being retrieved by&nbsp;several different ways, including&nbsp;calls to <A class="" href="http://msdn.microsoft.com/library/ms776293.aspx" mce_href="http://msdn.microsoft.com/library/ms776293.aspx">GetDateFormat</A> with format strings like "<STRONG>mmmmdd</STRONG>" vs. "mmmm" (which on the surface is a a great way to detect genitive month name usage!). And one other small difference:</P>
<P><STRONG><FONT color=#ff0000>The use of LOCALE_NOUSEROVERRIDE in some cases but not others.</FONT></STRONG></P>
<P>That simple&nbsp;difference, combined with (from the original report) "<EM>when the user locale is Hebrew and calendar is Hebrew lunar</EM>", means that when the LOCALE_NOUSEROVERRIDE&nbsp;flag is passed the Gregorian month comes out; when the flag is not, the Hebrew lunar month comes out.</P>
<P>Just like the user wants!</P>
<P>This will give us דצמבר (December) versus כסלו (Kislev) and so on.</P>
<P>Our "non-genitive" form. :-)</P>
<P>The actual code difference between&nbsp;the two cases&nbsp;feels quite natural, because after all there are performance benefits to using LOCALE_NOUSEROVERRIDE when you can get away with it. </P>
<P>Who would say no to reasonable performance enhancements?</P>
<P>And we don't tend to think about things like month names changing, so it seems like a great candidate for optimization. Only in this case, it isn't, so much. :-(</P>
<P>You can even see it in managed code in those same circumstances where the user locale choices cause the data to be handled/interpreted differently. Just like what was described in <A class="" href="http://archives.miloush.net/michkap/archive/2006/09/29/776495.html" mce_href="http://archives.miloush.net/michkap/archive/2006/09/29/776495.html"><STRONG>.NET is too busy being consistent with Windows to be consistent with itself....</STRONG></A></P>
<P>And if you want to avoid those different month names, remember to call the functions more&nbsp;consistently!</P>
<P><FONT color=#ff00ff><EM>This blog brought to you by</EM><FONT size=7> כ </FONT><EM>(U+05db, aka HEBREW LETTER KAF)</EM></FONT></P>
<hr/><div style="margin-left: 1em"><em>no comments</em></div><hr/><p><em>referenced by</em></p><div style="margin-left: 1em"><p>2010/03/10 <a href="http://archives.miloush.net/michkap/archive/2010/03/10/9976075.html">They pushed out of the formatt[ing|er]</a></p></div><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2008/05/15/8506679.html" title="A celebration of the LATIN CAPITAL LETTER SHARP S">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2008/05/14/8500866.html" title="We&#39;d have been better able to give a Whit if we hadn&#39;t been in such a HoliDAZE">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2008-05">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2008-05-14">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2008/05/14/8502723.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:36 GMT -->
</html>