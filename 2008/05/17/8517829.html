<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2008/05/17/8517829.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:36 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>The undocumented limits are the ones that can trip you</title></head><body>
<h1>The undocumented limits are the ones that can trip you</h1>
<p><em>by Michael S. Kaplan, published on 2008/05/17 20:04 -04:00, original URI: http://blogs.msdn.com/b/michkap/archive/2008/05/17/8517829.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostNew -->
<P>Over in the Suggestion Box, regular reader Andrew West asked:</P>
<BLOCKQUOTE>
<P><EM><FONT face="times new roman,times">Hi Michael,<BR><BR>Here's another weird bug with the IE font configuration dialog that I've just found.<BR><BR>I've been creating a suite of Ogham fonts, and I've been finding that some of them show up in the Ogham font list of Internet Explorer, and some quite unexplicably do not. It has taken me all morning, and I've finally worked out that it is nothing whatsoever to do with the font internally, but depends entirely on the length of the font's filename. If the filename (including extension) is 31 characters or less then the font is added to the Ogham font list, but if it is 32 characters or more then it is not. So "BabelStone_Ogham_0123456789.ttf" is OK, but if I rename the file to "BabelStone_Ogham_0123456789X.ttf" and reinstall it, then it does not show up in the Ogham font list. But the really strange thing is that all the fonts always show up in the Latin font list, regardless of the length of their filename.<BR><BR>I don't suppose that there is much you can do or say about this, but I thought it might amuse you.<BR><BR>Andrew</FONT></EM></P></BLOCKQUOTE>
<P>My goodness.</P>
<P>You'd think by now that there is little that I couldn't say <STRONG>something</STRONG> about. :-)</P>
<P>The number 32. To borrow a phrase from The Church Lady, <EM>isn't that <STRONG>convenient</STRONG>?</EM>, if you know what I mean.</P>
<P>In computers, a numerologist could spend his or her time in ecstasy, knowing that their belief that the numbers behind what happens are significant is actually proven fact.</P>
<P>In this case, I&nbsp;mean given the following definition in wingdi.h from the Platform SDK:</P>
<BLOCKQUOTE>
<P><FONT face="consolas,lucida console,courier new,courier"><STRONG>/* Logical Font */<BR>#define LF_FACESIZE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 32</STRONG></FONT></P></BLOCKQUOTE>
<P>This constant is the size limit of the&nbsp;lpFaceName member of the <A class="" href="http://msdn.microsoft.com/library/ms533931.aspx" mce_href="http://msdn.microsoft.com/library/ms533931.aspx">LOGFONT</A> structure, and the reason behind the documented 32-character limit of the lpszFace parameter of the <A class="" href="http://msdn.microsoft.com/library/ms534214.aspx" mce_href="http://msdn.microsoft.com/library/ms534214.aspx">CreateFont</A> function.</P>
<P>Without even looking at the code, I would be more than willing to bet that&nbsp;the code in the MLang font link code that stores the name is incorrectly making use of that same limit, possibly even that same constant.</P>
<P>It would be a bug of course, but an explanation, at least. :-)</P>
<P>The net effect would be that MLang never enumerates the font and thus IE never displays it.</P>
<P><EM>Right after I wrote this, I took a look at the code. and it&nbsp;does indeed appear that LF_FACESIZE buffers and specified lengths are gumming up the works here....</EM></P>
<P>An interesting bug for the owners of MLang to look into (though the need to verify that none of the clients of MLang are making similar assumptions&nbsp;might make the cost of the fix a bit too high!).</P>
<P>And a pleasant distraction on a Saturday afternoon while I am nursing too much of&nbsp; hangover to do anything more productive than that. :-)</P>
<P><EM><FONT color=#ff00ff>This blog brought to you by<FONT size=7> ‚âê </FONT>(<A class="" href="http://www.fileformat.info/info/unicode/char/2250" mce_href="http://www.fileformat.info/info/unicode/char/2250">U+2250</A>, aka APPROACHES THE LIMIT)</EM></FONT></P>
<hr/><p><strong>Andrew West</strong> on 18 May 2008 12:18 PM:</p><div style="margin-left: 1em"><p>I'm not sure that I've explained the problem clearly enough. It is not the length of the font's face name, but the length of the font's filename. So, if I have two identical fonts that support Latin and Ogham, one with the face name &quot;BabelStone Ogham A&quot; and filename &quot;BabelStone_Ogham_0123456789.ttf&quot; (31 characters), and the other with the face name &quot;BabelStone Ogham B&quot; and filename &quot;BabelStone_Ogham_0123456789X.ttf&quot; (32 characters). Both &quot;BabelStone Ogham A&quot; and &quot;BabelStone Ogham B&quot; are listed under &quot;Latin based&quot; fonts, but only &quot;BabelStone Ogham A&quot; is listed under &quot;Ogham&quot; fonts, so for Latin based fonts the length of the font's filename does not matter, but it does for Ogham fonts -- but why is it even looking at the font's filename?</p>
<p>I've just done an experiment with Code2000, which is listed in every &quot;Language script&quot; in the IE Font Configuration dialog except for Mongolian, Myanmar, Sinhala and Tibetan (of course, Sinhala and Tibetan are the only scripts it is really missing). I deleted Code2000 from the Fonts folder, then renamed its *filename* to &quot;CodeTwoThousand_by_James_Kass.ttf&quot; (33 characters), and reinstalled it. Then when I reopen the IE font configuration dialog, &quot;Code2000&quot; is only listed under Arabic, Chinese Simplified, Chinese Traditional, Cyrillic, Greek, Hebrew, Japanese, Korean, Latin based, Thai and User Defined; but no longer appears under any other script (disappeared from Armenian, Bengali, Braille, Canadian Syllabic, Cherokee, Devanagari, Ethiopic, Georgian, Gujarati, Gurmukhi, Kannada, Khmer, Lao, Malayalam, Ogham, Oriya, Runic, Syriac, Tamil, Telugu, Thaana and Yi). I wonder what these scripts have in common ...</p></div>
<p><strong>Michael S. Kaplan</strong> on 18 May 2008 2:55 PM:</p><div style="margin-left: 1em"><p>Actually, I understood you just fine -- there is code in MLang's super-super &quot;what script for what characters&quot; font linking that assumes that LF_FACENAME is appropriate for the font file name just as much as the font face name. That code is wrong -- and would be a bug. </p>
<p>Note that it is not the only code that runs here -- code for script detection expected to be in lots of fonts because it is such on the MS-provided OS goes through a different code path.</p>
<p>It is a bug, sure. But is a pretty central misunderstanding in this code that might be too risky to touch....</p>
</div>
<hr/><p><em>referenced by</em></p><div style="margin-left: 1em"><p>2008/06/12 <a href="http://archives.miloush.net/michkap/archive/2008/06/12/8592568.html">Truly a font of absolute last resort</a></p></div><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2008/05/18/8517919.html" title="If spamming me multilingually, please encode the language correctly!">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2008/05/17/8516386.html" title="Do your utmost to be conventional (and then pimp, q.d. or p.r.n.)">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2008-05">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2008-05-17">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2008/05/17/8517829.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:36 GMT -->
</html>