<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2008/05/12/8486796.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:36 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>İn tıtlıng thıs ınclusıon ın re: the ınterests of Turkısh İSVs, am İ just tryıng to buıld İ's and ı's ınto the tıtle of thıs daıly contrıbutıon to SİAO (SıaO), amıgo?</title></head><body>
<h1>İn tıtlıng thıs ınclusıon ın re: the ınterests of Turkısh İSVs, am İ just tryıng to buıld İ's and ı's ınto the tıtle of thıs daıly contrıbutıon to SİAO (SıaO), amıgo?</h1>
<p><em>by Michael S. Kaplan, published on 2008/05/12 03:01 -04:00, original URI: http://blogs.msdn.com/b/michkap/archive/2008/05/12/8486796.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostNew -->
<P>It is a commonly reported issue in Windows and many components that run upon it,&nbsp;a recent one can be seen on the <A class="" href="https://connect.microsoft.com/" mce_href="https://connect.microsoft.com/">Connect</A> site, <A class="" href="https://connect.microsoft.com/VisualStudio/feedback/ViewFeedback.aspx?FeedbackID=336723" mce_href="https://connect.microsoft.com/VisualStudio/feedback/ViewFeedback.aspx?FeedbackID=336723">here</A>:</P>
<BLOCKQUOTE>
<P><STRONG>Description</STRONG>: <BR>There is a conversion problem in the c/c++ runtime library. Turkish characters ı/I and i/İ are converted incorrectly to upper/lower case.<BR><BR><STRONG>Code that reproduces the issue:</STRONG></P>
<BLOCKQUOTE>
<P><FONT face="consolas,lucida console,courier new,courier"><STRONG>#include "stdafx.h"<BR>#include &lt;string&gt;<BR>#include &lt;xlocale&gt;<BR>#include &lt;iostream&gt;<BR>#include &lt;algorithm&gt;<BR>#include &lt;functional&gt;<BR>int _tmain(int argc, _TCHAR* argv[]) {<BR>&nbsp;&nbsp;&nbsp; std::locale a = std::locale::locale();<BR>&nbsp;&nbsp;&nbsp; std::locale::global (std::locale("Turkish"));<BR>&nbsp;&nbsp;&nbsp; std::locale b = std::locale::locale();<BR>&nbsp;&nbsp;&nbsp; std::cout &lt;&lt; a.name().c_str() &lt;&lt; " -&gt; " &lt;&lt; b.name().c_str() &lt;&lt; std::endl;<BR>&nbsp;&nbsp;&nbsp; std::wstring lowerCase = _T("ığüşiöç");<BR>&nbsp;&nbsp;&nbsp; std::wstring upperCase = _T("IĞÜŞİÖÇ");<BR>&nbsp;&nbsp;&nbsp; std::wstring upperResult, lowerResult;<BR><BR>&nbsp;&nbsp;&nbsp; upperResult.resize(lowerCase.length());<BR>&nbsp;&nbsp;&nbsp; lowerResult.resize(lowerCase.length());<BR>&nbsp;&nbsp;&nbsp; std::transform(lowerCase.begin(), lowerCase.end(), upperResult.begin(), towupper);<BR>&nbsp;&nbsp;&nbsp; std::transform(upperCase.begin(), upperCase.end(), lowerResult.begin(), towlower);<BR><BR>&nbsp;&nbsp;&nbsp; std::wcout &lt;&lt; lowerCase &lt;&lt; std::endl;<BR>&nbsp;&nbsp;&nbsp; std::wcout &lt;&lt; lowerResult &lt;&lt; std::endl;<BR>&nbsp;&nbsp;&nbsp; std::wcout &lt;&lt; upperCase &lt;&lt; std::endl;<BR>&nbsp;&nbsp;&nbsp; std::wcout &lt;&lt; upperResult &lt;&lt; std::endl;<BR>&nbsp;&nbsp;&nbsp; if (upperCase != upperResult || lowerCase != lowerResult) {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; std::cout &lt;&lt; "Conversion failed" &lt;&lt; std::endl;<BR>&nbsp;&nbsp;&nbsp; }<BR>&nbsp;&nbsp;&nbsp; return 0;<BR>}</STRONG></FONT></P></BLOCKQUOTE>
<P><STRONG>Observed&nbsp;Results:</STRONG><BR><BR>&nbsp;&nbsp;&nbsp; C -&gt; Turkish_Turkey.1254<BR>&nbsp;&nbsp;&nbsp; ığüşiöç<BR>&nbsp;&nbsp;&nbsp; iğüşİöç<BR>&nbsp;&nbsp;&nbsp; IĞÜŞİÖÇ<BR>&nbsp;&nbsp;&nbsp; ıĞÜŞIÖÇ<BR>&nbsp;&nbsp;&nbsp; Conversion failed<BR><BR><STRONG>Expected Results:</STRONG><BR><BR>&nbsp;&nbsp;&nbsp; C -&gt; Turkish_Turkey.1254<BR>&nbsp;&nbsp;&nbsp; ığüşiöç<BR>&nbsp;&nbsp;&nbsp; ığüşiöç<BR>&nbsp;&nbsp;&nbsp; IĞÜŞİÖÇ<BR>&nbsp;&nbsp;&nbsp; IĞÜŞİÖÇ</P></BLOCKQUOTE>
<P mce_keep="true">The issue boils down to the very simple fact that the C runtime's casing functions are being used underneath this code, and <A class="" href="http://msdn.microsoft.com/library/ms776290.aspx" mce_href="http://msdn.microsoft.com/library/ms776290.aspx">LCMapString</A> is being called underneath that.</P>
<P mce_keep="true">They are passing the Turkish locale to <A class="" href="http://msdn.microsoft.com/library/ms776290.aspx" mce_href="http://msdn.microsoft.com/library/ms776290.aspx">LCMapString</A>, but they are not passing the LCMAP_LINGUISTIC_CASING function, which means that Turkic case tables are not being used.</P>
<P mce_keep="true">On the surface, there is an easy fix -- just make LCMAP_LINGUISTIC_CASING get passed here, right?</P>
<P mce_keep="true">Though it is of course not that simple or it would&nbsp;have been fixed years ago, and I wouldn't be blogging about it here....</P>
<P mce_keep="true">I'll point toward two blog posts from the end of 2004:</P>
<UL>
<LI>
<DIV mce_keep="true"><A class="" href="http://archives.miloush.net/michkap/archive/2004/12/03/274288.html" mce_href="http://archives.miloush.net/michkap/archive/2004/12/03/274288.html"><STRONG>The [Upper]Case of the Turkish İ (or: Casing, the 2nd)</STRONG></A></DIV></LI>
<LI>
<DIV mce_keep="true"><A class="" href="http://archives.miloush.net/michkap/archive/2004/12/11/279942.html" mce_href="http://archives.miloush.net/michkap/archive/2004/12/11/279942.html"><STRONG>What does "linguistic casing" mean?</STRONG></A></DIV></LI></UL>
<P mce_keep="true">Especially that second one, which points out the two things that the LCMAP_LINGUISTIC_CASING flag does:</P>
<OL>
<LI>
<DIV mce_keep="true">You get the right behavior for <A href="http://archives.miloush.net/michkap/archive/2004/12/03/274288.html">Turkic</A>&nbsp;locales like Turkish and Azeri; </DIV></LI>
<DIV></DIV>
<LI>You get a bunch of one-way mappings&nbsp;on all locales, e.g. U+03f1 (Greek Rho Symbol) will uppercase to U+03a1 (Capital Greek Rho), which will lowercase to U+03c1 (Small Greek Rho).</LI></OL>
<P mce_keep="true">Now #1 is the "fix" for this bug, sure. It even kind of goes along with the C/C++ standards in this regard, e.g. 7.25.3.2.1.3 and 7.25.3.2.2.3 of C99:</P>
<BLOCKQUOTE>
<P mce_keep="true"><FONT face="times new roman,times">7.25.3.2.1.3 (the towlowercase function): If the argument is a wide character for which iswupper is true and there are one or more corresponding wide characters, as specified by the current locale, for which iswlower is true, the towlower function returns one of the corresponding wide characters (always the same one for any given locale); otherwise, the argument is returned unchanged. <BR><BR>7.25.3.2.2.3 (the towuppercase function): If the argument is a wide character for which iswlower is true and there are one or more corresponding wide characters, as specified by the current locale, for which iswupper is true, the towupper function returns one of the corresponding characters (always the same one for any given locale); otherwise, the argument is returned unchanged. </FONT></P></BLOCKQUOTE>
<P mce_keep="true">It is the second point in that definition, which adds all of the following <STRONG>other</STRONG> mappings, that makes all of this messier.</P>
<P mce_keep="true">Those other mappings are:</P>
<BLOCKQUOTE>
<P mce_keep="true">Uppercase (all locales other than Azeri and Turkish):</P>
<BLOCKQUOTE>
<P mce_keep="true"><FONT face="consolas,lucida console,courier new,courier" size=1><STRONG>U+0131 --&gt; U+0049 (LATIN SMALL LETTER DOTLESS I --&gt; LATIN CAPITAL LETTER I)<BR>U+01c5 --&gt; U+01c4 (LATIN CAPITAL LETTER D WITH SMALL LETTER Z WITH CARON --&gt; LATIN CAPITAL LETTER DZ WITH CARON)<BR>U+01c8 --&gt; U+01c7 (LATIN CAPITAL LETTER L WITH SMALL LETTER J --&gt; LATIN CAPITAL LETTER LJ)<BR>U+01cb --&gt; U+01ca (LATIN CAPITAL LETTER N WITH SMALL LETTER J --&gt; LATIN CAPITAL LETTER NJ)<BR>U+01f2 --&gt; U+01f1 (LATIN CAPITAL LETTER D WITH SMALL LETTER Z --&gt; LATIN CAPITAL LETTER DZ)<BR>U+0390 --&gt; U+03aa (GREEK SMALL LETTER IOTA WITH DIALYTIKA AND TONOS --&gt; GREEK CAPITAL LETTER IOTA WITH DIALYTIKA)<BR>U+03b0 --&gt; U+03ab (GREEK SMALL LETTER UPSILON WITH DIALYTIKA AND TONOS --&gt; GREEK CAPITAL LETTER UPSILON WITH DIALYTIKA)<BR>U+03d0 --&gt; U+0392 (GREEK BETA SYMBOL --&gt; GREEK CAPITAL LETTER BETA)<BR>U+03d1 --&gt; U+0398 (GREEK THETA SYMBOL --&gt; GREEK CAPITAL LETTER THETA)<BR>U+03d5 --&gt; U+03a6 (GREEK SMALL LETTER DIGAMMA --&gt; GREEK CAPITAL LETTER PHI)<BR>U+03d6 --&gt; U+03a0 (GREEK PI SYMBOL --&gt; GREEK CAPITAL LETTER PI)<BR>U+03f0 --&gt; U+039a (GREEK KAPPA SYMBOL --&gt; GREEK CAPITAL LETTER KAPPA)<BR>U+03f1 --&gt; U+03a1 (GREEK RHO SYMBOL --&gt; GREEK CAPITAL LETTER RHO)</STRONG></FONT></P></BLOCKQUOTE>
<P mce_keep="true">Lowercase (all locales other than Azeri and Turkish):</P>
<BLOCKQUOTE>
<P mce_keep="true"><STRONG><FONT face="consolas,lucida console,courier new,courier" size=1>U+0130 --&gt; U+0069&nbsp;(LATIN CAPITAL LETTER I WITH DOT ABOVE --&gt; LATIN SMALL LETTER I)<BR>U+01c5 --&gt; U+01c6 (LATIN CAPITAL LETTER D WITH SMALL LETTER Z WITH CARON --&gt; LATIN SMALL LETTER DZ WITH CARON)<BR>U+01c8 --&gt; U+01c9 (LATIN CAPITAL LETTER L WITH SMALL LETTER J --&gt; LATIN SMALL LETTER LJ)<BR>U+01cb --&gt; U+01cc (LATIN CAPITAL LETTER N WITH SMALL LETTER J --&gt; LATIN SMALL LETTER NJ)<BR>U+01f2 --&gt; U+01f3 (LATIN CAPITAL LETTER D WITH SMALL LETTER Z --&gt; LATIN SMALL LETTER DZ)<BR>U+03d2 --&gt; U+03c5 (GREEK UPSILON WITH HOOK SYMBOL --&gt; GREEK SMALL LETTER UPSILON)<BR>U+03d3 --&gt; U+03cd (GREEK UPSILON WITH ACUTE AND HOOK SYMBOL --&gt; GREEK SMALL LETTER UPSILON WITH TONOS)<BR>U+03d4 --&gt; U+03cb (GREEK UPSILON WITH DIAERESIS AND HOOK SYMBOL --&gt; GREEK SMALL LETTER UPSILON WITH DIALYTIKA)</FONT></STRONG></P></BLOCKQUOTE></BLOCKQUOTE>
<P mce_keep="true">Now these somewhat random behaviors exist in all of the case mappings that happen in .NET except for the ones based on the InvariantCulture, which ends up as the source for lot of unexpected behavior that pops up from time to time, and not only due to the fact that as lists go they are incomplete....</P>
<P mce_keep="true"><EM>You can look at them probably guess some of the problems they can cause with these strange one-way conversions!</EM></P>
<P mce_keep="true">But adding this to the CRT's behavior would essentially be adding these non-reversible transformations to almost every call. Which is not really desirable behavior, in some people's minds....</P>
<P mce_keep="true">The real question would be whether this bug would be considered more reasonable to fix if Win32 supported a more granular kind of functionality than LCMAP_LINGUISTIC_CASING provides -- a way that would keep the linguistically useful separate from the random "rehabilitate symbols" crap and all of the rest....</P>
<P mce_keep="true">&nbsp;</P>
<P mce_keep="true"><EM><FONT color=#ff00ff>This blog brought to you by all of the above cited Unicode characters...</FONT></EM></P>
<hr/><div style="margin-left: 1em"><em>no comments</em></div><hr/><p><em>referenced by</em></p><div style="margin-left: 1em"><p>2008/06/25 <a href="http://archives.miloush.net/michkap/archive/2008/06/25/8652525.html">Seeing the tears, my heart went out to her as I asked her "Why the Long S?"</a></p></div><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2008/05/12/8490406.html" title="What happens when you involve an unenabled Uniscribe with vertical text, given that Uniscribe doesn&#39;t handle vertical text?">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2008/05/11/8488020.html" title="The vector of this spam is [apparently] indeterminate">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2008-05">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2008-05-12">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2008/05/12/8486796.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:36 GMT -->
</html>