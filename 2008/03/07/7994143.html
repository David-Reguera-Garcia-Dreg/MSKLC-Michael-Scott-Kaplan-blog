<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2008/03/07/7994143.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:36 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>Requirements first, criticism of attempted solutions second!</title></head><body>
<h1>Requirements first, criticism of attempted solutions second!</h1>
<p><em>by Michael S. Kaplan, published on 2008/03/07 08:01 -05:00, original URI: http://blogs.msdn.com/b/michkap/archive/2008/03/07/7994143.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostNew -->
<P><FONT color=#ff0000 size=1><EM>Please read the </EM></FONT><A class="" href="http://archives.miloush.net/michkap/archive/2008/02/28/7934999.html" mce_href="http://archives.miloush.net/michkap/archive/2008/02/28/7934999.html"><EM><FONT size=1>disclaimer</FONT></EM></A><EM><FONT color=#ff0000 size=1>; content not approved by Microsoft!</FONT></EM></P>
<P>Dujuan's question&nbsp;to the larger distribution list was easy enough:</P>
<BLOCKQUOTE>
<P><FONT face="times new roman,times">Hi, <BR><BR></FONT><FONT face="times new roman,times">I want to get the language name in the OS, such as string ”en-US” or “it-IT” . <BR><BR></FONT><FONT face="times new roman,times">I use the GetLocaleInfo(GetSystemDefaultLCID(),<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; LOCALE_SNAME,<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; pszLocale,<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp; k) <BR><BR></FONT><FONT face="times new roman,times">In vista, the pszLocale&nbsp;get&nbsp;the&nbsp;language name correctly. However,&nbsp;the LOCALE_SNAME can only be used in Vista. <BR><BR></FONT><FONT face="times new roman,times">When I run the program Under XP, the&nbsp;pszLocale&nbsp;get&nbsp;nothing!<BR><BR></FONT><FONT face="times new roman,times">So, is there some other ways I can get the language name in XP?<BR><BR></FONT><FONT face="times new roman,times">Thank you for help!</FONT></P></BLOCKQUOTE>
<P>Well, first we'll deal with the XP results -- easy enough by looking at the <A class="" href="http://msdn2.microsoft.com/library/bb507201.aspx" mce_href="http://msdn2.microsoft.com/library/bb507201.aspx">LCTYPE information</A> referenced from <A class="" href="http://msdn2.microsoft.com/library/ms776270.aspx" mce_href="http://msdn2.microsoft.com/library/ms776270.aspx">GetLocaleInfo</A>:</P>
<BLOCKQUOTE>
<BLOCKQUOTE>
<P>LOCALE_SNAME</P>
<BLOCKQUOTE>
<P><STRONG>Windows Vista and later:</STRONG> <A href="http://msdn2.microsoft.com/library/ms776389.aspx">Locale name</A>, a multipart tag to uniquely identify this locale. The maximum number of characters allowed for this string is 85, including a terminating null character. The tag is based on the language tagging conventions of RFC 4646. The pattern to use is described in <A href="http://msdn2.microsoft.com/library/ms776389.aspx">Locale Names</A>. See also <A href="http://msdn2.microsoft.com/library/bb507201.aspx#LocaleName">Locale Name Constants</A> </P></BLOCKQUOTE></BLOCKQUOTE></BLOCKQUOTE>
<P mce_keep="true">Well, there is an obvious reason for the function to not fill in the value -- the particular LOCALE_SNAME&nbsp;value is not supported in XP. </P>
<P mce_keep="true"><EM>Of course the ERROR_INVALID_PARAMETER last error that the </EM><A class="" href="http://msdn2.microsoft.com/library/ms776270.aspx" mce_href="http://msdn2.microsoft.com/library/ms776270.aspx"><EM>GetLocaleInfo</EM></A><EM>&nbsp;call would cause could also be considered an important clue, though as we know no one ever checks return values for failure!</EM> :-)</P>
<P mce_keep="true">But let's look beyond that for a moment.</P>
<P mce_keep="true">The code Dujuan alludes to is relying on a call to <A class="" href="http://msdn2.microsoft.com/library/ms776315.aspx" mce_href="http://msdn2.microsoft.com/library/ms776315.aspx">GetSystemDefaultLCID</A>, which returns the LCID associated with the default system locale (known in XP as the <STRONG>language for non-Unicode programs</STRONG>. Now it is not 100% clear what Dujuan is looking for in the "language name in the OS" but it almost certainly is not a changeable/configurable&nbsp;setting, right?</P>
<P mce_keep="true">It sounds more like the <A class="" href="http://msdn2.microsoft.com/library/ms776263.aspx" mce_href="http://msdn2.microsoft.com/library/ms776263.aspx">GetSystemDefaultUILanguage</A> might be a better function to rely on, it gets the install language of Windows -- which sounds like it might be closer to the "language name in the OS" in any case. Though that setting has all of the limitations that I mentioned back when I explained <A class="" href="http://archives.miloush.net/michkap/archive/2005/03/25/402313.html" mce_href="http://archives.miloush.net/michkap/archive/2005/03/25/402313.html"><STRONG>how useless InstalledUICulture is</STRONG></A>.</P>
<P mce_keep="true">Though without more information about exactly what the goal of having the information is, there is no way to really know what the right answer might be here....</P>
<P mce_keep="true">Which is the real answer here -- until the exact requirements are understood, it is easy though ultimately ineffectual to pick holes in all of the problems encountered in attempts to solve the problem!</P>
<P mce_keep="true">&nbsp;</P>
<P mce_keep="true"><FONT color=#ff00ff><EM>This blog brought to you by</EM><FONT size=5> Ꮐ </FONT><EM>(<A class="" href="http://www.fileformat.info/info/unicode/char/13c0" mce_href="http://www.fileformat.info/info/unicode/char/13c0">U+13c0</A>, aka CHEROKEE LETTER NAH)</EM></FONT></P>
<hr/><p><strong>KJK::Hyperion</strong> on 7 Mar 2008 9:53 PM:</p><div style="margin-left: 1em"><p>You can use MLang to resolve a locale id to a RFC 1766/3066/4646 identifier, with LcidToRfc1766</p></div>
<p><strong>Michael S. Kaplan</strong> on 7 Mar 2008 10:18 PM:</p><div style="margin-left: 1em"><p>Although somewhat true, there are limitations to it (such as the fact that in some versions the data is badly out of date, the extra component dependency, he fact that MLang itself hasn't seen much in the way of updates since RFC1766 was the only RFC available!).</p>
</div>
<hr/><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2008/03/07/8086758.html" title="Some armchair root cause analysis of the suckage of lstrcmpi">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2008/03/06/8026142.html" title="Getting the IME name (for someone who speaks Chinese, based on code from an article written in Chinese, when you don&#39;t speak Chinese)">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2008-03">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2008-03-07">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2008/03/07/7994143.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:36 GMT -->
</html>