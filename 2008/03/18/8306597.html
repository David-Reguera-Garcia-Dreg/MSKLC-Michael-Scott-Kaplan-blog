<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2008/03/18/8306597.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:36 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>Conventional wisdom is retarded, aka What the @#%&* is _O_U16TEXT?</title></head><body>
<h1>Conventional wisdom is retarded, aka What the @#%&* is _O_U16TEXT?</h1>
<p><em>by Michael S. Kaplan, published on 2008/03/18 07:01 -04:00, original URI: http://blogs.msdn.com/b/michkap/archive/2008/03/18/8306597.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostNew -->
<P><FONT color=#ff0000 size=1><EM>Please read </EM></FONT><A href="http://archives.miloush.net/michkap/archive/2008/02/28/7934999.html" mce_href="http://archives.miloush.net/michkap/archive/2008/02/28/7934999.html"><EM><FONT size=1>disclaimer</FONT></EM></A><EM><FONT color=#ff0000 size=1>; content of <A href="http://blogs.msdn.com/michkap" mce_href="http://blogs.msdn.com/michkap">Michael Kaplan's blog</A> not approved by Microsoft!</FONT></EM></P>
<P>Once upon a time, <STRONG>everybody knew</STRONG> that the Earth was flat.</P>
<P>And not too long after that, <STRONG>everybbody knew</STRONG> that the Sun orbited around the Earth instead of the other way around.</P>
<P>And most developers <STRONG>know</STRONG> that there is no way to get Unicode output support in the console that will work properly both in the console and when redirected to a file.</P>
<P>I was just looking at some internal guidelines for developers inside of Microsoft that bemoaned all the things that don't work in the console:</P>
<BLOCKQUOTE>
<P><FONT face=Verdana>The main limitations can be summarized as:</FONT></P>
<OL style="MARGIN-TOP: 0in; MARGIN-BOTTOM: 0in" type=1>
<LI class=MsoNormal><EM style="FONT-STYLE: normal"><SPAN style="FONT-FAMILY: Verdana; FONT-SIZE: 10pt">Unicode I/O with ReadConsoleW/WriteConsoleW is always supported; but default raster font will break it. </SPAN></EM>
<LI class=MsoNormal><EM style="FONT-STYLE: normal"><SPAN style="FONT-FAMILY: Verdana; FONT-SIZE: 10pt">Changing console codepage is always possible, but DBCS codepages are supported under DBCS system locales (not necessarily matching).</SPAN></EM> 
<LI class=MsoNormal><SPAN style="FONT-FAMILY: Verdana; FONT-SIZE: 10pt">The console does not support&nbsp;</SPAN><STRONG style="FONT-WEIGHT: 400"><SPAN style="FONT-FAMILY: Verdana; FONT-SIZE: 10pt">complex script </SPAN></STRONG><SPAN style="FONT-FAMILY: Verdana; FONT-SIZE: 10pt">languages such as Arabic or the various Indic languages that can only be rendered with Uniscribe.&nbsp;</SPAN> 
<LI class=MsoNormal><SPAN style="FONT-FAMILY: Verdana; FONT-SIZE: 10pt">Unicode I/O is supported through Win32, but with several limitations: </SPAN></LI>
<UL>
<LI class=MsoNormal><SPAN style="FONT-FAMILY: Verdana; FONT-SIZE: 10pt">a user has to select a truetype font in console; </SPAN></LI>
<LI class=MsoNormal><SPAN style="FONT-FAMILY: Verdana; FONT-SIZE: 10pt">no redirection of input/output is supported; </SPAN></LI>
<LI class=MsoNormal><SPAN style="FONT-FAMILY: Verdana; FONT-SIZE: 10pt">CJK languages are supported only under CJK system locales.</SPAN> </LI></UL></OL></BLOCKQUOTE>
<P>Now of these caveats that <STRONG>everybody knows</STRONG>, most of them are <EM>not true</EM>!</P>
<P>And not too long ago someone sent me a piece of mail about that second sub-bullet in #4 and the code he wrote to work around it:</P>
<BLOCKQUOTE><FONT face="Times New Roman,Times">
<P><EM>I think I’m mostly ready. However, I’m still not quite certain about proper handling of redirection of output to a file. The site above suggests the option of using WriteConsole for normal output, and WriteFile+BOM for file output; this is the direction I’ve tried, but I wanted to get confirmation that I’m doing it correctly.<BR><BR>I’ve written the following function (mostly copied from other code):</EM></P>
<BLOCKQUOTE>
<BLOCKQUOTE><FONT face="Consolas,Lucida Console,Courier New,Courier,fixed,Fixed"><B>
<P>static const WCHAR UNICODE_BOM = 0xFEFF;<BR><BR>void UPrint (LPCWSTR String) {<BR>&nbsp;&nbsp;&nbsp; DWORD ConsoleMode;<BR>&nbsp;&nbsp;&nbsp; BOOL ConsoleOutput;<BR>&nbsp;&nbsp;&nbsp; DWORD FileType;<BR>&nbsp;&nbsp;&nbsp; BOOL Result;<BR>&nbsp;&nbsp;&nbsp; HANDLE StdOut;<BR>&nbsp;&nbsp;&nbsp; DWORD StringCharCount;<BR>&nbsp;&nbsp;&nbsp; DWORD Written;<BR><BR>&nbsp;&nbsp;&nbsp; //<BR>&nbsp;&nbsp;&nbsp; // StdOut describes the standard output device.&nbsp; This can be the console<BR>&nbsp;&nbsp;&nbsp; // or (if output has been redirected) a file or some other device type.<BR>&nbsp;&nbsp;&nbsp; //<BR>&nbsp;&nbsp;&nbsp; StdOut = GetStdHandle(STD_OUTPUT_HANDLE);<BR><BR>&nbsp;&nbsp;&nbsp; if (StdOut == INVALID_HANDLE_VALUE) {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; goto PrintExit;<BR>&nbsp;&nbsp;&nbsp; }<BR><BR>&nbsp;&nbsp;&nbsp; //<BR>&nbsp;&nbsp;&nbsp; // Check whether the handle describes a character device.&nbsp; If it does, then<BR>&nbsp;&nbsp;&nbsp; // it may be a console device.&nbsp; A call to GetConsoleMode will fail with<BR>&nbsp;&nbsp;&nbsp; // ERROR_INVALID_HANDLE if it is not a console device.<BR>&nbsp;&nbsp;&nbsp; //<BR>&nbsp;&nbsp;&nbsp; FileType = GetFileType(StdOut);<BR><BR>&nbsp;&nbsp;&nbsp; if ((FileType == FILE_TYPE_UNKNOWN) &amp;&amp; (GetLastError() != ERROR_SUCCESS)) {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; goto PrintExit;<BR>&nbsp;&nbsp;&nbsp; }<BR><BR>&nbsp;&nbsp;&nbsp; FileType &amp;= ~(FILE_TYPE_REMOTE);<BR><BR>&nbsp;&nbsp;&nbsp; if (FileType == FILE_TYPE_CHAR) {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Result = GetConsoleMode(StdOut, &amp;ConsoleMode);<BR><BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if ((Result == FALSE) &amp;&amp; (GetLastError() == ERROR_INVALID_HANDLE)) {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ConsoleOutput = FALSE;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } else {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ConsoleOutput = TRUE;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<BR>&nbsp;&nbsp;&nbsp; } else {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ConsoleOutput = FALSE;<BR>&nbsp;&nbsp;&nbsp; }<BR><BR>&nbsp;&nbsp;&nbsp; //<BR>&nbsp;&nbsp;&nbsp; // If StdOut is a console device then just use the UNICODE console write<BR>&nbsp;&nbsp;&nbsp; // API.&nbsp; This API doesn't work if StdOut has been redirected to a file or<BR>&nbsp;&nbsp;&nbsp; // some other device.&nbsp; In this case, write to StdOut using WriteFile.<BR>&nbsp;&nbsp;&nbsp; //<BR><BR>&nbsp;&nbsp;&nbsp; StringCharCount = (DWORD) wcslen(String);<BR><BR>&nbsp;&nbsp;&nbsp; if (ConsoleOutput != FALSE) {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; WriteConsoleW(StdOut,<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (PVOID)String,<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; StringCharCount,<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &amp;Written,<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; NULL);<BR>&nbsp;&nbsp;&nbsp; } else {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // Write out a Unicode BOM to ensure proper processing by text readers<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; WriteFile(StdOut,<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (PVOID)&amp;UNICODE_BOM,<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; sizeof(UNICODE_BOM),<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &amp;Written,<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; NULL);<BR><BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // The number of bytes to write to standard output must exclude the null<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // terminating character.<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; WriteFile(StdOut,<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (PVOID)String,<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (StringCharCount * sizeof(WCHAR)),<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &amp;Written,<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; NULL);<BR>&nbsp;&nbsp;&nbsp; }<BR><BR>PrintExit:<BR>&nbsp;&nbsp;&nbsp; return;<BR>}</P></B></FONT></BLOCKQUOTE></BLOCKQUOTE>
<P><EM>Based on a couple quick tests, this seems to do the right thing, but review from someone more familiar with the area would be much appreciated. :-)<BR><BR>Thanks!</EM></P></FONT></BLOCKQUOTE>
<P mce_keep="true">Well, at the time the only comment he had gotten back was that that it was a little odd that the BOM was being written on every call since it should only be in the beginning of the file.</P>
<P mce_keep="true">Anyway, remember the other day when I was mentioned in <A href="http://archives.miloush.net/michkap/archive/2008/03/07/8086758.html" mce_href="http://archives.miloush.net/michkap/archive/2008/03/07/8086758.html"><STRONG>Some armchair root cause analysis of the suckage of lstrcmpi</STRONG></A> how I mentioned that <A href="http://nuwen.net/stl.html" mce_href="http://nuwen.net/stl.html">STL</A> dropped by and we were talking about stuff?</P>
<P mce_keep="true">One of the things I mentioned was this problem, and related ones like how you had to use binary mode to write out Unicode text with the CRT functions, thus losing all of the newline and line semantics. He agreed this was lame.</P>
<P mce_keep="true">Then last night he showed me how both Visual Studio 2005 and 2008 (well, Vissual C++ 8.0 and 9.0) that it was not true!</P>
<P mce_keep="true">Basically he created a file something like this:</P>
<BLOCKQUOTE><FONT face="Consolas,Lucida Console,Courier New,Courier,fixed,Fixed"><B>
<P mce_keep="true">#include &lt;fcntl.h&gt;<BR>#include &lt;io.h&gt;<BR>#include &lt;stdio.h&gt;<BR><BR>int main(void) {<BR>&nbsp;&nbsp;&nbsp; _setmode(_fileno(stdout), _O_U16TEXT);<BR>&nbsp;&nbsp;&nbsp; wprintf(L"\x043a\x043e\x0448\x043a\x0430 \x65e5\x672c\x56fd\n");<BR>&nbsp;&nbsp;&nbsp; return 0;<BR>}</P></B></FONT></BLOCKQUOTE>
<P mce_keep="true">And then&nbsp;I compiled the file in the Visual Studio 2005 command line (where I already had my console font set to Lucida Console):</P>
<BLOCKQUOTE><FONT face="Consolas,Lucida Console,Courier New,Courier,fixed,Fixed"><B>
<P mce_keep="true">cl /W4 foo.c</P></B></FONT></BLOCKQUOTE>
<P mce_keep="true">And that FOO.EXE worked beautifully, outputting the Cyrillic and Ideograhic text (<STRONG>кошка 日本国</STRONG>)&nbsp;without corruption, to the command line....</P>
<P mce_keep="true">And when I redirected it to a file, it worked then too, writing out the file as Unicode!</P>
<P mce_keep="true"><IMG src="http://trigeminal.fmsinc.com/images/unicodeconsole01.png"></P>
<P mce_keep="true">Notepad opened it fine and detected it as Unicode even without the BOM; I did have to save it in Notepad to have the console see it that way when I used the <STRONG>type</STRONG> command in the console.</P>
<P mce_keep="true">Here was that console window:</P>
<P mce_keep="true"><IMG src="http://trigeminal.fmsinc.com/images/unicodeconsole02.png"></P>
<P mce_keep="true"><EM>When I copied those boxes from the console and pasted them into Notepad, I once again got the Unicode text both times.</EM></P>
<P mce_keep="true">So&nbsp;much for conventional wisdom. All that WriteConsoleW blitting, the binary file mode,&nbsp;the chcp, the console output CP crap. All to get an answer not as cool as the above.</P>
<P mce_keep="true">The Earth? It isn't flat.</P>
<P mce_keep="true">The sun? It doesn't orbit around the Earth.</P>
<P mce_keep="true">And the CRT? Starting in 2005/8.0, it knows more about Unicode than any of us having been giving it credit for....</P>
<P mce_keep="true">The heroes of the day? <STRONG>_O_U16TEXT</STRONG> and <STRONG>_O_U8TEXT</STRONG>, which I will probably talk about more&nbsp;at some point.</P>
<P mce_keep="true">Or you can look at the <A href="http://msdn2.microsoft.com/library/tw4k6df8(VS.80).aspx" mce_href="http://msdn2.microsoft.com/library/tw4k6df8(VS.80).aspx">_setmode</A> and <A href="http://msdn2.microsoft.com/library/w7sa2b22(vs.80).aspx" mce_href="http://msdn2.microsoft.com/library/w7sa2b22(vs.80).aspx">_wsopen</A> topics (the latter is the only place that&nbsp;<STRONG>_O_U16TEXT</STRONG> and <STRONG>_O_U8TEXT</STRONG> seem to be mentioned:</P>
<BLOCKQUOTE>
<P mce_keep="true"><EM><STRONG>_O_U16TEXT</STRONG> <BR>Open the file in Unicode UTF-16 mode. This option is available in Visual C++ 2005.<BR><BR><STRONG>_O_U8TEXT </STRONG><BR>Open the file in Unicode UTF-8 mode. This option is available in Visual C++ 2005.<BR><BR><STRONG>_O_WTEXT </STRONG><BR>Open the file in Unicode mode. This option is available in Visual C++ 2005.&nbsp;</EM></P></BLOCKQUOTE>
<P mce_keep="true">But it works right here too.</P>
<P mce_keep="true">Awesome, truly.</P>
<P mce_keep="true">And conventional wisdom is quite retarded!</P>
<P mce_keep="true">&nbsp;</P>
<P mce_keep="true"><FONT color=#ff00ff><EM>This post brought to you by</EM><FONT size=5> U </FONT><EM>(<A href="http://www.fileformat.info/info/unicode/char/0055" mce_href="http://www.fileformat.info/info/unicode/char/0055">U+0055</A>, aka LATIN CAPITAL LETTER U)</EM></FONT></P>
<hr/><p><a id="8318850" href="#8318850">#</a> <strong>Ian Griffiths</strong> on 18 Mar 2008 1:50 PM:</p><div style="margin-left: 1em"><p>The &quot;flat earth&quot; model was never a popular one, despite the surprisingly persistent myth to the contrary. There's no evidence to support this assertion, and plenty of evidence to support the idea that people have believed that the Earth was roundish for as long as there are records indicating that people were asking the question &quot;What shape is the earth?&quot;</p>
<p>If you're looking for good examples of conventional wisdom that's wrong, then ironically, &quot;in the old days, people thought the earth was flat&quot; turns out to be a good example, but not for the reasons you supposed. It's not that the belief in a flat earth was conventional wisdom. It's the belief in the belief in a flat earth that is the example of wrong conventional wisdom!</p></div>
<p><a id="8322736" href="#8322736">#</a> <strong>Marc Durdin</strong> on 18 Mar 2008 5:21 PM:</p><div style="margin-left: 1em"><p>Might help if the _wsopen documentation mentioned that _O_WTEXT is UTF-16 with a BOM and _O_U16TEXT is UTF-16 without a BOM.</p>
<p>Conventional wisdom is not retarded... &nbsp;just the documentation. &nbsp;Conventional wisdom dictates that the documentation should be authoritative. &nbsp;Your typical garden programmer would peruse the _setmode documentation and deduce that _O_WTEXT, _O_U16TEXT and _O_U8TEXT are definitely not permissible:</p>
<p>&quot;The mode must be one of two manifest constants: _O_TEXT or _O_BINARY.&quot;</p>
<p>Can that documentation be fixed? &nbsp;So we can all participate in Unicode Console joy without feeling dirty because we are using 'undocumented' flags?</p>
<p>Finally, this doesn't resolve the original writer's problem of the BOM. &nbsp;You still have to do magic if you want to stick a BOM in a redirected file -- in this case, _O_WTEXT appears to behave identically to _O_U16TEXT and does not output a BOM when redirecting to a file.</p></div>
<p><a id="8336764" href="#8336764">#</a> <strong>Mihai</strong> on 25 Mar 2008 7:21 PM:</p><div style="margin-left: 1em"><p>Let's not forget about the cmd.exe switches:</p>
<p> &nbsp; /A &nbsp; &nbsp; &nbsp;Causes the output of internal commands to a pipe or file to be ANSI</p>
<p> &nbsp; /U &nbsp; &nbsp; &nbsp;Causes the output of internal commands to a pipe or file to be Unicode</p>
<p>These might also change things.</p></div>
<p><a id="8337058" href="#8337058">#</a> <strong>Michael S. Kaplan</strong> on 25 Mar 2008 10:59 PM:</p><div style="margin-left: 1em"><p>They change some things, though not all things (and this code overrides these settings).</p>
</div>
<p><strong>Wei Wang</strong> on 31 Aug 2010 9:48 PM:</p><div style="margin-left: 1em"><p>I don&#39;t understand why the author thinks having those Japanese chars displayed as *boxes* in a console window is cool.</p>
<p>- In my console window, the font is set to Lucida truetype (which i think is capable of displaying unicode chars)</p>
<p>- In my machine&#39;s &quot;Regional Settings&quot; I have the &#39;language for non-unicode program&#39; set to US English (which is just the default). </p>
<p>Is there a way to get true Japanese chars displayed in a console window under these settings? In other words, is the following statement under point 4. above true or false?</p>
<p>&quot;CJK languages are supported only under CJK system locales&quot;</p>
</div>
<p><strong>Michael S. Kaplan</strong> on 31 Aug 2010 9:51 PM:</p><div style="margin-left: 1em"><p>Cool is relative.</p>
<p>It is &quot;cooler&quot; than question marks, because at the very least one can use file redirection to get the text, or one can copy/paste to get the text from the console. If you have question marks, then the data is permanently gone. </p>
</div>
<p><strong>Wei Wang</strong> on 31 Aug 2010 10:07 PM:</p><div style="margin-left: 1em"><p>Wow, I didn&#39;t expect to get a reply in 3 mins.</p>
<p>Anyhow, guess the takeaway (for me at least) is that getting those empty squares displayed for asian characters is the best we can have under the current version of Windows. I do agree that being able to copy/paste those squares into notepad to get the correct asian chars is cool:)</p>
</div>
<p><strong>Michael S. Kaplan</strong> on 31 Aug 2010 10:50 PM:</p><div style="margin-left: 1em"><p>Well, you can also use PowerShell ISE and see the text directly in this case, even when the system locale isn&#39;t CJK. :-)</p>
<p>One never knows when I&#39;ll be around looking at the blog....</p>
</div>
<p><strong>NB</strong> on 30 Nov 2010 5:25 AM:</p><div style="margin-left: 1em"><p>Can you somehow use this to make a &quot;pipe-utility-program&quot; which converts the standard output of other console programs (outputting OEM/ANSI/&quot;utf8&quot;) to O_U16TEXT?</p>
<p>Maybe there is something like that already?</p>
</div>
<p><strong>Alf P. Steinbach</strong> on 3 Nov 2011 12:28 PM:</p><div style="margin-left: 1em"><p>Well it would be nice with UTF-8 on the outside (generally), and for Windows programs, UTF-16 for internal strings, since that&#39;s most efficient wrt. to the API, and also to avoid confusion about ANSI versus UTF-8 for narrow character internal strings.</p>
<p>But I can&#39;t make wscanf &amp; family convert to UTF-16 on the inside.</p>
<p>It&#39;s like, it simply Does Not Work(TM).</p>
<p>Also, when I used the above idea for output at the C level, using C++ wcout crashed.</p>
<p>It seems that this support is a bit flaky... But any help would be appreciated!</p>
<p>Cheers,</p>
<p>- Alf</p>
</div>
<hr/><p><em>referenced by</em></p><div style="margin-left: 1em"><p>2010/12/01 <a href="http://archives.miloush.net/michkap/archive/2010/12/01/10098812.html">The IN door can go a different way than the OUT door</a></p><p>2010/10/07 <a href="http://archives.miloush.net/michkap/archive/2010/10/07/10072032.html">Myth busting in the console</a></p><p>2010/09/23 <a href="http://archives.miloush.net/michkap/archive/2010/09/23/10066660.html">A confluence of circumstances leaves a stone unturned...</a></p><p>2010/06/27 <a href="http://archives.miloush.net/michkap/archive/2010/06/27/10028282.html">Bugs hidden in plain sight, and commented that way too ANSWERS</a></p><p>2010/06/18 <a href="http://archives.miloush.net/michkap/archive/2010/06/18/10024976.html">Bugs hidden in plain sight, and commented that way too</a></p><p>2010/05/07 <a href="http://archives.miloush.net/michkap/archive/2010/05/07/10008232.html">Cunningly conquering communicated console caveats. Comprende, mon Capitán?</a></p><p>2010/04/07 <a href="http://archives.miloush.net/michkap/archive/2010/04/07/9989346.html">Anyone who says the console can't do Unicode isn't as smart as they think they are</a></p><p>2009/12/01 <a href="http://archives.miloush.net/michkap/archive/2009/12/01/9930855.html">When changing behavior is like killing puppies</a></p><p>2009/08/14 <a href="http://archives.miloush.net/michkap/archive/2009/08/14/9869928.html">Header files are not retarded, aka What the @#%&* is _O_WTEXT?</a></p><p>2008/03/19 <a href="http://archives.miloush.net/michkap/archive/2008/03/19/8323216.html">The forensic typographers found no link to Lucida Console, and the D.A. had nothing to fallback to</a></p><p>2008/03/19 <a href="http://archives.miloush.net/michkap/archive/2008/03/19/8321717.html">Before you say "What's next?" you have to figure out the action items</a></p></div><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2008/03/19/8321717.html" title="Before you say &quot;What&#39;s next?&quot; you have to figure out the action items">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2008/03/18/8306597.html" title="Conventional wisdom is retarded, aka What the @#%&amp;* is _O_U16TEXT?">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2008-03">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2008-03-18">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2008/03/18/8306597.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:36 GMT -->
</html>