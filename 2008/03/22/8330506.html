<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2008/03/22/8330506.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:36 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>GetGeoInfo is a mostly useless bloody waste of a function that only a "B" Ark Golgafrincham could love</title></head><body>
<h1>GetGeoInfo is a mostly useless bloody waste of a function that only a "B" Ark Golgafrincham could love</h1>
<p><em>by Michael S. Kaplan, published on 2008/03/22 10:01 -04:00, original URI: http://blogs.msdn.com/b/michkap/archive/2008/03/22/8330506.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostNew -->
<P><EM><FONT color=#ff0000 size=1>Content of </FONT></EM><A class="" href="http://blogs.msdn.com/michkap" mce_href="http://blogs.msdn.com/michkap"><EM><FONT size=1>Michael Kaplan's personal blog</FONT></EM></A><EM><FONT color=#ff0000 size=1> not approved by Microsoft (see </FONT></EM><A class="" href="http://archives.miloush.net/michkap/archive/2008/02/28/7934999.html" mce_href="http://archives.miloush.net/michkap/archive/2008/02/28/7934999.html"><EM><FONT size=1>disclaimer</FONT></EM></A><EM><FONT color=#ff0000 size=1>)!</FONT></EM>&nbsp;</P>
<P>I always want to think the best a function.</P>
<P>Kind of like how I always want to think the best of people.</P>
<P>Especially if I know that it is a part of an API set that I fond of.</P>
<P>Kind of like how if a person is a family member or good friend of one of my friends.</P>
<P>I might not even mind that it does not behave&nbsp;as documented&nbsp;each time.</P>
<P>Kind of like if a person does stuff like get drunk and say act embarrassing or whatever.</P>
<P>But eventually I flip the bozo bit and decide a function is just a useless piece of crap with no redeeming value and that using it is&nbsp;a total waste of time until and unless it is completely rewritten from the ground up.</P>
<P>Kind of like if a person becomes an alcoholic and starts breaking into your house to steal stuff to sell for liquor and you kick them out and refuse to let them back into your life unless they go to rehab.</P>
<P><EM>Holy taking an analogy too far, Batman!</EM></P>
<P>But you might know what I mean here.</P>
<P>An example of such a function, for me, is <A class="" href="http://msdn2.microsoft.com/library/ms776300.aspx" mce_href="http://msdn2.microsoft.com/library/ms776300.aspx">GetGeoInfo</A>.</P>
<P>Now I have been something of an enabler for this function, what with my blogging about it over the years in&nbsp;&nbsp;<A class="" href="http://archives.miloush.net/michkap/archive/2006/08/19/706950.html" mce_href="http://archives.miloush.net/michkap/archive/2006/08/19/706950.html"><STRONG>What the hell is up with Timor-Leste?</STRONG></A> and <A class="" href="http://archives.miloush.net/michkap/archive/2007/07/13/3837355.html" mce_href="http://archives.miloush.net/michkap/archive/2007/07/13/3837355.html"><STRONG>What the hell is up with Timor-Leste? [Microsoft edition]</STRONG></A> and <A class="" href="http://archives.miloush.net/michkap/archive/2005/06/01/424067.html" mce_href="http://archives.miloush.net/michkap/archive/2005/06/01/424067.html"><STRONG>It's not quite done yet</STRONG></A> and <A class="" href="http://archives.miloush.net/michkap/archive/2005/10/12/479817.html" mce_href="http://archives.miloush.net/michkap/archive/2005/10/12/479817.html"><STRONG>Some of GetGeoInfo is sorta broken</STRONG></A>.</P>
<P>But that last one was an understatement.</P>
<P>Basically, GEO_TIMEZONES? It isn't implemented.</P>
<P>GEO_OFFICIALLANGUAGES? Also not implemented.</P>
<P>At least we got them up update the MSDN topic about them.</P>
<P>Anyway, the other day was the last straw.</P>
<P>Because the GEO_RFC1766, <A class="" href="http://msdn2.microsoft.com/library/ms776305.aspx" mce_href="http://msdn2.microsoft.com/library/ms776305.aspx">documented</A> as:</P>
<BLOCKQUOTE>
<DT><FONT face="times new roman,times">GEO_RFC1766 </FONT>
<DD><FONT face="times new roman,times">The name for a string, compliant with RFC 4646 (Windows Vista and later), that is derived from the </FONT><A id=ctl00_rs1_mainContentContainer_ctl03 onclick="javascript:Track('ctl00_rs1_mainContentContainer_ctl00|ctl00_rs1_mainContentContainer_ctl03',this);" href="http://msdn2.microsoft.com/en-us/library/ms776300(VS.85).aspx"><B><FONT face="times new roman,times">GetGeoInfo</FONT></B></A><FONT face="times new roman,times"> parameters <I>language</I> and <I>GeoId</I>.</FONT> </DD></BLOCKQUOTE>
<P>then to find out what they mean by language, <A class="" href="http://msdn2.microsoft.com/library/ms776300.aspx" mce_href="http://msdn2.microsoft.com/library/ms776300.aspx">documented</A> as:</P>
<BLOCKQUOTE>
<DT><FONT face="times new roman,times"><I>LangId</I> </FONT>
<DD><FONT face="times new roman,times">[in] Identifier for the language, used with the value of <I>Location</I>. The application can set this parameter to 0, with GEO_RFC1766 or GEO_LCID specified for <I>GeoType</I>. This setting causes the function to retrieve the language identifier by calling </FONT><A id=ctl00_rs1_mainContentContainer_ctl03 onclick="javascript:Track('ctl00_rs1_mainContentContainer_ctl00|ctl00_rs1_mainContentContainer_ctl03',this);" href="http://msdn2.microsoft.com/en-us/library/ms776265(VS.85).aspx"><B><FONT face="times new roman,times">GetUserDefaultLangID</FONT></B></A><FONT face="times new roman,times">. <BR><BR></FONT>
<P><FONT face="times new roman,times"><B>Note:</B> The application must set this parameter to 0 if <I>GeoType</I> has any value other than GEO_RFC1766 or GEO_LCID.<BR><BR>...<BR><BR>If the application specifies GEO_RFC1766 for <I>GeoType</I>, it should specify a language identifier for <I>LangId</I> that is appropriate to the specified geographical location identifier. The appropriate language is either a locale-neutral language or one with a locale corresponding to the specified identifier. The resulting string, compliant with RFC 4646 (Windows Vista and later), constitutes a </FONT><A id=ctl00_rs1_mainContentContainer_ctl05 onclick="javascript:Track('ctl00_rs1_mainContentContainer_ctl00|ctl00_rs1_mainContentContainer_ctl05',this);" href="http://msdn2.microsoft.com/en-us/library/ms776389(VS.85).aspx"><FONT face="times new roman,times">locale name</FONT></A><FONT face="times new roman,times">. <BR><BR>For example, if <I>Location</I> is specified as 0xF4 for United States, <I>GeoType</I> is specified as GEO_RFC1766, and <I>LangId</I> is specified as either 0x09 for locale-neutral English or 0x409 for English (United States), the function retrieves "en-US" on successful return. In fact, the function ignores the locale-specific portion of the language. Thus, if the application specifies <I>LangId</I> as 0x809 for English (United Kingdom), the function also writes "en-US" to <I>lpGeoData</I>.<BR><BR>Consider another example. If <I>Location</I> is specified as 0xF4 for United States, <I>GeoType</I> is specified as GEO_RFC1766, and <I>LangId</I> is specified as 0x04 for Chinese, the function retrieves "zh-US" on successful return. This is not the name of a supported locale.</FONT></P></DD></BLOCKQUOTE>
<P>This function just blithely admitted to useless, purposeless functionality that unless you carefully call with exact parameters that define the exact language you want will return meaningless results not reasonable to use elsewhere.</P>
<P>And a parameter named LangId that only works with the PRIMARYLANGID portion of the value, even if a full LangId would be needed to intelligently guess (which the function is okay with since ut ahs no plans to intelligently guess).</P>
<P>And bad enough that it names itself after RFC 1766 even though that is two versions of the standard behind. It is fully optimized for creating tags that no reasonable person would ever want to have in any version of the RFC.</P>
<P>And then there is the GEO_LCID, <A class="" href="http://msdn2.microsoft.com/library/ms776305.aspx" mce_href="http://msdn2.microsoft.com/library/ms776305.aspx">documented</A> as:</P>
<BLOCKQUOTE>
<DT><FONT face="times new roman,times">GEO_LCID </FONT>
<DD><FONT face="times new roman,times">A locale identifier derived from the <B>GetGeoInfo</B> parameters <I>language</I> and <I>GeoId</I>. </FONT></DD></BLOCKQUOTE>
<P>then to find out what they mean by language, <A class="" href="http://msdn2.microsoft.com/library/ms776300.aspx" mce_href="http://msdn2.microsoft.com/library/ms776300.aspx">documented</A> as:</P>
<BLOCKQUOTE>
<P><FONT face="times new roman,times">If the application specifies GEO_LCID for <I>GeoType</I>, the function treats the language identifier as a locale identifier (LCID). It attempts to return the locale identifier if it is associated with the provided geographical identifier in some way. </FONT></P></BLOCKQUOTE>
<P>This one also strips off the region info from the LCID you pass in and then tries to create another one if it can -- which it likely won't be able to do anyway.</P>
<P>In other words, if you know the values are completely reasonable and compatible then the function will be helpful, otherwise not so much.</P>
<P>But if you knew the exact values to pass then you wouldn't even need it!</P>
<P>Well, I'm done trying make excuses for this worthless function that spends so much of its time being useless. I could do a better job throwing a dart at a map (something I did once when I decided to take a year off from school, and ended up staying there half a decade. People at the time accused me of acting quite randomly, but I was a lot more freaking deterministic than "<STRONG>Mr. zh-US GetGeoInfo</STRONG>" over here.</P>
<P>I'm locking it out of my house until someone sends it to <STRIKE><FONT color=#999966>rehab</FONT></STRIKE>rewrite.</P>
<P>Any NLS devs nearby want to make a function useful for some future version? Or at least fix up the docs to describe just how useless some of these&nbsp;enumeration values&nbsp;are without requiring full understanding of the functionality on the part of the users? :-)</P>
<P>Because until then, <A class="" href="http://msdn2.microsoft.com/library/ms776300.aspx" mce_href="http://msdn2.microsoft.com/library/ms776300.aspx">GetGeoInfo</A>&nbsp;is a mostly useless bloody waste of a function....</P>
<P mce_keep="true">&nbsp;</P>
<P><FONT color=#ff00ff><EM>This blog brought to you by</EM><FONT size=5> G </FONT><EM>(<A class="" href="http://www.fileformat.info/info/unicode/char/0047" mce_href="http://www.fileformat.info/info/unicode/char/0047">U+0047</A>, aka LATIN CAPITAL LETTER G)</EM></FONT></P>
<hr/><div style="margin-left: 1em"><em>no comments</em></div><hr/><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2008/03/22/8330579.html" title="*Insert a pun involving the word TREMA here*">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2008/03/21/8329642.html" title="Language detection, language translation... it IS exciting, so why I am yawning?">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2008-03">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2008-03-22">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2008/03/22/8330506.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:36 GMT -->
</html>