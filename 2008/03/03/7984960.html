<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2008/03/03/7984960.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:36 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>On reversing the irreversible (grabbing the data, part II: the weirdness not so related to locales)</title></head><body>
<h1>On reversing the irreversible (grabbing the data, part II: the weirdness not so related to locales)</h1>
<p><em>by Michael S. Kaplan, published on 2008/03/03 10:16 -05:00, original URI: http://blogs.msdn.com/b/michkap/archive/2008/03/03/7984960.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostNew -->
<P><FONT color=#ff0000 size=1><EM>Please read the </EM></FONT><A class="" href="http://archives.miloush.net/michkap/archive/2008/02/28/7934999.html" mce_href="http://archives.miloush.net/michkap/archive/2008/02/28/7934999.html"><EM><FONT size=1>disclaimer</FONT></EM></A><EM><FONT color=#ff0000 size=1>; content not Microsoft approved!</FONT></EM></P>
<P>Previous blogs in this series:</P>
<UL>
<LI>1 - <A class="" href="http://archives.miloush.net/michkap/archive/2008/01/13/7090976.html" mce_href="http://archives.miloush.net/michkap/archive/2008/01/13/7090976.html"><STRONG>The introduction</STRONG></A></LI>
<LI>2 - <A class="" href="http://archives.miloush.net/michkap/archive/2008/01/14/7102809.html" mce_href="http://archives.miloush.net/michkap/archive/2008/01/14/7102809.html"><STRONG>The Set-Up</STRONG></A></LI>
<LI>3 - <A class="" href="http://archives.miloush.net/michkap/archive/2008/01/25/7228941.html" mce_href="http://archives.miloush.net/michkap/archive/2008/01/25/7228941.html"><STRONG>Grabbing the data, part I</STRONG></A></LI></UL>
<P>In Part 3, I did make a particular claim:</P>
<BLOCKQUOTE>
<P><EM><FONT face="times new roman,times">Now I have skipped stuff that is seemingly quite important that has come up in this blog before, like Japanese Kana, Korean Jamo, and more. But for now just trust me when I say that they are either nothing to worry about (or at worst no more awful than compressions, above), and in an upcoming&nbsp;blog I will&nbsp;explain why.</FONT></EM></P></BLOCKQUOTE>
<P>You see, while much of the collation support is table-based, there are particular characters that aren't. </P>
<P>For example there is Japanese Kana -- discussed at length in <A class="" href="http://archives.miloush.net/michkap/archive/2007/09/21/5027338.html" mce_href="http://archives.miloush.net/michkap/archive/2007/09/21/5027338.html"><STRONG>A&amp;P of Sort Keys, part 10 (aka I've Kana wanted to start talking about Japanese)</STRONG></A> -- which is basically sorted via a state machine of sorts (pun intended). This state machine makes assumptions about what amounts to particular clusters of characters that will produce different sort keys than the individual characters would if t heir sort key values were combined -- and in any case with sort weights that contain&nbsp;extra values that go in the <STRONG>Special weight</STRONG> section of the sort key:</P>
<P><STRONG><FONT size=1><FONT face=Consolas><FONT color=#999966>[all Unicode sort weights]</FONT> 01 <FONT color=#999966>[all Diacritic weights]</FONT> 01 <FONT color=#999966>[all Case weights]</FONT> 01 <FONT color=#999966>[all Special weights]</FONT> 01 <FONT color=#999966>[Punctuation weights]</FONT> 00</FONT></FONT></STRONG></P>
<P>And for another example there are the conjoining Jamo used for Old Hangul -- discussed in <A href="http://archives.miloush.net/michkap/archive/2005/02/25/380266.html"><FONT face=Tahoma><STRONG>theory vs. practice for Korean text collation</STRONG></FONT></A>&nbsp;and <A class="" href="http://archives.miloush.net/michkap/archive/2005/09/12/463560.html" mce_href="http://archives.miloush.net/michkap/archive/2005/09/12/463560.html"><STRONG>the redux thereof</STRONG></A>, as well as a not yet blogged blog on this Blog --&nbsp;entitled <STRONG>A&amp;P of Sort Keys, part 14 (Old Hangul: the good, the bad, and the ugly)</STRONG> -- which talks about the state machine used to build up the sort keya for Old Hangul syllables, in which up to nine conjoining Jamo can produce one single sort element that contains an additional six bytes in the <STRONG>Unicode weight</STRONG> section in the form <STRONG>FF ?? FF ?? FF ??</STRONG> where ?? would be replaced by specific byte values that amount to a combination of the appropriate lead, vowel, and trailing Jamo, each of which will be 1-3 characters (I talked about this a bit <A class="" href="http://archives.miloush.net/michkap/archive/2006/07/22/674270.html" mce_href="http://archives.miloush.net/michkap/archive/2006/07/22/674270.html"><STRONG>here</STRONG></A>, with a huge contrived yet&nbsp;legal nine-Jamo&nbsp;example).</P>
<P>A third example is the way CJK Extension A is handled pre-Vista and how all non-Extension B ideographic characters that are not included in the linguistic data of a given locale's sort are handled in Vista and beyond -- they are given a special large valued two byte prefix in their <STRONG>Unicode Weight</STRONG>, followed by another two bytes that put the characters in code point order.</P>
<P>And a fourth example is the way CJK Extension B&nbsp;is handled pre-Vista and how all ideographic characters that are not included in the linguistic data of a given locale's sort are handled in Vista and beyond -- their <STRONG>Unicode Weight</STRONG>&nbsp;is given a large two byte value for the high surrogate followed by a not a large two byte value for the low surrogate.</P>
<P>And a&nbsp;fifth example is the way every other supplementary character that is not in Extension B or the Supplementary Ideographic Plane is weighed -- the same technique as is used for Extension B but with a significantly lower two byte value for the high surrogate's <STRONG>Unicode Weight</STRONG>.</P>
<P><EM>One interesting factor that all of the above things have in common is that they are really not all that locale specific -- you will get the same results across all locales.</EM></P>
<P>Now a&nbsp;sixth example is one that does not yet exist but that I was specifically asked to have people think about if they move into the area of reverse engineer sort keys -- which is that <STRONG>enhancements happen</STRONG>.</P>
<P>Yes, that is important to keep in mind -- things improve and sometimes in order for that improvement to happen new algorithms might be created, and those new algorithms might create different arrangements for sort key values.</P>
<P><EM>I am&nbsp;avoiding using the really popular <STRONG>I</STRONG>-word that people from Microsoft like to use for these cases -- <STRONG>INNOVATION</STRONG> -- since I hesitate to call every feature or change or improvement an actual innovation. But since I am not a VP there is no rule that I have to use the <STRONG>I</STRONG>-word here so let's just say that some of these changes might be those, and some might not be. Let's just not judge either positively or negatively here.</EM> :-)</P>
<P>In any case, it is possible to imagine such changes producing new patterns for sort keys that would presumably not be mistaken for existing characters but which would need to be understood well enough to be sure that the data-grabbing stage was able to capture the sort keys....</P>
<P>In every one of these cases, the challenge is to either produce intelligent data gathering code based on knowledge of the possible expected combinations (e.g. in the case of Conjoining Jamo to take the specific possible known legal combinations of <FONT face=Tahoma>Old Hangul syllable made up of sequences that are legal according to </FONT><A href="http://www.microsoft.com/typography/otfntdev/hangulot/appen.aspx#comp"><FONT face=Tahoma>the table from the OpenType site</FONT></A><FONT face=Tahoma> (which lists the legal&nbsp;Old Hangul&nbsp;sequences) -- in theory you could use this information to construct sort keys for all of old Hangul sort keys.</FONT></P>
<P><FONT face=Tahoma>Or you can use the naive algorithm you might just use for potential compressions (keeping in mind that in Vista there is at least one locale with 8-to-1 compressions in it).</FONT></P>
<P><FONT face=Tahoma>Both approaches can be hideously complex depending on how much work you want to do, and that is even before you get to the locale-specific stuff that I will be talking about in the next part of the series....</FONT></P>
<P><FONT face=Tahoma>Which is why you might want to stop worrying about the full support story some time prior to solving all of these problems? :-)</FONT></P>
<P><FONT face=Tahoma></FONT>&nbsp;</P>
<P><FONT face=Tahoma color=#ff00ff><EM>This blog brought to you by</EM><FONT size=5> ừ </FONT><EM>(<A class="" href="http://www.fileformat.info/info/unicode/char/1eeb" mce_href="http://www.fileformat.info/info/unicode/char/1eeb">U+1eeb</A>, aka LATIN SMALL LETTER U WITH HORN AND GRAVE)</EM></FONT></P>
<hr/><div style="margin-left: 1em"><em>no comments</em></div><hr/><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2008/03/03/7988789.html" title="ঘেমন কর্ম তেমন ফল, aka Learn Bengali in a month (or not)">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2008/03/02/7982775.html" title="They didn&#39;t quote *me* on that, aka &quot;There is an underlying, unspoken fear of what is to come.&quot;">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2008-03">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2008-03-03">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2008/03/03/7984960.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:36 GMT -->
</html>