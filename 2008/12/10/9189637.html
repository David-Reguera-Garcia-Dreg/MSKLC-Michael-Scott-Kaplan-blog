<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2008/12/10/9189637.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:35 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>LoadKeyboardLayout is a 00bada55 puppy dog tail wagger of a function</title></head><body>
<h1>LoadKeyboardLayout is a 00bada55 puppy dog tail wagger of a function</h1>
<p><em>by Michael S. Kaplan, published on 2008/12/10 10:01 -05:00, original URI: http://blogs.msdn.com/b/michkap/archive/2008/12/10/9189637.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostNew -->
<p>There are many functions in the Win32 API that really amount to little more than requests.</p><p>The caller is asking for something, perhaps passing parameters to give specifics on what the caller wants.</p><p>And the caller will usually get <b>something</b> back.</p><p>It will often match what was requested, to some degree... but not always.</p><p>Sometimes, it can't -- and rather than fail completely (since almost no one checks return values) it will return <i>something</i> to let the code keep working. </p><p>You may recall situations with fonts that I have mentioned in the past that are impacted by this phenomenon.<br></p><p>And there was a question that came up the other day:</p><blockquote><p><font face="times new roman,times">The MSDN description regarding return value of LoadKeyboardLayout() says:<br></font></p><blockquote><font face="times new roman,times"><b>Return Value</b> </font><br><font face="times new roman,times">If the function succeeds, the return value is the input locale identifier to the locale matched with the requested name. If no matching locale is available, the return value is NULL. To get extended error information, call GetLastError.</font><br></blockquote><p><font face="times new roman,times">However, when I supply a random string text (example: “sdfdfsfsfsdf”) for the input locale identifier, pwszKLID, the return value is a non-NULL (0x04090409, the en-US keyboard). The GetLastError() call returns 0, that everything is ok. This behavior is completely different than what the MSDN article says about the return value.<br><br>Can anyone explain this behavior? What should I expect when a non-existing (no matching) locale is supplied?</font></p></blockquote><p>And now we have a ball game.</p><p>I verified the same behavior passing <b>00bada55</b> and I thought that was a more fun test, myself. :-) <br></p><p>As it turns out, there is some "failsafe" code that will, when everything goes wrong, automatically return the 0409 layout.</p><p>Failure of even that code would have to be pretty extreme, but it is in theory possible.</p><p>So the documentation isn't wrong. Well, not <b>really</b> wrong. Though for 99.9% of cases it might be effectively wrong. <br></p><p>Besides, what if you passed something illegal as the parameter, rather than something invalid? I'm willing to bet that if one really tried one could make even the most eager to please function fail. Even the puppy dog like nature of <a href="http://msdn.microsoft.com/library/ms646305.aspx" mce_href="http://msdn.microsoft.com/library/ms646305.aspx">LoadKeyboardLayout</a> is not foolproof.</p><p>Clearly the other NULL case -- invalid parameter -- is also not being mentioned. <br></p><p>So make sure you always check the return value. And don't rely on the undocumented piece pf this equation, that failsafe code. If it's not documented, then...<br></p><p>&nbsp;</p><p><font color="#ff00ff"><i>This blog brought to you by</i><font size="6"> a </font><i>(<a href="http://www.fileformat.info/info/unicode/char/0061" mce_href="http://www.fileformat.info/info/unicode/char/0061">U+0061</a>, aka LATIN SMALL LETTER A)</i></font> <br></p>
<hr/><div style="margin-left: 1em"><em>no comments</em></div><hr/><p><em>referenced by</em></p><div style="margin-left: 1em"><p>2011/06/10 <a href="http://archives.miloush.net/michkap/archive/2011/06/10/10173190.html">What do fonts and keyboards have in common? Not "crap bag" compatibility!</a></p></div><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2008/12/10/9189753.html" title="Why of why would it be in WIE?">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2008/12/09/9187379.html" title="UCS-2 to UTF-16, Part 8: It&#39;s the end of the string as we know it (and I feel ellipses)">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2008-12">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2008-12-10">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2008/12/10/9189637.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:35 GMT -->
</html>