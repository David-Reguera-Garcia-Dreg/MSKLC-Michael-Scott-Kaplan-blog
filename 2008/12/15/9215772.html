<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2008/12/15/9215772.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:35 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>Frost's The Form Not Taken</title></head><body>
<h1>Frost's The Form Not Taken</h1>
<p><em>by Michael S. Kaplan, published on 2008/12/15 03:01 -05:00, original URI: http://blogs.msdn.com/b/michkap/archive/2008/12/15/9215772.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostNew -->
<p>Over in the Suggestion Box, Aaron asked:</p><blockquote><p><i><font face="times new roman,times">Hi again - question about one of your favorite codepages - 1258 (Vietnamese) and combining diacritics in regards to Unicode character U+1EB7 (LATIN SMALL LETTER A WITH BREVE AND DOT BELOW - http://www.fileformat.info/info/unicode/char/1eb7/index.htm)<br><br>Windows Installer, for some unknown reason, has never gone unicode, so it always requires an ANSI codepage. For Vietnamese, this character, while extremely common, isn't actually in the codepage list, so I assume the correct way to get it is via usage of combining diacritics. Unfortunately, no matter how I try to break out the letter into diacritical marks, MSI refuses to show it correctly (yes, I have the font packs, etc...). I can get it to stop showing question marks, but not actually the correct character.<br><br>Which leaves me with a few questions:<br><br>1) Any ideas on how to get this character to show up correctly in MSI's UI for codepage 1258?<br><br>2) What's the best way to automatically convert from System.String for this character into a StreamWriter'd out GetEncoding(1258) version to get this decomposition correctly? Normalizing into FormD or FormKD first is not working, unfortunately, which was my hope. (Managed or Unmanaged is fine with me - just hope there's a way!)<br><br>3) Any other codepages you can think of that we should watch out for with problems like this?<br><br>4) Have you heard any push from the MSI team on getting to UTF-8 or UTF-16 support any time soon? It seems way behind the times.<br><br>Thanks!</font></i></p></blockquote><p>Now I won't go so far as to say that 1258 is a favorite code page, so I'll take that as sarcasm. :-)</p><p>When I read the questions here, I immediately thought of the Robert Frost poem <b>The Road Not Taken</b>:</p><blockquote><blockquote><p><font face="times new roman,times">Two roads diverged in a yellow wood,<br>And sorry I could not travel both<br>And be one traveler, long I stood<br>And looked down one as far as I could<br>To where it bent in the undergrowth;<br><br>Then took the other, as just as fair,<br>And having perhaps the better claim,<br>Because it was grassy and wanted wear;<br>Though as for that the passing there<br>Had worn them really about the same,<br><br>And both that morning equally lay<br>In leaves no step had trodden black.<br>Oh, I kept the first for another day!<br>Yet knowing how way leads on to way,<br>I doubted if I should ever come back.<br><br>I shall be telling this with a sigh<br>Somewhere ages and ages hence:<br>Two roads diverged in a wood, and I—<br>I took the one less traveled by,<br>And that has made all the difference.</font></p></blockquote></blockquote><p>Now the poem has been interpreted by others much greater than I, so I'll just go so far as to say that one popular interpretation is an ironic one -- that despite the speaker's bold proclamation at the end about how this different choice made all the difference, in truth it made very little difference, and the two paths were really pretty much equivalent.</p><p>I thought I'd twist that up a bit with Aaron's example that leads to a specific scenario where refusing to go down the road not taken can more or less kick your ass!</p><p>I'll start by pointing to a blog that comes close to helping here but in the end fails (<b><a href="http://archives.miloush.net/michkap/archive/2005/07/09/437063.html" mce_href="http://archives.miloush.net/michkap/archive/2005/07/09/437063.html">Getting intermediate forms</a></b>).</p><p>Then I'll point to a blog that comes a bit closer to the mark (<b><a href="http://archives.miloush.net/michkap/archive/2006/05/14/597198.html" mce_href="http://archives.miloush.net/michkap/archive/2006/05/14/597198.html">Harder intermediate forms of characters</a></b>).</p><p>It's all well and good to talk about <a href="http://www.fileformat.info/info/unicode/char/1eb7" mce_href="http://www.fileformat.info/info/unicode/char/1eb7">U+1eb7</a> (ặ), aka LATIN SMALL LETTER A WITH BREVE AND DOT BELOW.</p><p>Now this character is in Unicode Normalization Form C.</p><p>If you decompose it once via the data in the <a href="http://www.unicode.org/ucd/" mce_href="http://www.unicode.org/ucd/">Unicode Character Database</a>, you get <a href="http://www.fileformat.info/info/unicode/char/1ea1" mce_href="http://www.fileformat.info/info/unicode/char/1ea1">U+1ea1</a> <a href="http://www.fileformat.info/info/unicode/char/0306" mce_href="http://www.fileformat.info/info/unicode/char/0306">U+0306</a>, aka LATIN SMALL LETTER A WITH DOT BELOW + COMBINING BREVE.</p><p>And if you decompose it again, you get <a href="http://www.fileformat.info/info/unicode/char/0061" mce_href="http://www.fileformat.info/info/unicode/char/0061">U+0061</a> <a href="http://www.fileformat.info/info/unicode/char/0323" mce_href="http://www.fileformat.info/info/unicode/char/0323">U+0323</a> <a href="http://www.fileformat.info/info/unicode/char/0306" mce_href="http://www.fileformat.info/info/unicode/char/0306">U+0306</a>, aka LATIN SMALL LETTER A + COMBINING DOT BELOW + COMBINING BREVE.</p><p>That last sequence? That is the character in Unicode Normalization Form D.</p><p>You might notice a bit of lack of coverage of either form in <a href="http://www.microsoft.com/globaldev/reference/sbcs/1258.mspx" mce_href="http://www.microsoft.com/globaldev/reference/sbcs/1258.mspx">Windows code page 1258</a>. Even with the odd ccombing characters it has, which I mentioned in <b><a href="http://archives.miloush.net/michkap/archive/2005/04/19/409566.html" mce_href="http://archives.miloush.net/michkap/archive/2005/04/19/409566.html">A few of the gotchas of MultiByteToWideChar</a></b>.</p><p>However, as that blog points out, <a href="http://www.microsoft.com/globaldev/reference/sbcs/1258.mspx" mce_href="http://www.microsoft.com/globaldev/reference/sbcs/1258.mspx">Windows code page 1258</a> does have <a href="http://www.fileformat.info/info/unicode/char/0323" mce_href="http://www.fileformat.info/info/unicode/char/0323">U+0323</a> (COMBINING DOT BELOW).</p><p>And id you look at the code page table itself, you will see that it does have <a href="http://www.fileformat.info/info/unicode/char/0103" mce_href="http://www.fileformat.info/info/unicode/char/0103">U+0103</a> (LATIN SMALL LETTER A WITH COMBINING BREVE).</p><p>Now this is one of those harder intermediate forms -- U+0103 U+0323 (ặ), aka LATIN SMALL LETTER A WITH BREVE + COMBINING DOT BELOW is, while definitely the road not taken by Unicode normalization, is actually the de facto road taken by (for lack of an official term) Microsoft's "Normalization Form V", as used by its code page 1258.</p><p>Note that this sequence will see both Unicode Normalization Forms C and KC convert to <a href="http://www.fileformat.info/info/unicode/char/1eb7" mce_href="http://www.fileformat.info/info/unicode/char/1eb7">U+1eb7</a>, and both Unicode Normalization Forms D and KD convert to <a href="http://www.fileformat.info/info/unicode/char/0061" mce_href="http://www.fileformat.info/info/unicode/char/0061">U+0061</a> <a href="http://www.fileformat.info/info/unicode/char/0323" mce_href="http://www.fileformat.info/info/unicode/char/0323">U+0323</a> <a href="http://www.fileformat.info/info/unicode/char/0306" mce_href="http://www.fileformat.info/info/unicode/char/0306">U+0306</a>.</p><p>Now there is no conversion built into Windows or .NET to get this form not taken that will look right using code page 1258. Though if I ever had an interview candidate who understood all about code pages, I suspect that writing a converter that could do such a job would make for a fascinating interview question!</p><p>So, getting back to Aaron's questions, I handle #1 above and point out how though there is no good specific way to do #2 I'd be very impressed by the person who wrote the code to do it!</p><p>For #3, code page 1258 is the only conventional ACP under Windows with this specific problem.</p><p>And as for #4, while technically UTF-8 (code page 65001) is unsupported by Windows Installer, as I pointed out in <b><a href="http://archives.miloush.net/michkap/archive/2005/10/08/478479.html" mce_href="http://archives.miloush.net/michkap/archive/2005/10/08/478479.html">MSI Databases and Unicode</a></b>, MSKLC was able to successfully use UTF-8 and support the setup packages for many Unicode-only languages such as Hindi and Lao and Tibetan. Which suggests that it can in fact be used for Vietnamese.</p><p>Note that there are some characters that even if you do manage to create your own implementation of the so my so called <b>Microsoft Normalization Form V</b> can't be represented by the code page, thus UTF-8 is really the only option that can support the Vietnamese language itself, in the long run.<br></p><p>And although using UTF-8 here will make that conversion code unnecessary, I'd still want to hire the person who came up with an elegant code solution there. :-)</p><p><i>Thinking of all the work that fonts do to support the fictional <b>Form V</b> as well as the other, more valid and less valid forms, it is unfortunate that this support was never made more widespread so that it would be easier to support languages like Vietnamese while waiting for everyone like MSI and others to move to Unicode.</i> <br></p><p>Now <a href="http://www.microsoft.com/globaldev/reference/sbcs/1258.mspx" mce_href="http://www.microsoft.com/globaldev/reference/sbcs/1258.mspx">Windows code page 1258</a> is clearly an example where <b>The Road Not Taken</b> may well <i>look</i> the same in fonts and rendering, but in terms of code pages and components that do not use Unicode and/or do not normalize will see the road not taken as one with very very tall weeds blocking the way of folks like Aaron whose actual work might not afford them the ironic detachment of Robert Frost when it turns out that the two paths aren't the same....</p><p><br></p><p><font color="#ff00ff"><i>This blog brought to you by</i><font size="7"> ặ </font><i>(<a href="http://www.fileformat.info/info/unicode/char/1eb7" mce_href="http://www.fileformat.info/info/unicode/char/1eb7">U+1eb7</a>, aka LATIN SMALL LETTER&nbsp; WITH BREVE AND DOT BELOW)</i></font> <br></p>
<hr/><p><a id="9221200" href="#9221200">#</a> <strong>John Cowan</strong> on 15 Dec 2008 11:14 AM:</p><div style="margin-left: 1em"><p>There's a Vietnamese-specific logic to CP 1258 that transcends the arbitrary Unicode normalization rules. &nbsp;The breve, circumflex, and horn accents, unlike the rest, affect vowel quality. &nbsp;If you look at a Vietnamese alphabet like the one at Wikipedia, you'll see that A WITH BREVE, A WITH CIRCUMFLEX, E WITH CIRCUMFLEX, O WITH CIRCUMFLEX, O WITH HORN, and U WITH HORN (as well as D WITH STROKE, which isn't Unicode-decomposable) are considered separate letters from their unaccented correspondents. Consequently, in 1258 they are encoded using seven precomposed characters.</p>
<p>On the other hand, the grave, acute, hook above, tilde, and dot below accents are tone marks, conceptually not part of the letters they appear on. &nbsp;They're encoded using combining characters, since encoding them using precomposed characters would create a combinatorial explosion of 12 x 6 x 2 = 144 distinct vowel characters. &nbsp;(The VISCII encoding actually does that, at the expense of filling the whole 0x80-0xFF space with letters and even usurping six of the control characters!)</p>
<p>Unsurprisingly, Vietnamese conventions always place the tone mark outside any breve, circumflex, or horn diacritic (and therefore following it according to Unicode rules). &nbsp;The only place in which this causes a problem is the dot below, beccause Unicode arbitrarily wants all diacritics below to come before all diacritics above.</p>
<p>(ObTooLateNow: &nbsp;IMHO the horn diacritic shouldn't have been encoded separately in Unicode. &nbsp;It's not used anywhere but in Vietnamese, can only appear on o and u, and (like ogonek and cedilla, but unlike most other combining diacritics) always touches the letter that it's associated with. &nbsp;Using undecomposable characters would have cost only 3 codepoints.)</p></div>
<hr/><p><em>referenced by</em></p><div style="margin-left: 1em"><p>2010/01/12 <a href="http://archives.miloush.net/michkap/archive/2010/01/12/9946880.html">On my "Vietnamese Plus" and "pseudo-Form V" constructs</a></p><p>2009/05/27 <a href="http://archives.miloush.net/michkap/archive/2009/05/27/9644420.html">The whole truth about MB_PRECOMPOSED and MB_COMPOSITE</a></p></div><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2008/12/16/9223301.html" title="UCS-2 to UTF-16, Part 9: The torrents of breaking CharNext/CharPrev">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2008/12/12/9202471.html" title="From I SCOOT to IBOT, #9 of ??: You&#39;re not stoned if you see me in Seattle at a 50 degree or a 130 degree angle">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2008-12">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2008-12-15">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2008/12/15/9215772.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:35 GMT -->
</html>