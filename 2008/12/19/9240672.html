<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2008/12/19/9240672.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:35 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>Complex class designs begat unintuitive interactions begat unexpected results begat a blog</title></head><body>
<h1>Complex class designs begat unintuitive interactions begat unexpected results begat a blog</h1>
<p><em>by Michael S. Kaplan, published on 2008/12/19 03:01 -05:00, original URI: http://blogs.msdn.com/b/michkap/archive/2008/12/19/9240672.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostNew -->
<p>Frank's question is one any reasonable person could have:</p><blockquote><p><font face="times new roman,times">So, why is XmlWriter producing a document with encoding = UTF16 when I specify UTF8 ?<br><br>static void Main(string[] args)<br>{<br>&nbsp;&nbsp;&nbsp; XmlWriterSettings xws = new XmlWriterSettings();<br>&nbsp;&nbsp;&nbsp; xws.Encoding = Encoding.UTF8;<br>&nbsp;&nbsp;&nbsp; StringBuilder sb = new StringBuilder();<br>&nbsp;&nbsp;&nbsp; XmlWriter xw = XmlWriter.Create(sb, xws);<br>&nbsp;&nbsp;&nbsp; xw.WriteStartDocument();<br>&nbsp;&nbsp;&nbsp; xw.WriteElementString("Element", "Value");<br>&nbsp;&nbsp;&nbsp; xw.WriteEndDocument();<br>&nbsp;&nbsp;&nbsp; xw.Flush();<br>&nbsp;&nbsp;&nbsp; xw.Close();<br>}</font><font face="times new roman,times"><br><br>--<br>Frank</font><br></p></blockquote><p>That code prodcuces XML with the following preamble:</p><blockquote><p><font size="3"><b><font face="courier new,courier">&lt;?xml version="1.0" encoding="utf-16"?&gt;&lt;Element&gt;Value&lt;/Element&gt;</font></b></font></p></blockquote><p>I can see what he was talking about. Weird! <br></p><p> Someone pointed out that looking at the <a href="http://msdn.microsoft.com/en-us/library/system.xml.xmlwritersettings.encoding.aspx" mce_href="http://msdn.microsoft.com/en-us/library/system.xml.xmlwritersettings.encoding.aspx">XmlWriterSettings.Encoding property</a> documentation would explain what was going on:</p><blockquote><p><i><font face="times new roman,times"><b>Remarks </b><br>The XmlWriter encodes a buffer of characters all at once, rather than character by character. An exception is thrown when the Flush method is called if any encoding errors are encountered.<br><br>The Encoding property only applies to the XmlWriter instances that are created either with the specified Stream or with the specified file name. If the XmlWriter instance is created with the specified TextWriter, the Encoding property is overridden by the encoding of the underlying TextWriter. For example, if this property is set to Unicode (UTF-16 ) for a particular XmlWriter, but the underlying writer is an StreamWriter (which derives from TextWriter) with its encoding set to UTF8, the output will be UTF8 encoded.<br><br>If the XmlWriter instance is created with other output parameters, the Encoding property is ignored.</font></i></p></blockquote><p>Personally, I think that is all designed slightly more confusingly than it had to be. But that is just me. :-)</p><p>&nbsp;</p><p><font color="#ff00ff"><i>This blog brought to you by</i><font size="6"> ùåè </font><i>(<a href="http://www.fileformat.info/info/unicode/char/1d30f" mce_href="http://www.fileformat.info/info/unicode/char/1d30f">U+1d30f</a>, aka TETRAGRAM FOR DEFECTIVENESS OR DISTORTION)</i></font> <br></p>
<hr/><div style="margin-left: 1em"><em>no comments</em></div><hr/><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2008/12/20/9243392.html" title="From I SCOOT to IBOT, #10 of ??: The good, the bad, and the ugly (IN THAT ORDER)">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2008/12/19/9240482.html" title="Black hole sun, Vista gadget come, don&#39;t predict China&#39;s rain?">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2008-12">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2008-12-19">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2008/12/19/9240672.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:35 GMT -->
</html>