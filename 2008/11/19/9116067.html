<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2008/11/19/9116067.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:35 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>Apocalypse Font (aka Guess they must have picked the wrong eight characters.)</title></head><body>
<h1>Apocalypse Font (aka Guess they must have picked the wrong eight characters.)</h1>
<p><em>by Michael S. Kaplan, published on 2008/11/19 03:01 -05:00, original URI: http://blogs.msdn.com/b/michkap/archive/2008/11/19/9116067.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostNew -->
<p><font color="#ff0000"><i>The title of this blog is an allusion to Coppola's <b>Apocalypse Now</b>, and eventually I'll be quoting a bit of the Herr-provided narration (those are the pieces Martin Sheen read)...</i></font><br></p><p>It all started with a seemingly innocent question the other day. It went something like this (product and component names removed to protect whatever might deserve protecting):</p><blockquote><p><i><font face="times new roman,times">We are hitting an issue where surrogate pair characters do not display correctly on localized builds, but display correctly on English builds. This appears to be because the MS UI Gothic font used in the localized builds doesn’t “automatically” do the correct font linking.&nbsp; (This can be verified by e.g. opening Wordpad, setting the font to MS UI Gothic, and typing some surrogate pair characters—you just get squares.&nbsp; If the font is something else, e.g. Arial, the font linking works correctly.)<br><br>Is this a known issue with the MS UI Gothic font face? We are currently using one function to obtain the desired font face. Should we be calling a different function instead of this, or in addition to this?</font></i></p></blockquote><p>Now as it turns out, there were several different issues going on here.</p><p>It start with the involvement of GDI font linking and Uniscribe font fallback, discussed previously in blogs like <b><a href="http://archives.miloush.net/michkap/archive/2005/10/01/476022.html" mce_href="http://archives.miloush.net/michkap/archive/2005/10/01/476022.html">Font Linking vs. Font Fallback</a></b>.<br></p><p>First and foremost was the fact that this was what they call a <b>tester scenario</b>. Because of this,the actual supplementary, CJK Extension B characters in question were not ones that are in any version of JIS (including the latest JIS X 213), which is why they were seeing notdef glyphs (aka square boxes).</p><p>Uniscribe largely stays out of the world of CJK (Chinese, Japanese, and Korean) text, allowing GDI font linking to so most of the work here. Usually this will guarantee that some ideograph will make an appearance, because as long as it is in one of those core CJK fonts, it will be on the screen.</p><p>But there is one time when Uniscribe is completely involved and GDI font linking is not -- and that is supplementary characters.</p><p>And Uniscribe is not quite as sophisticated in its efforts here -- it will see if the current font claims to support the Unicode supplementary ideographic plane (which contains e.g. CJK Extension B). If it does then the font will be used, even if there turn out to be some missing characters.</p><p>For the Japanese fonts, such as MS Gothic:</p><p><img src="http://trigeminal.fmsinc.com/images/Plane2-MSGothic.jpg" title="MS Gothic" alt="MS Gothic" mce_src="http://trigeminal.fmsinc.com/images/Plane2-MSGothic.jpg" width="840" border="0" height="705"></p><p>and MS PGothic:</p><p><img src="http://trigeminal.fmsinc.com/images/Plane2-MSPGothic.jpg" title="MS PGothic" alt="MS PGothic" mce_src="http://trigeminal.fmsinc.com/images/Plane2-MSPGothic.jpg" width="840" border="0" height="705"></p><p>and MS Mincho:</p><p><img src="http://trigeminal.fmsinc.com/images/Plane2-MSMincho.jpg" title="MS Mincho" alt="MS Mincho" mce_src="http://trigeminal.fmsinc.com/images/Plane2-MSMincho.jpg" width="960" border="0" height="705"></p><p>and MS PMincho:</p><p><img src="http://trigeminal.fmsinc.com/images/Plane2-MSPMincho.jpg" title="MS PMincho" alt="MS PMincho" mce_src="http://trigeminal.fmsinc.com/images/Plane2-MSPMincho.jpg" width="840" border="0" height="705"></p><p>and Meiryo:</p><p><img src="http://trigeminal.fmsinc.com/images/Plane2-Meiryo.jpg" title="Meiryo" alt="Meiryo" mce_src="http://trigeminal.fmsinc.com/images/Plane2-Meiryo.jpg" width="1228" border="0" height="660"></p><p>each font is actually pretty much limited to the 300-some CJK Extension B characters in JIS X 213.</p><p>If you pick one of these fonts to display any other random Extension B ideograph, then you will get a square box.</p><p>And if you pick a font with no Extension B support at all, then it will pick one font to look in, based on its algorithm and system locale settings -- thus if you choose Arial or Tahoma or Microsoft Sans Serif or Segoe UI, then you will possibly also get an ideograph!</p><p>Korean does not have Extension B in any of its fonts.Given the gemneral tendency toward de-emphasis of Hanja in South Korea and the virtual illegality of it in North Korea, this is hardly a surprise (though this could change in the future if the customer demand drives change here).</p><p>And for the most part Chinese has the widest support. Because whether one uses the Simplified Chinese SimSun-ExtB font:</p><p><img src="http://trigeminal.fmsinc.com/images/Plane2-SimSun-ExtB.jpg" title="SimSun-ExtB" alt="SimSun-ExtB" mce_src="http://trigeminal.fmsinc.com/images/Plane2-SimSun-ExtB.jpg" width="806" border="0" height="993"></p><p>or the Taiwanese style Traditional Chinese font MingLiU-ExtB:</p><p><img src="http://trigeminal.fmsinc.com/images/Plane2-MingLiU-ExtB.jpg" title="MingLiU-ExtB" alt="MingLiU-ExtB" mce_src="http://trigeminal.fmsinc.com/images/Plane2-MingLiU-ExtB.jpg" width="806" border="0" height="993"></p><p>or the Taiwanese style Traditional Chinese font PMingLiU-ExtB:</p><p><img src="http://trigeminal.fmsinc.com/images/Plane2-PMingLiU-ExtB.jpg" title="PMingLiU-ExtB" alt="PMingLiU-ExtB" mce_src="http://trigeminal.fmsinc.com/images/Plane2-PMingLiU-ExtB.jpg" width="806" border="0" height="993"></p><p>or the Hong Kong style Traditional Chinese font MingLiU_HKSCS-ExtB:</p><p><img src="http://trigeminal.fmsinc.com/images/Plane2-MingLiU_HKSCS-ExtB.jpg" title="MingLiU_HKSCS-ExtB" alt="MingLiU_HKSCS-ExtB" mce_src="http://trigeminal.fmsinc.com/images/Plane2-MingLiU_HKSCS-ExtB.jpg" width="806" border="0" height="993"></p><p>one has a much larger number of ideographs to choose from.</p><p>The ranges are of course based on preferred glyphs in the PRC GB18030, Taiwan CNS11643, and Hong Kong HKSCS standards, respectively -- kind of the ultimate exercise of using a code page as a repertoire fence (something <b><a href="http://archives.miloush.net/michkap/archive/2005/05/10/416129.html" mce_href="http://archives.miloush.net/michkap/archive/2005/05/10/416129.html">I have discussed before</a></b>).</p><p>But the bug did not quite end there.</p><p>You seem it seems that the application had its own custom font choosing behavior, which in this case happened to be preferring the newer ClearType Simplified Chinese <b>Microsoft YaHei</b> font.</p><p>A font that also has some Extension B in it.</p><p><b>Eight CJK Extension B Ideographs</b>, in fact:</p><p><img src="http://trigeminal.fmsinc.com/images/Plane2-MicrosoftYaHei.jpg" title="Microsoft YaHei" alt="Microsoft YaHei" mce_src="http://trigeminal.fmsinc.com/images/Plane2-MicrosoftYaHei.jpg" width="546" border="0" height="397"></p><p>These eight ideographs are:</p><ul><li><font size="5">𠂇 </font>(<a href="http://www.fileformat.info/info/unicode/char/20087" mce_href="http://www.fileformat.info/info/unicode/char/20087">U+20087</a>)<br></li><li><font size="5">𠂉 </font>(<a href="http://www.fileformat.info/info/unicode/char/20089" mce_href="http://www.fileformat.info/info/unicode/char/20089">U+20089</a>)<br></li><li><font size="5">𠃌 </font>(<a href="http://www.fileformat.info/info/unicode/char/200cc" mce_href="http://www.fileformat.info/info/unicode/char/200cc">U+200cc</a>)<br></li><li><font size="5">𠦝 </font>(<a href="http://www.fileformat.info/info/unicode/char/2099d" mce_href="http://www.fileformat.info/info/unicode/char/2099d">U+2099d</a>)<br></li><li><font size="5">𡗗 </font>(<a href="http://www.fileformat.info/info/unicode/char/215d7" mce_href="http://www.fileformat.info/info/unicode/char/215d7">U+215d7</a>)<br></li><li><font size="5">𢦏 </font>(<a href="http://www.fileformat.info/info/unicode/char/2298f" mce_href="http://www.fileformat.info/info/unicode/char/2298f">U+2298f</a>)<br></li><li><font size="5">𤇾 </font>(<a href="http://www.fileformat.info/info/unicode/char/241fe" mce_href="http://www.fileformat.info/info/unicode/char/241fe">U+241fe</a>)<br></li><li><font size="5">𧾷 </font>(<a href="http://www.fileformat.info/info/unicode/char/27fb7" mce_href="http://www.fileformat.info/info/unicode/char/27fb7">U+27fb7</a>)</li></ul><p>So far, these eight characters <b>as a set</b> seem to have no special relationship in China, Taiwan, Hong Kong, Macao, Singapore, Japan, Korea, or Vietnam, those being the major places where ideographs either are in use or have been within the last 1000 years.</p><p>If the characters spelled something special, I'd assume it was some kind of Easter Egg in the font (imagine the challenge if coming up with such an egg that relied on eight Unicode characters displayed in code point order -- talk about a fun word challenge in any language!</p><p>I am reminded of a bit from Apocalypse Now where Martin Sheen describes a report about Col Kurtz. Specially modified for the current situation, for the conspiracy theory minded:<br></p><blockquote><p><i>Late Summer-Fall 2008:<br>The proper glyphs for ideographic text in the supplementary <br>planes show up fine in Vista. Then in November in one font <br>is noted the presence of eight specific ideographs. Two of <br>them are in JIS X 213, three are from a list of Hong Kong <br>Cantonese, one is from some from China. T</i><i>he number of<br>Extension B ideographs visible in the application in China <br>drops off to nothing. </i><i>Guess they must have picked the <br>wrong eight characters.</i><br></p></blockquote><p>Kind of a stretch obviously. But still fun to write (had I time to really draw this one out it would have been as much fun in my opinion as <b><a href="http://archives.miloush.net/michkap/archive/2005/05/03/414161.html" mce_href="http://archives.miloush.net/michkap/archive/2005/05/03/414161.html">that Matrix one</a></b>!<br></p><p>Whatever the reasons, their presence (due to the Uniscribe design here) can
really break Extension B display support if someone is using the cool font with ClearType support.<br></p><p>If I had to guess, I'd wonder whether they were in there as part of an experimental effort at looking at ClearType Extension B support that just never got taken out (why would they? It's not like they are wrong, except in the meta sense of their effect!). But again that is just a guess. Probably more likely than my <b>Apocalypse Font</b> scenario above! ;-)<br></p><p>An interesting situation, in any case.... </p><p>&nbsp;</p><p><font color="#ff00ff"><i>This blog brought to you by</i><font size="5"> 𠂇 𠂉 𠃌 𠦝 𡗗 𢦏 𤇾 𧾷 </font><i>(<a href="http://www.fileformat.info/info/unicode/char/20087" mce_href="http://www.fileformat.info/info/unicode/char/20087">U+20087</a>, <a href="http://www.fileformat.info/info/unicode/char/20089" mce_href="http://www.fileformat.info/info/unicode/char/20089">U+20089</a>, <a href="http://www.fileformat.info/info/unicode/char/200cc" mce_href="http://www.fileformat.info/info/unicode/char/200cc">U+200cc</a>, <a href="http://www.fileformat.info/info/unicode/char/2099d" mce_href="http://www.fileformat.info/info/unicode/char/2099d">U+2099d</a>, <a href="http://www.fileformat.info/info/unicode/char/215d7" mce_href="http://www.fileformat.info/info/unicode/char/215d7">U+215d7</a>, <a href="http://www.fileformat.info/info/unicode/char/2298f" mce_href="http://www.fileformat.info/info/unicode/char/2298f">U+2298f</a>, <a href="http://www.fileformat.info/info/unicode/char/241fe" mce_href="http://www.fileformat.info/info/unicode/char/241fe">U+241fe</a>, and <a href="http://www.fileformat.info/info/unicode/char/27fb7" mce_href="http://www.fileformat.info/info/unicode/char/27fb7">U+27fb7</a>)</i></font></p>
<hr/><p><a id="9123678" href="#9123678">#</a> <strong>Andrew West</strong> on 19 Nov 2008 6:37 AM:</p><div style="margin-left: 1em"><p>There is something settish about these eight characters. Firstly, they are all character components rather than standalone characters in their own right, and, more significantly, six of the eight (U+20087, U+20089, U+200CC, U+215D7, U+2298F and U+241FE) are listed as a set in <a rel="nofollow" target="_new" href="http://std.dkuug.dk/jtc1/sc2/WG2/docs/n2808.pdf">http://std.dkuug.dk/jtc1/sc2/WG2/docs/n2808.pdf</a> as &quot;characters which are already encoded [that] needs a new source reference&quot;. As to U+2099D, it is a wide form of U+9FBA (proposed for encoding in N2808), which may have some significance. U+27FB7 is the odd one out: whereas the other seven are all non-radical character components, &nbsp;U+27FB7 is a radical (equivalent to U+2ECA &quot;CJK RADICAL FOOT&quot;).</p></div>
<p><a id="9124224" href="#9124224">#</a> <strong>Michael S. Kaplan</strong> on 19 Nov 2008 9:03 AM:</p><div style="margin-left: 1em"><p>I guess I could have had title fun here -- like &quot;It's totally radical to trip Uniscribe, dude!&quot;.</p>
<p>What do you think? I still like the title already there better, but this would a fun alternate! :-)</p>
</div>
<p><a id="9132495" href="#9132495">#</a> <strong>Kaenneth</strong> on 21 Nov 2008 8:55 PM:</p><div style="margin-left: 1em"><p>Possibly they are specific 'patches' to cover flawed versions of those characters in a different font... </p></div>
<p><a id="9132879" href="#9132879">#</a> <strong>Michael S. Kaplan</strong> on 22 Nov 2008 12:50 PM:</p><div style="margin-left: 1em"><p>Perhaps that was the goal, though obviously the goal would pretty much fail in all Microsoft software, so if that was what they were trying to do then they kind of didn't think it all through. :-)</p></div>
<p><a id="9139340" href="#9139340">#</a> <strong>Ken Lunde, Adobe Systems</strong> on 24 Nov 2008 5:51 PM:</p><div style="margin-left: 1em"><p>These are for GB 18030 support. At least, six of them are. Below is a mapping from GB 18030 code points (two-byte) to Unicode:</p>
<ul><li>0xFE51 &nbsp;U+20087</li><li>0xFE52 &nbsp;U+20089</li><li>0xFE53 &nbsp;U+200CC</li><li>0xFE6C &nbsp;U+215D7</li><li>0xFE76 &nbsp;U+2298F</li><li>0xFE91 &nbsp;U+241FE</li></ul>





<p>The other two appear to be included because they represent components.</p>
<p>In any case, it is absolutely clear that they are included because of GB 18030. Trust me. ;-)</p></div>
<p><a id="9139362" href="#9139362">#</a> <strong>Ken Lunde, Adobe Systems</strong> on 24 Nov 2008 5:56 PM:</p><div style="margin-left: 1em"><p>I should also point out that those same six ideographs originally came from GBK, and GB 18030 is a superset thereof. In GBK, they mapped to PUA code points. Earlier versions of GB 18030 continued to map them to PUA code points, but they now have valid (and more appropriate) homes in Extension B.</p></div>
<p><a id="9139525" href="#9139525">#</a> <strong>Michael S. Kaplan</strong> on 24 Nov 2008 6:36 PM:</p><div style="margin-left: 1em"><p>Are these the only ones with PUA mappings from GBK, though?</p></div>
<p><a id="9139546" href="#9139546">#</a> <strong>Ken Lunde, Adobe Systems</strong> on 24 Nov 2008 6:40 PM:</p><div style="margin-left: 1em"><p>Nope, there are others, but as of Unicode Version 4.1, everything that was handled via PUA code points can now be handled with non-PUA code points. Getting away from PUA usage is a &quot;good thing.&quot;</p></div>
<p><a id="9139614" href="#9139614">#</a> <strong>Michael S. Kaplan</strong> on 24 Nov 2008 6:52 PM:</p><div style="margin-left: 1em"><p>Given the Uniscribe design issue, do you think that the makers of the new cool ClearType enabled PRC-friendly font would have added just these eight and not the rest if they knew it meant that none of the others would show up? :-(</p>
<p>I do agree that the Unicode change to add them is a good thing, but the Microsoft-specific behavior and the font specific trigger of that behavior? Not so much....</p></div>
<p><a id="9139635" href="#9139635">#</a> <strong>Michael S. Kaplan</strong> on 24 Nov 2008 6:55 PM:</p><div style="margin-left: 1em"><p>Though I admit it is nice to see the mystery understood a little better. any thoughts on why these eight in particular were singled out above the others?</p></div>
<p><a id="9139670" href="#9139670">#</a> <strong>Ken Lunde, Adobe Systems</strong> on 24 Nov 2008 7:01 PM:</p><div style="margin-left: 1em"><p>I don't think that they were singled out, at least in the sense that you're thinking. They are unique among the other characters that were previously handled via PUA code points in that they now map to non-BMP code points. The others are handled via BMP code points. For some other examples, check out U+9FB4 through U+9FBB. I have a table on Chapter 3 of &quot;CJKV Information Processing&quot; Second Edition, due out in a month, that details these mapping changes, from PUA to non-PUA.</p></div>
<p><a id="9139685" href="#9139685">#</a> <strong>Michael S. Kaplan</strong> on 24 Nov 2008 7:07 PM:</p><div style="margin-left: 1em"><p>Ah, that makes sense. They were probably taken right from the former PUA mappings, then -- as a conscious &quot;look at the bug we have fixed&quot; kind of move. If only they realized the bug they introduced in the process!</p></div>
<hr/><p><em>referenced by</em></p><div style="margin-left: 1em"><p>2015/08/03 <a href="http://archives.miloush.net/michkap/archive/2015/08/03/8770668856267196910.html">Getting the full Blog fixed up, images and all!</a></p><p>2015/07/08 <a href="http://archives.miloush.net/michkap/archive/2015/07/08/8770668856267196695.html">Fixing up broken and semi broken blog posts, as needed?</a></p><p>2012/01/26 <a href="http://archives.miloush.net/michkap/archive/2012/01/26/10260726.html">If font linking doesn't fit the text to a T (or ț!), a Romanian letter may be right but not quite look it</a></p></div><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2008/11/24/9134826.html" title="UCS-2 to UTF-16, Part 6: An exercise left for whoever needs some exercise">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2008/11/18/9116596.html" title="If you say I&#39;ll PASS, that means you&#39;ll be there!">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2008-11">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2008-11-19">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2008/11/19/9116067.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:35 GMT -->
</html>