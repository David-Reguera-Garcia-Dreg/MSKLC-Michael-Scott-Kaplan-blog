<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2008/11/01/9028213.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:35 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>What's the shape of the sort?</title></head><body>
<h1>What's the shape of the sort?</h1>
<p><em>by Michael S. Kaplan, published on 2008/11/01 11:01 -04:00, original URI: http://blogs.msdn.com/b/michkap/archive/2008/11/01/9028213.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostNew -->
<p>There is an old Marx Brothers routine that goes something like this:</p><blockquote><p><font face="times new roman,times"><b>Groucho</b>: What's the shape of the world?<br><b>Harpo</b>: It's terrible.<br><b>Groucho</b>: No, I'm talking about the shape.<br><b>Harpro</b>: Oh, that's different.<br><b>Groucho</b>: So what's the shape of the world?<br><b>Harpo</b>: I don't know.<br><b>Groucho</b>: Well, what's the shape of my cuff links?<br><b>Harpo</b>: Square.<br><b>Groucho</b> <i>{becoming exasperated}</i>: Not <i>these</i> cuff links, the ones I wear on Sunday.<br><b>Harpo</b>: Round.<br><b>Groucho</b>: So, what's the shape of the world?<br><b>Harpo</b>: Square in the weekdays, r</font><font face="times new roman,times">ound in Sunday!</font></p></blockquote><p>I was thinking about it the other day, when a question came up about whether one would prefer <a href="http://msdn.microsoft.com/library/ms647476.aspx" target="_blank" mce_href="http://msdn.microsoft.com/library/ms647476.aspx">CompareStringA</a> or <a href="http://msdn.microsoft.com/library/k59z8dwe.aspx" mce_href="http://msdn.microsoft.com/library/k59z8dwe.aspx">_stricmp</a> for string comparisons in a particular situation.<br></p>
<p>That could really be thought of as a trick question -- the preference is obviously to use Unicode strings and be worried about <a href="http://msdn.microsoft.com/library/ms647476.aspx" target="_blank" mce_href="http://msdn.microsoft.com/library/ms647476.aspx">CompareStringW</a> or <a href="http://msdn.microsoft.com/library/k59z8dwe.aspx" mce_href="http://msdn.microsoft.com/library/k59z8dwe.aspx">_wcsicmp</a>!</p>
<p>But in this case the component happened to be dealing with "ANSI" strings, so I'll temporarily reject the premise that the question is flawed. I'll get back to it in a moment.</p>
<p>The question is somewhat similar to the one between <a href="http://msdn.microsoft.com/library/k59z8dwe.aspx" mce_href="http://msdn.microsoft.com/library/k59z8dwe.aspx">_stricmp</a> and <a href="http://msdn.microsoft.com/library/2w46a1da.aspx" mce_href="http://msdn.microsoft.com/library/2w46a1da.aspx">_stricoll</a>, with the added bonus of the confusion between what code page is used to interpret how the 256 bytes of the ANSI code page are going to be interpreted.</p>
<p>In fact, to make the functions more analogous for comparison/contrast purposes, it might be better to ask about either <a href="http://msdn.microsoft.com/library/ms647476.aspx" target="_blank" mce_href="http://msdn.microsoft.com/library/ms647476.aspx">CompareStringA with NORM_IGNORECASE</a> vs. <a href="http://msdn.microsoft.com/library/k59z8dwe.aspx" mce_href="http://msdn.microsoft.com/library/k59z8dwe.aspx">_stricmp_l</a> (so you always get to specify the locale to use for determining the code page) or <a href="http://msdn.microsoft.com/library/ms647476.aspx" target="_blank" mce_href="http://msdn.microsoft.com/library/ms647476.aspx">CompareStringA with the LOCALE_USE_CP_ACP flag</a> vs. <a href="http://msdn.microsoft.com/library/k59z8dwe.aspx" mce_href="http://msdn.microsoft.com/library/k59z8dwe.aspx">_stricmp</a> (so you never get to do so).</p>
<p>Maybe I should explain the situation for both of these options, now that I have brought the matter up....</p>
<p>To start, when looking at <a href="http://msdn.microsoft.com/library/ms647476.aspx" target="_blank" mce_href="http://msdn.microsoft.com/library/ms647476.aspx">CompareStringA with the LOCALE_USE_CP_ACP flag</a> vs. <a href="http://msdn.microsoft.com/library/k59z8dwe.aspx" mce_href="http://msdn.microsoft.com/library/k59z8dwe.aspx">_stricmp</a>, in both cases the ANSI string is assumed to be in the "default codepage", in the former case the default system code page that is the <a href="http://msdn.microsoft.com/library/ms776270.aspx" mce_href="http://msdn.microsoft.com/library/ms776270.aspx">GetLocaleInfoA</a> with <a href="http://msdn.microsoft.com/library/bb507201.aspx#Get-only" mce_href="http://msdn.microsoft.com/library/bb507201.aspx#Get-only">LOCALE_IDEFAULTANSICODEPAGE</a> of the default system locale (aka language for non-Unicode programs), and in the latter case with the equivalent to the <a href="http://msdn.microsoft.com/library/bb507201.aspx#Get-only" mce_href="http://msdn.microsoft.com/library/bb507201.aspx#Get-only">LOCALE_IDEFAULTANSICODEPAGE</a> of the current CRT locale (retrievable via <a href="http://msdn.microsoft.com/library/3szh5e2z.aspx" mce_href="http://msdn.microsoft.com/library/3szh5e2z.aspx">_get_current_locale</a>).</p>
<p>In the <a href="http://msdn.microsoft.com/library/ms647476.aspx" target="_blank" mce_href="http://msdn.microsoft.com/library/ms647476.aspx">CompareStringA with NORM_IGNORECASE</a> vs. <a href="http://msdn.microsoft.com/library/k59z8dwe.aspx" mce_href="http://msdn.microsoft.com/library/k59z8dwe.aspx">_stricmp_l</a> case, you specify the locale to use rather than using one controlled by settings that exist prior to the call<br></p>
<p>Once you know how to interpret the 256 bytes, you know what the characters are and you know how to determine the "case" of the characters, if they in fact have case.</p>
<p>For example, if the code page in question is <a href="http://www.microsoft.com/globaldev/reference/sbcs/1252.mspx" mce_href="http://www.microsoft.com/globaldev/reference/sbcs/1252.mspx">Windows code page 1252</a>, then in all of the above cases if you have the byte 0xC5 then you have the letter Å (<a href="http://www.fileformat.info/info/unicode/char/00c5" mce_href="http://www.fileformat.info/info/unicode/char/00c5">U+00c5</a>, aka LATIN CAPITAL LETTER A WITH RING ABOVE) which the case insensitivity of all of the functions will interpret as being the same as å (<a href="http://www.fileformat.info/info/unicode/char/00e5" mce_href="http://www.fileformat.info/info/unicode/char/00e5">U+00e5</a>, aka LATIN SMALL LETTER A WITH RING ABOVE), as I explain in an earlier blog (<b><a href="http://archives.miloush.net/michkap/archive/2006/03/02/542395.html" mce_href="http://archives.miloush.net/michkap/archive/2006/03/02/542395.html">CompareString ignores case by lowercasing</a></b>).</p><p>But if on the other hand the code page in question is <a href="http://www.microsoft.com/globaldev/reference/sbcs/1255.mspx" mce_href="http://www.microsoft.com/globaldev/reference/sbcs/1255.mspx">Windows code page 1255</a>, then in all the above cases if you have the byte 0xC5 then you have the point ֵ (<a href="http://www.fileformat.info/info/unicode/char/05b5" mce_href="http://www.fileformat.info/info/unicode/char/05b5">U+05b5</a>, aka HEBREW POINT TSERE), which will not lowercase to anything, whatsoever. Hebrew letters don't even have case, so of course its accents and points and marks asnd punctuation wouldn't!</p><p>Now this is not the same as "linguistic casing" which I first explained back in <b><a href="http://archives.miloush.net/michkap/archive/2004/12/11/279942.html" mce_href="http://archives.miloush.net/michkap/archive/2004/12/11/279942.html">What does "linguistic casing" mean?</a></b>, since in the <a href="http://msdn.microsoft.com/library/ms647476.aspx" target="_blank" mce_href="http://msdn.microsoft.com/library/ms647476.aspx">CompareStringA</a> case the flag is not being passed and in the <a href="http://msdn.microsoft.com/library/k59z8dwe.aspx" mce_href="http://msdn.microsoft.com/library/k59z8dwe.aspx">_stricmp</a> case it is never ever being passed.</p><p>This is why even though <a href="http://msdn.microsoft.com/library/k59z8dwe.aspx" mce_href="http://msdn.microsoft.com/library/k59z8dwe.aspx">_stricmp</a> is not considered a function that uses locale-specific information (in conrast to <a href="http://msdn.microsoft.com/library/2w46a1da.aspx" mce_href="http://msdn.microsoft.com/library/2w46a1da.aspx">_stricoll</a>), how it actually uses <i>some</i> locale information, albeit indirectly and (unless you parsed the first five of the previous six paragraphs with one reading) confusingly. Which, to get back to the Unicode (<a href="http://msdn.microsoft.com/library/ms647476.aspx" target="_blank" mce_href="http://msdn.microsoft.com/library/ms647476.aspx">CompareStringW</a> or <a href="http://msdn.microsoft.com/library/k59z8dwe.aspx" mce_href="http://msdn.microsoft.com/library/k59z8dwe.aspx">_wcsicmp</a>) issue, if you keep it in Unicode then you can ignore the first five of the previous six paragraphs, which are really the most confusing parts anyway.</p><p>This then lets you look at the real issue that the <a href="http://msdn.microsoft.com/library/ms647476.aspx" target="_blank" mce_href="http://msdn.microsoft.com/library/ms647476.aspx">CompareStringA</a> vs. <a href="http://msdn.microsoft.com/library/k59z8dwe.aspx" mce_href="http://msdn.microsoft.com/library/k59z8dwe.aspx">_stricmp</a> (and also <a href="http://msdn.microsoft.com/library/ms647476.aspx" target="_blank" mce_href="http://msdn.microsoft.com/library/ms647476.aspx">CompareStringW</a> vs. <a href="http://msdn.microsoft.com/library/k59z8dwe.aspx" mce_href="http://msdn.microsoft.com/library/k59z8dwe.aspx">_wcsicmp</a>) question was always about -- it really is a linguistic comparison vs. binary/ordinal one, which has all the issues that <b><a href="http://www.google.com/search?hl=en&amp;q=site%3Ablogs.msdn.com%2Fmichkap+Invariant+Ordinal" mce_href="http://www.google.com/search?hl=en&amp;q=site%3Ablogs.msdn.com%2Fmichkap+Invariant+Ordinal">the whole invariant versus ordinal question</a></b> dredges up, plus actually specifying any locale for comparison rather than having the single INVARIANT (yet still linguistic) choice.</p><p>And the answer to that question is, and has always been, that depends. On what is being compared.</p><p>This particular time, it happened to be looking at the name of a SQL Server, to see if it was the same as the computer it is running atop of.</p><p>In most cases, this would suggest to me the need for a binary/ordinalignorecase type semantic, though there night be some edge cases (since a SQL Server is involved) that you' want SQL Server type comparisons, which would be dependent on the collation of the SQL Server, either linguistic or <b><a href="http://archives.miloush.net/michkap/archive/2005/01/23/358946.html" mce_href="http://archives.miloush.net/michkap/archive/2005/01/23/358946.html">the SQL Server notion of binary</a></b>, which has no case ignoring facility.</p><p>Am I the only one who sees a conversation about which function to use as a very geeky, extended mapping of that Marx Brothers bit? :-)</p><p>If I am ever at some random event and can find someone to play the <span style="font-weight: bold;">Harpo</span> role, I'd even try and script it out and perform it!<br></p><p><br></p><p><font color="#ff00ff"><i>This blog brought to you by</i><font size="7">  ֵ </font><i>(aka <a href="http://www.fileformat.info/info/unicode/char/05b5" mce_href="http://www.fileformat.info/info/unicode/char/05b5">U+05b5</a>, aka HEBREW POINT TSERE)</i></font></p>
<hr/><p><strong>Blake Handler</strong> on 1 Nov 2008 11:58 AM:</p><div style="margin-left: 1em"><p>Huh? Harpo didn't talk?</p></div>
<p><strong>Michael S. Kaplan</strong> on 1 Nov 2008 12:33 PM:</p><div style="margin-left: 1em"><p>The original incarnation of that skit had Harpo; it was before he "lost" his voice in the act. I think Chico did that skit in later acts (I recall vaguely reading about this in a book that included Groucho's letters - ref: <a href="http://books.google.com/books?id=ZWaas-aCstoC&amp;dq=The+Groucho+Letters&amp;pg=PP1&amp;lpg=PP1&amp;sig=ACfU3U0LklLxZCSe-rRZ9sOogqPNlXyNkw&amp;q=shape+of+the+world#PPA9,M1">The Groucho Letters</a>).</p></div>
<p><strong>Andrew West</strong> on 3 Nov 2008 5:13 AM:</p><div style="margin-left: 1em"><p>As long as I don't have to speak, I'll play the Harpo role.</p></div>
<p><strong>Michael S. Kaplan</strong> on 3 Nov 2008 10:21 AM:</p><div style="margin-left: 1em"><p>Well, I'll need someone to do a modified version of the role in the skit that I quoted, so some speaking would in fact be required, sorry! :-)</p>
</div>
<hr/><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2008/11/01/9028539.html" title="The absentee ballot seems like the best approach, if I am a homeowner about to be sexually assaulted...">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2008/10/31/9026748.html" title="Je suis prêt">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2008-11">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2008-11-01">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2008/11/01/9028213.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:35 GMT -->
</html>