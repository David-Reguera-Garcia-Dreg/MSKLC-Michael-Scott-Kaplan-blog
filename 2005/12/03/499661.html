<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2005/12/03/499661.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:40 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>The default character is not always the question mark</title></head><body>
<h1>The default character is not always the question mark</h1>
<p><em>by Michael S. Kaplan, published on 2005/12/03 21:01 -05:00, original URI: http://blogs.msdn.com/b/michkap/archive/2005/12/03/499661.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostNew -->
<P><FONT face=Tahoma>It seems like common sense, but every once in a while it is important to remember: Unicode is <STRONG>big</STRONG>.</FONT></P>
<P><FONT face=Tahoma><STRONG>Really big</STRONG>.</FONT></P>
<P><FONT face=Tahoma>And not just in a simple Ed Sullivan <EM>really big standard</EM> sense.</FONT></P>
<P><FONT face=Tahoma>Or even in a Morrissey <EM>some girls encodings are bigger than other girls encodings</EM> sense.</FONT></P>
<P><FONT face=Tahoma></FONT>&nbsp;</P>
<P><FONT face=Tahoma>I mean&nbsp;in the literal sense that the only code pages that are as big as Unicode are the ones that are actually tied to Unicode like GB-18030.</FONT></P>
<P><FONT face=Tahoma>Because of that size, it makes sense to plan for the fact that any time you convert from Unicode to some other code page via <A href="http://msdn.microsoft.com/library/en-us/intl/unicode_2bj9.asp"><STRONG>WideCharToMultiByte</STRONG></A>, you might find that&nbsp;one or more of the&nbsp;characters are not there. And that plan is easy: every code page has a default character which is inserted where there was no other character to insert.</FONT></P>
<P><FONT face=Tahoma>Plus you also need a character to insert when converting in the other direction (via <A href="http://msdn.microsoft.com/library/en-us/intl/unicode_17si.asp"><STRONG>MultiByteToWideChar</STRONG></A>) for times when the data makes no sense (like a byte that was&nbsp;<a href="http://archives.miloush.net/michkap/archive/2005/11/23/495193.html">not on that source code page</A>!).</FONT></P>
<P><FONT face=Tahoma>For almost all code pages, the default character is a question mark (?), good old 0x3f on all of the Windows 'ANSI' code pages and <A href="http://www.fileformat.info/info/unicode/char/003f">U+003f</A> in Unicode. Which in most cases is a great way to communicate in a single character the message of the Micrsosoft Windows Jeff Spicoli code page surfer who is trying to say "Huh? Dude, I have no idea what you're talking about."</FONT></P>
<P><FONT face=Tahoma>Perhaps&nbsp;for Greek the semicolon would have been a better choice since that is the preferred marker used at the end of a sentence that is a question, but&nbsp;Microsoft did not go&nbsp;in that direction for <A href="http://www.microsoft.com/globaldev/reference/sbcs/1253.mspx">Windows code page 1253</A>. I asked Cathy about this once out of curiousity and her response was a very serious and unflinching <STRONG>we're not changing that, Michael</STRONG> which doesn't say whether it might have been a good idea ten years ago or not -- probably not!</FONT></P>
<P><FONT face=Tahoma>I tend to forget about the exception to the rule that the question mark is the default character, but I remembered it the other day when I got the following e-mail from someone going by the handle of misterhektik:</FONT></P>
<BLOCKQUOTE dir=ltr style="MARGIN-RIGHT: 0px">
<P><FONT size=2><EM>I was hoping you could shed some light on a problem I'm having.&nbsp; I play an online international game, and am making a program in C# to parse the chatlogs from this game.&nbsp; The chatlogs are encoded in shift-jis.&nbsp; There is alot of hex garbage produced by the game that is dumped into the chatlogs.&nbsp; My program aims to remove all the garbage, and succeeds....almost.&nbsp; For some reason when using C#/.Net the hex combination %EF%27 and %EF%28 are both converted into %30FB.&nbsp; I don't understand why.&nbsp; I've written this same program as a perl script and it works without a problem.&nbsp; </EM></FONT></P>
<P><FONT size=2><EM>My question is, does it have something to do with the encoding?&nbsp; That is the only logical thing I can think of.&nbsp; If so, am I using the wrong encoding to read the files? </EM></FONT></P>
<P><FONT size=2><EM>Thanks.</EM></FONT></P></BLOCKQUOTE>
<P><FONT face=Tahoma>On <A href="http://www.microsoft.com/globaldev/reference/dbcs/932.mspx">Windows code page 932</A> (Shift-JIS), the default character out of Unicode is still 0x3f, but on the way into Unicode it is (wait for it) <A href="http://www.fileformat.info/info/unicode/char/30fb">U+30fb</A>, also known as KATAKANA MIDDLE DOT.</FONT></P>
<P><FONT face=Tahoma>Now working backwards at 0xef27 and 0xef28, it turns out that the lead byte 0xef on code page 932 is one of those reserved lead bytes I talked about in <STRONG><a href="http://archives.miloush.net/michkap/archive/2005/11/23/495193.html">100% roundtrip ASCII? 100% roundtrip ANSI?</A></STRONG> last month. Which means there is no trail byte that combines with it make a valid character.</FONT></P>
<P><FONT face=Tahoma>And that fits in well with the notion of the 'hex garbage' that misterhektik was referring to.</FONT></P>
<P><FONT face=Tahoma>In the words of the late George Peppard, <EM>I love it when a plan comes together</EM>.</FONT></P>
<P><FONT face=Tahoma>Now while it is true that <A href="http://msdn.microsoft.com/library/en-us/intl/unicode_2bj9.asp"><STRONG>WideCharToMultiByte</STRONG></A>&nbsp;gives you a way to override the default character, it is an unfortunate truth that <A href="http://msdn.microsoft.com/library/en-us/intl/unicode_17si.asp"><STRONG>MultiByteToWideChar</STRONG></A>&nbsp;does not. So there is no way in Windows to change what that character will be when it is needed.</FONT></P>
<P><FONT face=Tahoma>I honestly do not know the frequency of usage of the KATAKANA MIDDLE DOT in Japanese text, but if it is anything like the question mark in English then that means it is used just often enough to make replacing it after the conversion annoying....</FONT></P>
<P><FONT face=Tahoma>But since misterhektik mentioned he was using C#, he may have an option if he is using Whidbey since you can override the fallback mechanism and customize the handling of this situation (if that is required).</FONT></P>
<P><FONT face=Tahoma>I will try to remember in the future&nbsp;that the question mark is not always the default character; it only usually is. :-)</FONT></P>
<P><FONT face=Tahoma></FONT>&nbsp;</P>
<P><FONT face=Tahoma color=#ff1493><EM>This post brought to you by</EM> "<FONT size=6>・</FONT>" <EM>(<A href="http://www.fileformat.info/info/unicode/char/30fb">U+30fb</A>, a.k.a. KATAKANA MIDDLE DOT)</EM></FONT></P>
<hr/><p><a id="499834" href="#499834">#</a> <strong>Michael Dunn_</strong> on 3 Dec 2005 10:05 PM:</p><div style="margin-left: 1em">I mean, you may think it's a long way down the street to the chemist, but that's just _peanuts_ to unicode. ;)<br> <br>The middle dot is a word separator in katakana, although it's not used all the time. If there are two common katakana words together, and the word boundary is obvious, then the dot isn't used. You'll see it used often in foreign names, you could write mine as: ﾄﾞﾝ・ﾏｲｸ (don maiku)</div>
<p><a id="499843" href="#499843">#</a> <strong>Rosyna</strong> on 4 Dec 2005 1:34 AM:</p><div style="margin-left: 1em">What he said. It's not used very often at all. The only times I am seeing it here (in Japan) is for names in katakana like キング・コング (gah, which I see EVERYWHERE).  <a rel="nofollow" target="_new" href="http://www.kk-movie.jp/top.html">http://www.kk-movie.jp/top.html</a><br><br>In fact, it is probably used far less than the question mark in english (but maybe more than the question mark in japanese).</div>
<p><a id="499853" href="#499853">#</a> <strong>CornedBee</strong> on 4 Dec 2005 4:22 AM:</p><div style="margin-left: 1em">Not a Unicode conversion, but there's one place where unrecognized bytes are almost invariably displayed as a dot: hex editors.</div>
<p><a id="499874" href="#499874">#</a> <strong>Michael S. Kaplan</strong> on 4 Dec 2005 10:06 AM:</p><div style="margin-left: 1em">I think they use U+00b7 there in hex editors, rather than KATAKANA MIDDLE DOT. :-)</div>
<hr/><p><em>referenced by</em></p><div style="margin-left: 1em"><p>2005/12/09 <a href="http://archives.miloush.net/michkap/archive/2005/12/09/502290.html">More on the C4819 error</a></p></div><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2005/12/03/499830.html" title="Be careful about excessive Microhol consumption">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2005/12/03/499419.html" title="When even the bugs seem cool">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2005-12">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2005-12-03">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2005/12/03/499661.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:40 GMT -->
</html>