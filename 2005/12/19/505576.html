<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2005/12/19/505576.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:40 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>It isn't a FONTSIGNATURE, darn it!</title></head><body>
<h1>It isn't a FONTSIGNATURE, darn it!</h1>
<p><em>by Michael S. Kaplan, published on 2005/12/19 17:01 -05:00, original URI: http://blogs.msdn.com/b/michkap/archive/2005/12/19/505576.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostNew -->
<P><FONT face=Tahoma>I keep old&nbsp;Platform&nbsp;SDK doc&nbsp;versions around for the NLS API.</FONT></P>
<P><FONT face=Tahoma>It does take up some space, but it also lets me look at what used to be in the documentation so I can know where mistaken impressions might have come from. It makes me slower to judge people when they are wrong. :-)</FONT></P>
<P><FONT face=Tahoma>If I go back to the version that shipped with Visual Studio 6.0, the&nbsp;Platform SDK mention of LOCALE_FONTSIGNATURE is absent.</FONT></P>
<P><FONT face=Tahoma>If I go back to the version that shipped with the&nbsp;October 2001 MSDN,&nbsp;the following text is there:</FONT></P><FONT face=Tahoma>
<DL>
<DL>
<DT><FONT face=Arial size=2><EM>LOCALE_FONTSIGNATURE </EM></FONT>
<DD><FONT face=Arial><EM><FONT size=2><B>Windows 95/98/Me, Windows NT 4.0 and later: </B>A bit pattern used to determine the relationship between character coverage needed to support the locale and the font contents. For more information, see FONTSIGNATURE.</FONT></EM></FONT> </DD></DL></DL></FONT>
<P><FONT face=Tahoma>The biggest problem with this topic is that the bits returned by the LOCALE_FONTSIGNATURE <EM>are not a </EM><A href="http://msdn.microsoft.com/library/en-us/intl/unicode_3h0y.asp"><EM>FONTSIGNATURE</EM></A>.</FONT></P>
<P><FONT face=Tahoma>What is actually returned is a slightly different object: a <A href="http://msdn.microsoft.com/library/en-us/intl/unicode_5ppu.asp">LOCALESIGNATURE</A>.</FONT></P>
<P><FONT face=Tahoma>I talked about this a little in <a href="http://archives.miloush.net/michkap/archive/2005/10/22/483573.html">Parameter confusion #2a</A>&nbsp;(where you can also see more recent doc text!), when I was talking about the confusing story about the value to pass in the length parameter of <A href="http://msdn.microsoft.com/library/en-us/intl/nls_34rz.asp">GetLocaleInfo</A>. But I did not really explain what these two structures do.</FONT></P>
<P><FONT face=Tahoma>Basically, the&nbsp;<A href="http://msdn.microsoft.com/library/en-us/intl/unicode_3h0y.asp">FONTSIGNATURE</A> is designed as a huge bitfield that is designed to contain all of the information about what scripts a particular font supports. You can even return this infro from a font by using the <A href="http://archives.miloush.net/michkap/archive/2005/12/19/msdn.microsoft.com/library/en-us/intl/unicode_8ve7.asp">GetTextCharsetInfo</A> function.</FONT></P>
<P><FONT face=Tahoma>And the <A href="http://msdn.microsoft.com/library/en-us/intl/unicode_5ppu.asp">LOCALESIGNATURE</A>&nbsp;(which basically has a <A href="http://msdn.microsoft.com/library/en-us/intl/unicode_3h0y.asp">FONTSIGNATURE</A> inside of it) includes the scripts that the locale in question should have to be adequately represented, plus extra information on the defaulte code page bitfields that the font needs to support.</FONT></P>
<P><FONT face=Tahoma>Obviously the combination of fonts describing what they have and locales describing what they need theoretically make for a very powerful font linking/fallback/selection mechanism.</FONT></P>
<P><FONT face=Tahoma>Unfortunately, it does not work in practice, for many reasons:</FONT></P>
<UL>
<LI><FONT face=Tahoma>For years the docs were wrong in their description of the locale side of this functionality</FONT> 
<LI><FONT face=Tahoma>No good samples on using this functionaslity were ever really put together</FONT> 
<LI><FONT face=Tahoma>The data quality in the <A href="http://msdn.microsoft.com/library/en-us/intl/unicode_5ppu.asp">LOCALESIGNATURE</A>&nbsp;has not always been accurate across all locales and all versions of Windows</FONT> 
<LI><FONT face=Tahoma>The data quality in the <A href="http://msdn.microsoft.com/library/en-us/intl/unicode_3h0y.asp">FONTSIGNATURE</A>&nbsp;provided by fonts (both those shipped by Microsoft and by external font foundries) has not always been 100% truthful</FONT></LI></UL>
<P><FONT face=Tahoma>Now this last point is the fault of neither the fonts nor their creators, it highlights a limitation in the whole structure.</FONT></P>
<P><FONT face=Tahoma>Because it is perfectly reasonable too create (for example) a font that will support Russian OR Ukranian OR Belarusian OR Bosnian, but not the letters needed by the other three. And it would still set bit 9 (Cyrillic and Cyrillic supplementary) in the <A href="http://msdn.microsoft.com/library/en-us/intl/unicode_63ub.asp">Unicode subset bitfields</A> and the appropriate bits in the <A href="http://msdn.microsoft.com/library/en-us/intl/unicode_6ohf.asp">Codepage bitfields</A>, even though the language may support characters outside the various Cyrillic code pages. And in this case the four different fonts for the four languages that have different levels of support for the Cyrillic script would all return the same information!</FONT></P>
<P><FONT face=Tahoma>In the end, the <A href="http://msdn.microsoft.com/library/en-us/intl/unicode_5ppu.asp">LOCALESIGNATURE</A>/<A href="http://msdn.microsoft.com/library/en-us/intl/unicode_3h0y.asp">FONTSIGNATURE</A>&nbsp;means of description of script/codepage support within&nbsp;fonts never ended up being too widely used. It is still used&nbsp;in some cases, but this is becoming more and more rare as other more automatic methods of font linking/fallback have proven to cover scenarios more effectively....</FONT></P>
<P><FONT face=Tahoma></FONT>&nbsp;</P>
<P><FONT face=Tahoma><FONT color=#ff1493><EM>This post brought to you by</EM> "<FONT size=6>Җ</FONT>" <EM>(<A href="http://www.fileformat.info/info/unicode/char/0496">U+0496</A>, a.k.a. CYRILLIC CAPITAL LETTER ZHE WITH DESCENDER)</EM></FONT></FONT></P>
<hr/><p><a id="505731" href="#505731">#</a> <strong>Mihai</strong> on 19 Dec 2005 8:32 PM:</p><div style="margin-left: 1em">I have a small application using the FONTSIGNATURE and doing automatic font fallback and font selection.<br>Nothing special, you will say.<br>Only that it was written in 1997 on Windows 95 (and still running ok on XP).<br><br>Now I am thinking about filing a suit against MS :-)</div>
<p><a id="505736" href="#505736">#</a> <strong>Michael S. Kaplan</strong> on 19 Dec 2005 8:48 PM:</p><div style="margin-left: 1em">Fling a suit? What is the basis of that, exactly? :-)</div>
<p><a id="505746" href="#505746">#</a> <strong>Mihai</strong> on 19 Dec 2005 9:39 PM:</p><div style="margin-left: 1em">Not sure. But it seems to be a very popular sport in this country :-)<br></div>
<p><a id="505836" href="#505836">#</a> <strong>Nick Lamb</strong> on 20 Dec 2005 4:53 AM:</p><div style="margin-left: 1em">This makes it sound as if, on Windows, ordinary Win32 application programmers are expected to do their own fallback. Is that really true? I mean, let's take an illustrative example. Firstly, suppose you have a perfectly ordinary application with a label, maybe it's the label for a checkbox, or in a menu or something. Suppose the text of this label is an arbitrary name (like 毛澤東 or Nick Lamb) - Are you expected to write code to choose a font for this label that has all the necessary glyphs?<br><br>Or is this just for people who always have to do things the hard way, the Raymond Chens of this world who like to know how things work under the hood ? &quot;Unfortunately, it does not work in practice, for many reasons&quot; sounds like you were hoping to see widespread uptake of this facility.</div>
<p><a id="505879" href="#505879">#</a> <strong>Michael S. Kaplan</strong> on 20 Dec 2005 8:33 AM:</p><div style="margin-left: 1em">Hi Nick,<br><br>No, this method was never intended for ordinary users, it is definitely a fairly advanced GDI technique for picking fonts. <br><br>(But then, so is Uniscribe!)<br><br>When I say unfortunately, it is not really because I wanted to see more people use it; it is because it is as fsirly elaborate mechanism which in the end flls short of its implied promise of usefulness....</div>
<p><a id="506132" href="#506132">#</a> <strong>Jerry Pisk</strong> on 20 Dec 2005 5:54 PM:</p><div style="margin-left: 1em">Do any of the older PSDK releases work when used under a LUA? The latest does not, the Readme link is completely broken and the documentation (and any other documentation using Microsoft Document Explorer) tries to &quot;fix&quot; PSDK four times on each page load, eventually ending up with an Error 1706. It works fine when you use it as an administrator.</div>
<p><a id="506134" href="#506134">#</a> <strong>Michael S. Kaplan</strong> on 20 Dec 2005 6:13 PM:</p><div style="margin-left: 1em">Yikes, that is bad.<br><br>I will forward this on to some people over here.</div>
<p><a id="506181" href="#506181">#</a> <strong>Jerry Pisk</strong> on 20 Dec 2005 9:04 PM:</p><div style="margin-left: 1em">Thanks, I was not able to find any way to actually raise an issue with the PSDK team. It's not listed as a product on support.microsoft.com and it has no support options on its MSDN site. So here goes - I installed .Net framework SDKs first, 1.1, then 2.0 and then the PSDK. All running under a LUE using RunAs. I never actually ran those docs as the user that installed them, just under my limited account. PSDK's Readme link just runs MSI installation that fails and .Net 1.1's SDK tries to do the same on most pages (method descriptions do it all the time). If you cancel it few times it goes away until the docs are restarted, if you let it fail it will try to install several (3 or 4) times on each page. The actual PSDK documentation is working fine as far as I can tell.</div>
<p><a id="506251" href="#506251">#</a> <strong>Michael S. Kaplan</strong> on 21 Dec 2005 3:59 AM:</p><div style="margin-left: 1em">No worries, I made sure to get the issue in front of both them and the folks who are concerned about 'non-admin' issues (including this last comment of yours).</div>
<p><a id="506474" href="#506474">#</a> <strong>derek</strong> on 21 Dec 2005 3:16 PM:</p><div style="margin-left: 1em">Jerry,<br><br>please feel free to email both of us, we are on the SDK test team and would like to look into the issue you are having.<br><br>thanks<br>derekn@microsoft.com<br>chrishu@microsot.com</div>
<hr/><p><em>referenced by</em></p><div style="margin-left: 1em"><p>2008/10/05 <a href="http://archives.miloush.net/michkap/archive/2008/10/05/8977109.html">Can I get your [font]signature on this, please?</a></p><p>2006/02/08 <a href="http://archives.miloush.net/michkap/archive/2006/02/08/527375.html">They make 'em smarter than GetDateFormat</a></p></div><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2005/12/20/505946.html" title="IDN hits the uber-client">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2005/12/19/505309.html" title="Customizing shaping behvior in Uniscribe">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2005-12">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2005-12-19">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2005/12/19/505576.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:40 GMT -->
</html>