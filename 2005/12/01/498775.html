<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2005/12/01/498775.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:40 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>What is the VK for the semicolon?</title></head><body>
<h1>What is the VK for the semicolon?</h1>
<p><em>by Michael S. Kaplan, published on 2005/12/01 00:01 -08:00, original URI: http://blogs.msdn.com/michkap/archive/2005/12/01/498775.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostOld -->
<P><FONT face=Tahoma>It was just yesterday when someone sent the following question to various people inside of Microsoft:</FONT></P>
<BLOCKQUOTE dir=ltr style="MARGIN-RIGHT: 0px">
<P><EM><FONT face="Times New Roman">We have a small problem regarding the correct VK representation of the semicolon. Under the standard US KB the virtual key is VK_OEM_1 (0xba) but this may not be true for other languages. I suggested to simply use the ASCII char key (0x3b) for semicolon for all other case but I’m not that sure about it.</FONT></EM></P>
<P><EM><FONT face="Times New Roman">The use is very straightforward. </FONT></EM></P>
<P><EM><FONT face="Times New Roman">We handle the WM_KEYDOWN message in some point and want to catch the semicolon key press. </FONT></EM></P>
<P><EM><FONT face="Times New Roman">Simply check the message wParam (wParam == ‘;’) doesn’t work. </FONT></EM></P>
<P><EM><FONT face="Times New Roman">The reason is that the char ‘;’ is not sent within the wParam and instead what is sent is VK_OEM_1.</FONT></EM></P>
<P><EM><FONT face="Times New Roman">This is fine, but according the MSDN the code VK_OEM_1 works only for US standard KB. </FONT></EM></P>
<P><EM><FONT face="Times New Roman">So what is going to happen under different keyboards layout and/or other languages settings? </FONT></EM></P>
<P><EM><FONT face="Times New Roman">Which VK should we use to catch the semicolon?&nbsp;</FONT></EM><EM><FONT face="Times New Roman">&nbsp;</FONT></EM></P>
<P><EM><FONT face="Times New Roman">Since I found no other choices, I simply trap for both VK_OEM_1 and the char ‘;’ but that might be an incomplete solution.</FONT></EM></P>
<P><EM><FONT face="Times New Roman">Do you have any idea what the correct code might be?</FONT></EM></P></BLOCKQUOTE>
<P><FONT face=Tahoma>The answer of course is that there is no one code for the semicolon that spans all of the keyboard layouts.</FONT></P>
<P><FONT face=Tahoma>But I do not blame people for the misunderstanding, at all.</FONT></P>
<P><FONT face=Tahoma>It was over a year ago that I listed out <a href="http://archives.miloush.net/michkap/archive/2004/11/27/270931.html"><STRONG>Some Keyboarding Terms</STRONG></A>, in particular:</FONT></P><FONT face=Tahoma>
<LI><STRONG>Scan code</STRONG> -- The numeric value given to each physical key on a keyboard; the scan code is a hardware-dependent number that identifies the key. Scan codes have a fixed position on the physical keyboard, irregardless of the keyboard layout chosen by the user. 
<LI><STRONG>Virtual Key</STRONG> -- Also called the VK, the code that is given by the Windows USER subsystem to represent a keystroke. It is mapped from a scan code by using the keyboard layout definition and is thus entirely dependent on the user's chosen layout. <FONT color=#ff0000>The reason for this is the [unfortunate, IMHO] choice to have e.g. VK_A to be used for the 'A' key, which meant that on keyboards that put 'A' in a different position the VK would have to be moved.</FONT></FONT> 
<P><FONT face=Tahoma>If you look at the&nbsp;red text in the VK definition, it hints at the problem that causes the confusion.</FONT></P>
<P><FONT face=Tahoma>I mean, since there is a VK_A that represents the letter <STRONG>A</STRONG>, why wouldn't we expect there to be a VK_SEMICIOLON to represent the semicolon, right?</FONT></P>
<P><FONT face=Tahoma>Of course,&nbsp;there are lots of problems with such a model. For example, that semicolon key is also a colon key. Who would win the contest?</FONT></P>
<P><FONT face=Tahoma>And since not every keyboard pairs up the same characters in the various shift states, how would you find the character that was not used for the name?</FONT></P>
<P><FONT face=Tahoma>The real problem is that when a WNDPROC receives a WM_KEYDOWN message with the virtual key VK_OEM1, <EM>it has not received a semicolon</EM>. At all. It has received notification that a parrticular key was pressed, <STRONG>and nothing else</STRONG>. When it receives a VK_A, there is no difference; it is a notification that a key has been pressed. Now the keyboard layout has been asked what is the virtual key, but it has not yet been asked what is the character (and it quite possibly may never be asked).</FONT></P>
<P><FONT face=Tahoma><FONT color=#a9a9a9><STRIKE>If that WNDPROC passes the message to the </FONT><A href="http://msdn.microsoft.com/library/en-us/winui/winui/windowsuserinterface/windowing/windowprocedures/windowprocedurereference/windowprocedurefunctions/defwindowproc.asp"><FONT color=#a9a9a9>DefWindowProc</FONT></A></STRIKE><FONT color=#ff0000><STRONG>If you call the TranslateMessage function</STRONG></FONT>, then the keyboard will be asked what is the character based on all of the information about the current keyboard buffer and the shift state, and a subsequent WM_CHAR message will be sent, which will contain the ";" or the "A" or whatever.</FONT></P>
<P><FONT face=Tahoma>The fact that the values for VK_A through VK_Z are identical to the code points for the letters A - Z is an unfortunate accident since it raises such unrealistic expectations for other characters....</FONT></P>
<P><FONT face=Tahoma>In the end, we are left with two possible options to solve the original problem:</FONT></P>
<UL>
<LI><FONT face=Tahoma>Use the keyboarding APIs to map the virtual key to the character yourself, or</FONT> 
<LI><FONT face=Tahoma>Use the WM_CHAR message rather than the WM_KEYDOWON message</FONT></LI></UL>
<P><FONT face=Tahoma></FONT>&nbsp;</P>
<P><FONT face=Tahoma color=#ff1493><EM>This post brought to you by</EM> "<FONT size=6>;</FONT>" <EM>(U+003b, a.k.a. SEMICOLON)</EM></FONT></P></LI>
<hr/><p><a id="498908" href="#498908">#</a> <strong>orcmid</strong> on Thursday, December 01, 2005 10:36 AM:</p><div style="margin-left: 1em">Wow, two keepers in a row today. (I actually, I keep most of them, but this one is a gem.)<br><br>I need to explain this to people at some point, after using it correctly myself, and this is lovely.  It is interesting how we get screwed up adding too much semantics to what there is.  Distinguishing the key from the character we think the user is intending is powerful stuff.  <br><br>I ran into the user-confusion side of this when messing with language choices without having the right keyboard and not doing the settings right.  It was a mess until I gave up and set everything back to my case.  I'll have to try again some day.</div>
<p><a id="499064" href="#499064">#</a> <strong>Mike Dimmick</strong> on Thursday, December 01, 2005 2:35 PM:</p><div style="margin-left: 1em">*scratches head* I'm sure it's the call to TranslateMessage() that causes the WM_CHAR message to be generated. This is part of the boilerplate message loop that every Windows application includes and it seems few Windows developers really understand!</div>
<p><a id="499086" href="#499086">#</a> <strong>Michael S. Kaplan</strong> on Thursday, December 01, 2005 3:30 PM:</p><div style="margin-left: 1em">Yes, you are correct, it is the TranslateMessage call that does the work here (among other things that the function does)....</div>
<hr/><p><em>referenced by</em></p><div style="margin-left: 1em"><p>2006/07/13 <a href="http://archives.miloush.net/michkap/archive/2006/07/13/664497.html">IME + .NET = Input Madness Editor?</a></p></div><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2005/12/01/498866.html" title="What language to use">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2005/11/30/498616.html" title="Not sure if I am blue, but the Novantrone is!">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2005-12">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2005-12-01">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2005/12/01/498775.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:40 GMT -->
</html>