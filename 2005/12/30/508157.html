<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2005/12/30/508157.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:40 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>More on cursor movement</title></head><body>
<h1>More on cursor movement</h1>
<p><em>by Michael S. Kaplan, published on 2005/12/30 00:01 -08:00, original URI: http://blogs.msdn.com/michkap/archive/2005/12/30/508157.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostOld -->
<P><FONT face=Tahoma>James Brown asked in the microsoft.public.win32.programmer.international and microsoft.public.win32.programmer.gdi newsgroups:</FONT></P>
<BLOCKQUOTE dir=ltr style="MARGIN-RIGHT: 0px">
<BLOCKQUOTE dir=ltr style="MARGIN-RIGHT: 0px">
<P><FONT size=2><EM>Suppose I have the following two Arabic codepoints:</EM></FONT></P>
<P><FONT size=2><EM>U+0648 "arabic letter waw"<BR>U+0650 "arabic letter kasra"</EM></FONT></P>
<P><FONT size=2><EM>These render as a single glyph with Uniscribe</EM></FONT></P>
<P><FONT size=2><EM>When pasted into Notepad, the cursor (and selection highlight) can traverse into the middle of the cluster.</EM></FONT></P>
<P><FONT size=2><EM>When pasted into Wordpad, the cursor _cannot_ move into the middle of these characters.</EM></FONT></P>
<P><FONT size=2><EM>Which is the correct (or desirable) behaviour?</EM></FONT></P>
<P><FONT size=2><EM>Maybe someone can even explain, what significance does it have for the cursor to move into the *middle* of a grapheme cluster - how does the user know which character he/she has selected??</EM></FONT></P>
<P><FONT size=2><EM>thanks,<BR>James </EM></FONT></P></BLOCKQUOTE></BLOCKQUOTE>
<P><FONT face=Tahoma>Excellent question, James!</FONT></P>
<P><FONT face=Tahoma>The desirable behavior is what you are describing as the <STRONG>WordPad</STRONG> behavior, to a point. Although if I paste a string of 12 of these pairs of characters (وِوِوِوِوِوِوِوِوِوِوِوِ) into WordPad, it will treat them as a single unit, which is not what I would call desirable. :-(</FONT></P>
<P><FONT face=Tahoma>The <STRONG>Notepad</STRONG> behavior you describe is also not preferred; in all cases other than the BACKSPACE character (for the reasons I&nbsp;describe <a href="http://archives.miloush.net/michkap/archive/2005/12/21/506248.html">here</A>), you would want to have movement jump the text element boundaries, which would be those two characters you mentioned....</FONT></P>
<P><FONT face=Tahoma>The bad news is that I can reproduce the behavior you describe in Windows Server 2003 SP1:</FONT></P>
<P><IMG src="http://trigeminal.fmsinc.com/images/notepad03.jpg"></P>
<P><FONT face=Tahoma>The worse news is that I can reproduce the WordPad behavior I describe above in Windows Server 2003 SP1 and XP SP2.</FONT></P>
<P><FONT face=Tahoma>But the good news is that in XP SP2, Notepad behaves correctly and the cursor does not appear in the middle of the character....</FONT></P>
<P><FONT face=Tahoma>In IE6,&nbsp;I currently get the character splitting behavior. You can test out your own browser and version&nbsp;with the textbox below -- put the cursor in and move back and forth to see what happens:</FONT></P>
<BLOCKQUOTE dir=ltr style="MARGIN-RIGHT: 0px">
<BLOCKQUOTE dir=ltr style="MARGIN-RIGHT: 0px">
<P><FONT face=Tahoma><INPUT dir=rtl size=25 value=وِوِوِوِوِوِوِوِوِوِوِوِ name=textbox></FONT>&nbsp;</P></BLOCKQUOTE></BLOCKQUOTE>
<P><FONT face=Tahoma>At least products are getting better though (the Vista version of Uniscribe has all of the XP SP2 updates and more!).</FONT></P>
<P><FONT face=Tahoma></FONT>&nbsp;</P>
<P><FONT face=Tahoma color=#ff1493><EM>This post brought to you by</EM> "<FONT size=6>و</FONT>" <EM>(<A href="http://www.fileformat.info/info/unicode/char/0648">U+0648</A>, a.k.a. ARABIC LETTER WAW)</EM></FONT></P>
<hr/><p><a id="508236" href="#508236">#</a> <strong>James Brown</strong> on Friday, December 30, 2005 1:01 PM:</p><div style="margin-left: 1em">A further observation. With Notepad, I can use the mouse to move into the center of the glyph (i.e. between the two codepoints). But when I use the keyboard the caret always moves over the glyph-clusters.<br><br>Strange. The problem is I don't understand the Arabic language so I have no idea if positioning the caret (with mouse) in the middle of the cluster is at all meaningful..<br><br>James</div>
<p><a id="508269" href="#508269">#</a> <strong>Michael S. Kaplan</strong> on Friday, December 30, 2005 2:50 PM:</p><div style="margin-left: 1em">Well, meaningful is a relative term, of course. :-)<br><br>Although I may not expect if you click right in the middle of a cluster that it would respect what I did *that* much (since after all I cannot click in the middle of a U and have that respected.<br><br>Or more to the point, since I cannot click in the middle of &quot;Ů&quot; (U+0055 U+030a), I would not expect it to work for other text elements. The cursor movement is a lot more intuitive than the direct insertion via mouse click....<br><br></div>
<p><a id="508332" href="#508332">#</a> <strong>Michael S. Kaplan</strong> on Friday, December 30, 2005 8:40 PM:</p><div style="margin-left: 1em">For what it is worth, if any testers from typography are around this may be worth putting a bug in, unless I am misunderstanding how it ought to work.... :-)</div>
<p><a id="508364" href="#508364">#</a> <strong>Gabe</strong> on Saturday, December 31, 2005 3:56 AM:</p><div style="margin-left: 1em">This is interesting. Using IE 6.0, I can only click between and select the individual waws. However, using the arrow keys it moves one codepoint for each keypress. This means that I if I press Left once it moves to the middle of the letter waw, then Left again to put the caret between letters. If I hold down shift, it will only select whole graphemes, but I have to press Left twice to get the caret to move.</div>
<p><a id="508374" href="#508374">#</a> <strong>James Brown</strong> on Saturday, December 31, 2005 7:50 AM:</p><div style="margin-left: 1em">Here is IBM's view on things:<br><br><a rel="nofollow" target="_new" href="http://www-306.ibm.com/software/globalization/topics/bidiui/arabic.jsp">http://www-306.ibm.com/software/globalization/topics/bidiui/arabic.jsp</a><br><br>I think what they are saying is that the Notepad behaviour I described is desirable?!!</div>
<p><a id="508402" href="#508402">#</a> <strong>Nick Lamb</strong> on Saturday, December 31, 2005 3:49 PM:</p><div style="margin-left: 1em">I don't think so James, although their choice of example in mentioning Notepad is probably bad.<br><br>A ligature is not the same thing as a character. Look at the squiggle &quot;ﬁ&quot; (fi) in Latin script. It's a typographic convention rather than a basic unit of the language. There's no way for me to type it on this keyboard, but my typesetting software uses it automatically in printed documents when the alternative would be an ugly &quot;near miss&quot; of two alphabetic characters.<br><br>So, the example in this post by Michael is correct, the U+0650 KASRA isn't a separate character, so your cursor should ignore it and you shouldn't be able to select it. But the U+0627 ALEF and U+0644 LAM in the IBM example are separate characters, so you can move the cursor between them even though they're drawn as a single squiggle.<br><br>They're both correct, and there's software out there which gets this right, GTK+ provides default entry and text input controls which do this correctly for example. Presumably if Notepad functions properly in XP SP2 then this means the Windows Common Controls now also get it right. Is that right Michael?</div>
<p><a id="508504" href="#508504">#</a> <strong>Michael S. Kaplan</strong> on Sunday, January 01, 2006 11:21 PM:</p><div style="margin-left: 1em">&quot;Presumably if Notepad functions properly in XP SP2 then this means the Windows Common Controls now also get it right. Is that right Michael?&quot;<br><br>Possibly, Nick -- although I would be afraid to try and predict what the Shell common controls will do on a given day. :-)</div>
<p><a id="508534" href="#508534">#</a> <strong>James Brown</strong> on Monday, January 02, 2006 4:45 AM:</p><div style="margin-left: 1em">I've been doing some more experimentation with Uniscribe and I've found that the two Arabic characters I originally mentioned are in fact rendered as *two* glyphs. Uniscribe does however classify them as a single cluster but they are drawn as two - it just looks as if it is a single character. Perhaps this is what is causing Notepad (and the ScriptString API) to allow the cursor to be placed in the middle?</div>
<p><a id="508551" href="#508551">#</a> <strong>Michael S. Kaplan</strong> on Monday, January 02, 2006 8:22 AM:</p><div style="margin-left: 1em">Hi James,<br><br>If connection points between a latin letter and a diacritic are poorly defined then they will sometimes not appear to be connected at all -- yet we would never think of that as two characters. The behavior in Notepad must have some kind of explicit history....</div>
<p><a id="508616" href="#508616">#</a> <strong>Maurits</strong> on Monday, January 02, 2006 6:32 PM:</p><div style="margin-left: 1em">No character-splitting in Firefox 1.0.7 on Ubuntu.</div>
<p><a id="508619" href="#508619">#</a> <strong>Michael S. Kaplan</strong> on Monday, January 02, 2006 7:01 PM:</p><div style="margin-left: 1em">Neither type of splitting?</div>
<p><a id="509198" href="#509198">#</a> <strong>CN</strong> on Wednesday, January 04, 2006 10:04 AM:</p><div style="margin-left: 1em">What's the story about XP x64? I would imagine that it should be treated like Win2003 SP1 in this matter, but it would be far more interesting if it actually behaves like normal XP.</div>
<p><a id="509202" href="#509202">#</a> <strong>Michael S. Kaplan</strong> on Wednesday, January 04, 2006 10:22 AM:</p><div style="margin-left: 1em">That is an excellent question, CN. I believe it would act more like Server 2003 SP1 since it was built out of that code tree, rather than picking up thre features of XP SP2....</div>
<p><a id="509832" href="#509832">#</a> <strong>Nick Lamb</strong> on Thursday, January 05, 2006 5:09 PM:</p><div style="margin-left: 1em">Today I was able to briefly experiment with WordPad on a PC running XP. The behaviour was most remarkable. The sense of the cursor keys seemed to be reversed in the RTL text?</div>
<p><a id="509835" href="#509835">#</a> <strong>Michael S. Kaplan</strong> on Thursday, January 05, 2006 5:16 PM:</p><div style="margin-left: 1em">Indeed, Nick! And believe it or not, that is what people using RTL languages expect on computers.</div>
<p><a id="510041" href="#510041">#</a> <strong>Nick Lamb</strong> on Friday, January 06, 2006 7:56 AM:</p><div style="margin-left: 1em">&quot;believe it or not, that is what people using RTL languages expect on computers.&quot;<br><br>Your competitors don't seem to agree. The Windows logical-caret is by far easier to implement than the visual caret apparently recommended by Apple (in Mac OS), Sun (in Java) and by the independent i18n teams for projects like GTK+. It's not impossible that they're all relying on an incorrect intuition, but it does seem more likely that the early Windows BiDi code was just lazy...<br></div>
<p><a id="510101" href="#510101">#</a> <strong>Michael S. Kaplan</strong> on Friday, January 06, 2006 11:22 AM:</p><div style="margin-left: 1em">Actually, it mostly means that the others you refer to are not  following the Unicod Bidi algorithm. :-)</div>
<p><a id="510122" href="#510122">#</a> <strong>Nick Lamb</strong> on Friday, January 06, 2006 12:38 PM:</p><div style="margin-left: 1em">How so? A brief scan of UAX #9 doesn't find insertion points, carets/ cursors or any other relevant terminology mentioned...</div>
<p><a id="510128" href="#510128">#</a> <strong>Michael S. Kaplan</strong> on Friday, January 06, 2006 12:48 PM:</p><div style="margin-left: 1em">Ask your average Arabic or Israeli person who uses computers about their preference in regard to logical vs. visual order.<br><br>Visual order is the primitive that came before technology supported their languages, and all of the other matters fall out of respecting logical order.</div>
<p><a id="510160" href="#510160">#</a> <strong>Nick Lamb</strong> on Friday, January 06, 2006 1:47 PM:</p><div style="margin-left: 1em">I don't think that answers my queston Michael. Where does UAX #9 specify the Windows logical-caret rules ? If that's not what you meant, please clarify.<br><br>It seems unlikely that I can find an ample supply of suitable computer users who don't use one of the systems already discussed. You may recall writing an article about this sort of problem recently...</div>
<p><a id="510163" href="#510163">#</a> <strong>Michael S. Kaplan</strong> on Friday, January 06, 2006 1:53 PM:</p><div style="margin-left: 1em">Hi Nick, People who use Hebrew or Arabic think of it with logical ordering. It models the reality of their language -- that their text is right to left. I can't speak for the people using systems that were designed prior to the existence of logical ordering other than to sasy that THEY are the early folks too IMHO lazy to encode correctly who think that spelling a letter backwards is going to somehow be easier. Now the work to handle selection and cart movement is a natural extension to logical odering; the work to do is visually is a natural extension to that IMHO lazy effort to spell things backwards, the one that does not match the way the languages actually work....</div>
<p><a id="510229" href="#510229">#</a> <strong>Nick Lamb</strong> on Friday, January 06, 2006 4:01 PM:</p><div style="margin-left: 1em">&quot;It models the reality of their language -- that their text is right to left.&quot;<br><br>You're being a bit obtuse Michael, the phenomenon we're talking about here is specifically that the left arrow moves right, and vice versa. What I wanted to know was whether there was any basis for this except the historical fact that Microsoft's earliest implementation did this, and the answer seems to be &quot;No&quot;.<br><br>Sure enough, my /mouse cursor/ moves across Arabic text normally, it's only the left and right arrow keys which are swapped. This is actually connected to the original post, internally the software is just tracking cursor position as an offset into a character array, but you can't handle the WAW + KASRA combination this way, and nor can you make the arrow keys work consistently. It also of course produces problems outside the BMP, but we've covered those previously.</div>
<p><a id="510273" href="#510273">#</a> <strong>Michael S. Kaplan</strong> on Friday, January 06, 2006 6:15 PM:</p><div style="margin-left: 1em">My opinion is one that is based on talking to people who use computers for both Arabic and Hebrew as their native language. And they do NOT find it confusing, and in their opinion the visual support *is*.<br><br>I am not being obtuse, but this is obviously a bit too much to try to cover in comments. I will do a new post describing what I am trying to say over the weekend.</div>
<p><a id="512275" href="#512275">#</a> <strong>James Brown</strong> on Thursday, January 12, 2006 6:39 PM:</p><div style="margin-left: 1em">Well I'm still confused about this whole thing :-) I'm now looking at Word 2003 and notice that it has the same behaviour as Notepad. I am using the following Unicode code-point from the Arabic script:<br><br>064a 064f 0633 0627 0648 0650 064a<br><br>I have included a link to 2 GIFs on my site which illustrate this string rendered in Word2003:<br><br><a rel="nofollow" target="_new" href="http://www.catch22.net/tuts/img/a1.gif">http://www.catch22.net/tuts/img/a1.gif</a><br><br>For the image above, I set the &quot;Show Diacritics&quot; option in Word's Complex-Scripts option-page tab. The diacritics (or whatever they are!!) are shown in orange.<br><br><a rel="nofollow" target="_new" href="http://www.catch22.net/tuts/img/a2.gif">http://www.catch22.net/tuts/img/a2.gif</a><br><br>This image shows the mouse-selection has moved half-way into one of the glyph clusters which contains the diacritic. <br><br>With Word, the cursor-keys move cluster-by-cluster. However the mouse allows the caret to be placed in the middle of clusters.<br><br>The low-level Uniscribe functions (ScriptShape, ScriptXtoCP) allow the caret to be placed mid-cluster. I still can't figure out if this is right or not. I'm trying to replicate this behaviour in my unicode text-editor - it's easy to get the caret placed mid-cluster (because that's what Uniscribe always does, I can't seem to tell it not to). The difficulty is rendering the glyph-cluster to appear as two &quot;characters&quot; even though it is really one (using two code-points though)...I have to draw the cluster twice, over the top of each other, using clipping to get the desired effect...its nasty. But someone at Microsoft obviously thinks its right because Word, and any app which uses ScriptString API (that includes Notepad) exhibits this behaviour. Help!<br><br>Michael, would you like to comment on this further?</div>
<p><a id="513129" href="#513129">#</a> <strong>James Brown</strong> on Sunday, January 15, 2006 5:38 PM:</p><div style="margin-left: 1em">ok I'm getting closer to understanding how the caret is getting placed in the middle of a cluster. This is a quote from the MSDN docs on Uniscribe in the section 'Notes on ScriptXtoCP and ScriptCPtoX':<br><br>&quot;Cluster information in the logical cluster array is used to share the width of a cluster of glyphs equally among the logical characters they represent....For Arabic and Hebrew, caret positions are interpolated with clusters.&quot;<br><br>So what this means is, for certain scripts (Arabic+Hebrew I guess!), the caret position is obtained by dividing the cluster-width by the number of code-points which make up that cluster, and the caret is then &quot;snapped&quot; to one of these finer-grain boundaries. I guess this is also how text-renderers know how to draw a selection-highlight part-way through a cluster.<br><br>well I understand the mechanism, but still don't understand why it is necessary to split a discrete cluster into segments like this. Presumably it only makes sense for Arabic+Hebrew.</div>
<hr/><p><em>referenced by</em></p><div style="margin-left: 1em"><p>2008/10/06 <a href="http://archives.miloush.net/michkap/archive/2008/10/06/8977552.html">UCS-2 to UTF-16, Part 4: Talking about the ask</a></p><p>2007/10/19 <a href="http://archives.miloush.net/michkap/archive/2007/10/19/5519516.html">A less intelligent strain of blog spam</a></p><p>2007/01/24 <a href="http://archives.miloush.net/michkap/archive/2007/01/24/1520227.html">Sometimes a WCHAR really *is* just a character....</a></p><p>2006/01/09 <a href="http://archives.miloush.net/michkap/archive/2006/01/09/510654.html">More on cursor support: in Bidi, intuition can be a four letter word</a></p></div><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2005/12/30/508233.html" title="Some thoughts about the Indic keyboard layouts">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2005/12/29/508124.html" title="Best practices for keyboards #0: MSKLC warnings in 1.0/1.1">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2005-12">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2005-12-30">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2005/12/30/508157.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:40 GMT -->
</html>