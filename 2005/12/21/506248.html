<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2005/12/21/506248.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:40 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>BACKSPACE vs. DELETE</title></head><body>
<h1>BACKSPACE vs. DELETE</h1>
<p><em>by Michael S. Kaplan, published on 2005/12/21 04:01 -05:00, original URI: http://blogs.msdn.com/b/michkap/archive/2005/12/21/506248.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostNew -->
<P><FONT face=Tahoma>I have often talked about how awesome I think the <A href="http://lab.msdn.microsoft.com/productfeedback/">MSDN Product Feedback Center</A> is. But I do have to admit that sometimes bugs can kind of get lost....</FONT></P>
<P><FONT face=Tahoma>As an example, Ben Monroe sent me the following via the contact link:</FONT></P>
<BLOCKQUOTE dir=ltr style="MARGIN-RIGHT: 0px">
<BLOCKQUOTE dir=ltr style="MARGIN-RIGHT: 0px">
<P><EM><FONT size=2>Greetings. I enjoy reading your blog. I find many of the issues to be quite interesting. Thanks for your contributions.</FONT></EM></P>
<P><EM><FONT size=2>I reguarly tested and continue to test VS 2005. I came across an issue with surrogate handling. I reported it, but there hasn't been a response in 17 months. Perhaps it has been overlooked. If you have the time or interest, would you please review it or make sure that another capable person sees it?</FONT></EM></P>
<P><EM><FONT size=2>"Backspace of Unicode characters above U+FFFF results in unpaired surrogates"<BR><A href="http://lab.msdn.microsoft.com/ProductFeedback/viewFeedback.aspx?FeedbackId=ffbcc915-2c0d-4f83-9b3c-107a090a4bf3">Bug ID: FDBK10993</A><BR></FONT></EM>(<EM><FONT size=2><A href="http://lab.msdn.microsoft.com/ProductFeedback/viewFeedback.aspx?FeedbackId=ffbcc915-2c0d-4f83-9b3c-107a090a4bf3">http://lab.msdn.microsoft.com/ProductFeedback/viewFeedback.aspx?FeedbackId=ffbcc915-2c0d-4f83-9b3c-107a090a4bf3</A></FONT></EM>)</P>
<P><EM><FONT size=2>Thanks.</FONT></EM></P></BLOCKQUOTE></BLOCKQUOTE>
<P><FONT face=Tahoma>Allow me to apologize, Ben.</FONT></P>
<P><FONT face=Tahoma>No one intentionally meant to be unresponsive, but this particular bug had been reported&nbsp;several different times, by many different people (I saw over a dozen bug reports put in across several product bug databases!).&nbsp;And&nbsp;unfortunately at some point when&nbsp;the bug report was resolved as a duplicate of a duplicate and so on, the follow-up information was not transferred to the active bug report (so the old bug report kept getting your updates but no one knew to look at it anymore since it was not active).</FONT></P>
<P><FONT face=Tahoma>Again, I am sorry about that.</FONT></P>
<P><FONT face=Tahoma>For the primary bug itself, the actual problem is an issue in the core OS control (you can reproduce the issue in Notepad, for example) and the managed controls are really wrappers around the core controls in this case. So the active bug in the "Whidbey" bug database was resolved as an 'external issue' while the&nbsp;bug report was put into the Windows bug database.</FONT></P>
<P><FONT face=Tahoma>Believe it or not, t</FONT><FONT face=Tahoma>he behavior is mostly intentional!</FONT></P>
<P><FONT face=Tahoma>You see, in situations where one is typing digraphs or other compounds that are considered to be a single character to the user even when they are not represented by a single keystroke on the keyboard, the decision to have the DELETE key get rid of the entire text element yet have the BACKSPACE key only remove the last one is an intentional one. A decision that allows you to avoid the frustration of having to retype 2-4 or more characters if you only mis-typed the last one.</FONT></P>
<P><FONT face=Tahoma>However, while this is a reasonable plan of action in most cases,&nbsp;it is obviously not so reasonable in the case of a supplementary character (since it is&nbsp;in most cases&nbsp;unlikely that individual keystrokes are the high and low surrogate code units). And in this case it probably would make more sense to delete both the high and low surrogate rather than just the trailing low surrogate, especially considering the fact that there really is no recovery other than hitting the BACKSPACE again (since the keyboard is unlikely to be made up of individual high and low surrogate code units with one per key). And all of that is ignoring the very real concerns that Ben pointed out about having unpaired surrogates in data streams -- a situation that is definitely best avoided.</FONT></P>
<P><FONT face=Tahoma>The bug&nbsp;in the Windows database&nbsp;was reported fixed&nbsp;a few months ago,&nbsp;but was never marked as resolved (and does not appear to be fixed in the latest build I have installed on my machine, from a few days ago, so it is probably not fixed in the December CTP build, either).</FONT></P>
<P><FONT face=Tahoma>I will keep an eye on this bug in any case, not only to make sure it is fixed but also to make sure the desired behavior for the non-supplementary character scenario is not unintentionally broken.</FONT></P>
<P><FONT face=Tahoma>In any case, I am sorry about how letting you know kind of fell through the cracks. The <A href="http://lab.msdn.microsoft.com/productfeedback/">MSDN Product Feedback Center</A> is still a very awesome resource and at the very least the issue itself was still being tracked. We've got your back on this one!</FONT></P>
<P><FONT face=Tahoma></FONT>&nbsp;</P>
<P><FONT face=Tahoma color=#ff1493><EM>This post brought to you by</EM> "<FONT size=6>êÇÄ</FONT>" <EM>(<A href="http://www.fileformat.info/info/unicode/char/10080">U+10080</A>, a.k.a. LINEAR B IDEOGRAM B100 MAN)</EM></FONT></P>
<hr/><p><a id="506259" href="#506259">#</a> <strong>Anutthara MSFT</strong> on 21 Dec 2005 4:20 AM:</p><div style="margin-left: 1em">Wow - I actually came across this behaviour while testing my product with digraphs and after I thought about it, I was convinced this was by design.<br>But of course, as you pointed out, the supplementary char scenario doesn't make much sense!<br></div>
<p><a id="506325" href="#506325">#</a> <strong>Marc Bernard</strong> on 21 Dec 2005 9:19 AM:</p><div style="margin-left: 1em">&gt; Believe it or not, the behavior is mostly intentional!<br><br>Wow, this might be the first bug to say &quot;this behaviour is mostly by design&quot;.<br><br>:)<br></div>
<p><a id="506368" href="#506368">#</a> <strong>Nick Lamb</strong> on 21 Dec 2005 11:28 AM:</p><div style="margin-left: 1em">Another bug caused by having a &quot;wide character&quot; that is not wide enough for storing characters. It's more or less inevitable that coders trying to use 16-bit integers as a &quot;native&quot; Unicode character will get these cases wrong over and over again and again.<br><br>If I were to go look in MSDN right now, how many examples would I find where there's an implicit assumption that characters fit in a 16-bit Win32 wchar_t ?</div>
<p><a id="506395" href="#506395">#</a> <strong>Michael S. Kaplan</strong> on 21 Dec 2005 12:08 PM:</p><div style="margin-left: 1em">Nick, this is really not the point, since even in UTF-32, what a user sees as a single character may be in fact many Unicode code points.<br><br>For most purposes, buffer lengths are not based on a character count but on a code point count. Supplementary characters being two Uniocde code units is no more of an issue than them being 4 bytes in UTF-8.</div>
<p><a id="506570" href="#506570">#</a> <strong>Ben Monroe</strong> on 21 Dec 2005 8:15 PM:</p><div style="margin-left: 1em">Thank you for the response.<br>I had a feeling that the report got lost somewhere along the lines.<br><br>I am glad that Microsoft is aware of the issue. I understand and agree with your comments on diagraphs. However, surrogates are a result of the chosen encoding (UTF-16) even when they map to a single Unicode scalar value. Unpaired surrogates are a serious concern to data integrity and conformance. I think this may warrant special handling, and I hope to see a resolution of some type in the near future.<br><br>How about defining Backspace to remove a single Unicode scalar value? This should preserve the current behavior designed for diagraphs as well as handling surrogates. It is also independent of the encoding.<br><br>Ben Monroe<br>Tokyo, Japan</div>
<p><a id="506575" href="#506575">#</a> <strong>Michael S. Kaplan</strong> on 21 Dec 2005 8:25 PM:</p><div style="margin-left: 1em">Hi Ben,<br><br>It is unfortunately not that simple -- at the level where these things are determined, there is no knowledge of Unicode scalar values.<br><br>But like I said, the fix should be available in Vista soon (and although Vista is not the first version to support supplementary characters, it is the first version to ship with font and input support for them in the box!).</div>
<p><a id="506579" href="#506579">#</a> <strong>Nick Lamb</strong> on 21 Dec 2005 8:37 PM:</p><div style="margin-left: 1em">&quot;Nick, this is really not the point, since even in UTF-32, what a user sees as a single character may be in fact many Unicode code points. &quot;<br><br>Just so that we're clear, is it your contention that this bug was /not/ caused by the issue I'm describing ? If so, can you show your readers the affected code ?<br><br>Or is it instead that you believe it doesn't matter, that while a different API would avoid this mistake it would make some other type of error more common ?</div>
<p><a id="506597" href="#506597">#</a> <strong>Michael S. Kaplan</strong> on 21 Dec 2005 9:32 PM:</p><div style="margin-left: 1em">My point is that the issue of the &quot;wide character that is not wide enough for storing characters&quot; being treated as a bug in and of itself is a fundamental misunderstanding of the Unicode standard and how it is formulated.<br><br>The issue I am describing is a side effect of the design decision that was made to have the DELETE key and th BACKSPACE key show different behaviors -- a decision that is still obviously not fixed for anyone who creates a Form 'D' keyboard that combined multiple code points on single keystrokes.<br><br>The fix of the supplementary character issue is obviously more critical than the other issue (which is good since of the two it is the one that is more fixable!).<br><br>But worrying about it as if it were a 'size of UTF-16 code units' issue kind of distracts from the actual problem....</div>
<p><strong>Pavel Radzivilovsky</strong> on 6 Dec 2009 12:55 AM:</p><div style="margin-left: 1em"><p>Then you guys mixed two unrelated things together.</p>
<p>Deleting part of a character by backspace is legitimate and may have a meaning.</p>
<p>It should have nothing to do with how many bytes does it take in UTF-16 or other encoding of unicode.</p>
<p>Especially given that UTF-16 will hopefully not survive in Windows - the UI should be designed regardless of underlying text encoding.</p></div>
<p><strong>Michael S. Kaplan</strong> on 6 Dec 2009 7:26 AM:</p><div style="margin-left: 1em"><p>UTF-16 is not going away, so your premise is somewhat faulty Pavel.</p>
</div>
<hr/><p><em>referenced by</em></p><div style="margin-left: 1em"><p>2012/04/27 <a href="http://archives.miloush.net/michkap/archive/2012/04/27/10298345.html">Should considering UTF-16 be harmful be considered harmful?</a></p><p>2008/10/06 <a href="http://archives.miloush.net/michkap/archive/2008/10/06/8977552.html">UCS-2 to UTF-16, Part 4: Talking about the ask</a></p><p>2006/08/11 <a href="http://archives.miloush.net/michkap/archive/2006/08/11/695147.html">Are ligatures supposed to be thought of as 'single characters' ?</a></p><p>2006/06/22 <a href="http://archives.miloush.net/michkap/archive/2006/06/22/643461.html">Things I [don't] like about blogging</a></p><p>2006/06/21 <a href="http://archives.miloush.net/michkap/archive/2006/06/21/641030.html">Give me a break [Char] !</a></p><p>2006/02/17 <a href="http://archives.miloush.net/michkap/archive/2006/02/17/533929.html">What do you get when you combine a base character with a buttload of diacritics?</a></p><p>2005/12/30 <a href="http://archives.miloush.net/michkap/archive/2005/12/30/508157.html">More on cursor movement</a></p></div><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2005/12/21/506427.html" title="New in Windows Vista: updates to clock and calendar">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2005/12/20/506087.html" title="Compatible with WHO?">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2005-12">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2005-12-21">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2005/12/21/506248.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:40 GMT -->
</html>