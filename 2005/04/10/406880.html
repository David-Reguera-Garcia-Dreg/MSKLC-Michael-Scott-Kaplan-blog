<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2005/04/10/406880.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:41 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>What the %#$* is wrong with German sorting?</title></head><body>
<h1>What the %#$* is wrong with German sorting?</h1>
<p><em>by Michael S. Kaplan, published on 2005/04/10 01:25 -07:00, original URI: http://blogs.msdn.com/michkap/archive/2005/04/10/406880.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostOld -->
<P><FONT face=Tahoma><EM>(Apologies to those who are offended by the South Park movie scene that inspired the title of this post!)</EM></FONT></P>
<P><FONT face=Tahoma>About a month ago, Daniel J. Smith asked me something that prompted me to say <a href="http://archives.miloush.net/michkap/archive/2005/03/10/391564.html">Dere are qvestions? In zat <STRONG>case</STRONG>...</A></FONT></P>
<P><FONT face=Tahoma>Then last week, Martin Müller asked in the microsoft.public.dotnet.internationalization:</FONT></P>
<BLOCKQUOTE dir=ltr>
<BLOCKQUOTE dir=ltr>
<P><FONT face=Tahoma size=2><EM>Recently I've stumbled across the fact that the CompareInfo for my default culture de-DE as well as for InvariantCulture considers "ss" and german "ß"&nbsp; (szlig) equivalent, which is not correct!<BR><BR>For example, calling lassen".IndexOf("ß") yields 2 instead of 0.<BR><BR>CultureInfo.InvariantCulture.CompareInfo.Compare("lassen", "laßen") returns 0, which is wrong, too.<BR><BR>Using CompareInfo.IndexOf() without special CompareOptions gives the same&nbsp;incorrect results. When I use CompareOptions.Ordinal, however, IndexOf correctly returns -1 and&nbsp; Compare returns inequality. But CompareOptions.Ordinal cannot be combined with any other flag, so a case&nbsp;insensitive comparison isn't possible this way.<BR><BR>This bug occurrs with IndexOf and Compare of both String and CompareInfo.<BR><BR>Any comment on this or info when this will be fixed?</EM></FONT></P></BLOCKQUOTE></BLOCKQUOTE>
<P><FONT face=Tahoma>Well, I have a comment, but things are working as designed so nothing is going to be "fixed". I will explain....</FONT></P>
<P><FONT face=Tahoma>In the&nbsp;German language, the Sharp S ("ß" or <A href="http://www.fileformat.info/info/unicode/char/00df/index.htm">U+00df</A>) is a lowercase letter, and it capitalizes to the letters "SS". Now Microsoft's casing tables only support simple Unicode casing, which does not include any rules that would change the size of the string such as this one. So doing a "ß".ToUpper() call will not return "SS".</FONT></P>
<P><FONT face=Tahoma>(for more info on those casing rules, see <A href="http://www.unicode.org/Public/UNIDATA/CaseFolding.txt">CaseFolding.txt</A> in the <A href="http://www.unicode.org/ucd/">Unicode Character Database</A>)</FONT></P>
<P><FONT face=Tahoma>But in any case, collation can be a bit more flexible. Since the Sharp S is very much a German letter and not one widely used outside of German, it is included in the default table rules used by all locales (which allows German to be kept in the default table and it will be used by all locales that do not conflict).</FONT></P>
<P><FONT face=Tahoma>But obviously on most locales, "ss" is what uppercases to "SS". Even on German, "ss" would uppercase to "SS". </FONT></P>
<P><FONT face=Tahoma>So it is only logical to assume that in such a case, that if </FONT></P>
<BLOCKQUOTE dir=ltr>
<P><FONT face=Tahoma>"ss".ToUpper() == "ß".ToUpper() == "SS"</FONT></P></BLOCKQUOTE>
<P><FONT face=Tahoma>then</FONT></P>
<BLOCKQUOTE dir=ltr>
<P><FONT face=Tahoma>"ss" <FONT size=3><FONT size=4>≅</FONT> </FONT>"ß"</FONT></P></BLOCKQUOTE>
<P><FONT face=Tahoma>at least for the technical purpose of facilitating the ability to treat these other cases properly.This why on almost all locales (including the invariant locale), "ß" looks so much like "ss".</FONT></P>
<P><FONT face=Tahoma></FONT>&nbsp;</P>
<P><FONT face=Tahoma><FONT color=#ff0000><EM>This post is brought to you by</EM> "ß" </FONT><EM><FONT color=#ff0000>(<A href="http://www.fileformat.info/info/unicode/char/00df/index.htm">U+00df</A>, a.k.a. LATIN SMALL LETTER SHARP S)<BR><FONT size=1>And really, who elase would it be? :-)</FONT></FONT></EM></FONT><FONT face=Tahoma></P></FONT>
<hr/><p><a id="406884" href="#406884">#</a> <strong>Thomas</strong> on Sunday, April 10, 2005 4:51 AM:</p><div style="margin-left: 1em">That's bad. Because &quot;lassen&quot; means &quot;let&quot;; &quot;la&#223;en&quot; is the plural past of &quot;read&quot;<br><br>&quot;ss&quot; ≅ &quot;&#223;&quot; might be logical, but no-one ever claimed that German is a logical language ;)<br><br>Thomas</div>
<p><a id="406887" href="#406887">#</a> <strong>Michael S. Kaplan</strong> on Sunday, April 10, 2005 5:41 AM:</p><div style="margin-left: 1em">Ah, and if someone does a ToUpper() on both words to compare them on a system that does full Unicode casing, they will be identical. And then if that same implementation does a ToLower() on that same string once again then the difference will still be lost.<br><br>Lucky for Germans that Microsoft does not currently do full Unicode casing, huh? :-)</div>
<p><a id="406888" href="#406888">#</a> <strong>Peter Reiter</strong> on Sunday, April 10, 2005 7:05 AM:</p><div style="margin-left: 1em">Thomas,<br>'la&#223;en' is now wrong and is the old orthography. Now you write 'lasen' according to the new otrhography.<br>Therefore, &quot;lassen&quot;.ToUpper() != &quot;lasen&quot;.ToUpper()<br><br>There might be problems with other words though, like &quot;es floss&quot; (== it flowed, from 'flie&#223;en') and &quot;das Flo&#223;&quot; (== the raft)</div>
<p><a id="406939" href="#406939">#</a> <strong>CornedBee</strong> on Sunday, April 10, 2005 2:04 PM:</p><div style="margin-left: 1em">&gt; but things are working as designed<br>Bugs in the design are still bugs. The default collation is not supposed to be case-insensitive, so even treating characters that have the same uppercase form is wrong.<br><br>I'll admit, though, that &#223; is a real problem.<br>Let's take a particularly difficult word, &quot;fun&quot;.<br>Fun translates to &quot;Spa&#223;&quot; or &quot;Spass&quot; - both are correct spelling. &quot;Spa&#223;&quot; would be the de-AT version, &quot;Spass&quot; the de-DE or de-CH version. The reason is as follows:<br>The new rules for &#223; say that it only comes after vowels that are dragged out, or after diphtongs. (eu, au, ...)<br>In most Austrian dialects, &quot;Spa&#223;&quot; is pronounced &quot;shpahs&quot;, dragging out the 'a'. In most German dialects it's pronounced &quot;shpuss&quot;, with a short 'a' that's pronounced as in &quot;fuss&quot;.<br>So suddenly the spelling is different for the two languages.<br>Switzerland doesn't use &#223; at all, so the spelling can only be &quot;Spass&quot;.<br><br>It is not entirely correct to say that &#223; is uppercased to &quot;SS&quot;. Sure, nowadays it is, but not so long ago, the correct uppercase form was &quot;SZ&quot;. There is a distinction between &#223; and ss, even in uppercase, although there it's no longer detectable.<br>As other people pointed out, uppercasing &#223; to SS is a true loss of information. Flo&#223;-floss is just one of many words. Stra&#223;e (street) and Strasse (current head of the political party FP&#214; in Austria) become the same, too. And many others. This loss of information is bound to uppercasing - is it really necessary that collation has the same loss if the string is not uppercased?</div>
<p><a id="406946" href="#406946">#</a> <strong>Michael S. Kaplan</strong> on Sunday, April 10, 2005 2:37 PM:</p><div style="margin-left: 1em">Unfortunately, the architecture does not allow the distinction to be noted in one case and ignored in the other.</div>
<p><a id="406982" href="#406982">#</a> <strong>erich</strong> on Sunday, April 10, 2005 8:39 PM:</p><div style="margin-left: 1em">Another example:<br>&quot;in Massen&quot; means &quot;in huge quantities&quot;<br>&quot;in Ma&#223;en&quot; means &quot;within limits&quot; (i.e. rarely)<br>which is more or less the opposite!<br>They are also pronounced differently - think of &quot;Maasen&quot; for the second one. A general (new) rule is that a sharp s is used after a long vocal, whereas a double s follows a short vocal.<br><br>the first is not used too often, since we have the Term &quot;Massenproduktion&quot; for mass production, which allows to avoid this &quot;kind of ambiguity&quot;, while the second is common use!<br><br>I agree that &#223;=ss when it comes to sorting. But only for sorting, not for comparing!</div>
<p><a id="406999" href="#406999">#</a> <strong>Michael S. Kaplan</strong> on Sunday, April 10, 2005 10:05 PM:</p><div style="margin-left: 1em">Ah, but there is the rub -- sorting *is* comparing....</div>
<p><a id="407091" href="#407091">#</a> <strong>Thomas</strong> on Monday, April 11, 2005 5:41 AM:</p><div style="margin-left: 1em">&gt; Ah, but there is the rub -- sorting *is*<br>&gt; comparing....<br><br>that's not true ;)<br><br>if you ignore uppercase/lowercase when sorting a list it doesn't mean, that AAA and aaa are identical.<br><br>One thing to add:<br>The new German orthography has nothing to do with this Problem. You can't expect, that everybody writes &quot;Spass&quot; instead of &quot;Spa&#223;&quot; because the second might be the wrong way.<br>And there are a lot of old texts, too.<br><br>Imo, the &#223; in uppercase should be &#223;. Afaik the &#223;&lt;-&gt;ss substitution was only for typewriters without this special char. But in times of unicode?<br><br><br>Mr. Kaplan, it's a bug, not a feature ;)<br><br><br>Thomas</div>
<p><a id="407103" href="#407103">#</a> <strong>Michael S. Kaplan</strong> on Monday, April 11, 2005 6:53 AM:</p><div style="margin-left: 1em">I understand you may feel this way on an emotional basis, but is it somwthing you noticed thath as negatively impacted an application?<br><br>It has been in Windows for the last decade, and many people do at least subconsciously accept the equivalence. Sorting *IS* de facto collation and vice versa -- because they are both done via the same data and the same APIs.</div>
<p><a id="407144" href="#407144">#</a> <strong>J. Daniel Smith</strong> on Monday, April 11, 2005 9:46 AM:</p><div style="margin-left: 1em">The problems with<br>   &quot;ss&quot;.ToUpper() == &quot;&#223;&quot;.ToUpper() == &quot;SS&quot;<br>gets back to my original question of more reasons (other than Turkish &quot;i&quot;) to avoid calling ToUpper() (or ToLower()) in code.<br><br>Although as some of the follow-up comments indicate, that doesn't solve all the problems...<br><br>I'm starting to wrap all my strings in classes so that I get more semantic information.  For example, on Windows, filenames should always be compared case-insenstive (but don't upper/lower case as NTFS is case-preserving). I can make operator==() do that for a Pathname class.</div>
<p><a id="407624" href="#407624">#</a> <strong>Rainer Bauer</strong> on Tuesday, April 12, 2005 11:38 AM:</p><div style="margin-left: 1em">The German &#223; in an abreviation of &quot;sz&quot;. So theoretically, the correct uppercase would be &quot;SZ&quot;.</div>
<p><a id="407859" href="#407859">#</a> <strong>Thomas</strong> on Wednesday, April 13, 2005 10:48 AM:</p><div style="margin-left: 1em">Ahh... I like this topic :)<br><br>I had a look in my (old) Duden-dictionary:<br><br>shortened translation:<br><br>If you're going to write &#223; as a capital letter use SS <br>If misunderstanding is possible, use SZ (not for lower case letters)<br><br>Btw: &#223; is a ligature out of the old German type<br><br><a rel="nofollow" target="_new" href="http://de.wikipedia.org/wiki/Bild:Sz_modern.png">http://de.wikipedia.org/wiki/Bild:Sz_modern.png</a><br><br><br>Thomas</div>
<p><a id="414887" href="#414887">#</a> <strong>Carsten &amp;amp;lt;c.posingies@gmx.de&amp;amp;gt;</strong> on Thursday, May 05, 2005 6:09 AM:</p><div style="margin-left: 1em">&gt; Fun translates to &quot;Spa&#223;&quot; or &quot;Spass&quot; - both are correct<br>&gt; spelling. &quot;Spa&#223;&quot; would be the de-AT version,<br>&gt; &quot;Spass&quot; the de-DE or de-CH version.<br><br>I beg my pardon to have to correct you regarding that matter. It seems, Austrians tend to divide Germany into Bavaria and &quot;Rest&quot;. Anyhow, &quot;Spa&#223;&quot; is de-AT and de-DE. Standard German defines &quot;Spa&#223;&quot; as &quot;shpahs&quot;. Anything like &quot;shpus&quot; is dialect, like in Cologne (&quot;Mir hatte' so richtisch Spass!&quot; / &quot;me.ah hut.te so [now it's getting complicated... for the UK folks: pronounce the following &quot;gh&quot; like the &quot;ch&quot; in &quot;Loch Ness&quot;] ree.gh.tish shpus&quot;), and Berlin. <br><br>&gt; The new rules for &#223; say that it only comes after vowels<br>&gt; that are dragged out, or after diphtongs. (eu, au, ...)<br><br>Quite correct, so far. But please don't assume that anything that doesn't sound like Vienesse is Standard German.<br><br>&gt; In most German dialects it's pronounced &quot;shpuss&quot;,<br><br>As I said: not in Standard German.<br><br>&gt; so the spelling can only be &quot;Spass&quot;. <br><br>Wrong. It's still &quot;Spa&#223;&quot;. The challenge starts elsewhere, namely that Standard German isn't exclusive but inclusive. CH doesn't use the &quot;Eszet ligature&quot; at all. They pronounce &quot;Stra&#223;e&quot; as &quot;strahse&quot; but write &quot;Strasse&quot;. They say &quot;spahs&quot; but spell it &quot;Spass&quot;. This spelling is also correct in DE and AT. The other way round, AT and DE spelling is also correct (nevertheless not used) in CH.<br><br>Regarding Microsoft and the .NET-Framework, we have kind of a Gordian knot: &quot;stra&#223;e&quot;.ToUpper() /should/ result in &quot;STRASSE&quot;, but how to deal with &quot;STRASSE&quot;.ToLower()? Not really insolvable, but tricky.</div>
<p><a id="414899" href="#414899">#</a> <strong>Michael S. Kaplan</strong> on Thursday, May 05, 2005 7:38 AM:</p><div style="margin-left: 1em">&gt;&gt;&gt;Regarding Microsoft and the .NET-Framework, we have kind of a Gordian knot: &quot;stra&#223;e&quot;.ToUpper() /should/ result in &quot;STRASSE&quot;, but how to deal with &quot;STRASSE&quot;.ToLower()? Not really insolvable, but tricky.<br><br>Well, the .NET Framework would not really do anything like this until/unless they decided to implement full Unicode casing (right now we just do simple Unicode casing, minus a bunch of characters since we hvae not updated the table in a while).<br><br>But it is a tricky problem. Would people want *all* incidences of SS to be lowercased to &#223;? Or would that also be confusing? This particular issue is one that is easier to do in the collation tables than the casing ones....</div>
<p><a id="430760" href="#430760">#</a> <strong>David</strong> on Monday, June 20, 2005 10:25 AM:</p><div style="margin-left: 1em">As pointed out in an earlier post, &quot;&#223;&quot; is to be treated as &quot;sz&quot; and there is no capitalized version of this letter. That's how it is. Any sorting that claims to sort correctly for the german language and screws this one up is plain broken. It's not a feature, it is a bug.<br>Also mentioned in some comments, the spelling of &quot;Strasse&quot; is common, but inconsitent with the pronounciation rules of the german language. Those state that a vowel before a double consonant is to be pronounced short. That means writing &quot;Strasse&quot; results into pronouncing the &quot;a&quot; short, which gives a word that does not exist in the german language.<br>Replacing &quot;&#223;&quot; with lower case &quot;sz&quot; is the only logical approach, especially when the letter &quot;&#223;&quot; is even called &quot;esszet&quot;. I have no idea wich braindead ignorant came up with &quot;ss&quot; as a replacement for &quot;&#223;&quot;. For example, writing &quot;Stra&#223;e&quot; alternatively as &quot;Strasze&quot; will also not collide with the pronounciation rule as there is no double-consonant and thus the &quot;a&quot; is pronounced longer.<br>German is simple and logical, unless some freaks come along and destroy this language as has happened with the new rule set (the &quot;Schlechtschreibdeform&quot; = &quot;bad writing deformation&quot;).</div>
<p><a id="430763" href="#430763">#</a> <strong>Michael S. Kaplan</strong> on Monday, June 20, 2005 10:32 AM:</p><div style="margin-left: 1em">There is certainly no shortage of passionate opinions here....</div>
<p><a id="6817829" href="#6817829">#</a> <strong>Tanveer Badar</strong> on Thursday, December 20, 2007 9:53 AM:</p><div style="margin-left: 1em"><p>I think you intended to write</p>
<p>For example, calling lassen&quot;.IndexOf(&quot;&#223;&quot;) yields 2 instead of -1.</p>
<p>instead of</p>
<p>For example, calling lassen&quot;.IndexOf(&quot;&#223;&quot;) yields 2 instead of 0.</p>
<p>Sorry about so many instead of.</p></div>
<p><a id="6818935" href="#6818935">#</a> <strong>Michael S. Kaplan</strong> on Thursday, December 20, 2007 12:08 PM:</p><div style="margin-left: 1em"><p>????</p>
<p>I was quoting someone else, who (as I pointed out) was mistaken anyway....</p></div>
<hr/><p><em>referenced by</em></p><div style="margin-left: 1em"><p>2010/03/15 <a href="http://archives.miloush.net/michkap/archive/2010/03/15/9974423.html">Thus the problems resist solution, and the workarounds are often inadequate</a></p><p>2009/07/29 <a href="http://archives.miloush.net/michkap/archive/2009/07/29/9851698.html">Every character has a story #33: U+1e9e (CAPITAL SHARP S, Microsoft edition - Part 2)</a></p><p>2008/02/24 <a href="http://archives.miloush.net/michkap/archive/2008/02/24/7864631.html">The idea has to do more than just make sense to me (aka How S-Sharp are *you* feeling today?)</a></p><p>2007/08/24 <a href="http://archives.miloush.net/michkap/archive/2007/08/24/4536979.html">Every character has a story #28: U+1e9e (CAPITAL SHARP S)</a></p><p>2007/05/05 <a href="http://archives.miloush.net/michkap/archive/2007/05/05/2430935.html">All right, mistakes were made #2 (What the %#$* is wrong with German Phonebook sorting?)</a></p><p>2005/12/14 <a href="http://archives.miloush.net/michkap/archive/2005/12/14/503674.html">It may seem like a bug, but it is not....</a></p><p>2005/11/22 <a href="http://archives.miloush.net/michkap/archive/2005/11/22/495033.html">More on the fabled EqualString</a></p><p>2005/11/13 <a href="http://archives.miloush.net/michkap/archive/2005/11/13/491646.html">Hungarian is even more complicated than I thought</a></p><p>2005/09/25 <a href="http://archives.miloush.net/michkap/archive/2005/09/25/473632.html">Every character has a story #15: CAPITAL SHARP S (not encoded)</a></p></div><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2005/04/11/407107.html" title="It is all about making sure developers respect the user&#39;s preferences">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2005/04/09/406841.html" title="Feline Update, and See You at the Show">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2005-04">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2005-04-10">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2005/04/10/406880.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:41 GMT -->
</html>