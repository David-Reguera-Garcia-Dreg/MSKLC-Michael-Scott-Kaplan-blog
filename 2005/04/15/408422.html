<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2005/04/15/408422.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:41 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>From Win32 to .NET (and vice versa)</title></head><body>
<h1>From Win32 to .NET (and vice versa)</h1>
<p><em>by Michael S. Kaplan, published on 2005/04/15 05:45 -04:00, original URI: http://blogs.msdn.com/b/michkap/archive/2005/04/15/408422.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostNew -->
<P><FONT face=Tahoma>Charts like the one in </FONT><a href="http://archives.miloush.net/michkap/archive/2005/02/27/381189.html"><FONT face=Tahoma color=#0000ff><STRONG>Some suggested updates to the Win32--&gt;.NET mapping for NLS functions</STRONG></FONT></A><FONT face=Tahoma>&nbsp;are kind of amusing when you take the context in which the System.Gloablization class was conceived.</FONT></P>
<P><FONT face=Tahoma>Internationalization in Windows did not really exist way back in the days of 16-bit Windows, and when all of that code was written back in the early days, all of the expert advice that came from linguists and&nbsp;standards experts went into the pot. But&nbsp;mistakes were still made and not everything was done in the way&nbsp;we might do it today if we had&nbsp;the choice to do it all overe again. If you know what I mean.</FONT></P>
<P><FONT face=Tahoma>Back before the 1.0 version of the .NET Framework shipped, it all started as an interesting "What if there was no legacy, how would we support internationalization knowing everything we do now?" </FONT></P>
<P><FONT face=Tahoma>Julie Bennett (based on meetings with John McConnell and others) put together an interesting spec that laid out the way such a framework would work. This spec is the very spec that I had found that made we want to meet with her and talk about Globalization support in .NET that I mentioned in <a href="http://archives.miloush.net/michkap/archive/2005/02/12/371650.html"><STRONG>Why/how MSLU came to be, and more</STRONG></A>&nbsp;that led to me getting my first contract with this group.</FONT></P>
<P><FONT face=Tahoma>It describes a lot of what actually became the <A href="http://msdn.microsoft.com/library/en-us/cpref/html/frlrfsystemglobalization.asp">System.Globalization</A> classes in the .NET Framework. That big "What if?" discussion document made many interesting changes that do make a lot more sense.</FONT></P>
<P><FONT face=Tahoma>Yesterday I was talking to a developer working on the Longhorn project who was trying to work on our support of the way Longhorn will consume the results of Whidbey's <A href="http://msdn2.microsoft.com/library/b08z9aad(en-us,vs.80).aspx">CultureAndRegionInfoBuilder class</A>&nbsp;(which as discussed earlier will pave the way to how locales will be able to be customized in Longhorn) and was baffled at why a certain bit of code would not return the right results. Until he found the documentation of <A href="http://msdn.microsoft.com/library/en-us/cpref/html/frlrfsystemglobalizationnumberformatinfoclassnumbergroupsizestopic.asp">NumberFormatInfo.NumberGroupSizes</A>&nbsp;and looked at the remarks:</FONT></P><FONT face=Tahoma>
<BLOCKQUOTE dir=ltr>
<P><FONT size=2><EM>Every element in the one-dimensional array must be an integer from 1 through 9. The last element can be 0.</EM></FONT></P>
<P><FONT size=2><EM>The first element of the array defines the number of elements in the least significant group of digits immediately to the left of the </EM></FONT><A href="http://msdn.microsoft.com/library/en-us/cpref/html/frlrfsystemglobalizationnumberformatinfoclassnumberdecimalseparatortopic.asp"><FONT size=2><EM>NumberDecimalSeparator</EM></FONT></A><FONT size=2><EM>. Each subsequent element refers to the next significant group of digits to the left of the previous group. If the last element of the array is not 0, the remaining digits are grouped based on the last element of the array. If the last element is 0, the remaining digits are not grouped<STRONG>.</STRONG></EM></FONT></P>
<P><FONT size=2><EM>For example, if the array contains { 3, 4, 5 }, the digits will be grouped similar to "55,55555,55555,55555,4444,333.00". If the array contains { 3, 4, 0 }, the digits will be grouped similar to "55555555555555555,4444,333.00".</EM></FONT></P></BLOCKQUOTE></FONT>
<P><FONT face=Tahoma>And compared that to the documentation he already knew about from the <A href="http://msdn.microsoft.com/library/en-us/wceinternational5/html/wce50lrfgetlocaleinfo.asp">GetLocaleInfo</A> topic in Windows and its link to <A href="http://msdn.microsoft.com/library/en-us/intl/nls_8rse.asp">Locale Information</A>&nbsp;that discusses the LCTypes, specifically the one on LOCALE_SGROUPING:</FONT></P>
<BLOCKQUOTE dir=ltr>
<P><FONT face=Tahoma size=2><EM>Sizes for each group of digits to the left of the decimal. An explicit size is needed for each group, and sizes are separated by semicolons. If the last value is zero, the preceding value is repeated<STRONG>. </STRONG>For example, to group thousands, specify 3;0. Indic locales group the first thousand and then group by hundreds, for example 12,34,56,789, which is represented by 3;2;0. </EM></FONT></P></BLOCKQUOTE>
<P><FONT face=Tahoma>Note the change -- the .NET Framework says "<EM>If the last element is 0, the remaining digits are not grouped</EM>" while in Windows it&nbsp;says "<EM>If the last value is zero, the preceding value is repeated</EM>". Aha! or maybe Eureka! The way to make the code work becomes clear....</FONT></P>
<P><FONT face=Tahoma>Now by any objective standard, this is a good change, made in the sober spirit of "what if we could do it all over again?" but it is still a bit jarring when you have to come back and put them side by side. Either because you are building a big table that tells you how to take a Win32 API and find its .NET Framework equivalent, or because you are working on code to consume the .NET Framework's format in Win32. Either way you understand both why it changed, the terrible freedom you have when you do not have a legacy support issue, and how embarrasing the old ways were, even though they worked quite well for over a decade....</FONT></P>
<P><FONT face=Tahoma>Yet somehow it does not feel all that embarrassing to me to put them both up, side by side. It feels quite liberating to admit you are wrong, especially when</FONT></P>
<OL>
<LI><FONT face=Tahoma>The "wrong" solution still works just fine, thank you;</FONT> 
<LI><FONT face=Tahoma>The "right" solution exists now, or will exist soon;</FONT> 
<LI><FONT face=Tahoma>We are the team responsible for both;</FONT> 
<LI><FONT face=Tahoma>There are sensible reasons for both to exist as they do;</FONT> 
<LI><FONT face=Tahoma>It comes up in the context of both <EM>opening it all up</EM> and <EM>getting out of the way</EM>.</FONT></LI></OL>
<P><FONT face=Tahoma>That is, quite simply, awesome. Both as a legacy and as a future direction.</FONT></P>
<P><FONT face=Tahoma></FONT>&nbsp;</P>
<P><FONT face=Tahoma><FONT color=#ff0000><EM>This post brought to you by</EM> "Ä‚" </FONT><EM><FONT color=#ff0000>(<A href="http://www.fileformat.info/info/unicode/char/0102/index.htm">U+0102</A>, LATIN CAPITAL LETTER A WITH BREVE)<BR><FONT size=1>Who, after seeing yesterday' sponsorship by "A" wanted to point out that it is more than just an "A" -- it is like an "A+", as it were!</FONT></FONT></EM></FONT></P>
<hr/><p><a id="408599" href="#408599">#</a> <strong>Mihai</strong> on 15 Apr 2005 11:46 AM:</p><div style="margin-left: 1em">Two proposed changes/additions:<br>1. If the .NET 2.0 API is not 100% frozen and I am not too late: I think there is a need of a function to tell if a culture uses a right to left script or not.<br>It is quite common to change the CurrentUICulture, but if there are special things you need to do (like deciding if you need to mirror images or not), you need to know if the culture is RTL or not. Sure, you can have a value in your resource file, but why?<br>2. Use full Unicode name when describing the sponsoring character. Otherwise they may get upset:<br>0102, LATIN CAPITAL LETTER A WITH BREVE<br>04D0, CYRILLIC CAPITAL LETTER A WITH BREVE<br>So &quot;CAPITAL LETTER A WITH BREVE&quot; is not quite good enough :-)</div>
<p><a id="408638" href="#408638">#</a> <strong>Michael S. Kaplan</strong> on 15 Apr 2005 1:10 PM:</p><div style="margin-left: 1em">For #1, a new TextInfo.IsRightToLeft property was added. See <a rel="nofollow" target="_new" href="http://msdn2.microsoft.com/library/6efd9x7h">http://msdn2.microsoft.com/library/6efd9x7h</a>(en-us,vs.80).aspx for details.<br><br>For #2, a slip of the typing, fixed now. :-)</div>
<hr/><p><em>referenced by</em></p><div style="margin-left: 1em"><p>2006/05/18 <a href="http://archives.miloush.net/michkap/archive/2006/05/18/601531.html">Where are the other Tamils?</a></p><p>2006/03/20 <a href="http://archives.miloush.net/michkap/archive/2006/03/20/555288.html">Practical Uses for Replacement Cultures/Locales</a></p></div><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2005/04/15/408474.html" title="Instead of a &#39;blue screen&#39;, I am waiting for the blue screen">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2005/04/14/408239.html" title="Comments work here (though not so you&#39;d really notice or anything)">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2005-04">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2005-04-15">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2005/04/15/408422.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:41 GMT -->
</html>