<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2005/04/25/411657.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:41 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>Limiting the languages of input</title></head><body>
<h1>Limiting the languages of input</h1>
<p><em>by Michael S. Kaplan, published on 2005/04/25 07:10 -04:00, original URI: http://blogs.msdn.com/b/michkap/archive/2005/04/25/411657.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostNew -->
<P><FONT face=Tahoma>Windows 2000, XP, and Server 2003 have powerful support for the input of text. On a per thread level, you can designate the support of any language you want, whatsoever.</FONT></P>
<P><FONT face=Tahoma>For some applications, this is not so good. One may want to block the ability to change the language.</FONT></P>
<P><FONT face=Tahoma>The first line of defense in such cases is to cancel any attempt to change the input language to any language you do not like, either </FONT></P>
<UL>
<LI><FONT face=Tahoma>in the <A href="http://msdn.microsoft.com/library/en-us/winui/winui/windowsuserinterface/windowing/windows/windowreference/windowmessages/wm_inputlangchangerequest.asp">WM_INPUTLANGCHANGEREQUEST</A> notification in Win32 (if you never pass it through to the <A href="http://msdn.microsoft.com/library/en-us/winui/winui/windowsuserinterface/windowing/windowprocedures/windowprocedurereference/windowprocedurefunctions/defwindowproc.asp">DefWindowProc</A> then you are saying that you do not like the idea of such a change) </FONT>
<LI><FONT face=Tahoma>in the <A href="http://msdn.microsoft.com/library/en-us/cpref/html/frlrfsystemwindowsformsformclassinputlanguagechangingtopic.asp">Form.InputLanguageChanging</A>&nbsp;event in WinForms in the .NET Framework (if you set to true the <A href="http://msdn.microsoft.com/library/en-us/cpref/html/frlrfsystemcomponentmodelcanceleventargsclasscanceltopic.asp">InputLanguageChangingEvntArgs.Cancel</A>&nbsp;then you are telling it to not make the change)</FONT></LI></UL>
<P><FONT face=Tahoma>This method is not so useful if the language needs to be limited for some fields but not for others. Say for example in a password field, if you wanted to block the IME since allowing an IME would allow people to view the password that you are masking. Or if you want to make sure the language is not the wrong one to being with. In those cases, you have to be a bit more clever. When you enter a control that needs the limitation, you can check the current input language, either</FONT></P>
<UL>
<LI><FONT face=Tahoma>via a <A href="http://msdn.microsoft.com/library/en-us/winui/winui/windowsuserinterface/userinput/keyboardinput/keyboardinputreference/keyboardinputfunctions/getkeyboardlayout.asp">GetKeyboardLayout</A>(NULL) call in Win32</FONT> 
<LI><FONT face=Tahoma>even better (to avoid <a href="http://archives.miloush.net/michkap/archive/2005/04/17/409032.html">HKL/KLID differences</A>), use a <A href="http://msdn.microsoft.com/library/en-us/winui/winui/windowsuserinterface/userinput/keyboardinput/keyboardinputreference/keyboardinputfunctions/getkeyboardlayoutname.asp">GetKeyboardLayoutName</A> call, to keep people in Win32 from masking their language intent</FONT> 
<LI><FONT face=Tahoma>via an <A href="http://msdn.microsoft.com/library/en-us/cpref/html/frlrfsystemwindowsformsinputlanguageclasscurrentinputlanguagetopic.asp">InputLanguage.CurrentInputLanguage</A>.Culture property retrievel in WinForms in the .NET Framework</FONT> 
<LI><FONT face=Tahoma>even better (to avoid <a href="http://archives.miloush.net/michkap/archive/2005/04/17/409032.html">HKL/KLID differences</A>), use a <A href="http://msdn.microsoft.com/library/en-us/winui/winui/windowsuserinterface/userinput/keyboardinput/keyboardinputreference/keyboardinputfunctions/getkeyboardlayoutname.asp">GetKeyboardLayoutName</A> p/invoke call, to keep&nbsp;people from masking their language intent in managed applications</FONT></LI></UL>
<P><FONT face=Tahoma>These methods allow you to sniff the input language and/or the actual keyboard being used, and if you do not like the current choice you can change it, either</FONT></P>
<UL>
<LI><FONT face=Tahoma>via an <A href="http://msdn.microsoft.com/library/en-us/winui/winui/windowsuserinterface/userinput/keyboardinput/keyboardinputreference/keyboardinputfunctions/activatekeyboardlayout.asp">ActivateKeyboardLayout</A> or <A href="http://msdn.microsoft.com/library/en-us/winui/winui/windowsuserinterface/userinput/keyboardinput/keyboardinputreference/keyboardinputfunctions/loadkeyboardlayout.asp">LoadKeyboardLayout</A> call on Windows</FONT> 
<LI><FONT face=Tahoma>via setting the <A href="http://msdn.microsoft.com/library/en-us/cpref/html/frlrfsystemwindowsformsinputlanguageclasscurrentinputlanguagetopic.asp">InputLanguage.CurrentInputLanguage</A>&nbsp;or p/invoke to <A href="http://msdn.microsoft.com/library/en-us/winui/winui/windowsuserinterface/userinput/keyboardinput/keyboardinputreference/keyboardinputfunctions/loadkeyboardlayout.asp">LoadKeyboardLayout</A>&nbsp;in the .NET Framework</FONT></LI></UL>
<P><FONT face=Tahoma>to change the input language to one that is more acceptable to the application.</FONT></P>
<P><FONT face=Tahoma>Make sure there is some indication to the user that the change has been made; it is very unintuitive to&nbsp;make the change without telling the user, since they may type thunking the input language has not changed, and the results will not meet with their expectations.</FONT></P>
<P><FONT face=Tahoma>It is probably a really good idea to cache the <A href="http://msdn.microsoft.com/library/en-us/winui/winui/windowsuserinterface/userinput/keyboardinput/keyboardinputreference/keyboardinputfunctions/getkeyboardlayout.asp">GetKeyboardLayout</A> or <A href="http://msdn.microsoft.com/library/en-us/cpref/html/frlrfsystemwindowsformsinputlanguageclasscurrentinputlanguagetopic.asp">InputLanguage.CurrentInputLanguage</A>&nbsp;results so that you can switch back to the original input language when they leave the control that needs the restriction (a temporary change is sometimes unintuitive, but at least explainable; not changing it back is not only unintuitive but also a little bit obnoxious for an application to do!).</FONT></P>
<P><FONT face=Tahoma></FONT>&nbsp;</P>
<P><FONT face=Tahoma><FONT color=#ff0000><EM>This post brought to you by</EM> "à¸¿" <EM>(<A href="http://www.fileformat.info/info/unicode/char/0e3f/index.htm">U+0e3f</A>, a.k.a. THAI CURRENCY SYMBOL BAHT)</EM></FONT></FONT></P>
<hr/><div style="margin-left: 1em"><em>no comments</em></div><hr/><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2005/04/25/411861.html" title="Speaking gig tonight (April 25) in Cleveland, OH, USA">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2005/04/24/411512.html" title="Immoral? Illegal? Who can say? Well, I will!">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2005-04">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2005-04-25">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2005/04/25/411657.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:41 GMT -->
</html>