<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2005/04/29/413366.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:41 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>Where did the new StringInfo stuff come from?</title></head><body>
<h1>Where did the new StringInfo stuff come from?</h1>
<p><em>by Michael S. Kaplan, published on 2005/04/29 02:36 -07:00, original URI: http://blogs.msdn.com/michkap/archive/2005/04/29/413366.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostOld -->
<P><FONT face=Tahoma>I used it in a very confusing and obfuscated way in <a href="http://archives.miloush.net/michkap/archive/2005/02/07/368570.html">Normalization as obfuscation in C#</A>. And then yesterday I used it again in my <a href="http://archives.miloush.net/michkap/archive/2005/04/28/413019.html">internationally savvy palindrome checker</A>,&nbsp;in a slightly more intuitive manner.</FONT></P>
<P><FONT face=Tahoma>It is the all new <A href="http://msdn2.microsoft.com/library/k0hkw6hw(en-us,vs.80).aspx">StringInfo class</A>&nbsp;in Whidbey.</FONT></P>
<P><FONT face=Tahoma>Now the old StringInfo&nbsp;class had only static methods -- in other words it was a walking FxCop violation. </FONT></P>
<P><FONT face=Tahoma>And the main method it had was <A href="http://msdn2.microsoft.com/library/2wayc3ak(en-us,vs.80).aspx">StringInfo.ParseCombiningCharacters</A>, which was a static method that would take a string and return an array of int values, each one of which would be an index into that string that showed where a new text element was started. A text element could be a single letter, a letter and a diacritic, a letter and a bunch of diacritics, a hugh and low surrogate representing a surrogat pair, etc.</FONT></P>
<P><FONT face=Tahoma><A href="http://msdn2.microsoft.com/library/2wayc3ak(en-us,vs.80).aspx">ParseCombiningCharacters</A>&nbsp;is an incredibly useful method, but it is not very intuitive to use, certainly not and use effectively. The same goes for the other methods for dealing with text elements (<A href="http://msdn2.microsoft.com/library/h7sfzs77(en-us,vs.80).aspx">GetTextElementEnumerator</A>&nbsp;and <A href="http://msdn2.microsoft.com/library/9bzba16b(en-us,vs.80).aspx">GetNextTextElement</A>) -- people were just getting confused.</FONT></P>
<P><FONT face=Tahoma>But people have no problem understanding the need to be able to count entities based on what a typical user might think a character is. Once one explains what a text element is, they immediately understand the need for ways to make use of them.</FONT></P>
<P><FONT face=Tahoma>So we had&nbsp;some meetings to talk about how to make the ways to work with text elements more intuitive, at least as intuitive as the concept of a text element itself. </FONT><FONT face=Tahoma>In the last of those meetings,&nbsp;someone pointed out that people usually had no problem understanding the semantic of the <A href="http://msdn.microsoft.com/library/en-us/cpref/html/frlrfsystemstringclasssubstringtopic.asp">Substring</A> method or the <A href="http://msdn.microsoft.com/library/en-us/cpref/html/frlrfsystemstringclasslengthtopic.asp">Length</A> property of <A href="http://msdn.microsoft.com/library/en-us/cpref/html/frlrfsystemstringclasstopic.asp">System.String</A>. Maybe we could learn a lesson from that? </FONT></P>
<P><FONT face=Tahoma>And viola, the <A href="http://msdn2.microsoft.com/library/xd61233b(en-us,vs.80).aspx">SubstringByTextElements</A>&nbsp;method and the&nbsp;<A href="http://msdn2.microsoft.com/library/d91zb9d8(en-us,vs.80).aspx">LengthInTextElements</A> property were born! </FONT></P>
<P><FONT face=Tahoma>Each behaves just like their cousins, the <A href="http://msdn.microsoft.com/library/en-us/cpref/html/frlrfsystemstringclasssubstringtopic.asp">Substring</A> method and the <A href="http://msdn.microsoft.com/library/en-us/cpref/html/frlrfsystemstringclasslengthtopic.asp">Length</A> property, but rather than being based on UTF-16 code points, they are based on text elements, or what the user might reasonably point to and call a character. The same thing that the Win32 <A href="http://msdn.microsoft.com/library/en-us/winui/winui/windowsuserinterface/resources/strings/stringreference/stringfunctions/charnext.asp">CharNext</A> and <A href="http://msdn.microsoft.com/library/en-us/winui/winui/windowsuserinterface/resources/strings/stringreference/stringfunctions/charprev.asp">CharPrev</A> functions do (at least, when we have not <a href="http://archives.miloush.net/michkap/archive/2005/01/30/363420.html">accidentally broken them</A>!).</FONT></P>
<P><FONT face=Tahoma>Now the method and property are useless if there is not some object that they can hang off of which has the string. People were leery about adding them directly to <A href="http://msdn.microsoft.com/library/en-us/cpref/html/frlrfsystemstringclasstopic.asp">System.String</A>&nbsp;since they really want to try keep that object as lightweight as they can (and some would even say they are not trying hard enough on that). </FONT><FONT face=Tahoma>That's when somebody remembered this class you could instantiate yet had no instance methods, this FxCop violation with a hat. And we added a <A href="http://msdn2.microsoft.com/library/7d52h2w5(en-us,vs.80).aspx">constructor that takes a string</A> and a <A href="http://msdn2.microsoft.com/library/fat5c4af(en-us,vs.80).aspx">StringInfo.String</A> property to retrieve the string later if you wanted or change it without having to tear down the object.</FONT></P>
<P><FONT face=Tahoma>Now we were rolling....</FONT></P>
<P><FONT face=Tahoma>Internally, it just uses that incredibly useful but not-so-intuitive <A href="http://msdn2.microsoft.com/library/2wayc3ak(en-us,vs.80).aspx">StringInfo.ParseCombiningCharacters</A>&nbsp;and stores that&nbsp;System.Int32 array. That makes <A href="http://msdn2.microsoft.com/library/d91zb9d8(en-us,vs.80).aspx">StringInfo.LengthInTextElements</A>&nbsp;a simple call to Length on the array, and <A href="http://msdn2.microsoft.com/library/xd61233b(en-us,vs.80).aspx">StringInfo.SubstringByTextElements</A>&nbsp;is a simple tip-toe through the array, using the very start and length parameters that the method&nbsp;contains in order&nbsp;to know where and how far to go. So we get to be intuitive and pretty fast at the same time. and we get to get rid of that FxCop issue, to boot. Everybody wins!</FONT></P>
<P><FONT face=Tahoma></FONT>&nbsp;</P>
<P><FONT face=Tahoma><FONT color=#ff0000><EM>This post brought to you by</EM> "¾" <EM>(<A href="http://www.fileformat.info/info/unicode/char/00be/index.htm">U+00be</A>, a.k.a. VULGAR FRACTION THREE QUARTERS)</EM></FONT></P></FONT>
<hr/><p><a id="413406" href="#413406">#</a> <strong>Maurits</strong> on Friday, April 29, 2005 8:13 AM:</p><div style="margin-left: 1em">Much more intuitive, good job!<br>I don't have Whidbey Beta 2, so I'll have to reverse-engineer LengthInTextElements and SubstringByTextElements.</div>
<p><a id="413427" href="#413427">#</a> <strong>Srikanth</strong> on Friday, April 29, 2005 9:23 AM:</p><div style="margin-left: 1em">One another great article!<br>Keep doing..<br><br>Thanks</div>
<p><a id="413442" href="#413442">#</a> <strong>Michael S. Kaplan</strong> on Friday, April 29, 2005 10:07 AM:</p><div style="margin-left: 1em">Or you could just get Beta 2. :-)</div>
<p><a id="413486" href="#413486">#</a> <strong>Wayne Steele</strong> on Friday, April 29, 2005 12:20 PM:</p><div style="margin-left: 1em">OK, smart guy, so what happens for code points that contain more than one text element?</div>
<p><a id="413519" href="#413519">#</a> <strong>Michael S. Kaplan</strong> on Friday, April 29, 2005 1:24 PM:</p><div style="margin-left: 1em">Not sure I understand, Wayne -- a text element is made up of one or more code points. We never divide code points into multiple text elements.</div>
<p><a id="413568" href="#413568">#</a> <strong>Maurits</strong> on Friday, April 29, 2005 3:56 PM:</p><div style="margin-left: 1em">I think Wayne's thinking of things like ﬂ (that's fl in one grapheme) - these are ONE TEXT ELEMENT.<br><br>See my recent update:<br><br><a rel="nofollow" target="_new" href="http://channel9.msdn.com/ShowPost.aspx?PostID=63297">http://channel9.msdn.com/ShowPost.aspx?PostID=63297</a></div>
<p><a id="413592" href="#413592">#</a> <strong>Maurits</strong> on Friday, April 29, 2005 5:43 PM:</p><div style="margin-left: 1em">Ah, found the codepoint for the fl ligature:<br><a rel="nofollow" target="_new" href="http://www.fileformat.info/info/unicode/char/fb02/index.htm">http://www.fileformat.info/info/unicode/char/fb02/index.htm</a></div>
<p><a id="413635" href="#413635">#</a> <strong>Michael S. Kaplan</strong> on Friday, April 29, 2005 9:01 PM:</p><div style="margin-left: 1em">You can use Unicode Normalization to fold out that ligature into more than one unique text element. Normalization form KC does the trick nicely. :-)<br><br>Now I would not tend to agree with your assessment of sort elements as being letters, FWIW. They are not relly thought of in that way.</div>
<hr/><p><em>referenced by</em></p><div style="margin-left: 1em"><p>2008/12/09 <a href="http://archives.miloush.net/michkap/archive/2008/12/09/9187379.html">UCS-2 to UTF-16, Part 8: It's the end of the string as we know it (and I feel ellipses)</a></p><p>2008/11/24 <a href="http://archives.miloush.net/michkap/archive/2008/11/24/9134826.html">UCS-2 to UTF-16, Part 6: An exercise left for whoever needs some exercise</a></p><p>2008/09/18 <a href="http://archives.miloush.net/michkap/archive/2008/09/18/8956650.html">UCS-2 to UTF-16, Part 3: It starts with cursor movement (where MS simultaneously gets better and worse)</a></p><p>2008/07/24 <a href="http://archives.miloush.net/michkap/archive/2008/07/24/8768909.html">When you assess, you make an...</a></p><p>2007/05/09 <a href="http://archives.miloush.net/michkap/archive/2007/05/09/2497106.html">Sometimes you need more than StringInfo</a></p><p>2007/03/04 <a href="http://archives.miloush.net/michkap/archive/2007/03/04/1806219.html">String Indexing?</a></p><p>2006/11/10 <a href="http://archives.miloush.net/michkap/archive/2006/11/10/1053925.html">Some people feel really insecure about the size of their [string] members</a></p><p>2005/06/15 <a href="http://archives.miloush.net/michkap/archive/2005/06/15/429279.html">Once more into the palindrome</a></p></div><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2005/04/29/413553.html" title="Getting enough exercise?">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2005/04/28/413019.html" title="Looking for that internationally savvy palindrome checker....">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2005-04">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2005-04-29">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2005/04/29/413366.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:41 GMT -->
</html>