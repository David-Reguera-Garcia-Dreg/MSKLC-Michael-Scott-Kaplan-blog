<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2005/04/13/407823.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:41 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>Invariant and Ordinal Redux</title></head><body>
<h1>Invariant and Ordinal Redux</h1>
<p><em>by Michael S. Kaplan, published on 2005/04/13 09:19 -04:00, original URI: http://blogs.msdn.com/b/michkap/archive/2005/04/13/407823.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostNew -->
<P><FONT face=Tahoma>I have talked about <A href="http://msdn.microsoft.com/library/en-us/intl/nls_5tb8.asp">LOCALE_INVARIANT</A> / <A href="http://msdn.microsoft.com/library/en-us/cpref/html/frlrfsystemglobalizationcultureinfoclasstopic.asp">CultureInfo</A>.<A href="http://msdn.microsoft.com/library/en-us/cpref/html/frlrfsystemglobalizationcultureinfoclassinvariantculturetopic.asp">InvariantCulture</A> before, in <a href="http://archives.miloush.net/michkap/archive/2004/12/29/344136.html">Comparison confusion: INVARIANT vs. ORDINAL</A> and <a href="http://archives.miloush.net/michkap/archive/2004/12/08/278170.html">Where is the locale? "Its Invariant." In <EM>where</EM>?</A>&nbsp;and talked a little about the if not noble then at least deterministic intent of this odd locale with no real country and no real language. But when I look at how people use it, what I am most often struck by is two different things:</FONT></P>
<OL>
<LI><FONT face=Tahoma>Developers tend to misuse it at least ten times more often than they use it correctly. And that is a charitable estimate.</FONT> 
<LI><FONT face=Tahoma>The name of this beast is so staggeringly&nbsp;bad that it is probably the reason for the heavy pattern of misuse described in #1.</FONT></LI></OL>
<P><FONT face=Tahoma>That&nbsp; post I link to for LOCALE_INVARIANT has probably the best description I have ever seen of the purpose of Invariant:</FONT></P>
<BLOCKQUOTE dir=ltr>
<P><FONT face=Tahoma size=2><EM>The LOCALE_INVARIANT is a special locale identifier that is locale independent. It is designed for system level functions that require consistent results (for example, sorting in the file system) regardless of the locale that the user has chosen. Typically, an application does not use LOCALE_INVARIANT because it expects the results of an action to depend on the rules governing each individual locale. </EM></FONT></P>
<P><FONT face=Tahoma size=2><EM>LOCALE_INVARIANT is defined as LANG_INVARIANT for the primary language, SUBLANG_NEUTRAL for the sub-language, and SORT_DEFAULT for the sort id. </EM></FONT></P></BLOCKQUOTE>
<P><FONT face=Tahoma>In fact the only real problem with this summary is that it located in the remarks for the MAKESORTLCID macro, whose only connection to LOCALE_INVARIANT is that like all proper LCIDs you can construct the value with the macro if you did not want to use the predetermined constant. At least they mention how the construction is done (I have seen developers wonder why MAKELLANGID(LANG_INVARIANT, SUBLANG_DEFAULT) causes an error when you try to use it -- I tell them to just the predefined constant and not try to build them all when you do not have to!).</FONT></P>
<P><FONT face=Tahoma>The most common misuse is for people to do&nbsp;a ToLower() operation followed by an invariant comparison to <EM>validate filenames</EM>, which if you are a regular reader here you will know that it is hard to get less accurate results out of code than this approach. Well, you could write code that reformats the user's hard drive when you run it and that would be worse. But it is in the top five "bad algorithms you can create while soberly writing code." With the bonus of being an extra string allocation.</FONT></P>
<P><FONT face=Tahoma>Yikes!</FONT></P>
<P><FONT face=Tahoma>I have decided that I will from time to time remind people of the difference between ORDINAL and INVARIANT, because neither name is all that intuitive but each of them can be incredibly useful (when&nbsp;used properly/appropriately). As I said in the first article above:</FONT></P>
<BLOCKQUOTE dir=ltr>
<P><FONT face=Tahoma size=2><EM>That problem remains to this day, though every single time I speak at a conference or answer a question in a newsgroup or get someone to look at posts like this one, then there is at least one less developer who has this problem. Maybe this time it is you? :-)</EM></FONT></P></BLOCKQUOTE>
<P><FONT face=Tahoma>I&nbsp;kind of feel a summarized list of DOs and DON'Ts coming on in a future post, and the issues surrounding Invariant and Ordinal comparisons will probably have a prominent place in that list (as will some of those casing issues).</FONT></P>
<P><FONT face=Tahoma></FONT>&nbsp;</P>
<P><FONT face=Tahoma><FONT color=#ff0000><EM>This post brought to you by</EM> "áƒš" <EM>(<A href="http://www.fileformat.info/info/unicode/char/10da/index.htm">U+10da</A>, a.k.a. GEORGIAN LETTER LAS)</EM></FONT></FONT></P>
<hr/><p><a id="408002" href="#408002">#</a> <strong>Ben</strong> on 13 Apr 2005 10:39 PM:</p><div style="margin-left: 1em">Michael,<br><br>I appreciate your enthusiasm for picking out common programming errors like this, but as a professional programmer, I find a lot of these internationalization parameters confusing.  <br>How do I know if I need to pass the NORM_IGNOREKANATYPE flag to CompareString?  How do I know if I want LOCALE_USER_DEFAULT or LOCALE_SYSTEM_DEFAULT, or some other locale? <br><br>I simply don't know.  Unless I learn Japanese, or know someone who knows Japanese, I'll never know the answer.  The trouble is that the APIs feel like they were written by linguists.  <br><br>Me?  I just want to compare filenames, or compare entries in a hash table, or compare usernames, etc.  I don't want to even have the choice of ignoring kana types.  I just want the CompareStrings API do the *right thing* out of the box.  If that is too hard for a single function, then let's write some API sets that are easy to use for common cases.   I think this would be a more useful endeavor than to write articles about the nuances between CT_CTYPE3 and CT_CTYPE2.<br><br>Sometimes less choice is better.  Please please finish that list of do's and don'ts.  Please please make a list of &quot;If you want to sort like a dictionary, do this...  If you want to put filenames into a hash table, do this...&quot;</div>
<p><a id="408100" href="#408100">#</a> <strong>Michael S. Kaplan</strong> on 14 Apr 2005 8:13 AM:</p><div style="margin-left: 1em">A very good thought -- worthy if its own posting, if you ask me!</div>
<hr/><p><em>referenced by</em></p><div style="margin-left: 1em"><p>2006/05/24 <a href="http://archives.miloush.net/michkap/archive/2006/05/24/605599.html">Invariant vs. Ordinal, the third</a></p><p>2005/12/22 <a href="http://archives.miloush.net/michkap/archive/2005/12/22/506595.html">New in Windows Vista: OrdinalIgnoreCase for Win32</a></p><p>2005/10/15 <a href="http://archives.miloush.net/michkap/archive/2005/10/15/481314.html">If you are using INVARIANT then you are probably MISusing it, #1</a></p><p>2005/06/02 <a href="http://archives.miloush.net/michkap/archive/2005/06/02/424128.html">The New String recommendations</a></p><p>2005/04/14 <a href="http://archives.miloush.net/michkap/archive/2005/04/14/408116.html">On approaching international programming....</a></p></div><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2005/04/13/407912.html" title="AVICAP32.DLL sucks (from the MSLU point of view)">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2005/04/12/407456.html" title="Why the proofing tools are all bundled....">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2005-04">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2005-04-13">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2005/04/13/407823.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:41 GMT -->
</html>