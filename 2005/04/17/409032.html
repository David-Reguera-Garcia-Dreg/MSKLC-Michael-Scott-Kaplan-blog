<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2005/04/17/409032.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:41 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>Why are the HKL and KLID of the keyboard different?</title></head><body>
<h1>Why are the HKL and KLID of the keyboard different?</h1>
<p><em>by Michael S. Kaplan, published on 2005/04/17 17:40 -07:00, original URI: http://blogs.msdn.com/michkap/archive/2005/04/17/409032.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostOld -->
<P><FONT face=Tahoma>I actually get this question on a regular basis, believe it or not.</FONT></P>
<P><FONT face=Tahoma>People look at the two numbers, see the similarities, and then start assuming they are the same. To review from my old <a href="http://archives.miloush.net/michkap/archive/2004/11/27/270931.html">keyboard terminiology</A> post:</FONT></P><FONT face=Tahoma>
<UL>
<UL>
<LI>
<P><FONT size=2><STRONG>KLID</STRONG> -- a keyboard layout identifier. Traditionally pronounced "<EM>Kay-El-Eye-Dee</EM>" because <EM>some</EM> people in the USA get very uptight about certain homonyms (you can catch me slipping on this point from time to time). It's also sometimes called the input locale identifier since the name for HKL has been updated (see the HKL definiteion for info on why that is incorrect since the HKL is for something different). The KLID&nbsp;can be retrieved for the&nbsp;currently selected&nbsp;keyboard layout&nbsp;in a thread through the </FONT><A href="http://msdn.microsoft.com/library/en-us/winui/winui/windowsuserinterface/userinput/keyboardinput/keyboardinputreference/keyboardinputfunctions/getkeyboardlayoutname.asp"><FONT size=2>GetKeyboardLayoutName</FONT></A><FONT size=2> API (note the pswzKLID parameter), though that is not true of any other selected or installed keyboard layout.&nbsp;Every keyboard layout on the system has one of these.&nbsp;Each&nbsp;KLID is&nbsp;32 bits (thus 8 hex digits), and they can all be found in the registry as the subkeys under HKLM\SYSTEM\CurrentControlSet\Control\Keyboard Layouts\. The bottom half of the KLID is a LANGID, and the top half is something device-specific. By convention, the first hex digit is usually as follows: </FONT></P>
<UL>
<LI><FONT size=2><STRONG>0</STRONG> -- Most keyboard layouts </FONT>
<LI><FONT size=2><STRONG>A</STRONG> -- Keyboard layouts defined by MSKLC </FONT>
<LI><FONT size=2><STRONG>D </STRONG>-- Some non-CJK input methods that have been defined by the Text Services Framework <EM>(note: reported to me; I have never seen one of these!)</EM> </FONT>
<LI><FONT size=2><STRONG>E</STRONG> -- CJK input methods, also known as IMEs</FONT></LI></UL>
<LI><FONT size=2><STRONG>HKL</STRONG> -- a handle to a keyboard layout, traditionally pronounced "<EM>Āch-Kay-El</EM>", the terminiology folks have pretty aggressively tried to call this an "input locale identifier" despite the obvious problem that it has nothing to do with locales and that it is not the same value as the actual identifier (the KLID). The HKL in actuality <EM>is</EM> the handle to an input method. Althought defined as a handle, only the lower 32 bits are currently used. Of those 32 bits, the bottom 16 bits represent a LANGID, and the top 16 bits represent a value defined by the USER SUBSYSTEM which helps to uniquely identify an installed keyboard layout. This is crucial since any keyboard layout can be installed more than once (by installing it under different languages, which helps user operations like spell checking). </FONT></LI></UL></UL></FONT>
<P><FONT face=Tahoma>The differences are not obvious if you install keyboards via the <A href="http://msdn.microsoft.com/library/en-us/winui/winui/windowsuserinterface/userinput/keyboardinput/keyboardinputreference/keyboardinputfunctions/loadkeyboardlayout.asp"><STRONG>LoadKeyboardLayout</STRONG></A> API (by the way, note the <EM>pwszKLID</EM> parameter name for those who doubted me about the whole KLID thing!). In that case, the same LCID is always used, and if the keyboard is one of the many with KLID values like 00000409 or 00000407 then the HKL value will be the same as KLID, further making people think they are the same. However, there are two times when they can and will be different:</FONT></P>
<OL>
<LI><FONT face=Tahoma>Any time the KLID value is more than just the LANGID -- like 00010439 for the <EM>Hindi Traditiona</EM>l keyboard layout or 0003041e for the <EM>Thai Pattachote (non-ShiftLock)</EM> keyboard layout, the HKL will have a high word of the lower DWORD filled with different information.</FONT></LI>
<LI><FONT face=Tahoma>Any time the keyboard is assigned via the Text Services Framework UI under a different language than the original keyboard (e.g. installing the US keyboard under the French language), the HKL will be based on the language you chos, not the language implicit in the KLID.</FONT></LI></OL>
<P><FONT face=Tahoma>One could say that making the HKL a handle was a waste, especially since it is a waste of 32 bits of space on 64-bit platforms, but I kind of wish we had defined LCIDs in the same way, it allows for a lot more flexibility.</FONT></P>
<P><FONT face=Tahoma>In any case, these two values are based on entirely different principles, and the times that they are the same value are entirely coincidential....</FONT></P>
<P><FONT face=Tahoma></FONT>&nbsp;</P>
<P><FONT face=Tahoma><FONT color=#ff0000><EM>This post brought to you by</EM> "Ѐ" <EM>(<A href="http://www.fileformat.info/info/unicode/char/0400/index.htm">U+0400</A>, a.k.a. CYRILLIC CAPITAL LETTER IE WITH GRAVE)<BR><FONT size=1>A letter whose current importance is almost entirely based on its lack of substance in Windows!</FONT></EM></FONT></FONT></P>
<hr/><div style="margin-left: 1em"><em>no comments</em></div><hr/><p><em>referenced by</em></p><div style="margin-left: 1em"><p>2008/09/29 <a href="http://archives.miloush.net/michkap/archive/2008/09/29/8968315.html">What a tangled web we weave when a KLID from an HKL we must receive</a></p><p>2006/10/14 <a href="http://archives.miloush.net/michkap/archive/2006/10/14/825404.html">Understanding (and explaining) why English is everywhere</a></p><p>2005/04/25 <a href="http://archives.miloush.net/michkap/archive/2005/04/25/411657.html">Limiting the languages of input</a></p></div><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2005/04/17/409062.html" title="Brett Shirley really ought to blog">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2005/04/16/408871.html" title="My linguistic profile....">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2005-04">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2005-04-17">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2005/04/17/409032.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:41 GMT -->
</html>