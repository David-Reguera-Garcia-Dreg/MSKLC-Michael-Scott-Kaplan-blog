<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2005/04/23/411074.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:41 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>SetLocaleInfo really stinks</title></head><body>
<h1>SetLocaleInfo really stinks</h1>
<p><em>by Michael S. Kaplan, published on 2005/04/23 02:01 -04:00, original URI: http://blogs.msdn.com/b/michkap/archive/2005/04/23/411074.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostNew -->
<P><FONT face=Tahoma>Yes, I said it. The <A href="http://msdn.microsoft.com/library/en-us/intl/nls_7w1b.asp">SetLocaleInfo</A> function, which has been around since NT 3.1, really stinks.</FONT></P>
<P><FONT face=Tahoma>Why would I be so disparaging about an API that has been around so long?</FONT></P>
<P><FONT face=Tahoma>Well, I'll start on the outside and work concentrically in....</FONT></P>
<P><FONT face=Tahoma>First of all, it is an enabler. In a world where <A id=_ctl0__ctl0__ctl0__ctl0_CategoryView__ctl0_postlist__ctl0_EntryItems__ctl5_PostTitle HREF="http://archives.miloush.net/michkap/archive/2005/04/11/407107.html"><FONT color=#0000ff>it's all about making sure developers respect the user's preferences</FONT></A>, anyone who wants to change those preference settings is really out of step on the whole respect issue. And a function&nbsp;whose main purpose in life is to enable that user to make such a change is essentially an enabler encouraging the bad behavior.</FONT></P>
<P><FONT face=Tahoma>(Of course there are exceptions to this, as sometimes an application is basing the change on user feedback. So maybe it is not gun's fault if someone shoots another person. If that person aimed the gun and fired it at someone intentionally, then it if the fault of the person. But the gun still enabled the crime to happen. It could be made safer, at least!)</FONT></P>
<P><FONT face=Tahoma>Alright, let's ignore that one for a moment. It also stinks because of the way the documentation is laid out. It lists 32 LOCALE_* LCTypes that it can affect:</FONT></P>
<P>
<TABLE>

<TR>
<TD>LOCALE_ICALENDARTYPE<BR>LOCALE_ICURRDIGITS<BR>LOCALE_ICURRENCY<BR>LOCALE_IDIGITS<BR>LOCALE_IDIGITSUBSTITUTION<BR>LOCALE_IFIRSTDAYOFWEEK<BR>LOCALE_IFIRSTWEEKOFYEAR<BR>LOCALE_ILZERO<BR>LOCALE_IMEASURE<BR>LOCALE_INEGCURR<BR>LOCALE_INEGNUMBER<BR>LOCALE_IPAPERSIZE<BR>LOCALE_ITIME<BR>LOCALE_S1159<BR>LOCALE_S2359<BR>LOCALE_SCURRENCY</TD>
<TD>LOCALE_SDATE<BR>LOCALE_SDECIMAL<BR>LOCALE_SGROUPING<BR>LOCALE_SLIST<BR>LOCALE_SLONGDATE<BR>LOCALE_SMONDECIMALSEP<BR>LOCALE_SMONGROUPING<BR>LOCALE_SMONTHOUSANDSEP<BR>LOCALE_SNATIVEDIGITS<BR>LOCALE_SNEGATIVESIGN<BR>LOCALE_SPOSITIVESIGN<BR>LOCALE_SSHORTDATE<BR>LOCALE_STHOUSAND<BR>LOCALE_STIME<BR>LOCALE_STIMEFORMAT<BR>LOCALE_SYEARMONTH</TD></TR></TABLE></P>
<P><FONT face=Tahoma>And then it jumps to the full list of all of the LCTypes under the heading of <A href="http://msdn.microsoft.com/library/en-us/intl/nls_8rse.asp">Locale Information</A>. What is that about, a tease? And wouldn't you expect more customized information about the setting of this info then would be provided in the getting of it?</P>
<P>Ok, let's ignore that too and look at the LCTypes. Thirteen of them are numbers, but you still have to pass the parameter as a string. There is a LOCALE_RETURN_NUMBER flag you can use in <A href="http://msdn.microsoft.com/library/en-us/intl/nls_34rz.asp">GetLocaleInfo</A>&nbsp;to return this field as a number. So where is the LOCALE_SPECIFY_NUMBER flag? Don't bother looking, it's not there.</P>
<P>Let's ignore that one too and look at the LCID parameter. The API validates that it is an actual LCID (so you cannot pass some random invalid number). But then after verifying that is normal, it proceeds to ignore the value and sets the values for the current user default locale, the only locale that persists the user overrides.&nbsp;So what was the reason for including the LCID if it was not going to use it? Because the function stinks, that is why.</P>
<P>Now how many APIs do <EM>you</EM> know that encourage inappropriate application behavior, do not get documented conveniently/completely, force the caller to make needless conversions, validate parameters that they do not even use, and then only work with the user default, that <EM>don't</EM> stink? Not many, I would wager. It is pretty hard to ignore the smell of unrefrigerated fish that this&nbsp;function exudes, if you know what I mean.</P>
<P>As the man says, <a href="http://blogs.msdn.com/mdolenga/archive/2005/02/24/379705.aspx"><FONT color=#0000ff><STRONG>Please don't use SetLocaleInfo</STRONG></FONT></A>. It is a bad, bad, function. </P>
<P>&nbsp;</P>
<P><FONT color=#ff0000><EM>This post brought to you by</EM> "<FONT size=4>ק</FONT>" <EM>(<A href="http://www.fileformat.info/info/unicode/char/05e7/index.htm">U+05e7</A>, a.k.a. HEBREW LETTER QOF)<BR><FONT face=Tahoma color=#ff0000 size=1><EM>Because this post is קשר לפסח in anticipation of the festivities that start less than 24 hours from now)</EM></FONT></P></EM></FONT></FONT>
<hr/><div style="margin-left: 1em"><em>no comments</em></div><hr/><p><em>referenced by</em></p><div style="margin-left: 1em"><p>2008/07/10 <a href="http://archives.miloush.net/michkap/archive/2008/07/10/8715940.html">What's the sharp and nasty, smooth and greasy, barbed and two-pronged f***ing point of SetCalendarInfo?</a></p><p>2007/10/18 <a href="http://archives.miloush.net/michkap/archive/2007/10/18/5508827.html">LocalSystem is people, too!</a></p><p>2006/05/21 <a href="http://archives.miloush.net/michkap/archive/2006/05/21/603374.html">SetLocaleInfo works without notification</a></p><p>2006/04/28 <a href="http://archives.miloush.net/michkap/archive/2006/04/28/585735.html">DEFAULT_GUI_FONT really stinks</a></p><p>2005/08/22 <a href="http://archives.miloush.net/michkap/archive/2005/08/22/454360.html">Why I think the thread locale really stinks</a></p><p>2005/05/29 <a href="http://archives.miloush.net/michkap/archive/2005/05/29/422980.html">Pass the string, please</a></p></div><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2005/04/23/411092.html" title="Do I really support the Kobayashi Maru in interview questions?">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2005/04/22/410797.html" title="Exposing custom cultures?">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2005-04">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2005-04-23">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2005/04/23/411074.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:41 GMT -->
</html>