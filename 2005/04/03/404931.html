<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2005/04/03/404931.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:42 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>How whining a whole bunch got a feature added</title></head><body>
<h1>How whining a whole bunch got a feature added</h1>
<p><em>by Michael S. Kaplan, published on 2005/04/03 02:05 -05:00, original URI: http://blogs.msdn.com/b/michkap/archive/2005/04/03/404931.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostNew -->
<P>Sometimes I am a real pain in the you-know-what.</P>
<P>You can ask people on my team, they will probably agree. </P>
<P>In fact, if any of them are reading I will not hold it against them if they wanted to verify&nbsp;this point. :-)</P>
<P>Anyway, I was going to tell you a story here, about how whining got a feature added. It is mostly from memory, though I did dig up my old newsgroup post from my archives....</P>
<BLOCKQUOTE dir=ltr>
<BLOCKQUOTE dir=ltr>
<P>A few years ago (back in November of 2000), I believe a little while before the original 1.0 version of the .NET Framework shipped, a problem came up that I was involved with. </P>
<P>You see, a customer had been using the System.Globalization namespace's&nbsp;HijriCalendar class on a machine that had&nbsp;<STRONG>Arabic - Saudi Arabia</STRONG>&nbsp;as its default user locale and Hijri was his Windows calendar choice (meaning that its CurrentCulture was <STRONG>ar-SA</STRONG> and that HijriCalendar was his CultureInfo object's Calendar). He noticed that when he changed the "day advance" setting of the Hijri calendar in Regional Options, applications like Outlook and Word had no problem picking up the change instantly. Yet his managed application had to be shut down and restarted to pick up the change. Wanting to figure out why, he sent me a piece of mail asking me about it.</P>
<P>Now I was working for the NLS team at the time (I believe this was before we were really GIFT, and Julie was a dev. lead who I reported to directly rather than indirectly through two other people). I was&nbsp;working on the Microsoft Layer for Unicode. I felt kind of weird about going to people on the team during working hours and trying to get special treatment for bugs that had nothing to do with what I was being paid to do there,&nbsp;so after asking this guy for permission I posted the issue in the C# newsgroup (microsoft.public.dotnet.csharp.general):</P>
<BLOCKQUOTE dir=ltr>
<BLOCKQUOTE dir=ltr>
<P><A name=msg_5feb8792dcc8db7e></A><FONT size=2>Attn: to someone at Microsoft? :-) <BR></FONT>
<P><FONT size=2>BACKGROUND: The Hijri calendar is a 100% lunar calendar that in addition all of its rules, requires a religious authority to spot the new moon for the month to start. Clearly, no algorithm can ever determine this with 100% accuracy, which is why WINDOWS supports (in the control panel) a way to offset the date based on that sighting. This is support by all Arabic localized and enabled versions of Windows, and all language versions of Windows 2000 and Whistler. <BR></FONT>
<P><FONT size=2>Applets such as the Windows date on the system tray and application such as Outlook support it. <BR></FONT>
<P><FONT size=2>However, the Hijri date support that was in COM and is in the CLR, and the HijriCalendar class does not support getting this offsert value. In addition, unless I do not have my druthers about me, HijriCalendar does not support it either. <BR></FONT>
<P><FONT size=2>You can confirm with people such as Assem Hijazi that this is important; Hijri dates need to respect this small bow to the fact that you cannot algorthmically determine the proclamations of religious authorities. Hijri dates need to adjust for this reg. key and ideally you should be able to at least GET (if not SET) this parameter. <BR></FONT>
<P><FONT size=2>If the CLR's System.Globalization class is the next iteration of Windows NLS support, then its time to support the things that have been missing to programming languages since VS first shipped. :-) <BR></FONT>
<P><FONT size=2>If anyone needs more info on how this info is stored in the registry, let me know. </FONT></P></BLOCKQUOTE></BLOCKQUOTE>
<P>The developer who owned the feature (who is actually now my manager and who has hopefully forgiven me for how I did all this!) came by to ask me about the message. It was all a&nbsp;little embarassing since he did not really understand why I would&nbsp;feel uncomfortable, but he let that pass after I explained (or maybe he just thought I was being weird, which I guess I was).</P>
<P>Then, after I explained how this all came about, he explained to me why it was actually a really hard bug to fix (he was aware of the fact that I&nbsp;had never even seen the source code that point).&nbsp;Those other applications "respected" the settings change by listening for the WM_SETTINGCHANGE message that Regional Options sends. But the .NET Framework had no message loop to listen for this message, and thus no way to really respond to it. A developer could create a brand new&nbsp;CultureInfo object to pick up the change, but any existing object would not get it, and there was no way to reset a CultureInfo, especially CurrentCulture.</P>
<P>At this point, I&nbsp;got really stubborn. I told him how crucial this functionality was. And it was not just about the Hijri calendar stuff; any update in Regional Options would not be picked up. Even though the very common end user pattern here is to notice that a setting is wrong while she is in an application, to fix the incorrect setting in Regional Options, and then go back to the application and see the update. I had written applications myself that do this, and like I said all of the big applications like Outlook handled things correctly. It would really make the .NET Framework look bad if nothing were done to improve the situation, since there was really no good remedy for the problem. Doing nothing would mean no way to even get parity with Window 95!</P>
<P>But my future boss was really worried about the cost of trying to add such a feature so late in the game. And he is right, that is a very real concern. </P>
<P>At the time, though,&nbsp;I was external enough to the .NET Framework team that I was not really looking at it that way (remember that I was not being paid to do anything in .NET at all;&nbsp;I was focused on just the user scenario). So I kept pushing. I pointed out how COM had actually fixed this bug in their own code, so much so that in the Windows 95/98/NT 4.0&nbsp;days they created a hidden window (class name of "OLEAUT32") to listen for the message (in Windows Me and beyond they started listening for it as a thread message instead). Now this&nbsp;would be a big change, yes. But if not that, I asked, couldn't something be done to help here? </P>
<P>I finally pointed out one thing -- the way the code was now, even if I were developing a WinForms application and I actually received the WM_SETTINGCHANGE&nbsp;message, I would be powerless to do anything about it!</P>
<P>I swear I saw the lightbulb light up on top of his head when I said that. He said he would think about what I was saying and excused himself.</P>
<P>(anticipating a question some might have, I did not bill for the time that I was talking to him about the problem!)</P>
<P>And very soon after that he added the ClearCachedData method. So that any time a developer listened for and subsequently heard the WM_SETTINGCHANGE&nbsp;message, she could reset the object and pick up the change. And a WinForms application could have parity with a Win32 one (note that even on Win32 you would have to write code to listen for the message, so true parity was really accomplished since a developer could in either case choose to not update if they did not want to).</P></BLOCKQUOTE></BLOCKQUOTE>
<P>So, that's the story of how whining got ClearCachedData added.&nbsp;:-)</P>
<P>Just this last March in an&nbsp;<A href="http://msdn.microsoft.com/msdnmag/issues/05/03/CultureInfo/">article</A> I wrote for&nbsp;<A href="http://msdn.microsoft.com/msdnmag/">MSDN Magazine</A>, I gave the sample code you could use to accomplish all that in a WinForms application....</P>
<P>But lest you think that you, as&nbsp;a developer using the .NET Framework&nbsp;who runs into a problem, would not have the the same ability to whine and get changes made or bugs fixed or suggestions heard, use that link I have that points to the <A href="http://lab.msdn.microsoft.com/productfeedback/http://lab.msdn.microsoft.com/productfeedback/">MSDN Product Feedback Center</A>. Microsoft developers, testers, and program managers see the feedback and bugs posted there directly in the bug database, and they take the feedback seriously. If you look at some of the issues that have been fixed after beging reported there, you will know that you have same kind of direct access to the people who can solve the problems, whether they are international or not (I myself have fixed two bugs reported on the site for Whidbey RTM: <A href="http://lab.msdn.microsoft.com/productfeedback/viewfeedback.aspx?feedbackid=2ca2d4d4-dfad-499a-9e06-8d577524031a">String comparison (and sorting) for sr-SP-Latn (Serbian) culture is incorrect</A>&nbsp;and <A href="http://lab.msdn.microsoft.com/productfeedback/viewfeedback.aspx?feedbackid=9a2d48a2-5b82-4b85-9f19-400fbea4fc34">CompareInfo.Name is incorrect for zh-CN and ka-GE alternative sort orders</A>, and a ton of other bugs and suggestions have been posted there, across all aspects of the .NET Framework!).</P>
<P>Or you could always post the info here in <A id=BlogTitleLink href="http://archives.miloush.net/michkap/">Sorting It All Out</A>, or on the <A id=CategoryDisplay1_Categories_CatList__ctl1_LinkList__ctl2_Link href="http://blogs.msdn.com/BCLTeam" target=_blank>BCL Team</A>'s, <A id=CategoryDisplay1_Categories_CatList__ctl1_LinkList__ctl1_Link href="http://blogs.msdn.com/AchimR" target=_blank>Achim Ruopp</A>'s, or <a href="http://blogs.msdn.com/brada">Brad Abrams</A>'s blog. The advantage to one of our blogs is that you may get someone to post about it; the advantage to posting to the <A href="http://lab.msdn.microsoft.com/productfeedback/http://lab.msdn.microsoft.com/productfeedback/">MSDN Product Feedback Center</A>&nbsp;is that you get to track the issue and have people vote on it. And voting is something that can in some cases make all the difference in the world if you have either (a) a lot of people who agree with you or (b) a lot of developer friends you can bribe with Twinkies or beer!</P>
<P>&nbsp;</P>
<P><FONT color=#ff0000><EM>This post brought to you by</EM> "۾" <EM>(<A href="http://www.fileformat.info/info/unicode/char/06fe/index.htm">U+06fe</A>, ARABIC SIGN SINDHI POSTPOSITION MEN)</EM></FONT></P>
<hr/><div style="margin-left: 1em"><em>no comments</em></div><hr/><p><em>referenced by</em></p><div style="margin-left: 1em"><p>2011/01/03 <a href="http://archives.miloush.net/michkap/archive/2011/01/03/10110996.html">Bad news: you may have to clear the cache; Good news: you *can* clear the cache</a></p><p>2006/04/14 <a href="http://archives.miloush.net/michkap/archive/2006/04/14/576627.html">Long term planning is not always done</a></p><p>2005/09/28 <a href="http://archives.miloush.net/michkap/archive/2005/09/28/474690.html">Using Hijri dates in SQL Server</a></p><p>2005/04/30 <a href="http://archives.miloush.net/michkap/archive/2005/04/30/413720.html">Not perfect, but perfecting feedback loops</a></p><p>2005/04/11 <a href="http://archives.miloush.net/michkap/archive/2005/04/11/407107.html">It is all about making sure developers respect the user's preferences</a></p><p>2005/04/05 <a href="http://archives.miloush.net/michkap/archive/2005/04/05/405443.html">So what happened in v.Next?</a></p></div><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2005/04/03/405029.html" title="About the slightly changed look of Sorting It All Out">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2005/04/02/404926.html" title="Don&#39;t expect this post to make sense or any help from me">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2005-04">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2005-04-03">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2005/04/03/404931.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:42 GMT -->
</html>