<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2005/04/11/407107.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:41 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>It is all about making sure developers respect the user's preferences</title></head><body>
<h1>It is all about making sure developers respect the user's preferences</h1>
<p><em>by Michael S. Kaplan, published on 2005/04/11 07:16 -04:00, original URI: http://blogs.msdn.com/b/michkap/archive/2005/04/11/407107.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostNew -->
<P><FONT face=Tahoma>Now this is a topic I have talked about before, so I am going to put a slightly different spin on the issue, this time.</FONT></P>
<P><FONT face=Tahoma>To review, a user can go into Regional Options and make choices about the language they want to use. </FONT></P>
<P><FONT face=Tahoma>Now I could go on forever (hell, I <STRONG>have</STRONG> gone on forever!)&nbsp;about using the NLS APIs to have that setting respected and how it is such a good idea.</FONT></P>
<P><FONT face=Tahoma>But developers do not tend to think that way. </FONT></P>
<P><FONT face=Tahoma>Generally speaking, they develop programs that meet requirements, and the "respect user locale" requirement is such a stealth one one that it usually does not show up on the list a developer is working from.</FONT></P>
<P><FONT face=Tahoma>So, put yourself in my shoes. Or the shoes of a developer working on NLS. How do you make sure that the user preferences are going to be respected?</FONT></P>
<P><FONT face=Tahoma>Well, the best way is to make sure that by default the APIs pick up the user preferences. It has to be harder to <STRONG>not</STRONG> get those preferences. And we do that -- all the NLS APIs like <A href="http://msdn.microsoft.com/library/en-us/intl/nls_8a0k.asp">GetNumberFormat</A> and <A href="http://msdn.microsoft.com/library/en-us/intl/nls_34rz.asp">GetLocaleInfo</A>&nbsp;require developers to pass the LOCALE_NOUSEROVERRIDE flag explicitly to not get the user's preferences.&nbsp;In the same way, the&nbsp;<A href="http://msdn.microsoft.com/library/en-us/cpref/html/frlrfsystemglobalizationcultureinfoclassctortopic.asp">CultureInfo ctor</A> has a default that picks up that same set of user preferences. Sure, you can&nbsp;explicitly pass <STRONG>false</STRONG> to that UseUserOverride parameter, but the default does not require that.</FONT></P>
<P><FONT face=Tahoma>Now there are people who actually work on .NET who feel that the .NET Framework should have had different defaults here -- better in their mind to go with the locale-insensitive behavior and then make picking up the user settings an "opt-in" process. But such an approach is doomed to be non-intuitive since users who make changes in Regional Options have a realistic expectation that they will be able to see the change picked up. It is the main reason that even the .NET Framework was given <a href="http://archives.miloush.net/michkap/archive/2005/04/03/404931.html">mechanisms</A> to pick up these changes -- because people expect to not only make them but to see the results reflected by applications, managed and unmanaged. </FONT></P>
<P><FONT face=Tahoma>So, over the objection of some people, the .NET Framework does the same thing as Windows functions like <A href="http://msdn.microsoft.com/library/en-us/winui/winui/windowsuserinterface/resources/strings/stringreference/stringfunctions/lstrcmp.asp">lstrcmp</A> and <A href="http://msdn.microsoft.com/library/en-us/winui/winui/windowsuserinterface/resources/strings/stringreference/stringfunctions/lstrcmpi.asp">lstrcmpi</A>&nbsp;-- it respects the user's setting by the default in comparison, parsing, and formatting. If you are a developer writing code and you want to ignore those settings, you have to explicitly work at it....</FONT></P>
<P><FONT face=Tahoma>Because I am a developer myself, and I know that sometimes the respect must be enforced to make sure developers do it. No offense to the developers&nbsp;(and this does not apply to all of you!) but it applies to enough to make doing it this way a requirement.</FONT></P>
<P><FONT face=Tahoma><FONT color=#ff0000><EM>This post brought to you by</EM> "<FONT size=4>ܜ</FONT>" <EM>(<A href="http://www.fileformat.info/info/unicode/char/071c/index.htm">U+071c</A>, a.k.a. SYRIAC LETTER TETH GARSHUNI)</EM></FONT></FONT></P>
<hr/><p><a id="407171" href="#407171">#</a> <strong>Mick O</strong> on 11 Apr 2005 10:34 AM:</p><div style="margin-left: 1em">Yeah like I totally sick of Word always assuming that I want to us US dictionaries no matter how many times I tell it to use UK dictionaries and save the Normal.dot with these settings.</div>
<p><a id="407300" href="#407300">#</a> <strong>Centaur</strong> on 11 Apr 2005 2:40 PM:</p><div style="margin-left: 1em">Sometimes, respecting the user’s preferences is bad.<br><br>The case is of Excel exporting a worksheet to CSV. One might suppose that CSV means Comma Separated Values. But Excel, when exporting, separates values not with commas but with list separators. And when importing, it expects list separators, so if values in the file are comma-separated and the list separator is not the comma, all the fields get packed into one column.<br><br>I consider this a bug in Excel. Because a document exported in one region will not import in another. Or even on the same machine under a different user, who happens to prefer HIRAGANA LETTER YA as his list separator.<br><br>I also strongly suspect that the same bug applies to the decimal separator.</div>
<p><a id="407367" href="#407367">#</a> <strong>Mike Williams</strong> on 11 Apr 2005 6:13 PM:</p><div style="margin-left: 1em">Mick O: See <a rel="nofollow" target="_new" href="http://msmvps.com/thinice/articles/39610.aspx">http://msmvps.com/thinice/articles/39610.aspx</a></div>
<p><a id="407434" href="#407434">#</a> <strong>Michael S. Kaplan</strong> on 11 Apr 2005 10:10 PM:</p><div style="margin-left: 1em">Centaur -- this is of course a good time to consider explicitly passing the flag to not use the user overrides. But it is definitely not the default case. :-)</div>
<p><a id="407793" href="#407793">#</a> <strong>Tim Mckinnon</strong> on 13 Apr 2005 2:49 AM:</p><div style="margin-left: 1em">Great Great..... I have been a follower of yours for some time, and found your blog by accident today looking for INSTRREV function that supports bytes not characters. I am totally in awe of your multilanguage exploits. Great Work! and an inspiration to the rest of us wanna be's.</div>
<p><a id="411786" href="#411786">#</a> <strong>DaveG</strong> on 25 Apr 2005 11:00 AM:</p><div style="margin-left: 1em">I understand the general idea of getting options from user specific/machine specific settings, but I also agree with the comment about CSV files. CSV means comma separated values. It doesn't mean &quot;machine list separator settings&quot; separated values. I'd be interested to know why Microsoft thought that they'd lookup a separator setting for a file format that's supposed to be separated by commas (hence the extension CSV). Any takers?</div>
<hr/><p><em>referenced by</em></p><div style="margin-left: 1em"><p>2007/09/14 <a href="http://archives.miloush.net/michkap/archive/2007/09/14/4900107.html">How do I feel about lstrcmpi? I think it blows....</a></p><p>2005/04/23 <a href="http://archives.miloush.net/michkap/archive/2005/04/23/411074.html">SetLocaleInfo really stinks</a></p></div><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2005/04/12/407456.html" title="Why the proofing tools are all bundled....">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2005/04/10/406880.html" title="What the %#$* is wrong with German sorting?">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2005-04">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2005-04-11">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2005/04/11/407107.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:41 GMT -->
</html>