<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2005/04/04/405174.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:42 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>When casing does not need to roundtrip in .NET</title></head><body>
<h1>When casing does not need to roundtrip in .NET</h1>
<p><em>by Michael S. Kaplan, published on 2005/04/04 07:14 -04:00, original URI: http://blogs.msdn.com/b/michkap/archive/2005/04/04/405174.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostNew -->
<P>A few days ago I reminded everyone about how every Unicode character has a story, and I was talking about <A href="http://www.fileformat.info/info/unicode/char/03c2/index.htm">U+03c2</A> a.k.a. GREEK SMALL LETTER FINAL SIGMA. You can read about it <a href="http://archives.miloush.net/michkap/archive/2005/03/31/404052.html">here</A>.</P>
<P>In the deep, dark past I had also talked about the the meaning of&nbsp;<a href="http://archives.miloush.net/michkap/archive/2004/12/11/279942.html">"linguistic casing"</A>&nbsp;on Windows. I never did talk about when/if that setting is used in .NET Framework (I wonder if anyone noticed I palmed that card?).</P>
<P>I also spent some time back then talking about&nbsp;the problems&nbsp;with that&nbsp;one-way casing issue with Georgian when I asked people to <a href="http://archives.miloush.net/michkap/archive/2004/12/02/273619.html">Get off my [lower] case</A>. And how people should use uppercase operations rather than lowercase if they were trying to do any kind of case folding.</P>
<P>But this is not just a trip down memory lane....</P>
<P>The other day I was having an email conversation with one&nbsp;Jeff Cooperstein, an Architect over in the Developer Division. He was working through a bunch of these issues and he noticed something odd when he was trying out casing operations with .NET:</P>
<BLOCKQUOTE dir=ltr>
<P><EM><FONT face=Arial>With the InvariantCulture, why is Final Sigma the only character other than the Georgian characters that doesn’t round trip:</FONT></EM></P>
<P><EM><FONT face=Arial>ς (0x03C2) ToUpper -&gt; Σ (0x03A3) ToLower -&gt; σ (0x03C3)</FONT></EM></P>
<P><EM><FONT face=Arial>With my default culture, there are lots of examples like this – For example:</FONT></EM><EM><FONT face=Arial>&nbsp;</FONT></EM></P>
<P><EM><FONT face=Arial>ǲ (0x01F2) ToLower -&gt; ǳ (0x01F3) ToUpper -&gt; Ǳ (0x01F1)<BR></FONT></EM><EM><FONT face=Arial>ΐ (0x0390) ToUpper -&gt; Ϊ (0x03AA) ToLower -&gt; ϊ (0x03CA)<BR></FONT></EM><FONT face=Arial><EM>ϕ (0x03D5) ToUpper -&gt; Φ (0x03A6) ToLower -&gt; φ (0x03C6)<BR></EM><EM>ϖ (0x03D6) ToUpper -&gt; Π (0x03A0) ToLower -&gt; π (0x03C0)</EM><EM>&nbsp;</EM></FONT></P>
<P><EM><FONT face=Arial>However, with InvariantCulture, the only one that remains is ς<BR></FONT></EM></P></BLOCKQUOTE>
<P>Does that second list ring bells? Indeed, it is the same as the so-called linguistic casing flag used by <A href="http://msdn.microsoft.com/library/en-us/intl/nls_5s2v.asp">LCMapString</A> with the LCMAP_LINGUISTIC_CASING flag. Jeff was spot on with what he found -- the .NET Framework will always pick up these additional mappings (something that of course works really well for casing in <a href="http://archives.miloush.net/michkap/archive/2004/12/03/274288.html">Turkic cultures</A>&nbsp;like Turkish and Azeri). In the case of the invariant culture's <A href="http://msdn.microsoft.com/library/en-us/cpref/html/frlrfsystemglobalizationcultureinfoclasstopic.asp">CultureInfo</A> (think CultureInfo.<A href="http://msdn.microsoft.com/library/en-us/cpref/html/frlrfsystemglobalizationcultureinfoclassinvariantculturetopic.asp">InvariantCulture</A>), these extra mappings are not picked up.</P>
<P>So what about that GREEK SMALL LETTER FINAL SIGMA?</P>
<P>Jeff was right again -- that is the only "one-way" mapping that exists in the default casing tables on Windows and the .NET Framework. If you look at the sort keys for these three characters:</P>
<BLOCKQUOTE dir=ltr>
<P><FONT face="Courier New"><A href="http://www.fileformat.info/info/unicode/char/03c3/index.htm">U+03c3</A>&nbsp; 0F 13 01 01&nbsp;&nbsp;&nbsp;&nbsp;01 01 00<BR><A href="http://www.fileformat.info/info/unicode/char/03c2/index.htm">U+0c32</A>&nbsp; 0F 13 01 01 <FONT color=#ff1493><STRONG>0A</STRONG></FONT> 01 01 00<BR><A href="http://www.fileformat.info/info/unicode/char/03a3/index.htm">U+03a3</A>&nbsp; 0F 13 01 01 <FONT color=#ff1493><STRONG>12</STRONG></FONT> 01 01 00</FONT></P></BLOCKQUOTE>
<P>If you ignore the case weights (marked&nbsp;above in <FONT color=#ff1493><STRONG>PINK</STRONG></FONT>), then they are equal. So from the standpoint of the Windows filesystem, registry keys, environment variables, and all of the other related items, these are all the same character.</P>
<P>I am not worried, though.</P>
<P>So why do I consider the Georgian case to be a terrible bug that ought to be fixed and this Greek case to be okay?</P>
<P>Well, there is the fact that the Georgian Khutsuri characters are not really ones that are understood by users, whereas the final sigma is very well known. Or the fact that the Greek case does have a two-way mapping, even if not one that allows for perfect round-tripping. Add to that the fact that the meaning of the text is not destroyed by being a SMALL LETTER SIGMA instead of a SMALL FINAL SIGMA -- so there is no real linguistic loss of meaning. And then the cherry on top of this sundae is the fact that the uppercase mapping goes along well with what the filesystem and everyone else uses for case folding!</P>
<P>There is a separate question as to why Windows and the .NET Framework are both not smart enough to handle this situation and put the right character in place depending on whether you are at the end of a word. For now I'll point rather glibly that we should first fix how we handle <a href="http://archives.miloush.net/michkap/archive/2005/03/04/384927.html">stuff at the beginning of words</A>&nbsp;before we consider trying to tackle the endings!</P>
<P>&nbsp;</P>
<P><FONT color=#ff0000><EM>This post brought to you by</EM> "ς" <EM>and</EM> "σ" </FONT><EM><FONT color=#ff0000>(<A href="http://www.fileformat.info/info/unicode/char/03c2/index.htm">U+03c2</A> and <A href="http://www.fileformat.info/info/unicode/char/03c3/index.htm">U+03c3</A>, a.k.a. GREEK SMALL LETTER FINAL SIGMA&nbsp;and GREEK SMALL LETTER SIGMA)</FONT></EM></P>
<hr/><div style="margin-left: 1em"><em>no comments</em></div><hr/><p><em>referenced by</em></p><div style="margin-left: 1em"><p>2008/06/25 <a href="http://archives.miloush.net/michkap/archive/2008/06/25/8652525.html">Seeing the tears, my heart went out to her as I asked her "Why the Long S?"</a></p><p>2007/06/12 <a href="http://archives.miloush.net/michkap/archive/2007/06/12/3251648.html">The difference between 'Dangeous Characters' and 'Dangerous Minds' is the lack of Michelle Pfeiffer</a></p><p>2005/05/26 <a href="http://archives.miloush.net/michkap/archive/2005/05/26/421987.html">The last word on the FINAL SIGMA</a></p></div><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2005/04/04/405363.html" title="Two Birds of a Feather Sessions proposed for TechEd 2005">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2005/04/03/405071.html" title="TechEd Bloggers does not work for this site?">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2005-04">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2005-04-04">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2005/04/04/405174.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:42 GMT -->
</html>