<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2005/04/30/413676.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:41 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>Normalization vs. .NET text elements</title></head><body>
<h1>Normalization vs. .NET text elements</h1>
<p><em>by Michael S. Kaplan, published on 2005/04/30 03:39 -04:00, original URI: http://blogs.msdn.com/b/michkap/archive/2005/04/30/413676.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostNew -->
<P><FONT face=Tahoma>Ok, here is the updated code&nbsp;for&nbsp;<a href="http://archives.miloush.net/michkap/archive/2005/04/28/413019.html">that internationally savvy palindrome checker</A>. It supports that interesting situation with ligatures like <STRONG>ﬂ</STRONG> (U+fb02, a.k.a. LATIN SMALL LIGATURE FL) vs. an <STRONG>lf</STRONG> on the far side, originally suggested by our old friend&nbsp;<A href="http://www.geocities.com/mvaneerde/">Maurits</A>&nbsp;(with comments):</FONT></P>
<BLOCKQUOTE dir=ltr>
<P><FONT face=Tahoma><FONT face="Courier New" size=4><STRONG><FONT color=#008000>//////////////////////////////////////////<BR>//<BR>// IsPalindrome<BR>//<BR>// in : a string<BR>// out: true if the string passed in is&nbsp;a palindrome.<BR>//<BR>// NOTES: This function handles both canonical/compatibility<BR>//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; equivalences and grapheme clusters (a.k.a. text <BR>//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;elements) as defined by the Unicode Standard.<BR>//<BR>//////////////////////////////////////////<BR></FONT>bool IsPalindrome(string st) {</STRONG><BR><FONT face="Courier New" size=4>&nbsp;&nbsp;&nbsp; <FONT color=#008000><STRONG>// A null string or a ZLS is not a palindrome</STRONG></FONT><BR><STRONG>&nbsp;&nbsp;&nbsp; if ((null == st)&nbsp;|| (0 == st.Length))&nbsp;return false; </STRONG></FONT></P>
<P><STRONG>&nbsp;&nbsp;&nbsp; <FONT color=#008000>// Convert to NFKC&nbsp;and set up the&nbsp;text element detection object</FONT><BR>&nbsp;&nbsp;&nbsp; StringInfo si = new StringInfo(st.Normalize(NormalizationForm.FormKC));<BR>&nbsp;&nbsp;&nbsp; int count = si.LengthInTextElements;</STRONG></FONT></P>
<P><FONT face="Courier New" size=4><STRONG>&nbsp;&nbsp;&nbsp; for (int i = 0; i &lt; (count / 2); i++) {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <FONT color=#008000>// get the&nbsp;text elements for comparison</FONT><BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; string st1 = si.SubstringByTextElements(i, 1);<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; string st2 = si.SubstringByTextElements(count - i - 1, 1);</STRONG></FONT></P>
<P><FONT face="Courier New" size=4><STRONG>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <FONT color=#008000>// see if the text elements&nbsp;on each side are linguistuically equivalent</FONT><BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (CultureInfo.CurrentCulture.CompareInfo.Compare(st1, st2) != 0) {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<FONT color=#008000>// they are not, so it is not a palindrome.</FONT>&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return(false);<BR>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;}<BR>&nbsp;&nbsp;&nbsp; }</STRONG></FONT></P>
<P><FONT face="Courier New" size=4><STRONG>&nbsp;&nbsp;&nbsp; <FONT color=#008000>// both ends appear to be equivalent; it&nbsp;is a palindrome.</FONT><BR>&nbsp;&nbsp;&nbsp; return (true);<BR>}</STRONG></FONT></P></BLOCKQUOTE></FONT>
<P><FONT face=Tahoma>Now, <A href="http://www.geocities.com/mvaneerde/">Maurits</A>&nbsp;went on in his <A href="http://channel9.msdn.com/ShowPost.aspx?PostID=63297">Channel 9 posting</A>&nbsp;to discuss sort elements, or cases when two or more characters are to be given a single sort weight (kind of the opposite of an expansion like these ligatures). However, in my opinion these are not really suitable for a palindrome detection algorithm, as I don't think they are usually treated as letters except in the case where they are also treated as unique text elements (the case covered by the StringInfo code). </FONT></P>
<P><FONT face=Tahoma>Any native speakers of languages with such constructs as </FONT><FONT face=Tahoma>the Spanish <STRONG>ch</STRONG> and the Hungarian <STRONG>dzs</STRONG> who think they should or should not be treated as a unit in trying to detect palindomosity should feel free to leave a comment to that effect. Also, if any of my collagues in the GIFT group agree or disagree&nbsp;here (<STRONG><FONT color=#ff0000>and they are reading this!</FONT></STRONG>) they are invited to do the same (or stop me in the hall and accost me with this information!). </FONT></P>
<P><FONT face=Tahoma>If I mistaken on this point, then a very&nbsp;interesting problem develops since there is really not an easy method for detecting such cases given the current collation function set (although I can imagine a few avenues of attack and we obviously have the underlying data if we had to support an IsPalindome function in Win32 NLS!). This might even make an interesting interview question one day for a very talented candidate.... :-)</FONT></P>
<P><FONT face=Tahoma>Now, aside from all that, it is important to note that normalization makes some uses of text elements in this context completely unneccessary -- after all, either technology will treat <A href="http://www.fileformat.info/info/unicode/char/0061/index.htm">U+0061</A> <A href="http://www.fileformat.info/info/unicode/char/030a/index.htm">U+030a</A> (a + combining ring) as identical to <A href="http://www.fileformat.info/info/unicode/char/00e5/index.htm">U+00e5</A> (a ring), one by conversion and the other by giving identical sort weights. Therefore, there is some overlap between the two technologies. However, there are some differences:</FONT></P>
<UL>
<LI><FONT face=Tahoma>Normalization will handle those ligature characters, which although text comparison can usually handle, it cannot when the equivalent sequences are not directly compared.</FONT> 
<LI><FONT face=Tahoma>Text element comparisons will handle&nbsp;cases such as&nbsp;<A href="http://www.fileformat.info/info/unicode/char/0061/index.htm">U+0061</A> <A href="http://www.fileformat.info/info/unicode/char/030a/index.htm">U+030a</A>&nbsp;on both sides of the palindrome, rather than just handling two different normalized forms.</FONT> 
<LI><FONT face=Tahoma>Normalization will help treat larger ligatures like&nbsp;<FONT size=3><A href="http://www.fileformat.info/info/unicode/char/fdfa/index.htm">fdfa</A></FONT><FONT color=#000000 size=3>&nbsp;as equivalent to </FONT><A href="http://www.fileformat.info/info/unicode/char/0635/index.htm"><FONT size=3>0635</FONT></A><FONT size=3> </FONT><A href="http://www.fileformat.info/info/unicode/char/0644/index.htm"><FONT size=3>0644</FONT></A><FONT size=3> </FONT><A href="http://www.fileformat.info/info/unicode/char/0649/index.htm"><FONT size=3>0649</FONT></A><FONT size=3> </FONT><A href="http://www.fileformat.info/info/unicode/char/0020/index.htm"><FONT size=3>0020</FONT></A><FONT size=3> </FONT><A href="http://www.fileformat.info/info/unicode/char/0627/index.htm"><FONT size=3>0627</FONT></A><FONT size=3> </FONT><A href="http://www.fileformat.info/info/unicode/char/0644/index.htm"><FONT size=3>0644</FONT></A><FONT size=3> </FONT><A href="http://www.fileformat.info/info/unicode/char/0644/index.htm"><FONT size=3>0644</FONT></A><FONT size=3> </FONT><A href="http://www.fileformat.info/info/unicode/char/0647/index.htm"><FONT size=3>0647</FONT></A><FONT size=3> </FONT><A href="http://www.fileformat.info/info/unicode/char/0020/index.htm"><FONT size=3>0020</FONT></A><FONT size=3> </FONT><A href="http://www.fileformat.info/info/unicode/char/0639/index.htm"><FONT size=3>0639</FONT></A><FONT size=3> </FONT><A href="http://www.fileformat.info/info/unicode/char/0644/index.htm"><FONT size=3>0644</FONT></A><FONT size=3> </FONT><A href="http://www.fileformat.info/info/unicode/char/064a/index.htm"><FONT size=3>064A</FONT></A><FONT size=3> </FONT><A href="http://www.fileformat.info/info/unicode/char/0647/index.htm"><FONT size=3>0647</FONT></A><FONT size=3> </FONT><A href="http://www.fileformat.info/info/unicode/char/0020/index.htm"><FONT size=3>0020</FONT></A><FONT size=3> </FONT><A href="http://www.fileformat.info/info/unicode/char/0648/index.htm"><FONT size=3>0648</FONT></A><FONT size=3> </FONT><A href="http://www.fileformat.info/info/unicode/char/0633/index.htm"><FONT size=3>0633</FONT></A><FONT size=3> </FONT><A href="http://www.fileformat.info/info/unicode/char/0644/index.htm"><FONT size=3>0644</FONT></A><FONT size=3> </FONT><A href="http://www.fileformat.info/info/unicode/char/0645/index.htm"><FONT size=3>0645</FONT></A>, something that comparison will likely not ever be able to fully do (as discussed in my <a href="http://archives.miloush.net/michkap/archive/2005/01/31/363701.html">FoldString.NET post</A>).</FONT> 
<LI><FONT face=Tahoma>Text elements will handle text elements like <A href="http://www.fileformat.info/info/unicode/char/0e41/index.htm">0e41</A> <A href="http://www.fileformat.info/info/unicode/char/0e0b/index.htm">0e0b</A> <A href="http://www.fileformat.info/info/unicode/char/0e4c/index.htm">0e4c</A> (THAI CHARACTER SARA AE + THAI CHARACTER SO SO + THAI CHARACTER THANTHAKHAT) which may or may not have precomposed forms.</FONT> 
<LI><FONT face=Tahoma>Normalization will handle cases like Hangul Syllables versus Jamos, as is discussed <a href="http://archives.miloush.net/michkap/archive/2005/02/25/380266.html">here</A>, a fact that is less important now than it will be once font technologies catch up with Unicode and canonical/compatibility equivalences.</FONT></LI></UL>
<P><FONT face=Tahoma>So it is fair to say that both technologies as provided in the Whidbey release are potentially useful in (of all things) the detection of palindromes, today and tomorow. I am sure the people who spec'ed, developed, and tested these feature are very proud for the technologial advances!</FONT></P>
<P><FONT face=Tahoma></FONT>&nbsp;</P>
<P><FONT face=Tahoma><FONT color=#ff0000><EM>This post brought to you by</EM> "แซ์" <EM>(<A href="http://www.fileformat.info/info/unicode/char/0e41/index.htm">U+0e41</A> <A href="http://www.fileformat.info/info/unicode/char/0e0b/index.htm">U+0e0b</A> <A href="http://www.fileformat.info/info/unicode/char/0e4c/index.htm">U+0e4c</A>, a.k.a. THAI CHARACTERS SARA AE + SO SO + THANTHAKHAT)<BR><FONT size=1>The last two codepoints of which make up a text element, but all three of which make up a unique sort element!</FONT></EM></FONT></FONT></P>
<hr/><p><a id="413725" href="#413725">#</a> <strong>Krisztian Pinter</strong> on 30 Apr 2005 11:46 AM:</p><div style="margin-left: 1em">Just a quick note, somewhat off topic.<br><br>In Hungarian, there is no dsz letter. Here is the complete list of composed letters:<br><br>cs ccs dz ddz dzs gy ggy ly lly ny nny sz ssz ty tty zs zzs<br><br>Those that starts with double characters (ssz), are actually doubles (szsz -&gt; ssz). The only true three character letter is dzs. I don't know if it has a double like 'ddzs' because we have no words with this letter. But it can exist theoretically.</div>
<p><a id="413728" href="#413728">#</a> <strong>Michael S. Kaplan</strong> on 30 Apr 2005 11:51 AM:</p><div style="margin-left: 1em">Yep, thats what I thought -- these sort elements are not thought of as letters in and of themselves. ;-)<br><br>I'll talk more about Hungarian another day; the requirements for &quot;double compressions&quot; added some interesting challenges for both Windows and the .NET Framework....</div>
<p><a id="413729" href="#413729">#</a> <strong>Michael S. Kaplan</strong> on 30 Apr 2005 11:52 AM:</p><div style="margin-left: 1em">(re-reading your post) <br><br>Or are you saying that the other cases ARE thought of as letters?</div>
<p><a id="413984" href="#413984">#</a> <strong>krisztian pinter</strong> on 2 May 2005 11:33 AM:</p><div style="margin-left: 1em">hungarian ABC is like this<br><br>A &#193; B C CS D DZ DZS E &#201; ...<br><br>so the answer is, CS has the same rights as a letter, as C or F. it is one letter.<br><br>it sorts like a letter. CS comes later then C-Z<br><br>it hyphenates like a letter: never separated<br><br>so if you want me to be absolutely happy, you treat words of pattern &quot;sz...sz&quot; palindromes.</div>
<p><a id="413986" href="#413986">#</a> <strong>Michael S. Kaplan</strong> on 2 May 2005 11:47 AM:</p><div style="margin-left: 1em">Ah, that is an interesting development. It certainly puts a cat among the collation pigeons!<br><br>I'll give it a little thought, maybe post back with a comment or a post sometime soon. It is an interesting case where the data is present but is not really provided in a usable form for this type of inquiry....</div>
<p><a id="414001" href="#414001">#</a> <strong>Maurits [MSFT]</strong> on 2 May 2005 12:15 PM:</p><div style="margin-left: 1em">How does your code handle symbols?  Suppose I have an asymmetrically-symboled palindrome like<br><br>Madam, I'm Adam<br><br>Will this compare:<br>M to m - the same<br>a to a - the same<br>d to d - the same<br>a to A - the same<br>m to &quot; &quot; - different!  Not a palindrome.<br><br>Or does &quot; &quot; not count as a text element?</div>
<p><a id="414010" href="#414010">#</a> <strong>Maurits [MSFT]</strong> on 2 May 2005 12:28 PM:</p><div style="margin-left: 1em">I see...<br><br>What I ended up doing is allowing checkboxes for the various CompareOptions, with all of them checked by default (Ignore Case, Ignore Symbols, Ignore Kana, ...)<br><br>Then I would skip text elements that were &quot;the same as&quot; an empty string in my iterator.  By &quot;the same as&quot; I mean that Compare() returned 0.</div>
<p><a id="414007" href="#414007">#</a> <strong>Michael S. Kaplan</strong> on 2 May 2005 12:32 PM:</p><div style="margin-left: 1em">If you want case insensitivity, you'd have to pass the flag for it in that Compare call (CompareOptions.IgnoreCase). <br><br>A space is indeed a text element, or even part of one if you combine it with a non-spacing character....<br><br>As it stands right now, spaces would flummox the code, you'd have to add something to keep counters on both ends, skip elements that did not meet particular criteria (such as symbols or whitespace) and such.<br><br>Easy enough with the new CharUnicodeInfo class on the text element and the code points within it....</div>
<p><a id="414012" href="#414012">#</a> <strong>Maurits [MSFT]</strong> on 2 May 2005 12:38 PM:</p><div style="margin-left: 1em">I should say that I skipped all textelements &quot;e&quot; where<br><br>Compare(e, &quot;&quot;, co) == 0<br><br>for the particular CompareOptions &quot;co&quot; chosen by the caller.</div>
<p><a id="6817611" href="#6817611">#</a> <strong>Tanveer Badar</strong> on 20 Dec 2007 9:25 AM:</p><div style="margin-left: 1em"><p>Why didn't you do this</p>
<p>if ( string.IsNullOrEmpty( st ) ) return false;</p>
<p>instead of</p>
<p>if ((null == st) || (0 == st.Length)) return false;</p>
<p>Or are there any internationalization issues with IsNullOrEmpty?</p>
</div>
<p><a id="6818754" href="#6818754">#</a> <strong>Michael S. Kaplan</strong> on 20 Dec 2007 11:46 AM:</p><div style="margin-left: 1em"><p>No, it is just a choice to not push stack by mking it a method call. We all live in a world where we choose what code we will write (or if/when we will write code!).</p>
</div>
<hr/><p><em>referenced by</em></p><div style="margin-left: 1em"><p>2005/06/15 <a href="http://archives.miloush.net/michkap/archive/2005/06/15/429279.html">Once more into the palindrome</a></p></div><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2005/04/30/413720.html" title="Not perfect, but perfecting feedback loops">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2005/04/29/413553.html" title="Getting enough exercise?">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2005-04">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2005-04-30">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2005/04/30/413676.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:41 GMT -->
</html>