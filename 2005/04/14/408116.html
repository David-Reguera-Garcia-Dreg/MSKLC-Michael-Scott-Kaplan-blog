<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2005/04/14/408116.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:41 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>On approaching international programming....</title></head><body>
<h1>On approaching international programming....</h1>
<p><em>by Michael S. Kaplan, published on 2005/04/14 11:00 -04:00, original URI: http://blogs.msdn.com/b/michkap/archive/2005/04/14/408116.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostNew -->
<P><FONT face=Tahoma>Yesterday, someone named Ben posted the following <a href="http://archives.miloush.net/michkap/archive/2005/04/13/407823.html#408002">comment</A>&nbsp;to my post <a href="http://archives.miloush.net/michkap/archive/2005/04/13/407823.html"><FONT color=#0000ff>Invariant and Ordinal Redux</FONT></A>:</FONT></P>
<BLOCKQUOTE dir=ltr>
<P><FONT face=Tahoma size=2><EM>I appreciate your enthusiasm for picking out common programming errors like this, but as a professional programmer, I find a lot of these internationalization parameters confusing. <BR>How do I know if I need to pass the NORM_IGNOREKANATYPE flag to CompareString? How do I know if I want LOCALE_USER_DEFAULT or LOCALE_SYSTEM_DEFAULT, or some other locale? <BR><BR>I simply don't know. Unless I learn Japanese, or know someone who knows Japanese, I'll never know the answer. The trouble is that the APIs feel like they were written by linguists. <BR><BR>Me? I just want to compare filenames, or compare entries in a hash table, or compare usernames, etc. I don't want to even have the choice of ignoring kana types. I just want the CompareStrings API do the *right thing* out of the box. If that is too hard for a single function, then let's write some API sets that are easy to use for common cases. I think this would be a more useful endeavor than to write articles about the nuances between CT_CTYPE3 and CT_CTYPE2. <BR><BR>Sometimes less choice is better. Please please finish that list of do's and don'ts. Please please make a list of "If you want to sort like a dictionary, do this... If you want to put filenames into a hash table, do this..."</EM></FONT></P></BLOCKQUOTE><FONT face=Tahoma>
<P><FONT face=Tahoma>My initial reaction was to point out that the APIs were not written by linguists -- but the developers had expert advice from linguists when the functionality was exposed. </FONT></P>
<P>My&nbsp;second&nbsp;reaction was a technical one, thinking of which ones I had already covered (like <a href="http://archives.miloush.net/michkap/archive/2005/02/01/364707.html">What is my locale? Well, which locale do you mean?</A>&nbsp;answering some that locale question) and which ones might make good future posts (like the care and feeding of NORM_IGNOREKANATYPE) and so on.</FONT></P><FONT face=Tahoma>
<P>My&nbsp;third reaction was to slow down this "developer" in me trying to solve the technical problem and look to what was really being suggested. Unfortunately, Ben's supposition is correct -- the APIs are complicated, and there is too much functionality to try to distill into simple usage without having detailed articles about the nuances. Articles that could be read by the kind of devs who try to solve the problem you indicated.</FONT></P>
<P><FONT face=Tahoma>In a very&nbsp;real and almost biblical sense, one can talk about "<A href="http://msdn.microsoft.com/library/en-us/winui/winui/windowsuserinterface/resources/strings/stringreference/stringfunctions/comparestring.asp">CompareString</A> which begat <A href="http://msdn.microsoft.com/library/en-us/winui/winui/windowsuserinterface/resources/strings/stringreference/stringfunctions/lstrcmp.asp">lstrcmp</A> and <A href="http://msdn.microsoft.com/library/en-us/winui/winui/windowsuserinterface/resources/strings/stringreference/stringfunctions/lstrcmpi.asp">lstrcmpi</A> in the USER kingdom, and was fruitful an multiplied in the SHELL kingdom and begat&nbsp;<A href="http://msdn.microsoft.com/library/en-us/shellcc/platform/shell/reference/shlwapi/string/strcmp.asp">StrCmp</A>, <A href="http://msdn.microsoft.com/library/en-us/shellcc/platform/shell/reference/shlwapi/string/strcmpi.asp">StrCmpI</A>, <A href="http://msdn.microsoft.com/library/en-us/shellcc/platform/shell/reference/shlwapi/string/intlstreqn.asp">IntlStrEqN</A>, <A href="http://msdn.microsoft.com/library/en-us/shellcc/platform/shell/reference/shlwapi/string/intlstreqni.asp">IntlStrEqNI</A>, <A href="http://msdn.microsoft.com/library/en-us/shellcc/platform/shell/reference/shlwapi/string/strcmpn.asp">StrCmpN</A>, <A href="http://msdn.microsoft.com/library/en-us/shellcc/platform/shell/reference/shlwapi/string/strcmpni.asp">StrCmpNI</A>, <A href="http://msdn.microsoft.com/library/en-us/shellcc/platform/shell/reference/shlwapi/string/strisintlequal.asp">StrIsIntlEqual</A>, some of whom later begat <A href="http://msdn.microsoft.com/library/en-us/shellcc/platform/shell/reference/shlwapi/string/strcmplogicalw.asp">StrCmpLogicalW</A>. And in that kingdom functions which were not begat from <A href="http://msdn.microsoft.com/library/en-us/winui/winui/windowsuserinterface/resources/strings/stringreference/stringfunctions/comparestring.asp">CompareString</A> also flourished like those that used the C rules -- <A href="http://msdn.microsoft.com/library/en-us/shellcc/platform/shell/reference/shlwapi/string/strcmpc.asp">StrCmpC</A>, <A href="http://msdn.microsoft.com/library/en-us/shellcc/platform/shell/reference/shlwapi/string/strcmpic.asp">StrCmpIC</A>, <A href="http://msdn.microsoft.com/library/en-us/shellcc/platform/shell/reference/shlwapi/string/strcmpnc.asp">StrCmpNC</A>, and <A href="http://msdn.microsoft.com/library/en-us/shellcc/platform/shell/reference/shlwapi/string/strcmpnic.asp">StrCmpNIC</A>. And in the kingdom of .NET the managed brother <A href="http://msdn.microsoft.com/library/en-us/cpref/html/frlrfsystemglobalizationcompareinfoclasstopic.asp">CompareInfo</A> was also fruitful and begat the five overloads of <A href="http://msdn.microsoft.com/library/en-us/cpref/html/frlrfsystemstringclasscomparetopic.asp">String.Compare</A>&nbsp;and in Whidbey begat the&nbsp;<A href="http://msdn2.microsoft.com/library/5hc8kytd.aspx">StringComparer</A> class and the <A href="http://msdn2.microsoft.com/library/8d9k4871.aspx">StringComparison</A> enumeration. And <A href="http://msdn.microsoft.com/library/en-us/cpref/html/frlrfsystemglobalizationcompareinfoclassisprefixtopic.asp">CompareInfo.IsPrefix</A> and its overrides begat <A href="http://msdn.microsoft.com/library/en-us/cpref/html/frlrfsystemstringclassstartswithtopic.asp">String.StartsWith</A>. And&nbsp;<A href="http://msdn.microsoft.com/library/en-us/cpref/html/frlrfsystemglobalizationcompareinfoclassissuffixtopic.asp">CompareInfo.IsSuffix</A>&nbsp;and its overrides begat <A href="http://msdn.microsoft.com/library/en-us/cpref/html/frlrfsystemstringclassendswithtopic.asp">String.EndsWith</A>. And..."</FONT></P>
<P><FONT face=Tahoma>Of course what the SHELL folks and the BCL folks did showed that in attempting to simplify individual functionalities into single APIs, you cause an explosion of simple APIs that are also very tough to unravel what to use. </FONT></P>
<P><FONT face=Tahoma>Topically modifying what Hal Holbook said on <STRONG>The West Wing</STRONG> (playing the cantankerous Albie Duncan) in the episode <STRONG>Game On</STRONG>: </FONT></P>
<BLOCKQUOTE dir=ltr>
<P><FONT face=Tahoma><EM>It's not simple. It's incredibly complicated. I've been doing NLS work for over 10 years and there is no right answer to these questions and software development needs all the words it can get its hands on...</EM></FONT></P></BLOCKQUOTE>
<P><FONT face=Tahoma>I could tell you when it is ok to use <A href="http://msdn.microsoft.com/library/en-us/winui/winui/windowsuserinterface/resources/strings/stringreference/stringfunctions/lstrcmp.asp">lstrcmp</A> and <A href="http://msdn.microsoft.com/library/en-us/winui/winui/windowsuserinterface/resources/strings/stringreference/stringfunctions/lstrcmpi.asp">lstrcmpi</A>&nbsp;and <A href="http://msdn.microsoft.com/library/en-us/shellcc/platform/shell/reference/shlwapi/string/strcmplogicalw.asp">StrCmpLogicalW</A>. &nbsp;I could not even try to tell you how to navigate the rest of that stuff in the Shell or a lot of the stuff in .NET, even though a lot of it calls right into us. Because to me it is just a decision of whether one wants one's complexities to be horizontal or vertical, with the bonus of the vertical complexity (the NLS kind) being that all of the functionality is there, versus the individual McNugget that the developer was trying to surface in the simplified method, which will always be missing one or more of the functionalities that are possible, despite seeming to me to be a lot more complex....</FONT></P>
<P><FONT face=Tahoma>So while I will give practical advice from time to time like&nbsp;(like "use the new OrdinalIgnoreCase type comparisons when trying to imitate the OS, because the OS does not know CompareString from Cholesterol"), the bulk of what I say will be exploring that vertical space of the NLS managed and unmanaged APIs and how best to use them to get the results you want. </FONT></P>
<P><FONT face=Tahoma>Because the problem I have personally with the horiztonal space is that when you have to change behavior because the call did not do what you thought it did, the change is more than just passing a new flag; it is often calling a whole new function in a whole new way (just take the <A href="http://msdn.microsoft.com/library/en-us/cpref/html/frlrfsystemstringclassstartswithtopic.asp">String.StartsWith</A>&nbsp;method as an example -- if you want to do some operations you have to move to&nbsp;<A href="http://msdn.microsoft.com/library/en-us/cpref/html/frlrfsystemglobalizationcompareinfoclassisprefixtopic.asp">CompareInfo.IsPrefix</A>, which has entirely different calling semantics (one is a static method that takes two strings, the other is an instance method on a string). Or if I want to change the STRINGSORT/WORDSORT behavior of <A href="http://msdn.microsoft.com/library/en-us/shellcc/platform/shell/reference/shlwapi/string/strcmp.asp">StrCmp</A>, I have to go figure out all the parameters of <A href="http://msdn.microsoft.com/library/en-us/winui/winui/windowsuserinterface/resources/strings/stringreference/stringfunctions/comparestring.asp">CompareString</A>&nbsp;now, which if I had done in the first place I would not have been trapped in the Sargasso of SHLWAPI.</FONT></P>
<P><FONT face=Tahoma>Hopefully this fits with the model people are expecting here. If not then maybe the Shell or BCL folks will step up and work to provide the uber-conversion charts to know when to call which of the 30 methods&nbsp;that are all designed to simplify the five methods that NLS provides (or in the unmanaged world the 30 functions designed to simplify the one function). </FONT></P>
<P><FONT face=Tahoma>Simplification is just too complex for me. :-)</FONT></P>
<P><FONT face=Tahoma></FONT>&nbsp;</P>
<P><FONT face=Tahoma><FONT color=#ff0000><EM>This post brought to you by</EM> "A" </FONT><EM><FONT color=#ff0000>(<A href="http://www.fileformat.info/info/unicode/char/0041/index.htm">U+0041</A>, LATIN CAPITAL LETTER A)</FONT><BR><FONT size=1>After Happy Days&nbsp;went off the air and everybody realized the Fonz was short, the letter behind&nbsp;"Aaaaay" had its reputation injured a bit andis looking to expand into new markets, like this blog!</FONT></EM></FONT></P>
<hr/><p><a id="408129" href="#408129">#</a> <strong>Barry Kelly</strong> on 14 Apr 2005 10:05 AM:</p><div style="margin-left: 1em">I think that some hard-and-simple rules could be learned and used by people whose jobs relate to a more focussed subset of functionality.<br><br>I'm a application server developer: I write the application server. The language / regional settings of the current OS installation mean very little to me. When I compare strings, I want to do so under two fundamental conditions:<br><br>1) Comparisons for internal object names. Things that the application developer writing applications using my application server and framework might like to use their own language for, but must act identically on another machine with a different developer / language settings set.<br><br>2) A configurable bundle of client-specific settings which is associated with the current client request / response cycle.<br><br>3) A configurable bundle of server-specific settings which is associated with a given application living in the application server framework, and determines how the server will interact with things local to it, like the database server (date formats, time-zone settings, and other wonderful friends).<br><br>It seems to me that their could be objects (let's call it Context to avoid wars, containing everything from culture / date formatting to language and regional settings) available &quot;out there&quot; with methods like Compare, etc. which encapsulates each one of these programmer use cases, but overridden to suit the correct semantics. Ideally, they would be as opaque to the programmer as possible, and have a simple serialization format and OS/Framework provided editor (think of the ACL editor in the OS) so that application administrators could make most of these decisions, as long as the application programmer is using the correct object in each case.<br><br>So, at the start of my application server in my example above, I would load up two Context instances, one for internal operations (defined internally) and another for server operations (defined by the application administrator). <br><br>At the start of every request / response cycle, I'd load up an appropriate Context for the location of the client, and attach that to the request.<br><br>Some kind of scheme like this, a one-stop shop where you make all the relevant decisions for a given use-case *once*, rather than over and over again,<br>would seem to me to be far preferable to the current specialist approach, where bits and pieces associated with the hypothetical Context need to be cobbled together from various locations.</div>
<p><a id="408140" href="#408140">#</a> <strong>Michael S. Kaplan</strong> on 14 Apr 2005 10:33 AM:</p><div style="margin-left: 1em">Hi Barry!<br><br>Interesting information, but of course for a highly specialized domain. I see two problems:<br><br>1) The actual implementaion will not be this simple, as there will need to either be many configuration options to tweak, or you will force many users to have to go back to the old way of doing stuff. Andd as a bonus frustrated them even more han if the APIs were explained in the first place!<br><br>2) If such a framework were added on top of all that is there then it is very similar to what the Shell folks and the .NET folks have done, adding yet another way to do stuff, which will be great for some and useless for others. And yet another set of items on the list that everyone has to deal with, which adds to the complexity. :-(<br><br>Though trying to do something here would make sense, it is unclear how to do something that does not get added (like the Shell APIs) as one more way to do things that does not match every scenario.</div>
<p><a id="408320" href="#408320">#</a> <strong>Dean Harding</strong> on 14 Apr 2005 7:47 PM:</p><div style="margin-left: 1em">I think it's just a fundamental problem with trying to please an international audience when you can't, in fact, know what they're expecting in the first place.  I mean, I don't know all the intracasies of CJK so I don't know whether I should be passing NORM_IGNORECASE or NORM_IGNOREKANATYPE or NORM_IGNORENONSPACE when sorting a list for them, unless someone actually tells me...<br><br>I think the best we can hope to achieve as mere mortal developers, is to do the best we can, and be prepared to fix bugs when the international users start putting our assumptions to the test. :)</div>
<p><a id="408334" href="#408334">#</a> <strong>Michael S. Kaplan</strong> on 14 Apr 2005 8:52 PM:</p><div style="margin-left: 1em">For *that* problem, there is no answer -- there is no API that will help a person understand every aspect of a language sbout which they know little.... :-)</div>
<p><a id="408339" href="#408339">#</a> <strong>Dean Harding</strong> on 14 Apr 2005 9:20 PM:</p><div style="margin-left: 1em">That's right.  Reading over my post before, I don't think I was very coherant (it was early morning here and I hadn't had my coffee yet ;).<br><br>I think what I mean is that because we don't know the expected behaviour in every case, then we can't be expected to get it right in the first place.  If we can't expect to get it right in the first place, then we have to expect to fix bugs later on.<br><br>And I agree with you that having a single &quot;complex&quot; API which does everything is better in this case, because changing the behviour is a simple case of changing flags.<br><br>Also, the documentation is all in one place.  It's much better (in my opinion) to say &quot;OK, I want to compare these strings.  That means CompareString!  Now, which flags do I pass?&quot;  And then looking up the documentation of the CompareString function and seeing all the possible flags in one place.  Rather than saying &quot;OK, I want to compare these strings.  Which function do I use?  StrCmp?  StrCmpI?  StrCmpLogicalW?&quot;  And then having to look through the documentation for all those functions and trying to figure out which is more appropriate, and trying to figure out any other functions I may have forgotten about.<br><br>However, I think it's also important to have good defaults, so that at least we get things right in &quot;most&quot; cases :)  Perhaps even having a list of common scenarios with the expected usage of each function would help greatly.<br><br>Hmm, I think that was a bit more coherent...</div>
<p><a id="408342" href="#408342">#</a> <strong>Michael S. Kaplan</strong> on 14 Apr 2005 9:38 PM:</p><div style="margin-left: 1em">Definitely so -- very clear. And not just because you agree with me, though of course that never hurts.<br><br>At some point a post that relly goes through all the flags and their uses might be interesting....</div>
<hr/><p><em>referenced by</em></p><div style="margin-left: 1em"><p>2006/05/04 <a href="http://archives.miloush.net/michkap/archive/2006/05/04/589656.html">Sort the words, sort the strings</a></p><p>2005/06/12 <a href="http://archives.miloush.net/michkap/archive/2005/06/12/428429.html">Browsing the shoals of managed string comparisons</a></p></div><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2005/04/14/408239.html" title="Comments work here (though not so you&#39;d really notice or anything)">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2005/04/13/407912.html" title="AVICAP32.DLL sucks (from the MSLU point of view)">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2005-04">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2005-04-14">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2005/04/14/408116.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:41 GMT -->
</html>