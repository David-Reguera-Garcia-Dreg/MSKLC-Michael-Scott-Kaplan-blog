<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2005/08/31/458266.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:41 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>Sometimes it *does* pay to be neutral</title></head><body>
<h1>Sometimes it *does* pay to be neutral</h1>
<p><em>by Michael S. Kaplan, published on 2005/08/31 03:03 -04:00, original URI: http://blogs.msdn.com/b/michkap/archive/2005/08/31/458266.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostNew -->
<P><FONT face=Tahoma>I can hardly believe it has been a year since I asked and answered the questions <a href="http://archives.miloush.net/michkap/archive/2004/12/29/343557.html">What is a neutral culture? What is a neutral locale?</A></FONT></P>
<P><FONT face=Tahoma>I spent a bunch of time talking about how lame neutral locales were on Wn32 given how they are not supported by any of the NLS functions.</FONT></P>
<P><FONT face=Tahoma>They are very useful for resources though, something Stuart reminded me of the other day when he asked the following question in the newsgroups:</FONT></P>
<BLOCKQUOTE dir=ltr style="MARGIN-RIGHT: 0px">
<P><FONT face=Tahoma><FONT face="Times New Roman" size=2><EM>In XP my user is set to German (Switzerland) and in my COM dll (built in Visual Studio 6) I have resources for German (Germany) and English (U.S.)</EM></FONT></FONT></P>
<P><FONT face=Tahoma><FONT face="Times New Roman" size=2><EM>However the German (Germany) string table is ignored and the LoadString win32 call loads the English (U.S.) resource.</EM></FONT></FONT></P>
<P><FONT face=Tahoma><FONT face="Times New Roman" size=2><EM>Why is the German (Switzerland) user loading the English (U.S.) resource?</EM></FONT></P></FONT></BLOCKQUOTE>
<P><FONT face=Tahoma>Well, once upon a time this is what may have happened -- if you look at the section of Chapter 4 of the first edition of Developing International Software for Windows 95 and Windows NT entitled <A href="http://www.microsoft.com/globaldev/dis_v1/disv1.asp?DID=dis16d&amp;File=S24B3_b.asp">Multiple Language Resources</A>:</FONT></P>
<BLOCKQUOTE>
<P>On Windows NT, <I>FindResource</I> searches for resources tagged with the language ID of the calling thread. On Windows 95, it searches for resources tagged with the default system language ID. On Windows NT, you can search for a resource in a specific language by calling <I>FindResourceEx, </I>which takes a language ID as a parameter. Both <I>FindResource</I> and <I>FindResourceEx</I> first attempt to find a resource tagged with a language ID, as described above. If they don't find anything, they then search for a resource tagged with the same primary language as that of the specified language ID. (If several resources with the same primary language but different sublanguages exist, the functions will return whatever they encounter first.) If, for example, the program requests resources in Standard German that aren't available, the program can retrieve Austrian German or Swiss German resources and still provide a user interface that the user can understand.</P>
<P>If the <I>FindResource</I> and <I>FindResourceEx</I> functions do not find any resources that match the language ID's primary language, they search for resources tagged as "language-neutral." This language ID is useful for resource elements such as icons or cursors that are identical for all languages. If a bitmap or an icon will differ for some languages, you can define one language-neutral bitmap as the default and specify language IDs for as many other customized bitmaps as required. For example, bidirectional applications might require bitmaps with right-to-left directionality. Because the <I>FindResource</I> and <I>FindResourceEx</I> functions always search for specific language IDs first, they will always find a bitmap tagged with that language ID before they find one tagged as language-neutral. The search algorithm they follow is summarized in the following list:</P>
<OL>
<LI>Primary language/sublanguage 
<LI>Primary language 
<LI>Language-neutral 
<LI>English (skipped if primary language is English) 
<LI>Any </LI></OL></BLOCKQUOTE>
<P><FONT face=Tahoma>But a lot has changed since this book was published (hell, just after the section I quoted is the one that talks about how you can use <A href="http://msdn.microsoft.com/library/en-us/intl/nls_52lh.asp">SetThreadLocale</A> to choose the language and if you are a regular reader here then <a href="http://archives.miloush.net/michkap/archive/2005/08/22/454360.html">you know how I feel about SetThreadLocale</A>.</FONT></P>
<P><FONT face=Tahoma>But there have been other changes in resource loading since NT 3.1 and Windows 95 that invalidate some of the priorities in resource loading. To understand why, </FONT><FONT face=Tahoma>it might be a good idea to think back to my post in May when I talked about <a href="http://archives.miloush.net/michkap/archive/2005/05/17/418372.html">The weird, weird world of the SUBLANGID</A>. The truth is that each of these locales is different, and there are times that the behavior Stuart wanted (<EM>if not the&nbsp;full language I wanted, give me something close</EM>) may actually cause more problems then it could solve. Possibly not for German, but you never know. And t</FONT><FONT face=Tahoma>here are times that you want to define an entirely different fallback logic, such as Basque or Catalan falling back to Spanish. and times that you do not want Bosnian to fall back to Croatian (or Simplified Chinese to fall back to Traditional Chinese).</FONT></P>
<P><FONT face=Tahoma>So things had to change, they really did. And they have been changing over the last few versions.</FONT></P>
<P><FONT face=Tahoma>The specific change prior to Windows Vista is to meet the same numbered steps as above, skipping the text above the list, i.e. <FONT face="Times New Roman"><EM>(If several resources with the same primary language but different sublanguages exist, the functions will return whatever they encounter first.)</EM></FONT>.</FONT></P>
<P><FONT face=Tahoma>(At this point, people pretty much universally recommend that "best practice" in this case involves separate language resource DLLs, one per language. I will get into why this is the case at a later time.)</FONT></P>
<P><FONT face=Tahoma>But specifically it is important if you do not want to follow the multiple DLL advice that you use neutral language resources to use a language that you want to have all of the various specific locales fall back upon. As I mentioned back in June, </FONT><A id=_ctl0__ctl0__ctl0__ctl0_CategoryView__ctl0_postlist__ctl0_EntryItems__ctl26_PostTitle href="http://archives.miloush.net/michkap/archive/2005/06/13/428570.html"><FONT face=Tahoma>Using full locales rather than the neutral ones</FONT></A><FONT face=Tahoma>&nbsp;is often not a terribly good idea.</FONT></P>
<P><FONT face=Tahoma>Because sometimes, it pays to be neutral!</FONT></P>
<P><FONT face=Tahoma><EM>(Editorial request of readers who wish to comment&nbsp;-- I would prefer if comments if any for this post <STRONG>not</STRONG> try to get into the religious issue of separate language resource DLLs and limit themselves to the religious issue of neutral vs. specific resources. I promise I will be covering the other issue soon!)</EM></FONT></P>
<P><FONT face=Tahoma></FONT>&nbsp;</P>
<P><FONT face=Tahoma color=#ff0000><EM>This post brought to you by</EM> "â‚¦" <EM>(<A href="http://www.fileformat.info/info/unicode/char/20a6/index.htm">U+20a6</A>, NAIRA SIGN)</EM></FONT></P>
<hr/><p><a id="458355" href="#458355">#</a> <strong>Vorn</strong> on 31 Aug 2005 4:41 AM:</p><div style="margin-left: 1em">Off topic for this post, but not exactly for this blog, the linked URL describes what happens when MacOS X comes across a character it has no glyph for, in particular in the private-use area.  And, yeah, that's me.<br><br>Vorn</div>
<p><a id="458412" href="#458412">#</a> <strong>Michael S. Kaplan</strong> on 31 Aug 2005 9:26 AM:</p><div style="margin-left: 1em">Yes, the Apple 'ultimate fallback' font, if no font can be found with the infomation....</div>
<p><a id="458414" href="#458414">#</a> <strong>Michael S. Kaplan</strong> on 31 Aug 2005 9:31 AM:</p><div style="margin-left: 1em">I will actually be talking a big about a few features I like among our Macintoshian bretheren some day soon....</div>
<p><a id="458883" href="#458883">#</a> <strong>Michael S. Kaplan</strong> on 31 Aug 2005 10:55 PM:</p><div style="margin-left: 1em">I can't believe there were no dissenting opinions on the question of neutral versus specific resource tagging.... amazing!</div>
<p><a id="458941" href="#458941">#</a> <strong>Martin Bohring</strong> on 1 Sep 2005 3:34 AM:</p><div style="margin-left: 1em">Hey this is interesting on more than one level, because Switzerland is one of the countries claiming to be neutral.</div>
<p><a id="458968" href="#458968">#</a> <strong>Stuart Barlow</strong> on 1 Sep 2005 6:19 AM:</p><div style="margin-left: 1em">Thanks for the blog Michael. Your previous posts on SUBLANG_NEUTRAL were the best links that Google gave me when I first hit the issue. :-) I guess that the old visual studio 6 circa 1998 (only 7 years old) is pushing down a specific locale route?</div>
<p><a id="459009" href="#459009">#</a> <strong>Michael S. Kaplan</strong> on 1 Sep 2005 9:27 AM:</p><div style="margin-left: 1em">Hey Martin -- yep, that was kind of a baiting example, wasn't it? :-)</div>
<p><a id="459011" href="#459011">#</a> <strong>Michael S. Kaplan</strong> on 1 Sep 2005 9:33 AM:</p><div style="margin-left: 1em">Good point, Stuart. Though I think there were neutral entries in my VS6 resource file creations, and I always wondered how they got them listed?<br><br>It seems like the option is gone now, so I guess they went to a model that uses the NLS API 100% of the time, so since we do not support them, neither do they. Though you could still get it by editing the .RC file directly....</div>
<p><a id="460507" href="#460507">#</a> <strong>Tialaramex</strong> on 3 Sep 2005 8:26 AM:</p><div style="margin-left: 1em">Pango (under Unix) renders apparently valid Unicode characters for which no real glyph is available (in any chosen typeface or fallback) as a box containing the hexadecimal code point.<br><br>So on most freshly installed Linux boxes, the Linear B character 'Wheel' appears as a box with the digits 0100CF<br><br>I think this offers a unique combination of minimum ambiguity - they're obviously not &quot;real&quot; characters unlike the Mac OS examples, and maximum diagnostic value - a technical support person or 12 year old child can look up 0100CF in the Unicode table, see that it's a Linear B ideogram, do a Google search and download a font file. Drag font into fonts folder, reload, glyph appears. No special tools needed.<br><br>The SUBLANGID hilarity reminds me of a bug reported recently to the Gnumeric user list, the user complained that despite living in the UK, their copy of Gnumeric insisted on using dollars etc. It turned out that they had manually specified a locale string of en_UK.UTF-8 instead of the correct en_GB.UTF-8. After the fix was explained they quite reasonably asked what locale in this case should be used by people from Northern Ireland (which is surely in the United Kingdom, but not part of Great Britain). The answer is that ISO country codes are opaque strings, no matter how much it may appear otherwise.</div>
<hr/><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2005/09/01/459019.html" title="The calendar applet limps along">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2005/08/30/457960.html" title="Keyboard Convert Service goes Bidi!">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2005-08">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2005-08-31">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2005/08/31/458266.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:41 GMT -->
</html>