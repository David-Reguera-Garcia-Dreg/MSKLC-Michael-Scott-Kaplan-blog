<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2005/08/03/447224.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:41 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>The further you look into it, the further things stick out</title></head><body>
<h1>The further you look into it, the further things stick out</h1>
<p><em>by Michael S. Kaplan, published on 2005/08/03 13:20 -04:00, original URI: http://blogs.msdn.com/b/michkap/archive/2005/08/03/447224.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostNew -->
<P><FONT face=Tahoma>This line from a David Byrne song has a lot of truth in it and it could be applied well to collation. :-)</FONT></P>
<P><FONT face=Tahoma>Just recently I was reading some posts from <A href="http://d.hatena.ne.jp/atsushieno/">ものがたり (diary for AtsushiEno)</A>, specifically from June 17th of this year, <A href="http://d.hatena.ne.jp/atsushieno/20050617">here</A>.</FONT></P>
<P><FONT face=Tahoma>The first post is entirely correct -- code such as </FONT></P>
<BLOCKQUOTE dir=ltr style="MARGIN-RIGHT: 0px">
<P><FONT face="Courier New"><STRONG>CompareInfo ci = CultureInfo.InvariantCulture.CompareInfo;<BR>Console.WriteLine (ci.Compare ("\u25EF", "\u25B6",&nbsp;CompareOptions.IgnoreNonSpace));</STRONG></FONT></P></BLOCKQUOTE>
<P><FONT face=Tahoma>will indeed take two very different symbols (◯ and ▶, a.k.a. LARGE CIRCLE and BLACK RIGHT-POINTING TRIANGLE) which happen to have similar weights and you start ignoring secondary distinctions, you may find random things to be "equal".</FONT></P>
<P><FONT face=Tahoma>Now I do not want to argue the philosophical issues about this being good or bad, but I do know that there is only a limited amount of space in the collation weight table, and using that limited space to make sure that symbols which do not need linguistic differentiation have unique weights is not in the best interests of anyone.</FONT></P>
<P><FONT face=Tahoma>After consulting with our data PM, I re-ordered the source file to be by weight, and it was interesting to see some of the items that found themselves sorted together like this!</FONT></P>
<P><FONT face=Tahoma>But it does get back to meaningful comparisons, and proper usage.</FONT></P>
<P><FONT face=Tahoma>The second post was even more interesting, though the description is off&nbsp;-- the results of the code </FONT></P>
<BLOCKQUOTE dir=ltr style="MARGIN-RIGHT: 0px">
<P><FONT face=Tahoma><FONT face="Courier New"><STRONG>CompareInfo ci = CultureInfo.InvariantCulture.CompareInfo;<BR>Console.WriteLine ("AE".IndexOf ('\u00C6'));<BR>Console.WriteLine ("AE".IndexOf ("\u00C6"));<BR>Console.WriteLine (ci.IndexOf ("AE", '\u00C6'));</STRONG></FONT></FONT></P></BLOCKQUOTE>
<P><FONT face=Tahoma>seem to indicate that string.IndexOf(char) is indeed doing an ordinal comparison, not just a culturally insensitive one (the first one returns -1, the others return 0).</FONT></P>
<P><FONT face=Tahoma>This one seems like a bug to me, though it is a longstanding one (it happens in 1.0, 1.1, and 2.0). It might be easier to document at this point rather than change the behavior (one never knows who might be relying on it!).</FONT></P>
<P><FONT face=Tahoma>For the sake of completeness, I'll draw this code out a little further:</FONT></P>
<BLOCKQUOTE dir=ltr style="MARGIN-RIGHT: 0px">
<P><FONT face="Courier New"><STRONG>Console.WriteLine("AE".IndexOf('\u00c6'));<BR>Console.WriteLine("AE".IndexOf("\u00c6"));<BR><BR>CompareInfo ci = CultureInfo.InvariantCulture.CompareInfo;<BR>Console.WriteLine(ci.IndexOf("AE", '\u00c6'));<BR>Console.WriteLine(ci.IndexOf("AE", "\u00c6"));<BR>Console.WriteLine(ci.IndexOf("AE", '\u00c6', CompareOptions.Ordinal));<BR><BR>ci = new CultureInfo("is-IS").CompareInfo;<BR>Console.WriteLine(ci.IndexOf("AE", '\u00c6'));<BR>Console.WriteLine(ci.IndexOf("AE", "\u00c6"));<BR>Console.WriteLine(ci.IndexOf("AE", '\u00c6', CompareOptions.Ordinal));</STRONG></FONT></P></BLOCKQUOTE>
<P><FONT face=Tahoma>The results here? They will be:</FONT></P>
<BLOCKQUOTE dir=ltr style="MARGIN-RIGHT: 0px">
<P><FONT face="Courier New"><STRONG>-1<BR>0<BR>0<BR>0<BR>-1<BR>-1<BR>-1<BR>-1</STRONG></FONT></P></BLOCKQUOTE>
<P><FONT face=Tahoma>Now the first one is the issue that was pointed out originally, and the next three show what happens when the NLS collation stuff kicks in. The fifth and eighth items show that when you force an ordinal comparison, you get the same behavior as that initial one. And the sixth and seventh items show what happens if you are doing the comparison in the context of a langauge that has other ideas about the AE ligature -- they will not treat it as equivalent to the letters A and E.</FONT></P>
<P><FONT face=Tahoma>Both interesting issues, and it is cool to see people noticing what happens with collation!</FONT></P>
<P><FONT face=Tahoma></FONT>&nbsp;</P>
<P><FONT face=Tahoma color=#ff0000><EM>This post brought to you by</EM> "▶" <EM>(<A href="http://www.fileformat.info/info/unicode/char/25b6/index.htm">U+25b6</A>, a.k.a. BLACK RIGHT-POINTING TRIANGLE)<BR><FONT size=1>A symbol that is quite insistent that she and her friend U+25ef (LARGE CIRCLE) are just good friends</FONT></EM></FONT></P>
<P><FONT face=Tahoma></FONT>&nbsp;</P>
<hr/><p><a id="447287" href="#447287">#</a> <strong>Atsushi Eno</strong> on 3 Aug 2005 2:14 PM:</p><div style="margin-left: 1em">Haha, I wonder if you can read that Japanese text. BTW a few weeks ago I summarized almost all thoughts I wrote in those Japanese pages in English:<br><a rel="nofollow" target="_new" href="http://monkey.workarea.jp/lb/archive/2005/6-22.html">http://monkey.workarea.jp/lb/archive/2005/6-22.html</a><br><a rel="nofollow" target="_new" href="http://monkey.workarea.jp/lb/archive/2005/6-23.html">http://monkey.workarea.jp/lb/archive/2005/6-23.html</a><br><a rel="nofollow" target="_new" href="http://monkey.workarea.jp/lb/archive/2005/6-24.html">http://monkey.workarea.jp/lb/archive/2005/6-24.html</a><br><a rel="nofollow" target="_new" href="http://monkey.workarea.jp/lb/archive/2005/6-25.html">http://monkey.workarea.jp/lb/archive/2005/6-25.html</a><br><a rel="nofollow" target="_new" href="http://monkey.workarea.jp/lb/archive/2005/6-26.html">http://monkey.workarea.jp/lb/archive/2005/6-26.html</a><br><br>so you don't have to be messed by Japanese. (enjoy my Japanglish instead ;-)</div>
<p><a id="447293" href="#447293">#</a> <strong>Michael S. Kaplan</strong> on 3 Aug 2005 2:19 PM:</p><div style="margin-left: 1em">I was able to read the page, with some assistance. :-)</div>
<hr/><p><em>referenced by</em></p><div style="margin-left: 1em"><p>2005/11/03 <a href="http://archives.miloush.net/michkap/archive/2005/11/03/484974.html">My own personal thoughts about collation in the Mono project</a></p><p>2005/08/10 <a href="http://archives.miloush.net/michkap/archive/2005/08/10/449909.html">Double compressions -- Hungarian goulash?</a></p></div><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2005/08/04/447759.html" title="Let&#39;s get vertical">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2005/08/03/447149.html" title="&#39;Our move. What do you think?&#39; I asked. &#39;Napalm&#39; she said.">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2005-08">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2005-08-03">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2005/08/03/447224.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:41 GMT -->
</html>