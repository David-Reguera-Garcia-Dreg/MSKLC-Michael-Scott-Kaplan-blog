<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2005/08/27/457224.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:41 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>Vietnamese is a complex language on Windows</title></head><body>
<h1>Vietnamese is a complex language on Windows</h1>
<p><em>by Michael S. Kaplan, published on 2005/08/27 22:50 -04:00, original URI: http://blogs.msdn.com/b/michkap/archive/2005/08/27/457224.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostNew -->
<P><FONT face=Tahoma>Back in May of&nbsp;2004, Quan Nguyen sent a message to <A href="http://www.microsoft.com/globaldev/drintl/askdrintl.aspx">Dr. International</A> about Vietnamese collation in Windows and the .NET Framework:</FONT></P><FONT face=Tahoma>
<BLOCKQUOTE dir=ltr style="MARGIN-RIGHT: 0px">
<P class=MsoPlainText><FONT size=2><SPAN style="FONT-SIZE: 10pt"><FONT face="Times New Roman"><EM>I tried to sort Vietnamese characters according to Vietnamese collation rules, as precribed in http://vietunicode.sourceforge.net/charset/vietalphabet.html. However, .NET Framework's built-in sort order for CultureInfo("vi-VN") seems not correct. What should I do to get it to sort according to Vietnamese alphabetical order?</EM></FONT></SPAN></FONT><FONT face="Courier New" size=2><SPAN style="FONT-SIZE: 10pt"><?xml:namespace prefix = o ns = "urn:schemas-microsoft-com:office:office" /><o:p>&nbsp;</o:p></SPAN></FONT></P></BLOCKQUOTE></FONT>
<P><FONT face=Tahoma>This was not the only place that this information was asked -- Quan had asked this same question on several newsgroups and other places. We requested some more details, did the investigation, and were able to report on the claim -- he was right, there were a few letters that did not sort properly. In the end, the problem basically consisted of the uppercase and lowercase versions of the following letters:</FONT></P>
<UL>
<LI><FONT face="Courier New">Ã/ã (<A href="http://www.fileformat.info/info/unicode/char/00c3/index.htm">U+00c3</A>/<A href="http://www.fileformat.info/info/unicode/char/00e3/index.htm">U+00e3</A>, a.k.a. LATIN LETTER A WITH TILDE)</FONT> 
<LI><FONT face="Courier New">Ì/ì (<A href="http://www.fileformat.info/info/unicode/char/00cc/index.htm">U+00cc</A>/<A href="http://www.fileformat.info/info/unicode/char/00ec/index.htm">U+00ec</A>, a.k.a. LATIN LETTER I WITH GRAVE)</FONT> 
<LI><FONT face="Courier New">Ò/ò (<A href="http://www.fileformat.info/info/unicode/char/00d2/index.htm">U+00d2</A>/<A href="http://www.fileformat.info/info/unicode/char/00f2/index.htm">U+00f2</A>, a.k.a. LATIN LETTER O WITH GRAVE)</FONT> 
<LI><FONT face="Courier New">Õ/õ (<A href="http://www.fileformat.info/info/unicode/char/00d5/index.htm">U+00d5</A>/<A href="http://www.fileformat.info/info/unicode/char/00f5/index.htm">U+00f5</A>, a.k.a.&nbsp;LATIN LETTER O WITH TILDE)</FONT> 
<LI><FONT face="Courier New">Ý/ý (<A href="http://www.fileformat.info/info/unicode/char/00dd/index.htm">U+00dd</A>/<A href="http://www.fileformat.info/info/unicode/char/00fd/index.htm">U+00fd</A>, a.k.a. LATIN LETTER Y WITH ACUTE)</FONT></LI></UL>
<P><FONT face=Tahoma>Of course since these letters are in Unicode and are used by several other languages, they have some default weights -- but they are not in the Vietnamese exception table. And their weights in the default table are not completely correct....</FONT></P>
<P><FONT face=Tahoma>Now no one had reported this problem before, so hopefully these are letters that are not used often in Vietnamese in situations where the small but definite differences in collation would be noticed.</FONT></P>
<P><FONT face=Tahoma>Which is not to say it is not a bug or that it should not be fixed -- it definitely is.</FONT></P>
<P><FONT face=Tahoma>But it is to perhaps explain why it took so long for someone to report to Microsoft a bug that has been in the code page and sorting tables&nbsp;since the very first Vietnamese enabled versions of Windows....</FONT></P>
<P><FONT face=Tahoma>Now&nbsp;<A href="http://www.microsoft.com/globaldev/reference/sbcs/1258.mspx">Windows code page 1258</A>&nbsp;has its own set of problems here, because t<FONT face=Tahoma>he above characters are not in cp1258, either. Well, they sort of are as combining characters since the code page has <A href="http://www.fileformat.info/info/unicode/char/0300/index.htm">U+0300</A>, <A href="http://www.fileformat.info/info/unicode/char/0301/index.htm">U+0301</A>, and <A href="http://www.fileformat.info/info/unicode/char/0303/index.htm">U+0303</A> on it -- but the conversion to and from Unicode&nbsp;of the above characters&nbsp;can be quite nightmarish, for the reasons I mention </FONT>when I pointed out <a href="http://archives.miloush.net/michkap/archive/2005/04/19/409566.html">a few of the gotchas of MultiByteToWideChar</A>. We&nbsp;would have had to include them as the precomposed form listed above, and there are not enough free slots to do so (even if we were able to modify code pages, which we are not when I explained about <a href="http://archives.miloush.net/michkap/archive/2005/02/06/368081.html">we cannot change the code pages</A>).</FONT></P>
<P><FONT face=Tahoma>So let's just assume that cp1258 is about as limited in use as all of the rest of the attempts at the other (at last count 42!) 8-bit encodings of Vietnamese are (they all have problems due to the fact that there are too mny characters or not enough slots to put them) and stick with Unicode....</FONT></P>
<P><FONT face=Tahoma>Getting back to collation, this particular problem that Quan Nguyen reported is fixed in the updated sorting tables in <FONT color=#808080><STRIKE>Longhorn</STRIKE></FONT>Vista Beta 1. It could not be fixed in earlier versions of Windows or the .NET Framework as requires a major version change for Vietnamese to change the weights of code points that already have weights defined, so&nbsp;Vista is our first chance to make the fix (Whidbey's sorting tables are not being updated so the fix could not be made in .NET 2.0).</FONT></P>
<P><FONT face=Tahoma>On a happier note, the font story for Vietnamese has been really good on Windows for a while now, for all of these various letters.</FONT></P>
<P><FONT face=Tahoma>And the Vietnamese LIP was <A href="http://www.microsoft.com/downloads/details.aspx?FamilyID=0db2e8f9-79c4-4625-a07a-0cc1b341be7c&amp;DisplayLang=vi">released in March 2005</A>&nbsp;which is also pretty awesome.</FONT></P>
<P><FONT face=Tahoma>It just took a little while for the NLS side of GIFT to catch up with everyone else, that's all. :-)</FONT></P>
<P><FONT face=Tahoma></FONT>&nbsp;</P>
<P><FONT color=#ff0000><FONT face=Tahoma><EM>This post brought to you by</EM> "Ý" <EM>(</EM></FONT><FONT face=Tahoma><EM><A href="http://www.fileformat.info/info/unicode/char/00dd/index.htm">U+00dd</A></EM></FONT><FONT face=Tahoma><EM>, a.k.a. LATIN CAPITAL LETTER Y WITH ACUTE)</EM></FONT></FONT></P>
<hr/><p><a id="7990351" href="#7990351">#</a> <strong>Quan Nguyen</strong> on 2 Mar 2008 10:02 AM:</p><div style="margin-left: 1em"><P>Hi Michael,</P>
<P>Not until today, I got a chance to test the new collation on Vista. It seems that those bugs have been fixed for the Unicode composite format but not for the precomposed. Moreover, the fixes seem to have introduced new bugs. The list below includes the Vietnamese characters in question.</P>
<P><FONT face="Consolas,Lucida Console,Courier New,Courier">&nbsp;Reference : </FONT>aAàÀảẢãÃáÁạẠăĂằẰẳẲẵẴắẮặẶâÂầẦẩẨẫẪấẤậẬiIìÌỉỈĩĨíÍịỊoOòÒỏỎõÕóÓọỌyYỳỲỷỶỹỸýÝỵỴ</P>
<P><FONT face="Consolas,Lucida Console,Courier New,Courier">&nbsp;Composite : </FONT>aAàÀảẢãÃáÁạẠâÂầẦẩẨẫăĂẪằấẤẰẳậẲẬẵẴắẮặẶiIìÌỉỈĩĨíÍịỊoOòÒỏỎõÕóÓọỌyYỳỲỷỶỹỸýÝỵỴ</P>
<P><FONT face="Consolas,Lucida Console,Courier New,Courier">Precomposed: </FONT>aAàÀảẢáÁạẠãÃăĂằẰẳẲẵẴắẮặẶâÂầẦẩẨẫẪấẤậẬiIỉỈĩĨíÍịỊìÌoOỏỎóÓọỌòÒõÕyYỳỲỷỶỹỸỵỴýÝ</P>
<P>Given the latest environment (in terms of OS, .NET framework), how can I get the correct sort?</P>
<P>Quan</P></FONT></FONT></div>
<p><a id="7990909" href="#7990909">#</a> <strong>Michael S. Kaplan</strong> on 2 Mar 2008 11:03 AM:</p><div style="margin-left: 1em"><p>Kind of unfortunate that you just got the chance to look at it, I mean since it was available to be looked at in beta form literally for years before Vista was released. :-(</p>
<p>But I will forward it on to the team to take a look at the issue for consideration in a future version. </p>
<p>There is no way to get &quot;the correct sort&quot; until the correct sort is added, though....</p>
</div>
<p><a id="8331564" href="#8331564">#</a> <strong>Quan Nguyen</strong> on 22 Mar 2008 4:12 PM:</p><div style="margin-left: 1em"><p>It is unfortunate that no one else had verified the changes while Vista was still in beta. It may have been assumed that Microsoft would do it correctly.</p>
<p>I also notice that the current Vietnamese collation implementation in both Windows XP and Vista has erroneously included several letter contractions. The Vietnamese modern collation does not have any contractions, as opposed to the traditional one. As such, &quot;ch&#243;&quot; should collate before &quot;c&#243;&quot;.</p>
<p><a rel="nofollow" target="_new" href="http://developer.mimer.com/collations/charts/vietnamese.htm">http://developer.mimer.com/collations/charts/vietnamese.htm</a></p>
<p><a rel="nofollow" target="_new" href="http://developer.mimer.com/collations/charts/vietnamese_traditional.htm">http://developer.mimer.com/collations/charts/vietnamese_traditional.htm</a></p>
<p>Hope all the collation problems mentioned will be fixed for both precomposed and composite forms in the near future.</p>
<p>Thanks.</p></div>
<p><a id="8331623" href="#8331623">#</a> <strong>Michael S. Kaplan</strong> on 22 Mar 2008 5:03 PM:</p><div style="margin-left: 1em"><p>These changes can only happen in major versions of Windows (so &quot;near future&quot; is pretty unlikely without a version that is even in beta), and fixes are not (and cannot be) based on other companies providing their own sorting tables from their products -- so the mimer SQL tables are not something that we could or would use as source material.</p>
<p>But as I said, I have forwarded the information for consideration in a future version.</p>
<p>FWIW, please note that providing a list like you did is not specifically helpful since it gives no information about primary vs. secondary vs. tertiary vs. quaternary weights, and one could therefore produce that order and still have wrong results in actual real world words in the language....</p>
</div>
<p><a id="8331729" href="#8331729">#</a> <strong>Quan Nguyen</strong> on 22 Mar 2008 6:48 PM:</p><div style="margin-left: 1em"><p>Those tables only serve as graphical illustrations of what currently is in the Unicode Collation Algorithm. The DUCET data at UCA should provide complete reference information for the collation implementation.</p>
<p>Btw, do I understand correctly that SQL Server 2000/2005 also rely on Windows' Collation Table to sort and compare character strings, or they have their own collation table?</p></div>
<p><a id="8331764" href="#8331764">#</a> <strong>Michael S. Kaplan</strong> on 22 Mar 2008 7:15 PM:</p><div style="margin-left: 1em"><p>Microsoft does not use the UCA, which makes attempting to use UCA tailorings not quite so useful -- even if the other reasons did not exist (and they do). Actual dictionaries and/or government standards information is required....</p>
<p>SQL Server uses their own snapshots of the Windows collations at various points; they do not directly call the Win32 NLS API.</p>
</div>
<p><strong>Maulik</strong> on 21 Jan 2009 5:50 AM:</p><div style="margin-left: 1em"><p>Is this problem fixed in .NET Framework 3.5 and SQL 2008 as backend? What if I use SQL 2000?</p></div>
<p><strong>Michael S. Kaplan</strong> on 21 Jan 2009 9:57 PM:</p><div style="margin-left: 1em"><p>You will not get a 100% solution in any of those products, sorry. :-(</p>
</div>
<p><strong>Quan Nguyen</strong> on 8 May 2009 10:07 PM:</p><div style="margin-left: 1em"><p>Hi Michael,</p>
<p>I'm truly dismayed to find out that the upcoming Windows 7 still has not got the Vietnamese collation right! Same error. Did Microsoft Internationalization Team take a look at this bug at all after all these years???</p>
<p>With the final release still about at least a half year away, can Microsoft correct this serious bug -- I'm speaking from the perspective of Vietnamese developers and users -- and get the fix into the final baseline?</p>
<p>Look forward to your response.</p>
<p>Quan</p></div>
<p><strong>Michael S. Kaplan</strong> on 8 May 2009 10:29 PM:</p><div style="margin-left: 1em"><p>Quan,</p>
<p>I am no longer on the team responsible for this data, so I cannot speak for them. I have forwarded the information on to them.</p>
<p>But every single time I have discussed this bug here I have pointed out flaws in the report that keep it from being terribly actionable, at the same time that I discussed possible reasons for the differences.</p>
<p>I suppose I could be dismayed that a person who reports a problem is given feedback on issues with the report that can hinder and/or block the resolution that are never answered, but I am not. Because thus far there is only person making the complaint about the problem, and that is the person who has not answered the queries given. Thus, lacking other complaints about the problem, the problem for the present still seems to be unactionable. :-(</p>
</div>
<p><strong>Quan Nguyen</strong> on 14 May 2009 6:34 PM:</p><div style="margin-left: 1em"><p>I did cite three sources that contain complete information about primary, secondary, and tertiary weights of Vietnamese characters. Info about the quaternary differences can be found at <a href="http://vietunicode.sourceforge.net/charset/quytacABC_en.html" rel="nofollow" target="_new">http://vietunicode.sourceforge.net/charset/quytacABC_en.html</a>.</p>
<p>However, in case those sources are still deemed insufficient evidence and an actual dictionary is required, then perhaps your colleagues in Vietnam certainly could provide you a copy; or a visit to any bookstore in Vietnamese town at your locality, if there is a sizable population of Vietnamese expatriates there, could present an excellent opportunity to acquire one; or if time is a critical factor, I would be glad to donate my extra copy of the Vietnamese Dictionary published in 2003 by Vietnam Lexicography Centre to serve as a standard reference and design specifications for Vietnamese collation.</p>
<p>As users in Vietnam are becoming more aware of the problem with Windows’ Vietnamese collation data, they surely will make their case known to Windows Beta Team in the days ahead.</p>
<p>Thanks.</p></div>
<p><strong>Zung Le</strong> on 9 May 2011 6:48 AM:</p><div style="margin-left: 1em"><p>The IT people installed VI language on my machine BUT I cannot find the VI keyboard. Please tell me where it is?</p>
</div>
<p><strong>Vadim Berman</strong> on 10 Oct 2011 3:48 PM:</p><div style="margin-left: 1em"><p>Hi Michael,</p>
<p>It&#39;s a very old post but still important. I was wondering whether there is some kind of workaround for WideCharToMultiByte in Vietnamese. Everything is OK except for the letters with double diacritics, like ệ or ữ. </p>
<p>What I don&#39;t understand is how it is different from Thai. Thai worked without any tweaking! </p>
<p>Is it possible to change the input and then recreate the characters that the conversion could not handle? I mean they exist in both cp1258 and Unicode, so this should be possible. </p>
<p>Best regards,</p>
<p>Vadim</p>
</div>
<p><strong>Vadim Berman</strong> on 12 Oct 2011 2:58 PM:</p><div style="margin-left: 1em"><p>You might want to read the last comment here: <a rel="nofollow" target="_new" href="http://stackoverflow.com/questions/7703114/using-widechartomultibyte-with-codepage-1258-vietnamese">stackoverflow.com/.../using-widechartomultibyte-with-codepage-1258-vietnamese</a>. There is a workaround for the broken conversion. </p>
</div>
<p><strong>Vadim Berman</strong> on 27 Apr 2012 2:04 AM:</p><div style="margin-left: 1em"><p>In the unlikely case that anyone still cares: <a rel="nofollow" target="_new" href="http://stackoverflow.com/questions/7703114/using-widechartomultibyte-with-codepage-1258-vietnamese">stackoverflow.com/.../using-widechartomultibyte-with-codepage-1258-vietnamese</a></p>
</div>
<hr/><p><em>referenced by</em></p><div style="margin-left: 1em"><p>2012/10/03 <a href="http://archives.miloush.net/michkap/archive/2012/10/03/10355394.html">The temptation to channel Grumpy Code Reviewer can be almost overwhelming!</a></p><p>2010/03/09 <a href="http://archives.miloush.net/michkap/archive/2010/03/09/9975184.html">Coloring outside the lines in the a-ness of the Hungarian Technical Sort</a></p><p>2008/03/26 <a href="http://archives.miloush.net/michkap/archive/2008/03/26/8337198.html">Vietnamese still ain't quite right</a></p><p>2005/11/11 <a href="http://archives.miloush.net/michkap/archive/2005/11/11/491349.html">What to do with the Vietnamese keyboard on Windows?</a></p></div><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2005/08/28/457383.html" title="About [not] writing books">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2005/08/26/456812.html" title="Has it been three years?">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2005-08">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2005-08-27">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2005/08/27/457224.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:41 GMT -->
</html>