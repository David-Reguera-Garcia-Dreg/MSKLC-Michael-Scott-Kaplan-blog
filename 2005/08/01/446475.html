<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2005/08/01/446475.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:41 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>Not every code page value is supported</title></head><body>
<h1>Not every code page value is supported</h1>
<p><em>by Michael S. Kaplan, published on 2005/08/02 02:30 -04:00, original URI: http://blogs.msdn.com/b/michkap/archive/2005/08/01/446475.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostNew -->
<P><FONT face=Tahoma>The other day, John Bates asked in the suggestion box:</FONT></P>
<BLOCKQUOTE dir=ltr style="MARGIN-RIGHT: 0px">
<P>This suggestion is probably just a documentation update, but here goes. </P>
<P>One of my applications (compiled for Unicode) allows the caller to specify a code page for output. During testing I found WideCharToMultiByte works for most CPs but it fails for 1200, 1201, 12000 and 12001. The "Code-Page Identifiers" page lists these as valid CP values, but my system's NLS key doesn't have any values for these CPs. </P>
<P>Is there something that has to be installed for this to work, or is there another API (or series of APIs) that should be called instead? </P>
<P>I think there's a need for a (simple) encoding-to-encoding conversion API! </P>
<P>Regards, </P>
<P>John Bates </P></BLOCKQUOTE>
<P><FONT face=Tahoma>Well, I will have to take this apart one piece at a time. :-)</FONT></P>
<P><FONT face=Tahoma>Now, if there ever were a function to handle "code page" 1200, it would not be WideCharToMultiByte, which has the job of converting UTF-16 LE into a byte-based encoding of some type, and by no stretch of the imagination can "cp 1200" be considered such a thing. :-)</FONT></P>
<P><FONT face=Tahoma>I'll break that one piece at a time rule for the rest --&nbsp;the other three "code pages", 1201, 12000, and 12001 (a.k.a. UTF-16 BE, UTF-32 LE, and UTF-32 BE), also fall into a similar rule. They are not byte based and thus really not something I would want to see us bend the WideCharToMultiByte and MultiByteToWideChar functions to do. It is (in my humble opinion) unfortunate that we went this route with the Encoding class in the .NET Framework, but that is not by itself a reason to mess up the model for Win32 NLS API functions....</FONT></P>
<P><FONT face=Tahoma>Further, there is no need to have a conversion with "code page 1200" since that is converting something to itself. If you want to convert an LPWSTR or a WCHAR * to an LPBYTE or a BYTE * then you can just use a cast and then you are done, no need to go through a conversion function. Just cast it and you are done....</FONT></P>
<P><FONT face=Tahoma>As for the UTF-16 BE, UTF-32 LE, and UTF-32 BE cases, Murray Sargent of Microsoft once explained to Asmus Freytag of Unicode fame (who accosted me at a Unicode conference to make a similar demand for UTF-32 support) that there wass no need for this -- the conversions in question&nbsp;are <STRONG>macros</STRONG> and do not have to be full functions. I think Asmus mostly backed down after being out-accosted, but I very much appreciated the support. :-)</FONT></P>
<P><FONT face=Tahoma>The only useful excuse for functions in any of these cases would of course be to also handle validation (i.e. is it actual, valid Unicode), and I do not want to minimize that. But it is not a reason to back down from that model (in my opinion). Perhaps it is a reason for another function in the Win32 NLS API for these types of conversions, if there were a lot of customer requests that expressed such a need. We are not quite there yet, though; at this point those macros can still handle the immediate need....</FONT></P>
<P><FONT face=Tahoma>Sorry, John. :-( But I will talk to someone about the doc issue here, in any case. :-)</FONT></P>
<P><FONT face=Tahoma></FONT>&nbsp;</P>
<P><FONT face=Tahoma color=#ff0000><EM>This post brought to you by</EM> "êíë" <EM>(<A href="http://www.fileformat.info/info/unicode/char/10491/index.htm">U+10491</A>, a.k.a. OSMANYA LETTER MIIN)<BR><FONT size=1>A character that is just as comfortable as U+10491 as it is as U+d801 U+dc91, because it is not self-conscious about its weight. :-)</FONT></EM></FONT></P>
<hr/><p><strong>Aaron Ballman</strong> on 1 Apr 2008 1:11 PM:</p><div style="margin-left: 1em"><P>Maybe I'm just being dense... but! &nbsp;Let's say I have input bytes in UTF8 (CP_UTF8), and I want to convert them to UTF-16BE (1201). &nbsp;Wouldn't I just call MultiByteToWideChar to convert UTF8 to UTF-16LE, and then WideCharToMultiByte to convert UTF-16LE to UTF-16BE? &nbsp;If not, then how would I do it, aside from writing my own byte-swapping function? &nbsp;How does that change if I want to go from UTF-8 to UCS4 BE?</P></div>
<p><strong>UTF16/UCS2 mess</strong> on 4 Jul 2010 7:08 AM:</p><div style="margin-left: 1em"><p>&gt;&gt;&gt; Further, there is no need to have a conversion with &quot;code page 1200&quot; since that is converting something to itself</p>
<p>It looks MS is messed up with UTF16 and UCS2 encodings. UTF16 is not UCS2. The conversion with UTF16 is absolutely necessary.</p>
</div>
<p><strong>Michael S. Kaplan</strong> on 4 Jul 2010 7:33 AM:</p><div style="margin-left: 1em"><p>Microsoft Windows currently assumes all the data is valid UTF-16 but will strip out invalid stuff and replace it with the replacement character. In theory this could make cp1200 useful, but it will take more than wishing to make it so -- these functions have no &quot;colonic&quot; capabilities of that nature...</p></div>
<hr/><p><em>referenced by</em></p><div style="margin-left: 1em"><p>2007/08/11 <a href="http://archives.miloush.net/michkap/archive/2007/08/11/4340636.html">Documentation does not always imply existence</a></p></div><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2005/08/01/446486.html" title="Stripping out diacritics, redux">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2005/07/31/445850.html" title="Why do the high surrogates have the low numbers?">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2005-08">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2005-08-01">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2005/08/01/446475.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:41 GMT -->
</html>