<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2005/10/22/483573.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:40 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>Parameter confusion #2a</title></head><body>
<h1>Parameter confusion #2a</h1>
<p><em>by Michael S. Kaplan, published on 2005/10/22 03:01 -04:00, original URI: http://blogs.msdn.com/b/michkap/archive/2005/10/22/483573.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostNew -->
<P><FONT face=Tahoma>It was just&nbsp;ages ago&nbsp;that I talked about <a href="http://archives.miloush.net/michkap/archive/2005/10/20/482926.html">Parameter Confusion</A>&nbsp;in regard to the <A href="http://msdn.microsoft.com/library/en-us/intl/nls_5s2v.asp">LCMapString</A> function when used for sort keys, and <a href="http://archives.miloush.net/michkap/archive/2005/10/21/483526.html">Parameter Confusion</A> in regard to <A href="http://msdn.microsoft.com/library/en-us/intl/nls_34rz.asp">GetLocaleInfo</A>&nbsp;when numbers were returned.</FONT></P>
<P><FONT face=Tahoma>Perhaps it just seems that way.</FONT></P>
<P><FONT face=Tahoma>Of course I forgot about a case in that second post -- LOCALE_FONTSIGNATURE. This particular <A href="http://msdn.microsoft.com/library/en-us/intl/nls_8rse.asp">LCType</A> has the following in the documentation:</FONT></P>
<BLOCKQUOTE dir=ltr style="MARGIN-RIGHT: 0px">
<P><FONT face=Tahoma>LOCALE_FONTSIGNATURE </FONT></P>
<BLOCKQUOTE dir=ltr style="MARGIN-RIGHT: 0px">
<P><FONT face=Tahoma><EM>Windows 95/98/Me, Windows NT 4.0 or later</EM>: A bit pattern used to determine the relationship between the character coverage needed to support the locale and the font contents. <FONT color=#ff0000>This information is returned in a LOCALESIGNATURE structure</FONT>. </FONT></P></BLOCKQUOTE></BLOCKQUOTE>
<P><FONT face=Tahoma>I am particularly proud of that bit in red, since it was added based on a bug I reported. :-)</FONT></P>
<P><FONT face=Tahoma>Anyway, if you look at the structures you will see that a <A href="http://msdn.microsoft.com/library/en-us/intl/unicode_5ppu.asp">LOCALESIGNATURE</A> sorta technically contains a <A href="http://msdn.microsoft.com/library/en-us/intl/unicode_3h0y.asp">FONTSIGNATURE</A>:</FONT></P>
<BLOCKQUOTE dir=ltr style="MARGIN-RIGHT: 0px">
<P><FONT face="Courier New"><STRONG>typedef struct tagFONTSIGNATURE<BR>{<BR>&nbsp;&nbsp;&nbsp; DWORD fsUsb[4];<BR>&nbsp;&nbsp;&nbsp; DWORD fsCsb[2];<BR>} FONTSIGNATURE, *PFONTSIGNATURE,FAR *LPFONTSIGNATURE;</STRONG></FONT></P>
<P><FONT face=Tahoma><FONT face="Courier New"><STRONG>typedef struct tagLOCALESIGNATURE<BR>{<BR>&nbsp;&nbsp;&nbsp; DWORD lsUsb[4];<BR>&nbsp;&nbsp;&nbsp; DWORD lsCsbDefault[2];<BR>&nbsp;&nbsp;&nbsp; DWORD lsCsbSupported[2];<BR>} LOCALESIGNATURE, *PLOCALESIGNATURE,FAR *LPLOCALESIGNATURE;</STRONG></FONT></P></BLOCKQUOTE></FONT>
<P><FONT face=Tahoma>Of course you see the problem in passing something the size of a <A href="http://msdn.microsoft.com/library/en-us/intl/unicode_3h0y.asp">FONTSIGNATURE</A> and claiming it is the size of a <A href="http://msdn.microsoft.com/library/en-us/intl/unicode_5ppu.asp">LOCALESIGNATURE</A> to make <A href="http://msdn.microsoft.com/library/en-us/intl/nls_34rz.asp">GetLocaleInfo</A>&nbsp;happy, since it would inspire a small buffer overrun in the user code.</FONT></P>
<P><FONT face=Tahoma>Which would kind of suck, obviously.</FONT></P>
<P><FONT face=Tahoma>I personally reviewed one developer's work&nbsp;who had done just that in their code, which is one of the reasons I pushed for a doc change. :-)</FONT></P>
<P><FONT face=Tahoma>Now, following the principles of that second <a href="http://archives.miloush.net/michkap/archive/2005/10/21/483526.html">Parameter Confusion</A>&nbsp;post, cchDest is still expecting a count of characters, which means that the size of pass here is <FONT face="Courier New">sizeof(LOCALESIGNATURE) / sizeof(TCHAR)</FONT> and what to pass in the buffer is a <A href="http://msdn.microsoft.com/library/en-us/intl/unicode_5ppu.asp">LOCALESIGNATURE</A>&nbsp;cast to a string so that the C compiler will not be unhappy with the parameter change.</FONT></P>
<P><FONT face=Tahoma>Just a little more parameter confusion for an early&nbsp;Saturday morning....</FONT></P>
<P><FONT face=Tahoma></FONT>&nbsp;</P>
<P><FONT face=Tahoma><FONT color=#ff1493><EM>This post brought to you by</EM> "<FONT size=6>ÞŸ</FONT>" </FONT><EM><FONT color=#ff1493>(</FONT><A href="http://www.fileformat.info/info/unicode/char/079f">U+079f</A><FONT color=#ff1493>, a.k.a. THAANA LETTER DAADHU)</FONT></EM></FONT></P>
<hr/><p><a id="483767" href="#483767">#</a> <strong>CornedBee</strong> on 22 Oct 2005 8:30 AM:</p><div style="margin-left: 1em">What I still don't understand is why it wouldn't have been easier to make multiple functions. Then each one could have exactly ONE return type (character buffer, dword or locale signature) and typesafe languages such as, uh, every single modern language that regularly accesses the API directly wouldn't have to make the programmer jump through hoops to make sure their code is correct.</div>
<p><a id="483797" href="#483797">#</a> <strong>Michael S. Kaplan</strong> on 22 Oct 2005 1:30 PM:</p><div style="margin-left: 1em">Well, I don't entirely disagree with the sentiment (though I would not have added a whole new function for a LOCALESIGNATURE!).<br><br>But imagine if the Win32 API Headers were C++ style rather than requiring casts to change type. That would be a clearner way to handle these cases, if you ask me....</div>
<hr/><p><em>referenced by</em></p><div style="margin-left: 1em"><p>2008/10/05 <a href="http://archives.miloush.net/michkap/archive/2008/10/05/8977109.html">Can I get your [font]signature on this, please?</a></p><p>2006/02/08 <a href="http://archives.miloush.net/michkap/archive/2006/02/08/527375.html">They make 'em smarter than GetDateFormat</a></p><p>2006/01/12 <a href="http://archives.miloush.net/michkap/archive/2006/01/12/511884.html">The creation of sort keys does not always make sense</a></p><p>2005/12/19 <a href="http://archives.miloush.net/michkap/archive/2005/12/19/505576.html">It isn't a FONTSIGNATURE, darn it!</a></p></div><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2005/10/23/483911.html" title="Keyboards as security blankets">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2005/10/21/483526.html" title="Parameter confusion #2">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2005-10">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2005-10-22">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2005/10/22/483573.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:40 GMT -->
</html>