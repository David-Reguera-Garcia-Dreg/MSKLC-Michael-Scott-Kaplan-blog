<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2005/10/20/482896.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:40 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>Behold the PersianCalendar class</title></head><body>
<h1>Behold the PersianCalendar class</h1>
<p><em>by Michael S. Kaplan, published on 2005/10/20 03:01 -04:00, original URI: http://blogs.msdn.com/b/michkap/archive/2005/10/20/482896.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostNew -->
<P><FONT face=Tahoma>Not too long ago, someone pointed me at a Channel 9 thread asking about <A href="http://channel9.msdn.com/ShowPost.aspx?PostID=115407#115407">Writing a new jalaali calendar(System.Calendar) class .net 1.1</A>.</FONT></P>
<P><FONT face=Tahoma>I think I have pointed out in the past many of the flaws in the <a href="http://archives.miloush.net/michkap/archive/2005/01/14/353216.html">unmanaged</A>, <a href="http://archives.miloush.net/michkap/archive/2005/01/14/353347.html">unmanaged</A>,&nbsp;and <a href="http://archives.miloush.net/michkap/archive/2005/02/23/378804.html">managed</A>&nbsp;calendar support in Microsoft products.</FONT></P>
<P><FONT face=Tahoma><EM>(I could probably supplement this with at least three posts of all of the expansions that various products like Outlook have done and how they may have actually made things worse rather than better in many cases, but that just highlights the fact that we do not solve all of the customer requests and people could not wait for us. It is (to asy the least)&nbsp;a bit cheeky to complain about those who are are at least trying to solve the problems!)</EM></FONT></P>
<P><FONT face=Tahoma>But to get back to the question of a Jalaali calendar, the best possible answer I could give is the new <A href="http://msdn2.microsoft.com/en-us/library/system.globalization.persiancalendar">PersianCalendar class</A> in version 2.0 of the .NET Framework. One step at a time, and this is a small step. But it is an important step....</FONT></P>
<P><FONT face=Tahoma>The reason I suggest this particular solution is that calendars are very difficult to override completely, which is a lot of the reason for the reported difficulties that the original thread was highlighting.</FONT></P>
<P><FONT face=Tahoma>Calendars are a somewhat unique problem when thoughts of how to "open it all up" and "get out of the way" are entertained, because of the fact that in most cases there is a lot more involved than just localizing names; there is&nbsp;a need to capture the algorithm as well, and finding&nbsp;a way to do all of that for both managed and unmanaged code (how else to work with custom locales?) while still handling the fact that many of the experts in such matters are not themselves programmers is a very difficult problem to solve in a generic&nbsp;manner.</FONT></P>
<P><FONT face=Tahoma>Again I am not giving MS policy here, but it always seem to me that the reason people like Windows is that things simply work without them having to be programmers....</FONT></P>
<P><FONT face=Tahoma>I can not say for sure, but sometimes I wonder if the reason that this kind of extension has not yet happaned has more to do with this difficulty in framing the problem and its customers then in the technical difficulties in calendars themselves.</FONT></P>
<P><FONT face=Tahoma>But people are (and have been) thinking about the problems and how best to try to tackle them. This is a topic that I will post more on when there is mor to actually post....</FONT></P>
<P><FONT face=Tahoma>In the meantime, enjoy the new PersianCalendar class in Whidbey!</FONT></P>
<P><FONT face=Tahoma></FONT>&nbsp;</P>
<P><FONT face=Tahoma color=#ff1493><EM>This post brought to you by</EM> "<FONT size=6>ê†›</FONT>" <EM>(<A href="http://www.fileformat.info/info/unicode/char/a19b">U+a19b</A>, a.k.a. YI SYLLABLE HLIEX)</EM></FONT></P>
<hr/><p><a id="483039" href="#483039">#</a> <strong>Roozbeh Pournader</strong> on 20 Oct 2005 9:57 AM:</p><div style="margin-left: 1em">Hi Michael.<br><br>As one of the guilty people involved in this, I have written a blog entry about it: &lt;a href=&quot;<a rel="nofollow" target="_new" href="http://advogato.org/person/roozbeh/diary.html?start=89%22>here</a>">http://advogato.org/person/roozbeh/diary.html?start=89&quot;&gt;here&lt;/a&gt;</a>.</div>
<p><a id="483049" href="#483049">#</a> <strong>Michael S. Kaplan</strong> on 20 Oct 2005 10:17 AM:</p><div style="margin-left: 1em">Hi Roozbeh,<br><br>I notice that you mention a bug in the PersianCalendar implementation -- if it does exist, there is lots of time (way before 2089!) to fix the problem in a Whidbey service pack or in Orcas....<br><br>****Note to members of the GIFT test team -- someone should make sure Shelby tests the issue in <a rel="nofollow" target="_new" href="http://advogato.org/person/roozbeh/diary.html?start=89">http://advogato.org/person/roozbeh/diary.html?start=89</a> and if it repros, get that bug into the VSWhidbey database! :-)</div>
<p><a id="483355" href="#483355">#</a> <strong>Shelby Eaton</strong> on 21 Oct 2005 3:08 AM:</p><div style="margin-left: 1em">Consider it done! Serisouly though, thanks for pointing out these issues, Roozbeh. Michael - I wish I had more time to read all your postings :-) <br><br>One of the issues that is sort of touched on in both posts here (and I'm sure others) is the difficulty of finding the &quot;correct&quot; and &quot;official&quot; algorithm and its implementation in the first place, then making sure that algorithm is correct for every location where a person might like to use such a calendar. <br><br></div>
<p><a id="483620" href="#483620">#</a> <strong>Roozbeh Pournader</strong> on 21 Oct 2005 6:36 PM:</p><div style="margin-left: 1em">Michael, yes, it's not an important issue.<br><br>Shelby, the &quot;correct&quot; and &quot;official&quot; algorithm for the Persian calendar gets a little controversial at a few years after the date 2089 CE. I have tried my best, but I still don't have the exact official rule, as the law implemented in 1925 CE does not specify the locale.<br><br>The official rule is something like this: one should predict/observe the exact time of the March equinox, and then compare it to the time of the true (apparent) solar noon. If the equinox falls before the noon, this is the first day of the new year. If it falls after the noon, the next day is the first day of the new year.<br><br>The controversy rises because computing solar noon requires a locale. For Persian calendar of Iran, some people use Tehran, while others use the 52.5 E meridian (which defines the Iranian timezone). Afghanistan may have used a different locale for a while, or may have even switched to an arithmetic rule, but I have not been able to confirm the details.<br><br>According to the errata of the book Calendrical Calculations, the Tehran locale will start having different results from the Iran timezone locale in 2091.<br></div>
<hr/><p><em>referenced by</em></p><div style="margin-left: 1em"><p>2009/04/08 <a href="http://archives.miloush.net/michkap/archive/2009/04/08/9537610.html">On intentional gaps in calendar lists</a></p><p>2007/12/17 <a href="http://archives.miloush.net/michkap/archive/2007/12/17/6779614.html">No good way to get one's Jalalis playing with calendars in Windows or .NET, really</a></p><p>2007/06/26 <a href="http://archives.miloush.net/michkap/archive/2007/06/26/3559309.html">Behold the [non-fa-IR default] PersianCalendar class</a></p></div><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2005/10/20/482926.html" title="Parameter confusion">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2005/10/19/482694.html" title="How to get at Jet warnings that are not errors">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2005-10">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2005-10-20">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2005/10/20/482896.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:40 GMT -->
</html>