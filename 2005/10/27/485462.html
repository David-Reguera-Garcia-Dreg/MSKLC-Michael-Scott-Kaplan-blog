<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2005/10/27/485462.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:40 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>The WinForms Common Dialogs do not support culture settings</title></head><body>
<h1>The WinForms Common Dialogs do not support culture settings</h1>
<p><em>by Michael S. Kaplan, published on 2005/10/27 03:01 -04:00, original URI: http://blogs.msdn.com/b/michkap/archive/2005/10/27/485462.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostNew -->
<P><FONT face=Tahoma>If you go back to March of this year, I post about how <a href="http://archives.miloush.net/michkap/archive/2005/03/28/402839.html"><STRONG>the WinForms DateTimePicker and MonthCalendar do not support culture settings</STRONG></A>. But if you look at the text, you will see how I had my 'NLS eyes' on, thinking about <A href="http://msdn.microsoft.com/library/en-us/cpref/html/frlrfsystemglobalizationcultureinfoclasscurrentculturetopic.asp">CultureInfo.CurrentCulture</A> and how different calendars were not supported there.</FONT></P>
<P><FONT face=Tahoma>Putting on my 'GIFT eyes' though, there is a wider issue, and that is the fact that the localized text in all of the <A href="http://msdn.microsoft.com/library/en-us/winui/winui/windowsuserinterface/userinput/commondialogboxlibrary.asp">Windows Shell's Common Dialogs</A> picks&nbsp;the localization based on the UI language of Windows, rather than the .NET Framework's <A href="http://msdn.microsoft.com/library/en-us/cpref/html/frlrfsystemglobalizationcultureinfoclasscurrentuiculturetopic.asp">CultureInfo.CurrentUICulture</A>.</FONT></P>
<P><FONT face=Tahoma>Now this would obviously be the case when you do not have the language resources available -- after all (for example), the Russian version of Windows cannot spontaneously create French resources for the <A href="http://msdn.microsoft.com/library/en-us/cpref/html/frlrfsystemwindowsformsfontdialogclasstopic.asp">FontDialog class</A> just because you write code to set the <A href="http://msdn.microsoft.com/library/en-us/cpref/html/frlrfsystemthreadingthreadclasscurrentuiculturetopic.asp">Thread.CurrentUICulture property</A> to be <FONT face="Courier New"><STRONG>new CultureInfo("fr-FR")</STRONG></FONT>. And that is because the underlying <A href="http://msdn.microsoft.com/library/en-us/winui/winui/windowsuserinterface/userinput/commondialogboxlibrary/aboutcommondialogboxes/fontdialogbox.asp">Font Dialog Box</A> in the Shell loads its resources based on the UI language in Windows.</FONT></P>
<P><FONT face=Tahoma>But the same problem is true if you have the Windows MUI language pack for&nbsp;the appropriate&nbsp;language installed; the common dialogs are still loaded according to the Windows UI language, not the <A href="http://msdn.microsoft.com/library/en-us/cpref/html/frlrfsystemglobalizationcultureinfoclasscurrentuiculturetopic.asp">CurrentUICulture</A> that you might have set in .NET.</FONT></P>
<P><FONT face=Tahoma>Of course it is terribly frustrating that the resources might be there yet they still might not be used. But there is no function to change the UI language without logging off, and of course it is not very likely that a managed application running in the context if the desktop can survive past a logoff/logon....</FONT></P>
<P><FONT face=Tahoma>The ironic<SUP><FONT size=1>1</FONT></SUP> part is that the Windows common controls <STRONG>do</STRONG> have a workaround for this issue, even though there do not seem to be many areas of localized text in them. </FONT><FONT face=Tahoma>If you look at the topic entitled <A href="http://msdn.microsoft.com/library/en-us/shellcc/platform/commctls/faq/localization.asp">Localization Support for the Common Controls</A>, it talks about the <A href="http://msdn.microsoft.com/library/en-us/shellcc/platform/commctls/common/functions/initmuilanguage.asp">InitMUILanguage</A> function (which initializes the UI language for the common controls within a process) and the <A href="http://msdn.microsoft.com/library/en-us/shellcc/platform/commctls/common/functions/getmuilanguage.asp">GetMUILanguage</A> function (which retrieves the UI language for the common controls within a process, or the user UI language if it has not been set). In theory there is no reason why you could not call this function at any point, but in practice it is unclear from the documentation if it will work when set multiple times (hell, I am still having trouble picturing when it works at all, since I cannot think of any&nbsp;localized text!).</FONT></P>
<P><FONT face=Tahoma>But in any case, for the time being it looks like the <A href="http://msdn.microsoft.com/library/en-us/cpref/html/frlrfsystemglobalizationcultureinfoclasscurrentuiculturetopic.asp">CurrentUICulture</A>&nbsp;and <A href="http://msdn.microsoft.com/library/en-us/cpref/html/frlrfsystemthreadingthreadclasscurrentuiculturetopic.asp">Thread.CurrentUICulture</A>&nbsp;cannot be used to affect the <A href="http://msdn.microsoft.com/library/en-us/winui/winui/windowsuserinterface/userinput/commondialogboxlibrary.asp">Windows Shell's Common Dialogs</A>&nbsp;that are wrapped by Windows Forms in the .NET Framework. If you want to support this, you will need to wrap the Shell functions in comdlg32.dll and then use the HOOKPROC to do a bunch of owner draw work and/or custom template loading to get this done. Which is a bit much for any project....</FONT></P>
<P><EM><FONT face=Tahoma size=1>1 - When I say ironic here, I mean it in the Alanis sense. You know, like rain on your wedding day. In other words, when I say IRONIC what I mean is UNFORTUNATE.</FONT></EM></P>
<P><FONT face=Tahoma></FONT>&nbsp;</P>
<P><FONT face=Tahoma color=#ff1493><EM>This post brought to you by</EM> "Ç»" <EM>(<A href="http://www.fileformat.info/info/unicode/char/01fb">U+01fb</A>, a.k.a. LATIN SMALL LETTER A WITH RING ABOVE AND ACUTE)</EM></FONT></P>
<hr/><p><strong>Xie</strong> on 13 Nov 2009 12:41 AM:</p><div style="margin-left: 1em"><p>Is the method &nbsp;InitMUILanguage() can work?</p></div>
<hr/><p><em>referenced by</em></p><div style="margin-left: 1em"><p>2006/07/24 <a href="http://archives.miloush.net/michkap/archive/2006/07/24/676072.html">Our highly internationalized OS uses DPI, aka Dots Per In-.... um, never mind!</a></p><p>2005/10/27 <a href="http://archives.miloush.net/michkap/archive/2005/10/27/485478.html">Not every bit of the printer dialogs support MUI 100% of the time</a></p></div><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2005/10/27/485478.html" title="Not every bit of the printer dialogs support MUI 100% of the time">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2005/10/26/485392.html" title="Does Visual Studio rot the mind?">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2005-10">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2005-10-27">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2005/10/27/485462.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:40 GMT -->
</html>