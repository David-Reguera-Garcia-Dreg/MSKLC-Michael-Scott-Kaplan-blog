<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2005/10/17/481600.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:40 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>Comparing Unicode file names the right way</title></head><body>
<h1>Comparing Unicode file names the right way</h1>
<p><em>by Michael S. Kaplan, published on 2005/10/17 00:31 -07:00, original URI: http://blogs.msdn.com/michkap/archive/2005/10/17/481600.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostOld -->
<P><FONT face=Tahoma>Michael Brown asked the following question in the microsoft.public.win32.programmer.international:</FONT></P>
<BLOCKQUOTE dir=ltr style="MARGIN-RIGHT: 0px">
<P><FONT size=2><EM>What is the correct way to compare two unicode filenames to see if they would end up referring to the same file? I'm trying to merge several filename lists that may have the same file name but with different captalisation, and want to avoid duplicates. The files may or may not exist on the system, which makes things a little more complicated. CompareString looks to be a good start, but there's lots of different possibilities for the options and I have no idea which configuration would be correct for comparing two filenames.</EM></FONT></P>
<P><FONT size=2><EM>Any hints appreciated!</EM></FONT></P></BLOCKQUOTE>
<P><FONT face=Tahoma>If you are a regular reader, then you know why (as I read his question) I realized that&nbsp;my team and I&nbsp;have a big job ahead of us....</FONT></P>
<P><FONT face=Tahoma><A href="http://msdn.microsoft.com/library/en-us/winui/winui/windowsuserinterface/resources/strings/stringreference/stringfunctions/comparestring.asp">CompareString</A>, which I am quick to champion as an awesome way to do all sorts of things, is not a good start here -- it is most assuredly the worst start possible if one is trying to mimic the filesystem's rules. Think of the following contrived situation, a directory that contains all of the following files in it:</FONT></P>
<UL>
<LI><FONT face="Courier New">ãåèéîïôõùú.txt&nbsp;&nbsp;&nbsp; <FONT size=1><A href="http://www.fileformat.info/info/unicode/char/00e3">00e3</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <A href="http://www.fileformat.info/info/unicode/char/00e5">00e5</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <A href="http://www.fileformat.info/info/unicode/char/00e8">00e8</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <A href="http://www.fileformat.info/info/unicode/char/00e9">00e9</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <A href="http://www.fileformat.info/info/unicode/char/00ee">00ee</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <A href="http://www.fileformat.info/info/unicode/char/00ef">00ef</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <A href="http://www.fileformat.info/info/unicode/char/00f4">00f4</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <A href="http://www.fileformat.info/info/unicode/char/00f5">00f5</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <A href="http://www.fileformat.info/info/unicode/char/00f9">00f9</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <A href="http://www.fileformat.info/info/unicode/char/00fa">00fa</A></FONT></FONT> 
<LI><FONT face="Courier New">ãåèéîïôõùú.txt&nbsp;&nbsp;&nbsp; <FONT size=1><A href="http://www.fileformat.info/info/unicode/char/0061">0061</A> <A href="http://www.fileformat.info/info/unicode/char/0303">0303</A> <A href="http://www.fileformat.info/info/unicode/char/00e5">00e5</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <A href="http://www.fileformat.info/info/unicode/char/00e8">00e8</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <A href="http://www.fileformat.info/info/unicode/char/00e9">00e9</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <A href="http://www.fileformat.info/info/unicode/char/00ee">00ee</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <A href="http://www.fileformat.info/info/unicode/char/00ef">00ef</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <A href="http://www.fileformat.info/info/unicode/char/00f4">00f4</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <A href="http://www.fileformat.info/info/unicode/char/00f5">00f5</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <A href="http://www.fileformat.info/info/unicode/char/00f9">00f9</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <A href="http://www.fileformat.info/info/unicode/char/00fa">00fa</A></FONT></FONT> 
<LI><FONT face="Courier New">ãåèéîïôõùú.txt&nbsp;&nbsp;&nbsp; <FONT size=1><A href="http://www.fileformat.info/info/unicode/char/00e3">00e3</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <A href="http://www.fileformat.info/info/unicode/char/0061">0061</A> <A href="http://www.fileformat.info/info/unicode/char/030a">030a</A> <A href="http://www.fileformat.info/info/unicode/char/00e8">00e8</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <A href="http://www.fileformat.info/info/unicode/char/00e9">00e9</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <A href="http://www.fileformat.info/info/unicode/char/00ee">00ee</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <A href="http://www.fileformat.info/info/unicode/char/00ef">00ef</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <A href="http://www.fileformat.info/info/unicode/char/00f4">00f4</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <A href="http://www.fileformat.info/info/unicode/char/00f5">00f5</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <A href="http://www.fileformat.info/info/unicode/char/00f9">00f9</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <A href="http://www.fileformat.info/info/unicode/char/00fa">00fa</A></FONT></FONT> 
<LI><FONT face="Courier New">ãåèéîïôõùú.txt&nbsp;&nbsp;&nbsp; <FONT size=1><A href="http://www.fileformat.info/info/unicode/char/00e3">00e3</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A href="http://www.fileformat.info/info/unicode/char/00e5">00e5</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <A href="http://www.fileformat.info/info/unicode/char/0065">0065</A> <A href="http://www.fileformat.info/info/unicode/char/0300">0300</A> <A href="http://www.fileformat.info/info/unicode/char/00e9">00e9</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <A href="http://www.fileformat.info/info/unicode/char/00ee">00ee</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <A href="http://www.fileformat.info/info/unicode/char/00ef">00ef</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <A href="http://www.fileformat.info/info/unicode/char/00f4">00f4</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <A href="http://www.fileformat.info/info/unicode/char/00f5">00f5</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <A href="http://www.fileformat.info/info/unicode/char/00f9">00f9</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A href="http://www.fileformat.info/info/unicode/char/00fa">00fa</A></FONT></FONT> 
<LI><FONT face="Courier New">ãåèéîïôõùú.txt&nbsp;&nbsp;&nbsp; <FONT size=1><A href="http://www.fileformat.info/info/unicode/char/00e3">00e3</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <A href="http://www.fileformat.info/info/unicode/char/00e5">00e5</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <A href="http://www.fileformat.info/info/unicode/char/00e8">00e8</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <A href="http://www.fileformat.info/info/unicode/char/0065">0065</A> <A href="http://www.fileformat.info/info/unicode/char/0301">0301</A> <A href="http://www.fileformat.info/info/unicode/char/00ee">00ee</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <A href="http://www.fileformat.info/info/unicode/char/00ef">00ef</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <A href="http://www.fileformat.info/info/unicode/char/00f4">00f4</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <A href="http://www.fileformat.info/info/unicode/char/00f5">00f5</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <A href="http://www.fileformat.info/info/unicode/char/00f9">00f9</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <A href="http://www.fileformat.info/info/unicode/char/00fa">00fa</A></FONT></FONT> 
<LI><FONT face="Courier New">ãåèéîïôõùú.txt&nbsp;&nbsp;&nbsp; <FONT size=1><A href="http://www.fileformat.info/info/unicode/char/00e3">00e3</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <A href="http://www.fileformat.info/info/unicode/char/00e5">00e5</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <A href="http://www.fileformat.info/info/unicode/char/00e8">00e8</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <A href="http://www.fileformat.info/info/unicode/char/00e9">00e9</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <A href="http://www.fileformat.info/info/unicode/char/0069">0069</A> <A href="http://www.fileformat.info/info/unicode/char/0302">0302</A> <A href="http://www.fileformat.info/info/unicode/char/00ef">00ef</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <A href="http://www.fileformat.info/info/unicode/char/00f4">00f4</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <A href="http://www.fileformat.info/info/unicode/char/00f5">00f5</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <A href="http://www.fileformat.info/info/unicode/char/00f9">00f9</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <A href="http://www.fileformat.info/info/unicode/char/00fa">00fa</A></FONT></FONT> 
<LI><FONT face="Courier New">ãåèéîïôõùú.txt&nbsp;&nbsp;&nbsp;&nbsp;<FONT size=1><A href="http://www.fileformat.info/info/unicode/char/00e3">00e3</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <A href="http://www.fileformat.info/info/unicode/char/00e5">00e5</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <A href="http://www.fileformat.info/info/unicode/char/00e8">00e8</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <A href="http://www.fileformat.info/info/unicode/char/00e9">00e9</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <A href="http://www.fileformat.info/info/unicode/char/00ee">00ee</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <A href="http://www.fileformat.info/info/unicode/char/0069">0069</A> <A href="http://www.fileformat.info/info/unicode/char/0308">0308</A> <A href="http://www.fileformat.info/info/unicode/char/00f4">00f4</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <A href="http://www.fileformat.info/info/unicode/char/00f5">00f5</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <A href="http://www.fileformat.info/info/unicode/char/00f9">00f9</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <A href="http://www.fileformat.info/info/unicode/char/00fa">00fa</A></FONT></FONT> 
<LI><FONT face="Courier New">ãåèéîïôõùú.txt&nbsp;&nbsp;&nbsp; <FONT size=1><A href="http://www.fileformat.info/info/unicode/char/00e3">00e3</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <A href="http://www.fileformat.info/info/unicode/char/00e5">00e5</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <A href="http://www.fileformat.info/info/unicode/char/00e8">00e8</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <A href="http://www.fileformat.info/info/unicode/char/00e9">00e9</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <A href="http://www.fileformat.info/info/unicode/char/00ee">00ee</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <A href="http://www.fileformat.info/info/unicode/char/00ef">00ef</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <A href="http://www.fileformat.info/info/unicode/char/006f">006f</A> <A href="http://www.fileformat.info/info/unicode/char/0302">0302</A> <A href="http://www.fileformat.info/info/unicode/char/00f5">00f5</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <A href="http://www.fileformat.info/info/unicode/char/00f9">00f9</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <A href="http://www.fileformat.info/info/unicode/char/00fa">00fa</A></FONT></FONT> 
<LI><FONT face="Courier New">ãåèéîïôõùú.txt&nbsp;&nbsp;&nbsp; <FONT size=1><A href="http://www.fileformat.info/info/unicode/char/00e3">00e3</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <A href="http://www.fileformat.info/info/unicode/char/00e5">00e5</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <A href="http://www.fileformat.info/info/unicode/char/00e8">00e8</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <A href="http://www.fileformat.info/info/unicode/char/00e9">00e9</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <A href="http://www.fileformat.info/info/unicode/char/00ee">00ee</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <A href="http://www.fileformat.info/info/unicode/char/00ef">00ef</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <A href="http://www.fileformat.info/info/unicode/char/00f4">00f4</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <A href="http://www.fileformat.info/info/unicode/char/006f">006f</A> <A href="http://www.fileformat.info/info/unicode/char/0303">0303</A> <A href="http://www.fileformat.info/info/unicode/char/00f9">00f9</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <A href="http://www.fileformat.info/info/unicode/char/00fa">00fa</A></FONT></FONT> 
<LI><FONT face="Courier New">ãåèéîïôõùú.txt&nbsp;&nbsp;&nbsp; <FONT size=1><A href="http://www.fileformat.info/info/unicode/char/00e3">00e3</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <A href="http://www.fileformat.info/info/unicode/char/00e5">00e5</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <A href="http://www.fileformat.info/info/unicode/char/00e8">00e8</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <A href="http://www.fileformat.info/info/unicode/char/00e9">00e9</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <A href="http://www.fileformat.info/info/unicode/char/00ee">00ee</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <A href="http://www.fileformat.info/info/unicode/char/00ef">00ef</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <A href="http://www.fileformat.info/info/unicode/char/00f4">00f4</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <A href="http://www.fileformat.info/info/unicode/char/00f5">00f5</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <A href="http://www.fileformat.info/info/unicode/char/0075">0075</A> <A href="http://www.fileformat.info/info/unicode/char/0300">0300</A> <A href="http://www.fileformat.info/info/unicode/char/00fa">00fa</A></FONT></FONT> 
<LI><FONT face="Courier New">ãåèéîïôõùú.txt&nbsp;&nbsp;&nbsp;&nbsp;<FONT size=1><A href="http://www.fileformat.info/info/unicode/char/00e3">00e3</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <A href="http://www.fileformat.info/info/unicode/char/00e5">00e5</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <A href="http://www.fileformat.info/info/unicode/char/00e8">00e8</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <A href="http://www.fileformat.info/info/unicode/char/00e9">00e9</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <A href="http://www.fileformat.info/info/unicode/char/00ee">00ee</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <A href="http://www.fileformat.info/info/unicode/char/00ef">00ef</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <A href="http://www.fileformat.info/info/unicode/char/00f4">00f4</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <A href="http://www.fileformat.info/info/unicode/char/00f5">00f5</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <A href="http://www.fileformat.info/info/unicode/char/00f9">00f9</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <A href="http://www.fileformat.info/info/unicode/char/0075">0075</A> <A href="http://www.fileformat.info/info/unicode/char/0301">0301</A></FONT></FONT> 
<LI><FONT face="Courier New">ãåèéîïôõùú.txt&nbsp;&nbsp;&nbsp; <FONT size=1><A href="http://www.fileformat.info/info/unicode/char/0061">0061</A> <A href="http://www.fileformat.info/info/unicode/char/0303">0303</A> <A href="http://www.fileformat.info/info/unicode/char/0061">0061</A> <A href="http://www.fileformat.info/info/unicode/char/030a">030a</A> <A href="http://www.fileformat.info/info/unicode/char/0065">0065</A> <A href="http://www.fileformat.info/info/unicode/char/0300">0300</A> <A href="http://www.fileformat.info/info/unicode/char/0065">0065</A> <A href="http://www.fileformat.info/info/unicode/char/0301">0301</A> <A href="http://www.fileformat.info/info/unicode/char/0069">0069</A> <A href="http://www.fileformat.info/info/unicode/char/0302">0302</A> <A href="http://www.fileformat.info/info/unicode/char/0069">0069</A> <A href="http://www.fileformat.info/info/unicode/char/0308">0308</A> <A href="http://www.fileformat.info/info/unicode/char/006g">006f</A> <A href="http://www.fileformat.info/info/unicode/char/0302">0302</A> <A href="http://www.fileformat.info/info/unicode/char/006f">006f</A> <A href="http://www.fileformat.info/info/unicode/char/0303">0303</A> <A href="http://www.fileformat.info/info/unicode/char/0075">0075</A> <A href="http://www.fileformat.info/info/unicode/char/0300">0300</A> <A href="http://www.fileformat.info/info/unicode/char/0075">0075</A> <A href="http://www.fileformat.info/info/unicode/char/0301">0301</A></FONT></FONT></LI></UL>
<P><FONT face=Tahoma>Now while this something perfectly legal for the file system (in fact, one can randomly intersperse capital letters in there as well to appear to violate the rules of case sensitivity, but viuolating the rules of de facto identical appearance seems more impressive to me!). It is not&nbsp; new topic here (many will remember the post <a href="http://archives.miloush.net/michkap/archive/2005/02/07/368570.html">Normalization as Obfuscation in C#</A> where I made every single identifier act as a different underlying character encoding of the same basic string), but I thought it would be a good idea to point out the issue as it applies to file systems too....</FONT></P>
<P><FONT face=Tahoma>(Anyone with memory of their probability and statistics course work will be able to caculate the exact number of permutations that the file system will allow in this simple 10 character string, and that is even before other characters are added to the mix that look similar to us or to <A href="http://msdn.microsoft.com/library/en-us/winui/winui/windowsuserinterface/resources/strings/stringreference/stringfunctions/comparestring.asp">CompareString</A> but not to the OS -- something I could post about some other day if there was interest)</FONT></P>
<P><FONT face=Tahoma>Now, by the rules of Unicode decomposition, the rules of Unicode normalization (where the first string is Form C and the last is Form D), and the rules of the Win32 CompareString function, all of these strings are identical, and (assuming that you have a new enough browser) they do in fact look the same.</FONT></P>
<P><FONT face=Tahoma>One could of course argue that the file system ought to consider possibly respecting the Unicode rules, but that is an argument for another day (and yes, it is a true <a href="http://archives.miloush.net/michkap/archive/2004/11/28/271121.html">'My dear boy...'</A> situation if ever there was one!).</FONT></P>
<P><FONT face=Tahoma>The argument for today is that the <A href="http://msdn.microsoft.com/library/en-us/winui/winui/windowsuserinterface/resources/strings/stringreference/stringfunctions/comparestring.asp">CompareString</A> function is not the way to compare file names, and I think the above example debunks the notion nicely. :-)</FONT></P>
<P><FONT face=Tahoma>For the file system, an "UpCase and Binary Compare" approach is the best way to go to mimic the behavior, and this rule should stand for at least as long as the file system is not&nbsp;using Unicode normalization or a comparison method that tries to respect the equivalences it creates.</FONT></P>
<P><FONT face=Tahoma>For the uppercasing operation, you can use <A href="http://msdn.microsoft.com/library/en-us/winui/winui/windowsuserinterface/resources/strings/stringreference/stringfunctions/charupper.asp">CharUpper</A>, <A href="http://msdn.microsoft.com/library/en-us/winui/winui/windowsuserinterface/resources/strings/stringreference/stringfunctions/charupperbuff.asp">CharUpperBuff</A>, or <A href="http://msdn.microsoft.com/library/en-us/intl/nls_5s2v.asp">LCMapString</A> with the LCMAP_UPPERCASE flag (<EM>and without the</EM> LCMAP_LINGUISTIC_CASING <EM>flag</EM>!). Binary comparisons are easily done with functions like <A href="http://msdn.microsoft.com/library/en-us/vclib/html/_crt_memcmp.asp">memcmp</A> and <A href="http://msdn.microsoft.com/library/en-us/vclib/html/_crt_memcmp.asp">wmemcmp</A>, of course.</FONT></P>
<P><FONT face=Tahoma>Now even when I talked about the <a href="http://archives.miloush.net/michkap/archive/2005/09/28/474756.html">FAT/FAT32 oddness on Windows 2000</A>, I proved that the underlying file system allowed such differences, even if a higher-level process in the Win32 API was following different rules. Obviously the behavior of the higher level process was considered to be a bug and it was fixed in later versions, so the underlying OS behavior clearly has rules even if every once in a while somebody unknowingly uses a function like <A href="http://msdn.microsoft.com/library/en-us/winui/winui/windowsuserinterface/resources/strings/stringreference/stringfunctions/comparestring.asp">CompareString</A>&nbsp;when they oughn't. :-)</FONT></P>
<P><FONT face="Courier New"></FONT>&nbsp;</P>
<P><FONT face=Tahoma color=#ff1493><EM>This post brought to you by</EM> "õ" <EM>(<A href="http://www.fileformat.info/info/unicode/char/00f5">U+00f5</A>, a.k.a. LATIN SMALL LETTER O WITH TILDE)</EM></FONT></P>
<hr/><p><a id="481747" href="#481747">#</a> <strong>Mihai</strong> on Monday, October 17, 2005 5:27 AM:</p><div style="margin-left: 1em">Only that (if my memory serves me well), there is a way to enable POSIX compatibility for the file system.<br>This means case-sensitive file system.<br>And yes, the documentation for the setting was accompanied by a lot of warnings :-) It can break a lot of things!<br></div>
<p><a id="481796" href="#481796">#</a> <strong>Andreas Magnusson</strong> on Monday, October 17, 2005 9:29 AM:</p><div style="margin-left: 1em">Wow, cool, I was just thinking about this actual thing for an application I'm currently writing! Although I was leaning towards the binary upper/lower-case comparison even before I read it.<br>Nice, thanks!</div>
<p><a id="481801" href="#481801">#</a> <strong>Nick Lamb</strong> on Monday, October 17, 2005 9:40 AM:</p><div style="margin-left: 1em">The underlying NTFS design is POSIX style (case sensitive, no forbidden characters), but the Windows fs driver is case-insensitive using a simple fix case and compare style approach iirc. There is a small additional overhead for this.<br><br>The really /huge/ overhead comes from Win32, which implements a huge number of additional confusing rules (e.g. no colons), the enforcement of which, as Michael has sort-of observed, varies considerably. On top of the actual Win32 API there are some extra rules which seem to be observed only by a few UI components like Explorer (e.g. no runs of punctuation). You can skip all of Win32's rules by using NT APIs instead, or by going through a different subsystem (e.g. POSIX).<br><br>It's easy these days to find Windows systems where 3rd party software ported from Unix has created files that Explorer can list but won't otherwise deal with, or where other 3rd party software can't open certain filenames that appear legitimate in Explorer... and that's before even mentioning removable media.<br><br>The end result is that the initial question is best answered as &quot;try to avoid doing that&quot;, the Apache HTTPd and Microsoft's IIS group have wrestled extensively with this problem on Windows for security reasons. They now both have solutions that work well enough for their product, but it took a lot of work to get there. Still, Michael's solution is a good first approximation if correctness isn't vital.<br><br>Meanwhile if as a developer you find a Windows API that seems to be in a world of its own when it comes to filenames, please report that through the proper channels.</div>
<p><a id="481830" href="#481830">#</a> <strong>Nick Lamb</strong> on Monday, October 17, 2005 10:54 AM:</p><div style="margin-left: 1em">&quot;no forbidden characters&quot;<br><br>Of course it goes without saying that there's an implicit &quot;... except for U+0000 aka NUL&quot; here. U+002f slash isn't actually a forbidden character, but obviously no POSIX system is going to let you sneak the path separator into a filename, at least not a real one. U+2044 and U+2215 should be allowed, probably even getting past Explorer if anyone would like to try.</div>
<p><a id="481844" href="#481844">#</a> <strong>J. Daniel Smith</strong> on Monday, October 17, 2005 11:48 AM:</p><div style="margin-left: 1em">How about a Compare() method on System.IO.FileSystemInfo that does this the right way?</div>
<p><a id="481874" href="#481874">#</a> <strong>Mike Dunn</strong> on Monday, October 17, 2005 1:03 PM:</p><div style="margin-left: 1em">When using LCMapString to do the uppercasing, what's the right LCID to use? LOCALE_INVARIANT?  <br> <br>The CharUpperBuff docs say it &quot;uses the language driver for the current language selected by the user at setup or by using Control Panel&quot; which sounds to me like a language-sensitive operation that would have the same problems as using LCMAP_LINGUISTIC_CASING.</div>
<p><a id="481928" href="#481928">#</a> <strong>Maurits</strong> on Monday, October 17, 2005 2:57 PM:</p><div style="margin-left: 1em">&gt; no POSIX system is going to let you sneak the path separator into a filename, at least not a real one<br><br>Back in the Mac OS 9 days, I had an NT server with Services for Macintosh serving an AFP file share.  Macs on the LAN were always copying files up to the share that had slashes in the file names.<br><br>Mac OS 9 (and previous) uses : for the path separator... is that why : is disallowed in Windows filenames?<br><br>From the Windows alert box:<br><br>A filename cannot contain any of the following characters:<br><br>\ / :  * ? &quot; &lt; &gt; |<br><br>\ and / are path separators...<br>* and ? are &quot;Find&quot; metacharacters...<br>&quot; is the quote character for filenames with spaces...<br>&lt;, &gt;, and | are the indirection operators...<br><br>which leaves : as the odd one out.  A nod to Macs?</div>
<p><a id="481929" href="#481929">#</a> <strong>Maurits</strong> on Monday, October 17, 2005 3:03 PM:</p><div style="margin-left: 1em">Drive letters, duh<br><a rel="nofollow" target="_new" href="http://support.microsoft.com/default.aspx?scid=kb;en-us;232333">http://support.microsoft.com/default.aspx?scid=kb;en-us;232333</a></div>
<p><a id="481947" href="#481947">#</a> <strong>Andy</strong> on Monday, October 17, 2005 3:35 PM:</p><div style="margin-left: 1em">Does anybody know any compression/archiving tools that handle such filenames?<br><br>I'd love to create a folder with a bunch of these 'special' filenames myself and then 'zip'-it to create a single file with a simple name and send it to some of our developers. <br><br>ZIP files don't seem to be applicable here, so what is?</div>
<p><a id="481979" href="#481979">#</a> <strong>Mike Dunn</strong> on Monday, October 17, 2005 5:03 PM:</p><div style="margin-left: 1em">The colon also separates the filename from the stream name. If C: is NTFS then this:<br>C:\foo.txt:bar<br>means the stream named &quot;bar&quot; in the file named &quot;foo.txt&quot;</div>
<p><a id="482003" href="#482003">#</a> <strong>Michael S. Kaplan</strong> on Monday, October 17, 2005 6:24 PM:</p><div style="margin-left: 1em">Hi Mike!<br><br>&quot;When using LCMapString to do the uppercasing, what's the right LCID to use? LOCALE_INVARIANT?&quot;<br><br>Funny you should ask that -- there will be the answer in a post tomorrow! :-)</div>
<p><a id="482009" href="#482009">#</a> <strong>Michael S. Kaplan</strong> on Monday, October 17, 2005 6:34 PM:</p><div style="margin-left: 1em">Hey J. Daniel!<br><br>&quot;How about a Compare() method on System.IO.FileSystemInfo that does this the right way? &quot;<br><br>Well, we are talking about unmanaged code at the moment, right? :-)<br><br>For managed code OrdinalIgnoreCase is good enough for now, at least until the FS exposes better methods....<br></div>
<p><a id="482039" href="#482039">#</a> <strong>Michael S. Kaplan</strong> on Monday, October 17, 2005 7:31 PM:</p><div style="margin-left: 1em">Hi Andy!<br><br>&quot;Does anybody know any compression/archiving tools that handle such filenames?&quot;<br><br>I did talk about this a bit in another post (<a rel="nofollow" target="_new" href="http://archives.miloush.net/michkap/archive/2005/05/10/416181.html">http://blogs.msdn.com/michkap/archive/2005/05/10/416181.aspx</a>) and there were some comments that gave some additional places to look....</div>
<p><a id="482227" href="#482227">#</a> <strong>J. Daniel Smith</strong> on Tuesday, October 18, 2005 9:52 AM:</p><div style="margin-left: 1em">In &lt;3 weeks, there's not going to be the big gulf between managed &amp; unmanged code (I'm talking about VS2005 &amp; C++/CLI).<br><br>So if you show us the unofficial 100% correct &quot;static int Compare(FileSystemInfo a, FileSystemInfo b)&quot; in managed code, it will soon be fairly straight-forward to use it from unmanaged code.<br><br>(Of course, this assumes that you're OK doing such a thing...there may be other reasons for staying completely in unmanaged code).</div>
<p><a id="482248" href="#482248">#</a> <strong>Michael S. Kaplan</strong> on Tuesday, October 18, 2005 10:37 AM:</p><div style="margin-left: 1em">Since Whidbey was frozen long ago and is now frozen rock solid for new features, and since managed code would use OrdinalIgnoreCase here, I am not sure what you are getting at, J. Daniel?</div>
<p><a id="482265" href="#482265">#</a> <strong>J. Daniel Smith</strong> on Tuesday, October 18, 2005 11:28 AM:</p><div style="margin-left: 1em">Yes, I realize Whidbey is frozen harder than the Antarctic ice pack…I thought the &quot;static&quot; function taking two arguments made things clear; I guess not. Sorry.<br><br>Show us the exact C# code for your FileNameCompare() utility function; that way there can be no confusion as to the proper technique.  My preference would be to take stronger-typed FileSystemInfo parameters (rather than just strings)…and also to indicate that eventually such code should perhaps be part of that class.<br></div>
<p><a id="482374" href="#482374">#</a> <strong>Michael S. Kaplan</strong> on Tuesday, October 18, 2005 3:51 PM:</p><div style="margin-left: 1em">Ah, the reasons I am resistant to *that* particular path are the subject of another blog entry, coming soon! :-)</div>
<hr/><p><em>referenced by</em></p><div style="margin-left: 1em"><p>2015/08/17 <a href="http://archives.miloush.net/michkap/archive/2015/08/17/8770668856267197030.html">Comparing migrated blog posts the right way</a></p><p>2008/06/25 <a href="http://archives.miloush.net/michkap/archive/2008/06/25/8652525.html">Seeing the tears, my heart went out to her as I asked her "Why the Long S?"</a></p><p>2006/04/24 <a href="http://archives.miloush.net/michkap/archive/2006/04/24/581628.html">Why I am not in favor of a FileSystemInfo.Compare method</a></p><p>2005/10/18 <a href="http://archives.miloush.net/michkap/archive/2005/10/18/482088.html">How best to alter case</a></p></div><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2005/10/17/481627.html" title="Round trip calls do not always go both ways">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2005/10/16/481625.html" title="A reset does not mean everything was thrown away">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2005-10">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2005-10-17">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2005/10/17/481600.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:40 GMT -->
</html>