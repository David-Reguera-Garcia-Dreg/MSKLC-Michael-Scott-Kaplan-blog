<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2005/10/17/481627.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:40 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>Round trip calls do not always go both ways</title></head><body>
<h1>Round trip calls do not always go both ways</h1>
<p><em>by Michael S. Kaplan, published on 2005/10/17 03:01 -04:00, original URI: http://blogs.msdn.com/b/michkap/archive/2005/10/17/481627.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostNew -->
<P><FONT face=Tahoma>A few days ago, Someone with the handle of MorningSunShine asked in the newsgroups:</FONT></P>
<BLOCKQUOTE dir=ltr style="MARGIN-RIGHT: 0px">
<P><EM><FONT size=2>I&nbsp;used WideCharToMultiByte() a lot to convert unicode characters to multibyte chars back and forth. However, when the unicode is between 0x3400 and&nbsp;0x4dff, it failed to do its job. Why?<BR>--&nbsp;<BR>Wind, Forest, Fire, Mountain. </FONT></EM></P></BLOCKQUOTE>
<P><FONT face=Tahoma>The range in question is a superset of the currently encoded characters in <A href="http://www.unicode.org/charts/PDF/U3400.pdf">CJK Unified Ideographs Extension A</A>&nbsp;(I say currently encoded because as of Unicode 4.1 only the code units between 0x3400 and 0x4dbf have assigned ideographs).</FONT></P>
<P><FONT face=Tahoma>So the answer to MorningSunShine's post is in two parts:</FONT></P>
<P><FONT face=Tahoma>1) The code units between U+4dc0 and U+4dff <STRIKE><FONT color=#d3d3d3>are not currently encoded</FONT></STRIKE><FONT color=#ff0000>contain the Yijing Hexagram Symbols, which are not on any legacy code page</FONT>, so of course attempting to roundtrip through successive </FONT><A href="http://msdn.microsoft.com/library/en-us/intl/unicode_2bj9.asp"><FONT face=Tahoma>WideCharMultiByte</FONT></A><FONT face=Tahoma> and </FONT><A href="http://msdn.microsoft.com/library/en-us/intl/unicode_17si.asp"><FONT face=Tahoma>MultiByteToWideChar</FONT></A><FONT face=Tahoma> calls will not work.<STRIKE><FONT color=#d3d3d3>; they have no identity in Unicode so they can't be expected to exist in any legacy code pages</FONT></STRIKE></FONT></P>
<P><FONT face=Tahoma>2) The code units between U+3400 and U+4dbf are encoded as CJK Extension A, which was encoded in Unicode <EM>after</EM> all of the various legacy code pages. As I pointed out in <a href="http://archives.miloush.net/michkap/archive/2005/02/06/368081.html">this post</A>, we do not change code pages any more; we have learned our lesson on <EM>that</EM> one.</FONT></P>
<P><FONT face=Tahoma>So unless you are trying to roundtrip through UTF-8 or GB-18030 (or UTF-32/UTF-16BE on the .NET Framework!), there is no way you could ever really hope to have the characters survive an attempt to roundtrip through one of the other code pages....</FONT></P>
<P><EM><FONT face=Tahoma color=#ff0000>Special thanks to Andrew West for reminding me about the Yijing Hexagram Symbols, and inspiring the correction above! in point #1!</FONT></EM></P>
<P><FONT face=Tahoma></FONT>&nbsp;</P>
<P><EM><FONT face=Tahoma color=#ff1493>This post sponsored by "?" (</FONT></EM><EM><FONT face=Tahoma color=#ff1493><A href="http://www.fileformat.info/info/unicode/char/0300/index.htm">U+003f</A></FONT></EM><EM><FONT face=Tahoma><FONT color=#ff1493>, a.k.a. QUESTION MARK)<BR><FONT size=1>The character that appears for almost all code pages when you try to convert from Unicode into them and the character does not exist....</FONT></FONT></FONT></EM></P></STRIKE>
<hr/><p><a id="481768" href="#481768">#</a> <strong>Andrew West</strong> on 17 Oct 2005 7:45 AM:</p><div style="margin-left: 1em">&quot;The code units between U+4dc0 and U+4dff are not currently encoded&quot;.<br><br>Have you forgotten the Yijing Hexagram Symbols that have occupied U+4DC0..U+4DFF since Unicode 4.0 ? Of course, there will be no round-tripping for these characters as they are not in any of the legacy encodings (at least none that I know of).<br></div>
<p><a id="481806" href="#481806">#</a> <strong>Michael S. Kaplan</strong> on 17 Oct 2005 9:52 AM:</p><div style="margin-left: 1em">Yikes, I did! Thanks for the correction, I will post it shortly....</div>
<hr/><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2005/10/18/481654.html" title="Font Linking vs. Font Fallback, #2">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2005/10/17/481600.html" title="Comparing Unicode file names the right way">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2005-10">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2005-10-17">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2005/10/17/481627.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:40 GMT -->
</html>