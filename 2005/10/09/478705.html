<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2005/10/09/478705.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:41 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>Extending collation support in SQL Server and Jet, Part 3 (THAT CLASS)</title></head><body>
<h1>Extending collation support in SQL Server and Jet, Part 3 (THAT CLASS)</h1>
<p><em>by Michael S. Kaplan, published on 2005/10/09 03:31 -04:00, original URI: http://blogs.msdn.com/b/michkap/archive/2005/10/09/478705.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostNew -->
<P><FONT face=Tahoma>Prior posts in this series:</FONT></P>
<P><a href="http://archives.miloush.net/michkap/archive/2005/09/13/463962.html"><FONT face=Tahoma>Extending collation support in SQL Server and Jet, Part 0 (HISTORY)</FONT></A><BR><a href="http://archives.miloush.net/michkap/archive/2005/09/14/464780.html"><FONT face=Tahoma>Extending collation support in SQL Server and Jet, Part 1 (the broad strokes)</FONT></A><BR><a href="http://archives.miloush.net/michkap/archive/2005/09/18/470869.html"><FONT face=Tahoma>Extending collation support in SQL Server and Jet, Part 2 (generating sort keys)</FONT></A><BR><a href="http://archives.miloush.net/michkap/archive/2005/09/25/473686.html"><FONT face=Tahoma>Extending collation support in SQL Server and Jet, Part 2.1 (is this on?)</FONT></A></P>
<P><FONT face=Tahoma>I thought I would finish that class first, and then be able to move on to the next steps....</FONT></P>
<P><FONT face=Tahoma>Now, if you remember in <a href="http://archives.miloush.net/michkap/archive/2005/06/09/427293.html">string.Compare is for sissies (not for people who want SQLCLR consistency)</A> there are all of the flag values that change between SQL Server/Windows and the CompareOptions enumeration. We will use that information for&nbsp;a private method in our class and a special constructor to take the SQL Server flags values.</FONT></P>
<P><FONT face=Tahoma>Here goes:</FONT></P>
<P><FONT face="Courier New"><STRONG>&nbsp;&nbsp;&nbsp; sealed public class CustomSqlCollation {<BR><BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <FONT color=#008000>//<BR></FONT>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <FONT color=#008000>// Private members</FONT><BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <FONT color=#008000>//<BR></FONT>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; private CultureInfo m_cultureInfo;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; private CompareInfo m_compareInfo;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; private CompareOptions m_options;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; private int m_flags;</STRONG></FONT><FONT face="Courier New"><STRONG><BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; private string m_name;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; private int m_lcid;</STRONG></FONT></P>
<P><FONT face="Courier New"><STRONG>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; private const int NORM_IGNORECASE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; = 0x00000001;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; private const int NORM_IGNOREKANATYPE&nbsp;&nbsp; = 0x00010000;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; private const int NORM_IGNORENONSPACE&nbsp;&nbsp; = 0x00000002;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; private const int NORM_IGNORESYMBOLS&nbsp;&nbsp;&nbsp; = 0x00000004;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; private const int NORM_IGNOREWIDTH&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; = 0x00020000;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; private const int SORT_STRINGSORT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; = 0x00001000;<BR><BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;private static CompareOptions CompareOptionsFromFlags(int flags)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; CompareOptions&nbsp;options = CompareOptions.None;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if ((flags &amp; NORM_IGNORECASE)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!= 0) { options |= CompareOptions.IgnoreCase;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if ((flags &amp; NORM_IGNOREKANATYPE)&nbsp;!= 0) { options |= CompareOptions.IgnoreKanaType;&nbsp;}<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if ((flags &amp; NORM_IGNORENONSPACE) != 0) { options |= CompareOptions.IgnoreNonSpace;&nbsp;}<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if ((flags &amp; NORM_IGNORESYMBOLS)&nbsp;&nbsp;!= 0) { options |= CompareOptions.IgnoreSymbols;&nbsp;&nbsp;}<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if ((flags &amp; NORM_IGNOREWIDTH)&nbsp;&nbsp;&nbsp;&nbsp;!= 0) { options |= CompareOptions.IgnoreWidth;&nbsp;&nbsp;&nbsp;&nbsp;}<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if ((flags &amp; SORT_STRINGSORT)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!= 0) { options |= CompareOptions.StringSort;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</STRONG></FONT></P>
<P><FONT face="Courier New"><STRONG>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return options;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<BR><BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;private static CompareOptions FlagsFromCompareOptions(CompareOptions&nbsp;options)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; int flags = 0;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if ((options &amp; CompareOptions.IgnoreCase)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!= 0) { flags |= NORM_IGNORECASE;&nbsp;&nbsp;&nbsp;&nbsp; }<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if ((options &amp; CompareOptions.IgnoreKanaType)&nbsp;!= 0) { flags |= NORM_IGNOREKANATYPE; }<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if ((options &amp; CompareOptions.IgnoreNonSpace)&nbsp;!= 0) { flags |= NORM_IGNORENONSPACE; }<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if ((options &amp; CompareOptions.IgnoreSymbols)&nbsp;&nbsp;!= 0) { flags |= NORM_IGNORESYMBOLS;&nbsp; }<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if ((options &amp; CompareOptions.IgnoreWidth)&nbsp;&nbsp;&nbsp;&nbsp;!= 0) { flags |= NORM_IGNOREWIDTH;&nbsp;&nbsp;&nbsp; }<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if ((options &amp; CompareOptions.StringSort)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!= 0) { flags |= SORT_STRINGSORT;&nbsp;&nbsp;&nbsp;&nbsp; }</STRONG></FONT></P>
<P><FONT face="Courier New"><STRONG><FONT face="Courier New"><STRONG>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return flags;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</STRONG></FONT></P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <FONT color=#008000>//<BR></FONT>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <FONT color=#008000>//&nbsp;Constructors</FONT><BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <FONT color=#008000>//<BR></FONT>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public CustomSqlCollation(string name, CompareOptions options) {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.m_options =&nbsp;options;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; this.m_flags =&nbsp;FlagsFromCompareOptions(options);<FONT face="Courier New"><BR></FONT>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.m_cultureInfo =&nbsp;CultureInfo.GetCultureInfo(name, false);<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.m_compareInfo = this.m_cultureInfo.CompareInfo;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.m_name = name;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; this.m_lcid = this.m_compareInfo.LCID;<BR></STRONG></FONT><FONT face="Courier New"><STRONG>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</STRONG></FONT></P>
<P><FONT face="Courier New"><STRONG>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public CustomSqlCollation(int lcid, CompareOptions options) {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.m_options =&nbsp;options;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; this.m_flags =&nbsp;FlagsFromCompareOptions(options);<FONT face="Courier New"><BR></FONT>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.m_cultureInfo =&nbsp;CultureInfo.GetCultureInfo(lcid, false);<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.m_compareInfo = this.m_cultureInfo.CompareInfo;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.m_name = this.m_compareInfo.Name;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; this.m_lcid = lcid;<FONT face="Courier New"><BR></FONT><FONT face="Courier New"><STRONG>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</STRONG></FONT></STRONG></FONT></P>
<P><STRONG><FONT face="Courier New">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public CustomSqlCollation(string name, int flags) {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; this.m_flags =&nbsp;flags;<FONT face="Courier New"><BR></FONT>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.m_options =&nbsp;CompareOptionsFromFlags(flags);<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.m_cultureInfo =&nbsp;CultureInfo.GetCultureInfo(name, false);<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.m_compareInfo = this.m_cultureInfo.CompareInfo;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.m_name = name;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; this.m_lcid = this.m_compareInfo.LCID;<BR><FONT face="Courier New"><STRONG>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</STRONG></FONT></P>
<P><FONT face="Courier New"><STRONG>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public CustomSqlCollation(int lcid, int flags) {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; this.m_flags =&nbsp;flags;<FONT face="Courier New"><BR></FONT>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.m_options =&nbsp;CompareOptionsFromFlags(flags);<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.m_cultureInfo =&nbsp;CultureInfo.GetCultureInfo(lcid, false);<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.m_compareInfo = this.m_cultureInfo.CompareInfo;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.m_name = this.m_compareInfo.Name;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; this.m_lcid = lcid;<FONT face="Courier New"><BR></FONT><FONT face="Courier New"><STRONG>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</STRONG></FONT></STRONG></FONT></P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public int LCID {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; get {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return this.m_lcid;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</FONT></STRONG></P><FONT face="Courier New"><STRONG>
<P><STRONG><FONT face="Courier New">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public&nbsp;string Name&nbsp;{<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; get {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return this.m_name;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</FONT></STRONG></P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <FONT color=#008000>//&nbsp;Method to return an index value</FONT><BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public byte[] GetSortKey(string input) {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return this.m_compreInfo.GetSortKey(input, this.m_options);</STRONG></FONT><FONT face="Courier New"><BR><STRONG>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</STRONG></FONT></P>
<P><FONT face="Courier New"><STRONG>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <FONT color=#008000>//<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // Compare&nbsp;overrides<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //</FONT><BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public int Compare(string&nbsp;string1, string&nbsp;string2) {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return this.m_compareInfo.Compare(string1, string2,&nbsp;this.m_options);</STRONG></FONT><FONT face="Courier New"><BR><STRONG>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </STRONG></FONT><FONT face="Courier New"><STRONG>}&nbsp;</STRONG></FONT></P>
<P><FONT face="Courier New"><STRONG><FONT face="Courier New"><STRONG>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public int Compare(string&nbsp;string1, int offset1, string&nbsp;string2, int offset2) {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return this.m_compareInfo.Compare(string1, offset1, string2,&nbsp;offset2, this.m_options);<FONT face="Courier New"><BR><STRONG>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </STRONG></FONT><FONT face="Courier New"><STRONG>}&nbsp;</STRONG></FONT></STRONG></FONT></STRONG></FONT></P><FONT face="Courier New"><STRONG><FONT face="Courier New"><STRONG>
<P><FONT face="Courier New"><STRONG><FONT face="Courier New"><STRONG>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public int Compare(string&nbsp;string1, int offset1, int length1, string&nbsp;string2, int offset2, int length2) {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return this.m_compareInfo.Compare(string1, offset1, length1, string2,&nbsp;offset2, length2, this.m_options);<FONT face="Courier New"><BR><STRONG>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </STRONG></FONT><FONT face="Courier New"><STRONG>}&nbsp;</STRONG></FONT></STRONG></FONT></STRONG></FONT></P>
<P></STRONG></FONT>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <FONT color=#008000>//<BR></FONT>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <FONT color=#008000>//&nbsp;IndexOf overrides</FONT><BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <FONT color=#008000>//<BR></FONT>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public int IndexOf(string&nbsp;source, char value) {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return this.m_compareInfo.IndexOf(source, value,&nbsp;this.m_options);<FONT face="Courier New"><BR><STRONG>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </STRONG></FONT><FONT face="Courier New"><STRONG>}</STRONG></FONT></P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public int IndexOf(string&nbsp;source, string value) {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return this.m_compareInfo.IndexOf(source, value,&nbsp;this.m_options);<FONT face="Courier New"><BR><STRONG>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </STRONG></FONT><FONT face="Courier New"><STRONG>}</STRONG></FONT></P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public int IndexOf(string&nbsp;source, char value, int startIndex) {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return this.m_compareInfo.IndexOf(source, value,&nbsp;startIndex, this.m_options);<FONT face="Courier New"><BR><STRONG>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </STRONG></FONT><FONT face="Courier New"><STRONG>}</STRONG></FONT></P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public int IndexOf(string&nbsp;source, string value, int startIndex) {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return this.m_compareInfo.IndexOf(source, value,&nbsp;startIndex, this.m_options);<FONT face="Courier New"><BR><STRONG>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </STRONG></FONT><FONT face="Courier New"><STRONG>}</STRONG></FONT></P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public int IndexOf(string&nbsp;source, char value, int startIndex, int count) {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return this.m_compareInfo.IndexOf(source, value,&nbsp;startIndex, count, this.m_options);<FONT face="Courier New"><BR><STRONG>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </STRONG></FONT><FONT face="Courier New"><STRONG>}</STRONG></FONT></P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public int IndexOf(string&nbsp;source, string value, int startIndex, int count) {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return this.m_compareInfo.IndexOf(source, value,&nbsp;startIndex, count, this.m_options);<FONT face="Courier New"><BR><STRONG>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </STRONG></FONT><FONT face="Courier New"><STRONG>}</STRONG></FONT></P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <FONT color=#008000>//<BR></FONT>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <FONT color=#008000>//&nbsp;LastIndexOf overrides</FONT><BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <FONT color=#008000>//<BR></FONT>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public int LastIndexOf(string&nbsp;source, char value) {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return this.m_compareInfo.LastIndexOf(source, value,&nbsp;this.m_options);<FONT face="Courier New"><BR><STRONG>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </STRONG></FONT><FONT face="Courier New"><STRONG>}</STRONG></FONT></P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public int LastIndexOf(string&nbsp;source, string value) {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return this.m_compareInfo.LastIndexOf(source, value,&nbsp;this.m_options);<FONT face="Courier New"><BR><STRONG>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </STRONG></FONT><FONT face="Courier New"><STRONG>}</STRONG></FONT></P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public int LastIndexOf(string&nbsp;source, char value, int startIndex) {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return this.m_compareInfo.LastIndexOf(source, value,&nbsp;startIndex, this.m_options);<FONT face="Courier New"><BR><STRONG>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </STRONG></FONT><FONT face="Courier New"><STRONG>}</STRONG></FONT></P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public int LastIndexOf(string&nbsp;source, string value, int startIndex) {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return this.m_compareInfo.LastIndexOf(source, value,&nbsp;startIndex, this.m_options);<FONT face="Courier New"><BR><STRONG>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </STRONG></FONT><FONT face="Courier New"><STRONG>}</STRONG></FONT></P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public int LastIndexOf(string&nbsp;source, char value, int startIndex, int count) {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return this.m_compareInfo.LastIndexOf(source, value,&nbsp;startIndex, count, this.m_options);<FONT face="Courier New"><BR><STRONG>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </STRONG></FONT><FONT face="Courier New"><STRONG>}</STRONG></FONT></P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public int LastIndexOf(string&nbsp;source, string value, int startIndex, int count) {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return this.m_compareInfo.LastIndexOf(source, value,&nbsp;startIndex, count, this.m_options);<FONT face="Courier New"><BR><STRONG>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </STRONG></FONT><FONT face="Courier New"><STRONG>}</STRONG></FONT></P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <FONT color=#008000>//<BR></FONT>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <FONT color=#008000>//&nbsp;IsPrefix&nbsp;method</FONT><BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <FONT color=#008000>//<BR></FONT>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public int IsPrefix(string&nbsp;source, string prefix) {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return this.m_compareInfo.IsPrefix(source, prefix,&nbsp;this.m_options);<FONT face="Courier New"><BR><STRONG>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </STRONG></FONT><FONT face="Courier New"><STRONG>}</STRONG></FONT></P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <FONT color=#008000>//<BR></FONT>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <FONT color=#008000>//&nbsp;IsSuffix&nbsp;method</FONT><BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <FONT color=#008000>//<BR></FONT>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public int IsSuffix(string&nbsp;source, string suffix) {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return this.m_compareInfo.IsSuffix(source, suffix,&nbsp;this.m_options);<FONT face="Courier New"><BR><STRONG>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </STRONG></FONT><FONT face="Courier New"><STRONG>}</STRONG></FONT></P>
<P>&nbsp;&nbsp;&nbsp;&nbsp; }</STRONG></FONT></P>
<P><FONT face=Tahoma>Some random notes on the class:</FONT></P>
<P><FONT face=Tahoma>For now, I have left off the overrides to take other CompareOptions choices within the various methods. This is something that can be added later without too much trouble if people need them.</FONT></P>
<P><FONT face=Tahoma>I am also creating a class here that could mostly be an override of CompareInfo, but I am resisting doing that for the moment, since that adds other requirements that may or may not be worth taking on.</FONT></P>
<P><FONT face=Tahoma>The constructors that take flags values will handle string sorts, which SQL Server does not support but Windows does. It is just a few extra lines of code so it is no big deal if it is included or not.</FONT></P>
<P><FONT face=Tahoma>Finally, of course when writing the private CompareOptionsFromFlags and FlagsFromCompareOptions methods, I could have done something clever with the numbers that are different rather than just building up the new numbers fully, but this just seems more self-documenting for an operation that probably does not happen very often.</FONT></P>
<P><FONT face=Tahoma>I'll write more in the series tomorrow or the day after....</FONT></P>
<P><FONT face=Tahoma></FONT>&nbsp;</P>
<P><FONT face=Tahoma color=#ff1493><EM>This post brought to you by</EM> "Ǫ" <EM>(<A href="http://www.fileformat.info/info/unicode/char/01ea/index.htm">U+01ea</A>, a.k.a. LATIN CAPITAL LETTER O WITH OGONEK)</EM></FONT></P>
<hr/><p><a id="479113" href="#479113">#</a> <strong>silverpie</strong> on 10 Oct 2005 9:27 AM:</p><div style="margin-left: 1em">The sponsor looks a lot like U+0051...is it on the IDN security danger list?</div>
<p><a id="479846" href="#479846">#</a> <strong>Michael S. Kaplan</strong> on 11 Oct 2005 6:25 PM:</p><div style="margin-left: 1em">Excellent question -- I am not sure, though. I'll have to look at the proposed UTS....</div>
<p><a id="480019" href="#480019">#</a> <strong>Michael S. Kaplan</strong> on 12 Oct 2005 6:31 AM:</p><div style="margin-left: 1em">Looking at the latest proposed draft UTS (<a rel="nofollow" target="_new" href="http://www.unicode.org/reports/tr39/tr39-1.html">http://www.unicode.org/reports/tr39/tr39-1.html</a>), specifically as t he list of confusables (<a rel="nofollow" target="_new" href="http://www.unicode.org/reports/tr39/data/confusables.txt">http://www.unicode.org/reports/tr39/data/confusables.txt</a>), it is not currently there. But I am going to propose it....</div>
<hr/><p><em>referenced by</em></p><div style="margin-left: 1em"><p>2007/07/02 <a href="http://archives.miloush.net/michkap/archive/2007/07/02/3660189.html">Not so Lao[d], at least not until Vista</a></p><p>2005/10/21 <a href="http://archives.miloush.net/michkap/archive/2005/10/21/480898.html">Extending collation support in SQL Server and Jet, Part 4 (What about Jet?)</a></p></div><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2005/10/09/478897.html" title="Hangul Day / Han&#39;gŭl Day / Hangeul Day / 한글날 !">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2005/10/09/478650.html" title="Disclaimer required?">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2005-10">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2005-10-09">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2005/10/09/478705.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:41 GMT -->
</html>