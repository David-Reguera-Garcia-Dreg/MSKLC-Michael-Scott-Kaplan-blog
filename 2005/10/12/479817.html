<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2005/10/12/479817.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:40 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>Some of GetGeoInfo is sorta broken</title></head><body>
<h1>Some of GetGeoInfo is sorta broken</h1>
<p><em>by Michael S. Kaplan, published on 2005/10/12 03:01 -04:00, original URI: http://blogs.msdn.com/b/michkap/archive/2005/10/12/479817.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostNew -->
<P><FONT face=Tahoma>Remember back when I was going on&nbsp;in <a href="http://archives.miloush.net/michkap/archive/2005/05/28/422808.html">time zones and locations and keyboards</A>&nbsp;about how we could use GEOID values for everything? And then Mihai helped me realize that <a href="http://archives.miloush.net/michkap/archive/2005/06/01/424067.html">GEOID support is not quite done</A>?</FONT></P>
<P><FONT face=Tahoma>Well,&nbsp;we were&nbsp;digging into things again and realized there are some more problems here.</FONT></P>
<P><FONT face=Tahoma>Let's take a look at the prototype for <A href="http://msdn.microsoft.com/library/en-us/intl/nls_6bqn.asp">GetGeoInfo</A>:</FONT></P>
<BLOCKQUOTE dir=ltr style="MARGIN-RIGHT: 0px">
<P><FONT face="Courier New">int GetGeoInfo(<BR>&nbsp; GEOID GeoId,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // location identifier<BR>&nbsp; GEOTYPE GeoType,&nbsp;&nbsp;&nbsp;&nbsp; // type of information requested<BR>&nbsp; LPTSTR lpGeoData,&nbsp;&nbsp;&nbsp; // buffer for results<BR>&nbsp; int cchData,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // size of buffer<BR>&nbsp; LANGID language&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // language id<BR>);</FONT></P></BLOCKQUOTE>
<P><FONT face=Tahoma>Now obviously the GeoId parameter is the GEOID you are querying about. That part is fine.</FONT></P>
<P><FONT face=Tahoma>The language parameter is basically broken:</FONT></P>
<UL>
<LI><FONT face=Tahoma>The two times it would be theoretically useful (the GEO_FRIENDLYNAME and GEO_OFFICIALNAME <A href="http://msdn.microsoft.com/library/en-us/intl/nls_7d2d.asp">SYSGEOTYPE</A> values), it is not used;&nbsp; instead, the strings are loaded using FindResourceExW with a 0 in the wLanguage parameter.</FONT> 
<LI><FONT face=Tahoma>One of the times it actually is used is when&nbsp;you are passing GEO_RFC1766, and it is actually used to try and build an RFC1766 code based on the ISO-639 code of that LANGID and the ISO-3166 code of the GEOID. In other words, don't pass a GEOID and LANGID that do not match!</FONT> 
<LI><FONT face=Tahoma>The other time it is actually used is when you are passing GEO_LCID. It will then treat it as an LCID and work to try to return that LCID if it is associated with the given GEOID in some way. So once again, not-matching parameters would not make too much sense.</FONT></LI></UL>
<P><FONT face=Tahoma>Now these latter two cases, if you pass 0 then it does not use the user default UI language (as <A href="http://msdn.microsoft.com/library/en-us/intl/nls_5c85.asp">GetUserDefaultUILanguage</A> would return)&nbsp;-- it uses the user default langid (as <A href="http://msdn.microsoft.com/library/en-us/intl/nls_2lgk.asp">GetUserDefaultLangId</A> would return). In other words the default user locale. This is usually not noticed since actual resources are loaded with that FindResourceExW call, which I think might pick up the thread locale if that FindResourceEx text is accurate:</FONT></P>
<BLOCKQUOTE dir=ltr style="MARGIN-RIGHT: 0px">
<P><FONT face=Tahoma><STRONG>wLanguage</STRONG></FONT></P>
<P><FONT face=Tahoma>[in] Specifies the language of the resource. <EM>If this parameter is MAKELANGID(LANG_NEUTRAL, SUBLANG_NEUTRAL), the current language associated with the calling thread is used.</EM> </FONT></P></BLOCKQUOTE>
<P><FONT face=Tahoma>But we all know <a href="http://archives.miloush.net/michkap/archive/2005/08/22/454360.html">how I feel about the thread locale</A>, don't we? :-)</FONT></P>
<P><FONT face=Tahoma>Ok, we have one useless parameter and at least four useless SYSGEOTYPE values. I am going to go out on a limb and suggest that this is&nbsp;a good function to steer clear of, unless you are using one of the other SYSGEOTYPE values. And avoid the language parameter if you can....</FONT></P>
<P><FONT face=Tahoma></FONT>&nbsp;</P>
<P><FONT face=Tahoma><FONT color=#ff1493><EM>This post brought to you by</EM> "ุด" <EM>(<A href="http://www.fileformat.info/info/unicode/char/0634/index.htm">U+0634</A>, a.k.a. ARABIC LETTER SHEEN)</EM></FONT></FONT></P>
<hr/><p><a id="480020" href="#480020">#</a> <strong>Nick Lamb</strong> on 12 Oct 2005 6:39 AM:</p><div style="margin-left: 1em">&quot;a GEOID and LANGID that do not match&quot;<br><br>RFC 1766 doesn't have a notion of matching countries and languages. The API here makes sense technically. To make up an RFC 1766 language tag from ISO codes you want a language (e.g. Japanese, &quot;ja&quot;) and a country code (e.g. the United Kingdom, &quot;GB&quot;). In Windows programmers may have these opaque numeric IDs for everything - so it makes sense on the surface to map (LANGID, GEOID) -&gt; (RFC 1766)<br><br>However, although the API makes sense, it's not clear what possible real world /use/ it is. RFC 1766 can represent a British dialect of Japanese, but it's more likely that Japanese speakers in the UK are using the same language as their counterparts in Japan. The constructor described for Windows language IDs already seems to understand the idea of dialects and other variants, albeit in a rather primitive way. Is there a way to ask directly for the RFC1766 representation of a Windows LANGID?</div>
<p><a id="480022" href="#480022">#</a> <strong>Michael S. Kaplan</strong> on 12 Oct 2005 6:43 AM:</p><div style="margin-left: 1em">Hi Nick --<br><br>You can ask for the various ISO names (639 and 3166) which together make a nice first cut at an RFC1766 or even RFC3066 name, but toget them toether you have to look to Vista....</div>
<hr/><p><em>referenced by</em></p><div style="margin-left: 1em"><p>2008/03/22 <a href="http://archives.miloush.net/michkap/archive/2008/03/22/8330506.html">GetGeoInfo is a mostly useless bloody waste of a function that only a "B" Ark Golgafrincham could love</a></p></div><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2005/10/13/480718.html" title="Searching encoded strings in SQL Server 2000?">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2005/10/12/479561.html" title="I&#39;d rather call it the path separator">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2005-10">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2005-10-12">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2005/10/12/479817.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:40 GMT -->
</html>