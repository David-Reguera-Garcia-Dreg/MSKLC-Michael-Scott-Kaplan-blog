<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2005/10/13/480718.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:40 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>Searching encoded strings in SQL Server 2000?</title></head><body>
<h1>Searching encoded strings in SQL Server 2000?</h1>
<p><em>by Michael S. Kaplan, published on 2005/10/13 14:45 -04:00, original URI: http://blogs.msdn.com/b/michkap/archive/2005/10/13/480718.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostNew -->
<P><FONT face=Tahoma>A guy named Michael (who is not me) asked the following question in the Suggestion Box:</FONT></P>
<BLOCKQUOTE dir=ltr style="MARGIN-RIGHT: 0px">
<P><FONT size=2><EM>Is it possible to search an NVARCHAR column containing string data encoded in a number of different encoding types? <BR><BR>I'm dealing with iso-8859-15, big5, utf-8, iso-8859-1, us-ascii encoding types and need to search the strings for keywords using either full-text indexing or the LIKE clause.</EM></FONT></P></BLOCKQUOTE>
<P><FONT face=Tahoma>The quick answer is no.</FONT></P>
<P><FONT face=Tahoma>The slightly&nbsp;less quick answer is that&nbsp;there is no way to really store text in a way that is telling a lie about what it is encoded with and then search it in those muliple forms.</FONT></P>
<P><FONT face=Tahoma>Now I am not advocating this issue for moral reasons (though it is strangely compelling to me to be able to claim that my code is honest!).</FONT></P>
<P><FONT face=Tahoma>SQL Server does have the ability in its non-Unicode data types to store data in different encodings and have SQL Server properly search across them. As a rule you do not ever want to lie about the encoding because SQL Server uses that as a hint on how it can use the data and what can be done with it. It is definitely one way to approach the desire to stire data in different encodings (the better way would be to store the data in Unicode and then convert any time you have to communicate with legacy systems that do not understand Unicode....</FONT></P>
<P><FONT face=Tahoma></FONT>&nbsp;</P>
<P><FONT face=Tahoma color=#ff1493><EM>This post brought to you by</EM> "<FONT face="Mongolian Baiti" size=6>ᡁ</FONT>" <EM>(<A href="http://www.fileformat.info/info/unicode/char/1841/index.htm">U+1841</A>, a.k.a. MONGOLIAN LETTER ZHI)</EM></FONT></P>
<hr/><p><a id="480737" href="#480737">#</a> <strong>Jerry Pisk</strong> on 13 Oct 2005 3:28 PM:</p><div style="margin-left: 1em">Isn't NVARCHAR Unicode string data? Regardless of how it's encoded internally you should only put valid Unicode strings to it (mapping from whatever your source character set is to Unicode). How it's encoded inside of MSSQL should not matter, should it?</div>
<p><a id="480739" href="#480739">#</a> <strong>Michael S. Kaplan</strong> on 13 Oct 2005 3:35 PM:</p><div style="margin-left: 1em">Hi Jerry -- you are right. Only Unicode data should be there. Internals matter since nothing can contain all that Unicode does.</div>
<p><a id="480814" href="#480814">#</a> <strong>Maurits [MSFT]</strong> on 13 Oct 2005 6:04 PM:</p><div style="margin-left: 1em">nvarchar is always UTF-16, right?<br>And varchar encoding is determined by the collation options for the server, database, table, or column (level of granularity differing by SQL Server version)?<br><br>But if you want to store /different encodings/ in a /single column/, you'd have to use varbinary...<br><br>For example:<br><br>CREATE TABLE InternationalTextExample<br>AS<br>(<br>  <br>  UnicodeText nvarchar(200),<br>  LocalEncodedText varbinary(200),<br>  LocalEncodingScheme varchar(10)<br>)<br><br>The UnicodeText would be LIKEable and full-text-indexable, sure...<br><br>But is there a SQL expression I could use to convert the LocalEncodedText to nvarchar using the LocalEncodingScheme?  I've been digging through CAST() and CONVERT() and COLLATE documentation, but I can't quite see it.<br><br>I suppose another method would be to use<br>CREATE TABLE InternationalTextExample2<br>AS<br>(<br>  <br>  UnicodeText nvarchar(200),<br>  KoreanText varchar(200) COLLATE Korean_Wansung_CI_AS,<br>  Latin1Text varchar(200) COLLATE SQL_Latin1_General_Cp1_CI_AI<br>)<br><br>and store equivalent forms on a &quot;best effort&quot; basis.</div>
<p><a id="481162" href="#481162">#</a> <strong>Jerry Pisk</strong> on 14 Oct 2005 2:03 PM:</p><div style="margin-left: 1em">You do not have to use varbinary, you can still use nvarchar and lie about what characters are in there. For example, you put the yen character in as U+005C (as it is in 932) instead of the correct u+00a5 at the same time another row would have a character U+005C that actually means the won sign (in 949). SQL Server will think that you're putting in the &quot;whack&quot; in both cases. I think the original question was about this kind of shenanigans, how to search the string data when it's not actually Unicode.</div>
<p><a id="481212" href="#481212">#</a> <strong>Michael S. Kaplan</strong> on 14 Oct 2005 3:37 PM:</p><div style="margin-left: 1em">Jerry, you really need to avoid that, as there are countless ways that this type of methodology can destroy data. I highly recommend NEVER LYING ABOUT AN ENCODING.<br><br>If you ignore this and later on are hurt by your decision, be sure to rememer who tried to warn you!</div>
<p><a id="481567" href="#481567">#</a> <strong>Maurits [MSFT]</strong> on 16 Oct 2005 9:22 AM:</p><div style="margin-left: 1em">(Sung to the tune of The Bells of Notre Dame)<br><br>You can lie to yourself and your server...<br>You can claim that you haven't a qualm.<br>But you never can run from,<br>Nor hide what you've done from<br>The Eyes...<br>The very Eyes of Unicode!<br></div>
<p><a id="481851" href="#481851">#</a> <strong>Jerry Pisk</strong> on 17 Oct 2005 12:15 PM:</p><div style="margin-left: 1em">Michael, I would personally never do anything like that, I was just trying to guess what the original question was about. I go through a lot of trouble to find out the actual encoding, recently I was dealing with mainframe produced data that was being sent in what was described as ASCII. It took me a long time (weeks) to convince the mainframe folks that ASCII only defines the 7-bit characters and that the rest is in a code page and about a week after that to find out what that code page was. Of course I had management on my back the whole time because to them I was just delaying our project becuase of something that was not important…</div>
<hr/><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2005/10/14/480965.html" title="Syntax Savvy dictionaries?">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2005/10/12/479817.html" title="Some of GetGeoInfo is sorta broken">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2005-10">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2005-10-13">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2005/10/13/480718.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:40 GMT -->
</html>