<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2005/07/31/445819.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:41 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>New in Vista Beta 1: FindNLSString (an 'internationalized' strstr)</title></head><body>
<h1>New in Vista Beta 1: FindNLSString (an 'internationalized' strstr)</h1>
<p><em>by Michael S. Kaplan, published on 2005/07/31 19:10 -04:00, original URI: http://blogs.msdn.com/b/michkap/archive/2005/07/31/445819.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostNew -->
<P><FONT face=Tahoma><EM>This is an example of the kind of features that we in NLS can add to a product -- not as fancy as transparency and other cool Vista stuff that gets all of the press coverage. But there is a certain class of people, a class with a big overlap with those who read this blog, who may find it to be quite interesting. </EM></FONT><FONT face=Tahoma><EM>I am not going to leak anything that is not available in the legitimate beta that may be in your hands right now (or could be some time soon!), so don't get too excited. But there are some very cool features that are going into Windows Vista that may be fun for geeks like me, so consider this the first of many such notices. :-)</EM></FONT></P>
<P><FONT face=Tahoma>The <A href="http://msdn.microsoft.com/library/en-us/vclib/html/_crt_strstr.2c_.wcsstr.2c_._mbsstr.asp">strstr function</A>&nbsp;has been a part of the C Runtime for ages. It's simple job is explained in the docs: "<!-- Topic Status --><EM>Returns a pointer to the first occurrence of a search string in a string.</EM>"</FONT></P>
<P><FONT face=Tahoma>But of course that function (or its Unicode cousin, wcsstr) would never do any of the interesting fun things that <A href="http://msdn.microsoft.com/library/en-us/winui/winui/windowsuserinterface/resources/strings/stringreference/stringfunctions/comparestring.asp">CompareString</A> is so famous for, from ligature equivalences (<A href="http://www.fileformat.info/info/unicode/char/00e6/index.htm">U+00e6</A> æ being equal to the letters ae for most locales) to Unicode canonical equivalences and more.</FONT></P>
<P><FONT face=Tahoma>So for <FONT color=#d3d3d3><STRIKE>Longhorn</STRIKE></FONT>Vista we have added an NLS version of this long-existing functionality -- the FindNLSString function!</FONT></P>
<P><FONT face=Tahoma>The Vista Beta 1 SDK will be available soon, so consider this a marketing preview of the new function. :-)</FONT></P>
<P><FONT face=Tahoma>If you are a developer who has already picked up Beta 1 of Vista off of the MDSN servers, this function is exported from kernel32.dll and gives you all of the functionality of the managed methods off of <A href="http://msdn.microsoft.com/library/en-us/cpref/html/frlrfsystemglobalizationcompareinfoclasstopic.asp">CompareInfo</A>&nbsp;(i.e. <A href="http://msdn.microsoft.com/library/en-us/cpref/html/frlrfsystemglobalizationcompareinfoclassisprefixtopic.asp">IsPrefix</A>, <A href="http://msdn.microsoft.com/library/en-us/cpref/html/frlrfsystemglobalizationcompareinfoclassissuffixtopic.asp">IsSuffix</A>, <A href="http://msdn.microsoft.com/library/en-us/cpref/html/frlrfsystemglobalizationcompareinfoclassindexoftopic.asp">IndexOf</A>, and <A href="http://msdn.microsoft.com/library/en-us/cpref/html/frlrfsystemglobalizationcompareinfoclasslastindexoftopic.asp">LastIndexOf</A>).</FONT></P>
<P><FONT face=Tahoma>The new FindNLSString has one <EM>extra</EM> bit of functionality that neither wcsstr nor those managed methods have ever had before -- an OUT param that will allow the caller to find out the length of the string that was found (which may <EM>not</EM> be the same size as the search string!). </FONT><FONT face=Tahoma>Now if you think about what the FindNLSString function may be used for (a good example is someon using the <A href="http://msdn.microsoft.com/library/en-us/winui/winui/windowsuserinterface/userinput/commondialogboxlibrary/commondialogboxreference/commondialogboxfunctions/replacetext.asp">ReplaceText</A>&nbsp;common dialog to replace one string with another), what better way to mess up an operation than to not know of the length of the string that was actually found? I mean, it is all well and good for the Unicode standard to say that <A href="http://www.fileformat.info/info/unicode/char/00e5/index.htm">U+00e5</A> (LATIN SMALL LETTER A WITH RING ABOVE) is canonically equivalent to <A href="http://www.fileformat.info/info/unicode/char/0061/index.htm">U+0061</A> <A href="http://www.fileformat.info/info/unicode/char/030a/index.htm">U+030a</A> (LATIN SMALL LETTER A + COMBINING RING ABOVE), but if your replace operations starts improperly detecting the subset then it will not be a very effective replace operation, now will it? :-)</FONT></P>
<P><FONT face=Tahoma>Now one feature that has <EM>not</EM> been added is that there are no separate 'A' and 'W' functions -- there is just one Unicode version, without decoration. The trend that started in Windows Server 2003 with <A href="http://msdn.microsoft.com/library/en-us/intl/nls_19ev.asp">IsNLSDefinedString</A>&nbsp;to only add Unicode versions of functions clearly looks to be the way things will be going forward for NLS. If you are not using Unicode, then you will want to realize that you are not going to see some of the features coming out in products.</FONT></P>
<P><FONT face=Tahoma>One obvious question.... why not just call the function FindString to go along with <A href="http://msdn.microsoft.com/library/en-us/winui/winui/windowsuserinterface/resources/strings/stringreference/stringfunctions/comparestring.asp">CompareString</A>, <A href="http://msdn.microsoft.com/library/en-us/intl/nls_5s2v.asp">LCMapString</A>, <A href="http://msdn.microsoft.com/library/en-us/winui/winui/windowsuserinterface/resources/strings/stringreference/stringfunctions/foldstring.asp">FoldString</A>, and so on?</FONT></P>
<P><FONT face=Tahoma>Well, I did try to do that, and managed to break our private build with the change since there were so many cases of internal functions in components and utiities and Platform SDK samples named FindString. Maybe if we had reserved the name 15 years ago, we'd be all set. But even if I changed all of those cases, it is obviously something that would be a problem for users as well. Anything that is in our source code once is in customers' code hundreds of times, and I don't even want to think about how many times it would be in customers' code. Calling it FindNLSString keeps that overlap from being a problem....</FONT></P>
<P><FONT face=Tahoma></FONT>&nbsp;</P>
<P><FONT face=Tahoma color=#ff0000><EM>This post brought to you by</EM> "å" <EM>(<A href="http://www.fileformat.info/info/unicode/char/00e5/index.htm">U+00e5</A>, a.k.a. LATIN SMALL LETTER A WITH RING ABOVE)<BR><FONT size=1>A letter that is anxiously awaiting Vista Beta 1 so that all of its different normalization forms can finally be considered equal!</FONT></EM></FONT></P>
<hr/><p><a id="445902" href="#445902">#</a> <strong>Serge Wautier</strong> on 1 Aug 2005 2:50 AM:</p><div style="margin-left: 1em">One word : Allelujah !<br><br>Just to close the loop with a question of mine in your suggestion box : Does FindNLSString() support case-insensitive search ?</div>
<p><a id="445972" href="#445972">#</a> <strong>Michael S. Kaplan</strong> on 1 Aug 2005 8:20 AM:</p><div style="margin-left: 1em">Yes, certainly it supports NORM_IGNORECASE, Serge! It supports all of the same flags for comparison as CompareString (other than SORT_STRINGSORT, which makes no sense to support!).</div>
<p><a id="464945" href="#464945">#</a> <strong>Michael S. Kaplan</strong> on 13 Sep 2005 2:52 PM:</p><div style="margin-left: 1em">And it looks like the docs are finally online!<br><br><a rel="nofollow" target="_new" href="http://windowssdk.msdn.microsoft.com/library/en-us/Intl/nls_FindNLSString.asp">http://windowssdk.msdn.microsoft.com/library/en-us/Intl/nls_FindNLSString.asp</a></div>
<hr/><p><em>referenced by</em></p><div style="margin-left: 1em"><p>2006/12/09 <a href="http://archives.miloush.net/michkap/archive/2006/12/09/1246712.html">On being consistently consistent, while still managing to be dead wrong</a></p><p>2006/11/20 <a href="http://archives.miloush.net/michkap/archive/2006/11/20/1112734.html">Putting the *backward* in backward compatibility</a></p><p>2006/10/24 <a href="http://archives.miloush.net/michkap/archive/2006/10/24/867880.html">Sometimes in the future 'ANSI' is really going to be unsupported!</a></p><p>2006/07/09 <a href="http://archives.miloush.net/michkap/archive/2006/07/09/658454.html">The fallacy of comparing out of context</a></p><p>2006/05/24 <a href="http://archives.miloush.net/michkap/archive/2006/05/24/605603.html">Is it punctuation, symbol, or diacritic?</a></p><p>2006/01/25 <a href="http://archives.miloush.net/michkap/archive/2006/01/25/517586.html">'right' does not always equal 'smart' #1</a></p><p>2006/01/15 <a href="http://archives.miloush.net/michkap/archive/2006/01/15/512928.html">Falling over the edge of a conceptual collation cliff</a></p><p>2005/12/15 <a href="http://archives.miloush.net/michkap/archive/2005/12/15/503493.html">The bug you wish you'd caught?</a></p><p>2005/12/06 <a href="http://archives.miloush.net/michkap/archive/2005/12/06/500690.html">Sample usage of the FindNLSString function</a></p><p>2005/11/22 <a href="http://archives.miloush.net/michkap/archive/2005/11/22/495033.html">More on the fabled EqualString</a></p><p>2005/10/24 <a href="http://archives.miloush.net/michkap/archive/2005/10/24/483965.html">Searching for supplementary characters</a></p><p>2005/08/25 <a href="http://archives.miloush.net/michkap/archive/2005/08/25/456237.html">My kingdom for some Unicode controls</a></p></div><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2005/07/31/445835.html" title="What&#39;s wrong with the SortKey class?">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2005/07/31/445751.html" title="Microsoft Company Picnic">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2005-07">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2005-07-31">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2005/07/31/445819.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:41 GMT -->
</html>