<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2005/07/09/437063.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:41 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>Getting intermediate forms</title></head><body>
<h1>Getting intermediate forms</h1>
<p><em>by Michael S. Kaplan, published on 2005/07/09 03:01 -04:00, original URI: http://blogs.msdn.com/b/michkap/archive/2005/07/09/437063.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostNew -->
<P><FONT face=Tahoma>Unicode has a certain complexity to it that can at times be challenging.</FONT></P>
<P><FONT face=Tahoma>Let's take for example&nbsp;<A href="http://www.fileformat.info/info/unicode/char/1e35/index.htm">U+1ec5</A>, a.k.a. LATIN SMALL LETTER E WITH CIRCUMFLEX AND TILDE. Here is what it looks like (how good will depend on your OS and browser support!):</FONT></P>
<P><FONT face=Tahoma size=5>ễ</FONT></P>
<P><FONT face=Tahoma>Now obviously that is pretty fully precomposed (in Unicode Normalization Form C). If it is fully decomposed, we get <A href="http://www.fileformat.info/info/unicode/char/0065/index.htm">U+0065</A> <A href="http://www.fileformat.info/info/unicode/char/0302/index.htm">U+0302</A> <A href="http://www.fileformat.info/info/unicode/char/0303/index.htm">U+0303</A>, a.k.a. LATIN SMALL LETTER E +&nbsp;COMBINING CIRCUMFLEX ACCENT +&nbsp;COMBINING TILDE. Here is what it looks like (again, how good will depend on your OS and browser support!):</FONT></P>
<P><FONT face=Tahoma size=5>ễ</FONT></P>
<P><FONT face=Tahoma>And here is where the problems come in. Because between these two extremes lies as third case: <A href="http://www.fileformat.info/info/unicode/char/00ea/index.htm">U+00ea</A> <A href="http://www.fileformat.info/info/unicode/char/0303/index.htm">U+0303</A> a.k.a. LATIN SMALL LETTER E WITH CIRCUMFLEX +&nbsp;COMBINING TILDE. Here is what it looks like (again, how good will depend on your OS and browser support!):</FONT></P>
<P><FONT face=Tahoma size=5>ễ</FONT></P>
<P><FONT face=Tahoma>Now if you convert that third case to NFC you will get the first case, and to NFD you will get the second. How does that happen?</FONT></P>
<P><FONT face=Tahoma>Well, the rules for normalization are that you have to keep on performing the compression or decompression until you can't anymore.</FONT></P>
<P><FONT face=Tahoma>So, there are two ways to get the information of that last case:</FONT></P>
<OL>
<LI><FONT face=Tahoma>You can cart around the decomposition info from the <A href="http://www.unicode.org/ucd">Unicode Character Database</A>&nbsp;so you can get it all yourself.</FONT> 
<LI><FONT face=Tahoma>You can take the NFD string and start converting to NFC with one additional character at a time, thus:</FONT></LI></OL>
<P><FONT face=Tahoma>Step 1:&nbsp;&nbsp;&nbsp;Convert the string to NFD; we now have: </FONT><FONT face=Tahoma>U+0065 U+0302 U+0303</FONT></P>
<P><FONT face=Tahoma>Step 2:&nbsp;&nbsp;&nbsp;U+0065 + U+0302 to NFC == U+00ea; we now also have U+00ea U+0303</FONT></P>
<P><FONT face=Tahoma>Step 3:&nbsp;&nbsp;&nbsp;U+00ea + U+0303 to NFC == <A href="http://www.fileformat.info/info/unicode/char/1ec5/index.htm">U+1ec5</A>; we now also have <A href="http://www.fileformat.info/info/unicode/char/1ec5/index.htm">U+1ec5</A></FONT></P>
<P><FONT face=Tahoma>Now this is not what I would call a perfect algorithm by any stretch of the imagination. But it is a quick and dirty way to get the information on a bunch of equal forms.</FONT></P>
<P><FONT face=Tahoma>But it certainly leaves open the question of whether the operating system and/or the .NET Framework should expose this information at some point....</FONT></P>
<P><FONT face=Tahoma></FONT>&nbsp;</P>
<P><FONT face=Tahoma color=#ff0000><EM>This post brough to you by</EM> "ễ" <EM>(<A href="http://www.fileformat.info/info/unicode/char/1ec5/index.htm">U+1ec5</A>, a.k.a. LATIN SMALL LETTER E WITH CIRCUMFLEX AND TILDE)</EM></FONT></P>
<hr/><p><a id="437092" href="#437092">#</a> <strong>concerned viewer</strong> on 9 Jul 2005 4:00 AM:</p><div style="margin-left: 1em">Just a note to say you've gone from U+1ec5 to U+1e35 - which is &quot;ḵ&quot; (LATIN SMALL LETTER K WITH LINE BELOW), viewable in Tahoma on this box.</div>
<p><a id="437096" href="#437096">#</a> <strong>CornedBee</strong> on 9 Jul 2005 5:27 AM:</p><div style="margin-left: 1em">I'm pleasantly surprised to say that my system displays two of the three forms correctly, considering how outlandish that character is.<br><br>I wonder about one thing: if you reverse the fully decomposed form, that is, put the tilde before the circumflex, should it be displayed below it? Does Unicode have rules for the ordering of these combiners or do they just stack up as they come?</div>
<p><a id="437098" href="#437098">#</a> <strong>Michael Kaplan</strong> on 9 Jul 2005 5:46 AM:</p><div style="margin-left: 1em">Two points, CornedBee -- This character is used in Vietnamese. :-) If you change the order of the diacritics then you are actually changing the order of the stacking (if they have the same canonical combining class). However, normalization will never violate canonical combining classes, so the reorder would always be undone otherwise....</div>
<p><a id="437099" href="#437099">#</a> <strong>Michael S. Kaplan</strong> on 9 Jul 2005 5:51 AM:</p><div style="margin-left: 1em">Thanks, cv -- got that fixed. I don't know what I was thinking *there*. :-)</div>
<p><a id="437107" href="#437107">#</a> <strong>Michael S. Kaplan</strong> on 9 Jul 2005 6:57 AM:</p><div style="margin-left: 1em">Two of the three? IE does all three, flawlessly. :-)<br><br>ễễ&#234;̃<br><br>Heh...</div>
<p><a id="437157" href="#437157">#</a> <strong>Suzanne McCarthy</strong> on 9 Jul 2005 2:58 PM:</p><div style="margin-left: 1em">I have found to my chagrin that blogger fails on all three of the above. I knew this after posting on Vietnamese but now it has been rubbed in. <br></div>
<p><a id="437167" href="#437167">#</a> <strong>Mihai</strong> on 9 Jul 2005 4:32 PM:</p><div style="margin-left: 1em">1. To answer your question, I think the OS and .NET should expose this info. Maybe not all the intermediate forms, but definitely the conversion to NFC/NFD.<br><br>2. All looks fine in FireFox too, although the NFD has the distance between <br>the circumflex and the tilde a bit too big.<br></div>
<p><a id="437182" href="#437182">#</a> <strong>A. Skrobov</strong> on 9 Jul 2005 7:15 PM:</p><div style="margin-left: 1em">&gt; Two of the three? IE does all three, flawlessly. :-) <br><br>Just out of curiosity, I've tried the page with a clean Win2000 SP4 installation (that is, IE 5.0): all the three characters are displayed identically.<br>I can't imagine how old a system must be to mess them up.<br><br><br>Oh, and BTW the middle character (3-part one) looks somewhat different than others in Notepad, regardless of the used font... What's wrong with that?</div>
<p><a id="437307" href="#437307">#</a> <strong>Dean Harding</strong> on 10 Jul 2005 7:39 PM:</p><div style="margin-left: 1em">Yeah, it's Firefox's non-use of Uniscribe again.  :)<br><br>It displays the first and (oddly) the last one right, but the second one has the circumflex off to the right a bit (though the tilde is right, for some reason).<br><br>Your three together in that last comment is completely off, though!</div>
<p><a id="437327" href="#437327">#</a> <strong>Dean Harding</strong> on 10 Jul 2005 9:24 PM:</p><div style="margin-left: 1em">&gt; Oh, and BTW the middle character (3-part one) looks somewhat different than others in Notepad, regardless of the used font... What's wrong with that?<br><br>It's because you need to use Uniscribe to get proper compositing of diacritical marks (and complex scripts in general).  I believe in Windows XP (and possibly Win2k as well) ExtTextOut does support some of the features of a full Uniscribe implementation (which is why I assume #3 looks right), but for full support (as seen in Internet Explorer) you need to use Uniscribe.<br><br>Before reading Michael's blog, I'd never have known all that - yay Michael!!</div>
<p><a id="437343" href="#437343">#</a> <strong>Mihai</strong> on 10 Jul 2005 9:45 PM:</p><div style="margin-left: 1em">I have checked the page again, this time on XP, but still FireFox. Now everything is fine. <br>I guess it is not FireFox, after all :-)</div>
<p><a id="437420" href="#437420">#</a> <strong>Michael Dunn_</strong> on 11 Jul 2005 3:07 AM:</p><div style="margin-left: 1em">This letter isn't esoteric at all, it's in the name Nguyễn, for example.<br>And this makes me think - Vietnamese must be a great testbed for stuff like Uniscribe, what with all the diacritics, some combining, some not (ễ is actually &#234; with a tilde tone marker - e and &#234; are different letters but e and ẽ are the same letter with different tone markers).</div>
<p><a id="437433" href="#437433">#</a> <strong>Jonathan</strong> on 11 Jul 2005 3:52 AM:</p><div style="margin-left: 1em">A. Skrobov: notepad works fine for me with Arial. In other fonts (Courier New, Times New Roman) the middle one doesn't exist, so Notepad falls back to Arial, thus the char looks different.<br><br>Oh, and IE shows all 3 chars identically.<br><br>(XP SP2, with Complex scripts and East-asian language enabled)</div>
<p><a id="438050" href="#438050">#</a> <strong>Vorn</strong> on 12 Jul 2005 1:54 PM:</p><div style="margin-left: 1em">ễ &lt;--- totally composed character displays fine in Safari<br>ễ &lt;--- totally decomposed character displays correctly in the text entry box, but NOT in HTML in Safari, instead shoing e-circumflex and then a wtf-box<br>&#234;̃ &lt;--- partially composed character also displays correctly in text entry box but not in html in Safari, again showing e-circumflex and a wtf-box.<br><br>Weird.<br><br>Vorn</div>
<hr/><p><em>referenced by</em></p><div style="margin-left: 1em"><p>2011/04/23 <a href="http://archives.miloush.net/michkap/archive/2011/04/23/10157359.html">Solution: The Dead Keys Conundrum: An Encyclopedia Brown Mystery</a></p><p>2010/01/12 <a href="http://archives.miloush.net/michkap/archive/2010/01/12/9946880.html">On my "Vietnamese Plus" and "pseudo-Form V" constructs</a></p><p>2009/05/27 <a href="http://archives.miloush.net/michkap/archive/2009/05/27/9644420.html">The whole truth about MB_PRECOMPOSED and MB_COMPOSITE</a></p><p>2008/12/15 <a href="http://archives.miloush.net/michkap/archive/2008/12/15/9215772.html">Frost's The Form Not Taken</a></p><p>2008/03/26 <a href="http://archives.miloush.net/michkap/archive/2008/03/26/8337198.html">Vietnamese still ain't quite right</a></p><p>2007/01/31 <a href="http://archives.miloush.net/michkap/archive/2007/01/31/1564299.html">A year later, and the Vietnamese keyboard isn't any better</a></p><p>2006/05/14 <a href="http://archives.miloush.net/michkap/archive/2006/05/14/597198.html">Harder intermediate forms of characters</a></p><p>2005/12/03 <a href="http://archives.miloush.net/michkap/archive/2005/12/03/499419.html">When even the bugs seem cool</a></p><p>2005/11/11 <a href="http://archives.miloush.net/michkap/archive/2005/11/11/491349.html">What to do with the Vietnamese keyboard on Windows?</a></p></div><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2005/07/09/437071.html" title="Why doesn&#39;t FoldString take an LCID?">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2005/07/08/436701.html" title="Was it or weren&#39;t it? It&#39;s No Myth, either way">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2005-07">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2005-07-09">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2005/07/09/437063.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:41 GMT -->
</html>