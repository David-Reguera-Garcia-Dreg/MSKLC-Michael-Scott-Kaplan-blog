<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2005/07/18/439870.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:41 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>Use of VkKeyScanEx</title></head><body>
<h1>Use of VkKeyScanEx</h1>
<p><em>by Michael S. Kaplan, published on 2005/07/18 03:01 -04:00, original URI: http://blogs.msdn.com/b/michkap/archive/2005/07/18/439870.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostNew -->
<P><FONT face=Tahoma>On the microsoft.public.win32.programmer.international, Nick asked:</FONT></P>
<BLOCKQUOTE dir=ltr style="MARGIN-RIGHT: 0px">
<P><EM><FONT size=2>Hi there,<BR><BR>Does anyone know why this function returns -1 when it is used to convert the <BR>character code of a "dead key" when the keyboard layout is set to German on <BR>an English Windows.<BR><BR>For example, when I tried to convert '´' (acute, whose charater code is <BR>0xb4) like this:<BR><BR>VkKeyScanEx((char)0xb4, kbd_InputLocale);<BR><BR>It returns -1.<BR><BR>Thanks<BR><BR>Nick</FONT></EM></P></BLOCKQUOTE>
<P><FONT face=Tahoma>Hmmm.... two part answer here, Nick. :-)</FONT></P>
<P><FONT face=Tahoma>First, the dead key value is not 0xb4 (a.k.a. in Unicode U+00b4, ACUTE ACCENT) -- that is the spacing version of the character, and dead keys are actually the combining form, generally. So a good reason for <A href="http://msdn.microsoft.com/library/en-us/winui/winui/windowsuserinterface/userinput/keyboardinput/keyboardinputreference/keyboardinputfunctions/vkkeyscanex.asp">VkKeyScanEx</A> to return -1 is that the character for which you are requesting a VK value does not actually exist on the keyboard.</FONT></P>
<P><FONT face=Tahoma>Keyboards on all of the NT-based platforms are indeed Unicode-based. They will have characters to converted to the default system code page, but when a character does not exist (as in the case of spacing diacritic forms, a lot of the time), then a best fit mapping will happen.</FONT></P>
<P><FONT face=Tahoma>However (and this gets us to part two of the answer!), <A href="http://msdn.microsoft.com/library/en-us/winui/winui/windowsuserinterface/userinput/keyboardinput/keyboardinputreference/keyboardinputfunctions/vkkeyscanex.asp">VkKeyScanEx</A>&nbsp;returns only simple VK mapping values, not complex ones such as dead keys in a lot of these cases. So even if you pick the right character value (in this case U+0301, a.k.a. COMBINING ACUTE ACCENT), you will still not get a return value here in such cases.</FONT></P>
<P><FONT face=Tahoma>You see similar behavior with the <A href="http://msdn.microsoft.com/library/en-us/winui/winui/windowsuserinterface/userinput/keyboardinput/keyboardinputreference/keyboardinputfunctions/tounicodeex.asp">ToUnicodeEx</A> function. If you pass a VK value that returns&nbsp;a dead key, then the function will return -1, even though in this case the buffer will contain the dead key in question. It will also be in&nbsp;one of those&nbsp;odd&nbsp;states with a dead key in the input buffer, waiting on the next call to see what you will be adding to it. That -1 kind of signals the situation for you.</FONT></P>
<P><FONT face=Tahoma></FONT>&nbsp;</P>
<P><FONT face=Tahoma color=#ff0000><EM>This post brought to you by</EM> "<STRONG><FONT size=6>&nbsp;́</FONT></STRONG>" <EM>(U+030a, a.k.a. COMBINING ACUTE ACCENT)</EM></FONT></P>
<hr/><div style="margin-left: 1em"><em>no comments</em></div><hr/><p><em>referenced by</em></p><div style="margin-left: 1em"><p>2008/09/03 <a href="http://archives.miloush.net/michkap/archive/2008/09/03/8921419.html">Need to know the VK for A, ay?</a></p><p>2006/09/10 <a href="http://archives.miloush.net/michkap/archive/2006/09/10/748742.html">Further proof that VkKeyScanEx sucks</a></p></div><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2005/07/18/439946.html" title="Typing in random Unicode code points redux">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2005/07/17/439837.html" title="What do the scooters look like?">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2005-07">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2005-07-18">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2005/07/18/439870.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:41 GMT -->
</html>