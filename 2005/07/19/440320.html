<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2005/07/19/440320.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:41 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>Sort element vs. text element</title></head><body>
<h1>Sort element vs. text element</h1>
<p><em>by Michael S. Kaplan, published on 2005/07/19 05:13 -04:00, original URI: http://blogs.msdn.com/b/michkap/archive/2005/07/19/440320.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostNew -->
<P><FONT face=Tahoma>Text elements have been called that since version 1.0 of the .NET Framework. MSDN defines them as follows:</FONT></P><FONT face="Times New Roman" size=2>
<BLOCKQUOTE dir=ltr style="MARGIN-RIGHT: 0px">
<P><EM>The .NET Framework defines a text element as a unit of text that is displayed as a single character; that is, a grapheme. A text element can be a base character, a surrogate pair, or a combining character sequence. The Unicode Standard defines a surrogate pair as a coded character representation for a single abstract character that consists of a sequence of two code units, where the first unit of the pair is a high-surrogate and the second is a low-surrogate. The Unicode Standard defines a combining character sequence as a combination of a base character and one or more combining characters. A surrogate pair can represent a base character or a combining character. For more information on surrogate pairs and combining character sequences, see The Unicode Standard at http://www.unicode.org.</EM></P></BLOCKQUOTE></FONT>
<P><FONT face=Tahoma>In Unicode, what the .NET Framework refers to as a text element is referred to as either a grapheme cluster or a supplementary character. In Unicode it would not be common to put supplementary characters (surrogate pairs) under the same category as grapheme clusters, since as even the definition above claims:</FONT></P>
<BLOCKQUOTE dir=ltr style="MARGIN-RIGHT: 0px">
<P><EM><FONT size=2>A surrogate pair can represent a base character or a combining character.</FONT></EM></P></BLOCKQUOTE>
<P><FONT face=Tahoma>This makes it a little weird in terms of the text definition if and when such code points are allocated, since people will start getting confused about the fact that a substring with a supplementary character is a text element just as that supplementary character plus a diacritic is also a text element. But this seeming weirdness is just that -- seeming. I mean, if you think about it U+0063 (LATIN SMALL LETTER C) is as text element, but so is it plus U+0301 (COMBINING ACUTE ACCENT). So maybe the definition could be cleaned up a little to get rid of the potential weirdness here. But there is no hurry just yet (not too many complaints to date).</FONT></P>
<P><FONT face=Tahoma>There is one crucial part of the definition of a text element that is not covered which probably ought to be, especially in contrast to a sort element, the contender in the blue corner. I'll get to it in a minute.</FONT></P>
<P><FONT face=Tahoma>A sort element is a code point or combination of code points that a user thinks of as a character.&nbsp;S</FONT><FONT face=Tahoma>ometimes a text element is&nbsp;a sort element, other times it is not (a good example of one that is not would be the Traditional Spanish "ch"). Sort elements are the basis of collation support on Windows and since there is no function or method that specifically enumerates them, they are usually thought of only in terms of the special "exception" or "compression" entries that a given locale has. This is a little unfair since every letter that is used could be a sort element, just like it could be a text element.</FONT></P>
<P><FONT face=Tahoma>I've talked about both of these items before, but really not done much to give a rigorous way to determine the difference between them other than to say that you can detect one but not the other with parts of the managed globalization APIs. But </FONT><FONT face=Tahoma>I'll tie it all together now, and lay out the difference between a text element and a sort element. Ready? Here goes....</FONT></P>
<P><FONT face=Tahoma>A text element is based on the <STRONG>script</STRONG> and is independent of language. It always exists even if it has no specific impact on collation.</FONT></P>
<P><FONT face=Tahoma>A sort element is based on the <STRONG>language</STRONG> and is therefore entirely dependent on language. It really only exists when it is defined for the language.</FONT></P>
<P><FONT face=Tahoma>(and the penny drops!)</FONT></P>
<P><FONT face=Tahoma>This is the reason why I&nbsp;was so unhappy the other day about the fact that <a href="http://archives.miloush.net/michkap/archive/2005/07/09/437071.html">FoldString does not take an LCID</A>&nbsp;-- because the ligature expansion that takes place is entirely language dependent in practice when used in collation but is language independent when <A href="http://msdn.microsoft.com/library/en-us/winui/winui/windowsuserinterface/resources/strings/stringreference/stringfunctions/foldstring.asp">FoldString</A> is used to do the expansion. Even though they ought to be based entirely on language and not script. Darn.</FONT></P>
<P><FONT face=Tahoma>The two constructs have a few things in common:</FONT></P>
<UL>
<LI><FONT face=Tahoma>users think of both of them as being "characters" no matter how many code points are used to make them;</FONT></LI>
<LI><FONT face=Tahoma>in some cases, character sequences are both of them.</FONT></LI></UL>
<P><FONT face=Tahoma>And&nbsp;they have a&nbsp;few points of contrast (when a sort element is not also a text element, of course):</FONT></P>
<UL>
<LI><FONT face=Tahoma>Text elements are in many cases subject to normalization, while sort elements never are;</FONT></LI>
<LI><FONT face=Tahoma>Text elements can be detected by the Unicode character properties of their underlying characters, while sort elements cannot;</FONT></LI>
<LI><FONT face=Tahoma>Text elements are a defined term in the .NET Framework, while sort elements are currently only defined as a term in Microsoft software on this blog and in presentations that Cathy Wissink and I have done about collation;</FONT></LI>
<LI><FONT face=Tahoma>There are functions to directly detect text elements, but none to directly detect sort elements.</FONT></LI></UL>
<P><FONT face=Tahoma>Probably enough to distinguish between these two types, for now.... :-)</FONT></P>
<P>&nbsp;</P>
<P><FONT face=Tahoma color=#ff0000><EM>This post brought to you by</EM> "<FONT size=5>Ê¤</FONT>" <EM>(<A href="http://www.fileformat.info/info/unicode/char/02a4/index.htm">U+02a4</A>, a.k.a. LATIN SMALL LETTER DEZH DIGRAPH)</EM></FONT></P>
<hr/><div style="margin-left: 1em"><em>no comments</em></div><hr/><p><em>referenced by</em></p><div style="margin-left: 1em"><p>2008/07/25 <a href="http://archives.miloush.net/michkap/archive/2008/07/25/8771119.html">Let's save some time and call them all IRregular expression engines</a></p><p>2008/01/25 <a href="http://archives.miloush.net/michkap/archive/2008/01/25/7228941.html">On reversing the irreversible (grabbing the data, part I)</a></p><p>2007/09/15 <a href="http://archives.miloush.net/michkap/archive/2007/09/15/4924008.html">A&P of Sort Keys, part 5 (aka EXPANSIONing your horizons)</a></p><p>2007/01/15 <a href="http://archives.miloush.net/michkap/archive/2007/01/15/1469885.html">With SQL Server (and SQL itself) comes the illogic of 'trailing spaces' (and the myth of fixed width)</a></p><p>2006/10/04 <a href="http://archives.miloush.net/michkap/archive/2006/10/04/788429.html">Wild[card] thing, You make my CHAR sing</a></p><p>2005/11/13 <a href="http://archives.miloush.net/michkap/archive/2005/11/13/491646.html">Hungarian is even more complicated than I thought</a></p><p>2005/07/20 <a href="http://archives.miloush.net/michkap/archive/2005/07/20/440842.html">More on sort elements</a></p></div><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2005/07/19/440549.html" title="It isn&#39;t really more secure in most cases">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2005/07/18/439963.html" title="MSLU isn&#39;t perfect">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2005-07">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2005-07-19">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2005/07/19/440320.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:41 GMT -->
</html>