<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2005/03/08/389675.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:42 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>I coffee, therefore IFilter (or, Language-specific processing #1)</title></head><body>
<h1>I coffee, therefore IFilter (or, Language-specific processing #1)</h1>
<p><em>by Michael S. Kaplan, published on 2005/03/08 11:59 -05:00, original URI: http://blogs.msdn.com/b/michkap/archive/2005/03/08/389675.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostNew -->
<P><EM><FONT size=2>Apologies for the title, I still cannot resist that sort of thing. Maybe one day....<BR>If you have not read it yet, look at <a href="http://archives.miloush.net/michkap/archive/2005/03/08/389360.html">Language-specific processing #0</A>&nbsp;for more info about this series!</FONT></EM></P>
<P>IFilter is one interface that you can use to lower the barriers between the engines that do the work of indexing and the data that may be sitting in proprietary formats. The documentation probably explains it better than I could&nbsp;here:</P>
<BLOCKQUOTE dir=ltr>
<P><FONT size=2><EM>The <B>IFilter</B> interface scans documents for text and properties (also called attributes). It extracts chunks of text from these documents, filtering out embedded formatting and retaining information about the position of the text. It also extracts chunks of values, which are properties of an entire document or of well-defined parts of a document. <B>IFilter</B> provides the foundation for building higher-level applications such as document indexers and application-independent viewers. </EM></FONT></P></BLOCKQUOTE>
<P>Immediately several of what seems much like the shipping implementations of&nbsp;this feature like this will come to mind: Full Text Search in SQL Server, SharePoint, Exchange, and Index Server for starters. And then there are those like MSN Desktop Search, as well. All of the times that search suppots additional file formats. Imagine being able to get in on the fun to make sure your own format is supported for some type of indexing/searching?</P>
<P>This is a COM interface so to implement it you have to implement&nbsp;AddRef/Release/QueryInterface as always. The additional methods you have to implement:</P>
<UL>
<LI><STRONG><A href="http://msdn.microsoft.com/library/en-us/indexsrv/html/ixrefint_2oc4.asp">IFilter::Init</A></STRONG> - Initializes a filtering session. 
<LI><STRONG><A href="http://msdn.microsoft.com/library/en-us/indexsrv/html/ixrefint_96gb.asp">IFilter::GetChunk</A></STRONG> - Positions filter at beginning of first or next chunk and returns a descriptor. 
<LI><STRONG><A href="http://msdn.microsoft.com/library/en-us/indexsrv/html/ixrefint_5378.asp">IFilter::GetText</A></STRONG> - Retrieves text from the current chunk. 
<LI><STRONG><A href="http://msdn.microsoft.com/library/en-us/indexsrv/html/ixrefint_1cpx.asp">IFilter::GetValue</A></STRONG> - Retrieves values from the current chunk. 
<LI><STRONG><A href="http://msdn.microsoft.com/library/en-us/indexsrv/html/ixrefint_8bam.asp">IFilter::BindRegion</A></STRONG> - Retrieves an interface representing the specified portion of object. Currently reserved for future use (for now you would always return E_NOTIMPL).</LI></UL>
<P>The general topic about the <A title="IFilter interface" href="http://msdn.microsoft.com/library/en-us/indexsrv/html/ixrefint_9sfm.asp" target=_blank>IFilter interface</A> has pointers to summaries, samples, instructions on building, applying and testing filters, as well as methods to bind to already existing IFilter implementations.</P>
<P>It is also nice to see such a great effort on the security side -- links and information to help guarantee that ISVs who write code against this interface do it securely. Throughout there are good warnings:</P>
<BLOCKQUOTE dir=ltr>
<P><FONT size=2><STRONG>Caution</STRONG>&nbsp;&nbsp;&nbsp;&nbsp;IFilters for Indexing Service run in the Local System security context. They should be written to manage buffers and to stack correctly. All string copies must have explicit checks to guard against buffer overruns. You should always verify the allocated size of the buffer. You should always test the size of the data against the size of the buffer.</FONT></P></BLOCKQUOTE>
<P>That and a link to <A href="http://msdn.microsoft.com/library/en-us/indexsrv/html/ixarch_8a0j.asp">secure code practices</A> to consider when implementing these interfaces are a welcome touch as far as I am concerned&nbsp;(as it does no good for Microsoft to write secure code if an ISV writes a component with a security issue!).</P>
<P>Now note that this interface, this IFilter,&nbsp;is not really about language-specific processing as much as it is about format-specific processing. But one of the greatest strengths of a service like MS Search is the ability to apply it to different file formats. It makes IFilter a very important interface to stretch the boundaries of what can be searched. </P>
<P>And it gives the future topics, that deal with those more linguistic aspects of language-specific processing a much wider reach than they would otherwise have. So&nbsp;I will give IFilter an honorary "cool" status that I would usually reserve for things more linguisticalish :-)</P>
<P>&nbsp;</P>
<P><FONT color=#ff0000><EM>This post was sponsored by</EM> "F" </FONT><EM><FONT color=#ff0000>(<A href="http://www.fileformat.info/info/unicode/char/0046/index.htm">U+0046</A>, a.k.a. LATIN CAPITAL LETTER F)<BR><FONT size=1>A letter that realized it would never get to sponsor any of the fun "F" words while I am working for Microsoft, so it thought it should take "Filter" while it was available.</FONT></FONT></EM></P>
<hr/><p><a id="390163" href="#390163">#</a> <strong>Jonathan Payne</strong> on 9 Mar 2005 12:04 AM:</p><div style="margin-left: 1em">Why does the Indexing Service call IFilter using the Local System security context?  Wouldn't it make more sense to try and call third part code with the minimal security level needed to get the job done (I realize that this might be hard to determine - perhaps implementers of IFilter could be called with no privileges and be spoon fed the contents of a file unless they requested a more privileged security context).</div>
<p><a id="390174" href="#390174">#</a> <strong>bg</strong> on 9 Mar 2005 12:13 AM:</p><div style="margin-left: 1em">probably to much work to do - but you could write a sample to show us how its done. you could, for instance, produce a filter for vb 6.0 .bas/.cls files!<br><br>(yes i know you just need to put a Persistant handler key in the registry but thats to easy!)<br><br>cheers<br><br>bg</div>
<p><a id="390404" href="#390404">#</a> <strong>RIO - Randekt&#237;v Informatikai Oldal </strong> on 9 Mar 2005 3:56 AM:</p><div style="margin-left: 1em">Istanbul &#250;j nevet kapott: <a target="_new" href="http://www.betanews.com/article/Microsoft_Unveils_Office_Communicator/1110303540">http://www.betanews.com/article/Microsoft_Unveils_Office_Communicator/1110303540</a></div>
<p><a id="390406" href="#390406">#</a> <strong>Michael Kaplan</strong> on 9 Mar 2005 3:59 AM:</p><div style="margin-left: 1em">Jonathan -- The service itself runs with those permissions; I imagine it would be complex to navigate making it callable in variable contexts (though I think that would be worthwhile!).<br><br>bg -- I would be a lot more likely to do something with some of the future classes, the more linguistic ones. Stay tuned. :-)</div>
<p><a id="394741" href="#394741">#</a> <strong>Michael Kaplan</strong> on 12 Mar 2005 9:22 PM:</p><div style="margin-left: 1em">Lest people think I am making up the potential usefulness here about IFilter implementations:<br><br><a target="_new" href="http://microsoft.blognewschannel.com/index.php/archives/2005/03/12/add-file-types-to-msn-desktop-search/">http://microsoft.blognewschannel.com/index.php/archives/2005/03/12/add-file-types-to-msn-desktop-search/</a><br><br>:-)</div>
<p><a id="8983027" href="#8983027">#</a> <strong>Stephen</strong> on 7 Oct 2008 3:24 AM:</p><div style="margin-left: 1em"><p>A lot of the MSDN links on this subject seem dead now - could someone write a little update on this subject now?</p>
<p><a href="http://msdn.microsoft.com/library/en-us/indexsrv/html/ixrefint_9sfm.asp" rel="nofollow" target="_new">http://msdn.microsoft.com/library/en-us/indexsrv/html/ixrefint_9sfm.asp</a></p></div>
<p><a id="8984880" href="#8984880">#</a> <strong>Michael S. Kaplan</strong> on 7 Oct 2008 9:16 AM:</p><div style="margin-left: 1em"><p>Lots of IFilter updates in various other blogs on the server -- for SharePoint, for SQL Server, for others, especially <a href="http://blogs.msdn.com/ifilter/">Filter Central</a>. There are like over <a href="http://www.google.com/search?num=100&amp;hl=en&amp;suggon=0&amp;q=IFilter+site%3Ablogs.msdn.com">2,600 in Google</a>, for example....</p></div>
<p><strong>Jerry Camel</strong> on 17 Dec 2008 11:08 AM:</p><div style="margin-left: 1em"><p>I can't find a whole lot int he way of examples for developing an iFilter... &nbsp;Even the SDK references samples that don't seem to exist anymore.</p>
<p>I'm looking specifically for how to pass an embedded document on to it's appropriate iFilter.</p>
<p>Can you point me to some sample code? &nbsp;I suspect BindIFilterToStream will be involved, but I can't figure out exactly how...</p>
<p>Thanks.</p>
<p>J</p></div>
<p><strong>Michael S. Kaplan</strong> on 17 Dec 2008 2:48 PM:</p><div style="margin-left: 1em"><p>I would suggest looking over at <a rel="nofollow" target="_new" href="http://blogs.msdn.com/ifilter/">http://blogs.msdn.com/ifilter/</a> for more information here....</p>
</div>
<p><strong>Prakash Tandukar</strong> on 28 Dec 2008 12:39 AM:</p><div style="margin-left: 1em"><p>I am able to read properties of *.docx file using ifilter but it does not read any property of *.doc (Microsoft Word 2003). What should be changed in ifilter code to read property of *.doc files as well.</p>
<p>Thanks</p>
<p>Prakash</p></div>
<hr/><p><em>referenced by</em></p><div style="margin-left: 1em"><p>2006/11/12 <a href="http://archives.miloush.net/michkap/archive/2006/11/12/1031784.html">If I wasn't watching her blog, could you really claim I was filtering the list of blogs I read?</a></p><p>2005/03/21 <a href="http://archives.miloush.net/michkap/archive/2005/03/21/399589.html">Linguistic and Unicode considerations (or Language-specific Processing #4)</a></p><p>2005/03/14 <a href="http://archives.miloush.net/michkap/archive/2005/03/14/395199.html">You toucha my letters, IWordBreaker you face (or, Language-specific processing, #3)</a></p><p>2005/03/13 <a href="http://archives.miloush.net/michkap/archive/2005/03/13/394822.html">IStemmer'ed the tide (or, Language-specific processing #2)</a></p></div><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2005/03/09/390839.html" title="Who runs the keyboards?">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2005/03/08/389360.html" title="Before you find, or search, you have to *index* (or, Language-specific processing #0)">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2005-03">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2005-03-08">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2005/03/08/389675.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:42 GMT -->
</html>