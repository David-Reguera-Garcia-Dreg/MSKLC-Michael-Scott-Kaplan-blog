<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2005/03/10/391564.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:42 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>Dere are qvestions? In zat <b>case</b>...</title></head><body>
<h1>Dere are qvestions? In zat <b>case</b>...</h1>
<p><em>by Michael S. Kaplan, published on 2005/03/10 00:15 -08:00, original URI: http://blogs.msdn.com/michkap/archive/2005/03/10/391564.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostOld -->
<P><A id=Comments href="http://spaces.msn.com/members/jdanielsmith/" target=_blank>J. Daniel Smith</A> asked about&nbsp;ToLower() (and ToUpper()) and some trouble he was having with them:</P>
<BLOCKQUOTE dir=ltr>
<P><FONT size=2><EM>The comment about Turkish in the docs with regards to "i" doesn't carry a lot of weight with fellow programmers and we only care about 8 languages: English, FIGS and CJK. <BR><BR>One example that occurs to me is the word "Straße" in German. When upper-cased it should become "STRASSE" (no ß), but I can't seem to get code to do that. Also, being a noun, you can't lower-case this word as nouns always start with a capital in German; "straße" is wrong (unless there is a verb "strassen").</EM></FONT></P></BLOCKQUOTE>
<P>Windows and the .NET Framework mainly support simple, reversible&nbsp;casing -- which is to say single code point casing that have ToUpper() and ToLower() as inverse operations that can "undo" each other. As such, you cannot use either method to convert one to the other.</P>
<P>Comparison, on the other hand, will handle this case. If you compare "ß" to "SS" with&nbsp;CompareString and the&nbsp;NORM_IGNORECASE flag in Windows or the <A title=CompareInfo href="http://msdn.microsoft.com/library/en-us/cpref/html/frlrfsystemglobalizationcompareinfoclasstopic.asp" target=_blank>CompareInfo</A>.Compare method&nbsp;and the <A title=CompareOptions href="http://msdn.microsoft.com/library/en-us/cpref/html/frlrfsystemglobalizationcompareoptionsclasstopic.asp" target=_blank>CompareOptions</A>.IgnoreCase flag in the .NET Framework, the two strings will be considered equal. Because in truth, they are equal -- just a case pair apart....</P>
<P>This happens on all locales, not just in German -- because the "ß" (<A href="http://www.fileformat.info/info/unicode/char/00df/index.htm">U+00df</A>,&nbsp;a.k.a&nbsp;LATIN SMALL LETTER SHARP S) is considered to be a simple case difference away from "SS" in the default table. Give it a try!</P>
<P>J. Daniel went on further to ask some additional questions:</P>
<BLOCKQUOTE dir=ltr>
<P><EM><FONT size=2>In German, there is always an alternate spelling for words with umlauts: "für" is the same as "fuer". However, the converse is now always true; not every "ue" can be replaced with "ü". <BR><BR>Similarly for "ß", it can always be replaced with "ss" (and must when UPPER-CASING as there is no such thing as an upper-case "ß"). But not every "ss" can be replaced with "ß". <BR><BR>First, I can't seem to get ToUpper() to turn "ß" into "SS". <BR><BR>Second, how do I correctly deal with "für"=="fuer"? </FONT></EM></P></BLOCKQUOTE>
<P>Ok, I think I took care of explaining the deal with the Sharp S. But let me add that this is not a conditional opertion -- Windows is neither drawing on huge German dictionaries to avoid treating them with this sort of equivalency nor using machine reading techniques and schoolboy knowledge of German to read&nbsp;the text....</P>
<P>For the second point, you will want to look at what is known as the German Phonebook Sort -- LCID of 0x00010407. It will have all of the following equivalences in collation:</P>
<BLOCKQUOTE dir=ltr>
<P>Ä == AE<BR>ä == ae<BR>Ö&nbsp;== OE<BR>ö == oe<BR>Ü&nbsp;== UE<BR>ü == ue</P></BLOCKQUOTE>
<P>You can just think of collation as the technology that will travel to where casing fears to go.... :-)</P>
<P>&nbsp;</P>
<P><FONT color=#ff0000><EM>This post is sponsored by</EM> "Ä" <EM>(<A href="http://www.fileformat.info/info/unicode/char/00c4/index.htm">U+00c4</A>, a.k.a. LATIN CAPITAL LETTER A WITH DIAERESIS)</EM></FONT></P>
<hr/><p><a id="391740" href="#391740">#</a> <strong>Michael Fink</strong> on Thursday, March 10, 2005 2:30 AM:</p><div style="margin-left: 1em">I think most german people wouldn't write &quot;fuer&quot; when they would have umlauts available, e.g. on the keyboard. It's probably the same with the capitalized STRASSE. The SS looks so &quot;unnatural&quot; that some even use the lowercase &#223; for the SS instead. One exception of course are crossword puzzles.</div>
<p><a id="391744" href="#391744">#</a> <strong>Michael Kaplan</strong> on Thursday, March 10, 2005 2:36 AM:</p><div style="margin-left: 1em">Yes, I have heard the same from many people. At the same time, people generally don't want to see incorrect results if they *do* use this form....<br><br>For the umlaut especially, it is more common to use it versus this other form. But there are times when people definitely prefer one over the other.<br><br>The consequences are interesting, in any case. :-)</div>
<p><a id="391941" href="#391941">#</a> <strong>Henry B&#246;hlert</strong> on Thursday, March 10, 2005 4:40 AM:</p><div style="margin-left: 1em">My last name is B&#246;hlert but I usually spell it Boehlert, e.g. for electronic data processing. There are so many systems that will just mess up.<br><br>You might not always have a German keyboard and using US-International is little known or may be too much for some people's fingers. <br><br>In de-ch, '&#223;' is not used at all. Which has the somewhat over-stressed drawback of not being able to distinguish between drinking &quot;in Ma&#223;en&quot; and drinking &quot;in Massen&quot;. (<a target="_new" href="http://dict.leo.org/?lp=ende&amp;lang=de&amp;searchLoc=0&amp;cmpType=relaxed&amp;relink=on&amp;sectHdr=on&amp;spellToler=std&amp;search=in+Ma%DFen">http://dict.leo.org/?lp=ende&amp;lang=de&amp;searchLoc=0&amp;cmpType=relaxed&amp;relink=on&amp;sectHdr=on&amp;spellToler=std&amp;search=in+Ma%DFen</a>)</div>
<p><a id="392077" href="#392077">#</a> <strong>Sam Jost</strong> on Thursday, March 10, 2005 6:13 AM:</p><div style="margin-left: 1em">Beware: If you convert &#223; to uppercase in german it wont *always* be changed into SS.<br><br>If I remember right there is some rule that in names &#223; will keep being &#223; even in uppercase!<br><br>Especially funny if you have a street name 'Gro&#223;e Stra&#223;e', which will be uppercased to 'GRO&#223;E STRASSE'. <br>Even most germans do not know of this rule, and quite a lot don't believe this is true :)<br><br>do you?</div>
<p><a id="392112" href="#392112">#</a> <strong>J. Daniel Smith</strong> on Thursday, March 10, 2005 6:52 AM:</p><div style="margin-left: 1em">So if I only care about English, FIGS and CJK, I can readily use ToUpper() and ToLower()?<br><br>In my current codebase, I've carefully avoided both using CompareNoCase() instead of upper (or lower)-casing the two strings.  I guess CompareNoCase() is more efficient, but ToUpper()/ToLower() seems to be more intuitive to some people--for one you can use operator==().<br><br>if (s1.ToLower() == s2.ToLower())<br><br>vs.<br><br>if (s1.CompareNoCase(s2) == 0)<br><br>So other than Turkish and performance, are there any differences between the two?<br><br>I think this may be the difference: if s1=&quot;f&#252;r&quot; and s2=&quot;FUER&quot;, no amount of upper/lower casing is going to turn &quot;&#252;&quot; into &quot;UE&quot;.  However, I can write<br><br>if (s1.CompareNoCase(s2, DE_Phonebook_Sort ) == 0)<br><br>and the strings will compare as equivalent.  Yes?<br><br></div>
<p><a id="392117" href="#392117">#</a> <strong>Michael Kaplan</strong> on Thursday, March 10, 2005 6:58 AM:</p><div style="margin-left: 1em">Exactly. Oh, there is also the Georgian bug (mentioned earlier in this blog) but Georgian may not be on your list, either....<br><br>But do not minimize the performance aspects -- those calls to methods on the .NET Framework allocate new strings, and the more you can avoid gratuitous alllocations, the better off you are....</div>
<p><a id="392178" href="#392178">#</a> <strong>Brian</strong> on Thursday, March 10, 2005 8:31 AM:</p><div style="margin-left: 1em">In addition to the String allocation overhead, even a little thought should reveal that the comparison has much better best and average case performance, since it can return as soon as it finds 2 different characters.  In fact, it's worst case is comparable to the best case when comparing the results of ToLower (but this is before you add in the allocation overhead!).  It's unlikely to be a performance bottleneck, but there's no reason to write gratuitously inefficient code.</div>
<p><a id="392188" href="#392188">#</a> <strong>Michael Kaplan</strong> on Thursday, March 10, 2005 8:36 AM:</p><div style="margin-left: 1em">Well, it is hard to know what to do with a question that basically says &quot;I know you are talking about best practices but it does not seem to apply to me. Can I just do it the way I am now since although it is slow and wrong, it does not seem to slow or too wrong for my purposes?&quot;<br><br>The answer is NO, you should not do that. Slow and wrong are not absolutes, but there is no way to know for sure if the solution that is known to be slow and wrong will not cause problems later....</div>
<p><a id="392498" href="#392498">#</a> <strong>J. Daniel Smith</strong> on Thursday, March 10, 2005 11:54 AM:</p><div style="margin-left: 1em">What I was really looking for is ammo to use against fellow programmers (I'm trying to do the &quot;right thing&quot; myself): they seem to like using ToLower() to do a case-insenstive string compare.<br><br>As Brian mentioned, such code is unlikely to be a performance bottleneck, and s1==s2 is arguably clearer than CompareNoCase()==0.  And nobody cares about the problem with &quot;i&quot; in Turkish.<br><br>I think I can get a lot further with correctness:  my understaning is that is no way to make &quot;f&#252;r&quot; and &quot;FUER&quot; compare equal using ToLower(), but it can be done with CompareNoCase().<br></div>
<p><a id="392508" href="#392508">#</a> <strong>Michael Kaplan</strong> on Thursday, March 10, 2005 11:57 AM:</p><div style="margin-left: 1em">Well, start with that case, and you can then let them know that it is just the tip of the iceberg. The road they are heading down will never lead to anything but hard to understand and repro bugs....</div>
<p><a id="392924" href="#392924">#</a> <strong>Ruben</strong> on Thursday, March 10, 2005 1:45 PM:</p><div style="margin-left: 1em">So if German's got a phone book sort, why doesn't Dutch have one? <br><br>For Dutch, the difference with the normal sort and the phone book sort, is that pesky IJ (again!). Standard sort treats it as I+J, phone book sort treats it as Y: Bruyn A., Bruijn B., Bruyn C. - useful, as in Dutch names, the Y and IJ generally have the same pronunciation, and people often write &#255;/y instead of ij. <br><br>If you're still reading: ij is called a &quot;lange ij&quot; [long ij], ei a &quot;korte ei&quot; [short ei], and y a &quot;Griekse ij&quot; [Greek y], all pronounced /Ei/. Dutch children end their ABC with X IJ Z. Was that city called Ysselstein or IJsselstein? (Depends on which city you refer to.) Yes, it hurts :-(<br><br>And there's even a 'dictionary sort', for lack of a better name, which sorts W X IJ Y Z (granted: weird, but some dictionaries and encyclopedias do). While I'm at it, any chance of <a title="StringInfo" href="http://msdn.microsoft.com/library/en-us/cpref/html/frlrfsystemglobalizationstringinfoclasstopic.asp" target="_blank">StringInfo</a> returning IJ as a single element?<br><br>Get a feeling why title casing IJ as Ij feels so unnatural, like I indicated in my earlier post? I hate it when Word does that. &quot;Auto Correct&quot; is what that's called. Yeah, right! <br><br>But then again, Dutch is definately not on that list of 8 languages people seem to care about so... Either that, or customs keeps your technology up at the German border. ;-)</div>
<p><a id="394380" href="#394380">#</a> <strong>J. Daniel Smith</strong> on Friday, March 11, 2005 9:37 PM:</p><div style="margin-left: 1em">Oh yea, I can see how that Dutch IJ (Ĳ U+0132) could be quite pesky.  I would agree that there's no way &quot;IJ&quot; should become &quot;Ij&quot;<br><br>From a software &amp; translation point of view, once you got English+Major European+Asian language, it's probably &quot;easy&quot; to do any LtoR language.  It's probably things like documentation, brochures, support, etc. that limit more translations.<br><br>I think it's be cool if my company supported Dutch too; I lived in Amersfoort for 18 months and tried to learn the language, but German kept getting in the way.  And the Dutch are all happy to speak English...<br></div>
<p><a id="394383" href="#394383">#</a> <strong>Michael Kaplan</strong> on Friday, March 11, 2005 9:43 PM:</p><div style="margin-left: 1em">The Dutch requirement is a bit different -- and it would require a more intelligent engine than the &quot;one character at a time&quot; table-based one used by NLS currently.<br><br>It does not mean I do not care about Dutch, I can promise you that. But sometimes the harder it is to support a requirement the longer it takes to see it supported.<br><br>Example -- CJK text was vertical as least as often as it was horiontal, but the computer age made horizontal more appealing since it could be supported more quickly than vertical.<br><br>Vertical is now there in some apps, but still not all. Can you imagine what would happen if Japan could not make use of computers? Yikes!<br><br>Compare with right-to-left languages like Arabic which did not have such a practical alternative at hand -- they had to wait a lot longer to see their language supported in computers....</div>
<hr/><p><em>referenced by</em></p><div style="margin-left: 1em"><p>2009/07/29 <a href="http://archives.miloush.net/michkap/archive/2009/07/29/9851698.html">Every character has a story #33: U+1e9e (CAPITAL SHARP S, Microsoft edition - Part 2)</a></p><p>2008/02/24 <a href="http://archives.miloush.net/michkap/archive/2008/02/24/7864631.html">The idea has to do more than just make sense to me (aka How S-Sharp are *you* feeling today?)</a></p><p>2007/05/05 <a href="http://archives.miloush.net/michkap/archive/2007/05/05/2430935.html">All right, mistakes were made #2 (What the %#$* is wrong with German Phonebook sorting?)</a></p><p>2005/12/14 <a href="http://archives.miloush.net/michkap/archive/2005/12/14/503674.html">It may seem like a bug, but it is not....</a></p><p>2005/04/10 <a href="http://archives.miloush.net/michkap/archive/2005/04/10/406880.html">What the %#$* is wrong with German sorting?</a></p></div><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2005/03/10/392145.html" title="Another speaking gig (near Cleveland, OH)">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2005/03/09/391455.html" title="The BCL Bloggers take requests....">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2005-03">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2005-03-10">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2005/03/10/391564.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:42 GMT -->
</html>