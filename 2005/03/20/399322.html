<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2005/03/20/399322.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:42 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>Font substitution and linking #1</title></head><body>
<h1>Font substitution and linking #1</h1>
<p><em>by Michael S. Kaplan, published on 2005/03/20 08:35 -05:00, original URI: http://blogs.msdn.com/b/michkap/archive/2005/03/20/399322.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostNew -->
<P>Ok, there will be several posts on this topic, starting from the core support in GDI/Windows and moving concentrically outward to information on usage in <A title=Uniscribe href="http://msdn.microsoft.com/library/en-us/intl/uniscrib_35k5.asp" target=_blank>Uniscribe</A>, <A title=MLang href="http://msdn.microsoft.com/workshop/misc/mlang/mlang.asp" target=_blank>MLang</A>, and Office.</P>
<P>I'll start with <STRONG>font substitution</STRONG>.</P>
<P>At the simplest level, this feature is what it sounds like -- simple substitution of one font name&nbsp;with another.</P>
<P>It starts with&nbsp;a registry key (HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\FontSubstitutes). In Windows Server 2003 that key contains the following:</P>
<BLOCKQUOTE dir=ltr style="MARGIN-RIGHT: 0px">
<P><FONT face="Courier New" size=2>"Arial Baltic,186"="Arial,186"<BR>"Arial CE,238"="Arial,238"<BR>"Arial CYR,204"="Arial,204"<BR>"Arial Greek,161"="Arial,161"<BR>"Arial TUR,162"="Arial,162"<BR>"Courier New Baltic,186"="Courier New,186"<BR>"Courier New CE,238"="Courier New,238"<BR>"Courier New CYR,204"="Courier New,204"<BR>"Courier New Greek,161"="Courier New,161"<BR>"Courier New TUR,162"="Courier New,162"<BR>"Times New Roman Baltic,186"="Times New Roman,186"<BR>"Times New Roman CE,238"="Times New Roman,238"<BR>"Times New Roman CYR,204"="Times New Roman,204"<BR>"Times New Roman Greek,161"="Times New Roman,161"<BR>"Times New Roman TUR,162"="Times New Roman,162"<BR><FONT color=#008000><STRONG>"Helv"="MS Sans Serif"<BR>"Helvetica"="Arial"<BR>"Times"="Times New Roman"<BR>"Tms Rmn"="MS Serif"</STRONG></FONT><BR><FONT color=#0000ff><STRONG>"MS Shell Dlg"="Microsoft Sans Serif"<BR>"MS Shell Dlg 2"="Tahoma"</STRONG></FONT></FONT></P></BLOCKQUOTE>
<P>These entries can be put into three categories (which are color-coded above):</P>
<P><STRONG>BLACK</STRONG> - these are entries that were formerly used by many applications to combine font family (name) choice with font character set choice (basically the lfFaceName and lfCharSet members of the <A title=LOGFONT href="http://msdn.microsoft.com/library/en-us/gdi/fontext_1wmq.asp" target=_blank>LOGFONT</A> struct). I'll talk more about lfCharSet and what it used to do (and sometimes still does) another day. But in any case these names are not really used much anymore. When they are used in applications, their presence in the FontSubstitutes subkey makes them work properly. </P>
<P><STRONG><FONT color=#008000>GREEN</FONT></STRONG> - these entries allow some common abbreviated names to work. Their usage is self-explanatory.</P>
<P><FONT color=#0000ff><STRONG>BLUE</STRONG></FONT> - these entries are the ones behind the huge effort to support <STRONG><A href="http://msdn.microsoft.com/library/default.asp?url=/library/en-us/intl/nls_4qcn.asp">MS Shell Dlg</A></STRONG> as a UI font name (also described <A href="http://msdn.microsoft.com/library/en-us/intl/nls_2np0.asp">here</A> and in article <A href="http://support.microsoft.com/Default.aspx?id=282187">282187</A> in the knowledge base).&nbsp;In fact, these two entries are the only ones that can be considered useful for more than just backward compatibility with no longer used methodologies. <a href="http://blogs.msdn.com/oldnewthing/">Raymond Chen</A> also has good&nbsp;advice about getting the right font used via DS_SHELLFONT in the articles <A id=CategoryEntryList href="http://blogs.msdn.com/oldnewthing/archive/2005/02/04/366987.aspx">What's the deal with the DS_SHELLFONT flag?</A>&nbsp;and <A id=CategoryEntryList href="http://blogs.msdn.com/oldnewthing/archive/2005/02/08/369090.aspx">What other effects does DS_SHELLFONT have on property sheet pages?</A>&nbsp;for those who are interested.</P>
<P>Of course it seems odd that <STRONG>MS Shell Dlg</STRONG>,&nbsp;documented as a version independent, language independent pseudo-font name seems to be hard coded to use fonts that do not support all languages. Wasn't it designed to get people away from hard-coding <STRONG>Tahoma</STRONG> or <STRONG>Microsoft Sans Serif</STRONG>? And the answer is yes -- it was. Luckily those font names are affected by a different font mapping technology, <STRONG><EM>font linking</EM></STRONG>, which I will describe in a future post in this series....</P>
<P>There is another kind of font substitution that is occasionally seen in documentation, which relates to <A href="http://msdn.microsoft.com/library/en-us/graphics/hh/graphics/nt5gpd_43a650ea-ece9-48bd-96e9-1146f58de8cc.xml.asp">printer drivers</A>&nbsp;and what they do to substitute fonts built into printer hardware when thay can. My personal belief (with my admitted bias towards good international functionality) is that it is important to <EM>not</EM> use this feature since even printer fonts that accurately handle the basic glyphs seldom have the&nbsp; full support for <EM>all</EM> scripts (not to mention complex scripts!). In fact, one of the first things I do with each new version of Word is find out how to set the <EM>Print TrueType Fonts as Graphics</EM> setting that allow what is on the screen to be what gets printed rather than using device fonts....</P>
<P>&nbsp;</P>
<P><FONT color=#ff0000><EM>This post brought to you by</EM> "<FONT face="Microsoft Sans Serif">Úœ</FONT>" </FONT><EM><FONT color=#ff0000>(<A href="http://www.fileformat.info/info/unicode/char/069c/index.htm">U+069c</A>, a.k.a. ARABIC LETTER SEEN WITH THREE DOTS BELOW AND THREE DOTS ABOVE)<BR><FONT size=1>A character not seen in most device fonts!</FONT></FONT></EM></P>
<hr/><p><a id="399351" href="#399351">#</a> <strong>Mike Dunn</strong> on 20 Mar 2005 8:27 AM:</p><div style="margin-left: 1em">One thing that wasn't too clear in the docs about MS Shell Dlg (the last time I looked) is the distinction between using &quot;MS Shell Dlg&quot; in a DIALOG resource and a <a title="LOGFONT" href="http://msdn.microsoft.com/library/en-us/gdi/fontext_1wmq.asp" target="_blank">LOGFONT</a>. On a default setup of English 2K or XP, using it in a DIALOG gets you Tahoma, whereas using it as the face name in a LOGFONT gets you MS Sans Serif. <br> <br>Until I learned of the reg entries you described here (which was only recently), I never understood this behavior: <br>* Get a dialog's font with WM_GETFONT and look at the LOGFONT.<br>* The lfFaceName member is &quot;MS Shell Dlg&quot; as expected, and the font on the screen is Tahoma. <br>* Create a new font from that LOGFONT and use it to draw some text, and the text will be in MS Sans Serif. <br> <br>You can also replace the first step with GetStockObject(DEFAULT_GUI_FONT). <br> <br>So not only is &quot;MS Shell Dlg&quot; replaced with something else, the something else can vary depending on where it's being used. What I do now is, on 2K+, if I have a LOGFONT and the face name is &quot;MS Shell Dlg&quot; I change it to &quot;MS Shell Dlg 2&quot;. Is that kosher, or will that conflict with some other font magic the system does?</div>
<p><a id="399368" href="#399368">#</a> <strong>Michael Kaplan</strong> on 20 Mar 2005 10:03 AM:</p><div style="margin-left: 1em">I thought  none of them gave MS Sans Serif (a bitmap font); they all gave Microsoft Sans Serif (an unfortunately named font that most believe give superios glyphs for Arabic script to Tahoma and others).<br><br>It is never a problem to change which is used (though beware the points Raymone Chen makes about what such changes can do in order to avoid unintentionally messing things up).</div>
<p><a id="399399" href="#399399">#</a> <strong>Mike Dunn</strong> on 20 Mar 2005 12:44 PM:</p><div style="margin-left: 1em">I didn't look to see if the actual font was MS Sans Serif or Microsoft Sans Serif. I meant to say that the text looks like MS Sans Serif, which is the part I cared about since I wanted Tahoma.</div>
<p><a id="399678" href="#399678">#</a> <strong>Eric</strong> on 21 Mar 2005 6:33 AM:</p><div style="margin-left: 1em">&quot;In fact, one of the first things I do with each new version of Word is find out how to set the Print TrueType Fonts as Graphics setting that allow what is on the screen to be what gets printed rather than using device fonts....&quot;<br><br>Is there a drawback to this (slower printing, perhaps)?</div>
<p><a id="399681" href="#399681">#</a> <strong>Michael Kaplan</strong> on 21 Mar 2005 6:45 AM:</p><div style="margin-left: 1em">Indeed, Eric. But the loss of WYSIWYG is obviously worth some perf to get back, and for those of us who lose not only WYSIWYG but even basic character fidelity, there is no question which is better. :-)</div>
<p><a id="399717" href="#399717">#</a> <strong>Michael Kaplan</strong> on 21 Mar 2005 7:52 AM:</p><div style="margin-left: 1em">Mike -- there are other Raymond Chen links that help make this topic and the behavior make more sense: <a target="_new" href="http://blogs.msdn.com/oldnewthing/archive/2005/02/07/368423.aspx">http://blogs.msdn.com/oldnewthing/archive/2005/02/07/368423.aspx</a> (Why does DS_SHELLFONT = DS_FIXEDSYS | DS_SETFONT?) and <a target="_new" href="http://blogs.msdn.com/oldnewthing/archive/2005/02/08/369090.aspx">http://blogs.msdn.com/oldnewthing/archive/2005/02/08/369090.aspx</a> (What other effects does DS_SHELLFONT have on property sheet pages?).<br><br>The eventual meanings of the flags can get quite convoluted at times....</div>
<p><a id="399859" href="#399859">#</a> <strong>Mike Dimmick</strong> on 21 Mar 2005 10:38 AM:</p><div style="margin-left: 1em">Actually I think your green entries are for Windows 3.0 compatibility. &quot;Helv&quot; and &quot;Tms Rmn&quot; were renamed to MS Sans Serif and MS Serif for Windows 3.1, IIRC.</div>
<p><a id="400200" href="#400200">#</a> <strong>Michael Kaplan</strong> on 21 Mar 2005 8:48 PM:</p><div style="margin-left: 1em">Well, that is scary for all kinds of reasons. :-)</div>
<p><a id="406137" href="#406137">#</a> <strong>Aidan Corey</strong> on 7 Apr 2005 6:16 AM:</p><div style="margin-left: 1em">&quot;for those of us who lose not only WYSIWYG but even basic character fidelity, there is no question which is better. :-)&quot;<br><br>Sometimes a device font is essential for fidelity.  Label printers often have barcode fonts.  A TrueType barcode may have bars with irregular widths if they don't line up with the printer pixels (a thermal label printer might only be 200dpi).<br><br>Another example is a control font for sending commands like &quot;activate label cutter&quot;.<br><br>Unfortunately the .NET Framework doesn't seem to provide any support for device fonts.  So my question is: is there a way to make use of the printer font substitution you refer to above?</div>
<p><a id="406142" href="#406142">#</a> <strong>Michael S. Kaplan</strong> on 7 Apr 2005 6:51 AM:</p><div style="margin-left: 1em">Unfortunately, GDI+ can only work with TrueType/OpenType fonts; it cannot work with bitmap or device fonts....</div>
<p><a id="415706" href="#415706">#</a> <strong>Jai</strong> on 9 May 2005 7:49 AM:</p><div style="margin-left: 1em">You have said u will put light on certain other topics in this post. I hope that one comes soon. Waiting for it to come. Is it possible to put some light on how the font substitution works internally ??</div>
<hr/><p><em>referenced by</em></p><div style="margin-left: 1em"><p>2012/01/26 <a href="http://archives.miloush.net/michkap/archive/2012/01/26/10260726.html">If font linking doesn't fit the text to a T (or È›!), a Romanian letter may be right but not quite look it</a></p><p>2010/07/12 <a href="http://archives.miloush.net/michkap/archive/2010/07/12/10032066.html">Making a font fetish a bit more mainstream</a></p><p>2007/08/18 <a href="http://archives.miloush.net/michkap/archive/2007/08/18/4439054.html">You look so familiar; I think you're my type....</a></p><p>2007/07/11 <a href="http://archives.miloush.net/michkap/archive/2007/07/11/3815916.html">Any sufficiently confusing technology is indistinguishable from magic</a></p><p>2007/06/09 <a href="http://archives.miloush.net/michkap/archive/2007/06/09/3174676.html">Guilt by [font ]association (aka The consequences of picking the wrong font #3)</a></p><p>2006/06/06 <a href="http://archives.miloush.net/michkap/archive/2006/06/06/618628.html">Is this the Ãœber-font post? No, but it is the teaser for it!</a></p><p>2006/05/05 <a href="http://archives.miloush.net/michkap/archive/2006/05/05/590504.html">UI language of the LocalSystem account (which almost never shows UI)</a></p><p>2006/03/18 <a href="http://archives.miloush.net/michkap/archive/2006/03/18/554308.html">What about logical fonts?</a></p><p>2006/01/22 <a href="http://archives.miloush.net/michkap/archive/2006/01/22/515864.html">Questions about font linking, etc.</a></p><p>2005/06/18 <a href="http://archives.miloush.net/michkap/archive/2005/06/18/430507.html">Font substitution and linking #3</a></p><p>2005/05/16 <a href="http://archives.miloush.net/michkap/archive/2005/05/16/417711.html">Font substitution and linking #2</a></p></div><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2005/03/20/399518.html" title="Mixed feelings about the splitting out of features on Longhorn">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2005/03/19/398994.html" title="Impersonation and NLS">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2005-03">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2005-03-20">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2005/03/20/399322.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:42 GMT -->
</html>