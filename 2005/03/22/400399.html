<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2005/03/22/400399.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:42 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>Why UNICOWS.LIB is so big, but the amount of extra size to those who include it is small</title></head><body>
<h1>Why UNICOWS.LIB is so big, but the amount of extra size to those who include it is small</h1>
<p><em>by Michael S. Kaplan, published on 2005/03/22 09:41 -05:00, original URI: http://blogs.msdn.com/b/michkap/archive/2005/03/22/400399.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostNew -->
<P>I have hinted around about this problem before, but now <a href="http://blogs.msdn.com/oldnewthing/">Raymond Chen</A> explains how the technology works with a lot more detail in his post <A id=viewpost href="http://blogs.msdn.com/oldnewthing/archive/2005/03/22/400373.aspx">Why does the debugger show me the wrong function?</A> </P>
<P>Note that the default behavior with DELAYLOAD when the DLL or the function cannot be loaded is to throw an exception. This was not the solution that <A title=MSLU href="http://www.microsoft.com/globaldev/handson/dev/mslu_announce.mspx" target=_blank>MSLU</A> uses for the problem (as I said bfore, we do not use the default DELAYLOAD, so we are not locked into its default behavior!).</P>
<P>In the MSLU case, it has failure stubs that it uses rather than throwing exceptions -- for every single API that is wrapped, there is a defined stub that will set up the failure path so that if the function cannot be called for some reason, it will fail gracefully. If someone up higher on the callstack fails, it is not MSLU's fault! </P>
<P>(This is why MFC crashes if you link it with MSLU yet do not include the DLL -- because although MSLU is so braced to handle failure when it needs to that some would say it has an end-of-the-world complex, MFC's paranoid sense of denial does not let it contemplate the failure of base APIs like GetSystemDirectory. I guess all big libraries need one sort of therapy or another!)</P>
<P>But if you think about what most failure stubs are, they are simple functions -- how many ways are there to say "take three parameters, set last error to ERROR_CALL_NOT_IMPLEMENTED, return NULL", when all is said and done? Really just one. So all of that folding together of identical code happens on almost every compile/link in MSLU. Even with over 500 failure stubs included, one for each API that the <A title="Microsoft Layer for Unicode" href="http://www.microsoft.com/globaldev/handson/dev/mslu_announce.mspx" target=_blank>Microsoft Layer for Unicode</A> wraps.</P>
<hr/><div style="margin-left: 1em"><em>no comments</em></div><hr/><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2005/03/23/400982.html" title="Its all about respect (or it should be)">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2005/03/22/400316.html" title="Just part of &quot;the background bitmap&quot; in Access">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2005-03">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2005-03-22">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2005/03/22/400399.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:42 GMT -->
</html>