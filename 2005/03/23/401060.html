<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2005/03/23/401060.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:42 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>Being [case] insensitive without being inconsistent?</title></head><body>
<h1>Being [case] insensitive without being inconsistent?</h1>
<p><em>by Michael S. Kaplan, published on 2005/03/23 12:51 -05:00, original URI: http://blogs.msdn.com/b/michkap/archive/2005/03/23/401060.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostNew -->
<P>Bob Berger asked, in the suggestion box:</P>
<BLOCKQUOTE dir=ltr>
<P><FONT size=2>CaseInsensitiveHashCodeProvider and CaseInsensitiveComparer are not synchronized, despite what the documentation claims. The problem is that the CaseInsensitiveHashCodeProvider does not take equivalent character sequences into account, whereas the CaseInsensitiveComparer does. <BR><BR>For example, the character “Á” can be represented by a single code point, 0x00C1, and the character “á” can be represented by two code points, 0x0061 0x0301. Consequently, the expression <BR><BR>CaseInsensitiveComparer.DefaultInvariant.Compare("\u00C1", "\u0061\u0301") <BR><BR>returns zero. However, the expressions <BR><BR>CaseInsensitiveHashCodeProvider.DefaultInvariant.GetHashCode("\u00C1") <BR>CaseInsensitiveHashCodeProvider.DefaultInvariant.GetHashCode("\u0061\u0301") <BR><BR>return 177508 and 5861733, respectively. </FONT></P></BLOCKQUOTE>
<P>(I did some minor edits to make sure the code would work and that it matched the intent of the message)</P>
<P>I think there may be a little confusion on this point, because the hash code as returned by the GetHashCode() method on the CaseInsensitiveHashCodeProvider is not returning a number that is based on trying to create a culturally sesitive number that will meet the guidelines of returning equal values if Compare() would consider them to be equal (that functionality did not even exist until Whidbey, a fact that I know because I wrote it for Whidbey!). The actual hash table that uses the provider (as shown in the help examples) do show the behavior of the two being in lockstep when things work....</P>
<P>&nbsp;</P>
<P><FONT color=#ff0000><EM>This post brought to you by</EM> "Х" <EM>(<A href="http://www.fileformat.info/info/unicode/char/0425/index.htm">U+0425</A>, CYRILLIC CAPITAL LETTER HA)</EM></FONT></P>
<hr/><p><a id="401133" href="#401133">#</a> <strong>AT</strong> on 23 Mar 2005 1:10 PM:</p><div style="margin-left: 1em">Why you did link to this source at  <a target="_new" href="http://lab.msdn.microsoft.com/productfeedback/viewfeedback.aspx?feedbackid=FDBK23107">http://lab.msdn.microsoft.com/productfeedback/viewfeedback.aspx?feedbackid=FDBK23107</a>  ( <br>Opened Date: 2005-03-22 13:21:01 ) <br></div>
<p><a id="401240" href="#401240">#</a> <strong>Michael Kaplan</strong> on 23 Mar 2005 3:47 PM:</p><div style="margin-left: 1em">:-)<br><br>I was unaware this existed. Of course the code does not work as it stands in this bug....</div>
<p><a id="401426" href="#401426">#</a> <strong>mihailik</strong> on 24 Mar 2005 3:27 AM:</p><div style="margin-left: 1em">Are you plan to fix this behavior? It can produce hard-debuggable errors.</div>
<p><a id="401478" href="#401478">#</a> <strong>Michael Kaplan</strong> on 24 Mar 2005 6:45 AM:</p><div style="margin-left: 1em">It is on the list and actually *can* be fixed now (since there is  way to get such a hash code), so the odds are good....</div>
<p><a id="401682" href="#401682">#</a> <strong>Bob Burger</strong> on 24 Mar 2005 9:54 AM:</p><div style="margin-left: 1em">Similarly, performing case-sensitive comparisons using Comparer.Default or Comparer.DefaultInvariant and the default hash-code provider (the GetHashCode method) results in the same problem.<br><br>I don't see a CaseSensitiveHashCodeProvider in the .NET framework, but it would be useful if strings equivalent from the Comparer.Default point of view are to be used in a hash table.</div>
<p><a id="401685" href="#401685">#</a> <strong>Michael Kaplan</strong> on 24 Mar 2005 10:02 AM:</p><div style="margin-left: 1em">You may want to add that as a comment for the MSDn Feedback Center issue? :-)</div>
<p><a id="401686" href="#401686">#</a> <strong>Bob Burger</strong> on 24 Mar 2005 10:02 AM:</p><div style="margin-left: 1em">It's also interesting to note that System.Collections.Specialized.HybridDictionary gets around this bug by using its own private comparer, SymbolEqualComparer, that does not take equivalent character sequences into account.</div>
<hr/><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2005/03/24/402055.html" title="Accessibility, Internationalization, and Keyboards (#4 Creating good keyboards, part A)">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2005/03/23/400982.html" title="Its all about respect (or it should be)">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2005-03">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2005-03-23">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2005/03/23/401060.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:42 GMT -->
</html>