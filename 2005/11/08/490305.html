<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2005/11/08/490305.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:40 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>SQL Compatibility collations are a bit too retro for me</title></head><body>
<h1>SQL Compatibility collations are a bit too retro for me</h1>
<p><em>by Michael S. Kaplan, published on 2005/11/08 07:59 -05:00, original URI: http://blogs.msdn.com/b/michkap/archive/2005/11/08/490305.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostNew -->
<P><FONT face=Tahoma>Now when I say that 'SQL Compatibility collations are a bit too retro for me' I mean retro in the sense of retrograde....</FONT></P>
<P><FONT face=Tahoma>Last month, Richard asked me:</FONT></P>
<BLOCKQUOTE dir=ltr style="MARGIN-RIGHT: 0px">
<P><FONT size=2><EM>Still working on our implementation of this and having problems with the sort of collation <STRONG>SQL_Latin1_General_CP1_CI_AS</STRONG> which I would have thought had pretty perfect implementation being the default etc.</EM></FONT></P>
<P><FONT size=2><EM>When there are apostrophes in the data for example...</EM></FONT></P>
<P><FONT size=2><EM>O'Connor<BR>O'Connor<BR>O'Halloran Hill<BR>O'Sullivans Beach<BR>Oak Flats<BR>Oak Park<BR>Oakbank<BR>Oakdale<BR>Oakden<BR>Oakford<BR>Oakhurst<BR>Oaklands Junction<BR>Oaklands Park<BR>Oakleigh<BR>Oakleigh South<BR>Oakville<BR>Oatlands<BR>Oatlands<BR>Oatley<BR>Ocean Grove<BR>Ocean Reef<BR>Officer</EM></FONT></P>
<P><FONT size=2><EM>My CompareOptions are 0x00030001 from the SQL Server which I convert to 0x19 for the</EM></FONT></P>
<P><FONT size=2><EM>CompareInfo.Compare(a,b,m_PrevCollation.CompareOptions)</EM></FONT></P>
<P><FONT size=2><EM>So what is the best way for me to compare SQL_ collations in .NET&nbsp;? I seem to have stumbled across another inconsistency in the .NET&nbsp;string ordering in that case :)<BR>&nbsp;<BR>a<BR>a'<BR>A<BR>&nbsp;<BR>using Latin1_General_CS_AS collation gets things in a different order&nbsp;to SQL Server.</EM></FONT></P>
<P><EM><FONT size=2>Right the problem we have is that people want to compare their databases that still use the SQL_ collation so we have to have a function that will sort them in as close to the SQL_ order as possible.</FONT></EM></P>
<P><EM><FONT size=2>I understand about the punctuation issue it's just it </FONT></EM><EM><FONT size=2>seems to be sorted incorrectly in .NET whereas it's sorted like that in SQL Server.</FONT></EM></P>
<P><FONT size=2><EM>Am I missing something or will I have to develop a work around for&nbsp;this case? </EM></FONT></P></BLOCKQUOTE>
<P><FONT face=Tahoma>It is funny how there is no specific rule in English about how the sort is supposed to happen, and further that any time an organization or government tries to make a certain order "correct" the order chosen is as arbitrary as any other, yet we can latch onto one specific ordering as being the "correct" one. :-)</FONT></P>
<P><FONT face=Tahoma>In this case, the SQL compatibility collations in SQL Server are not the default because they are any more correct or proper; they are&nbsp;the default for one simple reason: if you cover less territory you can be faster. Back before SQL Server supported Unicode, when the collation setting was at the server level <EM>only</EM> could not be changed without a reinstall, it was easier to be faster.</FONT></P>
<P><FONT face=Tahoma>But that does not make the order it returned any better or worse than anything else ever created. And it is certainly not going to be 100% re-creatable anywhere other than SQL Server, although you can come close when you play with the various ComoareOptions flags. However, the meaning of the 0x00030001 as indicated in the information in <a href="http://archives.miloush.net/michkap/archive/2005/06/09/427293.html">String.Compare is for sissies (not for people who want SQLCLR consistency)</A>&nbsp;would indicate that the meaning was:</FONT></P>
<BLOCKQUOTE dir=ltr style="MARGIN-RIGHT: 0px">
<P><FONT face="Courier New"><STRONG>NORM_IGNORECASE | NORMIGNOREKANATYPE | NORM_IGNOREWIDTH</STRONG></FONT></P></BLOCKQUOTE>
<P><FONT face=Tahoma>This does equate to 0x19 in .NET, or</FONT></P>
<BLOCKQUOTE dir=ltr style="MARGIN-RIGHT: 0px">
<P><FONT face="Courier New"><STRONG>CompareOptions.IgnoreCase | CompareOptions.IgnoreKanaType | CompareOptions.IgnoreWidth</STRONG></FONT></P></BLOCKQUOTE>
<P><FONT face=Tahoma>when it is clear that there is also a bit of SORT_STRINGSORT/CompareOptions.StringSort in there as well.</FONT></P>
<P><FONT face=Tahoma>One could consider this a bug in the ComparisonStyle returned by the SQL compatibility collations. Though I am not sure if all of them show this behavior, to tell you the truth.</FONT></P>
<P><FONT face=Tahoma>The best answer is to stop using those SQL compatibility collations! Because not even using tricks like the ComparisonStyle can give you 100% answers there....</FONT></P>
<P><FONT face=Tahoma></FONT>&nbsp;</P>
<P><FONT face=Tahoma color=#ff1493><EM>This post brought to you by</EM> "a" <EM>(<A href="http://www.fileformat.info/info/unicode/char/0061">U+0061</A>, a.k.a. LATIN SMALL LETTER A)</EM></FONT></P>
<hr/><p><a id="490311" href="#490311">#</a> <strong>Michael S. Kaplan</strong> on 8 Nov 2005 8:12 AM:</p><div style="margin-left: 1em">For more info on SORT_STRINGSORT, see <a rel="nofollow" target="_new" href="http://archives.miloush.net/michkap/archive/2005/01/19/356280.html">http://blogs.msdn.com/356280.aspx</a> for the explanation....</div>
<hr/><p><em>referenced by</em></p><div style="margin-left: 1em"><p>2008/11/11 <a href="http://archives.miloush.net/michkap/archive/2008/11/11/9056745.html">Trying to ignore the small stuff is harder, if you're Arabic</a></p><p>2008/05/23 <a href="http://archives.miloush.net/michkap/archive/2008/05/23/8536649.html">SQL vs. Windows collations: the tricycle versus the Porsche</a></p><p>2007/10/25 <a href="http://archives.miloush.net/michkap/archive/2007/10/25/5686727.html">Not all in sync quite yet (aka SQL and the CLR and Windows and .NET)</a></p><p>2007/10/10 <a href="http://archives.miloush.net/michkap/archive/2007/10/10/5391882.html">Collations (SQL Compat. vs. Windows) -- not so subtle in the difference department</a></p><p>2006/12/07 <a href="http://archives.miloush.net/michkap/archive/2006/12/07/1232220.html">SQL and the CLR: Part 1 (the things we can make work well)</a></p><p>2006/10/29 <a href="http://archives.miloush.net/michkap/archive/2006/10/29/897317.html">SQL Server: compatibility collations vs. Window collations</a></p><p>2006/06/06 <a href="http://archives.miloush.net/michkap/archive/2006/06/06/618798.html">Unicode and SQL Collations have nothing to do with each other</a></p><p>2006/06/02 <a href="http://archives.miloush.net/michkap/archive/2006/06/02/615536.html">Je, for sure, from Sweden.</a></p></div><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2005/11/08/490495.html" title="More than you ever wanted to know about CP_SYMBOL">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2005/11/07/489978.html" title="SQL Server and the CLR have different ways of getting the money">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2005-11">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2005-11-08">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2005/11/08/490305.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:40 GMT -->
</html>