<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2005/09/12/463483.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:41 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>How does Microsoft assign new collation weights?</title></head><body>
<h1>How does Microsoft assign new collation weights?</h1>
<p><em>by Michael S. Kaplan, published on 2005/09/12 00:01 -07:00, original URI: http://blogs.msdn.com/michkap/archive/2005/09/12/463483.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostOld -->
<P><FONT face=Tahoma>A few days ago, in response to my post about the <a href="http://archives.miloush.net/michkap/archive/2005/09/10/463397.html">silly NLS question</A>, reader Gabe posted the following <a href="http://archives.miloush.net/michkap/archive/2005/09/10/463397.html#463446">comment</A>:</FONT></P>
<BLOCKQUOTE dir=ltr style="MARGIN-RIGHT: 0px">
<P><EM><FONT size=2>In all honesty, I can imagine somebody reading your blog, seeing you expound on various parts of Cyrillic, Chinese, and Sanskrit, and thinking that you actually know the languages written in those scripts. Or more likely, they might think that those are languages. <BR><BR>Much the way computer novices think that somebody who uses keyboard shortcuts must be a computer expert, it's pretty easy to assume that you must know some language because you know intricate details of its sort order. Hell, I once had an old Russian lady convinced that I was a native speaker because I was able to use all six words of the Russian vocabulary I know appropriately in conversation (with an accent I learned from movies).</FONT></EM></P></BLOCKQUOTE>
<P><FONT face=Tahoma>And he makes an excellent point here. For the most part I do not speak these languages, but I have learned a lot about their scripts, the Unicode properties of their characters (when I way characters I mean in both the user sense and the code unit sense), and their various orderings across many locales. And although I am not one of the linguists who does much of the actual work of reverse engineering dictionaries and sorted word lists to determine what the collations are, I do work with them and have been the one checkin in a lot of their work and the code that makes use of it.</FONT></P>
<P><FONT face=Tahoma>Plus occasionally I have done a few (though by no means all!) of the orderings myself in XP SP2 and Vista, for languages using Han (Hanzi/Kanji/Hanja), Hangul, Arabic, and other parts of the Unicode code space that someone with mere delusions of linguistic aptitude like myself can handle, with the data assistance from others. :-)</FONT></P>
<P><FONT face=Tahoma>So after I read Gabe's response, I looked back in email and found the following question sent to me on the contact link during a period when the suggestion box was temporarily unavailable (problems on the <a href="http://blogs.msdn.com/">MSDN Blogs</A> site), by a developer named Susan:</FONT></P>
<BLOCKQUOTE dir=ltr style="MARGIN-RIGHT: 0px">
<P><FONT size=2><EM>I can't&nbsp;make the suggestion box submit my question, so hopefully you will not mind me contacting you directly.</EM></FONT></P>
<P><EM><FONT size=2>I was wondering&nbsp;how your team&nbsp;actually decides what weight you assign in the default table that you mention&nbsp;in your post at&nbsp;<a href="http://archives.miloush.net/michkap/archive/2004/12/08/278170.html">http://blogs.msdn.com/michkap/archive/2004/12/08/278170.aspx</A>. </FONT></EM></P>
<P><EM><FONT size=2>It seems like there are times that the results do not match a particular language.&nbsp;That may be&nbsp;just that I do not know all the languages that the default table supports. But I think it would be an interesting&nbsp;post to geeks like me for you to explain how the decision&nbsp;is made!!!</FONT></EM></P></BLOCKQUOTE>
<P><FONT face=Tahoma>Well, anything for a fellow geek, Susan.... And sorry I took so long to get to the question! :-)</FONT></P>
<P><FONT face=Tahoma>To start with, it is an understatement to call it a decision -- they are actually a huge series of decision<STRONG>s</STRONG>, made over a long period of time. and the reasons are many and varied:</FONT></P>
<UL>
<LI><FONT face=Tahoma>Sometimes, there is an actual ordering for a specific language we support and it does not conflict with any of the weights that are already there. When that happens, the new characters can simply be inserted, using existing space in the weight table.</FONT> 
<LI><FONT face=Tahoma>Other times, there is an actual ordering for a specific language we support and it <EM>does</EM> conflict with weights that are already there. In those cases, we put it an an exception table. But of course we have to add it somewhere in the default table too, so we end up doing one of a few different things with code points not already there:</FONT> 
<UL>
<LI><FONT face=Tahoma>We may add it in the place that one of those default table languages might expect it due to its appearance;</FONT> 
<LI><FONT face=Tahoma>We may add it in a place consistent with how other characters have been added in (apparently) similar situations;</FONT> 
<LI><FONT face=Tahoma>We may add it to the end of the list of characters in the script.</FONT></LI></UL>
<LI><FONT face=Tahoma>Still other times,&nbsp;we may not have a specific language that needs the script but are trying to fill out a subrange of things in Unicode, in which case either of those previous three mechanisms might be used.</FONT></LI></UL>
<P><FONT face=Tahoma>All of this is done over the course of the last 10+ years by many different people (seven that I know of including myself!). It is definitely a situation where you are guaranteed to be consistent with some prior additions and inconsistent with some others, if you know what I mean.</FONT></P>
<P><FONT face=Tahoma>So, let us look at some languages. There are the Cyrillic characters used in Russian:</FONT></P>
<BLOCKQUOTE dir=ltr style="MARGIN-RIGHT: 0px">
<P><FONT face=Tahoma><STRONG>А а Б б В в Г г Д д Е е Ё ё Ж ж З з И и Й й К к Л л М м Н н О о П п Р р С с Т т У у Ф ф Х х Ц ц Ч ч Ш ш Щ щ Ъ ъ Ы ы Ь ь Э э Ю ю Я я </STRONG></FONT></P></BLOCKQUOTE>
<P><FONT face=Tahoma>Now compare that with some of the ones used in other languages that make use some or all of the time with the Cyrillic script, like Ukranian:</FONT></P>
<BLOCKQUOTE dir=ltr style="MARGIN-RIGHT: 0px">
<P><FONT face=Tahoma><STRONG>А а Б б В в Г г Ґ ґ Д д Е е Є є Ж ж З з И и І і Ї ї Й й К к Л л М м Н н О о П п Р р С с Т т У у Ф ф Х х Ц ц Ч ч Ш ш Щ щ Ю ю Я я Ь ь </STRONG></FONT></P></BLOCKQUOTE>
<P><FONT face=Tahoma>Or Belarusian (a.k.a. Byelorussian):</FONT></P>
<BLOCKQUOTE dir=ltr style="MARGIN-RIGHT: 0px">
<P><FONT face=Tahoma><STRONG>А а Б б В в Г г Д д Е е Ё ё Ж ж З з І і Й й К к Л л М м Н н О о П п Р р С с Т т У у Ў ў Ф ф Х х Ц ц Ч ч Ш ш Ы ы Ь ь Э э Ю ю Я я </STRONG></FONT></P></BLOCKQUOTE>
<P><FONT face=Tahoma>or Bulgarian:</FONT></P>
<BLOCKQUOTE dir=ltr style="MARGIN-RIGHT: 0px">
<P><FONT face=Tahoma><STRONG>А а Б б В в Г г Д д Е е Ж ж З з И и Й й К к Л л М м Н н О о П п Р р С с Т т У у Ф ф Х х Ц ц Ч ч Ш ш Щ щ Ъ ъ Ь ь Ю ю Я я&nbsp; </STRONG></FONT></P></BLOCKQUOTE>
<P><FONT face=Tahoma>Or Macedonian:</FONT></P>
<BLOCKQUOTE dir=ltr style="MARGIN-RIGHT: 0px">
<P><FONT face=Tahoma><STRONG>А а Б б В в Г г Д д Ѓ ѓ Е е Ж ж З з Ѕ ѕ И и Ј ј К к Л л Љ љ М м Н н Њ њ О о П п Р р С с Т т Ќ ќ У у Ф ф Х х Ц ц Ч ч Џ џ Ш ш </STRONG></FONT></P></BLOCKQUOTE>
<P><FONT face=Tahoma>Or Serbian:</FONT></P>
<BLOCKQUOTE dir=ltr style="MARGIN-RIGHT: 0px">
<P><FONT face=Tahoma><STRONG>А а Б б В в Г г Д д Ђ ђ Е е Ж ж З з И и Ј ј К к Л л Љ љ М м Н н Њ њ О о П п Р р С с Т т Ћ ћ У у Ф ф Х х Ц ц Ч ч Џ џ Ш ш </STRONG></FONT></P></BLOCKQUOTE>
<P><FONT face=Tahoma>Or Kazakh:</FONT></P>
<BLOCKQUOTE dir=ltr style="MARGIN-RIGHT: 0px">
<P><FONT face=Tahoma><STRONG>А а Ә ә Б б В в Г г Ғ ғ Д д Е е Ё ё Ж ж З з И и Й й К к Қ қ Л л М м Н н Ң ң О о П п Ө ө Р р С с Т т У у Ұ ұ Ү ү Ф ф Х х Һ һ Ц ц Ч ч Ш ш Щ щ Ъ ъ Ы ы İ і Ь ь Э э Ю ю Я я </STRONG></FONT></P></BLOCKQUOTE>
<P><FONT face=Tahoma>Or Kyrgyz:</FONT></P>
<BLOCKQUOTE dir=ltr style="MARGIN-RIGHT: 0px">
<P><FONT face=Tahoma><STRONG>А а Б б Г г Д д Е е Ё ё Ж ж З з И и Й й К к Л л М м Н н Ң ң О о Ө ө П п Р р С с Т т У у Ү ү Х х Ч ч Ш ш Ы ы Э э Ю ю Я я </STRONG></FONT></P></BLOCKQUOTE>
<P><FONT face=Tahoma>Or Mongolian:</FONT></P>
<BLOCKQUOTE dir=ltr style="MARGIN-RIGHT: 0px">
<P><FONT face=Tahoma><STRONG>А а Б б В в Г г Д д Е е Ё ё Ж ж З з И и Й й К к Л л М м Н н О о Ө ө П п Р р С с Т т У у Ү ү Ф ф Х х Ц ц Ч ч Ш ш Щ щ Ъ ъ Ы ы Ь ь Э э Ю ю Я я </STRONG></FONT></P></BLOCKQUOTE>
<P><FONT face=Tahoma>There are a lot of differences here, some of which are immediately apparent like more/fewer/different characters, and many others of which are described in the <A href="http://en.wikipedia.org/wiki/Cyrillic_alphabet">Wikipedia article about the Cyrillic script</A>. And many of these differences are supported in the various locales on Windows.</FONT></P>
<P><FONT face=Tahoma>Although to be perfectly honest, a few of the differences are not there yet, despite the fact that the locale is there. Occasionally (to give an example) if one of those seven people was looking at a character not used in an existing collation whose appearance and name (which has a 'with descender'&nbsp; or 'with upturn' in it) suggested it might have a secondary or diacritic difference, despite the fact that it actually is a separate letter that should have a primary weight (we were occasionally spoiled by typical usage in the Latin script!).</FONT></P>
<P><FONT face=Tahoma>These are the kinds of things that can be considered bugs to fix on a future version of Windows, for obvious reasons.</FONT></P>
<P><FONT face=Tahoma>The same thing can be said of some of the many languages that use the Arabic script (for example, proper Farsi collation support was not added until Windows 2000 SP1/XP SP1/Server 2003 SP1).</FONT></P>
<P><FONT face=Tahoma>There is a serious effort to clean up such problems in Vista, because as 'minor' as such problems may appear to be when looking at the 50,000+ code points in the default table, they are obviously major if they are happening in a language that is your own. If you know what I mean. And this weight 'fixing' is happening in Vista for languages in many scripts across the Unicode space....</FONT></P>
<P><FONT face=Tahoma></FONT>&nbsp;</P>
<P><FONT face=Tahoma color=#ff0000><EM>This post brought to you by</EM> "<FONT color=#ff0000 size=6>А</FONT>" <EM>(<A href="http://www.fileformat.info/info/unicode/char/0410/index.htm">U+0410</A>, a.k.a. CYRILLIC CAPITAL LETTER A)<BR><FONT size=1>(A letter that is quite proud to be at the very beginning of all Cyrillic scripts!)</FONT></EM></FONT></P>
<hr/><p><a id="467936" href="#467936">#</a> <strong>Ivan Petrov</strong> on Thursday, September 15, 2005 5:46 PM:</p><div style="margin-left: 1em">Hi Michael,<br><br>I want to post here something very interesting, in my opinion, partly in a connection we the post above - I mean the bulgarian script (if I've understood you correctly).<br><br>So the post:<br><br><br>Alphabet of the modern Bulgarian writen language<br>------------------------------------------------<br><br>The present Bulgarian alphabet has 30 letters:<br><br>Аа	Бб	Вв	Гг	Дд	Ее	Жж	Зз	Ии	Йй<br>Кк	Лл	Мм	Нн	Оо	Пп	Рр	Сс	Тт	Уу<br>Фф	Хх	Цц	Чч	Шш	Щщ	Ъъ	ь*	Юю	Яя<br><br>* there is NO word in Bulgarian, that begins with the capital letter ‘Ь’!<br><br><br>Script of the modern Bulgarian writen language<br>----------------------------------------------<br><br>Аа (А̀а̀)	Бб	Вв	Гг	  Дд	     Ее (Ѐѐ)	Жж	   Зз	Ии (Ѝѝ)  Йй<br>Кк	        Лл	Мм	Нн	  Оо (О̀о̀)  Пп	        Рр	   Сс	Тт	   Уу (У̀у̀)<br>Фф	        Хх	Цц	Чч	  Шш	     Щщ	        Ъъ (Ъ̀ъ̀)  Ьь	Юю (Ю̀ю̀)  Яя (Я̀я̀)<br><br><br>Stressed vowels with grave accent in Bulgarian writen language &amp; UNICODE<br>------------------------------------------------------------------------<br><br>1. Stressed vowels with grave accent in Bulgarian writen language:<br><br>А̀а̀ Ѐѐ Ѝѝ О̀о̀ У̀у̀ Ъ̀ъ̀ Ю̀ю̀ Я̀я̀ (16)<br><br>2. UNICODE situation:<br><br>Today in UNICODE we can find in precomposed form only 4 of all the 16 needed stressed vowels with grave accent used in the modern Bulgarian writen language:<br><br>Ѐ – CYRILLIC CAPITAL LETTER IE WITH GRAVE - <a rel="nofollow" target="_new" href="http://www.fileformat.info/info/unicode/char/0400/index.htm">http://www.fileformat.info/info/unicode/char/0400/index.htm</a> <br>Ѝ – CYRILLIC CAPITAL LETTER I WITH GRAVE - <a rel="nofollow" target="_new" href="http://www.fileformat.info/info/unicode/char/040D/index.htm">http://www.fileformat.info/info/unicode/char/040D/index.htm</a> <br>ѐ – CYRILLIC SMALL LETTER IE WITH GRAVE - <a rel="nofollow" target="_new" href="http://www.fileformat.info/info/unicode/char/0450/index.htm">http://www.fileformat.info/info/unicode/char/0450/index.htm</a> <br>ѝ – CYRILLIC SMALL LETTER I WITH GRAVE - <a rel="nofollow" target="_new" href="http://www.fileformat.info/info/unicode/char/045d/index.htm">http://www.fileformat.info/info/unicode/char/045d/index.htm</a><br><br><br>Q: Why the Bulgarians need them (the Stressed vowels with grave accent)?<br>A: Because of the Shifting stress!<br>------------------------------------------------------------------------<br><br>As we can see at <a rel="nofollow" target="_new" href="http://en.wikipedia.org/wiki/Bulgarian_language#Word_stress">http://en.wikipedia.org/wiki/Bulgarian_language#Word_stress</a> the Bulgarian written language has a distinctive stress: for example, въ̀лна /v'əlna/ (&quot;wool&quot;) and вълна̀ /vəln'a/ (&quot;wave&quot;) are only differentiated by stress.<br><br>Regards,<br>Ivan.</div>
<p><a id="468043" href="#468043">#</a> <strong>Michael S. Kaplan</strong> on Thursday, September 15, 2005 8:30 PM:</p><div style="margin-left: 1em">Hi Ivan -- Precomposed forms are not required for representation, and never have been. I amhiping you will accept this some day. :-)</div>
<p><a id="468225" href="#468225">#</a> <strong>Ivan Petrov</strong> on Friday, September 16, 2005 3:38 AM:</p><div style="margin-left: 1em">Hi Michael,<br>I remember that you have dedicated a whole post as a answer to my queston:<br><br>Can I get my characters into Unicode?<br>wich can be found on <a rel="nofollow" target="_new" href="http://archives.miloush.net/michkap/archive/2005/02/06/367985.html">http://blogs.msdn.com/michkap/archive/2005/02/06/367985.aspx</a><br><br>So, I accept and understood that &quot;Precomposed forms are not required for representation&quot; clearly!<br><br>But I'm wondering in this case, why we've all of the Lattin vowels with grave and acute accent in Precomposed form in UNICODE? ... And this is why I think that the Stressed vowels used in the Bulgarian written language must be in UNICODE in Precomposed form!<br><br><br>Basically, my post above was mainly about the bulgarian script, which consist of 76 characters, not of 60!<br><br>Regards,<br>Ivan.</div>
<p><a id="468250" href="#468250">#</a> <strong>Michael S. Kaplan</strong> on Friday, September 16, 2005 4:01 AM:</p><div style="margin-left: 1em">Everything you need can be represented with what is currently encoded.</div>
<p><a id="468254" href="#468254">#</a> <strong>Ivan Petrov</strong> on Friday, September 16, 2005 4:11 AM:</p><div style="margin-left: 1em">Hi again,<br><br>Ok, you're the techlead ;-) ... so I agree with you ;-)<br><br>... Soon this days I will post in the Suggestion box a very interesting question about the support of UNICODE in Command Promt/Shall ...<br><br>... I saw that the MSKLC file size issue was now corrected! ... Good! ;-)<br><br>See you.<br><br>Regards,<br>Ivan.</div>
<p><a id="470874" href="#470874">#</a> <strong>Michael S. Kaplan</strong> on Sunday, September 18, 2005 10:23 AM:</p><div style="margin-left: 1em">Ivan -- I wanted to point out that for all of the collation frameworks out there, providing single weights for multiple code points is trivial, as is providing keyboard options to type the data -- so precomposed forms are not required.<br><br>But I was curious about the collation side. When you compare the stressed to the nonstressed part:<br><br>Аа (А̀а̀) <br>Ее (Ѐѐ) <br>Ии (Ѝѝ) <br>Оо (О̀о̀) <br>Уу (У̀у̀) <br>Ъъ (Ъ̀ъ̀) <br>Юю (Ю̀ю̀) <br>Яя (Я̀я̀) <br><br>(note that for font support to work best here, the font just needs the hints in it for attachment points, something that should get better in Vista but I will forward this to some of the people in Typography to be sure)<br><br>Anyway, when comparing stressed to unstressed, are the stressed considered to be completely separate letters, like '&#196;' in Swedish, or does it just have a diacrituc difference, like in German?</div>
<p><a id="474074" href="#474074">#</a> <strong>Ivan Petrov</strong> on Monday, September 26, 2005 2:52 PM:</p><div style="margin-left: 1em">Hi Michael.<br><br>Sorry for the late answer, but I've a work to do ...<br><br>... Anyway, ... when comparing stressed to unstressed letters the difference is diacritic, I mean that any stressed letter is the same as the unstressed letter, but with with grave accent, wich in this case is diacritic sign. As I explained above the grave accent is used because of the Shifting stress, which means that when I pronounce some words they may have two different meanings depending of that where I put the stress. So, when I write down one of this words, grammaticaly I'm obligated to put a grave accent on the this vowel of that word which makes the sence of it that I really mean.<br>The example above, which I will now repeat is very indicative! So:<br><br>въ̀лна /v'əlna/ (&quot;wool&quot;) and вълна̀ /vəln'a/ (&quot;wave&quot;)<br><br>Here in this example we have the word &quot;вълна&quot;, which may have two different meanings dependig of where we put the stress. If I put the stress on the first vowel &quot;ъ&quot; the word means &quot;wool&quot;, but if I put the stress on the second vowel - in this case the word means &quot;wave&quot;.<br><br>I hope now that I was clear ;-)<br>If any questions, you're welcome.<br><br><br>... By the way on the &quot;Suggest a Topic!&quot; page disappeared my 'Bulgarian Locale' questions and suggestions. Does that mean that you're not interested in that or you'll post soon an answer of that topic?<br><br>Regards,<br>Ivan.</div>
<p><a id="474087" href="#474087">#</a> <strong>Michael S. Kaplan</strong> on Monday, September 26, 2005 3:14 PM:</p><div style="margin-left: 1em">Thanks for the info, Ivan!<br><br>About the Bulgarian locale info your posted, I forwarded the info to the owner of locale data to look at what should and what could be updated. Once I did that, it did not make sense to leave there....</div>
<p><a id="474103" href="#474103">#</a> <strong>Ivan Petrov</strong> on Monday, September 26, 2005 3:37 PM:</p><div style="margin-left: 1em">Hi again ;-)<br><br>... As I said above: You're always welcome! ;-) ... It's always a pleasure to comunicate with you! ... So, I'm happy, I've this possibility ....<br><br>By the way, is Shawn Steele the locale data owner guy? .....<br><br></div>
<p><a id="474125" href="#474125">#</a> <strong>Michael S. Kaplan</strong> on Monday, September 26, 2005 4:32 PM:</p><div style="margin-left: 1em">No, Shawn is the dev owner of the code that uses the data, but it a PM with the help of SPMs who own the actual data decisions....</div>
<p><a id="474128" href="#474128">#</a> <strong>Ivan Petrov</strong> on Monday, September 26, 2005 4:39 PM:</p><div style="margin-left: 1em">Ok, thanks Michael.<br><br>See you.</div>
<hr/><p><em>referenced by</em></p><div style="margin-left: 1em"><p>2009/02/04 <a href="http://archives.miloush.net/michkap/archive/2009/02/04/9394864.html">The road to hell is paved with attempts at being compatible</a></p><p>2008/02/10 <a href="http://archives.miloush.net/michkap/archive/2008/02/10/7579576.html">Microsoft still does not use the UCA; the converse is also true</a></p><p>2007/12/10 <a href="http://archives.miloush.net/michkap/archive/2007/12/10/6719043.html">In SQL Server, different collations implies different ranges (aka Not every table has its THORN)</a></p><p>2007/08/12 <a href="http://archives.miloush.net/michkap/archive/2007/08/12/4352905.html">Hello Madda, Hello Father (Iranian style)</a></p><p>2007/01/18 <a href="http://archives.miloush.net/michkap/archive/2007/01/18/1488052.html">Even if it makes no sense it has to go somewhere</a></p></div><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2005/09/12/463560.html" title="Theory vs. practice for Korean text collation, Redux">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2005/09/11/463928.html" title="An odd place to draw the line">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2005-09">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2005-09-12">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2005/09/12/463483.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:41 GMT -->
</html>