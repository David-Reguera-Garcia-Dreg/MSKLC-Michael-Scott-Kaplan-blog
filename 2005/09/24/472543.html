<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2005/09/24/472543.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:41 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>The basics of supplementary</title></head><body>
<h1>The basics of supplementary</h1>
<p><em>by Michael S. Kaplan, published on 2005/09/24 00:01 -07:00, original URI: http://blogs.msdn.com/michkap/archive/2005/09/24/472543.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostOld -->
<P><FONT face=Tahoma>I thought I would explain a bit more about how surrogates work in Unicode, since it does not seem very well described in a whole lot of places. First, some definitions (all from the <A href="http://www.unicode.org/glossary/">Unicode Glossary</A>&nbsp;and the <A href="http://www.unicode.org/roadmaps/">Unicode Roadmap</A> sites):</FONT></P><FONT face=Tahoma>
<UL>
<LI><A name=basic_multilingual_plane><EM><STRONG><FONT size=2>Basic Multilingual Plane</FONT></STRONG></EM></A><FONT size=2>. Plane 0, abbreviated as <A href="http://www.unicode.org/roadmaps/bmp/">BMP</A>.</FONT> 
<LI><A name=high_surrogate_code_point><FONT size=2><STRONG><EM>High-Surrogate Code Point</EM></STRONG></FONT></A><FONT size=2>. A Unicode code point in the range U+D800 to U+DBFF. (See definition D25 in </FONT><A href="http://www.unicode.org/versions/Unicode4.0.0/ch03.pdf"><FONT size=2>Section 3.8, Surrogates</FONT></A><FONT size=2>.)</FONT> 
<LI><I><A name=high_surrogate_code_unit><FONT size=2><STRONG>High-Surrogate Code Unit</STRONG></FONT></A></I><FONT size=2>. A 16-bit code unit in the range D800<SUB>16</SUB> to DBFF<SUB>16</SUB>, used in UTF-16 as the leading code unit of a surrogate pair. Also known as a <I>leading surrogate</I>. (See definition D25a in </FONT><A href="http://www.unicode.org/versions/Unicode4.0.0/ch03.pdf"><FONT size=2>Section 3.8, Surrogates</FONT></A><FONT size=2>.)</FONT> 
<LI><A name=leading_surrogate><EM><FONT size=2><STRONG>Leading Surrogate</STRONG></FONT></EM></A><FONT size=2>. Synonym for <I><A href="http://www.unicode.org/glossary/#high_surrogate_code_unit">high-surrogate code unit</A></I>.</FONT> 
<LI><I><A name=low_surrogate_code_point><FONT size=2><STRONG>Low-Surrogate Code Point</STRONG></FONT></A></I><FONT size=2>. A Unicode code point in the range U+DC00 to U+DFFF. (See definition D26 in </FONT><A href="http://www.unicode.org/versions/Unicode4.0.0/ch03.pdf"><FONT size=2>Section 3.8, Surrogates</FONT></A><FONT size=2>.)</FONT> 
<LI><I><A name=low_surrogate_code_unit><FONT size=2><STRONG>Low-Surrogate Code Unit</STRONG></FONT></A></I><FONT size=2>. A 16-bit code unit in the range DC0016 to DFFF16, used in UTF-16 as the trailing code unit of a surrogate pair. Also known as a trailing surrogate. (See definition D26a in </FONT><A href="http://www.unicode.org/versions/Unicode4.0.0/ch03.pdf"><FONT size=2>Section 3.8, Surrogates</FONT></A><FONT size=2>.)</FONT> 
<LI><A name=plane><EM><FONT size=2><STRONG>Plane</STRONG></FONT></EM></A><FONT size=2>. A range of 65,536 (10000<SUB>16</SUB>) contiguous Unicode code points, where the first code point is an integer multiple of 65,636 (10000<SUB>16</SUB>). Planes are numbered from 0 to 16, with the number being the first code point of the plane divided by 65,536. Thus Plane 0 is U+0000..U+FFFF, Plane 1 is U+<B>1</B>0000..U+<B>1</B>FFFF, ..., and Plane 16 (10<SUB>16</SUB>) is U+<B>10</B>0000..<B>10</B>FFFF. (Note that ISO/IEC 10646 uses hexadecimal notation for the plane numbers—for example, Plane B instead of Plane 11). (See <I><A href="http://www.unicode.org/glossary/#basic_multilingual_plane">Basic Multilingual Plane</A></I> and </FONT><A href="http://www.unicode.org/glossary/#supplementary_planes"><I><FONT size=2>s</FONT></I></A><I><A href="http://www.unicode.org/glossary/#supplementary_planes"><FONT size=2>upplementary planes</FONT></A></I><FONT size=2>.)</FONT> 
<LI><A name=private_use><EM><STRONG><FONT size=2>Private Use</FONT></STRONG></EM></A><FONT size=2>. Refers to designated code points in the Unicode Standard or other character encoding standards whose interpretations are not specified in those standards and whose use may be determined by private agreement among cooperating users.</FONT> 
<LI><A name=private_use_code_point><EM><FONT size=2><STRONG>Private-Use Code Point</STRONG></FONT></EM></A><FONT size=2>. Code points in the ranges U+E000..U+F8FF, U+F0000..U+FFFFD, and U+100000..U+10FFFD. (See definition D12 in </FONT><A href="http://www.unicode.org/versions/Unicode4.0.0/ch03.pdf"><FONT size=2>Section 3.5, Properties</FONT></A><FONT size=2>.) These code points are designated in the Unicode Standard for private use.</FONT> 
<LI><A name=reserved><EM><FONT size=2><STRONG>Reserved</STRONG></FONT></EM></A><FONT size=2><EM>.</EM> Refers to undesignated code points, which are set aside for future standardization. (See </FONT><A href="http://www.unicode.org/versions/Unicode4.0.0/ch02.pdf"><FONT size=2>Section 2.4, Code Points and Characters</FONT></A><FONT size=2>.)</FONT> 
<LI><I><A name=supplementary_character><FONT size=2><STRONG>Supplementary Character</STRONG></FONT></A></I><FONT size=2>. A Unicode encoded character having a supplementary code point.</FONT> 
<LI><I><A name=supplementary_code_point><FONT size=2><STRONG>Supplementary Code Point</STRONG></FONT></A></I><FONT size=2>. A Unicode code point between U+10000 and U+10FFFF.</FONT><FONT size=2> 
<LI><FONT size=2><EM><STRONG>Supplementary Ideographic Plane</STRONG></EM></FONT><FONT size=2><EM><STRONG>. </STRONG></EM>Plane 2, abbreviated as <A href="http://www.unicode.org/roadmaps/sip/index.html">SIP</A><EM><STRONG>.</STRONG></EM></FONT></FONT> 
<LI><FONT size=2><STRONG><EM>Supplementary Multilingual Plane</EM></STRONG></FONT><FONT size=2><EM>. </EM>Plane 1, abbreviated as <A href="http://www.unicode.org/roadmaps/smp/">SMP</A><EM>.</EM></FONT> 
<LI><FONT size=2><STRONG><EM>Supplementary&nbsp;Special-purpose&nbsp;Plane</EM></STRONG></FONT><FONT size=2><EM>. </EM>Plane 14, abbreviated as <A href="http://www.unicode.org/roadmaps/ssp/">SSP</A><EM>.</EM></FONT> 
<LI><A name=supplementary_planes><FONT size=2><STRONG><EM>Supplementary Planes</EM></STRONG></FONT></A><FONT size=2><EM>. </EM>Planes 1 through 16, consisting of the supplementary code points<EM>.</EM></FONT> 
<LI><A name=surrogate_character><FONT size=2><STRONG><EM>Surrogate Character</EM></STRONG></FONT></A><FONT size=2>. A misnomer. It would be an encoded character having a surrogate code point, which is impossible. Do not use this term. <EM><FONT color=#ff0000>[I&nbsp;talk about this issue </FONT></EM><EM><FONT color=#ff0000><a href="http://archives.miloush.net/michkap/archive/2005/07/27/444101.html">here</A></FONT></EM><EM><FONT color=#ff0000>]</FONT></EM></FONT>&nbsp; 
<LI><I><A name=surrogate_code_point><FONT size=2><STRONG>Surrogate Code Point</STRONG></FONT></A></I><FONT size=2>. A Unicode code point in the range U+D800 through U+DFFF. Reserved for use by UTF-16, where a pair of surrogate code units (a high surrogate followed by a low surrogate) “stand in” for a supplementary code point.</FONT> 
<LI><EM><A name=surrogate_pair><FONT size=2><STRONG>Surrogate Pair</STRONG></FONT></A></EM><FONT size=2>. A representation for a single abstract character that consists of a sequence of two 16-bit code units, where the first value of the pair is a <I><A href="http://www.unicode.org/glossary/#high_surrogate_code_unit">high-surrogate code unit</A></I>, and the second is a <I><A href="http://www.unicode.org/glossary/#low_surrogate_code_unit">low-surrogate code unit</A></I>. (See definition D27 in </FONT><A href="http://www.unicode.org/versions/Unicode4.0.0/ch03.pdf"><FONT size=2>Section 3.8, Surrogates</FONT></A><FONT size=2>.)</FONT> 
<LI><FONT size=2><EM><STRONG>Trailing Surrogate</STRONG></EM>. Synonym for <I><A href="http://www.unicode.org/glossary/#low_surrogate_code_unit">low-surrogate code unit</A></I>.</FONT> 
<LI><EM><A name=unassigned><FONT size=2><STRONG>Unassigned</STRONG></FONT></A></EM><FONT size=2>. Code points that either are reserved for future use or are never to be used.</FONT> 
<LI><I><A name=unassigned_character><FONT size=2><STRONG>Unassigned Character</STRONG></FONT></A></I><FONT size=2>. Synonym for <I>not assigned to an abstract character</I>. This refers to surrogate code points, noncharacters, and reserved code points. (See </FONT><A href="http://www.unicode.org/versions/Unicode4.0.0/ch02.pdf"><FONT size=2>Section 2.4, Code Points and Characters</FONT></A><FONT size=2>.)</FONT> 
<LI><FONT size=2><I><STRONG>Unassigned Code Point</STRONG></I>. (See <I><A href="http://www.unicode.org/glossary/#undesignated_code_point">undesignated code point</A></I>.)</FONT> 
<LI><I><A name=undesignated_code_point><FONT size=2><STRONG>Undesignated Code Point</STRONG></FONT></A></I><FONT size=2>. Synonym for <I>reserved code point</I>. These code points are reserved for future assignment and have no other designated normative function in the standard. (See </FONT><A href="http://www.unicode.org/versions/Unicode4.0.0/ch02.pdf"><FONT size=2>Section 2.4, Code Points and Characters</FONT></A><FONT size=2>.)</FONT> 
<LI><A name=unicode_scalar_value><EM><FONT size=2><STRONG>Unicode Scalar Value</STRONG></FONT></EM></A><FONT size=2>. Any Unicode <I><A href="http://www.unicode.org/glossary/#code_point">code point</A></I> except high-surrogate and low-surrogate code points. In other words, the ranges of integers 0 to D7FF<SUB>16</SUB> and E000<SUB>16</SUB> to 10FFFF<SUB>16</SUB> inclusive. (See definition D28 in </FONT><A href="http://www.unicode.org/versions/Unicode4.0.0/ch03.pdf"><FONT size=2>Section 3.9, Unicode Encoding Forms</FONT></A><FONT size=2>.)</FONT></LI></UL>
<P>Ok, it is all as clear as mud now, right? :-)</P>
<P>The problem is that even if the definitions are applied consistently, there is no good feel for exactly how they work, how high and low surrogates combine, and so on.</P>
<P>(Other questions, like <a href="http://archives.miloush.net/michkap/archive/2005/07/31/445850.html">why do high surrogates have lower numbers than low surrogates</A> are covered in other posts)</P>
<P>Let's see if we can't do something about that....</P>
<P><EM><FONT color=#ff0000>(Warning: some MATH content ahead!)</FONT></EM></P>
<P>We start with the Basic Multilingual Plane -- it is the code units from U+0000 to U+FFFF. Some of these code points are assigned; and a large subset of those are assigned characters. In all there are 65,536 code units in this and every other plane; you can also think of this as 10000<SUB>16</SUB> or just 2<SUP>16</SUP>&nbsp;code units. Whatever you find easiest, conceptually.</P>
<P>Now what happens with those high surrogate code points is that the block of 1024 of them are divided into 16 blocks of 64 each. And each one of those blocks is used for&nbsp;a plane:</P>
<UL>
<LI><FONT face="Courier New"><STRONG>U+d800 - U+d83f (Plane 1, Supplementary Multilingual Plane)</STRONG></FONT> 
<LI><FONT face="Courier New"><STRONG>U+d840 - U+d87f (Plane 2, Supplementary Ideographic Plane)</STRONG></FONT> 
<LI><FONT face="Courier New"><STRONG>U+d880 - U+d8bf (Plane 3, Reserved)</STRONG></FONT> 
<LI><FONT face="Courier New"><STRONG>U+d8c0 - U+d8ff (Plane 4, Reserved)</STRONG></FONT> 
<LI><FONT face="Courier New"><STRONG>U+d900 - U+d93f (Plane 5, Reserved)</STRONG></FONT> 
<LI><FONT face="Courier New"><STRONG>U+d940 - U+d97f (Plane 6, Reserved)</STRONG></FONT> 
<LI><FONT face="Courier New"><STRONG>U+d980 - U+d9bf (Plane 7, Reserved)</STRONG></FONT> 
<LI><FONT face="Courier New"><STRONG>U+d9c0 - U+d9ff (Plane 8, Reserved)</STRONG></FONT> 
<LI><FONT face="Courier New"><STRONG>U+da00&nbsp;- U+da3f (Plane 9, Reserved)</STRONG></FONT> 
<LI><FONT face="Courier New"><STRONG>U+da40&nbsp;- U+da7f (Plane 10, Reserved)</STRONG></FONT> 
<LI><FONT face="Courier New"><STRONG>U+da80 - U+dabf (Plane 11, Reserved)</STRONG></FONT> 
<LI><FONT face="Courier New"><STRONG>U+dac0 - U+daff (Plane 12, Reserved)</STRONG></FONT> 
<LI><FONT face="Courier New"><STRONG>U+db00 - U+db3f (Plane 13, Reserved)</STRONG></FONT> 
<LI><FONT face="Courier New"><STRONG>U+db40 - U+db7f (Plane 14, Supplementary&nbsp;Special-purpose Plane)</STRONG></FONT> 
<LI><FONT face="Courier New"><STRONG>U+db80 - U+dbbf (Plane 15, Supplementary Private Use Area A)</STRONG></FONT> 
<LI><FONT face="Courier New"><STRONG>U+dbc0 - U+dbff (Plane 16, Supplementary Private Use Area B)</STRONG></FONT></LI></UL>
<P>By convention, U+[##]FFFE and U+[##]FFFF of each plane are set aside and reserved, never to be assigned. This allows internal processes to use them as sentinels. Note that they should never be interchanged with any other process!</P></FONT>
<P><FONT face=Tahoma></FONT><FONT face=Tahoma>Now the way things are numbered, each high surrogate is used, serially, combining with every possible one of the 1024&nbsp;low surrogates before moving onto the next high surrogate. Thus for supplementary characters you see the following order:</FONT></P>
<UL>
<LI><FONT face="Courier New"><STRONG>U+d800 U+dc00 -&gt; U+10000</STRONG></FONT> 
<LI><FONT face="Courier New"><STRONG>U+d800 U+dc01 -&gt; U+10001</STRONG></FONT> 
<LI><FONT face="Courier New"><STRONG>U+d800 U+dc02 -&gt; U+10002</STRONG></FONT> 
<LI><FONT face="Courier New"><STRONG>...</STRONG></FONT> 
<LI><FONT face="Courier New"><STRONG>U+d800 U+dffd -&gt; U+103fd</STRONG></FONT> 
<LI><FONT face="Courier New"><STRONG>U+d800 U+dffe -&gt; U+103fe</STRONG></FONT> 
<LI><FONT face="Courier New"><STRONG>U+d800 U+dfff -&gt; U+103ff</STRONG></FONT> 
<LI><FONT face="Courier New"><STRONG>U+d801 U+dc00 -&gt; U+10400</STRONG></FONT> 
<LI><FONT face="Courier New"><STRONG>U+d801 U+dc01 -&gt; U+10401</STRONG></FONT> 
<LI><STRONG><FONT face="Courier New">U+d801 U+dc02 -&gt; U+10402</FONT></STRONG> 
<LI><STRONG><FONT face="Courier New">...</FONT></STRONG> 
<LI><STRONG><FONT face="Courier New">U+dbff U+dffd -&gt; U+10fffd</FONT></STRONG> 
<LI><STRONG><FONT face="Courier New">U+dbff U+dffe -&gt; U+10fffe</FONT></STRONG> 
<LI><STRONG><FONT face="Courier New">U+dbff U+dfff -&gt; U+10ffff</FONT></STRONG></LI></UL>
<P><FONT face=Tahoma>(I skipped some spaces in there for obvious reasons!)</FONT></P>
<P><FONT face=Tahoma>This mechanism allows for many things such as simple range checking and easy conversions between code point an surrogate pair (it is a simple algorithmic macro to do the conversion when/if it is ever needed).</FONT></P>
<P><FONT face=Tahoma>When combined with the way that scripts are assigned in blocks, it is easy to notice things like the following (not a complete list, just a sample!):</FONT></P>
<UL>
<LI><FONT face="Courier New">U+d800 <FONT face=Tahoma>-- contains </FONT><A href="http://www.fileformat.info/info/unicode/block/aegean_numbers/index.htm"><FONT face=Tahoma>Aegean Numbers</FONT></A><FONT face=Tahoma>, </FONT><A href="http://www.fileformat.info/info/unicode/block/linear_b_syllabary/index.htm"><FONT face=Tahoma>Linear B Syllabary</FONT></A><FONT face=Tahoma>, </FONT><A href="http://www.fileformat.info/info/unicode/block/linear_b_ideograms/index.htm"><FONT face=Tahoma>Linear B Ideograms</FONT></A><FONT face=Tahoma>, </FONT><A href="http://www.fileformat.info/info/unicode/block/ancient_greek_numbers/index.htm"><FONT face=Tahoma>Ancient Greek Numbers</FONT></A><FONT face=Tahoma>, </FONT><A href="http://www.fileformat.info/info/unicode/block/old_italic/index.htm"><FONT face=Tahoma>Old Italic</FONT></A><FONT face=Tahoma>, </FONT><A href="http://www.fileformat.info/info/unicode/block/gothic/index.htm"><FONT face=Tahoma>Gothic</FONT></A><FONT face=Tahoma>, </FONT><A href="http://www.fileformat.info/info/unicode/block/ugaritic/index.htm"><FONT face=Tahoma>Ugaritic</FONT></A></FONT><FONT face=Tahoma>, and <A href="http://www.fileformat.info/info/unicode/block/old_persian/index.htm">Old Persian</A>.</FONT> 
<LI><FONT face="Courier New">U+d801 <FONT face=Tahoma>-- contains </FONT><A href="http://www.fileformat.info/info/unicode/block/deseret/index.htm"><FONT face=Tahoma>Deseret</FONT></A><FONT face=Tahoma>, </FONT><A href="http://www.fileformat.info/info/unicode/block/shavian/index.htm"><FONT face=Tahoma>Shavian</FONT></A><FONT face=Tahoma>, </FONT><A href="http://www.fileformat.info/info/unicode/block/osmanya/index.htm"><FONT face=Tahoma>Osmanya</FONT></A></FONT> 
<LI><FONT face="Courier New">U+d802&nbsp;<FONT face=Tahoma>--&nbsp;contains </FONT><A href="http://www.fileformat.info/info/unicode/block/cypriot_syllabary/index.htm"><FONT face=Tahoma>Cypriot</FONT></A></FONT> 
<LI><FONT face="Courier New">U+d834&nbsp;</FONT><FONT face=Tahoma>-- contains&nbsp;<A href="http://www.fileformat.info/info/unicode/block/byzantine_musical_symbols/index.htm">Byzantine Musical Symbols</A>, <A href="http://www.fileformat.info/info/unicode/block/musical_symbols/index.htm">Musical Symbols</A></FONT> 
<LI><FONT face="Courier New">U+d835&nbsp;</FONT><FONT face=Tahoma>--&nbsp;contains <A href="http://www.fileformat.info/info/unicode/block/mathematical_alphanumeric_symbols/index.htm">Math Alphanumerics</A></FONT></LI></UL>
<P><FONT face=Tahoma>So when you combine the BMP's 2<SUP>16</SUP>&nbsp;code units with the 16 planes of 64 * 1024 (which is also 2<SUP>16</SUP>&nbsp;code units!), you get 17 * 2<SUP>16</SUP>&nbsp;or 1,114,112 code units in total -- which is where that interestingly arbitrary-looking number comes from!</FONT></P>
<P><FONT face=Tahoma>Unicode's <A href="http://www.unicode.org/roadmaps/">Roadmap</A> site has a lot of information about the potential placement of future character allocations in Unicode, for those who are interested.</FONT></P>
<P><FONT face=Tahoma>And for a more reality-based set of links, if you look ahead to Windows Vista three macros have been added to the winnls.h that comes with the&nbsp;Vista SDK:</FONT></P>
<UL>
<LI><FONT face=Tahoma><A href="http://windowssdk.msdn.microsoft.com/library/en-us/Intl/nls_Is_High_Surrogate.asp">IS_HIGH_SURROGATE</A></FONT> 
<LI><FONT face=Tahoma><A href="http://windowssdk.msdn.microsoft.com/library/en-us/Intl/nls_Is_Low_Surrogate.asp">IS_LOW_SURROGATE</A></FONT> 
<LI><FONT face=Tahoma><A href="http://windowssdk.msdn.microsoft.com/library/en-us/Intl/nls_Is_Surrogate_Pair.asp">IS_SURROGATE_PAIR</A></FONT></LI></UL>
<P><FONT face=Tahoma>I would expect that the meanings are pretty self-explanatory, but if not you can look at the VSDK topics to which I linked. :-)</FONT></P>
<P><FONT face=Tahoma><EM>(On a side note, I find it very cool that the Windows Vista SDK is available right now to everyone, whether they are on the Vista beta or not. It really does help to explain features and functions!)</EM></FONT></P><FONT face=Tahoma>
<P><FONT face=Tahoma>Now in future posts I could perhaps get into other topics, like algorithmic conversion between UTF-16 and UTF-32....</FONT></P>
<P>&nbsp;</P></FONT>
<P><EM><FONT face=Tahoma color=#ff1493>This post brought to you by all of the supplementary planes of Unicode</FONT></EM></P>
<hr/><p><a id="473566" href="#473566">#</a> <strong>Gabe</strong> on Saturday, September 24, 2005 7:56 AM:</p><div style="margin-left: 1em">OK, so now I'm only a little confused.<br><br>Why can't I use the term 'Surrogate Character' to refer to a character which is encoded as a surrogate pair?<br><br>Why didn't they use the high range of available surrogate code points for the high-surrogates and the low range for the low-surrogates? Are they intentionally trying to confuse us?<br><br>Why did they have to use the term 'Basic Multilingual Plane' (giving us the ambiguous BMP acronym) instead of perhaps General Multilingual Plane or Basic Polylingual Plane?</div>
<p><a id="473574" href="#473574">#</a> <strong>Michael S. Kaplan</strong> on Saturday, September 24, 2005 9:28 AM:</p><div style="margin-left: 1em">Hi Gabe -- <br><br>For the first question, see <a rel="nofollow" target="_new" href="http://archives.miloush.net/michkap/archive/2005/07/27/444101.html">http://blogs.msdn.com/michkap/archive/2005/07/27/444101.aspx</a><br><br>For the second, see <a rel="nofollow" target="_new" href="http://archives.miloush.net/michkap/archive/2005/07/31/445850.html">http://blogs.msdn.com/michkap/archive/2005/07/31/445850.aspx</a><br><br>For the third, it is not ambiguous to Unicode people. :-)</div>
<p><a id="473693" href="#473693">#</a> <strong>Simon Montagu</strong> on Sunday, September 25, 2005 3:27 AM:</p><div style="margin-left: 1em">Thank you for casting so much light on a murky area. This post is so good it seems churlish to go pointing out typos, but the last 3 lines of the table of supplementary characters should be:<br><br># U+dbff U+dffd -&gt; U+10fffd<br># U+dbff U+dffe -&gt; U+10fffe<br># U+dbff U+dfff -&gt; U+10ffff</div>
<p><a id="473694" href="#473694">#</a> <strong>Michael S. Kaplan</strong> on Sunday, September 25, 2005 3:30 AM:</p><div style="margin-left: 1em">Not at all churlish, Simon -- and now fixed.... :-)</div>
<p><a id="474040" href="#474040">#</a> <strong>Maurits</strong> on Monday, September 26, 2005 1:29 PM:</p><div style="margin-left: 1em">Stupid question time...<br><br>1) OK, so this whole &quot;surrogate code point&quot; thing is UTF-16's way of encoding supplementary codepoints &gt; U+FFFF?  And this is one of the &quot;private use&quot; ranges, so there's no way to know the desired character properties of code points in this range?<br><br>2) IS_SURROGATE_PAIR(wcH, wcL) == IS_HIGH_SURROGATE(wcH) &amp;&amp; IS_LOW_SURROGATE(wcL)<br><br>3) Why did Microsoft standardize on UTF-16 for the .NET framework? Wouldn't it be more space-efficient to standardize on UTF-8 for Western European locales, and UTF-16 for East Asian locales?  Or would that cause interop problems for network communications across locale boundaries?  Even given the relative ease of switching between UTF-8 and UTF-16 on the fly?  <br><br>4) It's kind of strange that 32 bits isn't enough.  So UTF-32 really isn't a &quot;flat map&quot; to the Unicode code point system, because of U+10XXXX... Guess we need a UTF-33 encoding? ;)</div>
<p><a id="474047" href="#474047">#</a> <strong>Maurits</strong> on Monday, September 26, 2005 1:47 PM:</p><div style="margin-left: 1em">Oh, I see... I was confusing U+10000 with U+100000<br><br>There are seventeen planes (0x0 through 0x10) and only 0xf and 0x10 are specifically private-use.  0x0 is the basic plane but there are well-established characters in other planes, for example OLD ITALIC LETTER A:<br><a rel="nofollow" target="_new" href="http://www.fileformat.info/info/unicode/char/010300/index.htm">http://www.fileformat.info/info/unicode/char/010300/index.htm</a><br><br>So considering the CharNext interview question:<br>The UTF-16 way of encoding this particular character is with a surrogate pair.  So, alas:<br><br>It is not sufficient to unilaterally skip all surrogate pairs (as this character, among others, would be skipped)<br><br>So the two feasible options are:<br>* to unilaterally return the first element of all surrogate pairs<br>* to come up with further logic to dictate when to return the first element, and when to skip<br><br>&quot;Unilaterally return&quot; is a pretty attractive strategy at this point. :)  This would assume that all private-use supplementary characters (in Plane F and Plane... um... &quot;G&quot;) are &quot;spacing&quot; characters, which seems a fair assumption.<br><br>And naturally, UTF-33 would not be enough... we'd need UTF-32 + 5 bits to handle the seventeen planes, to wit, UTF-37</div>
<p><a id="474068" href="#474068">#</a> <strong>Michael S. Kaplan</strong> on Monday, September 26, 2005 2:47 PM:</p><div style="margin-left: 1em">UTF-32 encoded the same info as UTF-16, but in one flat plane.</div>
<p><a id="474073" href="#474073">#</a> <strong>Maurits</strong> on Monday, September 26, 2005 2:51 PM:</p><div style="margin-left: 1em">&gt; This mechanism allows for many things such as simple range checking and easy conversions between code point an surrogate pair (it is a simple algorithmic macro to do the conversion when/if it is ever needed).<br><br>Hmmm... like this?<br><br>/* Given a surrogate pair, returns the supplementary code point */<br>#define SUPPLEMENTARY_CODE_POINT(H, L) \<br>( \<br>	/* optional checking */ \<br>	0xd800 &lt;= (H) &amp;&amp; (H) &lt; 0xdc00 &amp;&amp; \<br>	0xdc00 &lt;= (L) &amp;&amp; (L) &lt; 0xe000 ? \<br>	/* UTF16 -&gt; Unicode code point (un)encoding */ \<br>	0x10000 + ((H) - 0xd800) * 0x0400 + ((L) - 0xdc00) \<br>	/* invalid input - TODO: go &quot;boom&quot; - return null for now */ \<br>	: 0 \<br>)<br><br>/* Given a supplementary code point, returns the &quot;high&quot; surrogate pair element */<br>#define SURROGATE_PAIR_HIGH(U) \<br>( \<br>	/* optional checking */ \<br>	0x10000 &lt;= (U) &amp;&amp; (U) &lt; 0x110000 ? \<br>	/* Unicode code point -&gt; UTF16 encoding */ \<br>	/* Note in this case | does not work for + */ \<br>	((((U) - 0x10000) &gt;&gt; 0xa) + 0xd800) \<br>	/* invalid input - TODO: go &quot;boom&quot; - return null for now */ \<br>	: 0 \<br>)<br><br>/* Given a supplementary code point, returns the &quot;low&quot; surrogate pair element */<br>#define SURROGATE_PAIR_LOW(U) \<br>( \<br>	/* optional checking */ \<br>	0x10000 &lt;= (U) &amp;&amp; (U) &lt; 0x110000 ? \<br>	/* Unicode code point -&gt; UTF16 encoding */ \<br>	/* Note in this case | does not work for + */ \<br>	(((U) - 0x10000) &amp; 0x03ff) + 0xdc00 \<br>	/* invalid input - TODO: go &quot;boom&quot; - return null for now */ \<br>	: 0 \<br>)<br><br>/* Given a supplementary code point, returns the high and low surrogate code pair as an unsigned int */<br>#define SURROGATE_PAIR(U) \<br>( \<br>	(unsigned int)SURROGATE_PAIR_HIGH(U) &lt;&lt; 0x10 | SURROGATE_PAIR_LOW(U) \<br>)<br></div>
<p><a id="474076" href="#474076">#</a> <strong>Michael S. Kaplan</strong> on Monday, September 26, 2005 2:54 PM:</p><div style="margin-left: 1em">I would not tend to go boom -- easier to just return the original value if the return was not available....</div>
<p><a id="474095" href="#474095">#</a> <strong>Maurits</strong> on Monday, September 26, 2005 3:28 PM:</p><div style="margin-left: 1em">&gt;UTF-32 encoded the same info as UTF-16, but in one flat plane.<br><br>I should really think before I post.<br><br>Ah... one plane is 0000-FFFF - sixteen bits<br>Seventeen planes - need five bits to determine the plane...<br><br>That's only 21 bits.  So UTF-32 is fine with supplementary planes.<br><br>In fact, the first eleven bits of every UTF-32 code point are always zero... so we're only using one 2**12'th of the address space, even with all the reserved planes and whatnot...<br><br>Ah, room to breathe :)</div>
<p><a id="474139" href="#474139">#</a> <strong>Michael S. Kaplan</strong> on Monday, September 26, 2005 5:08 PM:</p><div style="margin-left: 1em">Hey, no worries. There are some people who do not even think after they post, let alone before. So you are still one up on many of them.</div>
<hr/><p><em>referenced by</em></p><div style="margin-left: 1em"><p>2011/12/12 <a href="http://archives.miloush.net/michkap/archive/2011/12/12/10246749.html">SharePoint and CJK Extensions A, B, C, D, and even E?</a></p><p>2008/11/13 <a href="http://archives.miloush.net/michkap/archive/2008/11/13/9065138.html">No need to throw out the baby with the streamwriter; they probably could have just put in a replacement</a></p><p>2007/10/23 <a href="http://archives.miloush.net/michkap/archive/2007/10/23/5623838.html">If you would wait till I *FINISHED* what I was trying to say, you punk... (aka Premature validation)</a></p><p>2007/10/23 <a href="http://archives.miloush.net/michkap/archive/2007/10/23/5617352.html">If working above U+FFFF is a problem n your program, then so is the basic stuff, too</a></p><p>2007/08/03 <a href="http://archives.miloush.net/michkap/archive/2007/08/03/4217350.html">What is SORT_INVARIANT_MATH for?</a></p><p>2007/03/04 <a href="http://archives.miloush.net/michkap/archive/2007/03/04/1806219.html">String Indexing?</a></p><p>2007/02/28 <a href="http://archives.miloush.net/michkap/archive/2007/02/28/1772891.html">What do they mean when they say 'GB18030 Characters' ?</a></p><p>2006/12/05 <a href="http://archives.miloush.net/michkap/archive/2006/12/05/1212917.html">Validation of Unicode text is growing up</a></p><p>2006/09/21 <a href="http://archives.miloush.net/michkap/archive/2006/09/21/764291.html">Aim higher if you are trying to hit Plane 2!</a></p><p>2006/01/05 <a href="http://archives.miloush.net/michkap/archive/2006/01/05/509100.html">A script, by any other name</a></p></div><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2005/09/25/473632.html" title="Every character has a story #15: CAPITAL SHARP S (not encoded)">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2005/09/23/473486.html" title="The Microsoft Company Meeting">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2005-09">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2005-09-24">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2005/09/24/472543.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:41 GMT -->
</html>