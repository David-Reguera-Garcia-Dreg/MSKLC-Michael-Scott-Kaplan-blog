<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2005/09/13/463962.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:41 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>Extending collation support in SQL Server and Jet, Part 0 (HISTORY)</title></head><body>
<h1>Extending collation support in SQL Server and Jet, Part 0 (HISTORY)</h1>
<p><em>by Michael S. Kaplan, published on 2005/09/13 03:31 -04:00, original URI: http://blogs.msdn.com/b/michkap/archive/2005/09/13/463962.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostNew -->
<P><FONT face=Tahoma>It was some time back in late 90s.</FONT></P>
<P><FONT face=Tahoma>Folks on the Microsoft Jet [red] team were really worried about the Jet reliance on the OS collation functions for CJK sorts, since they would give different results across several&nbsp;of the different supported versions of Windows.</FONT></P>
<P><FONT face=Tahoma>To solve this problem, a Program Manager on the Microsoft Jet [red] team </FONT><FONT face=Tahoma>staged a raid on the collation data used by Windows. The data was used to create a solution that would give consistent results across all platforms. It would fold together all of the collations that gave identical results (thus no need for separate entries for both Norwegian <STRONG>and</STRONG> Danish, or for Swedish <STRONG>and</STRONG> Finnish, etc.). The project code name was known as Unicorn, and it first shipped in Access 2000 as a dll named MSWSTR10.DLL.</FONT></P>
<P><FONT face=Tahoma>The folks in SQL Server, who were facing the same problem, took the Jet [Red] Unicorn solution and in SQL Server 2000 shipped with something they called SQLSORT.DLL.</FONT></P>
<P><FONT face=Tahoma>In the fancy tradition of the Jet [red] API, the exports for both of these DLLs had their names stripped. And both versions of the solution made their way out into the world, in <A href="http://support.microsoft.com/dllhelp/default.aspx?l=55&amp;fid=76118">Office 2000</A>&nbsp;and <A href="http://support.microsoft.com/dllhelp/default.aspx?l=55&amp;fid=62079">SQL Server 2000</A>.</FONT></P>
<P><FONT face=Tahoma>The problem? Well,&nbsp;the solution had many problems.</FONT></P>
<P><FONT face=Tahoma>First of all, when I said that the PM staged a raid, I was not in any way exagerating the point. It was done without our knowledge. I know that because he did it just after Windows 2000 Beta 1 and before Windows 2000 Beta 2. It was during that weird period just after then SDE Julie Bennett had once again tried to fix the Turkic 'I' problem and just before she was forced to take the fix back out due to backcompat breaks. And it was also just after all of the DEFAULT TABLE work for Indic and other languages was added but just before most of the necessary EXCEPTION and COMPRESSION data was added for those languages. But since we were not told about the fact the information was being borrowed, we could not warn&nbsp;them to pick up the update to the data that would make the proper results available.</FONT></P>
<P><FONT face=Tahoma>The kicker (for me)&nbsp;was some words in one of the specs:</FONT></P>
<P class=MsoNormal style="MARGIN: 6pt 0in 0pt 0.5in"><FONT size=2>Because high speed of the underlying sorting functions is essential to the efficient operation of Database products, the Windows NT code was substantially optimized when it was ported.<SPAN style="mso-spacerun: yes">&nbsp; </SPAN>For most cases the MSWSTR10.DLL functions are about 50% faster than the Windows NT equivalent functions, but for some languages such as Thai the speed improvement is much, much higher.</FONT></P>
<P><FONT face=Tahoma>I am sure that folks who wanted a 50-300% speed improvement in languages that use compressions (which is where most of the optimization was done) would have appreciated having the issue communicated back to the team that provided the code and the data. However, when you swipe a wallet you probably don't warn the victim that their fly was open.... :-)</FONT></P>
<P><FONT face=Tahoma>In other words, the whole project can probably serve as a textbook example of why teams need to work together,&nbsp;in collaboration with each other. Because if they do not, then in the end everyone suffers....</FONT></P>
<P><FONT face=Tahoma>Well, FWIW, that situation has since been long fixed on the SQL Server side -- we now do work in collboration with folks to provide proper solutions, and in part because of that cooperative spirit SQL Server 2005 will ship with many updated collations based on the Windows Server 2003 data (including the proper support for all of those languages that were missed the first around in Windows&nbsp;2000).</FONT></P>
<P><FONT face=Tahoma>Now it does not help with (for example) all of the new ELK language support that has been added (as discussed <a href="http://archives.miloush.net/michkap/archive/2005/01/26/360685.html">here</A> and <a href="http://archives.miloush.net/michkap/archive/2005/08/09/449405.html">here</A>) -- none of it that is in Yukon (more on that in a second).</FONT></P>
<P><FONT face=Tahoma>For the Jet side things are not as good as that, since there is no Jet [Red] update (even Access 2003 still ships with Jet 4.0, just like Access 2000 and 2002 did) to pick up fixes to those problems. So Access/Jet basically has those older tables, missing support for at least 40 languages as of those two ELK releases.</FONT></P>
<P><FONT face=Tahoma>(ASIDE: I do keep calling it Jet [Red] to distingish it from the Jet [Blue] engine that actually still does call our collation functions and never went in for that snapshot stuff -- they ship with the OS and need to support every language the OS does. And I promise that <a href="http://archives.miloush.net/michkap/archive/2005/04/17/409062.html">if Brett Shirley ever starts&nbsp;blogging</A>&nbsp;that I will be reading it!)</FONT></P>
<P><FONT face=Tahoma>In the meantime,&nbsp;people have noticed this problem. We claim that Hindi has been supported since Windows 2000, but a Hindi speaker tries to use Access or SQL Server and sees that there is no good collation support for it. Or they get excited about the Quechua or Mapudungun or Maltese support we added in ELKs but again neither Access or SQL Server seems to show that such support exists. And there is no way to look at the upcoming language list for Longhorn and the new locales being added and not get downright depressed about this whole issue, and the fact that as we get more agile in Windows we are starting to make these other products look worse thereby.</FONT></P>
<P><FONT face=Tahoma>Anyway, I have had several talk to me lately, since these new ELK languages have been coming out and since even Vista Beta 1 has an impressive list of languages added (at the recent <A href="http://www.global-conference.com/iuc28/biosabstracts/a305.html">Internationalization and Unicode Conference</A>, Ning Jin-Grisaffi and Kieran Snyder,&nbsp; including lots of detail on the Tibetan, Mongolian, Uighur, and Yi support!). They want to know how to get support for these languages in either Jet or SQL Server (or both), when running on Vista.</FONT></P>
<P><FONT face=Tahoma>Now most of the above was written over the last few months as I worked to provide the answer to that question -- which was going to be that there was no answer, unfortunately. Sorry, go complain to those products, it is their mess.</FONT></P>
<P><FONT face=Tahoma><STRONG>However, I then figured out a solution (well, several possible solutions) that would actually be able to provide assistance in tehese scenarios</STRONG>. And thus this post series (<STRONG>Extending collation support in SQL Server and Jet</STRONG>) was born. You can consider this post to be -- as the title indicates -- Part 0, the historical&nbsp;aspects. As I am sure you can imagine, since I am promising solutions (and particularly considering how bleakly the historical picture has been painted)&nbsp;there is nowhere to go but up.... and the going back up part is going to be a <EM>lot</EM> of fun.</FONT></P>
<P><FONT face=Tahoma>So stay tuned, and if you care about being able to extend the language support of these database products then stay tuned and prepare to have your socks knocked off!</FONT></P>
<P><FONT face=Tahoma></FONT>&nbsp;</P>
<P><FONT face=Tahoma color=#ff0000><EM>This post brought to you by</EM> "ख" <EM>(<A href="http://www.fileformat.info/info/unicode/char/0916/index.htm">U+0916</A>, a.k.a. DEVANAGARI LETTER KHA)</EM></FONT></P>
<hr/><p><a id="464587" href="#464587">#</a> <strong>Nick Lamb</strong> on 13 Sep 2005 5:47 AM:</p><div style="margin-left: 1em">This comment brought to you by &quot;ᕣ&quot; (U+1563, a.k.a. CANADIAN SYLLABICS N-CREE THII) which wants to remind readers everywhere that just because it says the right thing on a link doesn't mean the author actually set the destination of the link correctly.</div>
<p><a id="464694" href="#464694">#</a> <strong>Michael S. Kaplan</strong> on 13 Sep 2005 9:34 AM:</p><div style="margin-left: 1em">Hi Nick -- okay, okay -- it is fixed now. :-)</div>
<p><a id="497769" href="#497769">#</a> <strong>Yuhong Bao</strong> on 29 Nov 2005 1:14 AM:</p><div style="margin-left: 1em">Read this:<br><br><a rel="nofollow" target="_new" href="http://blogs.msdn.com/access/archive/2005/10/13/480870.aspx">http://blogs.msdn.com/access/archive/2005/10/13/480870.aspx</a></div>
<p><a id="497853" href="#497853">#</a> <strong>Michael S. Kaplan</strong> on 29 Nov 2005 9:14 AM:</p><div style="margin-left: 1em">Uh oh, that post does not mention any language support updates for collation in Access 12. :-(</div>
<p><a id="497908" href="#497908">#</a> <strong>Yuhong Bao</strong> on 29 Nov 2005 11:42 AM:</p><div style="margin-left: 1em">I'm posting this link because I want to tell you the Access team has forked the Jet 4.0 engine and modified it for Access 12 so you can complain to the Access team.</div>
<p><a id="497937" href="#497937">#</a> <strong>Michael S. Kaplan</strong> on 29 Nov 2005 12:23 PM:</p><div style="margin-left: 1em">Aha, yes -- of course the collation code/data is probably not well known to them. An uphill battle, to say the least.... :-(</div>
<p><a id="5896652" href="#5896652">#</a> <strong>Yuhong Bao</strong> on 4 Nov 2007 8:26 PM:</p><div style="margin-left: 1em"><p>BTW, what is the status of this issue in Access 2007.</p></div>
<p><a id="5896658" href="#5896658">#</a> <strong>Yuhong Bao</strong> on 4 Nov 2007 8:27 PM:</p><div style="margin-left: 1em"><p>BTW, doing this is like taking a CVS snapshot of a library, and linking it to your program.</p></div>
<hr/><p><em>referenced by</em></p><div style="margin-left: 1em"><p>2007/11/06 <a href="http://archives.miloush.net/michkap/archive/2007/11/06/5936141.html">The more you understand, the more cynical you may become</a></p><p>2007/10/08 <a href="http://archives.miloush.net/michkap/archive/2007/10/08/5270854.html">A&P of Sort Keys, part 12 (aka Han sorts first!)</a></p><p>2007/05/01 <a href="http://archives.miloush.net/michkap/archive/2007/05/01/2367135.html">Not everyone does the right thing for Romanian</a></p><p>2006/08/26 <a href="http://archives.miloush.net/michkap/archive/2006/08/26/712848.html">The myth of cross-product compatibility</a></p><p>2005/10/21 <a href="http://archives.miloush.net/michkap/archive/2005/10/21/480898.html">Extending collation support in SQL Server and Jet, Part 4 (What about Jet?)</a></p><p>2005/10/09 <a href="http://archives.miloush.net/michkap/archive/2005/10/09/478705.html">Extending collation support in SQL Server and Jet, Part 3 (THAT CLASS)</a></p><p>2005/09/25 <a href="http://archives.miloush.net/michkap/archive/2005/09/25/473686.html">Extending collation support in SQL Server and Jet, Part 2.1 (is this on?)</a></p><p>2005/09/18 <a href="http://archives.miloush.net/michkap/archive/2005/09/18/470869.html">Extending collation support in SQL Server and Jet, Part 2 (generating sort keys)</a></p><p>2005/09/14 <a href="http://archives.miloush.net/michkap/archive/2005/09/14/464780.html">Extending collation support in SQL Server and Jet, Part 1 (the broad strokes)</a></p></div><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2005/09/13/464393.html" title="Confusion about HttpRequest.UserLanguages">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2005/09/13/463943.html" title="One more thing about some of those CJK fonts....">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2005-09">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2005-09-13">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2005/09/13/463962.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:41 GMT -->
</html>