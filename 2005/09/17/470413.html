<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2005/09/17/470413.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:41 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>Is Excel CSV misusing NLS functionality?</title></head><body>
<h1>Is Excel CSV misusing NLS functionality?</h1>
<p><em>by Michael S. Kaplan, published on 2005/09/17 08:27 -07:00, original URI: http://blogs.msdn.com/michkap/archive/2005/09/17/470413.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostOld -->
<P><FONT face=Tahoma>In the&nbsp; newsgroups, Yi Zhang asked:</FONT></P>
<BLOCKQUOTE dir=ltr style="MARGIN-RIGHT: 0px">
<P><EM><FONT size=2>Hi all</FONT></EM></P>
<P><EM><FONT size=2>I've encountered the following situation in my work: a customer of my&nbsp;company reported that he can't read a file created in German user locale&nbsp;correctly from a English user locale. This is because German locale uses&nbsp;',' as the decimal symbol while English uses '.' I tried to experiment with .csv files in Microsoft excel, and it seems&nbsp;that excel will always use current user locale to parse the .csv files,&nbsp;which could end up with incorrect result if the .csv file is created in a&nbsp;different user locale. So this seems to suggest that user should be&nbsp;responsible for setting the correct user locale before he tries to open a&nbsp;file. But this might be too much for the user. Is there a better way to do&nbsp;this? Or user should always be responsible for setting the correct user&nbsp;locale?</FONT></EM></P>
<P><EM><FONT size=2>Thanks in advance</FONT></EM></P>
<P><FONT face=Tahoma><EM><FONT face="Times New Roman" size=2>Yi Zhang</FONT></EM></P></BLOCKQUOTE></FONT>
<P><FONT face=Tahoma>I had vaguely remembered people mentioning something like this before, but I had always been using the Access wizard since it does a better job here.</FONT></P>
<P><FONT face=Tahoma>Anyway, I decided to look in Excel's help to see if it could provide any assistance. Here is what I&nbsp;found in the Excel 2003 help:</FONT></P>
<BLOCKQUOTE dir=ltr style="MARGIN-RIGHT: 0px">
<P><EM>You can change the separator character used in both delimited text files and comma separated values (CSV) text files.</EM></P>
<P><STRONG><EM>Change the delimiter in a delimited text file</EM></STRONG></P>
<BLOCKQUOTE dir=ltr style="MARGIN-RIGHT: 0px">
<P><EM>For a delimited text file, you can change the delimiter from a Tab character to another character in the second page of the Text Import Wizard. From the same wizard page, you can also change the way consecutive delimiters, such as consecutive quotes, are handled.</EM></P></BLOCKQUOTE>
<P><STRONG><EM>Change the separator in a CSV text file</EM></STRONG></P>
<BLOCKQUOTE dir=ltr style="MARGIN-RIGHT: 0px">
<OL>
<LI><EM>Click the Windows Start menu.</EM> 
<LI><EM>Click Control Panel.</EM> 
<LI><EM>Open the Regional and Language Options dialog box.</EM> 
<LI><EM>Click the Regional Options Tab.</EM> 
<LI><EM>Click Customize.</EM> 
<LI><EM>Type a new separator in the List separator box.</EM> 
<LI><EM>Click OK twice.</EM></LI></OL>
<P><EM>Note&nbsp; After you change the list separator character for your machine, all applications will use the new character. You can change the character back to the original character by using the same procedure.</EM></P></BLOCKQUOTE></BLOCKQUOTE>
<P><FONT face=Tahoma>Hmmmm. Well, I guess this is not quite as bad as instructions for drivers that actually show a picture of the "This driver is not signed..." dialog as part of the instructions to install their driver, but it is about the same order of magnitude. Also it is a little obnoxious to instruct people to change the settings that will affect all applications so that an individual file that may have been sent by someone else with different settings can be imported....</FONT></P>
<P><FONT face=Tahoma>I guess it is why I prefer the Access import text wizard, which lets you specify&nbsp;a different separator (after trying to initially guess at the one to use by looking at the actual file!)</FONT></P>
<P><FONT face=Tahoma>Irregardless, Mihai responded to the post where I put the info from help:</FONT></P>
<BLOCKQUOTE dir=ltr style="MARGIN-RIGHT: 0px">
<P><EM><FONT size=2>Sorry MichKa, but this is really bad. It is not your fault, I know, it is Excel (or the Excel team)!</FONT></EM></P>
<P><EM><FONT size=2>The help teaches one to mess-up the settings for all application because Excel does not understand some basic concepts:</FONT></EM></P>
<P><EM><FONT size=2>- The 10 years old bullet in Nadine Kano's book "All language editions can read one another's documents"</FONT></EM></P>
<P><EM><FONT size=2>- CSV (Comma Separated Values), means COMMA separated, not "separated by the locale-dependent list separator"</FONT></EM></P>
<P><EM><FONT size=2>=================</FONT></EM></P>
<P><EM><FONT size=2>Yi Zhang: my advice would be to try some formats other than CSV. I have done some preliminary tests, and Excel 2003 seem to work ok with XML, Tab delimited text, and Unicode Text (which is also tab delimited). I would vote with XML or Unicode Text (using Unicode, so you will have no problems with code pages and lost characters).</FONT></EM></P></BLOCKQUOTE>
<P><FONT face=Tahoma>I admit that Mihai has a point here -- one only has but to read&nbsp;the name. But short of that (and to retain backward compatibility), I could live with a configurable setting, so that one can change the behavior for the one import without affecting everything else the user runs. And ideally something that will look at the data and make an intelligent guess would be a good thing....</FONT></P>
<P><FONT face=Tahoma>The thread ended with some input from Louis Solomon:</FONT></P>
<BLOCKQUOTE dir=ltr style="MARGIN-RIGHT: 0px">
<P><EM><FONT size=2>try open office ...</FONT></EM></P></BLOCKQUOTE>
<P><FONT face=Tahoma>Now Louis included no information on what Open&nbsp;Office does to make this situation different, for better or worse. So I honestly cannot say what the purpose of&nbsp;his three word response&nbsp;was. I decided to search for his name connected to Open Office in newgroups to see if he had perhaps said more about it somewhere else. But the only one I found was:</FONT></P>
<BLOCKQUOTE dir=ltr style="MARGIN-RIGHT: 0px">
<P><EM><FONT size=2><STRONG><FONT style="BACKGROUND-COLOR: #ffff66">Louis Solomon</FONT></STRONG> [SteelBytes] wrote: <BR>&gt; The only thing that I can see so far that stops me switching to OpenOffice <BR>&gt; (from MS Office), is lack of English UK (Australian in particular) support. </FONT></EM></P></BLOCKQUOTE>
<P><FONT face=Tahoma>Not entirely relevant, but it makes for an interesting ounterpoint if he is not using the product (he may be now, but if so he has not been posting on it much under that name)</FONT></P>
<P><FONT face=Tahoma>Anyway, does anyone know if the recommendation can be salvaged? Does Open Office have a particular feature in this area that is easier and less involved than just changing the file extension to .TXT from .CSV?</FONT></P>
<hr/><p><a id="470565" href="#470565">#</a> <strong>Alex</strong> on Saturday, September 17, 2005 2:46 PM:</p><div style="margin-left: 1em">What if you, in excel, select file - Open, choose  &quot;All Files&quot; as file type and pick that csv file.<br><br>For me it opened up the wizard.<br><br></div>
<p><a id="470571" href="#470571">#</a> <strong>Stephane</strong> on Saturday, September 17, 2005 3:03 PM:</p><div style="margin-left: 1em"><br>In OpenOffice 2.0 beta 2 (don't know about earlier versions), when you save a spreadsheet as CSV, you can choose the delimiter. That's not what Excel does. (there is also a bug in Excel, the UI keeps telling you that it is saving the csv with the semi-colon as a separator, although it's really using the user locale).<br><br><br></div>
<p><a id="470593" href="#470593">#</a> <strong>Mihai</strong> on Saturday, September 17, 2005 3:10 PM:</p><div style="margin-left: 1em">Some configuration somewhere would probably make some users happy. I would be happy :-)<br><br>In the same spirit, I would be happy to have Notepad asking be if I want BOM in UTF-8 files :-)</div>
<p><a id="470675" href="#470675">#</a> <strong>CornedBee</strong> on Saturday, September 17, 2005 4:29 PM:</p><div style="margin-left: 1em">&gt; In OpenOffice 2.0 beta 2 (don't know about earlier versions), when you save a spreadsheet as CSV, you can choose the delimiter.<br><br>OOo 1.1.4 does the same.<br>It also brings up a wizard on import, just like I remember Excel doing, so I don't know what's the fuss about. (But then, it's been a long time since I used Excel.)<br><br>And what's that about OOo not supporting en_UK? Have been using a UK dictionary for the longest time without problems, and haven't noticed any other locale problems either - although admittedly, I'm not British, so I might not notice.<br>You might have to explicitely download the UK dictionary.</div>
<p><a id="470681" href="#470681">#</a> <strong>Ruben</strong> on Saturday, September 17, 2005 5:01 PM:</p><div style="margin-left: 1em">It's not just Excel, it's Word as well that has this obnoxious behavioor. For instance, in Word you can put equation field codes, like {EQ \f(1,2)} which gives you 1/2 but with the one above the 2. Also works with things like roots {EQ \r(3,x)}, sums {EQ \i\su(n=1,5,n)}.<br><br>Cool stuf, and it honours your font settings, unlike the equation editor, and doesn't blow up the document size with all that embedded OLE junk.<br><br>BUT, guess what happens on European locales? It just shows the text &quot;Error!&quot; No explanation, just &quot;Error!&quot; No workaround either (except the nuke your regional settings stuff).<br><br>And when you try to make running heads based on the headings in your text? Pretty standard practice you'd think. Except for Microsoft: opening the document in another language version of Word (not another locale, mind you, just another UI language), all standard styles are renamed, erm localized, and the running heads display &quot;Error, style not defined&quot;. No other workaround than not using built-in styles, or installing a different language version for Word. <br><br>So you need an English version of XP, a French version of Word, and Dutch regional settings, just to read a silly document from the Walloon (Belgium) department. But a Dutch version of Word with US regional settings for a document from your sysadmin.<br><br>Our company happens to have more than one language version of Office across offices, so this happens constantly.<br><br>These things really gives me the warm and fuzzies. But I'm sure as hell not going pay $$$ just to be allowed to file a bug report. Heck, who is?<br><br>So, in conclusion, I don't think you're getting through to the Office team just yet, Michael. Nifty toolbars are more important, I guess. The world's loss really. Damn Americans. ;-)</div>
<p><a id="470707" href="#470707">#</a> <strong>Matthew W. Jackson</strong> on Saturday, September 17, 2005 7:38 PM:</p><div style="margin-left: 1em">I assume the suggestion to use OpenOffice is in regard to the need for a good exchange format for spreadsheets (and not just binrary Excel files, which I hear have their own problems with portability due to NLS &quot;features&quot;).<br><br>CSV is often used as a document exchange format for simple spreadsheets, but it's really not very good because the &quot;spec&quot; is way too loose.  I suppose a CSV &quot;version 2&quot; that required UTF-8 and had very specific rules on delimeters and escaping would help, but only if all competing programs supported it without much hassle.  Still, it still wouldn't be good enough, since you cannot specify header cells and data types (not to mention no formatting).<br><br>Both the XML-based format of OpenOffice and the upcoming XML-based formats of Microsoft Office are good solutions to the problem.  Unfortunately, it remains to be seen how long it will take before A) the next version of Office is released and B) the service packs for Office 2000/XP/2003 are released to support the new XML forma.  So if you need your excel spreadsheets in a form that can be easily read/written by external tools, OpenOffice is a very attractive prospect at the moment.  It certainly beats CSV or Excel ActiveX Automation.</div>
<p><a id="471034" href="#471034">#</a> <strong>Ben Bryant</strong> on Sunday, September 18, 2005 11:22 PM:</p><div style="margin-left: 1em">But CSV means you enclose in double quotes if the value contains a comma. If the data is not broken, I don't understand why people are discussing the delimiter. The issue is simply an issue that has nothing to do with the file format and everything to do with the way a number is stored as a string (whether it is XML,CSV or any text format). In this case the file should contain some sign of what locale it was generated in, or else needs to use a specific convention for storing numeric values as strings.</div>
<p><a id="471304" href="#471304">#</a> <strong>Centaur</strong> on Monday, September 19, 2005 12:16 PM:</p><div style="margin-left: 1em">Oh, those really are pet peeves of mine.<br><br>Excel CSV export uses regional list separator and decimal separator, instead of comma and decimal point, defeating the purpose of export. Here, Excel definitely abuses NLS. CSV files are meant to be parsed and imported, not read directly by humans.<br><br>Another thing that bothers me is that Excel’s function names are translated in localized versions. In Russian Excel, AVERAGE is called СРЗНАЧ, which is wrong on three points. First, it is counter-intuitive for everyone who has used the original version (but then again, localized menu commands are counter-intuitive for me, too). Second, it causes novice users to internalize the translated names, which will cause them pain when they move to another localization. Third, I suppose it is a lot of effort for Excel developers to enable reading files created by a differently localized version.</div>
<p><a id="471308" href="#471308">#</a> <strong>Ben Bryant</strong> on Monday, September 19, 2005 12:24 PM:</p><div style="margin-left: 1em">Michael, I don't know how I can say this strongly enough (may be I was not clear in my previous comment). This entire article or yours and all of the comments miss the point, misguided by the original Yi Zhang posting you quoted. Yi Zhang wrote of trouble reading &quot;a file created in German user locale correctly from a English user locale&quot; and then associated the problem with the delimiter. However, it has NOTHING TO DO WITH THE DELIMITER! The problem is the fact that when the number is represented in a string format, the decimal may be either a period or a comma depending on locale. Some comments suggested other formats such as XML, but XML WOULD NOT CHANGE THE PROBLEM! You need to speak to the issue of reading a text number and converting back to a binary number type, otherwise you are compounding this person's problem by going knee deep in the wrong direction. The right questions to answer are these:<br>1. On export to CSV file in a locale with a comma decimal point Excel puts numeric values containing decimals in quotes, right? i.e. so the CSV format is not broken.<br>2. On import, will Excel properly handle numbers written with a different decimal point character than the one in the current locale? I assume not.<br>3. On import, in general does Excel autodetect numbers using the current locale and give the corresponding fields a numeric type?<br>4. On import, what are the solutions or hooks for intercepting the process of converting those numbers from strings?<br>5. Or is the only solution a custom import facility that generates the Excel document using OLE or something.<br>These answers would provide a service to Yi Zhang, otherwise you have only compounded his problem.</div>
<p><a id="471322" href="#471322">#</a> <strong>Mihai</strong> on Monday, September 19, 2005 12:40 PM:</p><div style="margin-left: 1em">Ben Bryant--is not only about the decimal separator, is also about the value separator. The comma is replaced by semicolon in some locales.<br>Example: saving [1][2] from French you get 1;2, then you read on English and get [1;2] ([] = cell)<br><br>And is not only about deciding what is the decimal separator, but also about the meaning.<br>Examples:<br> what is this: 123,456? Is it [123][456]? Is it 123.456 (with comma as decimal separator)?<br> What is this: 123;456,789 ? Is it [123][456.789] or is it [123;456][789]?<br><br></div>
<p><a id="471354" href="#471354">#</a> <strong>Michael S. Kaplan</strong> on Monday, September 19, 2005 1:26 PM:</p><div style="margin-left: 1em">Ben,<br><br>I think you are missing the point that others are making here, which is that CSV is not &quot;comma separated values&quot; but &quot;regional options separator separated values&quot;.<br><br>No one is talking about embedded separators as literals.</div>
<p><a id="471456" href="#471456">#</a> <strong>Ben Bryant</strong> on Monday, September 19, 2005 4:09 PM:</p><div style="margin-left: 1em">Thank you so much for your responses Mihai and Michael. I was not aware but now I am dumbfounded by the incredible stupidity of using an OS locale setting as a value separator in a file format. Wow! So if you change a machine's locale you can make all previously exported files unreadable on the same machine they were exported on. That redefines the concept of &quot;short-sighted design&quot; for me.</div>
<p><a id="8325282" href="#8325282">#</a> <strong>Martin Swinkels</strong> on Wednesday, March 19, 2008 5:11 AM:</p><div style="margin-left: 1em"><p>Thanks! This was of great help to me.</p></div>
<p><a id="8573154" href="#8573154">#</a> <strong>Miguel Ventura</strong> on Wednesday, June 04, 2008 7:32 AM:</p><div style="margin-left: 1em"><p>In Portuguese locale, dot is for grouping and comma for decimals. If I want to export some performance counter log into CSV or tab delimited I won't be able to open it in Excel because it won't get the format correctly. The performance counters CSV files are generated the same way, no matter the locale is...</p></div>
<hr/><p><em>referenced by</em></p><div style="margin-left: 1em"><p>2008/08/22 <a href="http://archives.miloush.net/michkap/archive/2008/08/22/8887005.html">What good is irony if it can't provide symmetry?</a></p><p>2007/08/15 <a href="http://archives.miloush.net/michkap/archive/2007/08/15/4396922.html">Excel to Led Zeppelin -- No 'in through the out door'</a></p></div><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2005/09/17/470709.html" title="A new link category for inactive blogs">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2005/09/17/469941.html" title="When is a backslash not a backslash?">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2005-09">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2005-09-17">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2005/09/17/470413.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:41 GMT -->
</html>