<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2005/09/11/463437.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:41 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>Working hard to detect code pages</title></head><body>
<h1>Working hard to detect code pages</h1>
<p><em>by Michael S. Kaplan, published on 2005/09/11 03:31 -04:00, original URI: http://blogs.msdn.com/b/michkap/archive/2005/09/11/463437.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostNew -->
<P><FONT face=Tahoma>Yesterday, <a href="http://blogs.msdn.com/buckh/">Buck Hodges</A>&nbsp;was talking about <a href="http://blogs.msdn.com/buckh/comments/463281.aspx">how TFS Version Control determines a file's encoding</A>:</FONT></P><FONT face=Tahoma>
<BLOCKQUOTE dir=ltr style="MARGIN-RIGHT: 0px">
<P><EM><FONT face="Times New Roman" size=2>TFS Version Control will automatically detect a file's encoding based upon the following.</FONT></EM></P>
<UL>
<LI><EM><FONT face="Times New Roman" size=2>First, a file with a Unicode byte order mark (BOM) is added as that particular type (UTF-8, UTF-16 big endian, UTF-16 little endian, etc.). </FONT></EM>
<LI><EM><FONT face="Times New Roman" size=2>If a file doesn't have a BOM, we check for&nbsp;an unprintable&nbsp;ASCII character in the first 1 kilobyte of the file.&nbsp; If there is no&nbsp;unprintable ASCII character&nbsp;in there, the encoding is set to the current code page being used, which is Windows-1252 on US English Windows systems. </FONT></EM>
<LI><EM><FONT face="Times New Roman" size=2>If an unprintable character&nbsp;is detected, the file is detected as being binary.&nbsp; The unprintable ASCII characters&nbsp;detected are in the range of 0 - 0x1F&nbsp;and 0x7F excluding&nbsp;0x9 (TAB),&nbsp;0xA (LF), 0xC (FF), 0xD (CR),&nbsp;and 0x1A (^Z).</FONT></EM></LI></UL>
<P><EM><FONT face="Times New Roman" size=2>The only exception to the foregoing is PDF files.&nbsp; Those are always detected as binary because they are so common and can be all text in the first 1 kilobyte with binary streams later in the file.&nbsp; The detection is based on the signature, "%PDF-",&nbsp;that always appears at the start of a PDF file.</FONT></EM></P></BLOCKQUOTE></FONT>
<P><FONT face=Tahoma>It would be so much cooler to try a bit more careful of an algorithm, such as the one that Jet/Access do in text import and link (they use MLang, as I pointed out <a href="http://archives.miloush.net/michkap/archive/2005/08/14/451626.html">here</A>). Or at least something more primitive like the one the compiler uses that <a href="http://archives.miloush.net/michkap/archive/2005/01/08/349230.html">I discussed</A> back in January -- especially since the list of unprintable characters is not including the code points that are known to be invalid in each code page (as the compiler folks are doing).</FONT></P>
<P><FONT face=Tahoma>Ah well, it is no big deal. We ought to be using Unicode anyway, so what would <EM>really</EM> make me happy is if a future version of TFS would use something like IsTextUnicode (<a href="http://archives.miloush.net/michkap/archive/2005/01/30/363308.html">imperfect as it may be</A>!) tp detect the times that it is Unicode without the BOM, perhaps supplemented by the check that Notepad uses for BOM-free UTF-8 that I mentioned in passing <a href="http://archives.miloush.net/michkap/archive/2005/01/20/357028.html">here</A>.</FONT></P>
<P><FONT color=#ff0000><FONT face=Tahoma><EM>This post is sponsored by </EM>"ï»¿"<EM>&nbsp;</EM></FONT></FONT><EM><FONT face=Tahoma color=#ff0000><A href="http://www.fileformat.info/info/unicode/char/feff/index.htm">U+feff</A></FONT></EM><EM><FONT color=#800080><FONT face=Tahoma><FONT color=#ff0000>&nbsp;(ZERO WIDTH NO-BREAK SPACE, of course)</FONT></FONT></FONT></EM></P>
<hr/><div style="margin-left: 1em"><em>no comments</em></div><hr/><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2005/09/11/463444.html" title="unicodeFFFE... is Microsoft off its rocker?">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2005/09/10/463397.html" title="You work in NLS? How many languages do you speak?">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2005-09">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2005-09-11">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2005/09/11/463437.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:41 GMT -->
</html>