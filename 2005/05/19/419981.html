<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2005/05/19/419981.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:41 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>The string is freaking empty!</title></head><body>
<h1>The string is freaking empty!</h1>
<p><em>by Michael S. Kaplan, published on 2005/05/19 08:01 -04:00, original URI: http://blogs.msdn.com/b/michkap/archive/2005/05/19/419981.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostNew -->
<P><FONT face=Tahoma>Not too long ago, we picked up a new tester (new to the area, not to testing in general) to own collation for Windows and the .NET Framework.</FONT></P>
<P><FONT face=Tahoma>Now I will readily admit that is usually news that I take as well as getting a new hair stylist, which is to say <STRONG>not well at all</STRONG><SUP><FONT size=1>1</FONT></SUP>. Because it is a hard area, and it usually takes a long time to get up to speed.</FONT></P>
<P><FONT face=Tahoma>Remember back in January when I explained why I thought <a href="http://archives.miloush.net/michkap/archive/2005/01/04/346116.html">international test is an art (and why there are few fine artists)</A>? Well, multiply that by infinity, take it to the depths of forever, and you will still barely have a glimpse of what the story is with collation testing.</FONT></P>
<P><FONT face=Tahoma>So usually getting a tester who is new to this area sucks, even if it is not a new tester. Because if&nbsp;the tester is my only defense against complete and utter suckage, then what are the odds of getting an artist right out of the gate?</FONT></P>
<P><FONT face=Tahoma>All I can say is that I should start buying lottery tickets. It turns out that Ryan Cavalcante is a freaking Rembrandt. :-)</FONT></P>
<P><FONT face=Tahoma>He listened while I explained some of the basic principles, nodded, and went back to his office. I assumed I would not hear about it for a while until he started reporting dumb issues that testers from other teams tend to report that I have to be patient about. But if that was my expectation, then Ryan disappointed, big time.</FONT></P>
<P><FONT face=Tahoma>Within days was able to report all kinds of edge cases that violated those principles. A few of these were known issues, or exceptions that people in his shoes find maybe 3-6 months later (if they ever find them -- most do not).</FONT></P>
<P><FONT face=Tahoma>But some of them were actual bugs, and good ones, too. Good in the sense of longstanding but hard to find (since no one else had yet reported them), and&nbsp;impressive. I'd have probably given him a raise if I were important enough to have any say in that sort of thing, if for no other reason than to make sure he did not lose interest and leave....</FONT></P>
<P><FONT face=Tahoma>Anyway, this post is not about one of those genuine bugs, but it is about one of those "known issues" I mentioned. </FONT></P><FONT face=Tahoma>
<P><FONT face=Tahoma>Oh yeah, the other thing Ryan tends to do? If he is really not sure whether something is a bug and it really might go other way, he tends to ask rather than just sticking in the report and getting it resolved as BY DESIGN if it is not really a bug. Since that kinda wastes everyone's time, including his. Definitely a class act.</FONT></P>
<P>I just wanted to take a moment to explain that the guy who pointed out has been able to impress me more than once over the last few months....</P>
<P>Anyway, the principle here was simple -- ideally, the results of any call to <A href="http://msdn.microsoft.com/library/en-us/winui/winui/windowsuserinterface/resources/strings/stringreference/stringfunctions/comparestring.asp">CompareStringW</A> should be the same as getting the sort keys of the two strings from <A href="http://msdn.microsoft.com/library/en-us/intl/nls_5s2v.asp">LCMapStringW</A> and comparing them.</FONT></P>
<P><FONT face=Tahoma>In this particular case, he was noting that if either of the strings is of zero length that <A href="http://msdn.microsoft.com/library/en-us/winui/winui/windowsuserinterface/resources/strings/stringreference/stringfunctions/comparestring.asp">CompareString</A> will handle them and treat them as very light strings, and <A href="http://msdn.microsoft.com/library/en-us/intl/nls_5s2v.asp">LCMapString</A> with the LCMAP_SORTKEY flag would fail with ERROR_INVALID_PARAMETER.</FONT></P>
<P><FONT face=Tahoma>The problem is that in this case, <A href="http://msdn.microsoft.com/library/en-us/intl/nls_5s2v.asp">LCMapString</A>&nbsp;is not being consistent with <A href="http://msdn.microsoft.com/library/en-us/winui/winui/windowsuserinterface/resources/strings/stringreference/stringfunctions/comparestring.asp">CompareString</A>; it is being consistent with itself! </FONT></P>
<P><FONT face=Tahoma>It almost goes without saying that&nbsp;when asking for LCMAP_UPPERCASE, LCMAP_LOWERCASE, or any of the other LCMAP_* mappings, it is reasonable to make it an error. So the sort key just ends up in the same mix. Being consistent with its neighbors just seemed like a better idea than being consistent with the function across the street. :-)</FONT></P>
<P><FONT face=Tahoma>Now I suppose the sort key for a zero-length string would be "<STRONG><FONT face="Courier New">01 01 01 01 00</FONT></STRONG>" if the call <EM>did</EM> work. It is the de facto way to represent no weight whatsoever that would be consistent with the documentation of sort keys. I suppose databases must special case this since they obviously cannot consider a zero-length string to be equal to NULL (which would fail both function calls).</FONT></P>
<P><FONT face=Tahoma>Calls to the managed method, <A href="http://msdn.microsoft.com/library/en-us/cpref/html/frlrfsystemglobalizationcompareinfoclassgetsortkeytopic.asp">CompareInfo.GetSortKey()</A>, do not suffer from that need to be consistent, though is also does not return that mythical "<STRONG><FONT face="Courier New">01 01 01 01 00</FONT></STRONG>" I might have liked -- instead it returns a zero-length byte array (it throws a <A href="http://msdn.microsoft.com/library/en-us/cpref/html/frlrfsystemargumentnullexceptionclasstopic.asp">System.ArgumentNullException</A> if you pass null to it). </FONT><FONT face=Tahoma>Ah well, sometimes you can't win 'em all.</FONT></P>
<P><FONT face=Tahoma>Now there are other cool testers in this group, I'll talk about them some other time. But people who do the right thing with collation tend to get good billing....</FONT></P>
<P><FONT face=Tahoma></FONT>&nbsp;</P>
<P><FONT face=Tahoma size=1><EM>1 - Autumn, the woman who used to cut my hair, has retired after getting married. Which is really awful considering what a hard time I have finding someone who cuts my hair in a way I like.</EM></FONT></P>
<P><FONT face=Tahoma></FONT>&nbsp;</P>
<P><FONT face=Tahoma><EM><FONT color=#ff0000>This post brought to you by <A href="http://www.fileformat.info/info/unicode/char/0000/index.htm">U+0000</A>, a.k.a. NULL)<BR><FONT size=1>A character that often gets the last word in any string of characters.</FONT></FONT></EM></FONT></P>
<hr/><p><a id="420096" href="#420096">#</a> <strong>Ben Bryant</strong> on 19 May 2005 11:31 AM:</p><div style="margin-left: 1em">What a great testimony to the difficulty and the art of the tester. Thanks for writing this.</div>
<p><a id="420152" href="#420152">#</a> <strong>Michael S. Kaplan</strong> on 19 May 2005 1:32 PM:</p><div style="margin-left: 1em">My pleasure, Ben! I have a very healthy respect for good testing, especially in an area that is as complex as this one. :-)</div>
<p><a id="420287" href="#420287">#</a> <strong>Brian</strong> on 19 May 2005 8:56 PM:</p><div style="margin-left: 1em">Only tangentially relevent, but I couldn't let it pass:<br><br>&lt;i&gt;I suppose databases must special case this since they obviously cannot consider a zero-length string to be equal to NULL [...]&lt;/i&gt;<br><br>This is, I believe, what Oracle does.  Clearly not because they are using your string compare functions, but never the less...<br><br>I also hate changing places to get hair cuts, and I just go to cheap barbers.</div>
<hr/><p><em>referenced by</em></p><div style="margin-left: 1em"><p>2007/09/10 <a href="http://archives.miloush.net/michkap/archive/2007/09/10/4847780.html">A&P of Sort Keys, part 0 (aka The empty string sorts the same in every language)</a></p><p>2006/01/15 <a href="http://archives.miloush.net/michkap/archive/2006/01/15/512928.html">Falling over the edge of a conceptual collation cliff</a></p><p>2006/01/12 <a href="http://archives.miloush.net/michkap/archive/2006/01/12/511884.html">The creation of sort keys does not always make sense</a></p></div><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2005/05/19/420145.html" title="What it means to be in the default MOBILE install">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2005/05/18/419117.html" title="Typing in random Unicode code points">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2005-05">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2005-05-19">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2005/05/19/419981.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:41 GMT -->
</html>