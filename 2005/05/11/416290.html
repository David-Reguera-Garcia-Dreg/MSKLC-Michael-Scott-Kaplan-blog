<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2005/05/11/416290.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:41 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>Achieving case insensitivity</title></head><body>
<h1>Achieving case insensitivity</h1>
<p><em>by Michael S. Kaplan, published on 2005/05/11 02:01 -04:00, original URI: http://blogs.msdn.com/b/michkap/archive/2005/05/11/416290.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostNew -->
<FONT face=Tahoma>
<P><A href="http://www.thedatafarm.com/blog/default.aspx">Julia Lerman</A> said just a few hours ago that <A href="http://www.thedatafarm.com/blog/PermaLink.aspx?guid=281acf7d-b621-4973-8c15-b0b9677d91b2">she is a SQL Server luddite</A>.</P>
<P>I think that is not really true. I've read her blog, and I know people who have heard her speak in public. I plan to see her speak soon, in Orlando, because of that!</P>
<P>But when I read one part of her post:</P>
<BLOCKQUOTE dir=ltr>
<P><FONT size=2><EM>Today I was trying to do a query that was case sensitive. I guess in all the years I have used SQL, I have never needed a case sensitive search. So I didn't know that I had to have my field as a varchar so that I could cast it to varbinary in order to do the comparison.&nbsp; </EM></FONT></P></BLOCKQUOTE>
<P>I had to say something about the topic. :-)</P>
<P><EM><FONT color=#ff0000 size=2>(This post contains several topics I will be covering in my TechEd 2005 talks in Orlando and Amsterdam -- <FONT size=1>lets hope TechEdBloggers picks it up, they missed </FONT></FONT><FONT color=#ff0000 size=1><a href="http://archives.miloush.net/michkap/archive/2005/05/06/415199.html">this</A></FONT><FONT color=#ff0000 size=2><a href="http://archives.miloush.net/michkap/archive/2005/05/06/415199.html"><FONT size=1> other</FONT></A><FONT size=1> one!</FONT>)</FONT></EM></P>
<P>Now the easiest way to do a case sensitive sort on a column is to use a case-sensitive collation, like with this query:</P>
<BLOCKQUOTE dir=ltr>
<P><STRONG><FONT face="Courier New" size=4>SELECT&nbsp;*&nbsp;FROM Customers<BR>ORDER BY&nbsp;TeritoryCode COLLATE Latin1_General_CS_AS</FONT></STRONG></P></BLOCKQUOTE>
<P>or something similar. You are now instantly case sensitive for that ordering. </P>
<P>You can also&nbsp;specify a&nbsp;collation to use in comparisons rather than just ordering, like with this query:</P>
<BLOCKQUOTE dir=ltr>
<P><FONT face="Courier New" size=4><STRONG>SELECT&nbsp;* FROM Customers<BR>WHERE&nbsp;Code1 = Code2 COLLATE Latin1_General_CS_AI</STRONG></FONT></P></BLOCKQUOTE>
<P>Now you will want to read up at <A id=_ctl0__ctl0__ctl0__ctl0_BlogSearcher__ctl0_SearchPostList__ctl0_EntryItems__ctl0_PostTitle href="http://archives.miloush.net/michkap/archive/2005/03/11/394359.html"><STRONG>When good SQL queries have trouble....</STRONG></A>&nbsp;and&nbsp;<A id=_ctl0__ctl0__ctl0__ctl0_BlogSearcher__ctl0_SearchPostList__ctl0_EntryItems__ctl2_PostTitle HREF="http://archives.miloush.net/michkap/archive/2005/05/06/415199.html"><FONT color=#0000ff><STRONG>Making SQL Server index usage a bit more deterministic</STRONG></FONT></A> to avoid any performance problems with doing these types of things, but otherwise it is the best way to get case sensitivity.</P>
<P>Note that you can even use a binary collation there to make it even more sensitive to differences between characters, if you need to do that. But note that binary will often make things that really are identical (as far as G-d and Unicode would see it) look like they are different. So Binary may not be the way to go. YMMV....</P>
<P>&nbsp;</P>
<P><FONT color=#ff0000><EM>This post brought to you by</EM> "â‚­" <EM>(<A href="http://www.fileformat.info/info/unicode/char/20ad/index.htm">U+20ad</A>, a.k.a. KIP SIGN)</EM></FONT></P></FONT>
<hr/><p><a id="416307" href="#416307">#</a> <strong>Dean Harding</strong> on 11 May 2005 12:54 AM:</p><div style="margin-left: 1em">I would also imagine that a case-insentive collation would be much faster that casting your column to a VARBINARY!  Especially if you use your indexed computed column trick...<br><br>By the way, I was going to ask you whether you could have used an indexed view for your 'alternate collation' trick, but apparently you can't create indexs on views that use the COLLATE clause.  At least, when I tried it, SQL Server gave me the warning &quot;The optimizer cannot use the index because the select list of the view contains a non-aggregate expression.&quot;  I'm not sure if I'm just doing something wrong, if it's actually not supported.  Here's the T-SQL I was trying:<br><br>CREATE TABLE tbl<br>   (c NVARCHAR COLLATE Latin1_General_CI_AS)<br><br>CREATE VIEW view_jap<br>WITH SCHEMABINDING<br>AS<br>SELECT<br>  [c] COLLATE Japanese_CI_AS AS [c_jap]<br>FROM<br>  dbo.tbl<br><br>CREATE UNIQUE CLUSTERED INDEX<br>IX_view_jap<br>ON view_jap (c_jap)<br><br>Do you know what's going on there? :)</div>
<p><a id="416315" href="#416315">#</a> <strong>Michael S. Kaplan</strong> on 11 May 2005 1:12 AM:</p><div style="margin-left: 1em">Ah yes, it will not work in a view -- that whole trouble with the engine not being able to do the whole thing deterministically. But you can do it in the table like at <a rel="nofollow" target="_new" href="http://archives.miloush.net/michkap/archive/2005/05/06/415199.html">http://blogs.msdn.com/michkap/archive/2005/05/06/415199.aspx</a> (the place I meant to link to here, I will change it now) and then use THAT column in a view....</div>
<p><a id="416320" href="#416320">#</a> <strong>Dean Harding</strong> on 11 May 2005 1:38 AM:</p><div style="margin-left: 1em">Yeah, I was just wondering if you could it all in a view, which would stop you having lots of columns with the same data but different sorting in the one table.  I guess if you do that, you can also just create a view for each and only select the column with the collation you care about.<br><br>Do you know if it's fixed in SQL Server 2005?  I mean, collation isn't exactly non-deterministic, so it *should* work as far as I can see.</div>
<p><a id="416321" href="#416321">#</a> <strong>Michael S. Kaplan</strong> on 11 May 2005 1:48 AM:</p><div style="margin-left: 1em">It is something I would have to test out, but offhand I would guess that the problem is still there (though they fixed the problem that required you to select the specific column with the index on it, which is much of the battle!).<br><br>It is on my list of things to try, fwiw....</div>
<p><a id="416395" href="#416395">#</a> <strong>Julie</strong> on 11 May 2005 7:27 AM:</p><div style="margin-left: 1em">See , now you have just proved my point! :-) I looked and looked and the CAST example was all I could find. I will modify my sproc and also my post to point to this better way of achieving this! Thanks.</div>
<p><a id="416417" href="#416417">#</a> <strong>Michael S. Kaplan</strong> on 11 May 2005 8:19 AM:</p><div style="margin-left: 1em">My pleasure -- and glad I could help!<br><br>One of the things I like best about what I do is that it is often complementary to other skills. So I have the chance to work with people whose work impresses me at the same time that I can do something helpful, even when I am not an expert in their area of expertise. <br><br>If nothing else it helps me look much more impressive than I actually am....</div>
<p><a id="416458" href="#416458">#</a> <strong>Julie</strong> on 11 May 2005 10:36 AM:</p><div style="margin-left: 1em">oh and I just realized that you said something about seeing me speak [I guess that would be hearing me speak, or seeing me present :-)] in Orlando? Not if you mean TechEd. I'm flattered that you would even make that presumption. I have some BOFs but I am definitely not a TechEd presenter!</div>
<p><a id="416487" href="#416487">#</a> <strong>Michael S. Kaplan</strong> on 11 May 2005 11:28 AM:</p><div style="margin-left: 1em">I could just go to a BoF if there is one that I would actually be an appropriate &quot;bird&quot; for. :-)<br><br>Or I'll have to try to make it to Vermont some day, then. Though it has been many years since I have been to the NE, and even more since anywhere past Connecticut...</div>
<hr/><p><em>referenced by</em></p><div style="margin-left: 1em"><p>2005/05/15 <a href="http://archives.miloush.net/michkap/archive/2005/05/15/417601.html">Not all SQL Server collations are created equal</a></p><p>2005/05/11 <a href="http://archives.miloush.net/michkap/archive/2005/05/11/416293.html">Case/kana/accent/width sensitive SQL Server, for testing</a></p></div><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2005/05/11/416293.html" title="Case/kana/accent/width sensitive SQL Server, for testing">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2005/05/10/416215.html" title="Dr. International is blogging!">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2005-05">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2005-05-11">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2005/05/11/416290.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:41 GMT -->
</html>