<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2005/05/29/422980.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:41 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>Pass the string, please</title></head><body>
<h1>Pass the string, please</h1>
<p><em>by Michael S. Kaplan, published on 2005/05/29 02:01 -04:00, original URI: http://blogs.msdn.com/b/michkap/archive/2005/05/29/422980.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostNew -->
<P><FONT face=Tahoma>A little over a month ago, I was talking about how <a href="http://archives.miloush.net/michkap/archive/2005/04/23/411074.html">SetLocaleInfo really stinks</A>. Buried in my tirade was the germ of a question that people have asked in the past -- why is there no setting analogue to the LOCALE_RETURN_NUMBER flag used by functions like <A href="http://msdn.microsoft.com/library/en-us/intl/nls_34rz.asp">GetLocaleInfo</A>, a sort of LOCALE_SPECIFY_NUMBER flag for the numeric fields? They are all small integers, so there is a simple enough method and datatype for such a flag to use.</FONT></P>
<P><FONT face=Tahoma>Of course that is kind of syntactic sugar for <A href="http://msdn.microsoft.com/library/en-us/intl/nls_7w1b.asp">SetLocaleInfo</A>. The functions where the problem looks worse for us are <A href="http://msdn.microsoft.com/library/en-us/intl/nls_0rec.asp">GetCurrencyFormat</A> and <A href="http://msdn.microsoft.com/library/en-us/intl/nls_8a0k.asp">GetNumberFormat</A>. They both have the following text for their <EM>lpValue</EM> parameters:</FONT></P><FONT face=Tahoma></FONT>
<BLOCKQUOTE dir=ltr>
<BLOCKQUOTE dir=ltr>
<P><FONT face=Tahoma><EM>lpValue</EM> <BR><STRONG>[in]</STRONG> Pointer to a null-terminated string containing the number string to format. <BR><BR>This string can contain only the following characters: </FONT></P>
<UL>
<LI><FONT face=Tahoma>Characters '0' through '9'. </FONT></LI>
<LI><FONT face=Tahoma>One decimal point (dot) if the number is a floating-point value. </FONT></LI>
<LI><FONT face=Tahoma>A minus sign in the first character position if the number is a negative value. </FONT></LI></UL>
<P><FONT face=Tahoma>All other characters are invalid. The function returns an error if the string pointed to by lpValue deviates from these rules. </FONT></P></BLOCKQUOTE></BLOCKQUOTE>
<P><FONT face=Tahoma>So not only is there no way to pass an actual number to these functions (you must pass a string), but you also have to use a simple string that is not even vaguely internationally wise. It is not even a good US string, since you would have to pass long numbers without grouping separators, something that is very un-natural. Yuck!</FONT></P>
<P><FONT face=Tahoma>But if you think about it, this does make sense. Would you want a function that would accept input one moment and then potentially fail with that same input moments later after a change to settings? Not to mention the performance impact of having to insert complex parsing logic into the function based on those settings, giving developers a very difficult to debug problem in the most common cases.</FONT></P>
<P><FONT face=Tahoma>Of course one could expect that the function could use the same format as is expected in the locale passed in, but if the developer was able to format a string with that locale's settings, she would not need the function, right?</FONT></P>
<P><FONT face=Tahoma>Now the fact that there is no LOCALE_SPECIFY_NUMBER type flag to pass is a bit stranger since it's not like this function gives the benefits of passing a string, right?</FONT></P>
<P><FONT face=Tahoma>But before you agree with my strawman question, consider for a moment what datatype you would use.</FONT></P>
<P><FONT face=Tahoma>Both functions will accept outrageously large numbers, much larger than any common C-style type that is available under Windows. And both will accept fractional values that are 100% precise -- way more precise than any floating point type that is available. You can start imagining complex schemes with different flags for different types of numbers, I suppose. And all that work and the functions would become hideously complex for customers to call and for us to maintain, all to provide less functionality than the current simple string allows!</FONT></P>
<P><FONT face=Tahoma>Sometimes the simple answers are the best ones. If you ask me, both <A href="http://msdn.microsoft.com/library/en-us/intl/nls_0rec.asp">GetCurrencyFormat</A> and <A href="http://msdn.microsoft.com/library/en-us/intl/nls_8a0k.asp">GetNumberFormat</A>&nbsp;fall in that category, and on the whole I am happy with how these funcions work....</FONT></P>
<P><FONT face=Tahoma></FONT>&nbsp;</P>
<P><FONT face=Tahoma><FONT color=#ff0000><EM>This post brought to you by</EM> "Z"<EM> (<A href="http://www.fileformat.info/info/unicode/char/005a/index.htm">U+005a</A>, LATIN CAPITAL LETTER Z)<BR><FONT size=1>(All of the other letters were still asleep, and when they were saying Zzzzzzz, the Z woke up, thinking someone was calling her name!)</FONT></EM></FONT></FONT></P>
<hr/><p><a id="423067" href="#423067">#</a> <strong>Mihai</strong> on 29 May 2005 5:56 PM:</p><div style="margin-left: 1em">There is a slightly different problem I have with the two functions.<br>I cannot change only parts of the formatting. It is all or nothing.<br><br>Example: I would like to format number with GetNumberFormat but to get 4 decimals, not 2 (or 3, or whatever the locale wants). Because sometimes is really important.<br>Or I want to format the currency properly, but not change the currency symbol (or, even nicer, having it localized).<br><br>What I would like: GetCurrencyFormat( &quot;12345.67&quot; ) <br>en_US =&gt; $12,345.67<br>ro_RO =&gt; 12.345,67 dolari americani<br>      or 12.345,67 USD<br><br>What I do now to solve the problem: I fill in the NUMBERFMT &amp; CURRENCYFMT structures using GetLocaleInfo. But some of the structure fields are not compatible with the GetLocaleInfo result (ex. NUMBERFMT::Grouping), so I have to do some parsing. Ouch!<br><br>Would be nice to have APIs to fill in the structure for me. Then I can change the one or two fields I need and use it (well, I have this already, but wouldn't this be useful for others?)</div>
<p><a id="423073" href="#423073">#</a> <strong>Michael S. Kaplan</strong> on 29 May 2005 6:23 PM:</p><div style="margin-left: 1em">Ah, these are interesting things to consider for the future -- I will pass the ideas along.<br><br>Thanks! :-)</div>
<p><a id="425496" href="#425496">#</a> <strong>John Bates</strong> on 5 Jun 2005 7:40 PM:</p><div style="margin-left: 1em">I second Mihai's suggestion.<br><br>One of my web forms (an invoice) has a column of currency amounts with a total at the bottom. The customer prefers to have the currency symbol only on the total.<br><br>So I should really be using GetCurrencyFormat for all the numbers, but have to use GetNumberFormat to get a string without the currency symbol.<br><br>So my question is: Does the number format for any locale differ from its currency format, with the exception of the symbol?<br><br>Thanks, John.</div>
<hr/><p><em>referenced by</em></p><div style="margin-left: 1em"><p>2008/03/10 <a href="http://archives.miloush.net/michkap/archive/2008/03/10/8120567.html">What's wrong with one of GetNumberFormat's callers? And what's wrong with GetNumberFormat?</a></p><p>2005/06/21 <a href="http://archives.miloush.net/michkap/archive/2005/06/21/431005.html">Number format and currency format are not always the same</a></p></div><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2005/05/29/423032.html" title="Doing something with TechEd slides">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2005/05/28/422971.html" title="What was I saying?">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2005-05">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2005-05-29">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2005/05/29/422980.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:41 GMT -->
</html>