<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2005/05/20/420317.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:41 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>You may want to rethink your choice of UTF, #1 (if the size matters)</title></head><body>
<h1>You may want to rethink your choice of UTF, #1 (if the size matters)</h1>
<p><em>by Michael S. Kaplan, published on 2005/05/20 02:01 -04:00, original URI: http://blogs.msdn.com/b/michkap/archive/2005/05/20/420317.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostNew -->
<P><FONT face=Tahoma>The decision of which UTF (Unicode Transformation Format) to use might be driven by many different factors, so I will be doing a few different posts on this topic, looking at the factors individually.</FONT></P>
<P><FONT face=Tahoma>This&nbsp;first post will talk about the size considerations.</FONT></P>
<P><FONT face=Tahoma><EM>(I am assuming you will always want to use Unicode of some form, but I will include the code page answer as an initial strawman each time.)</EM></FONT></P>
<P><FONT face=Tahoma>Now obviously if everything you want to represent will fit into a legacy code page, then that will always be the smallest answer (one or at most two bytes for all ACPs). There are other good reasons to not like this idea, which will be covered further in a future post in this series.</FONT></P>
<P><FONT face=Tahoma>The first Unicode Transformation format I will talk About is UTF-32.&nbsp;It has the advantage of always being a single fixed size for every code point in Unicode from <A href="http://www.fileformat.info/info/unicode/char/0000/index.htm">U+0000</A> to <A href="http://www.fileformat.info/info/unicode/char/10ffff/index.htm">U+10ffff</A>. The cost is that for a standard that never uses more than 21 bits of information, every single character uses 32 bits. There will be other good scenarios to consider UTF-32 that I will cover on other days, but today when the conversation is purely on the merits of size, UTF-32 will often not be the choice.</FONT></P>
<P><FONT face=Tahoma>The second one I will talk about is UTF-16. It has the advantage of usually being a single fixed size while also managing to take up less space per character (16 bits) than the full 21 bits needed for all codepoints. If supplementary characters are used then they will need 32 bits (for the surrogate pair, each code point of which takes up 16 bits), so while it is no worse than UTF-32 it is no better for an extensive amount of these supplementary characters.</FONT></P>
<P><FONT face=Tahoma>The third one I will talk about is UTF-8. It is&nbsp;a true multibyte form, which takes up space as follows:</FONT></P>
<UL>
<LI><FONT face="Courier New"><STRONG>&nbsp;<A href="http://www.fileformat.info/info/unicode/char/0000/index.htm">U+0000</A> -&nbsp;&nbsp; <A href="http://www.fileformat.info/info/unicode/char/007f/index.htm">U+007f</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1 byte</STRONG></FONT> 
<LI><FONT face="Courier New"><STRONG>&nbsp;<A href="http://www.fileformat.info/info/unicode/char/0080/index.htm">U+0080</A> -&nbsp;&nbsp; <A href="http://www.fileformat.info/info/unicode/char/07ff/index.htm">U+07ff</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2 bytes</STRONG></FONT> 
<LI><STRONG><FONT face="Courier New">&nbsp;<A href="http://www.fileformat.info/info/unicode/char/0800/index.htm">U+0800</A> -&nbsp;&nbsp; <A href="http://www.fileformat.info/info/unicode/char/ffff/index.htm">U+ffff</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 3 bytes</FONT></STRONG> 
<LI><STRONG><FONT face="Courier New"><A href="http://www.fileformat.info/info/unicode/char/10000/index.htm">U+10000</A> - <A href="http://www.fileformat.info/info/unicode/char/10ffff/index.htm">U+10ffff</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 4 bytes</FONT></STRONG></LI></UL>
<P><FONT face=Tahoma>If you look at the <A href="http://www.fileformat.info/info/unicode/block/index.htm">Unicode Blocks</A>, you can see what each of these ranges will cover, and how expensive different languages will be from a size perspective. </FONT></P>
<P><FONT face=Tahoma>Clearly, most East Asian, Southeast Asian, South Asian, and Historic&nbsp;scripts will be more costly from a size perspective, being at best 3 bytes and at worst 4 bytes in size. Again there are times that size may be an issue, but there is never a time that the varying size across so many different ranges is an advantage. There are times that UTF-8 will be best, but beyond ASCII that will never be based purely on size.</FONT></P>
<P><FONT face=Tahoma>The last form I will talk about is CESU-8, a form defined for people who wanted binary compatibility with UTF-16 using all other characteristics of UTF-8. Its space is taken up as follows, ue to the fact that supplementary characters are encoded as surrogate pairs:</FONT></P><FONT face=Tahoma>
<UL>
<LI><FONT face="Courier New"><STRONG>&nbsp;<A href="http://www.fileformat.info/info/unicode/char/0000/index.htm">U+0000</A> -&nbsp;&nbsp; <A href="http://www.fileformat.info/info/unicode/char/007f/index.htm">U+007f</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1 byte</STRONG></FONT> 
<LI><FONT face="Courier New"><STRONG>&nbsp;<A href="http://www.fileformat.info/info/unicode/char/0080/index.htm">U+0080</A> -&nbsp;&nbsp; <A href="http://www.fileformat.info/info/unicode/char/07ff/index.htm">U+07ff</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2 bytes</STRONG></FONT> 
<LI><STRONG><FONT face="Courier New">&nbsp;<A href="http://www.fileformat.info/info/unicode/char/0800/index.htm">U+0800</A> -&nbsp;&nbsp; <A href="http://www.fileformat.info/info/unicode/char/ffff/index.htm">U+ffff</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 3 bytes</FONT></STRONG> 
<LI><STRONG><FONT face="Courier New"><A href="http://www.fileformat.info/info/unicode/char/10000/index.htm">U+10000</A> - <A href="http://www.fileformat.info/info/unicode/char/10ffff/index.htm">U+10ffff</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;6 bytes</FONT></STRONG></LI></UL></FONT>
<P><FONT face=Tahoma>This form will obviously never win any battle based on size. There may be times that it is a good choice, but none that this post will recognize -- check us out another day. :-)</FONT></P>
<P><FONT face=Tahoma>In future posts, other considerations such as platform, endian issues, string processing, compression capabilities, and more will be covered. If you could limit comments to the size issue and hold off on the other issues until the relevant post come up, it would save me having to delete comments until they are relevant and I would appreciate it. :-)</FONT></P>
<P>&nbsp;</P>
<P><FONT face=Tahoma><FONT color=#ff0000><EM>This post brought to you by</EM> "рда" <EM>(<A href="http://www.fileformat.info/info/unicode/char/0920/index.htm">U+0920</A>, a.k.a. DEVANAGARI LETTER TTHA)<BR><FONT size=1>(A character that is very sensitive about its weight and prefers to sleek 2-byte size provided by UTF-16 over the 3- and 4-byte size provided by UTF-8 and UTF-32, respectively)</FONT></EM></FONT></FONT></P>
<hr/><p><a id="420332" href="#420332">#</a> <strong>Rosyna</strong> on 20 May 2005 12:29 AM:</p><div style="margin-left: 1em">Kind of confused by your size ratings on UTF-8. Some odd Hangul characters require around 16 or so bytes to be decomposed into UTF-8.</div>
<p><a id="420343" href="#420343">#</a> <strong>Michael S. Kaplan</strong> on 20 May 2005 12:48 AM:</p><div style="margin-left: 1em">I am referring to code points only -- not characters or text elements or grapheme clusters, etc.</div>
<p><a id="420453" href="#420453">#</a> <strong>Rosyna</strong> on 20 May 2005 10:49 AM:</p><div style="margin-left: 1em">Ah, wasn't sure because you kept using the word &quot;character&quot;.<br><br>&quot;The cost is that for a standard that never uses more than 21 bits of information, every single character uses 32 bits.&quot;<br><br>And sometimes you seem to use codepoint and character almost interchangeably:<br><br>&quot;It has the advantage of usually being a single fixed size while also managing to take up less space per character (16 bits) than the full 21 bits needed for all codepoints.&quot;</div>
<p><a id="420463" href="#420463">#</a> <strong>Michael S. Kaplan</strong> on 20 May 2005 11:32 AM:</p><div style="margin-left: 1em">Yes, this post suffers from treating the two as being the same always, kind of like an API level point of view where a cch (count of characters) is really a ccp (count of code points).<br><br>Sloppy, but it kind of makes sense.... :-)</div>
<hr/><p><em>referenced by</em></p><div style="margin-left: 1em"><p>2010/11/24 <a href="http://archives.miloush.net/michkap/archive/2010/11/24/10095816.html">UTF-8 on a platform whose support is overwhelmingly, almost oppressively, UTF-16</a></p><p>2007/07/26 <a href="http://archives.miloush.net/michkap/archive/2007/07/26/4075990.html">No UTF-8 in a VARCHAR column</a></p><p>2005/05/25 <a href="http://archives.miloush.net/michkap/archive/2005/05/25/421828.html">You may want to rethink your choice of UTF, #3 (Platform?)</a></p><p>2005/05/24 <a href="http://archives.miloush.net/michkap/archive/2005/05/24/421343.html">Encoding scheme, encoding form, or other</a></p><p>2005/05/22 <a href="http://archives.miloush.net/michkap/archive/2005/05/22/420822.html">You may want to rethink your choice of UTF, #2 (Speed of operations)</a></p></div><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2005/05/20/420515.html" title="We&#39;re hiring!">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2005/05/19/420145.html" title="What it means to be in the default MOBILE install">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2005-05">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2005-05-20">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2005/05/20/420317.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:41 GMT -->
</html>