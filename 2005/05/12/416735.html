<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2005/05/12/416735.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:41 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>Thinking beyond the BMP of Unicode</title></head><body>
<h1>Thinking beyond the BMP of Unicode</h1>
<p><em>by Michael S. Kaplan, published on 2005/05/12 02:01 -04:00, original URI: http://blogs.msdn.com/b/michkap/archive/2005/05/12/416735.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostNew -->
<P><FONT face=Tahoma>A few days ago, CornedBee left a <a href="http://archives.miloush.net/michkap/archive/2005/05/10/416008.html#416147">comment</A> to my post <a href="http://archives.miloush.net/michkap/archive/2005/05/10/416008.html">Raymond's Chinese dictionary</A>:</FONT></P>
<BLOCKQUOTE dir=ltr>
<P><FONT face=Tahoma size=2><EM>&gt; by some reports over 60,000 of the over 70,000 ideographs in Unicode/GB18030 <BR><BR>Suddenly the 65000 characters in a Windows WCHAR or a VC++ wchar_t seem so little ... when will it be expanded to 32 bits? (Or is that HCHAR - for huge character?)</EM></FONT></P></BLOCKQUOTE>
<P><FONT face=Tahoma>When thinking beyond the&nbsp;BMP (Basic Multilingual Plane) of Unicode, </FONT><FONT face=Tahoma>I think Dr. International said it best back the column put up in August 2000, entitled <A href="http://www.microsoft.com/globaldev/DrIntl/columns/002/default.mspx#Q2">The real deal about surrogates</A>. </FONT></P>
<P><FONT face=Tahoma>Of course this was published before there were even officially assigned supplementary characters, though -- see the August 2002 post entitled <A href="http://www.microsoft.com/globaldev/DrIntl/columns/018/default.mspx">Windows XP and Unicode Surrogate Code Points, CJK Extensions A and B</A> for the update.</FONT></P>
<P><FONT face=Tahoma><EM><FONT size=2>(Although note that the Doctor's first column officially disagrees with my </FONT></EM><a href="http://archives.miloush.net/michkap/archive/2005/05/11/416552.html"><EM><FONT size=2>UCS-2 vs. UTF-16 (not quite Kramer vs. Kramer)</FONT></EM></A><EM><FONT size=2> post, though since they are both two people trying to (as I described in my post) trying to put words to describe something that is really outside of anything related to the standard, it is not so much a contradiction as spinning the problem two different ways. I was able to get&nbsp;supplemenary character&nbsp;script working with an MSKLC on NT 4.0 if I installed the fonts -- does that mean I can say NT 4.0 supports UTF-16? &lt;grin&gt;)</FONT></EM></FONT></P>
<P><FONT face=Tahoma>In any case, the Doctor's original post deals with the specific question about whether new data types (and presumably new APIs) will be needed:</FONT></P>
<BLOCKQUOTE>
<P><FONT face=Tahoma><FONT size=2>There are many people who are wondering why a move to UCS-4/UTF-32 (which uses 32 bits per character) is not being considered. The most common reason for people to make this suggestion is their concern that attempts to handle these extra characters via surrogates seems so much like the methods that DBCS required to support a mix of 8-bit and 16-bit characters. The need for functions such as IsDBCSLeadByte, etc. makes DBCS string handling <I>very</I> difficult, as many people can attest to. Surrogates, however, are always made up of 16-bit values, and both high and low surrogates are in specific ranges. This makes surrogates much easier to detect and it makes string handling routines <I>much</I> easier to implement. Given the heavy investment that the Windows platform and COM have in UCS-2/UTF-16, moving to UCS-4/UTF-32 would require a rearchitecture of Windows that while not as large as the move from Win16 to Win32, could certainly provide pain to programmers on the same order of magnitude. In short:</FONT></P>
<UL>
<LI><B></B><FONT size=2>&nbsp;The move to UCS-2/UTF-16 from DBCS is one that can make life easier and provide a great deal of expanded functionality. </FONT>
<LI><B></B><FONT size=2>&nbsp;The move from UCS-2/UTF-16 to UCS-4/UTF-32 can make life significantly more difficult with no significant expanded functionality.</FONT></LI></UL></BLOCKQUOTE></FONT>
<P><FONT face=Tahoma>Now note that is not the same as <EM>conversion</EM>. Conversion can be crucial both for the sake of standards that use these other encoding forms and for interoperability with other platforms with different defauts. The work to convert to and from both UTF-8 and UTF-32 is potentially interesting; the former has been around since NT 4.0 SP3, and the former is being released with the Whidbey (2.0) version of the .NET Framework (and can be seen right now in the Beta 2 release).</FONT></P>
<P><FONT face=Tahoma>It is also not the same as targetted features that use UTF-32, such as the <A href="http://msdn.microsoft.com/library/en-us/winui/winui/windowsuserinterface/userinput/keyboardinput/keyboardinputreference/keyboardinputmessages/wm_unichar.asp">WM_UNICHAR</A> notification that Murray Sargent has often spoken about at Unicode conferences. The main difference here is items that are character-based rathr than string-based.</FONT></P>
<P><FONT face=Tahoma>But nobody wants to take all of the string APIs, long plagued with needing "A" and "W" versions, and add yet another "H" version to them (to use CornedBee's nomenclature). There are enough developers in Windows to probably take us if we&nbsp;tried to claim that was a requirement, so we're probably lucky that it is not!</FONT></P>
<P><FONT face=Tahoma></FONT>&nbsp;</P>
<P><FONT face=Tahoma><FONT color=#ff0000><EM>This post brought to you by</EM> "C" <EM>(<A href="http://www.fileformat.info/info/unicode/char/0043/index.htm">U+0043</A>, a.k.a. LATIN CAPITAL LETTER C)</EM></FONT></FONT></P>
<hr/><p><a id="416852" href="#416852">#</a> <strong>James Todd</strong> on 12 May 2005 9:59 AM:</p><div style="margin-left: 1em">I just wanted to throw out this relevant MSDN link about surrogate pairs.<br><br><a rel="nofollow" target="_new" href="http://msdn.microsoft.com/library/default.asp?url=/library/en-us/intl/unicode_192r.asp">http://msdn.microsoft.com/library/default.asp?url=/library/en-us/intl/unicode_192r.asp</a><br><br>Thanks for the information, Michael!<br><br>James</div>
<p><a id="416901" href="#416901">#</a> <strong>Michael S. Kaplan</strong> on 12 May 2005 12:06 PM:</p><div style="margin-left: 1em">Hey James,<br><br>Yep, that is an interesting link, though I need to add a clarification to it about Both Windows 2000 and XP.... <br><br>Basically, anything that turns on Uniscribe will turn on the surrogate pair detection stuff.<br><br>In XP, that means either the Complex Script support or the East Asian language support sill turn this on.<br><br>For Windows 2000, any of the &quot;languages your system supports&quot; that fall under one of these two categories will give the same result -- this means Japanese, Korean, Traditional Chinese, Simplified Chinese, Thai, Vietnamese, Hebrewm Arabic, or Indic.<br><br>It all boils down to language groups, interestingly enough. (cf: <a rel="nofollow" target="_new" href="http://archives.miloush.net/michkap/archive/2005/02/16/374450.html">http://blogs.msdn.com/michkap/archive/2005/02/16/374450.aspx</a> ).</div>
<p><a id="417566" href="#417566">#</a> <strong>Qflash</strong> on 15 May 2005 2:38 AM:</p><div style="margin-left: 1em">RePost:<br><a rel="nofollow" target="_new" href="http://www.yeyan.cn/SoftwareEngineering/BMPUnicode.aspx">http://www.yeyan.cn/SoftwareEngineering/BMPUnicode.aspx</a></div>
<hr/><p><em>referenced by</em></p><div style="margin-left: 1em"><p>2008/09/08 <a href="http://archives.miloush.net/michkap/archive/2008/09/08/8931641.html">UCS-2 to UTF-16, Part 1: Getting the obvious out of the way</a></p></div><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2005/05/12/416761.html" title="Why doesn&#39;t GetDateFormat take a CALID?">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2005/05/11/416717.html" title="Dealing with backcompat across many versions">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2005-05">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2005-05-12">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2005/05/12/416735.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:41 GMT -->
</html>