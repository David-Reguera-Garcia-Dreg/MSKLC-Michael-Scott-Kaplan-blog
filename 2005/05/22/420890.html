<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2005/05/22/420890.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:41 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>When will this line end? And how?</title></head><body>
<h1>When will this line end? And how?</h1>
<p><em>by Michael S. Kaplan, published on 2005/05/22 19:38 -04:00, original URI: http://blogs.msdn.com/b/michkap/archive/2005/05/22/420890.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostNew -->
<P><FONT face=Tahoma>I have talked about Chris Walker before.</FONT></P>
<P><FONT face=Tahoma>He is one of guys behind Notepad.exe for several versions, watching this uber-layer around a Win32&nbsp;EDIT control be morphed into what some consider to be the most-used plain text editor on the planet.</FONT></P>
<P><FONT face=Tahoma>Often when people complain about behavior of international text in Word or Wordpad, I ask them to try it in Notepad -- I can easily determine if the problem is an issue in Word, RichEdit, or Uniscribe in this way).</FONT></P>
<P><FONT face=Tahoma>Anyway, after the first time I had posted about Notepad, Chris had suggested a bunch of interesting topics, and this post is about one of those topics.</FONT></P>
<P><FONT face=Tahoma>How can you tell how a line ends?</FONT></P>
<P><FONT face=Tahoma>Easy on Windows -- just put in a CARRIAGE RETURN&nbsp;followed by a&nbsp;LINEFEED (U+000d U+000a).</FONT></P>
<P><FONT face=Tahoma>Easy in a completely incompatible way on UNIX platforms -- just a LINEFEED (U+000a) and nothing else (the C standard kind of does this, too, thus the rules about files opened in TEXT mode in the C Runtime).</FONT></P>
<P><FONT face=Tahoma>And also easy in a compeletly different, completely incomaptible way for some Apple system, which use the CARRIAGE RETURN (U+000d) alone (although the fact that the newer versions have a UNIX base make me wonder hether all of this is harder on an Apple now given the CR backcompat and the LF platform issue!).</FONT></P>
<P><FONT face=Tahoma>As <a href="http://blogs.msdn.com/oldnewthing/">Raymond Chen</A> discussed last year in <STRONG><a href="http://blogs.msdn.com/oldnewthing/archive/2004/03/18/91899.aspx">Why is the line terminator CR+LF?</A></STRONG>, there are a lot of people who wished that Notepad dealt with files that had only an LF, since lots of text files (such as the ones in the <A href="http://www.unicode.org/ucd/">Unicode Character Database</A>) have a .TXT filetype but Notepad cannot open them directly without assuing the whole file is on one line.</FONT></P>
<P><FONT face=Tahoma>But course it is not Notepad that is responsible for this functionality&nbsp;as much as the system EDIT control, which has its own rules about lines used by messages like&nbsp;<A href="http://msdn.microsoft.com/library/en-us/shellcc/platform/commctls/editcontrols/editcontrolreference/editcontrolmessages/em_getline.asp">EM_GETLINE</A> and <A href="http://msdn.microsoft.com/library/en-us/shellcc/platform/commctls/editcontrols/editcontrolreference/editcontrolmessages/em_getlinecount.asp">EM_GETLINECOUNT</A>. Rules that would need to undergo some pretty big changes if the fundamental plain text definition of a line delimiter on Windows platforms ever changed. It would probably have to be a new set of messages, or a mode for the control. Or people could just use WordPad and the RichEdit control, that does the right thing with different line delimiters already. With some very interesting (where interesting is defined as potentially scary!) performance concerns....</FONT></P>
<P><FONT face=Tahoma>Fixing an&nbsp;occurrence of this problem&nbsp;was actually one of the changes I was able to make in the <STRONG>Micrsoft Access Import Text Wizard</STRONG>, which had the same problem for many versions. Then Jet 4.0 came out, with the ability to not only handle the multiple line terminators (which exised before)&nbsp;but also different encodings (which was definitely a new feature). The problem for these prior versions was that the wizard was using VBA's file I/O functions to load its sample text, and VBA is limited to the default system code page and CRLF (so the wizard would either show junk, or throw an error for a single line being too big&nbsp;-- a problem described in the KB in article <A href="http://support.microsoft.com/?kbid=149946">149946</A>). It was a pleasure to fix both problems at the same time by getting away from VBA's inflexible file i/o system here. :-)</FONT><FONT face=Tahoma></P></FONT>
<hr/><p><a id="420933" href="#420933">#</a> <strong>Rosyna</strong> on 22 May 2005 10:41 PM:</p><div style="margin-left: 1em">What about The &lt;a href=&quot;<a rel="nofollow" target="_new" href="http://www.fileformat.info/info/unicode/char/0085/index.htm">new">http://www.fileformat.info/info/unicode/char/0085/index.htm&quot;&gt;new</a> line/control&lt;/a&gt; character U+0085? <br><br>FWIW, All the OS X text controls (excluding some old, very deprecated QuickDraw controls) will load text with any line ending. New lines get the line format of the file instead of the line format of the OS.</div>
<p><a id="420949" href="#420949">#</a> <strong>TheMuuj</strong> on 22 May 2005 11:36 PM:</p><div style="margin-left: 1em">Text control or not, I think notepad should go to some extra trouble to support LF instead of CR-LF.  I can't tell you how often I'm annoyed that I have to load WordPad because of a Unix text file.  And seeing as CR-LF seems redundant to me (unless you're a printer), I'd have to say that Unix is smarter here.<br><br>Now, the big question is, why is it that some pieces of software I have come across over the years have FOUR modes?  LF (Unix), CR (Mac), CR-LF (Windows), LF-CR (WTF???)</div>
<p><a id="420962" href="#420962">#</a> <strong>Michael S. Kaplan</strong> on 23 May 2005 12:36 AM:</p><div style="margin-left: 1em">Well, one never knows what a future version may bring. But of all of the possible features, CR or LF newline capabilities is not really highest on my list of features I want to see in Notepad.<br><br>My #1 wishlist item would be the option to save without a BOM, and my #2 wishlist item would be UTF-32 support (though I am fairly certain that we would have to provide the conversion capability in NLS, first, obviously!).<br><br>#3 would be files opened outside of the fileopen dialog to end up in the MRU list under Start|Documents. And so on....<br><br>I am not especially tempted to own an Apple, though I will admit that the fact that they stick Limonata in their cafeteria was a temptation to work for them! :-)</div>
<p><a id="420985" href="#420985">#</a> <strong>David Smith</strong> on 23 May 2005 2:45 AM:</p><div style="margin-left: 1em">I'm always pleased with your quality posts. Thank you.</div>
<p><a id="420996" href="#420996">#</a> <strong>Rosyna</strong> on 23 May 2005 4:39 AM:</p><div style="margin-left: 1em">I really would suggest you take a look  (directly) at how OS X handles Unicode stuffs. Not meaning to ruffle feathers or anything but many people only develop to the LCD and right now, wrt unicode, Windows is the LCD since other OS's were &quot;forced&quot; (based on sheer market saturation) to support the windows stuff along with their own.</div>
<p><a id="421011" href="#421011">#</a> <strong>Michael S. Kaplan</strong> on 23 May 2005 7:05 AM:</p><div style="margin-left: 1em">As a rule, the people who do work on product are not the same people as the ones who would do competitive research, as this would lead to the potential for taint (or appearance of taint) in ideas and plans.<br><br>But it is outrageous to consider support of Unicode on Windows to be the least common denominator, given the extensive nature of the offerings (especially the extensions involved with the work happening today).</div>
<p><a id="421060" href="#421060">#</a> <strong>Maurits [MSFT]</strong> on 23 May 2005 11:36 AM:</p><div style="margin-left: 1em">I must confess I frequently build tab-delimited files where the record delimiter is CRLF, but where individual values contain LFs as internal line breaks.  And I use Notepad to verify that the internal line breaks are really just LFs and not full CRLFs.  So I am fine with Notepad's current behavior. :)</div>
<p><a id="421083" href="#421083">#</a> <strong>Michael S. Kaplan</strong> on 23 May 2005 12:26 PM:</p><div style="margin-left: 1em">Hi Maurits,<br><br>This highlights the reason why the change must be opt-in behavior -- because it is best not punish people with expectations on the behavior. :-)</div>
<p><a id="421337" href="#421337">#</a> <strong>Serge Wautier</strong> on 24 May 2005 3:11 AM:</p><div style="margin-left: 1em">A few weeks ago, I wrote a rant about CR and LFs.<br>Michka just wrote about line terminations as well...</div>
<p><a id="422466" href="#422466">#</a> <strong>TheMuuj</strong> on 27 May 2005 2:50 AM:</p><div style="margin-left: 1em">Opt-in would be perfectly fine.  Why not add a line-break format to the Format or View menu?<br><br>Still, I must admit that Windows XP's Notepad is leaps and bounds better than previous offerings.  The lack of hotkeys in previous versions was my biggest complaint, and the line number in the status bar is great.<br><br>I still wonder what program in its right mind uses LF+CR.</div>
<p><a id="422473" href="#422473">#</a> <strong>Michael S. Kaplan</strong> on 27 May 2005 3:15 AM:</p><div style="margin-left: 1em">If it were going to happen (AFAIK it is not, at present?), I think it would likely be an option in the &quot;Save As...&quot; Save file dialog. They are already customizing the template for the encoding dropdown, so adding a dropdown for the Line Return character would be just as feasible.<br><br>Though of course that is just the UI, which is the easy part. Adding the functionality would be a special challenge given the implementation of the control. I suspect there would have to be work done in the EDIT control to add an option for multiline controls to select what to use for the line break character(s). And this would be non-trivial....</div>
<p><a id="422577" href="#422577">#</a> <strong>TheMuuj</strong> on 27 May 2005 10:26 AM:</p><div style="margin-left: 1em">Actually, saving LF instead of CR+LF is not a big deal to me.  I just want to read the files without closing Notepad, right clicking the file, choosing Open With, Wordpad.<br><br>If, after opening a Unix text file, I could choose an option to convert all LFs to CR+LFs so that I could read the thing, that would be great.  No modifications to the Edit control needed, just a find-and-replace.<br><br>Sarcasm: Does Microsoft seriously not use enough cross-platform (or, I suppose, *Nix-centered) applications that this never comes up internally?  *grin*<br><br>Notepad *used* to load a text file in Wordpad if it was too big (before the size limitation was fixed), perhaps a menu option somewhere to do this manually would also work.</div>
<p><a id="422626" href="#422626">#</a> <strong>Michael S. Kaplan</strong> on 27 May 2005 12:33 PM:</p><div style="margin-left: 1em">I would turn the question around and wonder why there are so many *nix users who are using notepad to edit their shell scripts? :-)<br><br>You have to realize that while what you need is not the full solution I hint at, that other people have different needs. And when you combine them together in a way that does not make the architectural design a nightmare, you MUST come up with solutions that are not hacks.<br><br>The support right now is in the EDIT control. If it is not then it is really not Notepad anymore, it is a new program. <br><br>But like I said, I do not even know of an effort to actually try and solve this problem....</div>
<p><a id="422690" href="#422690">#</a> <strong>TheMuuj</strong> on 27 May 2005 3:23 PM:</p><div style="margin-left: 1em">Ha!  I don't really edit *nix shell scripts.  I have been toying with the new Windows Command Shell beta, and I absolutely LOVE it, but it uses Windows line-end markers.<br><br>Anyway, this problem mostly comes up when I load a readme.txt or history.txt that comes with an Open Source program, and the file was written with a *nix text editor.<br><br>Which is odd, because the &quot;.txt&quot; extension seems superfluous in Linux, so I assume the extension is there to benefit Windows users...but if the file doesn't load properly in Windows then what's the point?<br><br>I used to have the problem all the time when editing Quake III config files, but I haven't done that in a long time.</div>
<hr/><p><em>referenced by</em></p><div style="margin-left: 1em"><p>2006/09/10 <a href="http://archives.miloush.net/michkap/archive/2006/09/10/748785.html">I want the lines to BREAK, dammit!</a></p></div><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2005/05/22/420934.html" title="Revenge of something, that&#39;s for sure">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2005/05/22/420879.html" title="For every expert...">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2005-05">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2005-05-22">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2005/05/22/420890.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:41 GMT -->
</html>