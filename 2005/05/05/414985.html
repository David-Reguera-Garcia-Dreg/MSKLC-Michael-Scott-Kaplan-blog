<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2005/05/05/414985.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:41 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>How can I use MSLU without shipping UnicoWS.dll?</title></head><body>
<h1>How can I use MSLU without shipping UnicoWS.dll?</h1>
<p><em>by Michael S. Kaplan, published on 2005/05/05 14:25 -04:00, original URI: http://blogs.msdn.com/b/michkap/archive/2005/05/05/414985.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostNew -->
<P><FONT face=Tahoma>People often look at the <A href="http://www.microsoft.com/globaldev/handson/dev/mslu_announce.mspx">Microsoft Layer for Unicode</A> (MSLU) and wonder how they could avoid shipping an extra file.</FONT></P>
<P><FONT face=Tahoma>Recently, Hans Hansen posted a message to the microsoft.public.platformsdk.mslayerforunicode, asking the question in the following way:</FONT></P>
<BLOCKQUOTE dir=ltr>
<BLOCKQUOTE dir=ltr>
<P><FONT face=Tahoma size=2><EM>Hello!<BR><BR>On </EM></FONT><A href="http://msdn.microsoft.com/msdnmag/issues/01/10/MSLU/default.aspx"><FONT face=Tahoma size=2><EM>http://msdn.microsoft.com/msdnmag/issues/01/10/MSLU/default.aspx</EM></FONT></A><FONT face=Tahoma size=2><EM> it is described how you can link MSLU into your program. But according to this page, the program will then depend on the unicows.dll file on the Windows 9x platforms. Is it possible to instead statically link wit MSLU so that this dll is not required?</EM></FONT></P>
<P><FONT face=Tahoma size=2><EM>I have been doing some googleing and there seems to be different opinions on this issue.\</EM></FONT></P>
<P><FONT face=Tahoma size=2><EM>I use Microsoft Visual Studio .NET 2003. My program is a plain C++ program and I do not use ATL or MFC.</EM></FONT></P>
<P><FONT face=Tahoma size=2><EM>Best,</EM></FONT></P>
<P><FONT face=Tahoma size=2><EM>Hans </EM></FONT></P></BLOCKQUOTE></BLOCKQUOTE>
<P><FONT face=Tahoma>Unfortunately, the answer is that this option is not available -- you have to ship the DLL if you are running on Win9x.</FONT></P>
<P><FONT face=Tahoma>The obvious question that people ask at that point is why things were designed this way. </FONT></P>
<P><FONT face=Tahoma>Although to be frank, I can never tell when people asking if it is out of genuine curiousity or if it is to try to find a flaw in the reasoning that would convince me to change the whole direction of the project and give them exactly what they want. I always assume that the answer is the (usually mature) former rather than the (usually immature) latter, although I am probably underestimating the childish nature that developers often have (I am including myself here when I talk about that, since I still <EM>feel</EM> like a developer no matter what my title is).</FONT></P>
<P><FONT face=Tahoma>Remember that the #1 performance goal was to not hurt the performance of applications running on NT-based platforms. This only makes sense since the project was being done primarily at the behest of a <a href="http://archives.miloush.net/michkap/archive/2005/02/12/371650.html">developer in the Windows Division</A> and the payment for the project was approved by a <A href="http://www.microsoft.com/presspass/exec/cjones/default.asp">Windows Vice President</A>. Shipping something that would help encourage migration off Win9x or at least to take the best possible advantage of NT-specific features is a good thing, shipping something that slows down the platform even a little is not.</FONT></P>
<P><FONT face=Tahoma>But the DLL itself does add some performance considerations. While it is itself loaded with a <a href="http://archives.miloush.net/michkap/archive/2005/01/24/359555.html">"delay load type" functionality</A>, once it is actually loaded it does not itself "delay load" all of its own dependants. Thus loading UnicoWS.dll in a process will load a bunch of DLLs. There is a hit that only happens if you load the DLL, so if its full functionality was included in a .LIB, a lot of extra work would have had to happen to make sure that performance on NT-based platforms&nbsp;was not adversely affected.</FONT></P>
<P><FONT face=Tahoma>It would also mean adding a whole bunch of code to your application binary that is simply never used on NT-based platforms. Now it would not mean adding the full size of the DLL to every project, but it would mean adding however much you are using in the way of APIs.</FONT></P>
<P><FONT face=Tahoma>Now admittedly neither of these problems is unsolvable, but I learned a long time ago that successful software projects are based on focused and targetted goals and visions. Which does not work well with the idea of trying to solve every puzzle and fix every problem even if the problems are not part of the core scenario you are trying to address. I suspect that had the focus of MSLU been as unfocused as all that, it would have either never shipped or it would have been a year later and with a lot more bloat. And it may not have even been terribly&nbsp;usable after everything was said and done.</FONT></P>
<P><FONT face=Tahoma>Which is not to say that a bit of undisciplined havoc never sneaks in (for example, think about the support for resource updating. Or the work to make sure that even those who do try to use UnicoWS.dll on NT-based platfoms will still see the calls forwarded to the OS). </FONT></P>
<P><FONT face=Tahoma>But if you keep your primary project goals in mind, then the occasional diversion will not kill you. Or the project. Or the people who are doing the triage on features. The key is to not waste too much time or effort on items that are outside the scope of the project.</FONT></P>
<P><FONT face=Tahoma>Which in this case (unfortunately) included the "never ship an extra file, even on Win9x platforms" feature....</FONT></P>
<P><FONT face=Tahoma></FONT>&nbsp;</P>
<P><FONT face=Tahoma><FONT color=#ff0000><EM>This post brought to you by</EM> "Ú‡" <EM>(<A href="http://www.fileformat.info/info/unicode/char/0687/index.htm">U+0687</A>, ARABIC LETTER TCHEHEH)</EM></FONT></FONT></P>
<hr/><p><a id="415001" href="#415001">#</a> <strong>Mattie Casper</strong> on 5 May 2005 1:09 PM:</p><div style="margin-left: 1em">(Before you hear me complain, let me state that I'm quite glad you posted on this topic and that you took the time to explain the issues to us. I'm quite appreciative of the time it takes to do something like that, so let me express my thanks.)<br><br>I was excited when I began reading this article because I expected it to contain a very solid, excellent technical reasoning for why Unicows.dll was not provided in static lib form.<br><br>Yet, the reason given is that &quot;it's outside the scope&quot; when there's really no technical reason unicows could not have been provided both in a static lib and in DLL form. In effect, it sounds like some developers have to hesitate making UNICODE transitions because they don't have the freedom to pick and choose which trade-offs they wish to make (i.e. performance vs. dependency).<br><br>For example, some of us author extremely-low-dependency executables (e.g. setup bootstrappers). Including this DLL in a side-by-side fashion for these is not a trivial matter! It can cost companies a significant amount of money to solve this problem. (&quot;Immature&quot;) We toil with this sort of thing in our multi-lingual executables and have very little recourse except to write additional bootstrappers for those bootstrappers, or forego UNICODE support when we need it.<br><br>I would truly love to see this *additional* static lib support, especially if there's no major technical reason to avoid it (and it's primarily driven by a development team's desire to stay inside an artificially created mental box). I know, as a developer, I've been guilty of this many times myself, but it makes me sad to hear that it occurs also with something so handy as your unicows library. (It also makes me sad to hear someone speak of their 'customers' as immature when they ask for new features, but I won't digress into that topic.)<br><br>Anyway, as I said earlier, I absolutely appreciate you taking time to explain this, as well as all the time you've spent on the unicows project. Yet, I really wish Microsoft would also release a static library if the technical hurdles are not more than you express in this article. Then (as with MFC and MSVCRT, etc) the developers can decide if they wish to make the relevant trade-offs between the two.<br><br>Thanks for taking the time to read my comment,<br>-Mattie<br></div>
<p><a id="415002" href="#415002">#</a> <strong>Mattie Casper</strong> on 5 May 2005 1:22 PM:</p><div style="margin-left: 1em">(Before you hear me complain, let me state that I'm quite glad you posted on this topic and that you took the time to explain the issues to us. I'm quite appreciative of the time it takes to do something like that, so let me express my thanks.)<br><br>I was excited when I began reading this article because I expected it to contain a very solid, excellent technical reasoning for why Unicows.dll was not provided in static lib form.<br><br>Yet, the reason given is that &quot;it's outside the scope&quot; when there's really no technical reason unicows could not have been provided both in a static lib and in DLL form. In effect, it sounds like some developers have to hesitate making UNICODE transitions because they don't have the freedom to pick and choose which trade-offs they wish to make (i.e. performance vs. dependency).<br><br>For example, some of us author extremely-low-dependency executables (e.g. setup bootstrappers). Including this DLL in a side-by-side fashion for these is not a trivial matter! It can cost companies a significant amount of money to solve this problem. (&quot;Immature&quot;) We toil with this sort of thing in our multi-lingual executables and have very little recourse except to write additional bootstrappers for those bootstrappers, or forego UNICODE support when we need it.<br><br>I would truly love to see this *additional* static lib support, especially if there's no major technical reason to avoid it (and it's primarily driven by a development team's desire to stay inside an artificially created mental box). I know, as a developer, I've been guilty of this many times myself, but it makes me sad to hear that it occurs also with something so handy as your unicows library. (It also makes me sad to hear someone speak of their 'customers' as immature when they ask for new features, but I won't digress into that topic.)<br><br>Anyway, as I said earlier, I absolutely appreciate you taking time to explain this, as well as all the time you've spent on the unicows project. Yet, I really wish Microsoft would also release a static library if the technical hurdles are not more than you express in this article. Then (as with MFC and MSVCRT, etc) the developers can decide if they wish to make the relevant trade-offs between the two.<br><br>Thanks for taking the time to read my comment,<br>-Mattie</div>
<p><a id="415007" href="#415007">#</a> <strong>Michael S. Kaplan</strong> on 5 May 2005 1:41 PM:</p><div style="margin-left: 1em">Hello Mattie!<br><br>Quick note -- when I said &quot;immature&quot; it was just the image of the small child asking why they could not have the treat -- i.e. hoping that the act of asking would form the dialog that would get them what they want. It does not mean that everyone who wants features is immature -- it just means that if you come to the party with nothing but your wish list than you may not be treated as nicely as if you came to the party with more (like genuine interest or knowledge or whatever).<br><br>But project scope is pretty crucial -- it helps you make the triage decisions and it helps guide where the project goes. The work to make a static lib is possible but it is a significant work item to do. In such a case where you meausre the work in man years , the need to support doing it for a library that enables platforms which are themselves going to be less supported is a rough call to make, but not too hard in the end. It simply does not make sense from a business perspective to go in that direction.<br><br>So I would hesitate to call these issues an artificial distinction. Its actually a huge work item that hangs in the balance....</div>
<p><a id="415021" href="#415021">#</a> <strong>Mattie Casper</strong> on 5 May 2005 2:00 PM:</p><div style="margin-left: 1em">Referring to it as an 'additional work item' is a different thing entirely, and certainly is a valid excuse that I understand. (I.e., we can't afford to make this happen.) If that's the primary reason then I certainly can't fault the developers for it not being created. I didn't get that as a primary factor in your post above, and I appreciate the clarification.<br><br>Yet, there truly is a need for the additional support. So, the suggestion really should be extended to PM(s) who should consider staffing the effort. I worry that they will also turn away requests for this simply because it sounds 'outside the scope' and/or they've heard/misunderstood that there are valid technical reasons not to provide such support.<br><br>Anyway, thanks for taking the time to post this and respond. I truly appreciate your comments!<br><br>Thanks again,<br>-Mattie</div>
<p><a id="415056" href="#415056">#</a> <strong>Michael S. Kaplan</strong> on 5 May 2005 3:32 PM:</p><div style="margin-left: 1em">I am of course never against forwarding feedback up the food chain, as it were. Of course these daye it turns out they read enough here that they will see it anyway. :-)<br><br>But like I said the real problem is in terms of how much longer Win9x itself will be supported, and how much it would take to allow people to avoid just shippine one more file in their redist.<br><br>When you take the full list of items that we are working on now (and which have us fully booked!), there is nothing that Thie becomes more impoartant than....</div>
<hr/><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2005/05/06/415187.html" title="Mixed feelings about the new Steve Ballmer mail">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2005/05/05/414933.html" title="Community Server issues that seem affect this blog">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2005-05">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2005-05-05">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2005/05/05/414985.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:41 GMT -->
</html>