<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2005/01/10/350450.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:42 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>Encodings in Strings are Evil Things (Part 7.1)</title></head><body>
<h1>Encodings in Strings are Evil Things (Part 7.1)</h1>
<p><em>by Michael S. Kaplan, published on 2005/01/11 01:27 -05:00, original URI: http://blogs.msdn.com/b/michkap/archive/2005/01/10/350450.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostNew -->
<P>I just read <a href="http://blogs.msdn.com/ryanmy/">Ryan</A>'s post&nbsp;<a href="http://blogs.msdn.com/ryanmy/archive/2005/01/10/350325.aspx">Encodings in Strings are Evil Things (Part 7)</A>,&nbsp;and all I do is hope that anyone who reads it will have also at the very least read <a href="http://blogs.msdn.com/ryanmy/archive/2004/10/25/247677.aspx">Part 5</A> of the series so they know that sometimes these code points do not represent whole characters, as far as the user is concerned.</P>
<P>This is hard enough to handle in the Latin script when someone may be really offended at treating "Å"&nbsp;as an "A with a funny circle on it", or "Ł" as an "L that someone stabbed", but it gets much harder to&nbsp;look at&nbsp;"ใท์" or "ஷ்ரீ" and make such judgements, especially when there are individual letters like "い" that look like maybe they ought to be two letters from a visual standpoint.</P>
<P>My biggest worry is of course the message that it sends to have such a template class while my group works so hard to explain that UTF-32 does not solve the problems of what the user thinks of as a character, which can require two or three or four or sometimes even more code points.... and that not even the <A title=StringInfo href="http://msdn.microsoft.com/library/en-us/cpref/html/frlrfsystemglobalizationstringinfoclasstopic.asp" target=_blank>StringInfo</A> class in the .NET Framework can handle the user perception of a character (since sometimes even what Unicode thinks of as separate letters are thought by users to go together to make one "character").</P>
<P>But maybe I'll get lucky and Ryan will point it out somewhere in a comment that strings like "U+0041 U+030a" or "U+0e43 U+0e17 U+0e4c" or "U+0bb7 U+0bcd U+0bb0 U+0bc0" or "U+0f60 U+0f56 U+0f60 U+0f74 U+0f60 U+0f72 U+0f60 U+0f7c" might be thought of by the user as a single "character", even if they are to some counted here as being 2, 3, 4, or 8 code points long in Swedish, Thai, Tamil, or Tibetan. :-)</P>
<hr/><p><a id="350952" href="#350952">#</a> <strong>Ryan Myers [MSFT]</strong> on 11 Jan 2005 2:11 PM:</p><div style="margin-left: 1em">Hey -- glad to see you're reading :)  Raymond Chen has pointed to you in the past as the local authority for Unicode, so I've been meaning to track you down and ask for criticism.<br><br>Yeah, the fundamental problem of code points versus grapheme clusters is constantly at the back of my mind.  (Especially when it comes to combining characters that will graphically span the previous AND following base characters.)  I've been guilty in the past of assuming that readers bother to read the entire series; perhaps I should start putting qualifiers in :P  I've always intended rmstring to be a class for someone who's aware of Unicode's mechanics.<br><br>One of the UAXes has a rough algorithm for estimating what sets of code points constitute a grapheme cluster, based on known ranges of points.  I'm debating implementing that as an alternate set of iterators, but haven't decided yet.</div>
<p><a id="350982" href="#350982">#</a> <strong>Michael Kaplan</strong> on 11 Jan 2005 2:53 PM:</p><div style="margin-left: 1em">Well, this is essentially what the <a title="StringInfo" href="http://msdn.microsoft.com/library/en-us/cpref/html/frlrfsystemglobalizationstringinfoclasstopic.asp" target="_blank">StringInfo</a> class does, but it does not always meet linguistic expectations (like for that Tamil Sri I put up there).<br><br>So it may or may not be worth it....</div>
<p><a id="351002" href="#351002">#</a> <strong>Ryan Myers [MSFT]</strong> on 11 Jan 2005 3:35 PM:</p><div style="margin-left: 1em">Hrm.  One of my planned hedges was to provide a set of predicates for std::sort that would implement various collation algorithms (starting with a functor that just called your Win32 functions with a specific locale) -- perhaps a likewise reasonable approach is to create an iterator adaptor that can advance based on locale-specific interpretations of grapheme clusters.<br><br>It's nasty, but it should work, and if push comes to shove I can always use the UAX algorithm as a default template argument.</div>
<p><a id="351014" href="#351014">#</a> <strong>Michael Kaplan</strong> on 11 Jan 2005 3:57 PM:</p><div style="margin-left: 1em">Hmmm.... interesting. Of course figuring out where the breaks would be from an API like <a title="LCMapString" href="http://msdn.microsoft.com/library/en-us/intl/nls_5s2v.asp" target="_blank">LCMapString</a> is an interesting challenge that would involve unpacking the sort keys, and there is no 100% way to do that (certainly no way that will be completely lossless and know that an &quot;ae&quot; was really an &#230;, for example.<br><br>I think it always comes back to interview questions, and I could see asking someone how they would design such an API and what would be possible (and what would not). I am sure this would make people think!<br><br>Of course getting people to understand sort keys well enough to grapple with the question moght require a four-hour interview so I guess it would not work....<br><br>However, even if that were possible it would not always match the user expectation since (for example) in Spanish &quot;ch&quot; is looked at as a unique sorting element but most Spanish-speaking people would not expect this sort element to be consider a grapheme that the cursor would skip around.</div>
<hr/><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2005/01/11/350460.html" title="Every character has a story #2: U+234a U+234e U+2351 U+2355 U+2361">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2005/01/10/349988.html" title="Building sattelite assemblies in the Visual Studio IDE...">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2005-01">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2005-01-10">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2005/01/10/350450.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:42 GMT -->
</html>