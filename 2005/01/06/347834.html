<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2005/01/06/347834.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:42 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>CP_ACP vs. GetACP</title></head><body>
<h1>CP_ACP vs. GetACP</h1>
<p><em>by Michael S. Kaplan, published on 2005/01/06 13:09 -05:00, original URI: http://blogs.msdn.com/b/michkap/archive/2005/01/06/347834.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostNew -->
<P>A few days ago, PEK asked in the newsgroups about <A title=WideCharToMultiByte href="http://msdn.microsoft.com/library/en-us/intl/unicode_2bj9.asp" target=_blank>WideCharToMultiByte</A> and <A title=MultiByteToWideChar href="http://msdn.microsoft.com/library/en-us/intl/unicode_17si.asp" target=_blank>MultiByteToWideChar</A>:</P>
<BLOCKQUOTE dir=ltr>
<P><FONT size=2>I'm a bit confused about the first parameter in MultiBytToWideChar. It<BR>is telling which code-page to use. You could use the value CP_ACP<BR>("ANSI Code page"), but what does it mean? Is it the value returned by<BR><A title=GetACP href="http://msdn.microsoft.com/library/en-us/intl/nls_21bk.asp" target=_blank>GetACP</A>() or is it code-page 1252? <BR><BR>What I want to know is that if you the same result if you call:<BR><BR>MultiByteToWideChat(CP_ACP, ...)<BR><BR>as when you call:<BR><BR>MultiByteToWideChat(GetACP(), ..)</FONT></P></BLOCKQUOTE>
<P>The answer is indeed that they will both give the same results. One is a constant that says "I do not care what the system default codepage is -- just use it" while the other asks "what is the default system codepage?".</P>
<P>The natural question to ask wny time there are to or more ways to do the same thing is which would be faster -- caching the return of GetACP() and using that, or using CP_ACP?</P>
<P>Well, on NT-based platforms, CP_ACP is <EM>slightly</EM> faster, and by slightly I mean it would take 1,000,000 iterations or more to see even the slightest difference. On 9x-based platforms, it does indeed look like the codepage value itself <EM>may</EM> be ever-so-slightly faster, but again not enough to matter. i prefer CP_ACP as the constant because it just seems easier to keep track of, to me. It should likely never matter to your code.</P>
<P><EM><FONT color=#ff0000>ADDENDUM 1:00pm -- Ok, I had a chance to look at the Win9x code, and I have changed my mind. I could easily see it making a difference; CP_ACP is going to be slower. Not by a lot, but&nbsp;its just not the smartest code in the world&nbsp;and I remain committed to supporting smart code paths.&nbsp;I also understand why the same code is not used in the NT codebase. For what its worth, MSLU was actually written using the cached code page method, based on someone's comment that this was a little faster on Win9x. Well, the comment is right and I'm glad MSLU does it this way.</FONT></EM></P>
<P>Though I can probably say for fact that using the return of <A title=GetLocaleInfo href="http://msdn.microsoft.com/library/en-us/intl/nls_34rz.asp" target=_blank>GetLocaleInfo</A> (after returning it as as string and converting to a number) with the LOCALE_IDEFAULTANSICOODEPAGE with the LCID returned from <A title=GetSystemDefaultLCID href="http://msdn.microsoft.com/library/en-us/intl/nls_85yc.asp" target=_blank>GetSystemDefaultLCID</A>, making these calls every single time. But if you have to be told that explicitly then your code is likely too slow anyway. :-)</P>
<P>Now if you are using the .NET Framework, your question is probably wondering which is faster -- using the built-in Encoding.Default, or using the Encoding.GetEncoding() method to create the Encoding object on its own. And the quick answer to that is to use Encoding.Default since it is always faster. </P>
<P>But the better answer is the one Shawn Steele (the owner of encodings and code pages) gives -- use Unicode and avoid all of the extra work here. This is so much easier there since all of the data is Unicode already....&nbsp;</P>
<P>&nbsp;</P>
<P><FONT color=#800080>This post brought to you by "<FONT size=5>ï¹Œ</FONT>" (U+fe4c , a.k.a. DOUBLE WAVY OVERLINE)</FONT></P>
<hr/><p><a id="347922" href="#347922">#</a> <strong>Jochen Kalmbach</strong> on 6 Jan 2005 1:38 PM:</p><div style="margin-left: 1em">Just a small word to UNICODE-support in .NET:<br>.NET only supports UTF-16 and not the full unicode-range... If you want to use the full unicode-range you have to use the System.Text namespace and do ugly work with surrogates...</div>
<p><a id="348050" href="#348050">#</a> <strong>Michael Kaplan</strong> on 6 Jan 2005 4:21 PM:</p><div style="margin-left: 1em">This is not really true.<br><br>Anyone who assumes that working with surrogate pairs is evil and that therefore UTF-32 is somehow better has not spent much time dealing with European languages that have many combining characters required for proper support. <br><br>The fact is that if you are using the .NET Framework you casn support ALL OF UNICODE in your code via the intrinsic System.String datatype. There is no part of Unicode that cannot be accessed in this way.<br><br>If you are interoperasing with folks who have requirements for other Unicode encoding forms or schemes then the Enoding class opens them all up for you. <br><br>But the work to deal with supplementary characters is no worse than the text element related requiements of all of Unicode.</div>
<p><a id="348337" href="#348337">#</a> <strong>Jochen Kalmbach</strong> on 7 Jan 2005 3:03 AM:</p><div style="margin-left: 1em">But the default encoding for System.String is UTF-16, or?</div>
<p><a id="348543" href="#348543">#</a> <strong>Michael Kaplan</strong> on 7 Jan 2005 8:58 AM:</p><div style="margin-left: 1em">Strings in .NET *are* UTF-16. Encoding.Default represents the default system codepage, which will not be UTF-16 but the encoding represented by CP_ACP.</div>
<hr/><p><em>referenced by</em></p><div style="margin-left: 1em"><p>2005/01/08 <a href="http://archives.miloush.net/michkap/archive/2005/01/08/349230.html">How does it detect invalid characters?</a></p></div><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2005/01/07/348944.html" title="Updating the keyboard list in the logon dialog">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2005/01/06/347536.html" title="The West Wing last night (5 January 2005)">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2005-01">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2005-01-06">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2005/01/06/347834.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:42 GMT -->
</html>