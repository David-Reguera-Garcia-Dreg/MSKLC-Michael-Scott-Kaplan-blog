<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2005/01/22/358771.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:42 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>How can Windows emulate the functionality of the ComposeKey of UNIX?</title></head><body>
<h1>How can Windows emulate the functionality of the ComposeKey of UNIX?</h1>
<p><em>by Michael S. Kaplan, published on 2005/01/22 16:46 -05:00, original URI: http://blogs.msdn.com/b/michkap/archive/2005/01/22/358771.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostNew -->
<P>Lionel Fourquaux asks:</P>
<BLOCKQUOTE dir=ltr>
<P><EM><FONT size=2>As a member of a student group that provides some help with MS products, I've been trying to create a keyboard layout that would give a (partial) answer to a common complaint from Unix users: how to get a "Compose" key in Windows. </FONT></EM></P>
<P><EM><BR><FONT size=2>First, I've to say they won't be completely satisfied, since it appears to be impossible to reproduce, at least with <A title=MSKLC href="http://www.microsoft.com/globaldev/tools/msklc.mspx" target=_blank>MSKLC</A>, the exact behavior they want. (It probably possible to do it by filtering keyboard events at a higher level, but it doesn't look as clean a solution). </FONT></EM></P></BLOCKQUOTE>
<P>First, to explain a bit about the Compose key if you have never heard of it before....</P>
<P>Looking at a definition in a description of <A href="http://www.devdaily.com/unix/man/man5/keymaps.5.shtml#COMPOSE%20DEFINITIONS">KEYMAPS</A>:</P>
<BLOCKQUOTE dir=ltr>
<P><EM><STRONG>Compose Definitions</STRONG></EM></P>
<P><FONT size=2><EM>Then there may also be compose definitions. They have syntax<BR>&nbsp;<BR>compose ’char’ ’char’ to ’char’<BR>&nbsp;<BR>and describe how two bytes are combined to form a third one (when a dead accent or compose key is used). This is used to get accented letters and the like on a standard keyboard.</EM></FONT></P></BLOCKQUOTE>
<P>At first glance they are a lot like dead keys, right?</P>
<P>Well, not exactly. After all, one does not a key to change the behavior of another key to make it act like a dead key. Thus a line in the KERNEL ACCENT TABLE that looked like "compose ’,’ ’c’ to ccedilla" would mean that typing &lt;ComposeKey&gt;&lt;,&gt;&lt;c&gt; would create &lt;ccedilla&gt;. And that just typing &lt;,&gt;&lt;c&gt; without touching the Compose key would not. Of course, with dead keys in Windows keyboards (like those you can define in MSKLC) there is no exact conditional mechanism like that.</P>
<P>Now you could fake it, though. And it would not be such a bad fake.</P>
<P>You could define your dead keys in the AltGR state such that any time you typed &lt;AltGR&gt;&lt;,&gt; followed by &lt;c&gt; you would get what you wanted. You could optionally define &lt;AltGR&gt; + &lt;c&gt; to put out that same lowercase 'c' if you wanted that same behavior when the faux-compose key was held down.</P>
<P>Of course this method is kind of expensive; you have to be willing sacrifice AltGR as a shift state (you are putting in otherwise unexpected definitions to support the Compose functionality anyway, and it would be incredibly confusing to have the AltGR perform other tasks as well. But if you turn your AltGR into&nbsp;a faux-Compose key consistently in the definition, then your keyboard layout would certainly act like it has a Compose key.</P>
<P>Note that other Unix-type functionality (loading the Compose key definitions into arbitrary keyboards) would not exist and could never really be added. You would have to look into the <A title=SetWindowsHookEx href="http://msdn.microsoft.com/library/en-us/winui/winui/windowsuserinterface/windowing/hooks/hookreference/hookfunctions/setwindowshookex.asp" target=_blank>SetWindowsHookEx</A> API with one of the keyboard hook types to try to affect keyboard behavior in such a marked way. This is of course a pretty extreme way of getting such a task done and it is worth really considering whether such a functionality is a sensible thing to have (given the differences in the overlap of letters that are needed across languages).</P>
<P>In any case, Lionel then continued:</P>
<BLOCKQUOTE dir=ltr>
<P><FONT size=2><EM>Second, it appears that MSKLC really doesn't like want I'm trying to do: it doesn't signal any clear problem, but some keys in the resulting layout do not work as they should and as they do in the test window. I've tried many variations, and I suspect that I've hit either a bug or an undocumented limitation. </EM></FONT></P></BLOCKQUOTE>
<P>Recently someone in the newsgroups reported a specific bug in an experimental&nbsp;(one could almost call it an MSKLC stress test!) keyboard with 17 different dead keys and over 300 dead key pairs defined was having some problems in two of those dead key definitions (in the VK_OEM_5 and VK_OEM_7 definitions); I will be investigating that report soon. Is this a similar type of problem?</P>
<hr/><p><a id="358795" href="#358795">#</a> <strong>Peter da Silva</strong> on 22 Jan 2005 4:42 PM:</p><div style="margin-left: 1em">The Compose key provides a lot more than just accents. For example, compose-1-2 gives you [1/2] and compose-3-4 gives you [3/4] and compose-dash-L gives you [pound] and compose-slash-c gives you [cent]. It's a two-key-mnemonic for all kinds of characters not on the standard keyboard, and is much easier to remember than the equivalent mechanisms in MacOS and Windows.<br><br>When we needed this functionality for our customers a few years ago we bought an application called &quot;Kovach Accent Composer&quot;. It still seems to be available:<br><br><a target="_new" href="http://www.kovcomp.co.uk/acompose/">http://www.kovcomp.co.uk/acompose/</a><br><br>It was very well recieved by our customers, and while I haven't used it myself in some years it was a lifesaver and I can't recommend it enough.<br><br>Disclaimer: I have absolutely nothing to disclaim, I know absolutely nothing about KCS or Dr. Warren Kovach, and my only relationship with them is as a customer. I only wish they had a version for the Mac. :)</div>
<p><a id="358801" href="#358801">#</a> <strong>Michael Kaplan</strong> on 22 Jan 2005 5:15 PM:</p><div style="margin-left: 1em">I never claimed it was only for accents -- I was talking about typing a dead key, which as I described at <a target="_new" href="http://archives.miloush.net/michkap/archive/2004/12/17/323257.html">http://blogs.msdn.com/michkap/archive/2004/12/17/323257.aspx</a> and <a target="_new" href="http://archives.miloush.net/michkap/archive/2005/01/19/355870.html">http://blogs.msdn.com/michkap/archive/2005/01/19/355870.aspx</a> just involve typing two characters to make a third. <br><br>All of your examples would be covered by that (only the Unix doc seemed to limit them to accents).</div>
<p><a id="359009" href="#359009">#</a> <strong>Lionel Fourquaux</strong> on 23 Jan 2005 9:25 AM:</p><div style="margin-left: 1em">Peter: I'm aware that several applications on the web provide a Compose key emulation for Windows. However, they all use message hooks to post-process the input, which is far from being as clean as creating a new keyboard layout. (Moreover, I vaguely remember reading that hooks are not always as reliable as they should be).<br><br>Michael: I'm afraid I'm the same person who reported the problem with this (somewhat ridiculous) keyboard layout. I didn't realize at first that posting in the newsgroups would be a more appropriate place.<br><br>From what I've recently read in your blog, it'd be possible to &quot;chain&quot; dead keys (i.e. that dead key + another key is yet another dead key). I've not looked into this more precisely (and I'll probably not do it soon), but I think this is exactly what is needed to get a Compose key. Even if <a title="MSKLC" href="http://www.microsoft.com/globaldev/tools/msklc.mspx" target="_blank">MSKLC</a> doesn't expose this possibility, the internal keyboard layout mechanism appears to be powerful enough to solve this problem. (Maybe I'll give it a try someday).<br><br>This complaint about the Compose key seems rather frequent from people used to Unix OSes.<br></div>
<p><a id="359035" href="#359035">#</a> <strong>Michael Kaplan</strong> on 23 Jan 2005 10:23 AM:</p><div style="margin-left: 1em">Well, so far every example that has been given still ends up as COMPOSE plus two keystrokes to get a specific character.<br><br>Chaining dead keys would involve three keystrokes plus COMPOSE to get a specific chsracter. Unless COMPOSE has more functionality than the orevious examples give it? <br><br>Or unless one is not expected to hold down the COMPOSE key when one holds down the other keys? The description is not clear....</div>
<p><a id="359304" href="#359304">#</a> <strong>Paul</strong> on 23 Jan 2005 9:54 PM:</p><div style="margin-left: 1em">No, you don't hold down the compose key... you just press it. Compose, then ', then e, gives you &#233;.</div>
<p><a id="359311" href="#359311">#</a> <strong>Michael Kaplan</strong> on 23 Jan 2005 10:08 PM:</p><div style="margin-left: 1em">Ok, cool, that answers me.... and yes, there is no such key in Windows nor a way to get such a key with a standard keyboard. <br><br>But other than a little learning, it is hard for me to see it as looking particularly better or worse than the dead key mechanism (and in fact it is fewer key presses with dead keys!).</div>
<p><a id="360304" href="#360304">#</a> <strong>Lionel Fourquaux</strong> on 25 Jan 2005 10:59 AM:</p><div style="margin-left: 1em">In fact, some people press the compose key first, the some sequence of keys, while others press the compose key and the first key of the sequence simultaneously.<br>I've no opinion as to whether it's a better idea than dead keys, or not. Both are clearly related. What I see is that there is a strong demand for this functionality among people used to Unix OSes.<br>As for whether you can define such a key with the standard Windows APIs, what about this: define you compose key as a dead keys, and use chained dead keys to build compose key sequences as a tree of chained dead keys: e.g. compose is a dead key, which gives another dead key if you press 1, and this second dead key gives you &#189; if you press 2. If I understand correctly how dead keys can be chained, I think it gives you exactly a Unix-style compose key. Have I overlooked some problem?<br>Another difficulty is which physical key to use for compose. Many people use the &quot;Application&quot; key (the one with a small picture of a menu) for this purpose, but it'd cause conflicts with Windows keyboard shortcuts. A solution would be to use a key plus a modifier (e.g. AltGr+k).<br>A simpler solution is to use dead keys, and don't bother to mimic another OS when the benefits are not obvious!<br></div>
<p><a id="360336" href="#360336">#</a> <strong>Michael Kaplan</strong> on 25 Jan 2005 11:51 AM:</p><div style="margin-left: 1em">But chained dead keys do not specifically help, as it would then require three keystrokes and there is no option for typing the letters without the combination happening.<br><br>In the end, I am forced to believe that the last idea is the way. :-(<br><br>Better to let Windows be Windows. It is not specifically better or worse in this case, just different....</div>
<p><a id="8953853" href="#8953853">#</a> <strong>Gerben Vos</strong> on 16 Sep 2008 8:55 AM:</p><div style="margin-left: 1em"><p>Dead keys *are* less practical. When I press comma, I want a comma; I don't want this key to have different results (comma or cedille) depending on what key I press next. A compose key gives an easy choice between the comma and the cedille. It's a simple matter of offering a consistent and easy-to-remember user interface.</p>
<p>The Unix (or at least Linux) compose key does use more than two keys for some combinations; for example, Compose - - . gives an en-dash, while Compose - - - gives an em-dash. They may not be perfect key combinations, but they *are* easy to remember (and let's face it, you don't have to use those dashes very often).</p></div>
<p><a id="8953906" href="#8953906">#</a> <strong>Gerben Vos</strong> on 16 Sep 2008 9:52 AM:</p><div style="margin-left: 1em"><p>I would like to point lovers of the compose key to <a rel="nofollow" target="_new" href="http://keyboards.jargon-file.org/">http://keyboards.jargon-file.org/</a> , where there are several choices, all apparently MSKLC-generated. The layouts &quot;Pseudo VT320, &quot;United States International Alternate&quot;, &quot;United States Combining Diacritical&quot; all look quite promising.</p></div>
<p><a id="9914632" href="#9914632">#</a> <strong>Lapo Luchini</strong> on 29 Oct 2009 4:30 AM:</p><div style="margin-left: 1em"><p>IMHO AllChars is the solution to emulate compose key on Windows:</p>
<p><a rel="nofollow" target="_new" href="http://allchars.zwolnet.com/">http://allchars.zwolnet.com/</a></p>
<p>I don't know its internals, but it's opensource and it works; I used it for a few days and am very very satisfied so far.</p></div>
<p><strong>Simon</strong> on 15 Aug 2013 2:24 AM:</p><div style="margin-left: 1em"><p>Hi,</p>
<p>&gt; &nbsp;... you have to be willing sacrifice AltGR as a shift state...</p>
<p>I have never net anyone who used the AltGr key in the English speaking world using EN-GB keyboard. &nbsp;The same for Alt on EN-US local keyboards - Who uses these, other than to access accents chars?</p>
<p>Thanks for this article. Perhaps there lies a method that I can use Alt for a deadkey to access French accented characters : One day... </p>
<p>Cheers,S</p>
</div>
<hr/><p><em>referenced by</em></p><div style="margin-left: 1em"><p>2005/11/15 <a href="http://archives.miloush.net/michkap/archive/2005/11/15/492200.html">It is not easy to chain dead keys on Windows</a></p></div><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2005/01/23/358946.html" title="SQL Server has its own version of .NET &quot;ordinal&quot; comparisons">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2005/01/22/358675.html" title="Not all code pages work right">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2005-01">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2005-01-22">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2005/01/22/358771.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:42 GMT -->
</html>