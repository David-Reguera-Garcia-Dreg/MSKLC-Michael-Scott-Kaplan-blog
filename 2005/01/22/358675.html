<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2005/01/22/358675.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:42 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>Not all code pages work right</title></head><body>
<h1>Not all code pages work right</h1>
<p><em>by Michael S. Kaplan, published on 2005/01/22 10:52 -05:00, original URI: http://blogs.msdn.com/b/michkap/archive/2005/01/22/358675.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostNew -->
<P>Code pages are out there, and they are important. </P>
<P>A huge amount of legacy data exists in them, and we have to convert them all to Unicode to get anything done on Windows 2000, XP, Server 2003, or Longhorn.</P>
<P>But sometimes they are not designed very smartly.</P>
<P>Take for example code page 20269. It is intended to represent ISO 6937,&nbsp;a code page standard that is a little out of step. Basically, ISO 6937 has for characters single letters and combinations of a letter with a diacritic. Only those which occur in a list are legal, the "repertoire" of ISO 6937. The diacritic&nbsp;has to&nbsp;preceed the letter, but is not a character in and of itself. A diacritic as a free-standing character is created by coding a space behind the byte that represents the "diacritical mark". In this way some characters are coded with one, others with two bytes. The number of codeable characters is finite, the 333 of the repertoire. </P>
<P>The scheme of 6937 was abandoned in favor of the ISO-8859 scheme, which uses precomposed characters.</P>
<P>Unfortunately for ISO 6937, Windows and Unicode do things the other way around (base character followed by combining character). In order to properly handle conversions for ISO 6937, any of the following characters would have to (as a part of the conversion) be reversed with the character following it when calling <A title=WideCharToMultiByte href="http://msdn.microsoft.com/library/en-us/intl/unicode_2bj9.asp" target=_blank>WideCharToMultiByte</A>(20269, ...) and the character preceeding it when calling <A title=MultiByteToWideChar href="http://msdn.microsoft.com/library/en-us/intl/unicode_17si.asp" target=_blank>MultiByteToWideChar</A>(20269, ...)</P>
<BLOCKQUOTE dir=ltr>
<P><FONT face="Courier New"><STRONG><U>Unicode&nbsp;&nbsp;&nbsp; cp20269&nbsp;&nbsp;&nbsp; Character&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </U></STRONG><BR>U+0306&nbsp;&nbsp;&nbsp;&nbsp; 0xc6&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Combining Breve<BR>U+0307&nbsp;&nbsp;&nbsp;&nbsp; 0xc7&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Combining Dot Above<BR>U+0308&nbsp;&nbsp;&nbsp;&nbsp; 0xc8&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Combining Diaeresis<BR>U+030a&nbsp;&nbsp;&nbsp;&nbsp; 0xca&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Combining Ring Above<BR>U+030b&nbsp;&nbsp;&nbsp;&nbsp; 0xcd&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Combining Double Acute<BR>U+030c&nbsp;&nbsp;&nbsp;&nbsp; 0xcf&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Combining Hacek<BR>U+0327&nbsp;&nbsp;&nbsp;&nbsp; 0xcb&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Combining Cedilla<BR>U+0328&nbsp;&nbsp;&nbsp;&nbsp; 0xce&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Combining Ogonek<BR>U+0332&nbsp;&nbsp;&nbsp;&nbsp; 0xcc&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Combining Low Line</FONT></P></BLOCKQUOTE>
<P>Yet the code page is there in its current form, which converts everything in place. Every entry in the table above is converted <EM>as is</EM>, and thus if you have a string such as </P>
<P><FONT size=5>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;åėĭöŭ&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</FONT><FONT size=3>U+0061 U+030a U+0065 U+0307 U+0069 U+0306 U+006f U+0308 U+0075 U+0306</FONT></P>
<P>in text that is properly using ISO 6937 it <EM>should</EM> (if it is following the standard) be represented as </P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0xCA 0x61 0xC7 0x65 0xC6 0x69 0xC8 0x6F 0xC6 0x75</P>
<P>Unfortunately, code page 20269 would convert this to unicode as follows:</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<FONT size=5>̊ȧĕïŏu</FONT>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;U+030a U+0061 U+0307 U+0065 U+0306 U+0069 U+0308 U+006f U+0306 U+0075</P>
<P>Oops! Slight change, huh? :-)</P>
<P>Now there is no other code page that is broken like this. But a few are broken in other ways.... like IBM EBCDIC Arabic, which is a Visual order Arabic code page. Converting that to Unicode (which represents Arabic in logical order) properly would require a very careful algorithm. But the simple table-based code page 20420 converts everything <EM>as is</EM> once again, and thus produces something that is not terribly useful. For example the string with the word for Arabic:</P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<FONT size=5>العربية</FONT>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;U+0627 U+0644 U+0639 U+0631 U+0628 U+064a U+0629</P>
<P>would be a nightmare string to convert to or from IBM EBCDIC Arabic without having some sort of intelligent processor to convert between logical and visual order.</P>
<P>What better reason to just use Unicode, instead? :-)</P>
<P>&nbsp;</P>
<P><FONT color=#800080><EM>This post sponsored by </EM>"ى"<EM> (U+0649, ARABIC LETTER ALEF MAKSURA)</EM></FONT></P>
<hr/><p><a id="358766" href="#358766">#</a> <strong>anonymous</strong> on 22 Jan 2005 2:40 PM:</p><div style="margin-left: 1em">When are you going to add mouse wheel support to charmap.exe? :)<br></div>
<p><a id="358776" href="#358776">#</a> <strong>Michael Kaplan</strong> on 22 Jan 2005 3:33 PM:</p><div style="margin-left: 1em">Me personally? Probably not ever, sorry. :-(<br><br>Would something like that happen? It is hard to say. It's not the most robust piece of code in the universe, a fact that does shape ideas about it....<br><br>But with that said I will mention it to the owner. :-)</div>
<p><strong>John Cowan</strong> on 14 Sep 2008 1:35 PM:</p><div style="margin-left: 1em"><p>20269 should really be treated like SJIS or another 8/16-bit encoding rather than an 8-bit one.</p></div>
<hr/><p><em>referenced by</em></p><div style="margin-left: 1em"><p>2008/09/14 <a href="http://archives.miloush.net/michkap/archive/2008/09/14/8950506.html">Johab to be kidding me!</a></p><p>2007/08/30 <a href="http://archives.miloush.net/michkap/archive/2007/08/30/4641553.html">The main criteria in determing whether a code page sucks? Suckage, of course!</a></p><p>2007/07/17 <a href="http://archives.miloush.net/michkap/archive/2007/07/17/3910360.html">Sometimes people use code pages even when the code pages are really lame</a></p></div><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2005/01/22/358771.html" title="How can Windows emulate the functionality of the ComposeKey of UNIX?">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2005/01/21/358585.html" title="Thanks to Josh Ledgard....">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2005-01">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2005-01-22">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2005/01/22/358675.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:42 GMT -->
</html>