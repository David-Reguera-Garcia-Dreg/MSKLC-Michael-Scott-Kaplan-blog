<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2005/01/25/360240.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:42 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>CAPSLOCK only sometimes equals ShiftLock</title></head><body>
<h1>CAPSLOCK only sometimes equals ShiftLock</h1>
<p><em>by Michael S. Kaplan, published on 2005/01/25 08:34 -08:00, original URI: http://blogs.msdn.com/michkap/archive/2005/01/25/360240.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostOld -->
<P>Tor Lillqvist suggested I talk a little about the difference between CAPSLOCK and ShiftLock -- </P>
<BLOCKQUOTE dir=ltr>
<P><FONT size=2><EM>Something you might want to blog about some day: the difference between "CapsLock" and "ShiftLock". Especially determining programmatically whether the "VK_CAPITAL" key acts as CapsLock or ShiftLock for a certain keyboard layout (input locale identifier). (Something I needed to do recently, for somewhat complex reasons) <BR><BR>Currently I do it by checking with ToAsciiEx(). I select a key that generates different characters with and without VK_SHIFT, and where the result from the shifted key isn't simply the uppercase equivalent of the unshifted one. I.e. typically my code would select a key from the "digit" row. <BR><BR>I then check again with VK_CAPITAL toggled (and VK_SHIFT off), and if the resulting char is the same that just VK_SHIFT produced, I know that VK_CAPITAL should act as ShiftLock. </EM></FONT></P></BLOCKQUOTE>
<P>Well, of course I would always suggest using <A title=ToUnicodeEx href="http://msdn.microsoft.com/library/en-us/winui/winui/windowsuserinterface/userinput/keyboardinput/keyboardinputreference/keyboardinputfunctions/tounicodeex.asp" target=_blank>ToUnicodeEx</A> instead of ToAsciiEx.... :-)</P>
<P>Of course its not that simple since it is a per-key setting (as you point out, usually the CAPSLOCK key does not cause the number keys to display their shift states). And then comes features like SGCAPS that take over the CAPSLOCK key in a big way. Check out the Hebrew keyboard some time in <A title=MSKLC href="http://www.microsoft.com/globaldev/tools/msklc.mspx" target=_blank>MSKLC</A> and you'll see what I mean -- it just wreaks havoc with the notion of the key labelled CAPSLOCK locking the 'CAPS' state. The price of adding two new shift states.</P>
<P>The setting also gets weird when you add dead keys to the mix -- anytime you call <A title=ToUnicode href="http://msdn.microsoft.com/library/en-us/winui/winui/windowsuserinterface/userinput/keyboardinput/keyboardinputreference/keyboardinputfunctions/tounicode.asp" target=_blank>ToUnicode</A> or ToUnicodeEx and the key is a dead key you will have that weird stateful situation which will affect the next call in the same thread. Though of course people who author keyboard layouts with dead keys that span multiple shift states probably do not like their users too much -- thats a hard typing task!</P>
<P>The setting in question here is actually available in MSKLC. We argued about the name of the setting for some time before finally settling on the "caps = shift" option. I had voted for "caps == shift" but was outvoted by the program managers to 2 to 1 -- maybe I should have invited some other developers? </P>
<P>Anyway, the MSKLC setting is actually automatically applied when the characters are cased variants of each other, and it is used in validation -- if the two characters are case pairs yet this option is not enabled (or if they are not case pairs yet the option IS enabled), you get a warning. But this is okay if it is intentional -- usually, it's not, though. After MSKLC was available we found out how often Microsoft had done this setting improperly in the build-in keyboards in Windows!</P>
<P>So, the summary -- for the CAPSLOCK to act as a ShiftLock, one must explicitly ask it to be so in the keyboard layout -- and often the layout author does not do this (even if that was probably the intention).</P>
<P><FONT color=#800080><EM>This post brought to you by </EM>"Â±"<EM> (<A href="http://www.fileformat.info/info/unicode/char/00b1/index.htm">U+00b1</A>, a.k.a. PLUS-MINUS SIGN)</EM></FONT></P>
<hr/><p><a id="360641" href="#360641">#</a> <strong>Philip Newton</strong> on Tuesday, January 25, 2005 10:18 PM:</p><div style="margin-left: 1em">&quot;We argued about the name of the setting for some time before finally settling on the &quot;caps = shift&quot; option. I had voted for &quot;caps == shift) but was outvoted&quot;<br><br>I'm not sure what the two different options mean, or how they are different.<br><br>Is the number of equals signs significant? Is the closing parenthesis on your chosen option significant, or is it a typo?</div>
<p><a id="360653" href="#360653">#</a> <strong>Michael Kaplan</strong> on Tuesday, January 25, 2005 10:54 PM:</p><div style="margin-left: 1em">The closing parenthesis was a typo -- fixed now. <br><br>The meaning is that the CapsLock key has the same functionality as the Shift key (which it often does for letters of languages which have case).... <br><br>On the other hand, they would not do the same thing on the number keys.<br><br>The two equals signs matches the C/C++/C# convention of equality. :-)</div>
<hr/><p><em>referenced by</em></p><div style="margin-left: 1em"><p>2006/10/06 <a href="http://archives.miloush.net/michkap/archive/2006/10/06/798751.html">If you hate the CAPS LOCK key, please read this!</a></p><p>2006/04/10 <a href="http://archives.miloush.net/michkap/archive/2006/04/10/570570.html">Getting all you can out of a keyboard layout, Part #8</a></p></div><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2005/01/25/360574.html" title="Speaking Engagement.NET">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2005/01/24/359555.html" title="Challenges behind MSLU: the loader! (Part 1)">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2005-01">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2005-01-25">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2005/01/25/360240.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:42 GMT -->
</html>