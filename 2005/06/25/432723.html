<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2005/06/25/432723.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:41 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>Line breaking, according to DrawText</title></head><body>
<h1>Line breaking, according to DrawText</h1>
<p><em>by Michael S. Kaplan, published on 2005/06/26 01:01 -04:00, original URI: http://blogs.msdn.com/b/michkap/archive/2005/06/25/432723.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostNew -->
<P><FONT face=Tahoma>The Win32 <A href="http://msdn.microsoft.com/library/en-us/gdi/fontext_0odw.asp">DrawText</A> function and its more full-featured cousin <A href="http://msdn.microsoft.com/library/en-us/gdi/fontext_4pbs.asp">DrawTextEx</A>, have been around for a long time. They both have a simple stated set of purposes:</FONT></P>
<BLOCKQUOTE dir=ltr>
<P><EM>...draws formatted text in the specified rectangle. It formats the text according to the specified method (expanding tabs, justifying characters, breaking lines, and so forth).</EM></P></BLOCKQUOTE>
<P><FONT face=Tahoma>Now I have talked about word breaking in the past, and obviously they are related (where else would you break lines but on valid word breaks?). But the DrawText/DrawTextEx functions are from an earlier time -- a time before complex scripts, or good integration of Unicode character properties, of the real existence of mature Unicode character properties.</FONT></P>
<P><FONT face=Tahoma>But let's take a look at its offerings, via the variou flags you can specify that affect the word break behavior:</FONT></P>
<BLOCKQUOTE dir=ltr>
<P><FONT face=Tahoma><STRONG><FONT face="Courier New" size=4>DT_WORDBREAK</FONT></STRONG> - Breaks words. Lines are automatically broken between words if a word extends past the edge of the rectangle specified by the <I>lprc</I> parameter. A carriage return-line feed sequence also breaks the line.</FONT></P>
<P><FONT face=Tahoma><STRONG><FONT face="Courier New" size=4>DT_NOFULLWIDTHCHARBREAK</FONT></STRONG> - Prevents a line break at a DBCS (double-wide character string), so that the line-breaking rule is equivalent to SBCS strings. For example, this can be used in Korean windows, for more readability of icon labels. This value has no effect unless DT_WORDBREAK is specified.</FONT></P></BLOCKQUOTE>
<P><FONT face=Tahoma>Huh?</FONT></P>
<P><FONT face=Tahoma>What the first one is trying to say is that by default, the text will just keep going and then when the border is reached it will start the new line and possibly break right in the middle. But if you pass the DT_WORDBREAK flag, then you are saying to make the breaks at the boundaries of words in the text. Which is pretty much what people expect (and what controls like EDIT already do themselves).</FONT></P>
<P><FONT face=Tahoma>The second flag was added after many user complaints about the Windows 95/NT 4.0 behavior that treats after each CJK ideograph as a potential word break opportunity. This new flag says to treat CJK the same way everything else is treated -- look for the spaces as the word break opportunities.</FONT></P>
<P><FONT face=Tahoma>Of course you may expect for more than just <A href="http://www.fileformat.info/info/unicode/char/0020/index.htm">U+0020</A> to be handled when I say space. But most of the ones you would expect on such a list would not be there.</FONT></P>
<P><FONT face=Tahoma>Interestingly, all of the following are also looked as word breaking opportunities in East Asian text:</FONT></P>
<UL>
<LI><FONT face=Tahoma>! (<A href="http://www.fileformat.info/info/unicode/char/0021/index.htm">U+0021</A>, a.k.a.&nbsp;EXCLAMATION POINT)</FONT></LI>
<LI><FONT face=Tahoma>· (<A href="http://www.fileformat.info/info/unicode/char/00b7/index.htm">U+00b7</A>, a.k.a. MIDDLE DOT)</FONT></LI>
<LI><FONT face=Tahoma>ˇ (<A href="http://www.fileformat.info/info/unicode/char/02c7/index.htm">U+02c7</A>, a.k.a. CARON) <EM>Note this is the modifier letter version)</EM></FONT></LI>
<LI><FONT face=Tahoma>ˉ (<A href="http://www.fileformat.info/info/unicode/char/02c9/index.htm">U+02c9</A>, a.k.a. MODIFER LETTER MACRON)</FONT></LI>
<LI><FONT face=Tahoma>– (<A href="http://www.fileformat.info/info/unicode/char/2013/index.htm">U+2013</A>, a.k.a. EN DASH)</FONT></LI>
<LI><FONT face=Tahoma>″ (<A href="http://www.fileformat.info/info/unicode/char/2033/index.htm">U+2033</A>, a.k.a. DOUBLE PRIME)</FONT></LI>
<LI><FONT face=Tahoma>℃ (<A href="http://www.fileformat.info/info/unicode/char/2103/index.htm">U+2103</A>, a.k.a. DEGREE CELCIUS)</FONT></LI>
<LI><FONT face=Tahoma>∶&nbsp;(<A href="http://www.fileformat.info/info/unicode/char/2236/index.htm">U+2236</A>, a.k.a. RATIO)</FONT></LI>
<LI><FONT face=Tahoma>╴&nbsp;(<A href="http://www.fileformat.info/info/unicode/char/2574/index.htm">U+2574</A>, a.k.a. BOX DRAWINGS LIGHT LEFT)</FONT></LI>
<LI><FONT face=Tahoma>various word breaking characters in small variants, Fullwidth ASCII, Halfwidth Katakana, and Fullwidth symbols</FONT></LI></UL>
<P><FONT face=Tahoma>Obviously the functionality in DrawText and DrawTextEx is not quite up to Unscribe standards, when it comes to complex scripts. But you know how I feel about NLS API behavior changes? Well this is core GDI behavior, and&nbsp;both they are MS Typograophy have to worry about even the most minute changes in behavior of their functions once something has shipped. Because you never know who is relying on it. A small change in word break behavior could make the page count of a document double or worse, so even sensible changes can only be made via&nbsp;new flags (or in the case of complex scripts via new functions).</FONT></P>
<P><FONT face=Tahoma></FONT>&nbsp;</P>
<P><FONT face=Tahoma><FONT color=#ff0000><EM>This post brought to you by</EM> " " <EM>(<A href="http://www.fileformat.info/info/unicode/char/0020/index.htm">U+0020</A>, a.k.a. SPACE)</EM></FONT></FONT></P>
<hr/><p><a id="432727" href="#432727">#</a> <strong>TheMuuj</strong> on 25 Jun 2005 11:38 PM:</p><div style="margin-left: 1em">Note to self: Don't use DrawText.<br><br>As far as I know, there are new classes in Whidbey for drawing text with GDI (as a result of GDI+'s questionable screen rendering in some cases).  Are these based on DrawText?<br><br>Is there any word or rumors on a managed wrapper for Uniscribe?<br><br>P/Invoke may be okay for now, but more and more applications will run with ClickOnce, and security will become more of an issue.<br><br>So maybe we need System.Drawing.Text.Complex.dll.<br><br>Just a thought.  Hopefully WinFX will fix a lot of these brick walls in .NET and we (non-MS developers) won't be using Interop for much.</div>
<p><a id="432802" href="#432802">#</a> <strong>Michael S. Kaplan</strong> on 26 Jun 2005 10:34 AM:</p><div style="margin-left: 1em">Well, I don't want to distort any truths here.... the main point of the new methods is to pick up the updates to the shaping engines in Uniscribe, which can handle more languages than GDI+.<br><br>I'll be talking about the new methods more another day, though.</div>
<hr/><p><em>referenced by</em></p><div style="margin-left: 1em"><p>2005/06/27 <a href="http://archives.miloush.net/michkap/archive/2005/06/27/432986.html">A quick look at Whidbey's TextRenderer</a></p></div><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2005/06/26/432874.html" title="Client side locale settings on the server?">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2005/06/24/432494.html" title="多機能な CultureInfo クラスを利用して .NET の世界を身近なものにする">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2005-06">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2005-06-25">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2005/06/25/432723.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:41 GMT -->
</html>