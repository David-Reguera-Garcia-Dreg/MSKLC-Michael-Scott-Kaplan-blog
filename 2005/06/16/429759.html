<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2005/06/16/429759.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:41 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>More on locales in SQL Server</title></head><body>
<h1>More on locales in SQL Server</h1>
<p><em>by Michael S. Kaplan, published on 2005/06/16 10:25 -04:00, original URI: http://blogs.msdn.com/b/michkap/archive/2005/06/16/429759.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostNew -->
<P><FONT face=Tahoma>Fascinating&nbsp;post about <a href="http://blogs.msdn.com/sqlclr/archive/2005/06/15/429407.aspx">Locales in SQL Server</A>, one that went into much more detail than I did at TechEd last week. It is from the from the new <a href="http://blogs.msdn.com/sqlclr/default.aspx">SQLCLR Integration</A> blog and is definitely worth a read or three...</FONT></P>
<P><FONT face=Tahoma>They did a really good description of not only the problems in the old Microsoft C Runtime (CRT) locale model where anyone in the process could modify the locale and change the functionality of a broad range of settings, but of the very cool CRT solution in Whidbey -- functions where you can pass the locale you had set. And they top it off by saying that they pretty much try to keep the locale set to be the "C" locale (I have posted about that beast and its effect on the meaning of&nbsp;case&nbsp;insensitivity&nbsp;<a href="http://archives.miloush.net/michkap/archive/2005/05/08/415522.html">previously</A>).</FONT></P>
<P><FONT face=Tahoma>The interesting idea (in my opinion) is that they do not try to keep the CRT locale in sync with the SQL collation setting. Which in a way makes sense; after all, which would they&nbsp;choose to be similar to? The server's? Kind of useless and weird when the database's did not match. Better not to jump into a fight with a model when one cannot win it. :-)</FONT></P>
<P><FONT face=Tahoma>It also talks about the CLR and its notion of locales (CurrentCulture and CurrentUICulture) and how they have a slightly different solution there. SQL Server leaves the CurrentCulture alone, so it is subject to similar issues as the old CRT locale, with one important difference and one very eerie similarity.</FONT></P>
<P><FONT face=Tahoma>The difference is that developers who change it only affect the thread they are in, which is obviously not the same as that CRT-wide setting. The similarity is that they leave the CurrentCulture and CurrentUICulture alone, subject to the server's settings. Since these settings also may or may not match the SQL Server settings, one could run into all kinds of strange incompatibilities, even beyond the ones I talk about in my <a href="http://archives.miloush.net/michkap/archive/2005/06/09/427293.html">String.Compare and SQLCLR</A> post (which has someow made it quickly to the top of&nbsp;lot of different web searches, and not because of its use of the word <EM>sissy</EM>; people really seem to care about SQLCLR and keeping the two sides of the partnership as compatible as possible!).</FONT></P>
<P><FONT face=Tahoma>I probably would have made the push to try to make the SQL Server and the CLR locales be the same, especially given the issues with wanting similar comparisons, but I can understand that it does not affect everyone and since there is a 'tax' one has to pay to have them in sync in every single worker thread used by SQL Server, it really is unreasonable to make everyone pay that tax. Plus the same issuesof which collation would be best to use come up. So such a push would fail, with good reasons. </FONT></P>
<P><FONT face=Tahoma>But in any individual usage of the CLR within SQL Server, there is the method to help you keep in sync with SQL Server's settings (whichever ones you like) -- which I talked about in Orlando and will talk about in Amsterdam -- a <A href="http://msdn2.microsoft.com/library/eaw6y1cb(en-us,vs.80).aspx">GetCultureInfo override</A>&nbsp;that I will talk about more another day -- a great addition to the already cool feature <a href="http://blogs.msdn.com/mdolenga/">Mike</A> <a href="http://blogs.msdn.com/mdolenga/archive/2005/04/20/409927.aspx">discusses</A>. More on this another day....</FONT></P>
<P><FONT face=Tahoma>Plus there is that String.Compare post that talks about for serious CLR work you probably want to be using CompareInfo.Compare anyway, for maximum SQL/CLR compatibility of collation results.</FONT></P>
<P><FONT face=Tahoma>But this post by the SQLCLR folks gives some additional issues, as well as the need to keep the differences between all of these different technology models in mind. Very cool!</FONT></P>
<hr/><div style="margin-left: 1em"><em>no comments</em></div><hr/><p><em>referenced by</em></p><div style="margin-left: 1em"><p>2007/01/11 <a href="http://archives.miloush.net/michkap/archive/2007/01/11/1449754.html">Why we have both CurrentCulture and CurrentUICulture</a></p></div><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2005/06/17/430391.html" title="Anyone having trouble with MSKLC on an x64 machine?">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2005/06/16/429667.html" title="What it means to be case insensitive">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2005-06">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2005-06-16">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2005/06/16/429759.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:41 GMT -->
</html>