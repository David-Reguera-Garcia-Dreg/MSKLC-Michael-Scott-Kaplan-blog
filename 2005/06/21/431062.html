<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2005/06/21/431062.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:41 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>Whither SHAnsiToUnicode?</title></head><body>
<h1>Whither SHAnsiToUnicode?</h1>
<p><em>by Michael S. Kaplan, published on 2005/06/21 14:01 -04:00, original URI: http://blogs.msdn.com/b/michkap/archive/2005/06/21/431062.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostNew -->
<P><FONT face=Tahoma>In the <a href="http://archives.miloush.net/michkap/archive/2005/04/01/404554.html">Suggestion Box</A>, our good friend <A href="http://www.apptranslator.com/">Serge Wautier</A>&nbsp;of appTranslator fame (I'll blog about that tool another day!) asked:</FONT></P>
<BLOCKQUOTE dir=ltr>
<P><EM>What's the purpose of SHAnsiToUnicode() ? I mean... what advantage does it have over plain old MultiByteToWideChar() ? <BR>Less parameters obviously. But is that it ? </EM></P>
<P><EM>TIA,</EM></P></BLOCKQUOTE>
<P><FONT face=Tahoma>Very good question, I have often wondered myself!</FONT></P>
<P><FONT face=Tahoma>Just kidding. :-)</FONT></P>
<P><FONT face=Tahoma>The fact is that in NLS we try to provide the full functionality that every function in the API is meant to support, via the various parameters and flags.</FONT></P>
<P><FONT face=Tahoma>But even if you are inside of Microsoft, you are usually not trying to look at the whole big complicated functionality, you are trying to do a single task many times. So whether you are in the USER group or the SHELL group or the BCL or Office or somewhere else entirely, you write wrapper macros and functions. And many of the functions get published and become officially documented APIs. This is especially true in the Shell group where the SHLWAPI (Shell Lightweight API) exists and is incremented in every version with new wrappers and functions.</FONT></P>
<P><FONT face=Tahoma>Which is not to say that <A href="http://msdn.microsoft.com/library/en-us/shellcc/platform/shell/reference/shlwapi/others/SHUnicodeToAnsi.asp">SHUnicodeToAnsi</A> and <A href="http://msdn.microsoft.com/library/en-us/shellcc/platform/shell/reference/shlwapi/others/SHAnsiToUnicode.asp">SHAnsiToUnicode</A> are perfect functions for all occasions -- they assume that the source buffer is null terminated, and they do not allow you to select the code page (it is always the default system code page). You also cannot change the default character or choose what flags to pass in order to determine how to handle precomposed/composite characters. There is even a security warning in both functions, despite the fact that it guarantees NULL terminaton of the&nbsp;target string&nbsp;(if the length of the destination you pass&nbsp;does not match the buffer, bad things can happen).</FONT></P>
<P><FONT face=Tahoma>But if you need to call the NLS APIs to do these conversions and do not want to have to remember all of the calling semantics, and if the way you want the conversion you happen is the same as the wrapper, then one of these functions may be perfect.</FONT></P>
<P><FONT face=Tahoma>Sometimes, I wish that all of these wrappers explicitly documented how they called the NLS APIs; it would be much easier to choose the right function to use. But it is really not too hard to figure out what they are with&nbsp;a little experimentation and reading of the documentation. And if you are the sort of developer who worries about that sort of detail, then you are probably either calling the NLS functions directly or writing your own wrappers. So I have never pushed too hard for a huge doc. update. Plus, that would make it harder to make changes if there were bugs in the way it was implemented.</FONT></P>
<P><FONT face=Tahoma>One disadvantage to these wrappers is that the parameters and calling semantics vary quite a bit. if you need to change the way you call the function or the flags you want to pass, your options are limited. I mean, if you are hasppily using <A href="http://msdn.microsoft.com/library/en-us/cpref/html/frlrfsystemstringclassstartswithtopic.asp">String.StartsWith</A> and <A href="http://msdn.microsoft.com/library/en-us/cpref/html/frlrfsystemstringclassendswithtopic.asp">String.EndsWith</A> and suddenly need to start looking for a prefix and suffix with a width-insensitive comparison, the migration to <A href="http://msdn.microsoft.com/library/en-us/cpref/html/frlrfsystemglobalizationcompareinfoclassisprefixtopic2.asp">CompareInfo.IsPrefix</A> and <A href="http://msdn.microsoft.com/library/en-us/cpref/html/frlrfsystemglobalizationcompareinfoclassissuffixtopic2.asp">CompareInfo.IsSuffix</A>&nbsp;can be difficult, especially as you move from an instance method to a static one. </FONT></P>
<P><FONT face=Tahoma>It is hard enough to make some people start using the "real" APIs all the time....</FONT></P>
<P><FONT face=Tahoma></FONT>&nbsp;</P>
<P><FONT face=Tahoma color=#ff0000><EM>This post brought to you by</EM> "ï¿¥" <EM>(<A href="http://www.fileformat.info/info/unicode/char/ffe5/index.htm">U+ffe5</A>, a.k.a. FULLWIDTH WON SIGN)</EM></FONT></P>
<hr/><p><a id="431187" href="#431187">#</a> <strong>Rosyna</strong> on 21 Jun 2005 1:07 PM:</p><div style="margin-left: 1em">Pedantic, but why is it SHAnsiToUnicode and not SHANSIToUnicode? Too many uppercase letters in a row?<br><br>Anything that takes a C String should take an encoding. Evil otherwise should be deprecated.</div>
<p><a id="431217" href="#431217">#</a> <strong>Serge Wautier</strong> on 21 Jun 2005 2:22 PM:</p><div style="margin-left: 1em">Do you remember I mentioned Michael Kaplan's blog some time ago.<br><br>Today, I learned I'm his good friend! :-)</div>
<p><a id="431303" href="#431303">#</a> <strong>Michael S. Kaplan</strong> on 21 Jun 2005 5:29 PM:</p><div style="margin-left: 1em">Hi Rosyna!<br><br>Well, the Shlwapi APIs seem to stay away from capitalizing most acronyms (though there are exceptions). Mainly it bolis down to some person's preference....</div>
<p><a id="431304" href="#431304">#</a> <strong>Michael S. Kaplan</strong> on 21 Jun 2005 5:29 PM:</p><div style="margin-left: 1em">Of course Serge is a good friend of this blog -- he posts comments here!</div>
<p><a id="431345" href="#431345">#</a> <strong>Dean Harding</strong> on 21 Jun 2005 7:34 PM:</p><div style="margin-left: 1em">I guess the other thing is that it probably only makes sense to use the SHAnsiToUnicode/SHUnicodeToAnsi wrappers if you're writing a shell extension so that you know you're going to get consistent behaviour with the rest of the shell.</div>
<p><a id="431351" href="#431351">#</a> <strong>Rosyna</strong> on 21 Jun 2005 8:06 PM:</p><div style="margin-left: 1em">This actually brings up an interesting point. If someone working on one group at MS sees a problem in another group's software that affects them, can get just fix the other group's code?<br><br>And when you're in a group at MS, how much code is your (individually, one person's) responsibility? An entire DLL? A few functions in a DLL? A lot of DLLs under the same &quot;genre&quot;?</div>
<p><a id="431382" href="#431382">#</a> <strong>Michael S. Kaplan</strong> on 21 Jun 2005 11:09 PM:</p><div style="margin-left: 1em">Hi Dean --<br><br>To some extent I guess that is true, but like with sorting there are other Shell functions to accomplish things here. So there is no way to be &quot;consitent with the Shell&quot; since the Shell has so many different choices?<br><br>Or looked at another way, it easy to be consistent with the Shell since things are done so many diferent ways that you are consistent with *somebody* no matter what you do....</div>
<p><a id="431387" href="#431387">#</a> <strong>Michael S. Kaplan</strong> on 21 Jun 2005 11:29 PM:</p><div style="margin-left: 1em">Hi Rosyna  --<br><br>I'll post about this in a bit. :-)</div>
<p><a id="431444" href="#431444">#</a> <strong>Stuart Dootson</strong> on 22 Jun 2005 3:23 AM:</p><div style="margin-left: 1em">Am I being incredibly dense....or does SHAnsiToUnicode et. al. exist only in the MSDN documents (like several of the SHLWAPI functions, it seems to me)? I've included shlwapi.h in a C++ file (using VS2005, BTW) and it says it can't find a SHAnsiToUnicode. And also, using depends.exe, there doesn't seem to be one in shlwapi.dll (using XP SP2, so it's reasonably up to date :-)<br><br>Whimper - I'm confused :-(</div>
<p><a id="431461" href="#431461">#</a> <strong>Michael S. Kaplan</strong> on 22 Jun 2005 4:13 AM:</p><div style="margin-left: 1em">Hi Stuart!<br><br>See <a rel="nofollow" target="_new" href="http://members.ozemail.com.au/~geoffch/samples/win32/shell/shlwapi/functions/">http://members.ozemail.com.au/~geoffch/samples/win32/shell/shlwapi/functions/</a> or to be more specific, see the following links:<br><br>SHAnsiToUnicode:<br><a rel="nofollow" target="_new" href="http://members.ozemail.com.au/~geoffch/samples/win32/shell/shlwapi/functions/">http://members.ozemail.com.au/~geoffch/samples/win32/shell/shlwapi/functions/</a>string/atow.htm<br><br>SHUnicodeToAnsi:<br><a rel="nofollow" target="_new" href="http://members.ozemail.com.au/~geoffch/samples/win32/shell/shlwapi/functions/">http://members.ozemail.com.au/~geoffch/samples/win32/shell/shlwapi/functions/</a>string/wtoa.htm</div>
<p><a id="432258" href="#432258">#</a> <strong>Stuart Dootson</strong> on 24 Jun 2005 10:04 AM:</p><div style="margin-left: 1em">Thanks for that!<br><br>So...the Platform SDK documentation is ...less than accurate for these functions, as it points you at shlwapi.h to pull in a prototype. Oh well.</div>
<p><a id="432282" href="#432282">#</a> <strong>Michael S. Kaplan</strong> on 24 Jun 2005 11:26 AM:</p><div style="margin-left: 1em">The great thing about the Platform SDK is that new ones always come out....</div>
<p><a id="433346" href="#433346">#</a> <strong>Stuart Dootson</strong> on 28 Jun 2005 10:04 AM:</p><div style="margin-left: 1em">&quot;The great thing about the Platform SDK is that new ones always come out....&quot;<br><br>I know - I'm using the Windows XP SP2 Platform SDK...I try to keep up to date, honest, guv :-)</div>
<hr/><p><em>referenced by</em></p><div style="margin-left: 1em"><p>2006/06/16 <a href="http://archives.miloush.net/michkap/archive/2006/06/16/634124.html">Neither GDI nor Uniscribe solve the ultimate font problem completely, either</a></p><p>2005/06/22 <a href="http://archives.miloush.net/michkap/archive/2005/06/22/431394.html">What APIs do I own?</a></p></div><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2005/06/22/431394.html" title="What APIs do I own?">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2005/06/21/431005.html" title="Number format and currency format are not always the same">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2005-06">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2005-06-21">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2005/06/21/431062.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:41 GMT -->
</html>