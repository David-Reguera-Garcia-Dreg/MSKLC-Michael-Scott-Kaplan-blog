<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2005/06/29/433669.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:41 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>Consoling people about their troubles with the console.</title></head><body>
<h1>Consoling people about their troubles with the console.</h1>
<p><em>by Michael S. Kaplan, published on 2005/06/29 03:01 -04:00, original URI: http://blogs.msdn.com/b/michkap/archive/2005/06/29/433669.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostNew -->
<P><FONT face=Tahoma>This is not one of those fun posts where I get to talk about exciting new features. Instead I am going to answer some questions about CMD, the console (kŏn'sōl'), and now I am going to try and console (kən-sōl') the people with questions, since they will probably not care for the answers. :-(</FONT></P>
<P><FONT face=Tahoma>Several hundred posts ago (back in the end of 2004), <a href="http://blogs.msdn.com/Profile.aspx?UserID=1001">Per Bergland</A> asked (in the Suggestion Box):</FONT></P>
<BLOCKQUOTE dir=ltr style="MARGIN-RIGHT: 0px">
<P><EM>This may have been asked (and answered) before, but I find it such a shame that cmd.exe can't execute a bat/cmd file in unicode (UTF16). Since Notepad doesn't do "OEM", I find myself using the DOS EDIT text editor to fix up national characters such as our Swedish å,ä and ö. </EM></P>
<P><EM>Hey, cmd can *read* unicode and even *write* using the "/U" switch, so why can't it read &amp; execute a file containing Unicode? </EM></P>
<P><EM>You wouldn't happen to know this, would you?</EM></P></BLOCKQUOTE>
<P><FONT face=Tahoma>I can't answer this one with authority since I don't own CMD.EXE. In fact, I am not even sure who does these days. But I do know that it is not easy to get major feature work done in this area, in that codebase. The whole point of the Monad project (read more about it in posts <a href="http://blogs.msdn.com/search.aspx?q=monad&amp;p=1">here</A>) is to get away from all of the backcompat issues that keep people from wanting to touch the code to make changes. The last time I checked it out, the plan was to support Unicode files, though.</FONT></P>
<P><FONT face=Tahoma>For the legacy case, I have been in the habit of using Word and choosing the code page to save a file to as plain text as a way to get the files in the right format, and I have tried to lobby the owners of Notepad to consider adding another "Save As..." option for the OEM code page, but I have not gotten much&nbsp;traction on that (or on my other request for that list, the UTF-8 without BOM choice). Though if i had to guess which was more likely to be seen in the future, I would guess that they would be quicker to add features to Notepad then to the console....</FONT></P>
<P><FONT face=Tahoma>Then, moving on into January, KJK::Hyperion asked (also in the Suggestion Box):</FONT></P>
<BLOCKQUOTE dir=ltr style="MARGIN-RIGHT: 0px">
<P><EM>Console windows support Unicode, but they necessarily have a number of limitations, having to support the OEM charset and being limited to monospace fonts (which, I've seen, rules out composed characters and some special spacing characters). How is this handled internally? especially, how is Japanese handled, with its mixture of half-width and full-width characters? and how are valid fonts chosen?</EM></P></BLOCKQUOTE>
<P><FONT face=Tahoma>See above for some answers. For wanting to have your own font choice, you can pick any monspace or essentially monospace font and then set one or both of the following registry values:</FONT></P>
<BLOCKQUOTE dir=ltr style="MARGIN-RIGHT: 0px">
<P><FONT face="Courier New" size=2>KEY&nbsp;== HKEY_CURRENT_USER\Console,&nbsp;ValueName == FaceName, Value == &lt;whatever font you like&gt;</FONT></P>
<P><FONT face="Courier New" size=2>KEY == HKEY_CURRENT_USER\Console, ValueName == FontFamily, Value == &lt;50 for decorative, 40 for Script, 30 for Modern, 20 for Swiss, or 10 for Roman&gt;.</FONT></P></BLOCKQUOTE>
<P><FONT face=Tahoma>Now when I say <EM>essentially</EM> monospace above, the reason for that is that none of the CJK fonts are true monospaced fonts. They all (even the bitmap fonts) have the halfwidth characters taking up half as much space as the fullwidth ones, though.</FONT></P>
<P><FONT face=Tahoma>Most recently, Denis Bider asked (first of <a href="http://blogs.msdn.com/LarryOsterman/">Larry Osterman</A>, then of me (directly):</FONT></P><FONT face=Tahoma><FONT size=2>
<BLOCKQUOTE dir=ltr style="MARGIN-RIGHT: 0px">
<P><FONT face="Times New Roman"><EM>In our company, we observed the following apparent inconsistency in cmd.exe.</EM></FONT></P>
<P><FONT face="Times New Roman"><EM>If you execute cmd /?, you get this help text:</EM></FONT></P>
<P><FONT face="Times New Roman"><EM>/A - Causes the output of internal commands to a pipe or file to be ANSI</EM></FONT></P>
<P><FONT face="Times New Roman"><EM>/U - Causes the output of internal commands to a pipe or file to be Unicode</EM></FONT></P>
<P><FONT face="Times New Roman"><EM>But the fact is, the output of cmd /A is not actually ANSI. It is in the OEM code page. For example, if I try cmd /A echo csz &gt; file.txt, and then try to open file.txt in Notepad (which uses ANSI), I get garbage.</EM></FONT></P>
<P><FONT face="Times New Roman"><EM>Lots of other command line utilities (like those in Cygwin) actually use ANSI. So this is a problem - characters get corrupted across pipe boundaries; files get interpreted in incompatible ways.</EM></FONT></P>
<P><FONT face="Times New Roman"><EM>From a user's perspective, it seems somewhat logical to expect that if the /A flag description says it will produce ANSI, it should produce ANSI; not OEM.</EM></FONT></P>
<P><FONT face="Times New Roman"><EM>What do you think? Is this intentional or is it a problem?</EM></FONT></P></BLOCKQUOTE></FONT></FONT>
<P><FONT face=Tahoma>Well, since it is behavior that has been around for several versions, I would hesitate to call it a bug. I will run it up the flagpole here, but I assume the "fix" will be to just fix up the text in that help. Which is really all that they could do, since changing the behavior of the flag would break who knows how many scripts (well, if we made the change, we would know -- from all of the people complaining about the behavior change!).</FONT></P>
<P><FONT face=Tahoma>In the meantime though, I can recommend chcp.com, a nice little utility that will either display the active OEM code page in the console (if run with no parameters), or allow you to change that code page. You can look at some documentation on it <A href="http://www.microsoft.com/resources/documentation/windows/xp/all/proddocs/en-us/chcp.mspx">here</A>. Note that when you run this utility, is reports back the code page as the "Active code page". Not a 100% solution, but as good as the console will really allow.</FONT></P>
<P><FONT face=Tahoma>Did I mention that you may want to take a look at <a href="http://blogs.msdn.com/search.aspx?q=monad&amp;p=1">Monad</A>? :-)</FONT></P>
<P><FONT face=Tahoma></FONT>&nbsp;</P>
<P><FONT face=Tahoma color=#ff0000><EM>This post brought to you by</EM> "<FONT size=3>〷</FONT>" <EM>(<A href="http://www.fileformat.info/info/unicode/char/3037/index.htm">U+3037</A>, a.k.a. IDEOGRAPHIC TELEGRAPH LINE FEED SEPARATOR SYMBOL)</EM></FONT></P>
<hr/><p><a id="433775" href="#433775">#</a> <strong>Peter Ibbotson</strong> on 29 Jun 2005 7:59 AM:</p><div style="margin-left: 1em">One irritation with CHCP is that for raster fonts it only changes the fonts for full screen mode, not for windowed mode. <br>If you're using raster fonts the codepage is fixed at system install time and very hard to change, simply copying over the .FON files from a 437 installed system to an 850 installed system doesn't fix the problem (or at least last time I tried it didn't).<br><br>This is particularly noticable for old DOS apps that have screens with<br>╟──╢<br>line drawing on them.</div>
<p><a id="433812" href="#433812">#</a> <strong>Michael S. Kaplan</strong> on 29 Jun 2005 10:39 AM:</p><div style="margin-left: 1em">Hi Peter,<br><br>Any time you are doing anything vaguely international in the console, you should not use one of the raster, bitmap fonts. Ever.<br><br>Especially when you change the codepage. :-)</div>
<p><a id="433823" href="#433823">#</a> <strong>Tod Nelson</strong> on 29 Jun 2005 11:11 AM:</p><div style="margin-left: 1em">I agree. Switching to Lucida Console is one of the first steps of every new machine I set up.</div>
<p><a id="433881" href="#433881">#</a> <strong>David</strong> on 29 Jun 2005 1:12 PM:</p><div style="margin-left: 1em">There's a fairly nifty text editor, EmEditor (<a rel="nofollow" target="_new" href="http://www.emeditor.com/">http://www.emeditor.com</a>), that allows you to save text documents in any of a fairly large variety of encodings, and with or without BOMs in the case of Unicode. It also allows you to manually load (or reload) a text file in any of its various supported encodings. I find it very helpful. It costs like $40, but it's well worth every penny and then some the first time you *really* need it.</div>
<hr/><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2005/06/29/433824.html" title="Update on Community Server issues that seem to affect this blog">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2005/06/28/433639.html" title="Stop indiscriminate umlauting!">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2005-06">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2005-06-29">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2005/06/29/433669.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:41 GMT -->
</html>