<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2005/06/01/423711.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:41 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>Knock knock! Who's there? Kana! Kana Who?</title></head><body>
<h1>Knock knock! Who's there? Kana! Kana Who?</h1>
<p><em>by Michael S. Kaplan, published on 2005/06/01 02:31 -04:00, original URI: http://blogs.msdn.com/b/michkap/archive/2005/06/01/423711.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostNew -->
<P><FONT face=Tahoma>You Kana wonder how we order Japanese strings? :-)</FONT></P>
<P><FONT face=Tahoma>Some time yesterday, one of the testers over on the Shell team was curious about how collation works for the Japanese alphabet. The discussion was an interesting one, so I thought I would post the summary of all the infomation we talked about (with some examples for each interesting distinction) here.</FONT></P>
<P><FONT face=Tahoma>Note that this behavior relates to what is done on Windows (as well as SQL Server, Office, Windows CE, Active Dirctory, and every Microsoft product that either calls our APIs or uses our data). Your mileage for other platforms may certainly vary!</FONT></P>
<P><FONT face=Tahoma>Ok, on Windows, the Japanese Kana all sort in an implementation of the GoJuOn order, with the following principles:</FONT></P>
<UL>
<LI><FONT face=Tahoma>Traditional order for all letters<BR>e.g. ア before イ (<A href="http://www.fileformat.info/info/unicode/char/30a2/index.htm">U+30a2</A> aka <FONT size=2>KATAKANA LETTER A</FONT> before <A href="http://www.fileformat.info/info/unicode/char/30a4/index.htm">U+30a4</A> aka <FONT size=2>KATAKANA LETTER I</FONT>)</FONT> 
<LI><FONT face=Tahoma>Halfwidth sorts before fullwidth<BR>e.g. ｱ&nbsp;before ア (<A href="http://www.fileformat.info/info/unicode/char/ff71/index.htm">U+ff71</A> aka <FONT size=2>HALFWIDTH KATAKANA LETTER A</FONT> before&nbsp;<A href="http://www.fileformat.info/info/unicode/char/30a2/index.htm">U+30a2</A> <FONT size=2>KATAKANA LETTER A</FONT>)</FONT> 
<LI><FONT face=Tahoma>Small sorts before regular size<BR>e.g. ぁ before あ (<A href="http://www.fileformat.info/info/unicode/char/3041/index.htm">U+3041</A> aka <FONT size=2>HIRAGANA LETTER SMALL A</FONT> before&nbsp;<A href="http://www.fileformat.info/info/unicode/char/3042/index.htm">U+3042</A> <FONT size=2>HIRAGANA LETTER A</FONT>)</FONT> 
<LI><FONT face=Tahoma>Katakana sorts before Hiragana<BR>e.g. ア before あ (<A href="http://www.fileformat.info/info/unicode/char/30a2/index.htm">U+30a2</A> aka <FONT size=2>KATAKANA LETTER A</FONT> before <A href="http://www.fileformat.info/info/unicode/char/3042/index.htm">U+3042</A> aka <FONT size=2>HIRAGANA LETTER A</FONT>)</FONT> 
<LI><FONT face=Tahoma>Some almost lookalikes sort right after their near twins<BR>e.g. う before ゔ (<A href="http://www.fileformat.info/info/unicode/char/3046/index.htm">U+3046</A> aka <FONT size=2>HIRAGANA LETTER U</FONT> before <A href="http://www.fileformat.info/info/unicode/char/3094/index.htm">U+3094</A> aka <FONT size=2>HIRAGANA LETTER VU</FONT>)</FONT> 
<LI><FONT face=Tahoma>Circled comes after everything other type of a letter<BR>e.g.&nbsp;㋐ after あ (<A href="http://www.fileformat.info/info/unicode/char/32d0/index.htm">U+32d0</A> aka <FONT size=2>CIRCLED KATAKANA A</FONT> after <A href="http://www.fileformat.info/info/unicode/char/3041/index.htm">U+3041</A> <FONT size=2>HIRAGANA LETTER A</FONT> <EM>and all other letter A's</EM>)</FONT></LI></UL>
<P><FONT face=Tahoma>When you combine all these rules together, the order you get for the vowels would be:</FONT></P>
<P><FONT face=Tahoma size=6>ｧァｱアぁあ㋐ｨィｲイぃい㋑ｩゥｳウぅうヴゔ㋒ｪェｴエぇえ㋓ｫォｵオぉお㋔</FONT></P>
<P><FONT face=Tahoma>And then the other important things to note <FONT color=#ff0000 size=2><EM>(changes in red 1 June 2005 7:50am)</EM></FONT>:</FONT></P><FONT face=Tahoma>
<UL>
<LI><FONT face=Tahoma>A <STRIKE><FONT color=#d3d3d3>repeater</FONT></STRIKE><FONT color=#ff0000>Cho-On (prolonged sound mark) lengthens a vowel, so it</FONT>&nbsp;duplicates the weight of the preceeding character and subtracts&nbsp;a bit&nbsp;(so it sorts before)<BR>e.g. ぎー before ぎぎ (<A href="http://www.fileformat.info/info/unicode/char/304e/index.htm">U+304e</A> <A href="http://www.fileformat.info/info/unicode/char/30fc/index.htm">U+30fc</A> aka <FONT size=2>HIRAGANA LETTER GI, KATAKANA-HIRAGANA PROLONGED SOUND MARK</FONT> before two <FONT size=2>HIRAGANA LETTER GI</FONT>)</FONT> 
<LI><FONT color=#ff0000>An iteration mark duplicates a&nbsp;letter, so it duplicates the&nbsp;weight and adds a little bit (so it sorts right after)<BR><FONT size=2>e.g. きき before き々 (<A href="http://www.fileformat.info/info/unicode/char/304d/index.htm">U+304d</A> <A href="http://www.fileformat.info/info/unicode/char/304d/index.htm">U+304d</A> aka&nbsp;HIRAGANA LETTER KI; HIRAGANA LETTER KI&nbsp;before <A href="http://www.fileformat.info/info/unicode/char/304d/index.htm">U+304d</A> <A href="http://www.fileformat.info/info/unicode/char/3005/index.htm">U+3005</A>&nbsp;HIRAGANA LETTER KI; IDEOGRAPHIC ITERATION MARK)</FONT></FONT> 
<LI>With the judicious use of flags, you can ignore any or all of the distinctions, to make some or all of the letters within any of the following color groups to be equal:</LI></UL>
<P><FONT face=Tahoma size=6><FONT color=#0000ff>ｧァｱアぁあ㋐</FONT><FONT color=#800080>ｨィｲイぃい㋑</FONT><FONT color=#ff1493>ｩゥｳウぅうヴゔ㋒</FONT><FONT color=#008000>ｪェｴエぇえ㋓</FONT><FONT color=#ffa500>ｫォｵオぉお㋔</FONT></FONT></P></FONT>
<P><FONT face=Tahoma>In other words, everything on the same line below can be made to seem equal; everything on a different line cannot.</FONT></P>
<P><FONT face=Tahoma size=1>HALFWIDTH KATAKANA LETTER SMALL A; KATAKANA LETTER SMALL A; HALFWIDTH KATAKANA LETTER A; KATAKANA LETTER A; HIRAGANA LETTER SMALL A; HIRAGANA LETTER A; CIRCLED KATAKANA A <BR>HALFWIDTH KATAKANA LETTER SMALL I; KATAKANA LETTER SMALL I; HALFWIDTH KATAKANA LETTER I; KATAKANA LETTER I; HIRAGANA LETTER SMALL I; HIRAGANA LETTER I; CIRCLED KATAKANA I <BR>HALFWIDTH KATAKANA LETTER SMALL U; KATAKANA LETTER SMALL U; HALFWIDTH KATAKANA LETTER U; KATAKANA LETTER U; HIRAGANA LETTER SMALL U; HIRAGANA LETTER U; KATAKANA LETTER VU; HIRAGANA LETTER VU; CIRCLED KATAKANA U <BR>HALFWIDTH KATAKANA LETTER SMALL E; KATAKANA LETTER SMALL E; HALFWIDTH KATAKANA LETTER E; KATAKANA LETTER E; HIRAGANA LETTER SMALL E; HIRAGANA LETTER E; CIRCLED KATAKANA E <BR>HALFWIDTH KATAKANA LETTER SMALL O; KATAKANA LETTER SMALL O; HALFWIDTH KATAKANA LETTER O; KATAKANA LETTER O; HIRAGANA LETTER SMALL O; HIRAGANA LETTER O; CIRCLED KATAKANA O</FONT></P>
<P><FONT face=Tahoma>The rules for the flags affect all this? Well....</FONT></P>
<UL>
<LI><FONT face=Tahoma>NORM_IGNORENONSPACE removes the distinction of the circled letters and distinctions with letters like U and VU</FONT> 
<LI><FONT face=Tahoma>NORM_IGNORECASE removes the distinction of the small versus regular letters;</FONT> 
<LI><FONT face=Tahoma>NORM_IGNOREKANA removes the distinction between Hiragana and Katakana;</FONT> 
<LI><FONT face=Tahoma>NORM_IGNOREWIDTH removes the distinction between halfwidth and fullwidth.</FONT></LI></UL>
<P><FONT face=Tahoma>Now obviously Windows file names are "case insensitive" but we do not consider the "small" Kana and the "regular" Kana to be case pair (no one does, usually including native speakers)&nbsp;-- so you can have both of them in file names in the same directory, but you cannot use both as the same names in (for example) an Active Directory installation (in fact since all four flags are passed for AD, you cannot use any of the letters within the colored groups together in the same AD namespace).</FONT></P>
<P><FONT face=Tahoma>Ignoring something with these flags in this context means "treat them all as equal" -- which means you will have a non-deterministic ordering any time you have a big list with many of these variants comparing as equal. In my opinion, a deterministic order is always better, and not just because I try to be an orderly guy. :-)</FONT></P>
<P><FONT face=Tahoma>But your mileage may vary, of course!</FONT></P>
<P><FONT face=Tahoma>Now the Kanji are not sorted in pronunciation order, because as I mentioned back in December of last year, <a href="http://archives.miloush.net/michkap/archive/2004/12/27/332618.html">there is no pronunciation-based sort for Japanese on Windows</A>. But if you have entered the pronunciation information&nbsp;and are sorting by it (the way that for example an addressbook might choose do) then this order will be respected. Note that name readings (nanori'yomi) are sometimes (perhaps often) entirely individual and do not match any of the kun'yomi or on'yomi with which a given ideograph may be commonly associated. So such a feature makes a lot of sense if you know how all the names are pronounced; if not (for example in a large company address book) you may want an alternate way to search for names that you may know only by characters and not by pronunciation.</FONT></P>
<P><FONT face=Tahoma></FONT>&nbsp;</P>
<P><FONT face=Tahoma><FONT color=#ff0000><EM>This post brought to you by</EM> "ヰ" <EM>(<A href="http://www.fileformat.info/info/unicode/char/30f0/index.htm">U+30f0</A>, a.k.a. KATAKANA LETTER WI)</EM></FONT></FONT></P>
<hr/><p><a id="423781" href="#423781">#</a> <strong>Philip Newton</strong> on 1 Jun 2005 7:18 AM:</p><div style="margin-left: 1em">&gt; we do not consider the &quot;small&quot; Kana and the<br>&gt; &quot;regular&quot; Kana to be case pair (no one does,<br>&gt; usually including native speakers)<br><br>That makes sense to me since, for example, shuu &quot;state, province&quot; and shiyuu &quot;private ownership&quot; are phonemically different but differ in (kana) writing &quot;only&quot; through big-vs-little kana: しゅう vs しゆう.</div>
<p><a id="423784" href="#423784">#</a> <strong>Michael S. Kaplan</strong> on 1 Jun 2005 7:39 AM:</p><div style="margin-left: 1em">Robert --- you are correct, I did mess that one up. I think I will post the correction to that one....</div>
<p><a id="423835" href="#423835">#</a> <strong>Nicholas Allen</strong> on 1 Jun 2005 9:52 AM:</p><div style="margin-left: 1em">Using the kanji kurikaeshi (々) in hiragana looks weird.  There are separate repetition symbols for use in hiragana and katakana (in voiced and unvoiced variants) as well as a double kana repeat (again voiced+unvoiced).</div>
<p><a id="423872" href="#423872">#</a> <strong>Michael S. Kaplan</strong> on 1 Jun 2005 11:26 AM:</p><div style="margin-left: 1em">Good point, Nicholas. although Windows still respects the placement and does its best to follow the apparent intent....<br><br>So, good technically even if not so good linguistically. :-)</div>
<p><a id="423892" href="#423892">#</a> <strong>Eusebio Rufian-Zilbermann</strong> on 1 Jun 2005 12:37 PM:</p><div style="margin-left: 1em">The prolonged sound mark is  equivalent to actually adding a lowest-weight variation of the corresponding vowel (usually ア after -a sounds, イ after -e or -i sounds, and ウ after -o or -u sounds) for example, the word sensei could be written in Katakana as センセイ or as センセー. This replacement is why ぎー sorts before ぎぎ. The &quot;trick&quot; of duplicating and then substracting a bit, it works in most cases but it doesn't work when you're prolonging a vowel sound itself: if you sort アア and アー the prolonged sound mark sorts after the corresponding letter and not before. Try them with a phonetic sort in Winword ':)</div>
<p><a id="423938" href="#423938">#</a> <strong>Michael S. Kaplan</strong> on 1 Jun 2005 2:30 PM:</p><div style="margin-left: 1em">The implementation is not completely perfect in that sense -- we always show a slight difference between the two cases (but one that you can easily choose to ignore if you want to).</div>
<hr/><p><em>referenced by</em></p><div style="margin-left: 1em"><p>2010/02/17 <a href="http://archives.miloush.net/michkap/archive/2010/02/17/9964066.html">Knock knock! Who's there? Kana! Kana Who? I Kana got something wrong!</a></p><p>2007/09/21 <a href="http://archives.miloush.net/michkap/archive/2007/09/21/5027338.html">A&P of Sort Keys, part 10 (aka I've kana wanted to start talking about Japanese)</a></p><p>2007/04/01 <a href="http://archives.miloush.net/michkap/archive/2007/04/01/2004424.html">I Kana understand you, could you repeater that? (Part 2)</a></p><p>2007/03/29 <a href="http://archives.miloush.net/michkap/archive/2007/03/29/1985735.html">I Kana understand you, could you repeater that? (Part 1)</a></p><p>2006/09/19 <a href="http://archives.miloush.net/michkap/archive/2006/09/19/762106.html">Put in on my Tab, please</a></p><p>2006/01/03 <a href="http://archives.miloush.net/michkap/archive/2006/01/03/508579.html">'Acceptable' Japanese sort order?</a></p><p>2005/07/20 <a href="http://archives.miloush.net/michkap/archive/2005/07/20/440842.html">More on sort elements</a></p></div><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2005/06/01/424067.html" title="It&#39;s not quite done yet">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2005/05/31/423617.html" title="Not a Birds of a Feather, but something for TechEd 2005">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2005-06">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2005-06-01">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2005/06/01/423711.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:41 GMT -->
</html>