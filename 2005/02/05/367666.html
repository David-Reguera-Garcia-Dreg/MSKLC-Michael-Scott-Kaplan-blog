<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2005/02/05/367666.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:42 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>You can't ignore diacritics when a language does not give them diacritic weight</title></head><body>
<h1>You can't ignore diacritics when a language does not give them diacritic weight</h1>
<p><em>by Michael S. Kaplan, published on 2005/02/05 05:55 -05:00, original URI: http://blogs.msdn.com/b/michkap/archive/2005/02/05/367666.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostNew -->
<P>This post is about a not entirely intuitive fact that will be seen in the implementation of collation in Microsoft products. It affects the results of both <A title=CompareString href="http://msdn.microsoft.com/library/en-us/winui/winui/windowsuserinterface/resources/strings/stringreference/stringfunctions/comparestring.asp" target=_blank>CompareString</A> and <A title=LCMapString href="http://msdn.microsoft.com/library/en-us/intl/nls_5s2v.asp" target=_blank>LCMapString</A> in Windows, the results of using the <A title=CompareInfo href="http://msdn.microsoft.com/library/en-us/cpref/html/frlrfsystemglobalizationcompareinfoclasstopic.asp" target=_blank>CompareInfo</A> and Sortkey classes in the .NET Framework, and in the results in products like Jet and SQL Server.</P>
<P>To help show what is happening under the covers, I will use the sort keys.</P>
<P>We'll use the letters <STRONG>A</STRONG> (<A href="http://www.fileformat.info/info/unicode/char/0041/index.htm">U+0041</A>, LATIN CAPITAL LETTER A) and&nbsp;<STRONG>Ą</STRONG> (<A href="http://www.fileformat.info/info/unicode/char/0104/index.htm">U+0104</A>, a.k.a. LATIN CAPITAL LETTER A WITH OGONEK), as well as their lowercase counterparts. </P>
<P>When getting sort keys using the default table (LOCALE_INVARIANT), the weights look like the following:</P>
<BLOCKQUOTE dir=ltr>
<P><FONT face="Courier New"><FONT size=2><STRONG>a&nbsp;&nbsp;&nbsp; </STRONG></FONT><A href="http://www.fileformat.info/info/unicode/char/0061/index.htm"><FONT size=2><STRONG>U+0061</STRONG></FONT></A><FONT size=2><STRONG>&nbsp;&nbsp;&nbsp; <FONT color=#0000ff>0E 02</FONT> 01&nbsp;01 <FONT color=#ff0000>02</FONT> 01 01 00<BR>A&nbsp;&nbsp;&nbsp; </STRONG></FONT><A href="http://www.fileformat.info/info/unicode/char/0041/index.htm"><FONT size=2><STRONG>U+0041</STRONG></FONT></A><FONT size=2><STRONG>&nbsp;&nbsp;&nbsp; <FONT color=#0000ff>0E 02</FONT> 01&nbsp;01 <FONT color=#ff0000>12</FONT> 01 01 00<BR>ą&nbsp;&nbsp;&nbsp; </STRONG></FONT><A href="http://www.fileformat.info/info/unicode/char/0105/index.htm"><FONT size=2><STRONG>U+0105</STRONG></FONT></A><FONT size=2><STRONG>&nbsp;&nbsp;&nbsp; <FONT color=#0000ff>0E 02</FONT> 01 <FONT color=#008000>1B</FONT> 01 <FONT color=#ff0000>02</FONT> 01 01 00<BR>Ą&nbsp;&nbsp;&nbsp; </STRONG></FONT><A href="http://www.fileformat.info/info/unicode/char/0104/index.htm"><FONT size=2><STRONG>U+0104</STRONG></FONT></A><FONT size=2><STRONG>&nbsp;&nbsp;&nbsp; <FONT color=#0000ff>0E 02</FONT> 01 <FONT color=#008000>1B</FONT> 01 <FONT color=#ff0000>12</FONT> 01 01 00</STRONG></FONT></FONT></P></BLOCKQUOTE>
<P>Note the Unicode weights (in blue), the diacritic weights (in green) and the case weights (in red). Now when we ignore case:</P>
<BLOCKQUOTE dir=ltr>
<P><FONT face="Courier New"><STRONG><FONT size=2>a&nbsp;&nbsp;&nbsp; </FONT></STRONG><A href="http://www.fileformat.info/info/unicode/char/0061/index.htm"><STRONG><FONT size=2>U+0061</FONT></STRONG></A><STRONG><FONT size=2>&nbsp;&nbsp;&nbsp; <FONT color=#0000ff>0E 02</FONT> 01&nbsp;01 <FONT color=#ff0000>02</FONT> 01 01 00<BR>A&nbsp;&nbsp;&nbsp; </FONT></STRONG><A href="http://www.fileformat.info/info/unicode/char/0041/index.htm"><STRONG><FONT size=2>U+0041</FONT></STRONG></A><STRONG><FONT size=2>&nbsp;&nbsp;&nbsp; <FONT color=#0000ff>0E 02</FONT> 01&nbsp;01&nbsp;<FONT color=#ff0000>02</FONT> 01 01 00<BR>ą&nbsp;&nbsp;&nbsp; </FONT></STRONG><A href="http://www.fileformat.info/info/unicode/char/0105/index.htm"><STRONG><FONT size=2>U+0105</FONT></STRONG></A><STRONG><FONT size=2>&nbsp;&nbsp;&nbsp; <FONT color=#0000ff>0E 02</FONT> 01 <FONT color=#008000>1B</FONT> 01 <FONT color=#ff0000>02</FONT> 01 01 00<BR>Ą&nbsp;&nbsp;&nbsp; </FONT></STRONG><A href="http://www.fileformat.info/info/unicode/char/0104/index.htm"><STRONG><FONT size=2>U+0104</FONT></STRONG></A><STRONG><FONT size=2>&nbsp;&nbsp;&nbsp; <FONT color=#0000ff>0E 02</FONT> 01 <FONT color=#008000>1B</FONT> 01 <FONT color=#ff0000>02</FONT> 01 01 00</FONT></STRONG></FONT></P></BLOCKQUOTE>
<P>And when we ignore diacritics:</P>
<BLOCKQUOTE dir=ltr>
<P><FONT face="Courier New"><FONT size=2><STRONG>a&nbsp;&nbsp;&nbsp; </STRONG></FONT><A href="http://www.fileformat.info/info/unicode/char/0061/index.htm"><FONT size=2><STRONG>U+0061</STRONG></FONT></A><FONT size=2><STRONG>&nbsp;&nbsp;&nbsp; <FONT color=#0000ff>0E 02</FONT> 01&nbsp;01 <FONT color=#ff0000>02</FONT> 01 01 00<BR>A&nbsp;&nbsp;&nbsp; </STRONG></FONT><A href="http://www.fileformat.info/info/unicode/char/0041/index.htm"><FONT size=2><STRONG>U+0041</STRONG></FONT></A><FONT size=2><STRONG>&nbsp;&nbsp;&nbsp; <FONT color=#0000ff>0E 02</FONT> 01&nbsp;01 <FONT color=#ff0000>12</FONT> 01 01 00<BR>ą&nbsp;&nbsp;&nbsp; </STRONG></FONT><A href="http://www.fileformat.info/info/unicode/char/0105/index.htm"><FONT size=2><STRONG>U+0105</STRONG></FONT></A><FONT size=2><STRONG>&nbsp;&nbsp;&nbsp; <FONT color=#0000ff>0E 02</FONT> 01&nbsp;01 <FONT color=#ff0000>02</FONT> 01 01 00<BR>Ą&nbsp;&nbsp;&nbsp; </STRONG></FONT><A href="http://www.fileformat.info/info/unicode/char/0104/index.htm"><FONT size=2><STRONG>U+0104</STRONG></FONT></A><FONT size=2><STRONG>&nbsp;&nbsp;&nbsp; <FONT color=#0000ff>0E 02</FONT> 01&nbsp;01 <FONT color=#ff0000>12</FONT> 01 01 00</STRONG></FONT></FONT></P></BLOCKQUOTE>
<P>And then we ignore both:</P>
<BLOCKQUOTE dir=ltr>
<P><FONT face="Courier New"><STRONG><FONT size=2>a&nbsp;&nbsp;&nbsp; </FONT></STRONG><A href="http://www.fileformat.info/info/unicode/char/0061/index.htm"><STRONG><FONT size=2>U+0061</FONT></STRONG></A><STRONG><FONT size=2>&nbsp;&nbsp;&nbsp; <FONT color=#0000ff>0E 02</FONT> 01&nbsp;01 <FONT color=#ff0000>02</FONT> 01 01 00<BR>A&nbsp;&nbsp;&nbsp; </FONT></STRONG><A href="http://www.fileformat.info/info/unicode/char/0041/index.htm"><STRONG><FONT size=2>U+0041</FONT></STRONG></A><STRONG><FONT size=2>&nbsp;&nbsp;&nbsp; <FONT color=#0000ff>0E 02</FONT> 01&nbsp;01&nbsp;<FONT color=#ff0000>02</FONT> 01 01 00<BR>ą&nbsp;&nbsp;&nbsp; </FONT></STRONG><A href="http://www.fileformat.info/info/unicode/char/0105/index.htm"><STRONG><FONT size=2>U+0105</FONT></STRONG></A><STRONG><FONT size=2>&nbsp;&nbsp;&nbsp; <FONT color=#0000ff>0E 02</FONT> 01&nbsp;01 <FONT color=#ff0000>02</FONT> 01 01 00<BR>Ą&nbsp;&nbsp;&nbsp; </FONT></STRONG><A href="http://www.fileformat.info/info/unicode/char/0104/index.htm"><STRONG><FONT size=2>U+0104</FONT></STRONG></A><STRONG><FONT size=2>&nbsp;&nbsp;&nbsp; <FONT color=#0000ff>0E 02</FONT> 01&nbsp;01 <FONT color=#ff0000>02</FONT> 01 01 00</FONT></STRONG></FONT></P></BLOCKQUOTE>
<P>Clearly, in the default table LATIN CAPITAL LETTER A WITH OGONEK is little more than a LATIN CAPITAL LETTER A with a hook in it's foot. A small diacritic weight is added to show that it is still primarily a LATIN CAPITAL LETTER A. And the act of ignoring the diacritic gives identical results to when the diacritic was never there in the first place -- you can see it right in the weights.</P>
<P>Now, how about when we move to Polish, LCID 0x00000415? In Polish, LATIN CAPITAL LETTER A WITH OGONEK is a letter with a unique Unicode weight, and this causes a difference in the results:</P>
<BLOCKQUOTE dir=ltr>
<P><FONT face="Courier New"><STRONG><FONT size=2>a&nbsp;&nbsp;&nbsp; </FONT></STRONG><A href="http://www.fileformat.info/info/unicode/char/0061/index.htm"><STRONG><FONT size=2>U+0061</FONT></STRONG></A><STRONG><FONT size=2>&nbsp;&nbsp;&nbsp; <FONT color=#0000ff>0E 02</FONT> 01&nbsp;01 <FONT color=#ff0000>02</FONT> 01 01 00<BR>A&nbsp;&nbsp;&nbsp; </FONT></STRONG><A href="http://www.fileformat.info/info/unicode/char/0041/index.htm"><STRONG><FONT size=2>U+0041</FONT></STRONG></A><STRONG><FONT size=2>&nbsp;&nbsp;&nbsp; <FONT color=#0000ff>0E 02</FONT> 01&nbsp;01 <FONT color=#ff0000>12</FONT> 01 01 00<BR>ą&nbsp;&nbsp;&nbsp; </FONT></STRONG><A href="http://www.fileformat.info/info/unicode/char/0105/index.htm"><STRONG><FONT size=2>U+0105</FONT></STRONG></A><STRONG><FONT size=2>&nbsp;&nbsp;&nbsp; <FONT color=#0000ff>0E 04</FONT> 01&nbsp;01 <FONT color=#ff0000>02</FONT> 01 01 00<BR>Ą&nbsp;&nbsp;&nbsp; </FONT></STRONG><A href="http://www.fileformat.info/info/unicode/char/0104/index.htm"><STRONG><FONT size=2>U+0104</FONT></STRONG></A><STRONG><FONT size=2>&nbsp;&nbsp;&nbsp; <FONT color=#0000ff>0E 04</FONT> 01&nbsp;01 <FONT color=#ff0000>12</FONT> 01 01 00</FONT></STRONG></FONT></P></BLOCKQUOTE>
<P>Do you see what happened here? Since in Polish LATIN CAPITAL LETTER A WITH OGONEK has a unique Unicode weight, ignoring the case weight has&nbsp;a predictable effect:</P>
<BLOCKQUOTE dir=ltr><FONT face="Courier New" size=1>
<P><FONT face="Courier New"><STRONG><FONT size=2>a&nbsp;&nbsp;&nbsp; </FONT></STRONG><A href="http://www.fileformat.info/info/unicode/char/0061/index.htm"><STRONG><FONT size=2>U+0061</FONT></STRONG></A><STRONG><FONT size=2>&nbsp;&nbsp;&nbsp; <FONT color=#0000ff>0E 02</FONT> 01&nbsp;01 <FONT color=#ff0000>02</FONT> 01 01 00<BR>A&nbsp;&nbsp;&nbsp; </FONT></STRONG><A href="http://www.fileformat.info/info/unicode/char/0041/index.htm"><STRONG><FONT size=2>U+0041</FONT></STRONG></A><STRONG><FONT size=2>&nbsp;&nbsp;&nbsp; <FONT color=#0000ff>0E 02</FONT> 01&nbsp;01 <FONT color=#ff0000>02</FONT> 01 01 00<BR>ą&nbsp;&nbsp;&nbsp; </FONT></STRONG><A href="http://www.fileformat.info/info/unicode/char/0105/index.htm"><STRONG><FONT size=2>U+0105</FONT></STRONG></A><STRONG><FONT size=2>&nbsp;&nbsp;&nbsp; <FONT color=#0000ff>0E 04</FONT> 01&nbsp;01 <FONT color=#ff0000>02</FONT> 01 01 00<BR>Ą&nbsp;&nbsp;&nbsp; </FONT></STRONG><A href="http://www.fileformat.info/info/unicode/char/0104/index.htm"><STRONG><FONT size=2>U+0104</FONT></STRONG></A><STRONG><FONT size=2>&nbsp;&nbsp;&nbsp; <FONT color=#0000ff>0E 04</FONT> 01&nbsp;01 <FONT color=#ff0000>02</FONT> 01 01 00</FONT></STRONG></FONT></P></BLOCKQUOTE>
<P dir=ltr></FONT>And Ignoring the diacritic weight will have no effect whatsoever (since there is no diacritic weight to ignore):</P>
<BLOCKQUOTE dir=ltr>
<P><FONT face="Courier New"><FONT size=2><STRONG>a&nbsp;&nbsp;&nbsp; </STRONG></FONT><A href="http://www.fileformat.info/info/unicode/char/0061/index.htm"><FONT size=2><STRONG>U+0061</STRONG></FONT></A><FONT size=2><STRONG>&nbsp;&nbsp;&nbsp; <FONT color=#0000ff>0E 02</FONT> 01&nbsp;01 <FONT color=#ff0000>02</FONT> 01 01 00<BR>A&nbsp;&nbsp;&nbsp; </STRONG></FONT><A href="http://www.fileformat.info/info/unicode/char/0041/index.htm"><FONT size=2><STRONG>U+0041</STRONG></FONT></A><FONT size=2><STRONG>&nbsp;&nbsp;&nbsp; <FONT color=#0000ff>0E 02</FONT> 01&nbsp;01 <FONT color=#ff0000>12</FONT> 01 01 00<BR>ą&nbsp;&nbsp;&nbsp; </STRONG></FONT><A href="http://www.fileformat.info/info/unicode/char/0105/index.htm"><FONT size=2><STRONG>U+0105</STRONG></FONT></A><FONT size=2><STRONG>&nbsp;&nbsp;&nbsp; <FONT color=#0000ff>0E 04</FONT> 01&nbsp;01 <FONT color=#ff0000>02</FONT> 01 01 00<BR>Ą&nbsp;&nbsp;&nbsp; </STRONG></FONT><A href="http://www.fileformat.info/info/unicode/char/0104/index.htm"><FONT size=2><STRONG>U+0104</STRONG></FONT></A><FONT size=2><STRONG>&nbsp;&nbsp;&nbsp; <FONT color=#0000ff>0E 04</FONT> 01&nbsp;01 <FONT color=#ff0000>12</FONT> 01 01 00</STRONG></FONT></FONT></P></BLOCKQUOTE>
<P>So the net effect is that for Polish, passing a NORM_IGNORENONSPACE flag in Windows, a <A title=CompareOptions href="http://msdn.microsoft.com/library/en-us/cpref/html/frlrfsystemglobalizationcompareoptionsclasstopic.asp" target=_blank>CompareOptions</A>.IgnoreNonspace in the .NET Framework, or a collation in SQL Server such as Polish_CI_AI (Polish, case insensitive, accent insensitive) will never see LATIN CAPITAL LETTER A WITH OGONEK as a LATIN CAPITAL LETTER A. Because Polish does not give the letter diacritic weight.</P>
<P>This is a common issue, whether you look at <STRONG>å</STRONG> (<A href="http://www.fileformat.info/info/unicode/char/00e5/index.htm">U+00e5</A>, a.k.a. LATIN SMALL LETTER A WITH RING ABOVE) in Swedish, <STRONG>Č</STRONG> (<A href="http://www.fileformat.info/info/unicode/char/010c/index.htm">U+010c</A>, a.k.a.&nbsp;LATIN CAPITAL LETTER C WITH CARON) in&nbsp;Slovenian, or any of the other hundreds of examples that exist in supported collations. The key is that in each case you must consider not only whether the character appears to have a diacritic on them but how the language is looking at the string....</P>
<P><FONT color=#800080><EM>This post brought to you by</EM> "Ą" <EM>(<A href="http://www.fileformat.info/info/unicode/char/0104/index.htm">U+0104</A>, a.k.a. LATIN CAPITAL LETTER A WITH OGONEK)</EM></FONT></P>
<hr/><p><a id="367731" href="#367731">#</a> <strong>CN</strong> on 5 Feb 2005 7:40 AM:</p><div style="margin-left: 1em">Are there any &quot;diacritic&quot; characters that are treated like they were separate letters in the default table?</div>
<p><a id="367737" href="#367737">#</a> <strong>RolfBjarne</strong> on 5 Feb 2005 8:10 AM:</p><div style="margin-left: 1em">Even though this might seem a little bit strange, it is indeed correct, for even though the letters &quot;a&quot; and &quot;&#229;&quot; look very similar, in Norwegian (and Swedish) they are two different letters, just like &quot;a&quot; and &quot;b&quot; in English.</div>
<p><a id="367768" href="#367768">#</a> <strong>Michael Kaplan</strong> on 5 Feb 2005 10:43 AM:</p><div style="margin-left: 1em">CN -- no, the default table stays pretty clean of that sort of thing. It is something for specific languages with different conventions.<br><br>RolfBjarne -- exactly. But it is amazing how often it is considered a bug when a developer runs across the issue, especially in other products like SQL Server or Outlook.</div>
<p><a id="367800" href="#367800">#</a> <strong>CN</strong> on 5 Feb 2005 1:04 PM:</p><div style="margin-left: 1em">Do they ever encounter that &quot;Vindovs&quot; is equal to &quot;Windows&quot; while using the same flag? To get back to the original question, that is one case where the default table will consider characters as different, while a few locales think that they are identical/variations of each other, and within the set of ordinary latin letters.<br><br>BTW, I know this is not the place to mention it -- but the signature listed for <a title="CompareString" href="http://msdn.microsoft.com/library/en-us/winui/winui/windowsuserinterface/resources/strings/stringreference/stringfunctions/comparestring.asp" target="_blank">CompareString</a> in MSDN Library is wrong! When I first looked it upp I started wondering if it only took atom strings or something else that could be mapped to a DWORD easier than a pointer. Thankfully (in this case), the parameter names were Hungarian...</div>
<p><a id="367803" href="#367803">#</a> <strong>Michael Kaplan</strong> on 5 Feb 2005 1:09 PM:</p><div style="margin-left: 1em">Well, not true ever in the default table, but in some languages the V and the W are to be treated the same. See Finnish and Swedish, for example: <a target="_new" href="http://www.microsoft.com/globaldev/dis_v1/disv1.asp?DID=dis33d&amp;File=S24C3.asp">http://www.microsoft.com/globaldev/dis_v1/disv1.asp?DID=dis33d&amp;File=S24C3.asp</a><br><br>The <a title="CompareString" href="http://msdn.microsoft.com/library/en-us/winui/winui/windowsuserinterface/resources/strings/stringreference/stringfunctions/comparestring.asp" target="_blank">CompareString</a> doc bug was reported by someone here, before. See <a target="_new" href="http://archives.miloush.net/michkap/archive/2005/02/02/365251.html#366109">http://blogs.msdn.com/michkap/archive/2005/02/02/365251.aspx#366109</a> . :-)</div>
<p><a id="367828" href="#367828">#</a> <strong>CN</strong> on 5 Feb 2005 2:37 PM:</p><div style="margin-left: 1em">I know it isn't true in the default table, but I meant that there is a case where the default table makes a distinction, while the locale tables do not. Your examples with the accented characters were the other way around, and I found it interesting that they are in both ways.<br><br>Oooops, and so recent... I guess I read that posting while it was fresh and then never got back to it. Hmhm...</div>
<p><a id="367857" href="#367857">#</a> <strong>Michael Kaplan</strong> on 5 Feb 2005 4:41 PM:</p><div style="margin-left: 1em">Ah, I see what you are saying -- yes, you are right. Things really do go in both directions.</div>
<p><strong>Hitesh Patel</strong> on 23 Nov 2012 4:02 AM:</p><div style="margin-left: 1em"><p>Hello Sir, </p>
<p>I have a problem my question when i fetch the data in may class and set in text view in android not proper character display it.and ask question in stack overflow but anyone proper answer suggest me .please help me sir.and My Question link below:</p>
<p><a rel="nofollow" target="_new" href="http://stackoverflow.com/questions/13452621/how-can-i-display-latin-words-in-android?lq=1">stackoverflow.com/.../how-can-i-display-latin-words-in-android</a></p>
<p>Advance Thanks!! &nbsp;</p>
</div>
<hr/><p><em>referenced by</em></p><div style="margin-left: 1em"><p>2007/09/14 <a href="http://archives.miloush.net/michkap/archive/2007/09/14/4905625.html">A&P of Sort Keys, part 4 (aka It isn't a race but let's make an EXCEPTION and cross the Finnish line)</a></p><p>2007/04/11 <a href="http://archives.miloush.net/michkap/archive/2007/04/11/2087685.html">Microsoft is not uncaron^H^Hing about the issue!</a></p><p>2007/02/26 <a href="http://archives.miloush.net/michkap/archive/2007/02/26/1761051.html">The search for someone who does Search correctly</a></p><p>2007/02/25 <a href="http://archives.miloush.net/michkap/archive/2007/02/25/1756443.html">à ≠ a (unless à = a)</a></p><p>2006/10/12 <a href="http://archives.miloush.net/michkap/archive/2006/10/12/818566.html">Who is the Hacek Girl?</a></p><p>2006/01/29 <a href="http://archives.miloush.net/michkap/archive/2006/01/29/518777.html">Handling multilingual data in SQL Server</a></p><p>2006/01/12 <a href="http://archives.miloush.net/michkap/archive/2006/01/12/511884.html">The creation of sort keys does not always make sense</a></p><p>2005/12/29 <a href="http://archives.miloush.net/michkap/archive/2005/12/29/508045.html">What's a secondary distinction?</a></p></div><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2005/02/05/367904.html" title="Now playing [do you really care?]....">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2005/02/04/367430.html" title="When MSLU meets ATL or WTL">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2005-02">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2005-02-05">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2005/02/05/367666.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:42 GMT -->
</html>