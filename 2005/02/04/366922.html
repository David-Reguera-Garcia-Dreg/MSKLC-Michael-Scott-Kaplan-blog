<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2005/02/04/366922.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:42 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>GEOID -- The LCIDs maligned little brother....</title></head><body>
<h1>GEOID -- The LCIDs maligned little brother....</h1>
<p><em>by Michael S. Kaplan, published on 2005/02/04 04:41 -05:00, original URI: http://blogs.msdn.com/b/michkap/archive/2005/02/04/366922.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostNew -->
<P><FONT size=1><EM>(Matt, never believe I don't hear you when you are saying things. This one is for you!)</EM></FONT></P>
<P>Inside of Microsoft, there is a huge database of location data. That database is used to support products like MapPoint, Passport, Windows, and others with important information that each can use when they provide data about locations -- countries, regions, provinces, states, cities, and so on. How important it is varies from product to product (of course). But on Windows it is particularly dissed, and that ought to change.</P>
<P>In Windows, the primary key of this database is the GEOID, and many of the core GEOID values can be found in the <A href="http://msdn.microsoft.com/library/en-us/intl/nls_locations.asp">Table of Geographic Locations</A>.</P>
<P>(Lest you think I was talking out of my hat when I was talking about a huge shared database, compare the values in that table with those in MapPoint's <A href="http://msdn.microsoft.com/library/en-us/mappoint2004/BIZOMVGeoMapRegion.asp">GeoMapRegion values</A> table!)</P>
<P>We have a program manager who started with us a while back and who has owned our Regional Options control panel applet for most of that time. One of the first things he noticed about Regional Options were that it was not driven by region, but by locale (which is itself primarily driven by language and secondarily by region as a tiebreaker any time the language alone would not give sufficient information). He was struck by how flawed that was as a concept, and has been trying to get us to think a bit beyond our current model. The model that&nbsp;gives the regional differences less importance&nbsp;than they deserve.</P>
<P>Although it is in my fundamental nature as a developer to disagree with him as a program manager (insert grin here), I will try to rise above that nature as a technical lead and admit that he is 100% correct. It does not make a lot of sense. </P>
<P>(teams throughout Microsoft start to get nervous)</P>
<P>However, the fundamental support of the locale model has been a central means of international support in almost every product at Microsoft. And there is no good way to reverse that and make everyone rewrite their functionality.</P>
<P>(teams throughout Microsoft breathe sighs of relief)</P>
<P>But this is no excuse for bad decisions in functionality!</P>
<P>APIs like <A title=GetUserGeoID href="http://msdn.microsoft.com/library/en-us/intl/nls_6884.asp" target=_blank>GetUserGeoID</A> are the most intuitive and obvious way to find out where someone is located. It is the answer a user gives in Regional and Language Options when asked for their location. The text in that dialog claims that the setting is used "<STRONG><FONT color=#ff0000>To help services provide you with local information, such as news and weather.</FONT></STRONG>" But how can we make those words true if applications Internet Explorer make their fundemental decision about the setting that controls the support of regional content on the default user locale (an LCID) rather than the geographical region (a GEOID)? As I said the other day when I asked "<A id=_fe4a7ebadeacf48_HomePageDays_DaysList__ctl2_DayItem_DayList__ctl0_TitleUrl href="http://archives.miloush.net/michkap/archive/2005/02/01/364707.html">What is my locale? Well, which locale do you mean?</A>" the default user locale is meant to impart the user's choice in format and collation preferences, NOT their location.&nbsp;So IE&nbsp;should be using the GEO settings for that!</P>
<P>Some will freak out at this point -- what would such a change to do users? </P>
<P>Well, let us say that we made the two settings act as being tied together by default, so that if you changed the locale that by default the GEOID would be changed with it. </P>
<P>This is easy since there is an under-documented LCType for <A title=GetLocaleInfo href="http://msdn.microsoft.com/library/en-us/intl/nls_34rz.asp" target=_blank>GetLocaleInfo</A> that retieves the GEOID that is asociated with a locale<FONT size=1><SUP>1</SUP></FONT> -- LOCALE_IGEOID (the value is 0x0000005B and the functionality has been since Windows XP). Any time the user explicitly changes the location after seeing the description in RED above, wouldn't the user be expecting IE to follow such a request?</P>
<P>Such a solution would solve the real problem for almost all users, and perhaps other&nbsp;folks for whom region is important&nbsp;(Windows Media Player, Passport,&nbsp;and news services for starters) would be able to start using the GEOID preference of the user as a starting point. Even the time zone settings would get an effective first guess with such a system (even if tweaking as required to obtain the best answers).</P>
<P>Because GEOIDs kind of rock. They provide a lot of potentially interesting&nbsp;information, as the <A title=SYSGEOTYPE href="http://msdn.microsoft.com/library/en-us/intl/nls_7d2d.asp" target=_blank>SYSGEOTYPE</A> enumeration defines:</P>
<UL>
<LI><STRONG>GEO_NATION</STRONG> - <FONT size=1>GEOID of a nation. This value is stored in a long integer. </FONT>
<LI><STRONG>GEO_LATITUDE</STRONG> - <FONT size=1>The latitude of the GEOID. This value is stored in a floating point number. </FONT>
<LI><STRONG>GEO_LONGITUDE</STRONG> - <FONT size=1>The longitude of the GEOID. This value is stored in a floating point number. </FONT>
<LI><STRONG>GEO_ISO2</STRONG> - <FONT size=1>The ISO 2-letter country/region code. This value is stored in a string. </FONT>
<LI><STRONG>GEO_ISO3</STRONG> - <FONT size=1>The ISO 3-letter country/region code. This value is stored in a string. </FONT>
<LI><STRONG>GEO_RFC1766</STRONG> - <FONT size=1>An RFC1766-style string derived from the locale and GEOID (for nations only). </FONT>
<LI><STRONG>GEO_LCID</STRONG>&nbsp;- <FONT size=1>A locale ID (LCID) derived from the language and the GeoID (for nations only). </FONT>
<LI><STRONG>GEO_FRIENDLYNAME</STRONG> - <FONT size=1>The friendly name of the nation. Example: Germany. This value is stored in a string. </FONT>
<LI><STRONG>GEO_OFFICIALNAME</STRONG> - <FONT size=1>The official name of the nation. Example: Federal Republic of Germany. This value is stored in a string. </FONT>
<LI><STRONG>GEO_TIMEZONES</STRONG> - <FONT size=1>The time zones associated with the GEOID. These values are stored in an array of IDs. </FONT>
<LI><STRONG>GEO_OFFICIALLANGUAGES</STRONG> - <FONT size=1>The official languages of the nation at the GEOID. These values are stored in an array of LCIDs. </FONT></LI></UL>
<P>Shouldn't we all consider using the result of GetUserGeoID when the question is "where am I?" rather than any of the various locale settings?</P>
<P>I think it really is&nbsp;enough of this "I don't want to make a&nbsp;a change because what if no one else does?" problems -- let's break the logjam and do the right thing, and work to make sure it is a better situation for everyone!</P>
<P>(Though with that said I will go in to work and still be just as cautious about any attempt at a suggestion to undo the current archeciture, beyond the (suggested above) step of having LOCAL_USER_DEFAULT drive the GetUserGeoID value!)</P>
<P>&nbsp;</P>
<P><FONT size=1><EM>1 - There is also a <A title=RegionInfo href="http://msdn.microsoft.com/library/en-us/cpref/html/frlrfsystemglobalizationregioninfoclasstopic.asp" target=_blank>RegionInfo</A>.GeoID property that has been added to the Whidbey release of the .NET Framework, for a lot of the same reasons that inspired that LCType. The actual regions that fill the RegionInfo collection are locale-based, but at least now you can tie them together a little more than previously. Getting GEO information as listed in the SYSGEOTYPE enumeration is still not possible using the .NET Framework, though. Maybe something for next time....</EM></FONT></P>
<P>&nbsp;</P>
<P><FONT color=#800080><EM>This post brought to you by </EM>"<FONT size=3>âœˆ</FONT>"<EM> (<A href="http://www.fileformat.info/info/unicode/char/2708/index.htm">U+2708</A>, a.k.a. AIRPLANE)</EM></FONT></P>
<hr/><p><a id="366967" href="#366967">#</a> <strong>Jonathan Wilson</strong> on 4 Feb 2005 5:58 AM:</p><div style="margin-left: 1em">I imagine that managing this database must be a headache.<br>Especially when you consider that if you get geographic or geopolitical information wrong, it can cause big problems. (for example, is there any way to list what country the region of kashmir is in without pissing someone off?)<br></div>
<p><a id="367029" href="#367029">#</a> <strong>Michael Kaplan</strong> on 4 Feb 2005 7:59 AM:</p><div style="margin-left: 1em">Well, any time some issue is updated, it obviously must be updated....<br><br>You may also have successfully hit on one os the reasons why MapPoint does not cover all locations in the world? :-)</div>
<p><a id="367404" href="#367404">#</a> <strong>Ivan Petrov</strong> on 4 Feb 2005 1:44 PM:</p><div style="margin-left: 1em">(Ivan, I have moved your comment to <a target="_new" href="http://archives.miloush.net/michkap/archive/2005/01/31/363007.html#367392">http://blogs.msdn.com/michkap/articles/363007.aspx#367392</a> without prejudice since it was horribly offtopic for here)</div>
<p><a id="367418" href="#367418">#</a> <strong>Ruben</strong> on 4 Feb 2005 2:01 PM:</p><div style="margin-left: 1em">Would you care to explain a little further what the heck the use is for <a title="RegionInfo" href="http://msdn.microsoft.com/library/en-us/cpref/html/frlrfsystemglobalizationregioninfoclasstopic.asp" target="_blank">RegionInfo</a>.GeoId without any of the <a title="SYSGEOTYPE" href="http://msdn.microsoft.com/library/en-us/intl/nls_7d2d.asp" target="_blank">SYSGEOTYPE</a> information? Who needs a GeoId when the only way to do something with it, is by P/Invoking to Win32?<br><br>But then again, what is the use for a TimeZone class, when the only time zone supported is the current time zone?</div>
<p><a id="367434" href="#367434">#</a> <strong>Michael Kaplan</strong> on 4 Feb 2005 2:12 PM:</p><div style="margin-left: 1em">Ruben -- one is for custom cultures (which eventually become custom locales), and the other is the along the lines of &quot;maybe next version&quot;....<br><br>Both of which will be interesting topics for another day!)</div>
<p><a id="367456" href="#367456">#</a> <strong>Ruben (176)</strong> on 4 Feb 2005 2:56 PM:</p><div style="margin-left: 1em">Well, I don't quite see the custom cultures argument, unless it's some internal necessity in Windows to always assign a GeoId to a locale. But then again, if it's just an integer without context, why not give it the value 0. Just as meaningful as 221, which btw seems to be the GeoId for Sweden, according to the .NET SDK sample on GeoId. Who knew.<br><br>Anyway, great blog! I just love topics where no-one will ever be right and it's all one jolly mess of compromises.</div>
<p><strong>Drewfus</strong> on 2 Feb 2010 10:28 PM:</p><div style="margin-left: 1em"><P>The Table of Geographic Locations has moved to:</P>
<P><A href="http://msdn.microsoft.com/en-us/library/dd374073(VS.85).aspx">http://msdn.microsoft.com/en-us/library/dd374073(VS.85).aspx</A></P>
<P>I've always thought that regional settings were too, um, regional - that there should be a way of incorporating international standards into setup answer files that overrides regional and other defaults.</P>
<P>Example for Winnt.sif:</P>
<P>[Compliance]</P>
<P>;Date/time formatting</P>
<P>ISO9660=1</P>
<P>;Paper sizes</P>
<P>ISO216=1</P>
<P>This would seem/look more professional than a series of reg add commands.</P></div>
<hr/><p><em>referenced by</em></p><div style="margin-left: 1em"><p>2010/02/14 <a href="http://archives.miloush.net/michkap/archive/2010/02/14/9963164.html">Whither RegionInfo?</a></p><p>2007/12/13 <a href="http://archives.miloush.net/michkap/archive/2007/12/13/6689013.html">If you play with your gadget, there are all kinds of problems you can run into</a></p><p>2006/12/26 <a href="http://archives.miloush.net/michkap/archive/2006/12/26/1364585.html">On holiday? Outlook might try to tell you where....</a></p><p>2006/08/19 <a href="http://archives.miloush.net/michkap/archive/2006/08/19/706950.html">What the hell is up with Timor-Leste?</a></p><p>2006/03/10 <a href="http://archives.miloush.net/michkap/archive/2006/03/10/548670.html">Setting the location in unattend?</a></p><p>2005/12/10 <a href="http://archives.miloush.net/michkap/archive/2005/12/10/502415.html">CurrentRegion is not based on the GEOID</a></p><p>2005/06/26 <a href="http://archives.miloush.net/michkap/archive/2005/06/26/432874.html">Client side locale settings on the server?</a></p><p>2005/05/28 <a href="http://archives.miloush.net/michkap/archive/2005/05/28/422808.html">Time zones and locations and keyboards, oh my!</a></p></div><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2005/02/04/367430.html" title="When MSLU meets ATL or WTL">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2005/02/03/366698.html" title="English only! (or how to misuse NLS APIs)">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2005-02">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2005-02-04">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2005/02/04/366922.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:42 GMT -->
</html>