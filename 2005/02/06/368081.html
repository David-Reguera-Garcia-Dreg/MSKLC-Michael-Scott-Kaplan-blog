<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2005/02/06/368081.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:42 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>Can a codepage be changed? How about which codepage a locale points to?</title></head><body>
<h1>Can a codepage be changed? How about which codepage a locale points to?</h1>
<p><em>by Michael S. Kaplan, published on 2005/02/06 13:37 -05:00, original URI: http://blogs.msdn.com/b/michkap/archive/2005/02/06/368081.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostNew -->
<P>Earlier today I explored the question&nbsp;<A id=_1c2e412d8830408f_HomePageDays_DaysList__ctl0_DayItem_DayList__ctl0_TitleUrl href="http://archives.miloush.net/michkap/archive/2005/02/06/367985.html">Can I get my characters into Unicode?</A>&nbsp;but Ivan Petrov's question was also asking about what could be done about <A href="http://www.microsoft.com/globaldev/reference/sbcs/1251.htm">code page 1251</A>, which also was missing these 20 cyrillic characters.</P>
<P>Unfortunately, there is nothing that can be done with it, for several reasons.</P>
<P>First, as <A href="http://mikedimmick.blogspot.com/">Mike Dimmick</A> tried to point out in a comment to that post (moderated to avoid spoilers, sorry Mike!), <A href="http://www.microsoft.com/globaldev/reference/sbcs/1251.htm">code page 1251</A>&nbsp;has only one free slot, and there is really no way to add 20 characters to it. This of course makes it impossible on its face to update cp1251.</P>
<P>Second, as a matter of policy, Microsoft does not update the so-called ANSI<SUP><FONT size=1>1</FONT></SUP> code pages. Ever. We can't. We have tried, twice:</P>
<UL>
<LI>Some time between Windows NT 4.0 and 2000, (also between Windows 98 and Me), some but not all of the code points required for Farsi were added to cp1256 (there was not room for all of them). 
<LI>In the Windows 2000 timeframe, almost all of the ANSI code pages were updated to include the Euro<FONT size=1><SUP>2</SUP></FONT>.</LI></UL>
<P>We are still dealing with the fallout of both of those changes, and have promised many interested parties both inside and outside of Microsoft that we would not make the same mistake again. It affects persistence formats, application compatibility, and platform/cross-plaftform compatibility to do so.</P>
<P>The Microsoft ANSI code pages are weird anyway. They are not an ANSI standard and most of them are modelled after ISO-8859 code pages. The main difference is that the C1 area (in ISO-8859 reserved for control codes that are also seen in Unicode) is used for characters. On the posiive side this makes them more honest-to-goodness useful; on the negative side the data is often mistaken for the analagous ISO-8859 code page and Microsoft gets to be called evil for messing up standards.</P>
<P>The simple fact is that for many languages, 8 bits&nbsp;are really not enough. </P>
<P><A href="http://www.microsoft.com/globaldev/DrIntl/default.mspx">Dr. International</A> was talking about it back in <A href="http://www.microsoft.com/globaldev/drintl/columns/002/default.mspx#Q1">August of 2000</A>, going so far as to suggest that in many cases the <A title=GetLocaleInfo href="http://msdn.microsoft.com/library/en-us/intl/nls_34rz.asp" target=_blank>GetLocaleInfo</A>/LOCALE_IDEFAULTANSICODEPAGE of a locale was more of a "best fit&nbsp;mapping" which may not contain all of the characters a language needs. in poker terms, I can see Ivan's concerns about cp1251 and Bulgarian, and raise him the doctor's examples for cp1256 (inadequate for Baluchi, Berber, Farsi, Kashmiri, Kazakh, Kirghiz, Kurdish, Pashto, Sindhi, Uighur, and Urdu, two of which are supported now, some more of which will come later).</P>
<P>There are four different ways that this has traditionally been solved:</P>
<UL>
<LI>The "Microsoft" method, which I mentioned above where we added code points to fill in the unallocated spaces. We have abandoned this approach. 
<LI>The "ISO" method, by which I am referring to the ISO-8859 series which if characters had to be added would issue a new code page as an update. Obviously this causes interoperability problems galore since only some people pick up the updates. 
<LI>The 'IBM" method, by which I am referring to the original DOS "OEM" code pages and also the EBCDIC series. The solution is similiar to the ISO method but much more free about issuing new code pages. As far as I know iBM is not doing this anymore, though I could be mistaken (I do know that Microsoft is not picking up new OEM/EBCDIC code pages). 
<LI>The "Unicode" method, by which I am referring to getting out of using the non-Unicode code pages. </LI></UL>
<P>This fourth method is the one Microsoft uses now (after seeing from our own experience and that of others how bad the other three can be). </P>
<P>Anyone is free to limp along as best they can without Unicode (easy for some languages, not so easy for others), or they can move to Unicode and see their language supported as well as the current definitions allow (which is actually quite a long way!).</P>
<P>Then there is an additional question, about changing the value of the code page that is used by a locale, i.e. changing the OEMCP value returned by GetLocaleInfo/LOCALE_IDEFAULTCODEPAGE so that a default system locale setting will have updated behavior. Doing this would cause any file previously saved from the console or in the OEM code page to be corrupted, and there is no possible way that&nbsp;the benefit to <EM>any</EM> language can outweigh the pain of data corruption. The answer here is also definitely Unicode.</P>
<P>The final related question that Ivan raised is to do with the Bulgarian <A href="http://czyborra.com/charsets/cyrillic.html#MIK ">MIK OEM Codepage</A>, which is one we cannot add to Windows and even if it were there could not switch to have Bulgarian use. The time has come to move to Unicode, especially if you are using a language that needs it. Bulgarian is in the same spot as Urdu and about another 600+ languages for whom 8&nbsp;bits are insufficient.<BR></P>
<P><FONT size=1><EM>1 - <A href="http://weblogs.asp.net/oldnewthing/">Raymond Chen</A> discusses why this code page is misnamed as "ANSI" in his post </EM></FONT><A id=viewpost href="http://weblogs.asp.net/oldnewthing/archive/2004/05/31/144893.aspx"><FONT size=1><EM>Why is the default 8-bit codepage called "ANSI"?</EM></FONT></A><FONT size=1><EM> in May 2004. I will probably add to it one day, as there is more to tell....<BR>2 - If you know which one it is without looking at the <A href="http://www.microsoft.com/globaldev/reference/WinCP.mspx">Windows code pages</A>, I would be impressed, but since I have no way of knowing whether you looked I will have to stay unimpressed today.<BR></EM></FONT></P>
<P><FONT color=#800080><EM>This post sponsored by "?" (</EM><A href="http://www.fileformat.info/info/unicode/char/0300/index.htm"><EM>U+003f</EM></A><EM>, a.k.a. QUESTION MARK)<BR><FONT size=1>The character that appears for almost all code pages when you try to convert from Unicode into them and the character does not exist....</FONT></EM></FONT></P>
<hr/><p><a id="368130" href="#368130">#</a> <strong>Steve loughran</strong> on 6 Feb 2005 2:00 PM:</p><div style="margin-left: 1em"><br>Every time I get some more detail on how things adapted to the euro symbol, I get more annoyed about how stupid they were to invent a whole new symbol. Nobody with a US keyboard can type it; old printers cant handle it, its just a disaster. What were our EU masters thinking?<br><br></div>
<p><a id="368323" href="#368323">#</a> <strong>Brodie Thiesfield</strong> on 7 Feb 2005 2:39 AM:</p><div style="margin-left: 1em">Do you know if Microsoft ever entertained the idea of creating a UTF-8 codepage, providing Unicode support in the way most Un*x do. I know that there is a codepage code for conversions with <a title="MultiByteToWideChar" href="http://msdn.microsoft.com/library/en-us/intl/unicode_17si.asp" target="_blank">MultiByteToWideChar</a>, et al, but is this a real codepage that the system can be set to?</div>
<p><a id="368495" href="#368495">#</a> <strong>Michael Kaplan</strong> on 7 Feb 2005 8:57 AM:</p><div style="margin-left: 1em">Thought? Perhaps... but facts trump thought here every time. It is not possible given both the current architecture (which must work in both user and kernel mode) and also the inherent assumption in several subsystems (like USER) that the ACPs maximum number of bytes per character is 2.<br><br>It is before my time but people have led me to believe it was considered for the &quot;Unicode only&quot; locales until it became clear that it wasn't really possible to change that much legacy....</div>
<p><a id="369464" href="#369464">#</a> <strong>Ivan Petrov</strong> on 8 Feb 2005 3:14 PM:</p><div style="margin-left: 1em">Hi again Michael ;-).<br><br>First of all I want to tell you that I'm very satisfied with your answers!<br>I think I clearly understood you about the 'It's UNICODE time!' tendetion, but in that moment in me arised 2 simple questions:<br><br>1) What to do with the tones of OEM-encoded: text files and documents, strings in compiled command prompt (DOS) programs and utilities, etc., ESPECIALLY of those encoded with OEM codepages not supported by Windows (as Bulgarian MIK OEM Codepage for example), to just read them correctly using UNICODE?<br><br>2) How to type characters like 'CYRILLIC CAPITAL LETTER A WITH GRAVE' in applications like Word for example, as they are suported in UNICODE, but not supported in codepages like 1251 ?<br><br>Thank You in advance.<br><br>Regards,<br>Ivan.</div>
<p><a id="369469" href="#369469">#</a> <strong>Michael Kaplan</strong> on 8 Feb 2005 3:20 PM:</p><div style="margin-left: 1em">Hi Ivan! Regarding your questions --<br><br>#1 -- If the code page exists then it is certainly outside the bounds of Unicode today -- so someone needs to do work to convert them to Unicode. As it is obviously a one-time operation per data file, a permanent mapping is likely not the best solution here. But a one-time tool that mapped each byte to the appropriate Unicode code point or code points would be best (note that a code page would not work anyway since there is no good way to map one byte to two Unicode characters with <a title="MultiByteToWideChar" href="http://msdn.microsoft.com/library/en-us/intl/unicode_17si.asp" target="_blank">MultiByteToWideChar</a>.<br><br>#2 -- A ligature can easily be authored in <a title="MSKLC" href="http://www.microsoft.com/globaldev/tools/msklc.mspx" target="_blank">MSKLC</a> for any such character that is needed (dead keys would not work here).</div>
<p><a id="457226" href="#457226">#</a> <strong>Unni.Vishwanathan</strong> on 27 Aug 2005 10:57 PM:</p><div style="margin-left: 1em">Back in May of 2004, Quan Nguyen sent a message to Dr. International about Vietnamese collation...</div>
<p><strong>Yuhong Bao</strong> on 19 Feb 2011 12:57 AM:</p><div style="margin-left: 1em"><p>&quot;The &#39;IBM&quot; method&quot;</p>
<p>IBM&#39;s codepages are much more precise than MS&#39;s codepages. For example, when MS added the euro sign to codepage 1252, IBM issued a new codepage instead.</p>
</div>
<p><strong>Michael S. Kaplan</strong> on 19 Feb 2011 4:46 AM:</p><div style="margin-left: 1em"><p>Um, that is what I said:</p>
<p>&quot;The solution is similiar to the ISO method but much more free about issuing new code pages.&quot;</p>
</div>
<p><strong>Yuhong Bao</strong> on 28 Dec 2012 12:33 AM:</p><div style="margin-left: 1em"><p>&quot;In the Windows 2000 timeframe, almost all of the ANSI code pages were updated to include the Euro&quot;</p>
<p>Actually, I think it was in the Win98 timeframe, with updates issued for older versions of Windows dating back to NT 3.51 and Win3.x.</p>
</div>
<hr/><p><em>referenced by</em></p><div style="margin-left: 1em"><p>2009/08/17 <a href="http://archives.miloush.net/michkap/archive/2009/08/17/9871988.html">On not looking at Uyghur through a Chinese prism</a></p><p>2007/08/04 <a href="http://archives.miloush.net/michkap/archive/2007/08/04/4218091.html">The one code page that changed recently</a></p><p>2007/01/04 <a href="http://archives.miloush.net/michkap/archive/2007/01/04/1392691.html">Whither intl.inf in Vista?</a></p><p>2007/01/03 <a href="http://archives.miloush.net/michkap/archive/2007/01/03/1392379.html">UTF-8 and GB18030 are both 'NT' code pages, they just aren't 'ANSI' code pages</a></p><p>2006/07/14 <a href="http://archives.miloush.net/michkap/archive/2006/07/14/665714.html">Can the CP_ACP be UTF-8?</a></p><p>2006/07/05 <a href="http://archives.miloush.net/michkap/archive/2006/07/05/656283.html">Custom code pages?</a></p><p>2005/10/17 <a href="http://archives.miloush.net/michkap/archive/2005/10/17/481627.html">Round trip calls do not always go both ways</a></p><p>2005/08/27 <a href="http://archives.miloush.net/michkap/archive/2005/08/27/457224.html">Vietnamese is a complex language on Windows</a></p><p>2005/03/15 <a href="http://archives.miloush.net/michkap/archive/2005/03/15/395685.html">Emptying some items out of the suggestion box</a></p></div><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2005/02/06/368232.html" title="15 million lines of Windows code revealed....">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2005/02/06/367985.html" title="Can I get my characters into Unicode?">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2005-02">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2005-02-06">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2005/02/06/368081.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:42 GMT -->
</html>