<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2005/02/03/366145.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:42 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>What makes a string meaningful?</title></head><body>
<h1>What makes a string meaningful?</h1>
<p><em>by Michael S. Kaplan, published on 2005/02/03 03:12 -05:00, original URI: http://blogs.msdn.com/b/michkap/archive/2005/02/03/366145.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostNew -->
<P>Yesterday, I said that <A id=_fe4a7ebadeacf48_HomePageDays_DaysList__ctl0_DayItem_DayList__ctl1_TitleUrl href="http://archives.miloush.net/michkap/archive/2005/02/02/365251.html">CompareString prefers meaningful strings</A>, and that while (the rare) inconsistencies are always bugs that we have to prioritize such bugs based on whether or not the data is actually valid/meaningful.</P>
<P>Many people stopped and wondered how one defines the word '<STRONG>meaningful</STRONG>' here. Is it a definition that is useful for developers?</P>
<P>I'll ignore the cross-script strings that have little clear semantic or pragmatic meaning and focus on the strings that have code points not defined by the MS&nbsp;collation tables (sometimes not even by Unicode!) as discussed in <A id=CategoryEntryList href="http://archives.miloush.net/michkap/archive/2005/01/18/355210.html">The jury will give this string no weight</A>.</P>
<P>Some developers might think they could use the <A title=CompareString href="http://msdn.microsoft.com/library/en-us/winui/winui/windowsuserinterface/resources/strings/stringreference/stringfunctions/comparestring.asp" target=_blank>CompareString</A> API and compare characters to a zero length string. Others think about using&nbsp;LCMapString looking for a "no weight" sort key. But both of these ideas share two&nbsp;problems that keep them from acting as practical solutions:</P>
<OL>
<LI>Checking for one character at a time is unwieldy, and more than one at a time can miss individual characters with no weight. 
<LI>Some Unicode code points intentionally have no weight and are valid as they are, such as <A href="http://www.fileformat.info/info/unicode/char/2060/index.htm">U+2060</A> WORD JOINER.</LI></OL>
<P>So, what can you do? You can use the <A title=IsNLSDefinedString href="http://msdn.microsoft.com/library/en-us/intl/nls_19ev.asp" target=_blank>IsNLSDefinedString</A> API! You pass it a string and it will tell you if every character in a string has a defined result (which in this case is exactly what you may need).</P>
<P>It is intimately related to the <A title=GetNLSVersion href="http://msdn.microsoft.com/library/en-us/intl/nls_5e7i.asp" target=_blank>GetNLSVersion</A> API, which also helps out with the question of stability in collation. </P>
<P>Both APIs were added in Windows Server 2003, and the Whidbey release of the .NET Framework includes a method analagous to IsNLSDefinedString (CompareInfo.IsSortable, you will see it starting in Beta 2).</P>
<P>GetNLSVersion is used by major databases like Active Directory in order to know when it needs to re-index their data. Basically looking at the <A title=NLSVERSIONINFO href="http://msdn.microsoft.com/library/en-us/intl/nls_6faq.asp" target=_blank>NLSVERSIONINFO</A> struct, the dwDefinedVersion member will be incremented any time a major version sort of change happens, and the dwNLSVersion member will be incrememented any time a minor version sort of change happens.</P>
<P>Now looking at IsNLSDefinedString, if you have a database and create indexes based on sort keys from <A title=LCMapString href="http://msdn.microsoft.com/library/en-us/intl/nls_5s2v.asp" target=_blank>LCMapString</A> or B-Trees built from CompareString calls:</P>
<OL>
<LI>Any time the major version is incremented, you should re-index <STRONG>no matter what</STRONG>, and 
<LI>Any time the minor version is incremented, you should re-index for any entry where IsNLSDefinedString used to return FALSE (in case it now returns TRUE or different results due to part of the string now being defined)</LI></OL>
<P>Obviously, major version changes are expensive and would be expected to be rare -- not even every major release of Windows requires a new major version. </P>
<P>Why is that? Well, usually a new&nbsp;version would just mean a whole bunch of new characters added, and thus there is no need to re-index strings that are already indexed -- which suggests a minor version. Minor version changes would be much more common. With <EM>them</EM> you can trust all existing index values, and only need to re-index strings that previously contained one or more unsortable elements. </P>
<P>If you follow principles (A) and (B) above and always store information about unsortable strings, you can use these APIs to maximize the utility of support of the collation of <STRONG>meaningful</STRONG> strings on Windows.</P>
<P>&nbsp;</P>
<P><FONT color=#800080><EM>This post brought to you by </EM>"<FONT size=5>áƒ¥</FONT>"<EM> (<A href="http://www.fileformat.info/info/unicode/char/10e5/index.htm">U+10e5</A>, a.k.a. GEORGIAN LETTER KHAR)</EM></FONT></P>
<hr/><div style="margin-left: 1em"><em>no comments</em></div><hr/><p><em>referenced by</em></p><div style="margin-left: 1em"><p>2007/07/30 <a href="http://archives.miloush.net/michkap/archive/2007/07/30/4143574.html">See that version there? It is going down, man! #1</a></p><p>2005/05/04 <a href="http://archives.miloush.net/michkap/archive/2005/05/04/414520.html">Collation data -- must be stable, but it must not stand still</a></p><p>2005/03/17 <a href="http://archives.miloush.net/michkap/archive/2005/03/17/397689.html">The offline address book (OAB) in Exchange....</a></p><p>2005/03/06 <a href="http://archives.miloush.net/michkap/archive/2005/03/06/386194.html">Backcompat is the father of the NLS APIs</a></p></div><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2005/02/03/366615.html" title="It says &#39;Unleash the Power of OneNote&#39;">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2005/02/02/365993.html" title="Doing a little more in Sri Lanka....">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2005-02">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2005-02-03">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2005/02/03/366145.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:42 GMT -->
</html>