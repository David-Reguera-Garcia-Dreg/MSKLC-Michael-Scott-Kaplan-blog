<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2005/02/20/377116.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:42 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>Encoding support can be found in the strangest places....</title></head><body>
<h1>Encoding support can be found in the strangest places....</h1>
<p><em>by Michael S. Kaplan, published on 2005/02/20 20:51 -05:00, original URI: http://blogs.msdn.com/b/michkap/archive/2005/02/20/377116.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostNew -->
<P>Jason (an SDE/T somewhere in Windows) posed the following question yesterday afternoon:</P>
<BLOCKQUOTE dir=ltr>
<P><EM><FONT size=2>I am writing a script to test localized Windows qfe package INFs.&nbsp; These are stored as ANSI files.&nbsp; I am using a Unicode XML file for storing my comparison strings.&nbsp; My script must run on localized windows builds of various default codepages which affects how the string comes out when I read it from the ANSI file.&nbsp; The test will run fine for all languages when run on an English box but when run on say a Chinese box the string comes out differently and my test breaks unnecessarily.&nbsp;</FONT></EM></P>
<P><EM><FONT size=2>Is there a way to always get the same string out of this file?</FONT></EM></P></BLOCKQUOTE>
<P>Obviously this is a problem. VBScript mostly assumes the default code page and the File System Object assumes that code page, UTF-8, or UTF-16 depending on how you set it. In this case, Jason is looking for code page 1252 to always be used.</P>
<P>Incidentally, as I&nbsp;hinted at&nbsp;in '<A id=CategoryEntryList href="http://archives.miloush.net/michkap/archive/2005/01/08/349230.html">How does it detect invalid characters?</A>' it will sometimes be able to fail on other code pages, as well (basically any time there are slots that do not have a mapping). But I did suggest a workaround:</P>
<BLOCKQUOTE dir=ltr>
<P><FONT size=2>Maybe there is something clever you could do with ADODB.Stream, its LoadFromFile method, its Charset property, and its ReadText method?</FONT></P></BLOCKQUOTE>
<P>I did not intend to be mysterious, I just was not sure here. I vaguely remembered someone suggested using ADODB.Stream in a similar situation and did not want to over-promise a solution. But sure enough he posted back today that it worked!:</P>
<BLOCKQUOTE dir=ltr>
<P><FONT size=2><EM>I‚Äôve included my code below in case anyone else wants to see how it‚Äôs done.&nbsp; It‚Äôs quite simple once you know which object to use.&nbsp; The code below will load an ANSI file to the same character set displayed in EN notepad, allowing me to copy and paste the characters from Notepad into my Unicode test data file and always read the same thing from the INF no matter what language I am running on:</EM></FONT></P>
<P><FONT face="Courier New" size=2>&nbsp;&nbsp;&nbsp;&nbsp;' load using windows-1252 character set<BR>&nbsp;&nbsp;&nbsp;&nbsp;dim oStr, WorkingBuffer<BR>&nbsp;&nbsp;&nbsp;&nbsp;set oStr = CreateObject("ADODB.Stream")<BR>&nbsp;&nbsp;&nbsp;&nbsp;oStr.CharSet = "windows-1252" ' code page of the inf files<BR>&nbsp;&nbsp;&nbsp;&nbsp;oStr.Open<BR>&nbsp;&nbsp;&nbsp;&nbsp;oStr.LoadFromFile FileName<BR>&nbsp;&nbsp;&nbsp;&nbsp;WorkingBuffer = oStr.ReadText<BR>&nbsp;&nbsp;&nbsp;&nbsp;set oStr = nothing</FONT></P>
<P><FONT size=2><EM>I never would have thought to use ADODB objects for this :P</EM></FONT></P></BLOCKQUOTE>
<P>After he posted that, I went to find the reference in my archives, something made surprisingly easy by the fact that I pretty much never deal with ADODB streams for any other purpose. It was David Copenhaver in the microsoft.public.vb.general.discussion newsgroup, who posted the following code:</P>
<BLOCKQUOTE dir=ltr>
<P><FONT face="Courier New" size=2>Private sub t2UTF (Path as string)<BR>&nbsp;&nbsp;&nbsp; Dim bob As ADODB.Stream<BR>&nbsp;&nbsp;&nbsp; Set bob = New ADODB.Stream<BR><BR>&nbsp;&nbsp;&nbsp; bob.Open<BR>&nbsp;&nbsp;&nbsp; bob.LoadFromFile Path 'Loads a File<BR>&nbsp;&nbsp;&nbsp; bob.Charset = "UTF-8" 'sets the stream encoding to UTF-8<BR>&nbsp;&nbsp;&nbsp; bob.SaveToFile Path, adSaveCreateOverWrite 'Save File<BR>&nbsp;&nbsp;&nbsp; bob.Close<BR>&nbsp;&nbsp;&nbsp; set bob = nothing<BR>end sub</FONT></P></BLOCKQUOTE>
<P>So, sorry to make you figure it out yourself, Jason (I should have looked in the archives first!).</P>
<P>The obvious question at this point would be to wonder why they are using a <STRONG>String</STRONG> for <STRONG>Charset</STRONG> property when what is being dealt with is code pages. I honestly have no clue, but I'll give them the benefit of the doubt and assume it is to ease the ability to use the object with HTML files and <EM>their</EM> <A href="http://msdn.microsoft.com/workshop/author/dhtml/reference/charsets/charset4.asp">charset</A> property.</P>
<P>It is amazing where you can find support for international features....</P>
<P>&nbsp;</P>
<P><FONT color=#800080><EM>This post brought to you by </EM>"êêê"<EM> (</EM></FONT><FONT color=#800080><A href="http://www.fileformat.info/info/unicode/char/10410/index.htm"><EM>U+10410</EM></A></FONT><FONT color=#800080><EM>, a.k.a. DESERET CAPITAL LETTER H)</EM></FONT></P>
<hr/><p><a id="377138" href="#377138">#</a> <strong>Dean Harding</strong> on 20 Feb 2005 7:51 PM:</p><div style="margin-left: 1em">The ADODB objects are also used by CDO for email (somethinge I'm all too familiar with at the moment!) so having a string charset is good because you can pass the MIME strings in and it works out what you're actually talking about.</div>
<p><a id="377142" href="#377142">#</a> <strong>Michael Kaplan</strong> on 20 Feb 2005 7:54 PM:</p><div style="margin-left: 1em">In that case, I am totally ok with this -- a software component that tries to please a specific consumer of its functionality? I am definitely a fan!</div>
<hr/><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2005/02/21/377288.html" title="Give me a [word-]break!">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2005/02/19/376848.html" title="If you read this blog but don&#39;t read the comments...">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2005-02">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2005-02-20">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2005/02/20/377116.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:42 GMT -->
</html>