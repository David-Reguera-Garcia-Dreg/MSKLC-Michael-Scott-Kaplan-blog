<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2005/02/01/364707.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:42 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>What is my locale? Well, which locale do you mean?</title></head><body>
<h1>What is my locale? Well, which locale do you mean?</h1>
<p><em>by Michael S. Kaplan, published on 2005/02/01 09:35 -08:00, original URI: http://blogs.msdn.com/michkap/archive/2005/02/01/364707.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostOld -->
<P>A few years back (some time before Windows XP shipped)&nbsp;when we located in were in Building 9 and much smaller than we are now, someone else in the building was having a problem. Our kind of problem. An international problem. I don't remember what it was -- something to do with code pages, maybe?</P>
<P>Anyway, Wei Wu, one of our cool development leads, asked a few configuration questions, and at the end of the message, asked him "what is your default system locale?".</P>
<P>His response, which I cannot find a copy of now, was priceless. Assuming that Wei was going to stop by to look at the machine. this guy started to describe the location of his computer.... :-)</P>
<P>One of those jokes that most people won't quite get, and jokes are never funny if they have to be explained. Ah, the life of an international geek. </P>
<P>But it was pretty funny, I think. We all&nbsp;had a good laugh at the time.</P>
<P>There is a not-so-hidden truth in there -- our terminiology story is weak. It really ought to be better. So, once again, here is a&nbsp;quick glossary of the four most common&nbsp;<STRONG>types of locales</STRONG>:</P>
<P><STRONG>DEFAULT USER LOCALE</STRONG> (Windows XP term: "Standards and Formats"):</P>
<BLOCKQUOTE dir=ltr style="MARGIN-RIGHT: 0px">
<P>This setting controls the way information is presented -- the sort order in list boxes, the format of date, time, number, and currency values, the calendar you prefer to use. The list of locales can be thought of as a big group of defaults that are grouped by many language/region pairings, which you can see in the first tab&nbsp;<a href="#8424">Regional and Language Options</A> Control Panel applet. Several of the settings are customizable, particularly the various formats.</P>
<P>The setting is per-user and when you change the setting, it is effective immediately, and all top level windows in the user's windowstation will get a <A title=WM_SETTINGCHANGE href="http://msdn.microsoft.com/library/en-us/sysinfo/base/wm_settingchange.asp" target=_blank>WM_SETTINGCHANGE</A> message indicating that the change has happened so that they too can reflect the change immediately.</P>
<P>Developers will commonly use LOCALE_USER_DEFAULT as their LCID of choice, whether by doing so directly or by calling functions in SHELL, USER, or elsewhere that do so for them. Using this setting and behaving appropriately with the results thereby is a sure sign that the developer respects the user's settings.</P></BLOCKQUOTE>
<P><STRONG>DEFAULT SYSTEM LOCALE </STRONG>(Windows XP term: "Language for non-Unicode Programs"):</P>
<BLOCKQUOTE dir=ltr style="MARGIN-RIGHT: 0px">
<P>This setting has three major purposes:</P>
<OL>
<LI>Specifies the default&nbsp;ANSI, OEM, MAC, and EBCDIC code pages to use for non-Unicode programs. 
<LI>Specifies some of the font linking preferences for CJK fonts and for legacy bitmap fonts. 
<LI>Specifies application behavior when developers incorrectly use this setting rather than the DEFAULT USER LOCALE.</LI></OL>
<P>This setting is found on the third tab of the Windows XP/Server 2003 <A id=CategoryEntryList href="http://archives.miloush.net/michkap/archive/2004/12/11/279998.html">Regional and Language Options dialog</A>&nbsp;and in the "Default" button on the first tab of the Windows 2000 <a href="http://archives.miloush.net/michkap/archive/2004/12/11/279997.html">Regional Options dialog</A>.</P>
<P>Changing the setting changes it for the entire machine and it requires a reboot to take effect. No notification mechanism is done, nor is one needed since no change happens until the reboot does. A small number of misbehaving applications which check the registry rather than using the APIs will get wrong results after the setting change but before the reboot.</P>
<P>Unfortunately, developers will sometimes use LOCALE_SYSTEM_DEFAULT for purposes other than #1 and #2, and by doing so they manage to simultaneously show their users disrespect and cause yet another compatibility weirdness with functionality tied to the default system locale. Given the fact that a reboot is required, you think people would avoid this, but dven developers are not always perfect.</P>
<P>The XP name should be a big hint, though sometimes it adds confusion.</P></BLOCKQUOTE>
<P><STRONG>DEFAULT USER INTERFACE LANGUAGE </STRONG>(Windows XP Term: "Language used in menus and dialogs"):</P>
<BLOCKQUOTE dir=ltr style="MARGIN-RIGHT: 0px">
<P>This setting controls the language in which the UI is presented. It is only present if you have the MUI version of Windows (which is to say that you have Windows with the multilanguage files installed).</P>
<P>This setting is found on the second tab of the Windows XP/Server 2003 <A id=CategoryEntryList href="http://archives.miloush.net/michkap/archive/2004/12/11/279998.html">Regional and Language Options dialog</A>&nbsp;and in the middle of the first tab of the Windows 2000 <a href="http://archives.miloush.net/michkap/archive/2004/12/11/279997.html">Regional Options dialog</A>.</P>
<P>The setting is per-user and changing it requires a logoff to take effect.</P>
<P>There is no constant for it but the <A title=GetUserDefaultUILanguage href="http://msdn.microsoft.com/library/en-us/intl/nls_5c85.asp" target=_blank>GetUserDefaultUILanguage</A> API will retrieve&nbsp;the&nbsp;setting&nbsp;quickly enough. Given the changes to the resource model that the changes to support MUI inspired, it is easy for applications to plug into the very same setting automatically. I'll talk more about this another time....</P></BLOCKQUOTE>
<P><STRONG>DEFAULT INPUT LOCALE </STRONG>(Windows XP Term: "Default Input Language"):</P>
<BLOCKQUOTE dir=ltr style="MARGIN-RIGHT: 0px">
<P>This setting controls the initial input language used for all newly created threads.</P>
<P>This setting is found on the second tab of the Windows XP/Server 2003 <A id=CategoryEntryList href="http://archives.miloush.net/michkap/archive/2004/12/11/279998.html">Regional and Language Options dialog</A>&nbsp;(hit the "Details..." button) and on the last tab of the Windows 2000 <a href="http://archives.miloush.net/michkap/archive/2004/12/11/279997.html">Regional Options dialog</A>.</P>
<P>The setting is per-user and it takes place immediately. But obviously will not change the input language on any existing threads; only new threads get the new default. </P>
<P>Developers can find out what the current setting is by calling the&nbsp;<A href="http://msdn.microsoft.com/library/en-us/sysinfo/base/systemparametersinfo.asp">SystemParametersInfo</A> API with the SPI_GETDEFAULTINPUTLANG parameter. You can even set it with the SPI_SETDEFAULTINPUTLANG parameter but this almost always something that a developer should not be doing -- it is a user preference. Since proper application behavior is mostly about respect, this really is a constant that you should avoid. :-)</P></BLOCKQUOTE>
<P>For more on this topic, Dr. International has bigger lists <A href="http://www.microsoft.com/globaldev/drintl/columns/009/default.mspx">here</A>&nbsp;and <A href="http://www.microsoft.com/globaldev/DrIntl/faqs/Locales.mspx">here</A>, and there is more information <A href="http://www.microsoft.com/globaldev/reference/loclanghome.mspx">here</A>. </P>
<P>But when you are a developer, respect is the key here -- respect of the user's preferences and settings.</P>
<P>When you are a user, consider which applications respect your settings and which do not. Because while doing so may not be convenient for an application, it is certainly possible....</P>
<P>&nbsp;</P>
<P><FONT color=#800080><EM>This post sponsored by </EM>"รฐ"<EM> (<A href="http://www.fileformat.info/info/unicode/char/00f0/index.htm">U+00f0</A>, a.k.a. LATIN SMALL LETTER ETH)</EM></FONT></P>
<hr/><p><a id="365001" href="#365001">#</a> <strong>Ben Bryant</strong> on Tuesday, February 01, 2005 3:59 PM:</p><div style="margin-left: 1em">Confusion between default user and system locales is huge. I call them the setlocale and <a title="GetACP" href="http://msdn.microsoft.com/library/en-us/intl/nls_21bk.asp" target="_blank">GetACP</a> settings respectively. Delphi 7 has this problem in its core SysUtils functions because it uses the code page associated with the default user locale in some of its Ansi String functions (which on Windows is absolutely wrong). Very few programmers seem to be aware of this issue, I guess because often they are the same code pages. The MSDN documentation is plain wrong in many places, such as setlocale where it says the &quot;system-default ANSI code page obtained from the operating system&quot;.</div>
<p><a id="365020" href="#365020">#</a> <strong>Ben Bryant</strong> on Tuesday, February 01, 2005 4:24 PM:</p><div style="margin-left: 1em">I was looking through the Dr. International pages you listed, and saw the following clarification: &quot;Although available user locales are often listed as a language (sometimes in combination with a country), a user locale is NOT a language setting, and has nothing to do with input languages, keyboard layouts, codepages or user interface languages.&quot; There is a code page associated with the user locale because you need a code page that can support the characters found in the weekdays and so forth. In fact, as a programmer I suppose you might need to explicitly deal with this user locale code page if you are handling strings from date time functions in a non-UNICODE program.</div>
<p><a id="365033" href="#365033">#</a> <strong>Michael Kaplan</strong> on Tuesday, February 01, 2005 4:46 PM:</p><div style="margin-left: 1em">Hi Ben,<br><br>The lines blur -- because although user locale has nothing to do with input language, both XP and Server 2003 will add the default keyboard of any locale you change to when you change to it. <br><br>The best thing to do is be willing to accept any user format and then always use Unicode!</div>
<p><a id="365158" href="#365158">#</a> <strong>Michael Kaplan</strong> on Tuesday, February 01, 2005 8:55 PM:</p><div style="margin-left: 1em">Here is the mail -- names of others removed to protect the innocent (and the guilty!). Thanks to a coworker for digging it up!.... <br><br>-----Original Message----- <br>From: Xxxxxxxx Xxxxxxxxxxx <br>Sent: Tuesday, April 17, 2001 11:46 AM <br>To: Wei Wu <br>Subject: RE: AutoDesk is in the CD lab and has a couple of shell issues Shell issue <br><br>This machine is sitting in the CD lab Bld 27 cafeteria 2 and 3 next to the cafeteria not in the cafeteria. <br><br>-----Original Message----- <br>From: Wei Wu <br>Sent: Tuesday, April 17, 2001 11:43 AM <br>To: Xxxxxxxx Xxxxxxxxxxx <br>Subject: FW: AutoDesk is in the CD lab and has a couple of shell issues Shell issue <br><br>Xxxxxxxx, do you know the system locale of your repro machine? <br><br><br><br>-----Original Message----- <br>From: Wei Wu <br>Sent: Tuesday, April 17, 2001 11:25 AM <br>To: Xxxxx Xxxxxxx; Xxxxxxx Xxxx; Xxxxxxxx Xxxxxxxxxxx; Xxxxx Xxxxxxxx; Xxxxx Xxx <br>Cc: Xxxxx Xxxxxx <br>Subject: RE: AutoDesk is in the CD lab and has a couple of shell issues Shell issue <br><br>I'll investigate this. <br><br><br><br>wei <br><br>-----Original Message----- <br>From: Xxxxx Xxxxxxx <br>Sent: Tuesday, April 17, 2001 11:21 AM <br>To: Xxxxxxx Xxxx; Xxxxxxxx Xxxxxxxxxx; Xxxxx Xxxxxxxx; Xxxxx Xxx; Wei Wu <br>Cc: Xxxxx Xxxxxx <br>Subject: RE: AutoDesk is in the CD lab and has a couple of shell issues Shell issue <br><br>Wei - Can you please take a look at this? This sounds familiar to the problem you were working on recently with the code for the DLL encodings. I believe this is fixed in the latest build? <br><br>Xxxxx <br></div>
<p><a id="365327" href="#365327">#</a> <strong>Jonathan Payne</strong> on Wednesday, February 02, 2005 3:42 AM:</p><div style="margin-left: 1em">&lt;rant&gt;<br>It would be nice if all these locales were presented a bit better in the Windows installer.  At the moment, each time I install Windows XP, I have to dig through numerous dialogs and change lots of different settings from &quot;English US&quot; to &quot;English UK&quot; and then change the time zone to GMT and put up with that annoying error message when I want to delete the US keyboard so only a UK keyboard is installed.  I know that some people might want to have unusual combinations of locales and time zones and keyboards but it would be nice if the installer offered sensible defaults for the common (non-US) cases.  It would also be nice if it asked all these questions at the beginning or end of the install so I could just leave the installer to get on with it rather than having to feed it more information every five minutes.<br>&lt;/rant&gt;<br></div>
<p><a id="365397" href="#365397">#</a> <strong>Michael Kaplan</strong> on Wednesday, February 02, 2005 6:15 AM:</p><div style="margin-left: 1em">Funny, when I was first reading I was confused as I though you meant .MSI files when you said &quot;Windows Installer&quot;, rather than thinking literlly the &quot;Installer program for Windows.&quot;<br><br>That is a worthwhile &quot;rant&quot; -- we are intuitive within a SKU but often they do not customize SKUs for english languages since &quot;English is already supported&quot;. I believe MS does the same thing with Spanish as well....<br><br>So it is easy to get that &quot;local&quot; feel, *if* you live in right location and buy a copy of Windows meant for that location. Which is great for that subset. But I think the rest of the world deserves that, too -- up to and including the right &quot;flavour&quot; and &quot;localisation&quot; of English or whatever the language is!</div>
<p><a id="365408" href="#365408">#</a> <strong>Mike Dimmick</strong> on Wednesday, February 02, 2005 6:31 AM:</p><div style="margin-left: 1em">Another defect with the setup procedure: Windows Setup prompts first for the locale, then for the current date and time. Unfortunately it asks for the current date and time using the US formats, not the formats you've just specified!</div>
<p><a id="365457" href="#365457">#</a> <strong>Jonathan Payne</strong> on Wednesday, February 02, 2005 7:41 AM:</p><div style="margin-left: 1em"><br>Michael,<br><br>Thanks for your reply - sorry I wasn't clear about the &quot;Windows Installer&quot; / &quot;The Installer That Installs Windows&quot; point :-).<br><br>&lt;longer-rant&gt;<br>I think the solution you are talking about would mean having Windows CDs for each area so instead of looking for the CD that says &quot;English&quot; I would find a CD that says &quot;English UK&quot; and install that.  I am not so keen on that as it would be more cases to test โ if I canโt recreate a bug, is it because I am using a different version of English or is it something else.  Also, having a CD for each common locale would probably use up the entire global supply of what ever resource CDs need to produce the hundreds of extra MSDN Universal CDs that would be needed.<br><br>I think it would be better to make the first screen of regional settings dialog (the one with lots of text and two customize buttons) offer a combo with the common combinations of machine locale / default non-Unicode language / time zone / keyboard / etc.  That way, most users could just pick their something appropriate to their location, eg &quot;English, UK&quot;, from the list and everything else would drop into place with the option of changing the settings in the current way if they wanted something slightly different.<br><br>Another alternative would be to move all locale settings to a list of combos on one dialog so it would be easy to set them all in one go (at the moment, it is a bit frustrating seeing each of the places the first dialog says โEnglish USโ in the two long text strings and trying to find UI to change them - perhaps these strings could be hyperlinks).<br><br>If you consider this issue in terms of (number of times English Windows XP is installed outside of the US) x (amount of time it takes to dig through all those dialogs) it multiplies up to a large amount of time.<br><br>Also, the current installer makes it very easy for non-US users to install multiple keyboards when they really meant to just install the one non-US keyboard they wanted (it is not obvious that you need to delete the US keyboard and when you do, you get a scary error message as the installer is currently using the layout).  This in turn leads to the problem a few weeks later when the user accidentally presses the shortcut that changes the current keyboard layout and then complains that their keyboard is broken as some of the symbols have been swapped (I think the double quote key is in different places on US and UK keyboards for example).<br>&lt;/longer-rant&gt;</div>
<p><a id="365464" href="#365464">#</a> <strong>Michael Kaplan</strong> on Wednesday, February 02, 2005 7:47 AM:</p><div style="margin-left: 1em">All true, and I don't know that I was necessarily suggesting seperate media, I was more pointing put that the current mechanism is great in some cases, not so great in others. And that it would be better if it could be great in more situations, though I do not think the current &quot;solution&quot; is scalable to al of the places that Windows goes.<br><br>Getting it there is an interesting challenge, and there are actually people looking at that in Longhorn, and beyond Longhorn.</div>
<p><a id="365741" href="#365741">#</a> <strong>Ivo</strong> on Wednesday, February 02, 2005 12:42 PM:</p><div style="margin-left: 1em">Speaking of locales... How do I print an integer number according to the locale settings? For example &quot;12,345,678&quot;.<br><br>I looked at the function <a title="GetNumberFormat" href="http://msdn.microsoft.com/library/en-us/intl/nls_8a0k.asp" target="_blank">GetNumberFormat</a>. The way I see it I can use it in 2 ways - to specify a locale, or to specify a format. The thing is, if I use the locale I get &quot;12,345,678.00&quot; - seems like the function is designed for currency values mostly.<br><br>If I use the format I can get the number in any format, but I don't want any format, I want the one according to the locale settings (except the non-integer part). Is there a way to get a <a title="NUMBERFMT" href="http://msdn.microsoft.com/library/en-us/intl/nls_9x0y.asp" target="_blank">NUMBERFMT</a> for the selected locale? Then I can modify it by setting NumDigits to 0 and lpDecimalSep to &quot;&quot;.</div>
<p><a id="365745" href="#365745">#</a> <strong>Michael Kaplan</strong> on Wednesday, February 02, 2005 12:46 PM:</p><div style="margin-left: 1em">Every prop of number formatting can be found with <a title="GetLocaleInfo" href="http://msdn.microsoft.com/library/en-us/intl/nls_34rz.asp" target="_blank">GetLocaleInfo</a> calls to get the various bits of info (some can be set right in the <a title="NUMBERFMT" href="http://msdn.microsoft.com/library/en-us/intl/nls_9x0y.asp" target="_blank">NUMBERFMT</a>).</div>
<p><a id="365917" href="#365917">#</a> <strong>Ivo</strong> on Wednesday, February 02, 2005 4:05 PM:</p><div style="margin-left: 1em">Thanks,<br>I was hoping there is an easier way. Especially converting the grouping from the text &quot;3;2;0&quot; to the number 32 seems overly complicted. Is that what <a title="GetNumberFormat" href="http://msdn.microsoft.com/library/en-us/intl/nls_8a0k.asp" target="_blank">GetNumberFormat</a> is doing every time?</div>
<p><a id="365930" href="#365930">#</a> <strong>Michael Kaplan</strong> on Wednesday, February 02, 2005 4:26 PM:</p><div style="margin-left: 1em">More or less -- it isw doing that annoying parsing work for you....</div>
<p><a id="366143" href="#366143">#</a> <strong>Richard</strong> on Thursday, February 03, 2005 1:09 AM:</p><div style="margin-left: 1em">Another request... on the XP/2003 regional settings dialogue's advanced tabs. For the code page converstion tables a &quot;select all&quot; button.<br><br>It is a real pain to go through the long list ensuring all are selected... by default some are and some arenit, in combination with some that can be deselected usually means two passes to check I've not missed any.</div>
<p><a id="366162" href="#366162">#</a> <strong>Michael Kaplan</strong> on Thursday, February 03, 2005 1:45 AM:</p><div style="margin-left: 1em">Well, its too early to say what will happen exactly, but I am pretty sure I can promise you that *something* good will happen here to resolve that for you in Longhorn.<br><br>This statement is true for most values of good.</div>
<p><a id="366191" href="#366191">#</a> <strong>Mike Williams</strong> on Thursday, February 03, 2005 3:18 AM:</p><div style="margin-left: 1em">It would be nice to have only a non-US keyboard language but since SP2, no matter what I do, the US keyboard is reinstalled as an additional kl within 2 reboots, without fail. It just doesn't want me to have non-US English solo. I've seen this on three other machines with SP2. Sadly the issue, though bugged, got no traction during the beta. Non-US English locales are really second-class citizens in terms of testing and product design at Microsoft. Can you think of a market of comparable size that doesn't have a localized version of Windows or Office?</div>
<p><a id="368318" href="#368318">#</a> <strong>Richard</strong> on Monday, February 07, 2005 2:14 AM:</p><div style="margin-left: 1em">&gt; I am pretty sure I can promise you that<br>&gt; *something* good will happen here to resolve<br>&gt; that for you in Longhorn. <br><br>Good news.<br><br>&gt; This statement is true for most values of good. <br><br>:-)</div>
<p><a id="408778" href="#408778">#</a> <strong>Ovate</strong> on Friday, April 15, 2005 10:21 PM:</p><div style="margin-left: 1em">Dovark for right hand and Chinese locales<br><br>Hi there, I type with Dvorak for the right hand. However the Chinese locale input method MS-Pinyin 98 that I need to use to type Chinese relies on the Qwerty layout. I need to be able to change this to the right hand Dvorak layout within the Chinese locale (I actually need to be able to do the same for Japanese)<br><br>I have downloaded a copy of MKLC (Microsoft Keyboard layout creator). However when I go to  File\ load existing keyboard, it only displays Chinese (PRC) US keyboard option. This is not even a Chinese input method. I already have all the Chinese locals installed on my computer. Would anyone have any idea why the other Chinese input methods do not display or how I can locate them so that I can alter the keys to a Dvorak right hand layout. If I'm going about this totally the wrong way, please excuse the ignorance :-)</div>
<p><a id="408843" href="#408843">#</a> <strong>Michael S. Kaplan</strong> on Saturday, April 16, 2005 11:57 AM:</p><div style="margin-left: 1em">I will talk about this point in an upcoming post....</div>
<p><a id="9302194" href="#9302194">#</a> <strong>Michael Holtstrom</strong> on Friday, January 09, 2009 11:46 AM:</p><div style="margin-left: 1em"><p>I have a db that contains latin1 data and is accessed by several apps. One app is on the dos console. It used to be built with vs6, now vs9. We call setlocale(LC_CTYPE,&quot;&quot;); near startup.</p>
<p>Default winxp is oemcp 437. That means that not all latin1 chars can be displayed in dos. Fine, we detect these chars display simple-ascii escape sequences instead.</p>
<p>Now the suffering begins. Default winxp is LC_CTYPE English_United States.1252. In vs6 that didn't matter, but in vs9, printfs are overriden and a magic last-minute best-fit mapping occurs. Very painful for me.</p>
<p>Here is a little app that your readers might find useful.</p>
<p>#include &lt;iostream&gt;</p>
<p>#include &lt;windows.h&gt;</p>
<p>// Note: In order to ditch the UNICODE define you have to do the following:</p>
<p>// Configuration Properties &gt;&gt; C/C++ &gt;&gt; Preprocessor &gt;&gt; Preprocessor Definitions &gt;&gt; [uncheck] Inherit from parent or project defaults</p>
<p>// If your product is 14 years old, switching to UNICODE just isn't an option.</p>
<p>void info()</p>
<p>{</p>
<p> &nbsp; // GetCPInfoEx vars</p>
<p> &nbsp; BOOL res;</p>
<p> &nbsp; CPINFOEX CPInfoEx;</p>
<p> &nbsp; // Registry vars</p>
<p> &nbsp; #define CHAR_CMD_REG_DATA_SIZE 1024</p>
<p> &nbsp; DWORD ret;</p>
<p> &nbsp; HKEY hKey = 0;</p>
<p> &nbsp; BYTE data[CHAR_CMD_REG_DATA_SIZE];</p>
<p> &nbsp; DWORD dataSize = CHAR_CMD_REG_DATA_SIZE;</p>
<p> &nbsp; bool regIsOpen = false;</p>
<p> &nbsp; // GetLocaleInfo vars</p>
<p> &nbsp; int status;</p>
<p> &nbsp; #define LOCALE_DATA_SIZE 1024</p>
<p> &nbsp; char localeData[LOCALE_DATA_SIZE];</p>
<p> &nbsp; int localeDataSize = LOCALE_DATA_SIZE;</p>
<p> &nbsp; // Open the registry</p>
<p> &nbsp; ret = RegOpenKeyEx( HKEY_LOCAL_MACHINE, &quot;SYSTEM\\CurrentControlSet\\Control\\Nls\\CodePage&quot;, 0, KEY_EXECUTE, &amp;hKey );</p>
<p> &nbsp; if (ret) { printf(&quot;\n RegOpenKeyEx Failed&quot;); }</p>
<p> &nbsp; else { regIsOpen = true; }</p>
<p> &nbsp; // -----------------------------------------------------</p>
<p> &nbsp; // <a rel="nofollow" target="_new" href="http://archives.miloush.net/michkap/archive/2005/02/01/364707.html">http://blogs.msdn.com/michkap/archive/2005/02/01/364707.aspx</a></p>
<p> &nbsp; //</p>
<p> &nbsp; // LOCALE_USER_DEFAULT &nbsp; : Control Panel &gt;&gt; &nbsp;Regional and Language Options &gt;&gt; Regional Options [tab] &gt;&gt; Standards and Formats</p>
<p> &nbsp; // - is per user and does not require reboot</p>
<p> &nbsp; //</p>
<p> &nbsp; // LOCALE_SYSTEM_DEFAULT : Control Panel &gt;&gt; &nbsp;Regional and Language Options &gt;&gt; Advanced [tab] &gt;&gt; Language for non-Unicode Programs</p>
<p> &nbsp; // - is system wide and requires reboot</p>
<p> &nbsp; // - specifies the default ANSI and OEM code pages, and some of the font linking preferences</p>
<p> &nbsp; // -----------------------------------------------------</p>
<p> &nbsp; printf(&quot;\n GetConsoleCP() &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;%d &nbsp;-- Note: effected by the chcp command.\n&quot;,GetConsoleCP());</p>
<p> &nbsp; printf(&quot;\n GetOEMCP() &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;%d&quot;,GetOEMCP());</p>
<p> &nbsp; res = GetCPInfoEx( CP_OEMCP, 0, &amp;CPInfoEx );</p>
<p> &nbsp; if (res==0) { printf(&quot;\n GetCPInfoEx Failed&quot;); }</p>
<p> &nbsp; else { printf(&quot;\n GetCPInfoEx(CP_OEMCP) &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; %d&quot;,CPInfoEx.CodePage); }</p>
<p> &nbsp; status = GetLocaleInfo( LOCALE_USER_DEFAULT, LOCALE_IDEFAULTCODEPAGE, localeData, localeDataSize );</p>
<p> &nbsp; if (status==0) { printf(&quot;\n GetLocaleInfo Failed&quot;); }</p>
<p> &nbsp; else { printf(&quot;\n GetLocaleInfo(LOCALE_USER_DEFAULT,OEM) &nbsp; &nbsp;%s&quot;,localeData); }</p>
<p> &nbsp; status = GetLocaleInfo( LOCALE_SYSTEM_DEFAULT, LOCALE_IDEFAULTCODEPAGE, localeData, localeDataSize );</p>
<p> &nbsp; if (status==0) { printf(&quot;\n GetLocaleInfo Failed&quot;); }</p>
<p> &nbsp; else { printf(&quot;\n GetLocaleInfo(LOCALE_SYSTEM_DEFAULT,OEM) &nbsp;%s&quot;,localeData); }</p>
<p> &nbsp; if (regIsOpen)</p>
<p> &nbsp; {</p>
<p> &nbsp; &nbsp; &nbsp;dataSize = CHAR_CMD_REG_DATA_SIZE;</p>
<p> &nbsp; &nbsp; &nbsp;ret = RegQueryValueEx( hKey, &quot;OEMCP&quot;, NULL, NULL, data, &amp;dataSize );</p>
<p> &nbsp; &nbsp; &nbsp;if (ret) { printf(&quot;\n RegQueryValueEx Failed&quot;); }</p>
<p> &nbsp; &nbsp; &nbsp;else { printf(&quot;\n Registry...\\CodePage\\OEMCP &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;%s\n&quot;,(char*)data); }</p>
<p> &nbsp; }</p>
<p> &nbsp; // -----------------------------------------------------</p>
<p> &nbsp; printf(&quot;\n GetACP() &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;%d&quot;,GetACP());</p>
<p> &nbsp; res = GetCPInfoEx( CP_ACP, 0, &amp;CPInfoEx );</p>
<p> &nbsp; if (res==0) { printf(&quot;\n GetCPInfoEx Failed&quot;); }</p>
<p> &nbsp; else { printf(&quot;\n GetCPInfoEx(CP_ACP) &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; %d&quot;,CPInfoEx.CodePage); }</p>
<p> &nbsp; status = GetLocaleInfo( LOCALE_USER_DEFAULT, LOCALE_IDEFAULTANSICODEPAGE, localeData, localeDataSize );</p>
<p> &nbsp; if (status==0) { printf(&quot;\n GetLocaleInfo Failed&quot;); }</p>
<p> &nbsp; else { printf(&quot;\n GetLocaleInfo(LOCALE_USER_DEFAULT,ANSI) &nbsp; %s&quot;,localeData); }</p>
<p> &nbsp; status = GetLocaleInfo( LOCALE_SYSTEM_DEFAULT, LOCALE_IDEFAULTANSICODEPAGE, localeData, localeDataSize );</p>
<p> &nbsp; if (status==0) { printf(&quot;\n GetLocaleInfo Failed&quot;); }</p>
<p> &nbsp; else { printf(&quot;\n GetLocaleInfo(LOCALE_SYSTEM_DEFAULT,ANSI) %s&quot;,localeData); }</p>
<p> &nbsp; if (regIsOpen)</p>
<p> &nbsp; {</p>
<p> &nbsp; &nbsp; &nbsp;dataSize = CHAR_CMD_REG_DATA_SIZE;</p>
<p> &nbsp; &nbsp; &nbsp;ret = RegQueryValueEx( hKey, &quot;ACP&quot;, NULL, NULL, data, &amp;dataSize );</p>
<p> &nbsp; &nbsp; &nbsp;if (ret) { printf(&quot;\n RegQueryValueEx Failed&quot;); }</p>
<p> &nbsp; &nbsp; &nbsp;else { printf(&quot;\n Registry...\\CodePage\\ACP &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;%s\n&quot;,(char*)data); }</p>
<p> &nbsp; }</p>
<p> &nbsp; // -----------------------------------------------------</p>
<p> &nbsp; char * str;</p>
<p> &nbsp; str = setlocale(LC_ALL &nbsp; &nbsp; , NULL); if (str == NULL) { printf(&quot;\n LC_ALL &nbsp; &nbsp; &nbsp;= unknown&quot;); } else { printf(&quot;\n LC_ALL &nbsp; &nbsp; &nbsp;= %s&quot;,str); }</p>
<p> &nbsp; str = setlocale(LC_COLLATE , NULL); if (str == NULL) { printf(&quot;\n LC_COLLATE &nbsp;= unknown&quot;); } else { printf(&quot;\n LC_COLLATE &nbsp;= %s&quot;,str); }</p>
<p> &nbsp; str = setlocale(LC_CTYPE &nbsp; , NULL); if (str == NULL) { printf(&quot;\n LC_CTYPE &nbsp; &nbsp;= unknown&quot;); } else { printf(&quot;\n LC_CTYPE &nbsp; &nbsp;= %s&quot;,str); }</p>
<p> &nbsp; str = setlocale(LC_MONETARY, NULL); if (str == NULL) { printf(&quot;\n LC_MONETARY = unknown&quot;); } else { printf(&quot;\n LC_MONETARY = %s&quot;,str); }</p>
<p> &nbsp; str = setlocale(LC_NUMERIC , NULL); if (str == NULL) { printf(&quot;\n LC_NUMERIC &nbsp;= unknown&quot;); } else { printf(&quot;\n LC_NUMERIC &nbsp;= %s&quot;,str); }</p>
<p> &nbsp; str = setlocale(LC_TIME &nbsp; &nbsp;, NULL); if (str == NULL) { printf(&quot;\n LC_TIME &nbsp; &nbsp; = unknown&quot;); } else { printf(&quot;\n LC_TIME &nbsp; &nbsp; = %s&quot;,str); }</p>
<p> &nbsp; printf(&quot;\n\n&quot;</p>
<p>	 &nbsp; &quot; &nbsp; &nbsp;0 1 2 3 4 5 6 7 8 9 A B C D E F\n\n&quot;</p>
<p>	 &nbsp; &quot; 2 &nbsp;\x20 \x21 \x22 \x23 \x24 \x25 \x26 \x27 \x28 \x29 \x2a \x2b \x2c \x2d \x2e \x2f\n&quot;</p>
<p>	 &nbsp; &quot; 3 &nbsp;\x30 \x31 \x32 \x33 \x34 \x35 \x36 \x37 \x38 \x39 \x3a \x3b \x3c \x3d \x3e \x3f\n&quot;</p>
<p>	 &nbsp; &quot; 4 &nbsp;\x40 \x41 \x42 \x43 \x44 \x45 \x46 \x47 \x48 \x49 \x4a \x4b \x4c \x4d \x4e \x4f\n&quot;</p>
<p>	 &nbsp; &quot; 5 &nbsp;\x50 \x51 \x52 \x53 \x54 \x55 \x56 \x57 \x58 \x59 \x5a \x5b \x5c \x5d \x5e \x5f\n&quot;</p>
<p>	 &nbsp; &quot; 6 &nbsp;\x60 \x61 \x62 \x63 \x64 \x65 \x66 \x67 \x68 \x69 \x6a \x6b \x6c \x6d \x6e \x6f\n&quot;</p>
<p>	 &nbsp; &quot; 7 &nbsp;\x70 \x71 \x72 \x73 \x74 \x75 \x76 \x77 \x78 \x79 \x7a \x7b \x7c \x7d \x7e \x7f\n&quot;</p>
<p>	 &nbsp; &quot; 8 &nbsp;\x80 \x81 \x82 \x83 \x84 \x85 \x86 \x87 \x88 \x89 \x8a \x8b \x8c \x8d \x8e \x8f\n&quot;</p>
<p>	 &nbsp; &quot; 9 &nbsp;\x90 \x91 \x92 \x93 \x94 \x95 \x96 \x97 \x98 \x99 \x9a \x9b \x9c \x9d \x9e \x9f\n&quot;</p>
<p>	 &nbsp; &quot; a &nbsp;\xa0 \xa1 \xa2 \xa3 \xa4 \xa5 \xa6 \xa7 \xa8 \xa9 \xaa \xab \xac \xad \xae \xaf\n&quot;</p>
<p>	 &nbsp; &quot; b &nbsp;\xb0 \xb1 \xb2 \xb3 \xb4 \xb5 \xb6 \xb7 \xb8 \xb9 \xba \xbb \xbc \xbd \xbe \xbf\n&quot;</p>
<p>	 &nbsp; &quot; c &nbsp;\xc0 \xc1 \xc2 \xc3 \xc4 \xc5 \xc6 \xc7 \xc8 \xc9 \xca \xcb \xcc \xcd \xce \xcf\n&quot;</p>
<p>	 &nbsp; &quot; d &nbsp;\xd0 \xd1 \xd2 \xd3 \xd4 \xd5 \xd6 \xd7 \xd8 \xd9 \xda \xdb \xdc \xdd \xde \xdf\n&quot;</p>
<p>	 &nbsp; &quot; e &nbsp;\xe0 \xe1 \xe2 \xe3 \xe4 \xe5 \xe6 \xe7 \xe8 \xe9 \xea \xeb \xec \xed \xee \xef\n&quot;</p>
<p>	 &nbsp; &quot; f &nbsp;\xf0 \xf1 \xf2 \xf3 \xf4 \xf5 \xf6 \xf7 \xf8 \xf9 \xfa \xfb \xfc \xfd \xfe \xff\n&quot;</p>
<p> &nbsp; &nbsp; &nbsp;&quot;\n&quot;);</p>
<p>}</p>
<p>int main(int argc, char** argv)</p>
<p>{</p>
<p> &nbsp; info();</p>
<p> &nbsp; setlocale(LC_CTYPE,&quot;&quot;);</p>
<p> &nbsp; info();</p>
<p>	return 0;</p>
<p>}</p></div>
<hr/><p><em>referenced by</em></p><div style="margin-left: 1em"><p>2012/01/17 <a href="http://archives.miloush.net/michkap/archive/2012/01/17/10256884.html">The evolving Story of Locale Support, part 15: Fixing our listings up in Windows 8!</a></p><p>2010/09/15 <a href="http://archives.miloush.net/michkap/archive/2010/09/15/10062047.html">How to format? What locale?</a></p><p>2009/07/13 <a href="http://archives.miloush.net/michkap/archive/2009/07/13/9831700.html">Anything still wrong is probably wrong for good....</a></p><p>2008/06/01 <a href="http://archives.miloush.net/michkap/archive/2008/06/01/8567237.html">Seeing through the non-English "Mesh"</a></p><p>2006/11/19 <a href="http://archives.miloush.net/michkap/archive/2006/11/19/1106351.html">Another satisfied customer!</a></p><p>2006/09/22 <a href="http://archives.miloush.net/michkap/archive/2006/09/22/765506.html">Inaccurate localization can make you bust out laughing</a></p><p>2005/04/16 <a href="http://archives.miloush.net/michkap/archive/2005/04/16/408853.html">Not all keyboards are included in MSKLC's lists</a></p><p>2005/04/14 <a href="http://archives.miloush.net/michkap/archive/2005/04/14/408116.html">On approaching international programming....</a></p><p>2005/02/21 <a href="http://archives.miloush.net/michkap/archive/2005/02/21/377288.html">Give me a [word-]break!</a></p><p>2005/02/04 <a href="http://archives.miloush.net/michkap/archive/2005/02/04/366922.html">GEOID -- The LCIDs maligned little brother....</a></p><p>2005/02/03 <a href="http://archives.miloush.net/michkap/archive/2005/02/03/366698.html">English only! (or how to misuse NLS APIs)</a></p></div><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2005/02/02/365237.html" title="Handling shortcuts and accelerators in a real world situation">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2005/02/01/364376.html" title="Why that is positively Ethiopic!">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2005-02">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2005-02-01">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2005/02/01/364707.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:42 GMT -->
</html>