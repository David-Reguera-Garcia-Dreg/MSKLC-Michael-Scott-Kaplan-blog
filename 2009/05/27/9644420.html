<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2009/05/27/9644420.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:35 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>The whole truth about MB_PRECOMPOSED and MB_COMPOSITE</title></head><body>
<h1>The whole truth about MB_PRECOMPOSED and MB_COMPOSITE</h1>
<p><em>by Michael S. Kaplan, published on 2009/05/27 10:01 -04:00, original URI: http://blogs.msdn.com/b/michkap/archive/2009/05/27/9644420.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostNew -->
<p><font color="#ff0000"><i>As a by the way, this blog does NOT represent anything beyond my own personal thoughts. You could even blame it on my Tegretol dosage, to be perfectly honest (if the pain were not so intense I'd have skipped this med for sure). I am not even on the team that owns this code any more and I didn't own it when I was then. Just so you know....</i></font> 
</p><p>Recently when Shawn posted <a href="http://blogs.msdn.com/shawnste/archive/2009/05/06/don-t-use-mb-composite-mb-precomposed-or-wc-compositecheck.aspx" mce_href="http://blogs.msdn.com/shawnste/archive/2009/05/06/don-t-use-mb-composite-mb-precomposed-or-wc-compositecheck.aspx">Don't use MB_COMPOSITE, MB_PRECOMPOSED or WC_COMPOSITECHECK</a>, there were a few things he didn't mention.</p>
<p>For example, there is the fact that in builds of Windows 7 prior to the final release, the behavior is designed to use normalization.</p>
<p>Now of course there are a bunch of cases not in the tables in this Microsoft technology that pre-dates Unicode Normalization by more than half a decade, but that is small change.</p>
<p>And yes it means that MB_PRECOMPOSED will be a no-op for most code pages but for Vietnamese will destroy that special form "V" described in blogs like <a href="http://archives.miloush.net/michkap/archive/2005/07/09/437063.html" mce_href="http://archives.miloush.net/michkap/archive/2005/07/09/437063.html"><b>Getting intermediate forms</b></a> and <a href="http://archives.miloush.net/michkap/archive/2006/05/14/597198.html" mce_href="http://archives.miloush.net/michkap/archive/2006/05/14/597198.html"><b>Harder intermediate forms of characters</b></a> and <a href="http://archives.miloush.net/michkap/archive/2008/12/15/9215772.html" mce_href="http://archives.miloush.net/michkap/archive/2008/12/15/9215772.html"><b>Frost's The Form Not Taken</b></a>. Which destroys round-tripping for Vietnamese, at least.</p>
<p>But this too is chump change. Someone will care but it might have shipped before anyone noticed.</p>
<p>You know what did get noticed?</p>
<p>I'll give you a hint: MB_COMPOSITE.</p>
<p>And another hint: my own blog <a href="http://archives.miloush.net/michkap/archive/2005/02/19/376617.html%27" mce_href="../../../2005/02/19/376617.html'"><b>Stripping diacritics....</b></a>, which uses Unicode Normalization Form D to do its work, just like MB_COMPOSITE would nominally be expected to convert the text to Form D,</p>
<p>You give up? Well look at the fixed version of that code, found in <a href="http://archives.miloush.net/michkap/archive/2007/05/14/2629747.html" mce_href="http://archives.miloush.net/michkap/archive/2007/05/14/2629747.html"><b>Stripping is an interesting job (aka On the meaning of meaningless, aka All Mn characters are non-spacing, but some are more non-spacing than others)</b></a>.</p>
<p>Converting fully formed modern precomposed Hangul syllables to composite Jamo might be a fine idea if Microsoft had not been de facto enjoined nearly a decade ago from providing the fonts that would allow those conjoining Jamo to be composed (of course buffer sizes would be almost tripled but nothing is perfect!). </p>
<p>Given the current situation, however, this led to a disastrous situation.</p>
<p>Now with all that said, nearly every word that Shawn said in <a href="http://blogs.msdn.com/shawnste/archive/2009/05/06/don-t-use-mb-composite-mb-precomposed-or-wc-compositecheck.aspx" mce_href="http://blogs.msdn.com/shawnste/archive/2009/05/06/don-t-use-mb-composite-mb-precomposed-or-wc-compositecheck.aspx">Don't use MB_COMPOSITE, MB_PRECOMPOSED or WC_COMPOSITECHECK</a> is true. I just felt like the proper context was needed.</p>
<p>Especially in the context of the one part of his blog I really do disagree with:</p>
<blockquote>
<blockquote>
<p><i>Hopefully I've terrified you and you'll stop using these flags, perhaps using NormalizeString() if you really need similar behavior.</i></p></blockquote></blockquote>
<p>Since Unicode Normalization will cause many of the very same problems that these flags cause (e.g. poor roundtripping and especially the problems I note above with both Form C and Form D), scaring people away from the flags and suggesting the use of a function that in many contexts will produce results just as scary is probably not the best idea.</p>
<p>It was written at what I have learned is probably not the best point to write a blog: when one is in the process of losing and/or has just lost the argument against a change, since it can color one's argument in a specific direction that under ordinary circumstances one might not choose to do....</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p><font color="#ff0080"><i>This post brought to you by</i> ãƒ” <i>(<a href="http://www.fileformat.info/info/unicode/char/30d4" mce_href="http://www.fileformat.info/info/unicode/char/30d4">U+30d4</a>, a.k.a. KATAKANA LETTER PI)</i></font></p>
<hr/><p><strong>Ted</strong> on 15 Apr 2010 11:54 AM:</p><div style="margin-left: 1em"><p>I never did get around to asking you a particular question I was wondering about this blog entry for quite some time: since you stated that NormalizeString is not the answer either, what is the answer? Or is the answer to not do anything at all? </p></div>
<p><strong>Michael S. Kaplan</strong> on 15 Apr 2010 12:15 PM:</p><div style="margin-left: 1em"><p>Usually my recommendation is not to do anything; the few people who are cross-platform have specific requirements and those requirements should guide the actions (e.g. don't go to form D if you need to support Korean)....</p>
</div>
<hr/><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2009/05/28/9646177.html" title="&quot;Size matters, and at 8.25, yours simply isn&#39;t big enough,&quot; she said....">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2009/05/26/9641049.html" title="The Whey doesn&#39;t get a locale, either">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2009-05">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2009-05-27">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2009/05/27/9644420.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:35 GMT -->
</html>