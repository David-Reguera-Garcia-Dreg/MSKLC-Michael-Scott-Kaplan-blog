<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2006/09/29/776495.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:39 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>.NET is too busy being consistent with Windows to be consistent with itself....</title></head><body>
<h1>.NET is too busy being consistent with Windows to be consistent with itself....</h1>
<p><em>by Michael S. Kaplan, published on 2006/09/29 03:01 -04:00, original URI: http://blogs.msdn.com/b/michkap/archive/2006/09/29/776495.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostNew -->
<FONT face=Tahoma>
<P>Back in the early days of the planning for the .NET Framework, everyone was convinced that the <A href="http://msdn2.microsoft.com/en-us/library/system.globalization.cultureinfo.aspx">CultureInfo class</A> really needed to base itself off of the settings on the underlying version of Windows. People were simply convinced that it would be too confusing if they changed the date format or whatever in Windows, and the CurrentCulture did not pick up the change there. </P>
<P>Maybe they were right, but to be honest I have always been skeptical as to whether this dependency would actually lead to other more confusing behavior in different situations.</P>
<P>With that anticipatory bit of foreshadowing in place, I will proceed with the post. :-)</P>
<P>Mauli's question was straightforward enough: </P>
<BLOCKQUOTE dir=ltr style="MARGIN-RIGHT: 0px"><FONT face="Times New Roman" size=2>
<P>Hi all,<BR><BR>I found this issue while using Vista RC1 as a client, and Windows 2003 as the server using Arabic-Saudi Arabia culture. Both have Whidbey SP1 (SP1.50727.360). On Vista, the calendar used for the ar-SA culture is different from previous versions.&nbsp;&nbsp;&nbsp; On the client, I pass in the ar-SA short date string of Gregorian date 2004-12-27 to the server.&nbsp; On the server side,&nbsp; this string gets converted from its Arabic form into a Gregorian date. However, since the Arabic calendar on&nbsp; the server is different from the client, I get back the wrong Gregorian date.&nbsp; It seems that we should fix the same version of .net framework should always return the same calendar for ar-SA, no matter what the OS.&nbsp; Is there something that I'm missing? Why wouldn't the same version of the .net framework always return back the same calendar? <BR><BR>Using .NET, find the Arabic date range to use - I used this code snippet:</P>
<BLOCKQUOTE dir=ltr style="MARGIN-RIGHT: 0px"><B><FONT face="Consolas,Courier New">CultureInfo c = CultureInfo.CreateSpecificCulture("ar-SA");<BR>Thread.CurrentThread.CurrentCulture = c;<BR>DateTime d = new DateTime(2004, 12, 27);<BR>Console.WriteLine(d.ToShortDateString());<BR>DateTime d2 = new DateTime(2005, 1, 5);<BR>Console.WriteLine(d2.ToShortDateString()); 
<P></P></FONT></B></BLOCKQUOTE>
<P>Gregorian: 2004-12-27 to 2005-1-2005<BR>Arabic DateTime.ToShortDateString()<BR>Vista: "15/11/25" to "24/11/25"<BR>Windows 2003: "16/11/25" to "25/11/25"</P></FONT></BLOCKQUOTE>
<P>Uh oh, the worry here is that version 2.0 of the .NET Framework returns inconsistent results when it is run on a Windows 2003 machine with an Arabic (Saudi Arabia)&nbsp;user locale versus a Vista machine with an Arabic (Saudi Arabia)&nbsp;user locale. </P>
<P>Suddenly people aren't worried about the .NET Framework being consistent with Windows any more, are they? </P>
<P>Well, that is exactly what changed here. In Windows 2003 there is only the Hijri calendar, but in Vista the Um Al Qura (secular Hijri)&nbsp;calendar I have mentioned <STRONG><A href="http://archives.miloush.net/michkap/archive/2006/04/14/576627.html">previously</A></STRONG> has not only been added, but it is also the default. And the calendar setting choice is one of those properties you can override, whether you are looking at&nbsp;XP/Server 2003:</P>
<P><IMG height=478 src="http://trigeminal.fmsinc.com/images/ar-sa-cal-xp.png" width=404></P>
<P>where the default calendar is "<FONT size=4>التقويم&nbsp;الهجري</FONT>" (Hijri Era)&nbsp;or in Vista:</P>
<P><IMG src="http://trigeminal.fmsinc.com/images/ar-sa-cal-vista.png"></P>
<P>where the default calendar is "<FONT size=4>تقويم ام القرى</FONT>" (UmAlQura). One could always override the Vista choice if one wanted to, going back to that existing Hijri calendar.</P>
<P>Now of course the .NET Framework also added this new calendar, thus you can get either the <A href="http://msdn2.microsoft.com/en-us/library/system.globalization.umalquracalendar(VS.80).aspx">UmAlQuraCalendar Class</A> or the <A href="http://msdn2.microsoft.com/en-us/library/system.globalization.hijricalendar(VS.80).aspx">HijriCalendar class</A>. And the new default in the 2.0 version of the .NET Framework is the UmAlQura calendar, but this too can be overridden, whether explicitly in code or implicitly by it being the default user locale with a different calendar setting.</P>
<P>So, if you are running code in the 2.0 version of the .NET Framework that uses the Arabic (Saudi Arabia) culture then you will get consistent results except in the case where Windows instructs the .NET Framework to use a different calendar (which it must do on Server 2003 and earlier since there was not yet an UmAlQura calendar to use.</P>
<P>Now I will be the first to admit that the few people who customize their date formats may have been confused to not see the changes in the .NET Framework. But in my opinion their&nbsp;problem is a lot easier to explain to people than this sort of calendar issue, because it is easier to say that Windows and the .NET Framework are separate but the .NET Framework results will be consistent within the same version.</P>
<P>Which is all water under the bridge now, except for every once in a while when someone hits this kind of issue again. :-)</P>
<P>&nbsp;</P>
<P><FONT color=#ff1493><EM>This post brought to you by</EM> <STRONG><FONT size=6>ت</FONT></STRONG> <EM>(<A href="http://www.fileformat.info/info/unicode/char/062a">U+062a</A>, a.k.a. ARABIC LETTER TEH)</EM></FONT></P></FONT>
<hr/><p><a id="776716" href="#776716">#</a> <strong>Adam</strong> on 29 Sep 2006 4:27 AM:</p><div style="margin-left: 1em">Hang on - I thought that one of the goals of .NET was for it to be platform-independent so that implementations on other systems (e.g. Mono on Linux) would be able to run .NET applications just as well as the MS implementation on Win32.<br><br>What the *hell* is it doing being more consistent with Windows than itself?<br><br>Or was the &quot;platform independence&quot; thing just a big marketing lie to get people who were worried about vendor lock-in to develop for it? Only they're screwed now.<br><br>And MS wonders why no-one trusts them!</div>
<p><a id="776890" href="#776890">#</a> <strong>Michael S. Kaplan</strong> on 29 Sep 2006 9:05 AM:</p><div style="margin-left: 1em">Hi Adam, <br><br>Note that they both have the same capabilities -- it is just that they are responding to external stimuli (in this case different locale settings). The complaint is about like complaining that CurrentCulture returns different results if you have different locale settings....<br><br>In other words, the complaint is specious, as is yours (just a little bit). :-)</div>
<p><a id="781087" href="#781087">#</a> <strong>Dean Harding</strong> on 2 Oct 2006 1:10 PM:</p><div style="margin-left: 1em">Well, I think the way it works is correct. If you're going to display the data to the user then you should use whatever settings they choose. <br/><br/>If you're going to trasfer data between processes, then you should use a non-culture-aware method anyway.</div>
<p><a id="792432" href="#792432">#</a> <strong>Aldo.Net</strong> on 4 Oct 2006 8:01 PM:</p><div style="margin-left: 1em">Agree, to some degree (pardon the rhyme :-)<br/>Can't it be that Windows is too busy shipping improved versions (and assuming everyone will use the latest) and not giving enough importance to backward compatibility?<br/>Not a flame - just a thought based on some observations of the facts. Some breaking changes are really a must, regardless of the pain they cause - is this one of those?</div>
<p><a id="792741" href="#792741">#</a> <strong>Michael S. Kaplan</strong> on 4 Oct 2006 10:58 PM:</p><div style="margin-left: 1em"><p>The change to support the new government mandated Saudi calendar in both Windows and the .NET Framework is very much a change for the sake of the standard, actually....</p>
</div>
<p><a id="792744" href="#792744">#</a> <strong>Michael S. Kaplan</strong> on 4 Oct 2006 10:59 PM:</p><div style="margin-left: 1em"><P>Additionally, the notion that we could never ever add a calendar even if one were needed in a particular market is also pretty unpalatable. <BR><BR>The user's preferences and choices are being respected by everyone other than the developer.... :-)</P></div>
<hr/><p><em>referenced by</em></p><div style="margin-left: 1em"><p>2010/03/18 <a href="http://archives.miloush.net/michkap/archive/2010/03/18/9976688.html">Whether the currency sign is right or wrong could be something of a crapshoot</a></p><p>2008/05/14 <a href="http://archives.miloush.net/michkap/archive/2008/05/14/8502723.html">Windows is too busy being consistent with the user to be consistent with itself!</a></p><p>2007/06/26 <a href="http://archives.miloush.net/michkap/archive/2007/06/26/3559309.html">Behold the [non-fa-IR default] PersianCalendar class</a></p><p>2006/10/15 <a href="http://archives.miloush.net/michkap/archive/2006/10/15/829978.html">Compatibility is inconsistent; consistency is not compatible...</a></p></div><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2006/09/30/778345.html" title="StrCmp for humans? It&#39;s in there!">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2006/09/28/774957.html" title="If you just don&#39;t think you can hold it (64-bit style!)">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2006-09">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2006-09-29">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2006/09/29/776495.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:39 GMT -->
</html>