<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2006/09/23/768178.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:39 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>The modern solution to the problem of Traditional Spanish in Vista</title></head><body>
<h1>The modern solution to the problem of Traditional Spanish in Vista</h1>
<p><em>by Michael S. Kaplan, published on 2006/09/23 14:01 -04:00, original URI: http://blogs.msdn.com/b/michkap/archive/2006/09/23/768178.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostNew -->
<FONT face=Tahoma>
<P>A while back (well, in March of this year) I was talking about <STRONG><A href="http://archives.miloush.net/michkap/archive/2006/03/12/549951.html">Traditional versus modern sorts</A></STRONG>, and I mentioned there that I wasn't going to talk about Traditional Spanish then, but that you should stay tuned for a future blog post. </P>
<P>Hopeully you were not holding your breath or anything, but let me be the first to welcome you to the future blog post! </P>
<P>The Traditional Spanish sort (0x0000040a) has a long and interesting history, including but not limited to the fact that Mexican Spanish (0x0000080a) actually went right along with it even after the rest of the world including Spin had moved on. In fact, this lasted until Windows 2000, when the sorting for Mexican Spanish was silently move over to match the rest of the locales in the Spanish speaking world, a fact that most people never seemed to notice (people in Mexico might have!).</P>
<P>When the actual change took place is more complicated to figure out then one might think, due to the&nbsp;fasciatingly complex&nbsp;machinations of the Windows development process. And it was made even more complicated by the fact the Windows 2000 beta data was at one point&nbsp;snapshot'ed by Jet 4.0, though the way they and later SQL Server flattened non-unique collations hides the fact that they inherited a Traditional Spanish Mexican sort.</P>
<P>Lucky them, lucky us. :-)</P>
<P>Now the original change to add an LCID for new collation before LCIDs contained the notion of a SORTID is&nbsp;one that was able to embarrass me <STRONG><A href="http://archives.miloush.net/michkap/archive/2005/02/12/371650.html">in the past</A></STRONG>, and has left Windows with an interesting wart where both 0x0000040a and 0x00000c0a are both enumerated as regular LCIDs even though all of their data other than the name and the sort are basically identical. A whole generation of applications trying to show lists of locales have to know to strip that 'Traditional' one out. </P>
<P>And when you consider how we silently slid Mexico over, we likely should have done the same with Spain, too (did anyone notice how we palmed the Mexican card?).</P>
<P>In Vista, the addition of <A href="http://msdn.microsoft.com/library/en-us/intl/nls_EnumSystemLocalesEx.asp">EnumSystemLocalesEx</A> with its LOCALE_ALTERNATE_SORTS that returns locale names alongside the venerable <A href="http://msdn.microsoft.com/library/en-us/intl/nls_9qk3.asp">EnumSystemLocales</A> with its LCID_ALTERNATE_SORTS led to an interesting question. I mean, as Julie <STRONG><A href="http://archives.miloush.net/michkap/archive/2005/02/12/371650.html">pointed out to me</A></STRONG> the original concept of alternate sorts came out of the postmortem of the Traditional/Modern Spanish issue.</P>
<P>Perhaps Vista, with its new major version for collation, was the best time to move 0x0000040a over into the alternate sorts column, since that is what it actually is, what alternate sorts were really designed for? </P>
<P>And this is the way we went.</P>
<P>The documentation for&nbsp;<A href="http://msdn.microsoft.com/library/en-us/intl/nls_EnumSystemLocalesEx.asp">EnumSystemLocalesEx</A> points it out rather directly:</P>
<BLOCKQUOTE dir=ltr style="MARGIN-RIGHT: 0px">
<P><FONT face="Times New Roman" size=2>If <I>dwFlags</I> specifies LOCALE_ALTERNATE_SORTS, the callback function will be called for every locale that represents an alternate sort order. For example, Spanish (Spain) defaults to international sort order, but traditional sort order is available as an alternate sort. German (Germany) defaults to dictionary sort order, but there is an alternate phone book sort order available.</FONT></P></BLOCKQUOTE>
<P>The question of what to do with <A href="http://msdn.microsoft.com/library/en-us/intl/nls_9qk3.asp">EnumSystemLocales</A>&nbsp;was one that was hotly debated between those who thought that the functions returning consistent results was most important versus those who thought that the backcompat was most important versus those who think both oif these points are equally important requiring both functions to return the old result.</P>
<P>One could argue that backcompat has never been too terribly important here for sorting updates and alt. sort updates. Whether one remembers (0x00010427) Classical Lithuanian or (0x0000080a) Mexican Spanish that sorts like Traditional Spanish or the (0x00010412) Korean and (0x00010411) Japanese Unicode sort orders in Windows that I talked about <STRONG><A href="http://archives.miloush.net/michkap/archive/2004/12/14/307152.html">here</A></STRONG> and <A href="http://archives.miloush.net/michkap/archive/2004/12/14/284838.html"><STRONG>here</STRONG></A>, it is obvious that we have had no problem just making the change in a new version it's the right thing to do.</P>
<P>Why we stood on ceremony for Modern Spanish and even gave it another LCID is beyond me, though in the end the plan for Vista is to have both enumeration functions in Vista treat Traditional Spanish as an alternate sort and <STRONG>not</STRONG> include it in the regular locales. </P>
<P>Which (by the way) is also the reason for how long it took to do this post. You see, I put this decision on the list of decisions that whether right or wrong I could see some major bug being put in that would require the plan to change, so I essentially waited to see if the decision would withstand the big bug (which it did, yesterday). </P>
<P>In total fairness to the bug I coded the 'fix' to revert the old funtction's behavior&nbsp;and it was tested, while the whole conversation about what to do was discussed and triaged and rediscussed and retriaged. I exerted minimal inluence on any of the conversations though I agreed with every correct and intelligent point that&nbsp;was brought&nbsp;up&nbsp;(there were many) and said I would go with whatever decision people wanted to go with (as an ultimate test of the <A href="http://blogs.msdn.com/jledgard/archive/2006/03/12/548708.aspx">sanity will prevail</A> theory).</P>
<P>And you want to know what? I think that in the end,&nbsp;it did.</P>
<P>So, it is now official -- as of Vista, Traditional Spanish is seen as an alternate sort in Windows, and next week when I am talking to Julie before <A href="http://viennateng.com/">Vienna Teng</A> opens for <A href="http://www.madeleinepeyroux.com/">Madeleine Peyroux</A> at the Moore I can tell her that we finally cleaned that little issue up. :-)</P>
<P>&nbsp;</P>
<P><FONT color=#ff1493><EM>This post brought to you by</EM> <STRONG><FONT size=6>Ã±</FONT></STRONG> <EM>(<A href="http://www.fileformat.info/info/unicode/char/00f1">U+00f1</A>, a.k.a. LATIN SMALL LETTER N WITH TILDE)</EM></FONT></P></FONT>
<hr/><div style="margin-left: 1em"><em>no comments</em></div><hr/><p><em>referenced by</em></p><div style="margin-left: 1em"><p>2009/09/02 <a href="http://archives.miloush.net/michkap/archive/2009/09/02/9890204.html">How ConvertDefaultLocale sorta broke backward compatibility in Windows 7, and why</a></p><p>2006/10/03 <a href="http://archives.miloush.net/michkap/archive/2006/10/03/784459.html">They say it happens to everyone, at some point...</a></p></div><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2006/09/24/768343.html" title="Intended Implicatures?">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2006/09/23/765745.html" title="We have it, we just aren&#39;t calling it that in the docs">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2006-09">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2006-09-23">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2006/09/23/768178.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:39 GMT -->
</html>