<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2006/09/01/735817.174100.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:39 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>Cue the smarter version of GetDateFormat... ok, it's a wrap!</title></head><body>
<h1>Cue the smarter version of GetDateFormat... ok, it's a wrap!</h1>
<p><em>by Michael S. Kaplan, published on 2006/09/01 17:41 +00:00, original URI: http://blogs.msdn.com/michkap/archive/2006/09/01/735817.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostGoogleFeed -->
<font face="Tahoma">
<p>I've mentioned Tarek Mahmoud Sayed from the GIFT development team <strong><a href="http://archives.miloush.net/michkap/archive/2005/09/14/464780.html">in the past</a></strong>. The other day, in helping out some folks who were dealing with the issues I pointed out in <strong><a href="http://archives.miloush.net/michkap/archive/2006/03/03/542963.html">How To [NOT] detect that a locale is bidi</a></strong> and <strong><a href="http://archives.miloush.net/michkap/archive/2006/02/08/527375.html">They make 'em smarter than GetDateFormat</a></strong>, and at the end of the conversation had produced a nice wrapper around GetDateFormat that takes away the bulk of the need for developers calling <a href="http://msdn.microsoft.com/library/en-us/intl/nls_5w6s.asp">GetDateFormat</a> to figure out what flags to pass if they are not sure.</p>
<p>I thought maybe I would post the code here so others could benefit! :-)</p>
<p>Anyway, here is the wrapper:</p>
<blockquote dir="ltr" style="MARGIN-RIGHT:0px"><b><font face="Consolas,Courier New,Courier" size="2">
<p>int GetDateFormatWrapper(<br>    LCID Locale, <br>    DWORD dwFlags, <br>    CONST SYSTEMTIME* lpDate, <br>    LPCTSTR lpFormat, <br>    LPTSTR lpDateStr, <br>    int cchDate <br>)<br>{<br>    DWORD dwBidiFlags = 0;</p>
<p>    if ((dwFlags &amp; (DATE_LTRREADING | DATE_RTLREADING)) == 0)<br>    {<br>        WCHAR FontSignature[16];<br>        CALID CalId;</p>
<p>        dwBidiFlags = DATE_LTRREADING;</p>
<p>        if (GetLocaleInfo(<br>                Locale, <br>                LOCALE_FONTSIGNATURE, <br>                (LPWSTR) FontSignature, <br>                sizeof(FontSignature)/sizeof(FontSignature[0])) <br>             &amp;&amp;<br>                FontSignature[7] &amp; 0x0800<br>             &amp;&amp; <br>                GetLocaleInfo(Locale, <br>                    LOCALE_ICALENDARTYPE | LOCALE_RETURN_NUMBER, <br>                    (LPWSTR) &amp;CalId, <br>                    sizeof(CalId)/sizeof(WCHAR))) {<br><br>            <font color="#006400">// Bidi Locale</font><br>            if (PRIMARYLANGID(LANGIDFROMLCID(Locale)) == LANG_HEBREW) {<br>                if ((dwFlags &amp; DATE_SHORTDATE) == 0 || CalId == CAL_HEBREW) {<br>                    dwBidiFlags = DATE_RTLREADING;<br>                }<br>            } else if ( CalId == CAL_GREGORIAN || <br>                        CalId == CAL_HIJRI || <br>                        CalId == 23 || <font color="#006400">// CAL_UMALQURA</font> <br>                        CalId == CAL_GREGORIAN_ARABIC || <br>                        CalId == CAL_GREGORIAN_XLIT_ENGLISH || <br>                        CalId == CAL_GREGORIAN_XLIT_FRENCH) {<br>                dwBidiFlags = DATE_RTLREADING;<br>            }<br>        }<br>    }</p>
<p>    return GetDateFormat(Locale, dwFlags | dwBidiFlags, lpDate, lpFormat, lpDateStr, cchDate);<br>}</p></font></b></blockquote>
<p>This function has some very compelling features to it, such as the fact that it integrates the IsBidi sort of code I talked about previously and that the signature of the wrapper is identical, but what I like best about it is that if this functionality were added to <a href="http://msdn.microsoft.com/library/en-us/intl/nls_5w6s.asp">GetDateFormat</a> in a future version of Windows that then none of the code calling the wrapper would be broken. :-)</p>
<p>Enjoy!</p>
<p> </p>
<p><font color="#ff1493"><em>This post brought to you by <a href="http://www.fileformat.info/info/unicode/char/200f"><em>U+200f</em></a>, RIGHT-TO-LEFT MARKER</em></font></p></font>
<hr/><div style="margin-left: 1em"><em>comments not archived</em></div><hr/><p><em>referenced by</em></p><div style="margin-left: 1em"><p>2012/01/16 <a href="http://archives.miloush.net/michkap/archive/2012/01/16/10256752.html">I'm reasonably certain that those who disagree with me here are wrong!</a></p><p>2008/09/24 <a href="http://archives.miloush.net/michkap/archive/2008/09/24/8963238.html">It used to be right, dammit!</a></p><p>2008/02/20 <a href="http://archives.miloush.net/michkap/archive/2008/02/20/7810085.html">Officially unofficial? Or Unofficially official?</a></p><p>2007/11/02 <a href="http://archives.miloush.net/michkap/archive/2007/11/02/5808539.html">Predictably (in retrospect), aka Where Wild^H^H^Hindows-Only Things Are, aka SHORT [on ]TIME for a LONG TIME</a></p><p>2006/12/11 <a href="http://archives.miloush.net/michkap/archive/2006/12/11/1262690.html">IsComplexEnoughForYou?</a></p><p>2006/12/09 <a href="http://archives.miloush.net/michkap/archive/2006/12/09/1246712.html">On being consistently consistent, while still managing to be dead wrong</a></p><p>2006/10/15 <a href="http://archives.miloush.net/michkap/archive/2006/10/15/827944.html">Not everything you might want out of a GetDateFormatEx, but think of it as a fixer-upper</a></p><p>2006/10/06 <a href="http://archives.miloush.net/michkap/archive/2006/10/06/795575.html">What do those marks do again?</a></p></div><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2006/09/01/735817.html" title="Cue the smarter version of GetDateFormat... ok, it&#39;s a wrap!">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2006/08/31/733302.html" title="And if your language starts playing a different TUNE">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2006-09">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2006-09-01">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2006/09/01/735817.174100.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:39 GMT -->
</html>