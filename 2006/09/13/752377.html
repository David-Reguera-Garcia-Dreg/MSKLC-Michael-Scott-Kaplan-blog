<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2006/09/13/752377.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:39 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>Who would win in a fight between VK_DECIMAL and LOCALE_SDECIMAL?</title></head><body>
<h1>Who would win in a fight between VK_DECIMAL and LOCALE_SDECIMAL?</h1>
<p><em>by Michael S. Kaplan, published on 2006/09/13 16:01 -04:00, original URI: http://blogs.msdn.com/b/michkap/archive/2006/09/13/752377.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostNew -->
<FONT face=Tahoma>
<P>What is that old expression about <STRONG>When it's time to railroad...</STRONG> again?</P>
<P>The other day, regular reader and MVP Mihai Nita asked in the Suggestion Box: </P>
<BLOCKQUOTE dir=ltr style="MARGIN-RIGHT: 0px"><FONT face="Times New Roman" size=2>
<P>Recently I bumped into something, and I think is a Windows keyboard driver bug. <BR><BR>But since when blaming someone I like to give a chance to defense, so here it is: <BR>- start Notepad <BR>- select the Italian keyboard <BR>- type a number using the NumPad, and use the dot/comma there (VK_DECIMAL) <BR><BR>This is it! <BR>Can you see it? <BR><BR>VK_DECIMAL on Italian keyboard produces a dot! Same with French keyboard and some others. The German and Romanian keyboards produce a comma, (as I think they should). I did not try to fully review of all the keyboards, these are just some random examples. <BR><BR>Isn't VK_DECIMAL the "decimal separator" (as suggested by the name?). And isn't the whole idea of NumPad to allow typing numeric values in one place? <BR><BR>Excel is smarter and seems to do the right thing. Meaning if I press VK_DECIMAL, it will use the User Locale decimal separator (respecting my override also), and it completely ignores the current keyboard. <BR><BR>Yes, I can intercept the VK_KEYDOWN and deal with it (probably what Excel does), but don't you think is normal to get some help from the OS? <BR><BR>In the end there are only two answers: <BR>- the keyboard drivers are wrong (and this is a chance to fix them, maybe for Vista :-) <BR>- some national keyboard standards are wrong and the driver is just standard compliant (and then we learned something) <BR><BR>Ok, this is your topic suggestion :-) </P></FONT></BLOCKQUOTE>
<P>And then, interestingly enough, <A href="http://katyal.livejournal.com/">Katya</A>&nbsp;(don't follow the link to her blog if you don't know Russian!), our awesome contact in the MS subsidiary in Russia, also&nbsp;asked about&nbsp;the same issue:</P>
<BLOCKQUOTE dir=ltr style="MARGIN-RIGHT: 0px"><FONT face="Times New Roman" size=2>
<P>Hi Michael, <BR><BR>I wonder if you could share your knowledge about the following problem: when entering numbers through numpad, some programs get VK_Decimal value and generate this symbol (Notepad, Word), while others like Excel look into LOCALE_SDECIMAL and generate this symbol. <BR><BR>I got a question from customer who has to deal with 3rd party app which seems uses VK_Decimal. But for Russian users it's inconvenient as they have to control in what keyboard mode they are, as in English keyboard, period is generated, while in Russian mode, coma is generated. <BR><BR>any hints how user can setup the keyboard to generate what is saved in LOCALE_SDECIMAL and to ignore what is in VK_decimal when Numlock is ON?<BR><BR>(yes, user has used MSKLC&nbsp; to change VK_decimal value, but if there is any other way to resolve the problem?)</P></FONT></BLOCKQUOTE>
<P>It is almost like when it is time for an issue to come up here that many people have the issue going on? When it's time to railroad... :-)</P>
<P>In any case, they are both right in the sense that:</P>
<UL>
<LI>There is really NO consistency&nbsp;between the various keyboards about what is on VK_DECIMAL</LI>
<LI>There is really NO consistency between the various language keyboards' VK_DECIMAL assignment and the related locales' LOCALE_SDECIMAL value from <A href="http://msdn.microsoft.com/library/en-us/intl/nls_34rz.asp">GetLocaleInfo</A></LI></UL>
<P>However, Mihai is mistaken in believing this to a keyboard bug; it is a limitation in the architecture that keyboards are&nbsp;entirely data-based and have to be able to be called in the kernel mode component of USER (a.k.a. USERK) and is therefore unable to call user-mode functions like the NLS API function <A href="http://msdn.microsoft.com/library/en-us/intl/nls_34rz.asp">GetLocaleInfo</A>. This is something applications can do (and it is something that Excel does, as both of them note), but not something that keyboards can do.</P>
<P>As for what is actually assigned to VK_DECIMAL, that is something that for every keyboard is either defined in a standard or&nbsp;decided by the person/people who submitted the keyboard layout. It may match the locale's preferences or it may not, but it is what it is and it is a tough argument to make that it should be changed&nbsp;since (for better or worse) the behavior in applications that do not override it amounts to an expectation of behavior, and changing it is a bad experience for users.</P>
<P>It is in fact the reason why keyboards almost never change, ever.</P>
<P>For what it is worth, this particular issue is one of the reasons why the VK_DECIMAL key is included in the <A href="http://www.microsoft.com/globaldev/tools/msklc.mspx">MSKLC</A> layout, even when the rest of the numeric pad is not.</P>
<P>But either way, it does make for an interesting blog post! :-)</P>
<P>&nbsp;</P>
<P><FONT color=#ff1493><EM>This post brought to you by</EM> <STRONG><FONT size=6>.</FONT></STRONG> <EM>(U+200e, a.k.a. FULL STOP)</EM></FONT></P></FONT>
<hr/><p><a id="752746" href="#752746">#</a> <strong>Maurits</strong> on 13 Sep 2006 5:05 PM:</p><div style="margin-left: 1em">&quot;When railroading time comes you can railroad---but not before&quot;<br>-- Robert A. Heinlein, The Door Into Summer<br><br>?</div>
<p><a id="753333" href="#753333">#</a> <strong>Michael S. Kaplan</strong> on 14 Sep 2006 1:37 AM:</p><div style="margin-left: 1em">That is one of the references. Though I think that subconsciously I was pondering more about the way Doug Hofstadter described the &quot;Magic Cube&quot; back in his metamagical themas column in Scientific American -- how some ideas just get expressed when the time comes, and that there is not realy causality in it all....</div>
<p><a id="753458" href="#753458">#</a> <strong>c2j2</strong> on 14 Sep 2006 3:13 AM:</p><div style="margin-left: 1em">Mihai,<br><br>use the driver from <a rel="nofollow" target="_new" href="http://www.sysinternals.com/Utilities/Ctrl2Cap.html">http://www.sysinternals.com/Utilities/Ctrl2Cap.html</a> and change it slightly so that it returns a comma instead of the dot.<br><br>Possibly looking through the www you can find such a driver already done, as it's not very rare to have that quest.<br><br>Christian<br></div>
<p><a id="753469" href="#753469">#</a> <strong>Michael S. Kaplan</strong> on 14 Sep 2006 3:22 AM:</p><div style="margin-left: 1em">Hi Christian, <br><br>Yes, that is a solution just like a custom layout with MSKLC is -- but neither one provides a solution that makes the VK_DECIMAL value follow the default user locale's notion of LOCALE_SDECIMAL, including user overrides (which is what Excel does)....</div>
<p><a id="754081" href="#754081">#</a> <strong>ReallyEvilCanine</strong> on 14 Sep 2006 10:31 AM:</p><div style="margin-left: 1em">Why not include the number pad in the KLC? It would let me change it to a hex keypad for entry as easily as I change keyboards now. I admit a bit of creativity is required but yes, some people actually spend a not-insignificant amount of time typing in hex values.</div>
<p><a id="754317" href="#754317">#</a> <strong>Ivan Rouzanov</strong> on 14 Sep 2006 1:10 PM:</p><div style="margin-left: 1em">Interesting and related issue is that WM_CHAR brings character code and WM_KEYDOWN (and WM_KEYUP) - virtual key code, and key code like VM_DECIMAL has nothing to do with character code in the particular keyboard layout.<br><br>If one would think about applications like games it all makes sense - in those you want the key to work certain way no matter which layout is active now.<br>But in other applications and even standard controls like Edit and RichEdit you have a choice - for the same event (keyboard key was pressed) you receive multiple messages and it is up to you (or the control you use) which one to process and how.<br>And RichEdit reacts to WM_KEYDOWN in this case and Edit - to WM_CHAR. Thus Wordpad and Notepad behave differently.</div>
<p><a id="754751" href="#754751">#</a> <strong>RubenP</strong> on 14 Sep 2006 5:35 PM:</p><div style="margin-left: 1em">I've always wondered (probably just me): why doesn't the US International keyboard provide the comma through Alt Gr + Num Decimal? It would make entering decimals though the number pad a little less painful for several non-English languages. (Though you do need a spare hand tapping the Alt Gr.)<br><br>I never knew Excel behaved the way it does. I must say: rather clever.</div>
<p><a id="754761" href="#754761">#</a> <strong>Michael S. Kaplan</strong> on 14 Sep 2006 5:44 PM:</p><div style="margin-left: 1em">I like the Excel behavior, too. If there were actually a way to make it an OS-wide thing I'd pursue that, but there isn't. :-(</div>
<p><a id="756640" href="#756640">#</a> <strong>RubenP</strong> on 15 Sep 2006 6:04 PM:</p><div style="margin-left: 1em">Maybe stuff like this should become part of the OS developer guidelines. There are so many nifty keyboard tricks inside Office either no-one knows about (like this one), or they only work inside Office and some-other-built-in-control-you-didn't-expect (alternatingly the plain text box, RichEdit or IE, but never all at the same time).<br><br>(If you look at XP's or Vista's UI guidelines, they're an unorganized mess, full of out-dated ugly screenshots and incomplete information and no consistency to find anywhere. Pity, as consistency is one heck of a UX booster. OMG, did I actually use the term UX in a meaningful context? ;-)</div>
<p><a id="757263" href="#757263">#</a> <strong>Mihai</strong> on 16 Sep 2006 3:31 AM:</p><div style="margin-left: 1em">&lt;&lt;mistaken in believing this to a keyboard bug; it is a limitation in the architecture that keyboards are entirely data-based ... and is therefore unable to call user-mode functions like the NLS API function GetLocaleInfo.&gt;&gt;<br><br>Even with that limitation I can still see it as a keyboard bug, in some cases.<br>True, the keyboard driver cannot do what Excle does. But at least can map to VK_DECIMAL the decimal separator for that keyboard locale.<br>So, if the user locale is English and the keyboard is Italian, then I get comma. Is not perfect, but in most cases the two locales match. So on an Italian OS, with Italian user locale and using Italian keyboard, I will get the right thing.</div>
<p><a id="757485" href="#757485">#</a> <strong>Michael S. Kaplan</strong> on 16 Sep 2006 7:25 AM:</p><div style="margin-left: 1em">Mihai -- the data is not available to the keyboard-- so it cannot map things as you suggest. <br><br>So the keyboard has a hard-coded mapping, and that mapping is based on whatever the source says it is.</div>
<p><a id="760024" href="#760024">#</a> <strong>Mihai</strong> on 17 Sep 2006 9:48 PM:</p><div style="margin-left: 1em">&lt;&lt;the data is not available to the keyboard-- so it cannot map things as you suggest.&gt;&gt;<br>I understand this.<br>But it seems I don't explain it clear enough.<br>There is enough data for the keyboard creator to &quot;hard-code the right thing.&quot; I know I design and Italian keyboard and I know that in Italian the decimal separator is comma, so I hard-code VK_DECIMAL to be comma.<br><br>&lt;&lt;So the keyboard has a hard-coded mapping, and that mapping is based on whatever the source says it is.&gt;&gt;<br>And the hard-coded mapping for the Italian keyboard can say (in the source) that VK_DECIMAL maps to comma. It is hard-coded, not dynamic in any way, not perfect, but better than dot.<br>This is why I say that the keyboard drivers are wrong or &lt;b&gt;some national keyboard standards are wrong&lt;/b&gt;.<br><br>What I argue is this: take the Italian keyboard in MSKLC, change VK_DECIMAL to comma, and this is better than the current thing.<br>Playing with the DDK and keyboard drivers many years ago, I do understand that there is no way to get the Excel bahavior from the keyboard driver level.<br><br>I hope I have managed to explain it clear enough (three times, in three different ways :-)</div>
<p><a id="760034" href="#760034">#</a> <strong>Michael S. Kaplan</strong> on 17 Sep 2006 10:00 PM:</p><div style="margin-left: 1em">Hey Mihai, <BR><BR><EM>There is enough data for the keyboard creator to "hard-code the right thing."</EM><BR><BR>Well, usually. But what do you do with layouts used in multiple places (like the 'US International' layout)? And in the end it is still up to the author of the keyboard. <BR><BR>It is someone else who is "wrong" by an arbitrary definition, sure. But we do not second guess the authors.... <BR><BR><EM>What I argue is this: take the Italian keyboard in MSKLC, change VK_DECIMAL to comma, and this is better than the current thing.</EM><BR><BR>For a user, yes. For Microsoft, it has shipped this way in multiple versions and changing it could break someone. Better to not touch it, truly -- the risk of breaking someone expecting it to be the way it is would be much worse....</div>
<p><a id="760038" href="#760038">#</a> <strong>Michael S. Kaplan</strong> on 17 Sep 2006 10:05 PM:</p><div style="margin-left: 1em">It would be a nice to have feature to consider in a future version of MSKLC, though probably only for new layouts rather than when loading from existing (in which case we should load from existing and not second guess it)<br><br>Though come to think of it, this may make a good validation warning either way -- I'll suggest this for a future version....</div>
<p><a id="761023" href="#761023">#</a> <strong>Mihai</strong> on 18 Sep 2006 1:54 PM:</p><div style="margin-left: 1em">&lt;&lt;<br>&lt;i&gt;What I argue is this: take the Italian keyboard in MSKLC, change VK_DECIMAL to comma, and this is better than the current thing.&lt;/i&gt;<br><br>For a user, yes.<br>&gt;&gt;<br><br>I only care about the user, I don't work for MS :-)<br></div>
<p><a id="761065" href="#761065">#</a> <strong>Michael S. Kaplan</strong> on 18 Sep 2006 2:54 PM:</p><div style="margin-left: 1em">But as a request to change the one in the box, there are those wider issues to consider, of course.</div>
<p><a id="761205" href="#761205">#</a> <strong>Mihai</strong> on 18 Sep 2006 5:33 PM:</p><div style="margin-left: 1em">&lt;&lt;But as a request to change the one in the box, there are those wider issues to consider, of course.&gt;&gt;<br><br>It was a smiley there :-)<br></div>
<hr/><p><em>referenced by</em></p><div style="margin-left: 1em"><p>2011/04/09 <a href="http://archives.miloush.net/michkap/archive/2011/04/09/10151666.html">[Keyboard ]Solution Unsatisfactory</a></p><p>2008/12/08 <a href="http://archives.miloush.net/michkap/archive/2008/12/08/9183424.html">The "plate of shrimp" theory explains it</a></p><p>2006/09/14 <a href="http://archives.miloush.net/michkap/archive/2006/09/14/754162.html">Why doesn't MSKLC have a numeric keypad?</a></p></div><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2006/09/13/753262.html" title="Michael&#39;s Brain?">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2006/09/13/752086.html" title="MSKLC and Vista? MSKLC and 64-bit? Darn, we&#39;re 0 for 2....">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2006-09">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2006-09-13">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2006/09/13/752377.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:39 GMT -->
</html>