<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2006/09/06/742073.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:39 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>IsSortable() == false? Well, sometimes it may be lying....</title></head><body>
<h1>IsSortable() == false? Well, sometimes it may be lying....</h1>
<p><em>by Michael S. Kaplan, published on 2006/09/06 03:01 -04:00, original URI: http://blogs.msdn.com/b/michkap/archive/2006/09/06/742073.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostNew -->
<FONT face=Tahoma>
<P>Have you ever had two different people on your team where each of them came up with a cool feature idea, but the combination of the two ideas did not exactly work as well as it could have?</P>
<P>I suppose you can blame someone ine the group who is tasked with doing&nbsp;that wider review of features, looking for compat issues. Like a <A href="http://archives.miloush.net/michkap/archive/2005/03/15/395685.html">Technical Lead</A>? </P>
<P>And that would be true even if it was actually the same person rather than two different people. Though in that case it should fall less on the <A href="http://archives.miloush.net/michkap/archive/2005/03/15/395685.html">Technical Lead</A>&nbsp;and more on the person who came up with the two ideas. </P>
<P>Of course in this case the person who came up with the two ideas was me, the person who is also the technical lead. So I guess logic puts this one on me either way. :-)</P>
<P>Anyway, yesterday <A href="http://archives.miloush.net/michkap/archive/2006/08/21/707790.html">Aldo Donetti</A> contacted me again with an interesting question. It went something like this:</P>
<BLOCKQUOTE dir=ltr style="MARGIN-RIGHT: 0px"><FONT face="Times New Roman" size=2>
<P>Not sure why I thought Mongolian would be sortable in Vista...<BR><BR>… and it’s not. (checked on CLR 2.0 and Vista RC1) Do you know if it should be? (together with Yi, Uyghur &amp; Tibetan). CompareInfo.IsSortable returns false. <A href="http://msdn2.microsoft.com/en-us/library/ms143036.aspx">Here</A> it does not say that the method is CurrentCulture-sensitive. Am I missing something obvious? What cultures can I use for the comparison to&nbsp; work? Thanks again.</P></FONT></BLOCKQUOTE>
<P>You know what? Aldo is right.</P>
<P>The first part of the problem is that <A href="http://msdn2.microsoft.com/en-us/library/ms143036.aspx">CompareInfo.IsSortable</A> (a method I added that I&nbsp;have mentioned <STRONG><A href="http://archives.miloush.net/michkap/archive/2005/06/28/433365.html">before</A></STRONG>) is static, and uses the information in the sorting tables built into the .NET Framework itself.</P>
<P>Which is fine in and of itself.</P>
<P>But then you add in&nbsp;"Windows Only"&nbsp;Cultures, which I have&nbsp;<STRONG><A href="http://archives.miloush.net/michkap/archive/2006/08/15/701011.html">talked</A></STRONG> <STRONG><A href="http://archives.miloush.net/michkap/archive/2006/03/20/555288.html">about</A></STRONG>&nbsp;<STRONG><A href="http://archives.miloush.net/michkap/archive/2006/03/01/541074.html">many</A></STRONG> <STRONG><A href="http://archives.miloush.net/michkap/archive/2006/04/08/571353.html">times</A></STRONG> before. These helpful cultures are synthesized by .NET when the underlying platfom supports a locale that the .NET Framework does not understand. </P>
<P>And then you hit the second problem - if you are running on Vista than support for Mongolian, Yi, Uighur, and Tibetan was added via the&nbsp;"Windows Only"&nbsp;mechanism and you can create cultures for all of the following:</P>
<P><STRONG><FONT face="Consolas,Courier New" size=2>0x0850&nbsp;&nbsp;&nbsp;mn-Mong-CN&nbsp;&nbsp;&nbsp;(Mongolian)<BR>0x0478&nbsp;&nbsp;&nbsp;ii-CN&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(Yi)<BR>0x0480&nbsp;&nbsp;&nbsp;ug-CN&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(Uighur)<BR>0x0451&nbsp;&nbsp;&nbsp;bo-CN&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(Tibetan)</FONT></STRONG></P>
<P>But it is getting sorting information from Windows, which the static <A href="http://msdn2.microsoft.com/en-us/library/ms143036.aspx">CompareInfo.IsSortable</A>&nbsp;does not know about. And thus the strings that <A href="http://archives.miloush.net/michkap/archive/2005/01/18/355210.html">have no weight</A>&nbsp;as far as the .NET Framework knows will return <STRONG>false</STRONG> when this method is called.</P>
<P>Now the "fix" here is easy to contemplate (add an instance method as well which&nbsp;can then be based on the actual&nbsp;<A href="http://msdn2.microsoft.com/en-us/library/2z428sw8.aspx">CompareInfo</A> being used)&nbsp;and hard to implement in the next version of .NET a.k.a. Orcas&nbsp;(due to some interesting compatibility rules related to 'red bits' that folks over in DevDiv have set up that <A href="http://blogs.msdn.com/somasegar/archive/2006/05/18/601354.aspx">Soma</A> and <A href="http://blogs.msdn.com/jackg/archive/2006/06/09/624517.aspx">Jack</A> and <A href="http://blogs.msdn.com/jasonz/archive/2006/05/21/603544.aspx">Jason</A> and others have discussed which apparently apply to every freaking line of code we own).</P>
<P>But if course you can do it yourself, too (for now)&nbsp;-- you can p/invoke the Win32 NLS API function <A href="http://msdn.microsoft.com/library/en-us/intl/nls_19ev.asp">IsNLSDefinedString</A> any time <A href="http://msdn2.microsoft.com/en-us/library/system.globalization.cultureinfo.culturetypes.aspx">CultureInfo.CultureTypes</A> includes <A href="http://msdn2.microsoft.com/en-us/library/system.globalization.culturetypes.aspx">CultureTypes.WindowsOnlyCultures</A>. Which is almost the right logic.</P>
<P>And we'll get around to fixing it eventually, I suppose. :-)</P>
<P>Now in the meantime several other interesting issues also come out of things covered here, which I will be covering in upcoming posts (a good Aldo question can usually be converted into several interestingt blog posts!).</P>
<P>&nbsp;</P>
<P><FONT color=#ff1493><EM>This post brought to you by</EM> <FONT face="Mongolian Baiti" size=6><STRONG>ᠳ</STRONG></FONT> <EM>(<A href="http://www.fileformat.info/info/unicode/char/1833">U+1833</A>, a.k.a.MONGOLIAN LETTER DA)</EM></FONT></P></FONT>
<hr/><p><strong>RubenP</strong> on 6 Sep 2006 4:13 PM:</p><div style="margin-left: 1em">I can't say I'm enthousiastic about this elusive 'red bits' policy. I've seen way too many posts on the connect site being shelved due to these 'red bits'. When one actually dares to ask what these 'red bits' entail, you'll just receive the same boilerplate 'red bits' text. Very constructive.<br><br>(I've got a policy too; I'm not saying what it is either, but the 'red bits' are definitely covered. :-)</div>
<p><strong>Michael S. Kaplan</strong> on 6 Sep 2006 6:15 PM:</p><div style="margin-left: 1em">Well, I can't say I am terribly enthusiastic about it either. I understand bugs, and the need/desire to fix them. Processes that block that seem flawed to me....</div>
<hr/><p><em>referenced by</em></p><div style="margin-left: 1em"><p>2010/02/18 <a href="http://archives.miloush.net/michkap/archive/2010/02/18/9964072.html">IsSortable IsFixed in CLR v4. Well, kind of....</a></p><p>2008/11/14 <a href="http://archives.miloush.net/michkap/archive/2008/11/14/9068578.html">When features collide (aka Your LCID sucks, but sometimes the bug sucks more)</a></p><p>2007/05/07 <a href="http://archives.miloush.net/michkap/archive/2007/05/07/2473828.html">Can't say sh*t, now can I? (aka On not biting the hand, yada yada yada)</a></p><p>2006/12/26 <a href="http://archives.miloush.net/michkap/archive/2006/12/26/1365492.html">The city elders won't give this string weight, either (aka On being consistently dead wrong, aka Ordinal or bust?)</a></p><p>2006/09/06 <a href="http://archives.miloush.net/michkap/archive/2006/09/06/742245.html">Why bother putting the size in the name if it's not always right?</a></p><p>2006/09/06 <a href="http://archives.miloush.net/michkap/archive/2006/09/06/742127.html">'Which is almost the right logic' -- WTF?</a></p></div><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2006/09/06/742127.html" title="&#39;Which is almost the right logic&#39; -- WTF?">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2006/09/05/741118.html" title="Don&#39;t quote me on this!">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2006-09">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2006-09-06">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2006/09/06/742073.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:39 GMT -->
</html>