<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2006/07/12/663013.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:39 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>How To detect that a culture is bidi</title></head><body>
<h1>How To detect that a culture is bidi</h1>
<p><em>by Michael S. Kaplan, published on 2006/07/12 04:01 -04:00, original URI: http://blogs.msdn.com/b/michkap/archive/2006/07/12/663013.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostNew -->
<P><FONT face=Tahoma>Andy Canfield asked: </FONT></P>
<BLOCKQUOTE dir=ltr style="MARGIN-RIGHT: 0px">
<P><FONT face=Garamond>I read your post here:</FONT></P>
<P><U><FONT face=Garamond color=#800080><A href="http://archives.miloush.net/michkap/archive/2006/03/03/542963.html"><STRONG>How To [NOT] detect that a locale is bidi</STRONG></A></FONT></U></P>
<P><FONT face=Garamond>and I have recently come up against this issue but have a slightly different problem. I know how to do what you showed in C but I need to translate it to C# for .Net 1.1 because the .Net environment I have to work in will not allow me to upgrade to .Net 2.0 where textinfo has a property that tells you wether or not it is bidi. So my question is ( since I do not know C# well at all ), is will you take a look at my code for a bidi aware MessageBox and tell me if I translated the C to C# correctly? If you will my code is below. If not then thank you for your time.</FONT></P>
<P><FONT face=Garamond>Andy</FONT></P></BLOCKQUOTE>
<P><FONT face=Tahoma>I did not include Andy's code (since it was really wrong; sorry Andy!). But here is a quick example of the code converted to C#:</FONT></P>
<BLOCKQUOTE dir=ltr style="MARGIN-RIGHT: 0px">
<P><FONT face="Consolas,Courier New" size=2><STRONG>using System;<BR>using System.Globalization;<BR>using System.Runtime.InteropServices;<BR><BR>namespace Sig {<BR>&nbsp;&nbsp;&nbsp; class test {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; private unsafe struct LOCALESIGNATURE {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public fixed uint lsUsb[4];<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public fixed uint lsCsbDefault[2];<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public fixed uint lsCsbSupported[2];<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; };&nbsp;<BR><BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; private const uint LOCALE_FONTSIGNATURE = 0x00000058;&nbsp;&nbsp; // font signature<BR><BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; [DllImport("kernel32.dll", CharSet=CharSet.Unicode, ExactSpelling=true, CallingConvention=CallingConvention.StdCall, SetLastError=true)]<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; private static extern int GetLocaleInfoW(int Locale, uint LCType, out LOCALESIGNATURE lpLCData, int cchData);<BR><BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; [STAThread]<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; static void Main(string[] args) {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if(args.Length &gt; 0) {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Console.WriteLine(IsBiDirectional(new CultureInfo(args[0])));<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } else {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Console.WriteLine("You must pass a culture name.");<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<BR><BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; internal unsafe static bool IsBiDirectional(CultureInfo ci) {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; LOCALESIGNATURE ls;<BR><BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if(GetLocaleInfoW(ci.LCID, LOCALE_FONTSIGNATURE, out ls, 16) &gt; 0 &amp;&amp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ((ls.lsUsb[3] &amp; 0x8000000) != 0)) {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return(true);<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } else {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return(false);<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<BR>&nbsp;&nbsp;&nbsp; }<BR>}</STRONG></FONT></P></BLOCKQUOTE>
<P><FONT face=Tahoma>One of the advantages that both C# and C++ have over C is that you can define multiple overloads for a function if there are different ways to call it. So a new, safe overload for <A href="http://msdn.microsoft.com/library/en-us/intl/nls_34rz.asp">GetLocaleInfo</A> that returns <A href="http://msdn.microsoft.com/library/en-us/intl/unicode_5ppu.asp">LOCALESIGNATURE</A> structs is just what we need. :-)</FONT></P>
<P><FONT face=Tahoma>When you compile it, make sure you use the /unsafe flag to csc.exe.... then just call your binary with the name of a culture (like ar-SA, he-IL, fr-FR, or whatever) and it will return the answer to the bidirectional question....</FONT></P>
<P><FONT face=Tahoma>From there you can do whatever you like to flip the MessageBox as needed.</FONT></P>
<P><FONT face=Tahoma></FONT>&nbsp;</P>
<P><FONT face=Tahoma color=#ff1493><EM>This post brought to you by</EM> <STRONG><FONT size=6>×ª</FONT></STRONG> <EM>(<A href="http://www.fileformat.info/info/unicode/char/05ea">U+05ea</A>, a.k.a. HEBREW LETTER TAV)</EM></FONT></P>
<hr/><p><a id="663111" href="#663111">#</a> <strong>dono</strong> on 12 Jul 2006 4:38 AM:</p><div style="margin-left: 1em">I do not have a 1.1 compiler available at the moment, but wasn't the fixed size buffer syntax added in the 2.0 release? ie, code like &quot;public fixed uint lsUsb[4];&quot; etc.<br>Andy specifically stated that he can not upgrade to 2.0.</div>
<p><a id="663297" href="#663297">#</a> <strong>Michael S. Kaplan</strong> on 12 Jul 2006 8:30 AM:</p><div style="margin-left: 1em">Is it a 2.0 feature? Hmmmm..... <BR><BR>Well, another easy way to do it is a slightly different struct definition that will do the same thing: <BR><BR>&nbsp; &nbsp; &nbsp; &nbsp;private struct LOCALESIGNATURE { <BR>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;public uint lsUsb0; <BR>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;public uint lsUsb1; <BR>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;public uint lsUsb2; <BR>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;public uint lsUsb3; <BR>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;public uint lsCsbDefault0; <BR>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;public uint lsCsbDefault1; <BR>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;public uint lsCsbSupported0; <BR>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;public uint lsCsbSupported1; <BR>&nbsp; &nbsp; &nbsp; &nbsp;}; <BR><BR>This should work in all versions, and even lets you avoid the unsafe keyword!</div>
<p><a id="665762" href="#665762">#</a> <strong>Andy</strong> on 14 Jul 2006 11:52 AM:</p><div style="margin-left: 1em">Michael,<br> &nbsp; &nbsp;Thank you for your help on this! C# is very new to me and I am still trying to get sorted out what I know in C and C++ and how it translates to C#. I got a compile error on having &quot;fixed&quot; in a declaration saying I can't do it. Is the fixed keyword something I could get rid of or do I need to ensure it stays pinned some other way?<br>Thank you. This has been a great help so far,<br>Andy</div>
<p><a id="665876" href="#665876">#</a> <strong>Michael S. Kaplan</strong> on 14 Jul 2006 1:32 PM:</p><div style="margin-left: 1em">Check the comment above yours.... :-)</div>
<p><a id="666060" href="#666060">#</a> <strong>Andy</strong> on 14 Jul 2006 4:21 PM:</p><div style="margin-left: 1em">Worked like a charm. Thank you again for your help on this.</div>
<hr/><p><em>referenced by</em></p><div style="margin-left: 1em"><p>2012/01/16 <a href="http://archives.miloush.net/michkap/archive/2012/01/16/10256752.html">I'm reasonably certain that those who disagree with me here are wrong!</a></p><p>2006/12/21 <a href="http://archives.miloush.net/michkap/archive/2006/12/21/1331650.html">It's not right when IsRightToLeft is wrong</a></p></div><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2006/07/13/664166.html" title="Going out on a Date$">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2006/07/12/662739.html" title="Device fonts are people too">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2006-07">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2006-07-12">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2006/07/12/663013.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:39 GMT -->
</html>