<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2006/07/04/656051.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:39 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>Behind Norman's 'Who needs Unicode?' post</title></head><body>
<h1>Behind Norman's 'Who needs Unicode?' post</h1>
<p><em>by Michael S. Kaplan, published on 2006/07/04 08:30 -07:00, original URI: http://blogs.msdn.com/michkap/archive/2006/07/04/656051.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostOld -->
<P><FONT face=Tahoma>In his usual charming style, regular newsgroup contributor Norman Diamond posted the following to the microsoft.public.win32.programmer.international and microsoft.public.word.international features newsgroups: </FONT></P>
<BLOCKQUOTE dir=ltr style="MARGIN-RIGHT: 0px">
<P><FONT face="Times New Roman" size=2>My hard disk has a file, whose path will likely be wrapped by Outlook Express:<BR>C:\Program Files\Windows CE Tools\wce500\Windows Mobile 5.0 Smartphone SDK\Samples\CPP\Win32\Mapirule\readme.txt<BR><BR>Among useful bits of information are found the following:<BR><BR><FONT face="Conolas,Courier New"><STRONG>&gt; Client痴 transport (SMS, ActiveSync, POP3) arrives.<BR></STRONG></FONT><BR>and:<BR><BR><FONT face="Consolas,Courier New"><STRONG>&gt; where &lt;clsid&gt; represents the COM object痴 class ID GUID<BR></STRONG></FONT><BR>That deserves an award for being self-descriptive.&nbsp; A maker of such things as an operating system for Windows Mobile 5.0 Smartphones, an SDK for the same, and compilers that can target the same, just knew that they didn't have to use Unicode for documents like this because the ANSI code page would get the message across just fine.&nbsp; The ANSI code page is of course the one used by Notepad on desktop Windows systems such as XP, which defaults to code page 932 as delivered by Microsoft and preinstalled on PCs.&nbsp; The word 痴 really does describe the process that led to displaying the word 痴.<BR><BR>One might wonder if a maker of tons of documentation on how to use Unicode might want to learn how to use Notepad to save a .txt file in Unicode encoding so that this documentation file might provide information using some unknown characters other than 痴.&nbsp; A certain company which is known for being 痴 might have the ability to teach them.&nbsp; But a certain company which is known for being 痴 might not want to learn from them.</FONT></P></BLOCKQUOTE>
<P><FONT face=Tahoma>He does have a way with words (see the sponsor tag line for the 痴 (<A href="http://www.fileformat.info/info/unicode/char/75f4">U+75f4</A>) ideograph if you don't know the meaning of 痴 and want a better understanding of Norman's humor!).</FONT></P>
<P><FONT face=Tahoma>It is important to look beyond the words for a moment here, to see what we are talking about here. :-)</FONT></P>
<P><FONT face=Tahoma>Those who read <STRONG><A href="http://archives.miloush.net/michkap/archive/2006/06/14/631016.html">Behind 'How to break Windows Notepad'</A></STRONG> might have a hint of what is going on here -- we are looking at one of those "misunderstanding the characters in a file" problems. Though in this case it is not an ANSI file being mistaken for a Unicode one; it is an ANSI file in one code page on a machine whose CP_ACP is a different code page....</FONT></P>
<P><FONT face=Tahoma>Now I will be the first to admit that it seems foolish to rely on something as fragile as the default system code page for the readme file of a sample.</FONT></P>
<P><FONT face=Tahoma>If you convert <STRONG>痴</STRONG> to <A href="http://www.microsoft.com/globaldev/reference/dbcs/932.mspx">cp 932</A>, you get 0x9273, which had it been treated as <A href="http://www.microsoft.com/globaldev/reference/sbcs/1252.mspx">cp 1252</A> would be <STRONG>’s</STRONG>&nbsp;which is the clitic that is used in English to indicate&nbsp;a possessive. Thus the acutual strings would be:</FONT></P>
<BLOCKQUOTE dir=ltr style="MARGIN-RIGHT: 0px">
<P><FONT face=Tahoma><STRONG><FONT face="Courier New" size=2>&gt; Client’s transport (SMS, ActiveSync, POP3) arrives.</FONT></STRONG></FONT></P></BLOCKQUOTE>
<P><FONT face=Tahoma><FONT face="Times New Roman" size=2><FONT face=Tahoma size=3>and:</FONT></FONT></FONT></P>
<BLOCKQUOTE dir=ltr style="MARGIN-RIGHT: 0px">
<P><FONT face=Tahoma><FONT face="Consolas,Courier New"><STRONG><FONT size=2>&gt; where &lt;clsid&gt; represents the COM object’s class ID GUID</FONT><BR></P></BLOCKQUOTE></STRONG></FONT></FONT>
<P><FONT face=Tahoma>where <STRONG>’s</STRONG>&nbsp;is actually 0x92 and 0x73, which becomes&nbsp;<A href="http://www.fileformat.info/info/unicode/char/2019">U+2019</A> and <A href="http://www.fileformat.info/info/unicode/char/0073">U+0073</A>&nbsp;via <A href="http://www.microsoft.com/globaldev/reference/sbcs/1252.mspx">cp 1252</A>.</FONT></P>
<P><FONT face=Tahoma>Now&nbsp;since Microsoft Word will commonly takes <STRONG>'</STRONG> (<A href="http://www.fileformat.info/info/unicode/char/0027">U+0027</A>) and autocorrects it to <STRONG>’</STRONG>&nbsp;(<A href="http://www.fileformat.info/info/unicode/char/2019">U+2019</A>). </FONT></P>
<P><FONT face=Tahoma>No keyboard that Microsoft releases sticks <A href="http://www.fileformat.info/info/unicode/char/2019">U+2019</A> in a file, so it really looks like the problem is that the text was edited in Word at some point. That it became <STRONG>痴</STRONG> is just a real bit of irony that helped Norman point an ironic sort of a bug and helped me provide a good Unicode Lame List story. :-)</FONT></P>
<P><FONT face=Tahoma></FONT>&nbsp;</P>
<P><FONT face=Tahoma color=#ff1493><EM>This post brought to you by</EM> <STRONG><FONT size=8>痴</FONT></STRONG> <EM>(<A href="http://www.fileformat.info/info/unicode/char/75f4">U+75f4</A>, a.k.a. a CJK Unified Ideograph meaning foolish, stupid, dumb, silly)</EM></FONT></P>
<hr/><p><a id="656095" href="#656095">#</a> <strong>Adam</strong> on Tuesday, July 04, 2006 12:32 PM:</p><div style="margin-left: 1em">Just wondering - is MS planning on making any version of Windows use the UTF-8 codepage (65001) by default (ANSI and/or OEM) at any point in the future?<br></div>
<p><a id="656102" href="#656102">#</a> <strong>Michael S. Kaplan</strong> on Tuesday, July 04, 2006 12:43 PM:</p><div style="margin-left: 1em">Hi Adam, <BR><BR>This is not in the current POR, due to the fact that the various "A" functions are simply not built to handle a stream that can be up to four bytes per character....</div>
<p><a id="656117" href="#656117">#</a> <strong>Adam</strong> on Tuesday, July 04, 2006 1:21 PM:</p><div style="margin-left: 1em">Why? Don't they use MB_CUR_MAX (or MB_LEN_MAX for static buffers)?<br></div>
<p><a id="656178" href="#656178">#</a> <strong>Michael S. Kaplan</strong> on Tuesday, July 04, 2006 1:55 PM:</p><div style="margin-left: 1em">Adam, are you kidding? These functions were written ten years ago, some even longer. It is lucky that even DBCS is supported here!<br><br>Revisting thousands of legacy functions to make them solidly support UTF-8, working in both user and kernel mode, and asking the test team to run tens of thousands of new test cases in all of them, is simply too huge of an effort to ask of the Windows team.</div>
<p><a id="656204" href="#656204">#</a> <strong>Adam</strong> on Tuesday, July 04, 2006 3:18 PM:</p><div style="margin-left: 1em">Yeah, MB_{CUR,LEN}_MAX were only part of the original 1989 ANSI/1990 ISO C standard (and would therefore have been in a number of drafts and included in some implementations some time before that). 16 years is _way_ too short a time to allow for that sort of thing to eke its way into the Windows codebase.<br><br>And given that it'll take, what, maybe 5 years(?), between changing MB_LEN_MAX to 4 and a significant portion of Windows + Apps actually supporting it properly, the longer that change is put off, the better. Yes?<br></div>
<p><a id="656264" href="#656264">#</a> <strong>Michael S. Kaplan</strong> on Tuesday, July 04, 2006 4:27 PM:</p><div style="margin-left: 1em">Hmmm... sarcasm ignored. :-)<br><br>Coulda, woulda, shoulda -- it is a bit too late to argue how functions should have been written over a decade ago. <br><br>If you want to support Unicode, there are thousands of functions to support that -- and functions to convert between UTF-8 and the chosen preferred form of Unicode for the platform. <br><br>There really isn't an interest or desire in re-architecting ten thousand functions to support something that was not kept in mind by the hundreds of developers who did the original writing.<br><br>Like I said, coulda, woulda, shoulda. But we can't go back, and Unicode is supported (and the old ISO specs had a lot of problems with their Unicode support that were not solves until the 1999 update that Microsoft was doing a much better job on in the meantime!)....</div>
<p><a id="656281" href="#656281">#</a> <strong>Ruben</strong> on Tuesday, July 04, 2006 5:09 PM:</p><div style="margin-left: 1em">Somehow the adolescent in me wants to try and find sentences that translate into funny Chinese ones... I think I'm going to have a talk with his mom about that ;-)<br><br>But seriously. It's a pity DBCS doesn't include UTF-8 support. Although UTF-8 probably doesn't really fall in the 'DB' category.<br><br>Besides, the more file formats are moved to XML or UTF-8 + BOM, the less this matters. Except for Notepad, which doesn't look at &lt;?xml encoding=&quot;...&quot;?&gt;</div>
<p><a id="656390" href="#656390">#</a> <strong>Maurits</strong> on Tuesday, July 04, 2006 7:58 PM:</p><div style="margin-left: 1em">Sometimes I wish that Group Policy had a &quot;no smart quotes&quot; setting :(</div>
<p><a id="656393" href="#656393">#</a> <strong>Adam</strong> on Tuesday, July 04, 2006 8:04 PM:</p><div style="margin-left: 1em">Michael: Excessive sarcasm aside (sorry :), I don't see what you're getting at. So a bunch of old functions weren't necessarily written to best practices all the time. It happens, I'm aware of that. But why can't MS go back?<br><br>I'm sure as part of their recent security drive they've been going back over all that old code and fixing up calls to gets() or similar brokenness. Saying &quot;Oh, that bug is _old_, therefore we can't fix it&quot; seems, I dunno, like a bit of a poor excuse. Bugs that have just come to light, but happen to have existed for ages, still get fixed; don't they?<br><br>Apologies again - I realise that you didn't write the 10000 legacy functions, and probably don't manage the people who'd be fixing them if that were to happen, so don't take this too seriously. It just pains me when MS doesn't want to put resources to implementing something which would be a technically good idea and which other vendors (e.g. MacOS X and GNU/Linux (and, of course, Plan 9 :-) can use UTF-8 as the default user (and system?) encoding) are implementing, and I tend to go off on one a bit.<br><br><br>Ruben: UTF-8 + BOM? Bleargh. Check RFC 3629 (<a rel="nofollow" target="_new" href="http://www.faqs.org/rfcs/rfc3629.html">http://www.faqs.org/rfcs/rfc3629.html</a>) section 6 and the Unicode UTF &amp; BOM FAQ (<a rel="nofollow" target="_new" href="http://www.unicode.org/unicode/faq/utf_bom.html#BOM">http://www.unicode.org/unicode/faq/utf_bom.html#BOM</a>)<br><br>Yeah, you /can/ do it, but don't unless you /really/ have to.<br><br>UTF-8 can be sniffed pretty well anyway (better than a few other MBCSs) as the bit-pattern requirements for bytes 2-n of multibyte sequences are pretty strict.<br></div>
<p><a id="656444" href="#656444">#</a> <strong>Michael S. Kaplan</strong> on Tuesday, July 04, 2006 9:01 PM:</p><div style="margin-left: 1em">Adam, <BR><BR>This is more than just a bug fix in many cases. This is a literal per-function review, modfication, and test cycle for whole new scenarios across thousands and thousands of functions -- it is simply too huge of a project, for NO GAIN. Because all it would do is be a slightly slower version of the same one that has already existed. <BR><BR>We already support Unicode. The non-Unicode version is there for legacy, and is not being updated. It is only a technically good idea for people who don't want to update their byte-based code to support the actual Unicode interface that has been on the platform for over a decade....</div>
<p><a id="656446" href="#656446">#</a> <strong>Michael S. Kaplan</strong> on Tuesday, July 04, 2006 9:10 PM:</p><div style="margin-left: 1em">To look at it another way, since you are comparing it to the Security reviews that have happened....<br><br>SECURITY -- learning about the latest best practices and then assessing threats and fixing them has a specific benefit -- a more secure code base.<br><br>But the update you refer to would also break over a decade of third party applications that have been written, not to mention earlier versions of MS products that would also be broken. It is intentionally engineering the single largest backcompat break of all the time, and spending millions of dollars to do it!</div>
<p><a id="656512" href="#656512">#</a> <strong>Maurits</strong> on Wednesday, July 05, 2006 12:02 AM:</p><div style="margin-left: 1em">What about adding a file system metadata field that stores MIME type information? &nbsp;That would have solved this problem and the &quot;How to break Windows Notepad&quot; problem.<br><br>Imagine... a .txt file with a MIME type metadata field of<br>text/plain;charset=iso-8859-1<br>or<br>text/plain;charset=utf-8<br>etc.</div>
<p><a id="656515" href="#656515">#</a> <strong>Michael S. Kaplan</strong> on Wednesday, July 05, 2006 12:06 AM:</p><div style="margin-left: 1em">For a plain old text file? Hmmm.<br><br>On the whole, this can usually be thought of as overuse/misuse of Notepad, if you know what I mean....<br><br>It is why I laugh every time someone complains about how Notepad's UTF-8 BOM is breaking their UNIX shell scripts. Talk about irony. :-)</div>
<p><a id="656850" href="#656850">#</a> <strong>Adam</strong> on Wednesday, July 05, 2006 8:46 AM:</p><div style="margin-left: 1em">Urgh! Under what conditions does notepad insert a UTF-8 BOM? If I open a UTF-8 (without BOM) file in notepad as UTF-8, make changes and save it again, does it suddenly get a BOM?<br></div>
<p><a id="656918" href="#656918">#</a> <strong>Michael S. Kaplan</strong> on Wednesday, July 05, 2006 10:16 AM:</p><div style="margin-left: 1em">Yes Adam, that is what happens.<br><br>See <a rel="nofollow" target="_new" href="http://archives.miloush.net/michkap/archive/2005/01/20/357028.html">http://blogs.msdn.com/michkap/archive/2005/01/20/357028.aspx</a> for more info on the argument....</div>
<p><a id="657309" href="#657309">#</a> <strong>Adam</strong> on Wednesday, July 05, 2006 7:32 PM:</p><div style="margin-left: 1em">OK, I can get that hint - it's all been said before.<br><br>*sigh* :-/<br></div>
<hr/><p><em>referenced by</em></p><div style="margin-left: 1em"><p>2007/01/03 <a href="http://archives.miloush.net/michkap/archive/2007/01/03/1392379.html">UTF-8 and GB18030 are both 'NT' code pages, they just aren't 'ANSI' code pages</a></p><p>2006/07/14 <a href="http://archives.miloush.net/michkap/archive/2006/07/14/665714.html">Can the CP_ACP be UTF-8?</a></p></div><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2006/07/05/656199.html" title="The one with all of the language info">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2006/07/04/655821.html" title="What I did last night">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2006-07">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2006-07-04">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2006/07/04/656051.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:39 GMT -->
</html>