<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2006/10/03/784459.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:39 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>They say it happens to everyone, at some point...</title></head><body>
<h1>They say it happens to everyone, at some point...</h1>
<p><em>by Michael S. Kaplan, published on 2006/10/03 03:17 -04:00, original URI: http://blogs.msdn.com/b/michkap/archive/2006/10/03/784459.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostNew -->
<FONT face=Tahoma>
<P>I think I have to work on my timing. I needed to wait a little bit longer.</P>
<P>You see, about a week ago I was talking about <STRONG><A class="" href="http://archives.miloush.net/michkap/archive/2006/09/23/768178.html" mce_href="http://archives.miloush.net/michkap/archive/2006/09/23/768178.html">The modern solution to the problem of Traditional Spanish in Vista</A></STRONG>, and how after a bunch of waiting to make sure that the planned change was going to make it, I finally blogged about it. </P>
<P>I really waited until the triage bar was high. And when I say high I mean not just nosebleed high. I mean K2 high. </P>
<P>Of course (couldn't you guess?), a few days later it was discovered that the Visual&nbsp;C Runtime (CRT) function <A class="" href="http://msdn2.microsoft.com/zh-cn/library/x99tb11d.aspx" mce_href="http://msdn2.microsoft.com/zh-cn/library/x99tb11d.aspx ">SetLocale</A> is quite happy to take non-specific strings like <STRONG>"English"</STRONG> or <STRONG>"French"</STRONG> or <STRONG>"Spanish"</STRONG>. And how unfortunately if you pass <STRONG>"Spanish"</STRONG> in as the locale you wish to set your CRT to that it will basiclly create that 0x040a, MAKELCID(MAKELANGID(LANG_SPANISH, SUBLANG_SPANISH), SORT_DEFAULT), Traditional Spanish kind of sort that Spain and the rest of the&nbsp;Spanish-speaking world have chosen to reject, in a more definitive sense than Some of my less then stellar relationships have ended. </P>
<P>And what is worse, the way that the CRT, which is wise enough to carry around mapping tables for all of these unique and interesting ways to create a locale,&nbsp;does its locale validation not via the obvious mechanism of the <A class="" href="http://msdn.microsoft.com/library/en-us/intl/nls_74dh.asp" mce_href="http://msdn.microsoft.com/library/en-us/intl/nls_74dh.asp">IsValidLocale</A> function, but by enumerating the locales via a call to <A class="" href="http://msdn.microsoft.com/library/en-us/intl/nls_9qk3.asp" mce_href="http://msdn.microsoft.com/library/en-us/intl/nls_9qk3.asp">EnumSystemLocales</A> and then failing if it is not found.</P>
<P>Now obviously this is butt-stupid code and under ordinary circumstances the burden is on&nbsp;the components&nbsp;who make the mistakes to pay the price for them in terms of bug fixing. This is the principle of differentiated reponsibility in action, and can sometimes encourage better code writing in people who might otherwise not be thinking about having to service their code later....</P>
<P>Unfortunately, in this case many people use the static CRT, meaning this code is compiled into a lot of binaries and there is really no feasible way to service all of them. </P>
<P>And as obnoxious as it&nbsp;may be&nbsp;to not pay attention of the desire of people in Spain to not use the traditional sort by default, causing Spanish applications to randomly fail is bound to be worse in their eyes.</P>
<P>So the change has been backed out of <A class="" href="http://msdn.microsoft.com/library/en-us/intl/nls_9qk3.asp" mce_href="http://msdn.microsoft.com/library/en-us/intl/nls_9qk3.asp">EnumSystemLocales</A>, which will enumerate both 0x040a and 0x0c0a, even though one is an alternate sort of the other. <A class="" href="http://msdn.microsoft.com/library/en-us/intl/nls_EnumSystemLocalesEx.asp" mce_href="http://msdn.microsoft.com/library/en-us/intl/nls_EnumSystemLocalesEx.asp">EnumSystemLocalesEx</A> will continue to work the right way, at least.</P>
<P>I guess I posted just a little bit prematurely. Just a few days, but definitely prematurely.</P>
<P>They say it happens to everyone at some point. But somehow I just don't feel reassured. :-)</P>
<P mce_keep="true">&nbsp;</P>
<P><FONT color=#ff00ff><EM>This post brought to you by</EM> <FONT size=7>‡¶è</FONT> <EM>(<A class="" href="http://www.fileformat.info/info/unicode/char/098f" mce_href="http://www.fileformat.info/info/unicode/char/098f">U+098f</A>, a.k.a. BENGALI LETTER E)</EM></FONT></P></FONT>
<hr/><div style="margin-left: 1em"><em>no comments</em></div><hr/><p><em>referenced by</em></p><div style="margin-left: 1em"><p>2009/09/02 <a href="http://archives.miloush.net/michkap/archive/2009/09/02/9890204.html">How ConvertDefaultLocale sorta broke backward compatibility in Windows 7, and why</a></p></div><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2006/10/03/786095.html" title="What&#39;s the KeyboardDataQueueSize for?">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2006/10/02/783066.html" title="What would it mean to internationalize StrCmpLogicalW?">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2006-10">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2006-10-03">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2006/10/03/784459.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:39 GMT -->
</html>