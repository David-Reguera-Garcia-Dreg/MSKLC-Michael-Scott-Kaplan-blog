<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2006/10/08/806138.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:39 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>The return of double secret Unicode!</title></head><body>
<h1>The return of double secret Unicode!</h1>
<p><em>by Michael S. Kaplan, published on 2006/10/08 17:23 -04:00, original URI: http://blogs.msdn.com/b/michkap/archive/2006/10/08/806138.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostNew -->
<FONT face=Tahoma size=3>
<BLOCKQUOTE>
<P><FONT size=2><EM><STRONG>Greg Marmalard</STRONG>: You're talking about Visual Basic, sir.<BR><STRONG>Dean Vernon Wormer</STRONG>: Of course I'm talking about Visual Basic, you twerp! This applicatiion, it's gonna be different. This year we're gonna take the binary by its PDB and convert those strings into Unicode.<BR><STRONG>Greg Marmalard</STRONG>: What do you intend&nbsp;to do sir? VB strings are already in Unicode.<BR><STRONG>Dean Vernon Wormer</STRONG>: They are?&nbsp;<BR><STRONG>Greg Marmalard</STRONG>: Yes sir.<BR><STRONG>Dean Vernon Wormer</STRONG>: Well then as of this moment they will be converted to Double Secret Unicode!&nbsp;</EM></FONT></P></BLOCKQUOTE>
<P>Take a gander at the following code excerpt (it has a few problems in it!):</P>
<BLOCKQUOTE><FONT face="Consolas,Courier New,Lucide Console,Courier" size=2><B>
<P>100&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; si.cb = Len(si)<BR><BR>110&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; wUser = StrConv(UserName + Chr$(0), vbUnicode)<BR>120&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; wDomain = StrConv(DomainName + Chr$(0), vbUnicode)<BR>130&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; wPassword = StrConv(Password + Chr$(0), vbUnicode)<BR>140&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; wCommandLine = StrConv(CommandLine + Chr$(0), vbUnicode)<BR>150&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; wCurrentDir = StrConv(CurrentDirectory + Chr$(0), vbUnicode)<BR>160&nbsp; If regDoes_Key_Exist(HKEY_LOCAL_MACHINE, "CLUSTER") Then<BR>170&nbsp;&nbsp;&nbsp;&nbsp; Print #nLogFile, " This is a cluster so LOGON_WITH_PROFILE wiil be used."<BR>180&nbsp;&nbsp;&nbsp;&nbsp; Print #nLogFile, "Parameters to CreateProcessWithinLogonW=" &amp; _<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; wUser &amp; "," &amp; wDomain &amp; "," &amp; "wPassword", _<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; LOGON_WITH_PROFILE &amp; "," &amp; 0 &amp; "," &amp; wCommandLine &amp; "," &amp; _<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; CREATE_DEFAULT_ERROR_MODE &amp; "," &amp; 0 &amp; "," &amp; "," &amp; _<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; wCurrentDir<BR><BR>190&nbsp;&nbsp;&nbsp;&nbsp; Result = CreateProcessWithLogonW(wUser, wDomain, wPassword, _<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; LOGON_WITH_PROFILE, 0&amp;, wCommandLine, _<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; CREATE_DEFAULT_ERROR_MODE, 0&amp;, wCurrentDir, si, pi)</P></B></FONT></BLOCKQUOTE>
<P mce_keep="true">The first problem is not an international one, it is that <STRONG>si</STRONG>, well specifically the lpDesktop member, has to be set to something if the code is not meant to be run interactively. But that is not what this post is about.</P>
<P mce_keep="true">The second problem is one that you may remember if you have seen&nbsp;<STRONG><A class="" href="http://archives.miloush.net/michkap/archive/2005/10/28/486019.html" mce_href="http://archives.miloush.net/michkap/archive/2005/10/28/486019.html">It isn't Unicode, it's Double Secret Unicode!</A></STRONG> in the past. </P>
<P mce_keep="true">The simple truth is that with the except of Windows Codepage 1256 (Arabic), every single code page can lose information outside of it&nbsp;if you try to roundtrip the information through Unicode. And code that converts Unicode text to Unicode again and then converts it back is guaranteed therefore to lose information in some cases. Which is really a bad idea (in addition to a slower one, given six extraneous string conversions?). </P>
<P mce_keep="true">So please just say no to Double Secret Unicode! Don't let Dean Wormer have his way....</P>
<P mce_keep="true">&nbsp;</P>
<P mce_keep="true"><FONT color=#ff00ff><EM>This post brought to you by</EM> <FONT size=6>âˆ‚</FONT> <EM>(<A class="" href="http://www.fileformat.info/info/unicode/char/2202" mce_href="http://www.fileformat.info/info/unicode/char/2202">U+2202</A>, a.k.a. PARTIAL DIFFERENTIAL)</EM></FONT></P></FONT></FONT>
<hr/><p><a id="807314" href="#807314">#</a> <strong>Igor</strong> on 9 Oct 2006 12:00 AM:</p><div style="margin-left: 1em">Say no to Visual Basic.</div>
<hr/><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2006/10/09/807446.html" title="Where the hell did Replacement Locales come from?">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2006/10/08/803384.html" title="Stuffing the ballot box?">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2006-10">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2006-10-08">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2006/10/08/806138.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:39 GMT -->
</html>