<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2006/10/18/839439.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:39 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>IE7 exposes a flaw in Apache's support of basic language filtering described in RFC 4647</title></head><body>
<h1>IE7 exposes a flaw in Apache's support of basic language filtering described in RFC 4647</h1>
<p><em>by Michael S. Kaplan, published on 2006/10/18 15:01 -04:00, original URI: http://blogs.msdn.com/b/michkap/archive/2006/10/18/839439.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostNew -->
<P>Richard Ishida is concerned, as his <A class="" href="http://people.w3.org/rishida/blog/?p=68" mce_href="http://people.w3.org/rishida/blog/?p=68">I think IE7 is going to break language negotiation on many servers</A> post indicates. </P>
<P>I do disagree with his conclusion, however. </P>
<P>Clearly, a bunch of people <STRONG>will</STRONG> blame Internet Explorer 7.0, just as he did. But that is nothing new since people are much more likely blame Microsoft if something goes wrong no matter whose fault it really is. :-)</P>
<P>But in this case, the whole point of the tagging mechanism in <A class="" href="ftp://ftp.rfc-editor.org/in-notes/rfc4646.txt" mce_href="ftp://ftp.rfc-editor.org/in-notes/rfc4646.txt">RFC4646</A> and <A class="" href="ftp://ftp.rfc-editor.org/in-notes/rfc4647.txt" mce_href="ftp://ftp.rfc-editor.org/in-notes/rfc4647.txt">RFC4647</A> is to allow for matching by successively looking at subpieces of tags. It is not a model that Microsoft follows in its own clientside managed and unmanaged resource tagging, but it does not disrespect that model in web situations. </P>
<P>If I am wanting Mexican Spanish content, then <STRONG>es-MX</STRONG> is the right tag to use, and <STRONG>es</STRONG> is what any reasonable web server will fall back to. As RFC4647 clearly indicates:</P>
<BLOCKQUOTE>
<P>3.3.1.&nbsp; Basic Filtering<BR><BR>&nbsp;&nbsp; Basic filtering compares basic language ranges to language tags.<BR>&nbsp;&nbsp; Each basic language range in the language priority list is considered<BR>&nbsp;&nbsp; in turn, according to priority.&nbsp; A language range matches a<BR>&nbsp;&nbsp; particular language tag if, in a case-insensitive comparison, it<BR>&nbsp;&nbsp; exactly equals the tag, or if it exactly equals a prefix of the tag<BR>&nbsp;&nbsp; such that the first character following the prefix is "-".&nbsp; For<BR>&nbsp;&nbsp; example, the language-range "de-de" (German as used in Germany)<BR>&nbsp;&nbsp; matches the language tag "de-DE-1996" (German as used in Germany,<BR>&nbsp;&nbsp; orthography of 1996), but not the language tags "de-Deva" (German as<BR>&nbsp;&nbsp; written in the Devanagari script) or "de-Latn-DE" (German, Latin<BR>&nbsp;&nbsp; script, as used in Germany).&nbsp;</P></BLOCKQUOTE>
<P>This&nbsp;scheme is of&nbsp;course&nbsp;available in earlier versions of the standard as well. </P>
<P>Now I know Microsoft is new to this whole "following international standards and adding nothing proprietary" game, but&nbsp;shouldn't Richard's actual post claim what my post title does (<STRONG>IE7 exposes a flaw in Apache's support of basic language filtering described in RFC 4647</STRONG>) rather than what he did post?</P>
<P>With that said, I think his suggestions make sense. But I imagine it is always easier to listen to suggestions when the tone is not quite so accusatory. :-)</P>
<P mce_keep="true">&nbsp;</P>
<P><FONT color=#ff00ff><EM>This post brought to you by</EM>&nbsp;<STRONG><FONT size=5>e</FONT></STRONG> <EM>(<A class="" href="http://www.fileformat.info/info/unicode/char/0065" mce_href="http://www.fileformat.info/info/unicode/char/0065">U+0065</A>, a.k.a. LATIN&nbsp;SMALL LETTER E)</EM></FONT></P>
<hr/><p><a id="840304" href="#840304">#</a> <strong>Mihai</strong> on 18 Oct 2006 5:47 PM:</p><div style="margin-left: 1em"><p>&lt;&lt;people are much more likely blame Microsoft if something goes wrong&gt;&gt;</p>
<p>Just statistics.</p>
<p>If 95% of the market is Microsoft, then if something is wrong there are 95% chances the cause is Microsoft.</p></div>
<p><a id="841180" href="#841180">#</a> <strong>Michael S. Kaplan</strong> on 18 Oct 2006 7:10 PM:</p><div style="margin-left: 1em"><p>Not actually true, Mihai -- since most of the programs and utilities and device drivers that run on Windows are not from Microsoft! :-)</p>
</div>
<p><a id="841262" href="#841262">#</a> <strong>Richard Ishida</strong> on 18 Oct 2006 7:17 PM:</p><div style="margin-left: 1em"><p>Hello Michael. I'm not accusing or blaming anyone of anything. &nbsp;I'm just pointing out what I think will potentially become a problem for a lot of people with existing setups on servers such as Apache 1.3. I want to make sure that that is considered. The IE team are doing a lot of good things with IE7. Cheers.</p></div>
<p><a id="841428" href="#841428">#</a> <strong>Michael S. Kaplan</strong> on 18 Oct 2006 7:47 PM:</p><div style="margin-left: 1em"><P>Right, but is it fair to say "I think IE7 is going to break language negotiation on many servers" if it is Apache that has the flaw? IE7 is perhaps facillitating here, but they are hardly breaking anything; the break was always there if these servers were not handling the RFC correctly.... </P>
<P>Isn't this the point where someone points out the advantage of open source software being so much more agile since the bug fixes can happen sooner? :-)</P></div>
<p><a id="841799" href="#841799">#</a> <strong>Nick Lamb</strong> on 18 Oct 2006 8:57 PM:</p><div style="margin-left: 1em"><p>Apache is a web server, it implements HTTP/1.1 as per RFC 2616 which specifies its own language matching rule. The rules suggested in RFC 4647 could be included into a standard (such as a hypothetical HTTP/1.2) by reference, and are reasonable choices for any protocol where matching is obviously needed but no rules are specified in the standard. But they obviously don't apply to HTTP/1.1, SPARQL or to anything else that has its own rules about language matching.</p>
<p>The Apache documentation is pretty clear about the rules that are actually used, and it was linked from the original article so there's not much excuse.</p></div>
<p><a id="842817" href="#842817">#</a> <strong>Ben Cooke</strong> on 19 Oct 2006 2:53 AM:</p><div style="margin-left: 1em"><p>Rather than this &quot;everybody hates me! I think I'll go eat worms!&quot; attitude, I think it's more accurate to say that everyone blames whoever breaks the status quo. Even if the status quo is wrong.</p>
<p>For example:</p>
<p> * Any time someone proposes a new protocol that doesn't work through NAT, everyone cries foul at that protocol for being broken, when in reality it is NAT that is broken.</p>
<p> * Any time Microsoft releases a new OS that breaks old apps (which, since Microsoft invests so much time into testing this, happens less often than you'd expect) everyone breaks MS rather than the old apps, because it all worked until MS released the new OS, even though the new OS is complying to the letter with the API.</p>
<p> * Everyone (except the geeks who know better, of course!) blames Firefox for not being compatible with websites they visit that were designed for IE, even though it's those sites that are at fault for not complying with the standards. Consequently, Firefox is forced to emulate IE's non-standard behavior to be viable in the market.</p>
<p>There are lots of things out there that work &quot;well enough&quot; until someone comes along and does something &quot;more correctly&quot; and makes a fool out of the person who was too lazy to implement something properly in the first place. People don't like looking like fools, and third parties just see that &quot;it works in IE6 but not in IE7&quot;. I'd say the lesson here is to do things right the first time and then this kind of situation won't arise.</p></div>
<p><a id="843261" href="#843261">#</a> <strong>Nick Lamb</strong> on 19 Oct 2006 5:44 AM:</p><div style="margin-left: 1em"><p>Also, reading the IEblog article and RFC 4647 together, an Accept-Language range like &quot;es-MX&quot; as emitted by IE7 is neither an exact match for &quot;es&quot; on the web server, nor a prefix match. The RFC 4647 matching is in this sense equivalent to that in RFC 2616 here.</p>
<p>In plain English, if you ask specifically for Mexican Spanish, then it's not standards compliant to send you some other variant of Spanish. Similarly if you ask for a JPEG, you won't be sent a GIF. If you just want &quot;any kind of image&quot; you can ask for that and if you're happy with any kind of Spanish you can ask for that too, indeed the HTTP specification gently reminds readers that user agents need to put the work in to ensure the user gets what they're expecting here, apparently that work wasn't done in IE7.</p>
<p>Perhaps the terminology isn't familiar to Michael, which explains his mistake, but it's pretty disappointing if the IE team doesn't have anyone that actually knows about HTTP or language tag matching.</p></div>
<p><a id="844084" href="#844084">#</a> <strong>Michael S. Kaplan</strong> on 19 Oct 2006 10:18 AM:</p><div style="margin-left: 1em"><P>This is not the understanding that many people (including the authors) have about the rules of basic language filtering, nor does it match the intent of 4647 or its predecessors, that consider prefixes to tags to be a valid *fallback*. </P>
<P>Looking further into 4647 in the lookup section (3.4) it gives such an example explicitly:</P>
<P>&nbsp; Example of a Lookup Fallback Pattern</P>
<P>&nbsp; Range to match: zh-Hant-CN-x-private1-private2</P>
<P>&nbsp; 1. zh-Hant-CN-x-private1-private2</P>
<P>&nbsp; 2. zh-Hant-CN-x-private1</P>
<P>&nbsp; 3. zh-Hant-CN</P>
<P>&nbsp; 4. zh-Hant</P>
<P>&nbsp; 5. zh</P>
<P>&nbsp; 6. (default)</P>
<P>Notice #5 there? And honestly if the claim is that "zh-Hant-CN-x-private1-private2" can be expected to find "zh" in a lookup, how can "es-MX" not be expected to find "es"?</P>
<P>Earlier in the process of the 3066 update, Microsoft attempted to get its own "language-region-script" tags added as aliases to the "language-script-region" tags in the RFC, and after discussion they rejected this idea, since they preferred the simplicity of this subtag matching for fallback, and not adding the complication of having to do changes to order, which would break simple parsing algorithms. And they were quite clear on the intent and purpose....</P></div>
<p><a id="844311" href="#844311">#</a> <strong>Nick Lamb</strong> on 19 Oct 2006 11:20 AM:</p><div style="margin-left: 1em"><p>Michael, you're looking at section 3.4, which is for lookup, not filtering. Accept-Language is a filter header, so section 3.4 wouldn't be appropriate even if HTTP/1.1 relied on 3066 or 4647 rather than, as I've already said, specifying its own rules.</p>
<p>Lest it be thought that the consequences just weren't clear to the authors of the HTTP/1.1 specification, here's what the document itself says...</p>
<p>Note: When making the choice of linguistic preference available to the user, we remind implementors of the fact that users are not familiar with the details of language matching as described above, and should provide appropriate guidance. As an example, users might assume that on selecting &quot;en-gb&quot;, they will be served any kind of English document if British English is not available. A user agent might suggest in such a case to add &quot;en&quot; to get the best matching behavior.</p></div>
<p><a id="1021485" href="#1021485">#</a> <strong>MickMon</strong> on 7 Nov 2006 3:10 PM:</p><div style="margin-left: 1em"><p>OK - so there's clear agreement here that there is in fact an issue, albeit disagreement as to whose 'fault' it is.</p>
<p>Michael - a couple of questions: </p>
<p>1. Do you have any idea as to when the next IE7 update will be released?</p>
<p>2. Would you be able to address this issue in that update, and somehow amend how languages are specified?</p>
<p>Thanks,</p>
<p>~mm</p>
</div>
<p><a id="1021765" href="#1021765">#</a> <strong>Michael S. Kaplan</strong> on 7 Nov 2006 3:24 PM:</p><div style="margin-left: 1em"><p>Well, I'm not entirely clear that the nature/existence of a problem and its solution are agreed upon by all, but even if so and if everyone thought that IE's behavior should change, I am not even on the IE team -- seems like an issue to raise in the IE blog. :-) </p>
<p>In any case, I hear a lot of noise about how open source is more agile and they can get fixes in sooner and all that. So why can't the Apache web servers step up here and prove it? It would be a great case of &quot;putting their money where their mouth is&quot; here...</p>
</div>
<p><a id="5806807" href="#5806807">#</a> <strong>Jeff</strong> on 31 Oct 2007 7:37 PM:</p><div style="margin-left: 1em"><P>Who is Michael Kaplan anyway? &nbsp;He said, "In any case, I hear a lot of noise about how open source is more agile and they can get fixes in sooner and all that."</P>
<P>I say, Microsoft has not been agile since DOS days. &nbsp;I used to call Microsoft and get someone that actually made a fix to code within two or three days. &nbsp;The last time I called was a couple years ago. &nbsp;She barely spoke English so I added an especially southern drawl to everything I said. &nbsp;Finally she had a supervisor call me the next day. &nbsp;(That was strange.) &nbsp;The supervisor hadn't a clue - I can't even recall the topic it's been so long ago. &nbsp;In other words, calling Microsoft has become a joke - even if you have your credit card handy!</P>
<P>If Michael Kaplan has the interest in an Open Source feature, I'm sure the Open Source world would be happy to consider his updates or the updates he funds would be considered for inclusion in future Open Source releases. &nbsp;Please make sure none of that crappy Microsoft code gets into the contributed code. &nbsp;Those donkeys at Microsoft likely stole most of their code from UNIX anyway. &nbsp;Then they turn around and claim ownership. &nbsp;</P>
<P>I've bought hundreds of Microsoft packages in the past. &nbsp;Never again! &nbsp;I would fire anyone that put Vista on their machine. &nbsp;XP almost got stability correct after two major updates and many subsequent monthly fixes. &nbsp;Let's enum: a few DOS versions, Windows 3.1, Windows 95, Windows 98, Windows ME and &nbsp;Windows XP. &nbsp;Did I miss any? &nbsp;Is that 20 years of failure before an almost stable OS was created? &nbsp;</P>
<P>Incredible!</P></div>
<p><a id="5807150" href="#5807150">#</a> <strong>Michael S. Kaplan</strong> on 31 Oct 2007 8:13 PM:</p><div style="margin-left: 1em"><p>When you have over 80,000 employees, you are more complicated. Great newsflash!</p>
<p>Did you have a response to the actual issue raised?</p>
</div>
<hr/><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2006/10/19/842895.html" title="Sad? You can sit at your console and console yourself by putting Consolas in your console">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2006/10/18/839225.html" title="What do Shanghai and Taipei have in common? Mahjongg solitaire!">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2006-10">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2006-10-18">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2006/10/18/839439.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:39 GMT -->
</html>