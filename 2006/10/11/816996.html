<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2006/10/11/816996.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:39 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>Why can't the CP_ACP be UTF-8?</title></head><body>
<h1>Why can't the CP_ACP be UTF-8?</h1>
<p><em>by Michael S. Kaplan, published on 2006/10/11 11:05 -04:00, original URI: http://blogs.msdn.com/b/michkap/archive/2006/10/11/816996.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostNew -->
<FONT face=Tahoma size=3>
<P>Bart van der Werf asks: </P>
<BLOCKQUOTE>
<P><FONT face="times new roman,times" size=2><EM>I was working on getting a 8bit string application ready for other languages and i was suprised to see that the ACP (Ansi Codepage) character encoding (the default encoding for 8bit strings in windows) couldn't accept utf8 as a valid MBCS encoding.<BR><BR>Why isn't this the case ? it would allow all sorts of cleaned up legacy apps to become multilingual overnight.?</EM></FONT></P></BLOCKQUOTE>
<P>Now I'd be the first to criticize the search on this site, though there are many times it comes through. In this case a search on the terms <STRONG><A class="" href="http://archives.miloush.net/michkap/search.aspx?q=ACP+UTF-8&amp;p=1" mce_href="../../../../search.aspx?q=ACP+UTF-8&amp;p=1">ACP UTF-8</A></STRONG> returns as its first item <A class="" href="http://archives.miloush.net/michkap/archive/2006/07/14/665714.html" mce_href="http://archives.miloush.net/michkap/archive/2006/07/14/665714.html"><STRONG>Can the ACP be UTF-8?</STRONG></A>, posted&nbsp;a few months ago&nbsp;(it finds&nbsp;a ton of&nbsp;others that are pretty unrelated, but what it find first is what counts!).</P>
<P>To say a bit more on the topic, yes he is right -- it would make some operations much easier. But beyond that, taking the current model that ties the default system code page to the default system locale -- would this mean that you could only use such a UTF-8 ACP when dealing with Unicode-only locales? And would it provide easier internationalization to force a system-wide setting to be changed in order to make an application work? Ugh. As would breaking any existing application relying on the current behavior.</P>
<P>And&nbsp;then of course there is&nbsp;the cost is the huge PM/test/dev effort to bring every "A" API function (and underlying kernel API function as well)&nbsp;up to speed handling up to four bytes to character when so many of them are strictly limited to handling only one or two. Thousands of functions and whole systems (like&nbsp;for Window messaging). And some of these algorithms really do come from the original Win 3.x source for the "A" version!</P>
<P>It is not exaggerating to suggest that this effort could cost billions, impact thousands of people,&nbsp;and take years. For code that is and has been set up as legacy. There is simply no real way to even contemplate this as an effort that would get approval to proceed....</P>
<P mce_keep="true">&nbsp;</P>
<P mce_keep="true"><FONT color=#ff00ff><EM>This post brought to you by</EM> <STRONG><FONT size=6>Î©</FONT></STRONG> <EM>(<A class="" href="http://www.fileformat.info/info/unicode/char/03a9" mce_href="http://www.fileformat.info/info/unicode/char/03a9">U+03a9</A>, a.k.a. GREEK CAPITAL LETTER OMEGA)</EM></FONT></P></FONT>
<hr/><p><a id="817184" href="#817184">#</a> <strong>Raymond Chen - MSFT</strong> on 11 Oct 2006 1:12 PM:</p><div style="margin-left: 1em"><p>The C language also makes it difficult, since streams support only one character of pushback. Since a UTF-8-encoded character can require three characters of pushback, where do you put the other two?</p>
</div>
<p><a id="817255" href="#817255">#</a> <strong>Ben Bryant</strong> on 11 Oct 2006 2:17 PM:</p><div style="margin-left: 1em"><p>A quick way of saying it is that Windows 'A' supports single and double byte code pages, and not any other kind of &quot;multi-byte&quot; encoding. Another problem is all of the documentation that refers to 'W' APIs as &quot;Unicode&quot; and 'A' as &quot;non-Unicode&quot;. To support Unicode in 'A' APIs would turn a great deal of Win32 documentation on its head.</p></div>
<p><a id="817475" href="#817475">#</a> <strong>Michael S. Kaplan</strong> on 11 Oct 2006 4:06 PM:</p><div style="margin-left: 1em"><p>Nobody ever seems to read the documentation, so we are probably safe on that part. :-)</p>
</div>
<p><a id="817578" href="#817578">#</a> <strong>Ben Bryant</strong> on 11 Oct 2006 4:55 PM:</p><div style="margin-left: 1em"><p>:)</p></div>
<p><a id="817841" href="#817841">#</a> <strong>Leo Kislov</strong> on 11 Oct 2006 7:07 PM:</p><div style="margin-left: 1em"><p>Any hint when DOS console will be phased out? PowerShell seems like a good opportunity to do it. &nbsp;Push DOS console into Accesories/System tools/ and introduce a new unicode console in Vista+1. Kill DOS console after 3 major releases after Vista. </p></div>
<p><a id="817897" href="#817897">#</a> <strong>Dean Harding</strong> on 11 Oct 2006 7:43 PM:</p><div style="margin-left: 1em"><p>I don't think you could ever KILL cmd.exe, but I wouldn't be adverse to relegating it to a more hidden place.</p>
<p>Actually, I was a bit dissapointed to see that PowerShell used the same host as cmd.exe. I hate the fact that you can't resize the window by just dragging the corners. It's so old-skool! Lets hope it's improved in version 2 :)</p>
</div>
<p><a id="817958" href="#817958">#</a> <strong>Leo Kislov</strong> on 11 Oct 2006 8:39 PM:</p><div style="margin-left: 1em"><p>Dean, I believe if there is a will there is a way to kill cmd.exe. Make PowerShell a parallel universe: separate resizable unicode window *without* ability to call old command line programs. You don't really believe we're stuck with cmd.exe for the next 10,000 years, do you? So the question is actually how long will it take. My suggestion to keep cmd.exe in a closet for 3 major releases is probably too aggressive, ok, let's make it 6 releases.</p></div>
<p><a id="818103" href="#818103">#</a> <strong>Dean Harding</strong> on 11 Oct 2006 10:32 PM:</p><div style="margin-left: 1em"><p>&gt; You don't really believe we're stuck with cmd.exe for the next 10,000 years, do you?</p>
<p>Actually, yes I do. Assuming we're still using Windows in 10,000 years, anyway. As long as companies rely on batch scripts that were written for Windows NT 3.5 (and there's plenty of them, just ask Raymond Chen), then cmd.exe will have to hang around.</p>
<p>Think about it. If Windows 2015 removed cmd.exe, and you've got 1,500 lines of batch script that your organization DEPENDS on, what are you going to do? Spend 3 months re-writing it in PowerShell, testing, debugging and finally deploying it on your 900 desktops. Or are you just going to stick with Windows 2012, which ran them just fine? It's hard enough convincing companies to upgrade as it is...</p>
</div>
<p><a id="828545" href="#828545">#</a> <strong>Bart van der Werf</strong> on 15 Oct 2006 11:49 AM:</p><div style="margin-left: 1em"><p>Thanks for the response :)</p>
<p>Too bad the response with these kinds of issues allways seems to come down to problems with compatibility with sloppy implementations. </p>
<p>Porting these applications to utf16 is not really possible because of 3rd party components that either have no utf16 support, assume ucs2 or are discontinued.</p></div>
<p><a id="828625" href="#828625">#</a> <strong>Michael S. Kaplan</strong> on 15 Oct 2006 12:43 PM:</p><div style="margin-left: 1em"><p>Well, of course that was not the only reason I gave -- the 18 buttloads of work that could easily go into the billions is not to be sneered at, either? :-)</p>
</div>
<p><a id="8886713" href="#8886713">#</a> <strong>Yuhong Bao</strong> on 21 Aug 2008 10:35 PM:</p><div style="margin-left: 1em"><p>&quot;Actually, I was a bit dissapointed to see that PowerShell used the same host as cmd.exe.&quot;</p>
<p>Which actually IS Unicode capable, but you have to use a TrueType font. And it is in csrss.exe, not cmd.exe.</p></div>
<p><a id="8887053" href="#8887053">#</a> <strong>Michael S. Kaplan</strong> on 22 Aug 2008 2:56 AM:</p><div style="margin-left: 1em"><p>Well, sort of. Managed code in the CMD-hosted console has many non-Unicode limitations that have little to do with font selection....</p>
</div>
<p><strong>Yuhong Bao</strong> on 5 Mar 2010 8:54 PM:</p><div style="margin-left: 1em"><p>&quot;Managed code in the CMD-hosted console&quot;</p>
<p>Which is not actually CMD-hosted, but CSRSS-hosted, or CONHOST-hosted in Win7 and later.</p>
</div>
<p><strong>Michael S. Kaplan</strong> on 5 Mar 2010 9:06 PM:</p><div style="margin-left: 1em"><P>Not a relevant detail in this case, though entirely accurate. You sound a little like a Microsoft employee. :-)</P></div>
<p><strong>Yuhong Bao</strong> on 5 Mar 2010 9:19 PM:</p><div style="margin-left: 1em"><p>Reminds me of this article:</p>
<p><a rel="nofollow" target="_new" href="http://archives.miloush.net/michkap/archive/2007/05/11/2547703.html">http://blogs.msdn.com/michkap/archive/2007/05/11/2547703.aspx</a></p>
</div>
<hr/><p><em>referenced by</em></p><div style="margin-left: 1em"><p>2008/08/15 <a href="http://archives.miloush.net/michkap/archive/2008/08/15/8869343.html">Yet another time that UTF-8 can't be the ACP</a></p><p>2007/02/23 <a href="http://archives.miloush.net/michkap/archive/2007/02/23/1748028.html">The MSL8 project? Cool!</a></p></div><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2006/10/11/817290.html" title="You got your latins in my hebrew! No, you got your hebrew in my latins!">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2006/10/10/813347.html" title="The fonts directory is freaking huge in Vista">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2006-10">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2006-10-11">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2006/10/11/816996.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:39 GMT -->
</html>