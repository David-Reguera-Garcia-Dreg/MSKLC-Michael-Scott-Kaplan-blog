<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2006/08/30/726087.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:39 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>The advanced feature in MSKLC doesn't really scan</title></head><body>
<h1>The advanced feature in MSKLC doesn't really scan</h1>
<p><em>by Michael S. Kaplan, published on 2006/08/30 05:01 -04:00, original URI: http://blogs.msdn.com/b/michkap/archive/2006/08/30/726087.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostNew -->
<FONT face=Tahoma>
<P>Earier this month, Emerson asked me via the 'Contacting Michael' link: </P>
<BLOCKQUOTE dir=ltr style="MARGIN-RIGHT: 0px">
<P><FONT face="Times New Roman" size=2>Hello,<BR><BR>My name is Emerson, I'm from Brazil and I am kind of desperate. I have a question concerning the Microsoft Keyboard Layout Creator and I would like to know if you can help me on that. <BR><BR>Does the MSKLC really allow the changing of scan codes? The help says it's possible, but I just can't do it. The virtual keys with changed scan codes end up with two scan codes: the original one and the one I assigned by me. It would not be a problem if I could "build DLL and setup package" even that way, but when I try to do that, I get the following:<BR><BR>1) A message box appears. It says: "There was a problem building the keyboard file. Would you like to see warning/error information?". I click "Yes".<BR><BR>2) A message box titled "Standard output information" says: "Error 2020 (..\.\tmpLayout01.txt, line 74): VK_OEM_2 (bf) found at scancode 73 and 35." I click OK.<BR><BR>That's it. Obviously some paramaters from the second message box may vary according to the keys I try to change the scan code. By the way, to change the scan code I right-click on the key I want, click on "Properties for VK_ in all shift states", click on the check box for "Advanced View", change the scan code for whatever I want and finally click OK.<BR><BR>The layout may work with no problems on that text box and it also may be validated with no errors (only warnings) -- it does not matter, it seems impossible to build the DLL and setup package.<BR><BR>Am I doing something wrong? What would you recommend me to do?<BR><BR>Oh, by the way, I'm using a Japanese laptop (that's why I want to change some scan codes -- basically adding scan code 73 over some other not used by my keyboard) with Windows XP Service Pack 2 (Brazilian, slipstreamed).<BR><BR>Actually the only problem I have with this laptop is that I can't type diacritics properly, because the Japanese layout has no dead keys. Since MSKLC does not handle the Japanese layout properly, I found that the best way to get the keyboard working the way I want would be changing some scan codes and adding the dead keys with MSKLC. Also it would be useful if I could change the virtual key name, so the old scan code could keep with the original virtual key, and I would put a new scan code for a new virtual key. <BR><BR>Sorry for the big message, hope you can help me. Keep the good work up.<BR><BR>Thanks in advance.<BR><BR>Regards,<BR><BR>Emerson</FONT></P></BLOCKQUOTE>
<P>Ok, I think we're going to have one of those awkward moments now. :-)</P>
<P>The dialog Emerson is referring to is this one:</P>
<P><IMG height=517 src="http://trigeminal.fmsinc.com/images/advancedklc.png" width=582></P>
<P>(I am using the Greek polytonic keyboard in the examples here, by the way!)</P>
<P>With the Advanced view on, the Scan Code is available to be set, in this case it is 0x1b (or as it is shown in the dialog, 1b).</P>
<P>Now if you take a keyboard, save it out as a .KLC file, and then open that .KLC file in Notepad, you will see (among other things) a table that looks something like this, with one row per key:</P>
<BLOCKQUOTE dir=ltr style="MARGIN-RIGHT: 0px">
<P><FONT face="Consolas,Courier New"><STRONG>//SC&nbsp;VK_&nbsp;&nbsp;&nbsp;Cap&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;&nbsp; 1&nbsp;&nbsp;&nbsp;&nbsp; 2&nbsp;&nbsp;&nbsp;&nbsp;6&nbsp;&nbsp;&nbsp;&nbsp; 7<BR>//--&nbsp;----&nbsp;&nbsp;----&nbsp;----&nbsp; ----&nbsp; ----&nbsp;----&nbsp; ----<BR>19&nbsp;&nbsp; P&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1&nbsp;&nbsp; 03c0&nbsp; 03a0&nbsp; -1&nbsp;&nbsp; -1&nbsp;&nbsp;&nbsp; -1<BR>1a&nbsp;&nbsp; OEM_4&nbsp;&nbsp;0&nbsp;&nbsp; 005b@&nbsp;007b@&nbsp;-1&nbsp;&nbsp; 00ab@&nbsp;-1<BR>1b&nbsp;&nbsp; OEM_6&nbsp;&nbsp;0&nbsp;&nbsp; 005d@&nbsp;007d@&nbsp;-1&nbsp;&nbsp; 00bb@&nbsp;0387</STRONG></FONT></P></BLOCKQUOTE>
<P>and so on.</P>
<P>Note how the first column is the scan code, and the second column is the virtual key. Essentially this mapping is built entirely from scratch by MSKLC, based on some keyboard layout. </P>
<P>When we discussed the user interface, initially we wanted to just hide the whole thing, as every method we tried to work out to let people adjust the VK values just got us in trouble with usability. We finally ended up putting in this obscure method to switch scan codes around a bit, which is mostly useless. Since it is up to the hardware keyboard layout where the actual scan codes sit (the keys are the ones that emit the scan codes), being able to switch them would just make people feel better if they wanted to feel like they were moving stuff around.</P>
<P>Which I knew was kind of dumb even back then, but only realized how dumb when I was playing with the feature as research when writing this article.&nbsp;MSKLC sharply limits stuff like putting in both new scan codes and higher valued scan codes&nbsp;(which is what Emerson is trying to do).</P>
<P>Given that it is useless in its current form and that MSKLC blocks most of what would be legitimately useful (but which never occurred to anybody to ask for while it was being developed and tested), I think it would be a good idea to just treat the whole scan code "feature" in MSKLC as being completely broken and get a bug in to try and fix this in&nbsp;a future&nbsp;version....</P>
<P>In the meantime, the only real workaround would be to do some of&nbsp;the work&nbsp;manually. Not for the faint of heart, but I think I can put together an example as an upcoming advanced blog post over the weekend? :-)</P>
<P>&nbsp;</P>
<P><FONT color=#ff1493><EM>This post brought to you by</EM>&nbsp;<STRONG><FONT size=6>ã‚»</FONT></STRONG> <EM>(<A href="http://www.fileformat.info/info/unicode/char/30bb">U+30bb</A>, a.k.a. KATAKANA LETTER SE)</EM></FONT></P></FONT>
<hr/><p><strong>Emerson</strong> on 2 Sep 2006 4:12 PM:</p><div style="margin-left: 1em">Hello, Michael. Thanks for answering my question!<br>I would not mind working on this issue manually. Actually, I would love doing that.<br>Does it have anything to do with opening the KLC file on notepad?<br>Well, I'll wait for the post with the solution. Thanks again.</div>
<p><strong>Arno</strong> on 14 Jul 2011 1:43 AM:</p><div style="margin-left: 1em"><p>Dear Michael,</p>
<p>I do not understand what &quot;Error 2020 (..\.\tmpLayout01.txt, line 74): VK_OEM_2 (bf) found at scancode 73 and 35.&quot;</p>
<p>really means. or in my case &quot;... Line 70 VK_OEM_5 (dc) found at scancode 29 and 2b&quot;.</p>
<p>I opened the .klc-file in an editor and see OEM_5 only at 29. I left 2b empty in order to avoid trouble.</p>
<p>Background: I want to make a ethiopic keyboard -- of course with looots of dead keys. Looks nice in MSKLC, but</p>
<p>am stuck with this error message, which too me still is incomprehensible.</p>
<p>I have nothing against tweaking manually, but how?</p>
<p>Thanks </p>
</div>
<hr/><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2006/08/30/731033.html" title="If you wanted to get it done with the font...">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2006/08/29/729504.html" title="No, Virginia, Technical Aides do not report to Technical Leads">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2006-08">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2006-08-30">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2006/08/30/726087.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:39 GMT -->
</html>