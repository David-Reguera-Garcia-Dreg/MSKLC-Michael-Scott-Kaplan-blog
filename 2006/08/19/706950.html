<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2006/08/19/706950.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:39 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>What the hell is up with Timor-Leste?</title></head><body>
<h1>What the hell is up with Timor-Leste?</h1>
<p><em>by Michael S. Kaplan, published on 2006/08/19 03:01 -04:00, original URI: http://blogs.msdn.com/b/michkap/archive/2006/08/19/706950.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostNew -->
<FONT face=Tahoma>
<P>Regular reader <A href="http://musingmarc.blogspot.com/">Mark Brooks</A> asked in the Suggestion Box: </P>
<BLOCKQUOTE dir=ltr style="MARGIN-RIGHT: 0px">
<P><FONT face="Times New Roman" size=2>What's up with Timor-Leste? <BR><BR>How did it get such an outlier GEOID here: <A href="http://msdn.microsoft.com/library/en-us/intl/nls_locations.asp">http://msdn.microsoft.com/library/en-us/intl/nls_locations.asp</A> </FONT></P></BLOCKQUOTE>
<P>Yes Mark, it is hard to look at the items in the <A href="http://msdn.microsoft.com/library/en-us/intl/nls_locations.asp">Table of Geographic Locations</A> and understand really any of the random assignments, let alone the one strange one at the end for Timor-Leste (0x6F60E7). How on earth could that not be a typo on the page or a mistake of some sort? :-)</P>
<P>But as I first mentioned back in the post GEOID -- <STRONG><A href="http://archives.miloush.net/michkap/archive/2005/02/04/366922.html">The LCIDs maligned little brother....</A></STRONG>, the actual values come from a huge database that is used by MapPoint -- and you will see many similarities to the <A href="http://msdn.microsoft.com/library/en-us/MapPoint2006/BIZOMVGeoCountry.asp">GeoCountry values</A>. The actual database has many more entries than either table gives, and really allows projects that are mapping every country and region to be covered. </P>
<P>How else to support the <A href="http://msdn.microsoft.com/library/en-us/dnanchor/html/anch_MapPointLoc.asp">MapPoint Location Server</A> and <A href="http://msdn.microsoft.com/library/en-us/dnanchor/html/anch_MapPointWS.asp">MapPoint Web Service</A>? :-)</P>
<P>Anyway, we don't assign the IDs, we just consume them. We want to add an item to the list, so we ask them what the value is, and they tell us. Once in a while, we ask for something that had no ID, and they assign one (via their own process) and tell us what it is. </P>
<P>It just so happens in this case that Timor-Leste has a large number for its value, that's all.</P>
<P>Not that it did not cause a bit of a fuss at the time. You see, we store a lot of the localized string values in kernel32.dll (technically its satellite kernel32.dll.mui files), and as you may know of <A href="http://msdn.microsoft.com/library/en-us/tools/tools/stringtable_resource.asp">STRINGTABLE Resources</A>, the actual string ID is limited to 16 bits.</P>
<P>In fact, you can think of it as another reason that the <A href="http://search.msdn.microsoft.com/search/Redirect.aspx?title=LoadString+Function&amp;url=http://msdn.microsoft.com/library/en-us/winui/winui/windowsuserinterface/resources/strings/stringreference/stringfunctions/loadstring.asp">LoadString function</A> is evil -- ID values are UINTs, yet the actual size limit is USHORTs, and the value you pass is truncated, so that if you load up 0x6F60E7 you actually get the string at&nbsp;0x60E7. </P>
<P>But you don't have to be too horrified at a massive&nbsp;bug here -- the resource compiler actually does the same type of truncation so you will find what you need. </P>
<P>Lucky for us, we don't have something with an ID value of 0x60E7 assigned to it that we support with the GEOID functions, or we'd have to change our whole resource loading mechanism!</P>
<P>Though to be honest, I figure it is only a matter of time. Every new version of Windows adds new entries, so one day we'll hit a conflict. Maybe this blog post can help remind people on the team that we need to get the ID values early, just in case.... :-)</P>
<P>&nbsp;</P>
<P><FONT color=#ff1493><EM>This post brought to you by</EM> <FONT size=6><STRONG>·å°</STRONG></FONT> <EM>(<A href="http://www.fileformat.info/info/unicode/char/1321">U+1321</A>, a.k.a. ETHIOPIC SYLLABLE THU)</EM></FONT></P></FONT>
<hr/><p><strong>Andrew Cook</strong> on 12 Dec 2007 11:18 AM:</p><div style="margin-left: 1em"><p>The link to LoadString is b0rken; apparently MSDN changed how their search page works while you weren't looking and the link isn't direct but goes through that search page.</p>
<p>Direct link to MSDN2 article: <a rel="nofollow" target="_new" href="http://msdn2.microsoft.com/en-us/library/ms647486.aspx">http://msdn2.microsoft.com/en-us/library/ms647486.aspx</a></p></div>
<p><strong>Michael S. Kaplan</strong> on 12 Dec 2007 11:47 AM:</p><div style="margin-left: 1em"><p>The problem is that I have hundreds of links like that, and fixing them every time MSDN changes again is not a road I want to go down.... :-(</p>
</div>
<hr/><p><em>referenced by</em></p><div style="margin-left: 1em"><p>2008/03/22 <a href="http://archives.miloush.net/michkap/archive/2008/03/22/8330506.html">GetGeoInfo is a mostly useless bloody waste of a function that only a "B" Ark Golgafrincham could love</a></p><p>2007/07/13 <a href="http://archives.miloush.net/michkap/archive/2007/07/13/3837355.html">What the hell is up with Timor-Leste? [Microsoft edition]</a></p></div><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2006/08/19/707013.html" title="Extending the MS Transliteration Utility">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2006/08/18/706383.html" title="Sometimes, uppercasing sucks">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2006-08">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2006-08-19">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2006/08/19/706950.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:39 GMT -->
</html>