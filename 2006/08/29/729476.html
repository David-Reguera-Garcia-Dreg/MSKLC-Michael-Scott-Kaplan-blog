<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2006/08/29/729476.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:39 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>When you think it couldn't get any harder, it gets easier</title></head><body>
<h1>When you think it couldn't get any harder, it gets easier</h1>
<p><em>by Michael S. Kaplan, published on 2006/08/29 04:01 -04:00, original URI: http://blogs.msdn.com/b/michkap/archive/2006/08/29/729476.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostNew -->
<font face="Tahoma">
<p>From the prophet Douglas Adams: </p>
<blockquote dir="ltr" style="MARGIN-RIGHT:0px"><font face="Times New Roman" size="2">
<p>Click, hum.<br><br>The huge grey Grebulon reconnaissance ship moved silently through the black void. It was travelling at fabulous, breath-taking speed, yet appeared, against the glimmering background of a billion distant stars to be moving not at all. It was just one dark speck frozen against an infinite granularity of brilliant night.<br><br>On board the ship, everything was as it had been for millennia, deeply dark and silent.<br><br>Click, hum.<br><br>At least, almost everything.<br><br>Click, click, hum.<br><br>Click, hum, click, hum, click, hum.<br><br>Click, click, click, click, click, hum.<br><br>Hmmm.<br><br>A low level supervising program woke up a slightly higher level supervising program deep in the ship's semi-somnolent cyberbrain and reported to it that whenever it went click all it got was a hum.<br><br>The higher level supervising program asked it what it was supposed to get, and the low level supervising program said that it couldn't remember exactly, but thought it was probably more of a sort of distant satisfied sigh, wasn't it? It didn't know what this hum was. Click, hum, click, hum. That was all it was getting.<br><br>The higher level supervising program considered this and didn't like it. It asked the low level supervising program what exactly it was supervising and the low level supervising program said it couldn't remember that either, just that it was something that was meant to go click, sigh every ten years or so, which usually happened without fail. It had tried to consult its error look-up table but couldn't find it, which was why it had alerted the higher level supervising program to the problem .<br><br>The higher level supervising program went to consult one of its own look-up tables to find out what the low level supervising<br>program was meant to be supervising.<br><br>It couldn't find the look-up table .<br><br>Odd.<br><br>It looked again. All it got was an error message. It tried to look up the error message in its error message look-up table and couldn't find that either. It allowed a couple of nanoseconds to go by while it went through all this again. Then it woke up its sector function supervisor.<br><br>The sector function supervisor hit immediate problems. It called its supervising agent which hit problems too. Within a few<br>millionths of a second virtual circuits that had lain dormant, some for years, some for centuries, were flaring into life throughout the ship. Something, somewhere, had gone terribly wrong, but none of the supervising programs could tell what it was. At every level, vital instructions were missing, and the instructions about what to do in the event of discovering that vital instructions were missing, were also missing.<br><br>Small modules of software - agents - surged through the logical pathways, grouping, consulting, re-grouping. They quickly<br>established that the ship's memory, all the way back to its central mission module, was in tatters. No amount of interrogation could determine what it was that had happened. Even the central mission module itself seemed to be damaged.<br><br>This made the whole problem very simple to deal with. Replace the central mission module. There was another one, a backup, an exact duplicate of the original. It had to be physically replaced because, for safety reasons, there was no link whatsoever between the original and its backup. Once the central mission module was replaced it could itself supervise the reconstruction of the rest of the system in every detail, and all would be well.<br><br>Robots were instructed to bring the backup central mission module from the shielded strong room, where they guarded it, to the ship&#39;s logic chamber for installation. <br><br>This involved the lengthy exchange of emergency codes and protocols as the robots interrogated the agents as to the authenticity of the instructions. At last the robots were satisfied that all procedures were correct. They unpacked the backup central mission module from its storage housing, carried it out of the storage chamber, fell out of the ship and went spinning off into the void.<br><br>This provided the first major clue as to what it was that was wrong.<br><br>Further investigation quickly established what it was that had happened. A meteorite had knocked a large hole in the ship. The ship had not previously detected this because the meteorite had neatly knocked out that part of the ship's processing equipment which was supposed to detect if the ship had been hit by a meteorite.<br><br>The first thing to do was to try to seal up the hole. This turned out to be impossible, because the ship's sensors couldn't see that there was a hole, and the supervisors which should have said that the sensors weren't working properly weren't working properly and kept saying that the sensors were fine. The ship could only deduce the existence of the hole from the fact that the robots had clearly fallen out of it, taking its spare brain, which would have enabled it to see the hole, with them.</p></font></blockquote>
<p>You may be wondering why I shared this 'Mostly Harnless' excerpt. I'll try and see if I can point out the relevance of dealing with a problem where the information you need is not directly available, and you can only find what you need through inference....</p>
<p>Remember back in March when I posted <strong><a href="http://archives.miloush.net/michkap/archive/2006/04/12/575080.html">Getting all you can out of a keyboard layout, Part #9a</a></strong>?</p>
<p>In part of that post I talked about the fact that <a href="http://msdn.microsoft.com/library/en-us/winui/winui/windowsuserinterface/userinput/keyboardinput/keyboardinputreference/keyboardinputfunctions/mapvirtualkeyex.asp">MapVirtuaKey[Ex]</a> did not distinguish keys such as the left and right CONTROL keys, or the left and right ALT keys, since their scan codes differed only by an extended bit and <a href="http://msdn.microsoft.com/library/en-us/winui/winui/windowsuserinterface/userinput/keyboardinput/keyboardinputreference/keyboardinputfunctions/mapvirtualkeyex.asp">MapVirtuaKey[Ex]</a> strips out the extra bits.</p>
<p>And without explicitly mentioning how lame it was, I talked about how to work around this problem.... using indirect methods.</p>
<p>Now you might think that this blog represents such a powerful force at Microsoft that the mere suggestion of such a limitation inspired action at the highest levels and that the developer who owns the code was asked to immediately address the issue.</p>
<p>Of course, you'd be mistaken. Utterly mistaken.</p>
<p>Luckily, there was another Windows component that had the same requirement, and there was a developer who was slightly less warped than me who did not realize there was that odd, indirect way to get at the info.</p>
<p>And that request led to new functionality of <a href="http://msdn.microsoft.com/library/en-us/winui/winui/windowsuserinterface/userinput/keyboardinput/keyboardinputreference/keyboardinputfunctions/mapvirtualkeyex.asp">MapVirtuaKey[Ex]</a> -- an extension to two of the existing flags, a whole new flag, and constants to cover the flag values so you don&#39;t have to pass a bunch of numbers.</p>
<p>The update info that will make its way into the Platform SDK eventually (after a scrub by the doc. writer of course!):</p>
<blockquote dir="ltr" style="MARGIN-RIGHT:0px"><font face="Consolas,Courier New"><b>
<p>0      MAPVK_VK_TO_VSC<br><font size="2">uCode is a virtual-key code and is translated into a scan code. If it is a virtual-key code that does not distinguish between left- and right-hand keys, the left-hand scan code is returned. If there is no translation, the function returns 0. </font></p>
<p>1      MAPVK_VSC_TO_VK<br><font size="2">uCode is a scan code and is translated into a virtual-key code that does not distinguish between left- and right-hand keys. If there is no translation, the function returns 0. <br><font color="#ff0000">Windows Vista</font>: the high byte of uCode can contain 0xe0 or 0xe1 extended scan code prefix to specify the extended scan code.</font></p>
<p>2      MAPVK_VK_TO_CHAR<br><font size="2">uCode is a virtual-key code and is translated into an unshifted character value in the low order word of the return value. Dead keys (diacritics) are indicated by setting the top bit of the return value. If there is no translation, the function returns 0. </font></p>
<p>3      MAPVK_VSC_TO_VK_EX<br><font size="2">Windows NT/2000/XP: uCode is a scan code and is translated into a virtual-key code that distinguishes between left- and right-hand keys. If there is no translation, the function returns 0.<br><font color="#ff0000">Windows Vista</font>: the high byte of uCode can contain 0xe0 or 0xe1 extended scan code prefix to specify the extended scan code.</font></p>
<p>4      MAPVK_VK_TO_VSC_EX<br><font color="#000000" size="2"><font color="#ff0000">Windows Vista</font>: uCode is a virtual key code and is translated into a scan code. If it is a virtual-key code that does not distinguish between left- and right-hand keys, the left-hand scan code is returned. If there is not translation, the function returns 0. If the scan code is an extended scan code, the high byte is the extend prefix (either 0xe0 or 0xe1). </font></p></b></font></blockquote>
<p>Now if I were a lesser person I might have started a rumor about the VP who read my blog and intervened to get the feature in, but honestly I am just so happy that it is there that I see no need to make up any stories about it. :-)</p>
<p>It does mean that I might need to do a new part to that series to cover the things that are now easier to do in Vista, of course. But I can&#39;t remember the last time I was afraid to do a blog post....</p>
<p> </p>
<p><font color="#ff1493"><em>This post brought to you by</em> <strong><font face="Estrangelo Edessa" size="8">ܞ</font></strong> <em>(<a href="http://www.fileformat.info/info/unicode/char/071e">U+071e</a>, a.k.a. SYRIAC LETTER YUDH HE)</em></font></p></font>
<hr/><p><a id="730508" href="#730508">#</a> <strong>RubenP</strong> on 29 Aug 2006 3:51 PM:</p><div style="margin-left: 1em">Just love Douglas Adams. A prophet indeed :-)</div>
<hr/><p><em>referenced by</em></p><div style="margin-left: 1em"><p>2008/02/02 <a href="http://archives.miloush.net/michkap/archive/2008/02/02/7385461.html">[Confusing functionality] + [New features] = [Documentation that can be confusing]</a></p><p>2007/01/04 <a href="http://archives.miloush.net/michkap/archive/2007/01/04/1409380.html">Converting a project to Unicode: Part 8 (Fitting MSLU into the mix)</a></p><p>2006/09/14 <a href="http://archives.miloush.net/michkap/archive/2006/09/14/754162.html">Why doesn't MSKLC have a numeric keypad?</a></p></div><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2006/08/29/729504.html" title="No, Virginia, Technical Aides do not report to Technical Leads">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2006/08/28/728868.html" title="There should always be a fallback available">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2006-08">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2006-08-29">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2006/08/29/729476.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:39 GMT -->
</html>