<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2006/12/22/1350684.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:38 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>Sometimes when sorting the index is the last thing you want to use</title></head><body>
<h1>Sometimes when sorting the index is the last thing you want to use</h1>
<p><em>by Michael S. Kaplan, published on 2006/12/22 22:15 -05:00, original URI: http://blogs.msdn.com/b/michkap/archive/2006/12/22/1350684.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostNew -->
<P>The other day, in response to my post <STRONG><A class="" href="http://archives.miloush.net/michkap/archive/2006/12/18/1314233.html" mce_href="http://archives.miloush.net/michkap/archive/2006/12/18/1314233.html">Don't get into the zone too soon....</A></STRONG>, reader <A class="" href="http://weblogs.asp.net/kdente/" mce_href="http://weblogs.asp.net/kdente/">Kevin Dente</A> asked in a <A class="" href="http://archives.miloush.net/michkap/archive/2006/12/18/1314233.html#1318931" mce_href="http://archives.miloush.net/michkap/archive/2006/12/18/1314233.html#1318931">comment</A>:</P>
<BLOCKQUOTE>
<P><EM><FONT face="times new roman,times">&gt;not that people were scared off by the lack of documentation<BR>&gt;here in the past!<BR><BR>Hmm, yes, it turns out one of our products falls into that category. We have code that reads the time zones from the registry, which breaks on Vista because the "Index" registry entry associated with each time zone no longer exists in Vista. Why the omission? Is there something about the new time zone model that makes the notion of a time zone index invalid?</FONT></EM></P></BLOCKQUOTE>
<P>Just before I had the chance to ask him, Software Design Engineer Robert Doyle answered the question just as someone else asked him about the very same thing. Robert (one of the awesome GIFT Ireland developers who helped provide the <STRONG><A class="" href="http://archives.miloush.net/michkap/archive/2005/12/21/506427.html" mce_href="http://archives.miloush.net/michkap/archive/2005/12/21/506427.html">Vista updates to clock and calendar</A></STRONG>) answered the question thusly (right after&nbsp;another dev suggested "I guess that’s what you get for relying on undocumented information in the registry" and someone wanted to know how to sort the entries since they were relying on the index for the sort:</P>
<BLOCKQUOTE>
<P><FONT face="times new roman,times"><EM>The control panel in Vista sorts the time zones by Bias (descending) - and where biases are equal by Display Name (ascending) in the user’s local language.<BR><BR>@tzres.dll,-571 refers to a multilingual string resource. The MUI_... values were added in Vista to allow time zone names to be presented in the correct UI language.<BR></EM></FONT><A href="http://msdn2.microsoft.com/en-us/library/ms725481.aspx"><FONT face="times new roman,times"><EM>http://msdn2.microsoft.com/en-us/library/ms725481.aspx</EM></FONT></A><FONT face="times new roman,times"><EM> <BR><BR>If you are showing a list of time zones to the user please use these in conjunction with RegLoadMUIString().<BR></EM></FONT><A href="http://msdn2.microsoft.com/en-us/library/ms776232.aspx"><FONT face="times new roman,times"><EM>http://msdn2.microsoft.com/en-us/library/ms776232.aspx</EM></FONT></A></P></BLOCKQUOTE>
<P>Although I agree with Robert that the index was not a good way to sort the list ever and that using the values for almost anything was probably a bad idea (and that relying on undocumented stuff pretty much does leave one in a bind when the decision comes back to haunt them like this), they are hard to maintain in terms of something useful if one wanted to keep them in order and have the order mean something, since they were sequential&nbsp;yet time zones get added in the middle all the time.</P>
<P>Even so, I admit to being a bit dismayed that the indexes were taken out, though I&nbsp;believe the componentized nature of the new setup kind of&nbsp;led to&nbsp;the change and there is even a chance that I was&nbsp;a dev who did the initial checkin this way&nbsp;(the time zone setup stuff changed hands several times and I had it during an early point when everyone else was busy and Longhorn (as it was called then!) had only one time zone since "that's all we needed to boot" according to one developer....</P>
<P>I vaguely recall being dismayed at the time as well, though I can't remember now if I was dismayed for (a)&nbsp;being forced to do this myself by the architectural constraints or (b) noticing this change was made when I was reviewing it before I did my changes. When I look at it now&nbsp; they clearly redid it all anyway, so I think it would require the source code control logs and a psychic to divine exactly what happened.</P>
<P>Though this does underscore the importance of not relying on the undocumented. Another day I will tell a story about an application that was hit much harder by time zone issues even more interesting than the index one....</P>
<P mce_keep="true">&nbsp;</P>
<P><FONT color=#ff00ff><EM>This post brought to you by</EM>&nbsp;<FONT size=5>ᕾ</FONT> <EM>(<A class="" href="http://www.fileformat.info/info/unicode/char/157e" mce_href="http://www.fileformat.info/info/unicode/char/157e">U+157e</A>, a.k.a. CANADIAN SYLLABICS QAAI)</EM></FONT></P>
<hr/><p><strong>Kevin Dente</strong> on 3 Jan 2007 8:55 PM:</p><div style="margin-left: 1em"><p>Michael,</p>
<p>Thanks for addressing my question. Unfortunately, in XP and before this was an area where MS had left us high and dry - ALL timezone enumeration was undocumented, and there was no API. So it's not particularly surprising that picking through through the registry we ended up using some bit of information that wasn't intended to be used and wasn't maintained going forward - there's no way we could have known which parts would and wouldn't be documented eventually. </p>
<p>Some quick googling showed that we weren't the only ones in this boat - looking through those registry keys appears to be a pretty common thing to do. When people have a need, and there's no documented way of doing it, they will inevitably turn to the undocumented. </p></div>
<p><strong>Michael S. Kaplan</strong> on 3 Jan 2007 9:28 PM:</p><div style="margin-left: 1em"><P>I hear you Kevin, and for what it's worth I wish there had been a better answer for this sort of issue (just like I do for <STRONG><A class="" href="http://archives.miloush.net/michkap/archive/2006/09/16/755152.html">this other one</A></STRONG>). Though of course there is a risk in relying on the undocumented....</P></div>
<p><strong>Roger Willcocks</strong> on 27 Mar 2008 10:01 PM:</p><div style="margin-left: 1em"><p>So here's a question then:</p>
<p>How do you record what timezone something is for?</p>
<p>Not what offset, but what timezone?</p>
<p>Brazil and Montenegro have the same offset, but different start/end for DST for example.</p>
<p>Display, Dlt and Std are all presumably changeable.</p>
<p>The MUI values don't help, though you could maybe hack that.</p>
<p>TZI? &nbsp;Don't think so.</p>
<p>There isn't even a standard DLT/STD code to use for each time zone as far as I can tell.</p></div>
<p><strong>Michael S. Kaplan</strong> on 27 Mar 2008 10:16 PM:</p><div style="margin-left: 1em"><p>You might want to put this one over in the Suggestion Box -- for a very different post in the future....</p>
</div>
<hr/><p><em>referenced by</em></p><div style="margin-left: 1em"><p>2008/06/29 <a href="http://archives.miloush.net/michkap/archive/2008/06/29/8667900.html">Did someone break GetTimeZoneInformation in XP?</a></p><p>2007/10/31 <a href="http://archives.miloush.net/michkap/archive/2007/10/31/5790802.html">Making things better out from under people: the story of MUI</a></p><p>2007/01/09 <a href="http://archives.miloush.net/michkap/archive/2007/01/09/1438044.html">The Phantom [Time] Zone</a></p></div><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2006/12/23/1351269.html" title="Vista turns on everything">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2006/12/22/1349745.html" title="Thumb twiddling?">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2006-12">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2006-12-22">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2006/12/22/1350684.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:38 GMT -->
</html>