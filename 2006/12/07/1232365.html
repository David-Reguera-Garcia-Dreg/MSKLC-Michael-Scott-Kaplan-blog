<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2006/12/07/1232365.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:39 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>Zipping up Unicode file PATHs</title></head><body>
<h1>Zipping up Unicode file PATHs</h1>
<p><em>by Michael S. Kaplan, published on 2006/12/07 08:21 -05:00, original URI: http://blogs.msdn.com/b/michkap/archive/2006/12/07/1232365.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostNew -->
<P>Kecia asked: </P>
<BLOCKQUOTE><FONT face="Times New Roman,Times"><I>
<P>We understand there is a known issue with winzip where it doesn’t work if certain Unicode characters are in the extract path (since the path to the user’s temp directory contains the user name, this issue occurs when a user name contains the offending Unicode characters).</P>
<UL>
<LI>Has anyone shipped with this issue (vs. opting to use winrar or some other app)? </LI>
<LI>If you did ship with it, how bad was the issue out in the field (how many people see it, call PSS, etc). </LI>
<LI>Does anyone know a way to work around it?</LI></UL></I></FONT></BLOCKQUOTE>
<P>Now I have talked about the general issue with ZIP previously in <STRONG><A class="" href="http://archives.miloush.net/michkap/archive/2005/05/10/416181.html" mce_href="http://archives.miloush.net/michkap/archive/2005/05/10/416181.html">Zipping up Unicode file names</A></STRONG>. The specific issue Kecia brings up if you have&nbsp;a user name outside the default system code page is arguably much more worrisome.</P>
<P>As Mihai <A class="" href="http://archives.miloush.net/michkap/archive/2005/05/10/416181.html#416601" mce_href="http://archives.miloush.net/michkap/archive/2005/05/10/416181.html#416601">commented</A>, there is room for future expansion in the ZIP format, which is good. Although it seems like no one wants to bite the bullet and have the backcompat problems (more on this another day).</P>
<P>I do have some good news, which was reported by Rostislav in response to Kecia's post:</P>
<BLOCKQUOTE><FONT face="Times New Roman,Times"><I>
<P>&nbsp;"compressed folders" in XP have this limitation too. Due to the feedback, we've fixed a part of the problem in Vista - now you can extract to a multilingual path. Still you can't have files with multilingual names in the archive. <BR>-Ros</P></I></FONT></BLOCKQUOTE>
<P>Ok, so we are wimpy too about the backcompat thing. But note that this particular feature works around the problem that Kecia mentioned in relation to the off-CP_ACP user name (the change will work around any off-CP_ACP characters in the path, in fact!</P>
<P>Progress, I say. And I'll talk more about why/how in an upcoming post....</P>
<P mce_keep="true">&nbsp;</P>
<P><FONT color=#ff00ff><EM>This post brought to you by</EM> "Ž" </FONT><EM><FONT color=#ff00ff>(</FONT><A href="http://www.fileformat.info/info/unicode/char/017d/index.htm">U+017d</A><FONT color=#ff00ff>, a.k.a. LATIN CAPITAL LETTER Z WITH CARON)</FONT></EM></P>
<hr/><p><a id="1233192" href="#1233192">#</a> <strong>Mike Dimmick</strong> on 7 Dec 2006 11:08 AM:</p><div style="margin-left: 1em"><p>According to Appendix D of the current spec (<a rel="nofollow" target="_new" href="http://www.pkware.com/business_and_developers/developer/popups/appnote.txt">http://www.pkware.com/business_and_developers/developer/popups/appnote.txt</a>):</p>
<p>&quot;The ZIP format has historically supported only the original IBM PC character encoding set, commonly referred to as IBM Code Page 437. &nbsp;This limits storing file name characters to only those within the original MS-DOS range of values and does not properly support file names in other character encodings, or languages. To address this limitation, this specification will support the following change. </p>
<p>If general purpose bit 11 is unset, the file name and comment should conform to the original ZIP character encoding. &nbsp;If general purpose bit 11 is set, the filename and comment must support The Unicode Standard, Version 4.1.0 or greater using the character encoding form defined by the UTF-8 storage specification. &nbsp;The Unicode Standard is published by the The Unicode Consortium (www.unicode.org). &nbsp;UTF-8 encoded data stored within ZIP files is expected to not include a byte order mark (BOM).&quot;</p>
<p>Not a particularly clever decision, because older software not looking for GP bit 11 will write out a UTF-8 encoded filename as if it were CP437 or whatever the current codepage is, depending on whether it obeys the rule above.</p>
<p>It then produces some drivel about '&quot;modified-UTF-8&quot; (JAVA) or UTF-8-MAC'. Wikipedia mentions these non-conformant non-UTFs at <a rel="nofollow" target="_new" href="http://en.wikipedia.org/wiki/UTF-8#Java">http://en.wikipedia.org/wiki/UTF-8#Java</a> and <a rel="nofollow" target="_new" href="http://en.wikipedia.org/wiki/UTF-8#Mac_OS_X">http://en.wikipedia.org/wiki/UTF-8#Mac_OS_X</a>. Clearly these do need to be indicated in the ZIP file or certainly handled by the unzipping tool as I'd guess that Java is already generating ZIP files with these malformed file names. The Java errors are basically due to a strict UTF-16 to UTF-8 conversion without understanding surrogate pairs; the OS X issue leads to problems like the one you mentioned at <a rel="nofollow" target="_new" href="http://archives.miloush.net/michkap/archive/2006/07/19/670674.html">http://blogs.msdn.com/michkap/archive/2006/07/19/670674.aspx</a>. However, it appears it's more a problem with the OS X file APIs - that filenames are supplied to the file system in sort-of NFD - than with the files themselves. Conversion to NFC might be necessary if the Windows file APIs are performing ordinal comparison and if the common dialogs present the filename in NFC.</p>
</div>
<p><a id="1233800" href="#1233800">#</a> <strong>Mihai</strong> on 7 Dec 2006 1:42 PM:</p><div style="margin-left: 1em"><p>Half nice :-)</p>
<p>Now, if we would also get some Unicode in msi ...</p></div>
<p><a id="1233867" href="#1233867">#</a> <strong>Michael S. Kaplan</strong> on 7 Dec 2006 1:58 PM:</p><div style="margin-left: 1em"><P>I <A class="" href="http://archives.miloush.net/michkap/archive/2005/10/08/478479.html"><STRONG>agree</STRONG></A>. :-)</P></div>
<p><a id="1235152" href="#1235152">#</a> <strong>Dean Harding</strong> on 7 Dec 2006 5:34 PM:</p><div style="margin-left: 1em"><p>This particular bug has nothing to do with the ZIP file format, it's just a hangover from the fact that Winzip is a non-Unicode program. I'm not really sure why they keep issuing new versions of Winzip - there never seems to be any new features (or worth)...</p>
</div>
<p><a id="1236058" href="#1236058">#</a> <strong>Cristian Secară</strong> on 7 Dec 2006 8:51 PM:</p><div style="margin-left: 1em"><p>Don't know about .zip, but the .rar archive format is able to handle filenames with Unicode characters [different than the current Windows codepage]. I used it at the time I made several tests with the Romanian ș and ț characters inside filenames in XP and Vista.</p>
<p>An example is this <a rel="nofollow" target="_new" href="http://www.secarica.ro/misc/abcd.rar">http://www.secarica.ro/misc/abcd.rar</a> or this <a rel="nofollow" target="_new" href="http://www.secarica.ro/misc/abcd_no_caps.rar">http://www.secarica.ro/misc/abcd_no_caps.rar</a> . The first example is interesting if extracted on XP, because there are two file pairs with same filenames but different caps that can coexist in same directory.</p>
<p>Cristi</p></div>
<p><a id="1236181" href="#1236181">#</a> <strong>Rosyna</strong> on 7 Dec 2006 9:28 PM:</p><div style="margin-left: 1em"><p>Mike Dimmick, there's nothing invalid or non-conforming about the UTF-8 that OS X requires for file names. It's just that file names must be in the NFD variant and only the NFD variant. And it's a complete non-issue when dealing with file APIs. Namely since paths are horrible and not recommend and the APIs that don't take paths take UTF-16 file names (or file names in which the encoding of the bytes in the string is purely an implementation issue).</p>
</div>
<p><a id="1597455" href="#1597455">#</a> <strong>David Pritchard</strong> on 4 Feb 2007 8:45 AM:</p><div style="margin-left: 1em"><p>I absolutely agree that WinZip should fix this immediately. It's quite true that they keep releasing new versions without significant advances, whilst ignoring something as fundamental (to me) as Unicode support. It baffles me slightly that applications are still being released without this. Monoglot programmers are, in fact, generally pretty ignorant of the whole Unicode issue.</p>
<p>My particular problem is that a backup program I use (SecondCopy) uses the zip format to archive backed-up files. As a result, Unicode filenames either don't get copied, or end up &quot;lost&quot; inside the zip file with screwed-up names. This is obviously extremely dangerous in backup software. </p>
<p>I'm now looking for alternative backup software.</p>
<p>&quot;Don't use Unicode filenames&quot; is simply no longer acceptable.</p></div>
<hr/><p><em>referenced by</em></p><div style="margin-left: 1em"><p>2012/01/04 <a href="http://archives.miloush.net/michkap/archive/2012/01/04/10252916.html">If someone blathers on about how Windows supports Unicode, you can suggest they just ZIP it, if you like!</a></p><p>2008/05/13 <a href="http://archives.miloush.net/michkap/archive/2008/05/13/8498184.html">WinZip, the [long awaited] Unicode edition!!!</a></p></div><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2006/12/08/1241746.html" title="Access and RTL MessageBox ≈ Oil and Water">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2006/12/07/1232220.html" title="SQL and the CLR: Part 1 (the things we can make work well)">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2006-12">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2006-12-07">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2006/12/07/1232365.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:39 GMT -->
</html>