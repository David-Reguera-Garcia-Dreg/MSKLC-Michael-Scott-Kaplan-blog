<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2006/12/11/1262690.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:39 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>IsComplexEnoughForYou?</title></head><body>
<h1>IsComplexEnoughForYou?</h1>
<p><em>by Michael S. Kaplan, published on 2006/12/11 18:53 -05:00, original URI: http://blogs.msdn.com/b/michkap/archive/2006/12/11/1262690.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostNew -->
<P>There are a whole bunch of people both inside and outside of Microsoft who have gotten good use out of that <A class="" href="http://msdn2.microsoft.com/en-us/library/ms776293.aspx" mce_href="http://msdn2.microsoft.com/en-us/library/ms776293.aspx">GetDateFormat</A> Tarek put together that I mentioned before in <STRONG><A class="" href="http://archives.miloush.net/michkap/archive/2006/09/01/735817.html" mce_href="http://archives.miloush.net/michkap/archive/2006/09/01/735817.html">Cue the smarter version of GetDateFormat... ok, it's a wrap!</A></STRONG>.</P>
<P>The other day, one of those folks inside of Microsoft had a good question, though:</P>
<BLOCKQUOTE><I><FONT face="Times New Roman,Times">
<P>We have some dates shown in our UI dialogs, displayed variously via static text controls and RichEdit. To support the usual loc and bidi scenarios, we call GetDateFormat with the DATE_LTRREADING and DATE_RTLREADING flags so that it generates LRM and RLM directional marks for layout. (The actual flags used in any given instance are determined by a wrapper function that implements logic similar to what Michael Kaplan has talked about in his blogs at <A href="http://archives.miloush.net/michkap/archive/2006/09/01/735817.html">http://blogs.msdn.com/michkap/archive/2006/09/01/735817.aspx</A>). <BR><BR>The problem we’re encountering is that sometimes these characters are interpreted correctly as directional hints, whereas other times controls show them as visible characters. <BR><BR>For example, a clean XP SP2 English machine the static control will show where the extra characters are actually the LRM reading codes. After installing a MUI pack, the control correctly interpret the marks even if no additional languages are actually installed by the MUI-pack install and even if everything is still set to English (which technically makes the marks redundant).<BR><BR>I’m wondering if it is control or font functionality added by the MUI pack (and if so, what’s the best way to detect when the necessary support exists), or if perhaps the wrapper function for GetDateFormat is overly aggressive in passing the DATE_*READING flags to GetDateFormat? If it is the latter, what is the logic modification – not passing a reading flag unless the flag determined by the default locale is either different from flag implied by the date format locale\calendar or the locale is natively a bidi locale? I’m hoping one of the language gurus can point out where our mistake is, because I’m not really an expert in this area. <BR><BR>Thanks,<BR>Chris</P></FONT></I></BLOCKQUOTE>
<P>The confusion&nbsp;Chris is seeing is actually caused by the fact that the MUI pack actually installs complex script support (described further <STRONG><A class="" href="http://archives.miloush.net/michkap/archive/2004/12/11/279998.html" mce_href="http://archives.miloush.net/michkap/archive/2004/12/11/279998.html">here</A></STRONG>), which is really what decides whether U+200e and U+200f are going to be LEFT-TO-RIGHT MARK and RIGHT-TO-LEFT MARK or two funny square boxes that are not in the font.</P>
<P>(I was about to say that this is not the sort of thing that could be solved at the font level when I realized I would actually be full of crap if I made such a claim; this problem could probably be solved in the font by putting the characters in there and making them invisible&nbsp;by mapping them a space or something. Thank goodness I think before I post, these days!)</P>
<P>How about figuring out whether you have complex script support installed, so you know whether or not to pass the DATE_LTRREADING or DATE_RTLREADING flags?</P>
<P>Although one might intuitively expect a function to tell you whether or not complex scripts are enabled, there isn't one. The way to find out is to use the <A class="" href="http://msdn2.microsoft.com/en-us/library/ms776303.aspx" mce_href="http://msdn2.microsoft.com/en-us/library/ms776303.aspx">IsValidLocale</A> function with the LCID_INSTALLED flag on any locale that requires complex script support, such as:</P>
<BLOCKQUOTE>
<P><FONT face="Consolas,Lucida Console,courier new,courier"><STRONG>BOOL fComplexScripts = IsValidLocale(LANG_HEBREW, LCID_INSTALLED);</STRONG></FONT></P></BLOCKQUOTE>
<P>Now why this is actually makes an interesting historical side note, I think...</P>
<P>You see, in Windows 2000 the language support was chunked into language groups, as I first mentioned in <A class="" href="http://archives.miloush.net/michkap/archive/2005/02/16/374450.html" mce_href="http://archives.miloush.net/michkap/archive/2005/02/16/374450.html"><STRONG>Language groups -- the vestigial tail of NLS</STRONG></A>.</P>
<P>Now of those 17 groups, only some of them require complex script support to work properly, but if any one of the specific language groups was installed. it would be included along with the keyboards and fonts and such. And there is also an <A class="" href="http://msdn2.microsoft.com/en-us/library/ms776240.aspx" mce_href="http://msdn2.microsoft.com/en-us/library/ms776240.aspx">IsValidLanguageGroup</A> function that could be used for similar purposes, for just that reason.</P>
<P>But since functions like <A class="" href="http://msdn2.microsoft.com/en-us/library/ms776293.aspx" mce_href="http://msdn2.microsoft.com/en-us/library/ms776293.aspx">GetDateFormat</A>&nbsp;actually work based on locales, no one felt any pressing need to add a separate IsComplexScriptSupportOn function, especially since the notion of "complex script support" was not present as a concrete notion. Especially since you really needed to ask the question about support of the locale to make sure that the font and keyboard and such would also be there. So the <A class="" href="http://msdn2.microsoft.com/en-us/library/ms776303.aspx" mce_href="http://msdn2.microsoft.com/en-us/library/ms776303.aspx">IsValidLocale</A>&nbsp;call seemed like the best bet.</P>
<P>And then in XP all of the complex script language groups were added to the one checkbox for enabling complex script support. But no one seemed all that busy or eager to create a new function to support this UI notion in the updated <A class="" href="http://archives.miloush.net/michkap/archive/2004/12/11/279998.html" mce_href="http://archives.miloush.net/michkap/archive/2004/12/11/279998.html"><STRONG>Regional and Language Options</STRONG></A> since people would still have to use locales any time they wanted to do something with language, and just asking for any one you needed to support would do the trick. The fact that having one of them installed meant having all of them installed was just incidental.</P>
<P>Now of course in Vista this support is always present so the whole question is moot; it would be ridiculous to create a function that would always return TRUE. So there is even less reason for a new function.</P>
<P>But it is still a good question, in any case. And if one wants to avoid seeing NULL glyphs in one's date format strings then it is a very sensible check to be doing....</P>
<P mce_keep="true">&nbsp;</P>
<P><FONT color=#ff00ff><EM>This post brought to you by <A class="" href="http://www.fileformat.info/info/unicode/char/200e" mce_href="http://www.fileformat.info/info/unicode/char/200e">U+200e</A>, a.k.a. LEFT-TO-RIGHT MARK)</EM></FONT></P>
<hr/><div style="margin-left: 1em"><em>no comments</em></div><hr/><p><em>referenced by</em></p><div style="margin-left: 1em"><p>2011/08/31 <a href="http://archives.miloush.net/michkap/archive/2011/08/31/10203390.html">And then, the unrelated KB article fixes the problem...</a></p><p>2010/03/25 <a href="http://archives.miloush.net/michkap/archive/2010/03/25/9982164.html">Q: Why do the small black squares disappear? Hint: The answer isn't complicated, it's complex...</a></p><p>2008/12/02 <a href="http://archives.miloush.net/michkap/archive/2008/12/02/9163572.html">IsCrAndLfComplex or what?</a></p></div><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2006/12/12/1264508.html" title="Sorting numbers as text AND as digits">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2006/12/11/1259767.html" title="The Romanian keyboard layout on XP is the brokenest layout of all">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2006-12">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2006-12-11">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2006/12/11/1262690.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:39 GMT -->
</html>