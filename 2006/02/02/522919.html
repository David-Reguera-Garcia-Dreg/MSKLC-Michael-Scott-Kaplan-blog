<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2006/02/02/522919.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:40 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>What is equal to some may not be equal to others</title></head><body>
<h1>What is equal to some may not be equal to others</h1>
<p><em>by Michael S. Kaplan, published on 2006/02/02 03:01 -05:00, original URI: http://blogs.msdn.com/b/michkap/archive/2006/02/02/522919.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostNew -->
<p><font face=Tahoma>Someone going by the handle AC asked me via email:</font></p>
<blockquote dir=ltr style="MARGIN-RIGHT: 0px">
<p><font face="Times New Roman" size=2><em>You have mentioned that Google has trouble with equal strings not being treated equally. But you have never talked about similar problems with Office or other Microsoft applications. Do other problems not exist or are you not allowed to talk about that?</em></font></p></blockquote>
<p><font face=Tahoma>Hmmm. Well, it is true, I have talked about Google's problems with Unicode canonical equivalence in the past, but mainly in <a href="http://archives.miloush.net/michkap/archive/2005/11/15/492301.html">this post</a>, which also talks about similar problems in Microsoft's various web search technologies.</font></p>
<p><font face=Tahoma>I am really not in the "Google bashing" business, but I am also not a paid spokesperson for them, either. I am paid by Microsoft but not as an apologist so when something is wrong in an MS product, I have not been shy about talking about it....</font></p>
<p><font face=Tahoma>Now I have not covered as much in the Office world as in Windows mainly because I know more about the latter than the former (except for stuff in Microsoft Access, which I have posted about before).</font></p>
<p><font face=Tahoma>But (to throw a random example into the mix) I can mention that the Find/Replace&nbsp;functionality in Word vs. Notepad&nbsp;could use a little help. :-)</font></p>
<p><font face=Tahoma>We will test with the following strings:</font></p>
<blockquote dir=ltr style="MARGIN-RIGHT: 0px">
<p><font face="Courier New" size=4><strong>aaeå&nbsp;&nbsp;&nbsp;<a href="http://www.fileformat.info/info/unicode/char/0061">U+0061</a> <a href="http://www.fileformat.info/info/unicode/char/0061">U+0061</a> <a href="http://www.fileformat.info/info/unicode/char/0065">U+0065</a> <a href="http://www.fileformat.info/info/unicode/char/00e5">U+00e5</a></strong></font></p><font face="Courier New" size=4>
<p><strong>aæå&nbsp;&nbsp;&nbsp;&nbsp;<a href="http://www.fileformat.info/info/unicode/char/0061">U+0061</a> <a href="http://www.fileformat.info/info/unicode/char/00e6">U+00e6</a> <a href="http://www.fileformat.info/info/unicode/char/0061">U+0061</a> <a href="http://www.fileformat.info/info/unicode/char/030a">U+030a</a></strong></p></font></blockquote>
<p><font face=Tahoma>Not very fair, but then I never recall claiming fairness. :-)</font></p>
<p><font face=Tahoma>Now if you test searching for one of these strings within Notepad by using the other as the string you are looking, they will find one another!</font></p>
<p><font face=Tahoma>But if you try to do the same in Word, you will not....</font></p>
<p><font face=Tahoma>And here are two more strings:</font></p>
<blockquote dir=ltr style="MARGIN-RIGHT: 0px">
<p><font face="Courier New" size=4><strong>aåå&nbsp;&nbsp;&nbsp;<a href="http://www.fileformat.info/info/unicode/char/0061">U+0061</a> <a href="http://www.fileformat.info/info/unicode/char/00e5">U+00e5</a> <a href="http://www.fileformat.info/info/unicode/char/0061">U+0061</a> <a href="http://www.fileformat.info/info/unicode/char/030a">U+030a</a></strong></font></p><font face="Courier New" size=4>
<p><strong>aåå&nbsp;&nbsp;&nbsp;<a href="http://www.fileformat.info/info/unicode/char/0061">U+0061</a> <a href="http://www.fileformat.info/info/unicode/char/0061">U+0061</a> <a href="http://www.fileformat.info/info/unicode/char/030a">U+030a</a> <a href="http://www.fileformat.info/info/unicode/char/00e5">U+00e5</a></strong></p></font></blockquote><font face=Tahoma>
<p><font face=Tahoma>Once again, with Notepad one string will find the other, and with Word no match will be found!</font></p>
<p>(For those keeping score, Visual Studio will not find the strings either. Excel will find them, while Access will not).</p>
<p><font face=Tahoma>Now I have stacked the deck a little bit here, since as I have pointed out before, <a href="http://msdn.microsoft.com/library/en-us/winui/winui/windowsuserinterface/resources/strings/stringreference/stringfunctions/comparestring.asp">CompareString</a> will treat the&nbsp;ae ligature (æ) as being equal to the letters "ae". But by using the precomposed and composite forms of <strong>a ring</strong>&nbsp;in each,&nbsp;I&nbsp;have created two strings that have the same length and which <a href="http://msdn.microsoft.com/library/en-us/winui/winui/windowsuserinterface/resources/strings/stringreference/stringfunctions/comparestring.asp">CompareString</a> will treat as equal (on most user locales, at least).</font></p>
<p>I also was armed with the knowledge of how Notepad is doing its searching -- it looks for the first character in the string, and on a match it compares the full string with <a href="http://msdn.microsoft.com/library/en-us/winui/winui/windowsuserinterface/resources/strings/stringreference/stringfunctions/comparestring.asp">CompareString</a>. Since it assumes the lengths will be the same, everything works!</p>
<p><em>(I could have easily made Notepad fail by changing the length or doing a case sensitive search -- which Notepad treats as a binary comparison. But like I said, I was not trying to play fair!)</em></p>
<p>The important point here is that by using <a href="http://msdn.microsoft.com/library/en-us/winui/winui/windowsuserinterface/resources/strings/stringreference/stringfunctions/comparestring.asp">CompareString</a>, Notepad makes it part way to canonical equivalence since, as I pointed out back in 2004 in the post <strong><a href="http://archives.miloush.net/michkap/archive/2004/11/29/271476.html">Normalization and Microsoft -- what's the story?</a></strong>, we do cover a lot of this in the NLS API and we were doing so&nbsp;since the time that&nbsp;the formal definition for canonical equivalence was being formed in Unicode.</p>
<p>If it were not for that string length issue, then everything would be fine there!</p></font>
<p><font face=Tahoma>Now what Word is doing here is anyone's guess -- it has no problems with case insensitivity but it is not treating as equal any of what <a href="http://msdn.microsoft.com/library/en-us/winui/winui/windowsuserinterface/resources/strings/stringreference/stringfunctions/comparestring.asp">CompareString</a>&nbsp;treats as equal. It is even ignoring diacritics and case and it still is not treating the strings as being equal.</font></p>
<p><font face=Tahoma>Whatever Word, Access, and Visual Studio&nbsp;are doing here,&nbsp;they are doing it&nbsp;wrong. and Notepad is getting it half right.</font></p>
<p><font face=Tahoma>It may be time to start getting more of these applications to do things correctly, huh?</font></p>
<p><font face=Tahoma><em>(Notepad actually&nbsp;<strong>does</strong> get better in Vista -- check out the February CTP; I hope that the&nbsp;others will get better in future versions of Office and VS! And I especially hope that both MS and Google can get better at this in their respective search technologies, since some languages are really suffering in the meantime!)</em></font></p>
<p><font face=Tahoma></font>&nbsp;</p>
<p><font face=Tahoma><font color=#ff1493><em>This post brought to you by</em> "å" <em>(<a href="http://www.fileformat.info/info/unicode/char/00e5">U+00e5</a>, a.k.a. LATIN SMALL LETTER A WITH RING ABOVE)</em></font></font></p>
<hr/><p><a id="522990" href="#522990">#</a> <strong>Christian Kaiser</strong> on 2 Feb 2006 4:44 AM:</p><div style="margin-left: 1em">Well Notepad will also fail if the 'ae' is the first character (as comparing the first character will then fail), so it's also only correct in SOME cases.<br/><br/>I'm not saying anything in favour of Office here, just that any of these comparisons are flawed.<br/><br/>Do you see a faster way to do a string comparison than to use CompareString(), just like NOTEPAD's programmer's idea, but correct?<br/><br/>Ch.</div>
<p><a id="523174" href="#523174">#</a> <strong>Michael S. Kaplan</strong> on 2 Feb 2006 10:01 AM:</p><div style="margin-left: 1em">Hi Christian!<br/><br/>The strings are not flawed, they were specifically constructed to make it superficially appear that only Notepad and Excel know how to do stuff. :-)<br/><br/>It is an actually interesting &quot;interview question&quot;, so I was going to ask folks what *they* thought might be faster....</div>
<p><a id="523210" href="#523210">#</a> <strong>Michael S. Kaplan</strong> on 2 Feb 2006 10:37 AM:</p><div style="margin-left: 1em">See <a rel="nofollow" target="_new" href="http://archives.miloush.net/michkap/archive/2006/02/02/523189.html">http://blogs.msdn.com/michkap/archive/2006/02/02/523189.aspx</a> for the question. :-)</div>
<hr/><p><em>referenced by</em></p><div style="margin-left: 1em"><p>2006/02/02 <a href="http://archives.miloush.net/michkap/archive/2006/02/02/523189.html">Another interview question</a></p></div><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2006/02/02/523189.html" title="Another interview question">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2006/02/01/522164.html" title="On [not] localizing a MessageBox from code">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2006-02">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2006-02-02">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2006/02/02/522919.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:40 GMT -->
</html>