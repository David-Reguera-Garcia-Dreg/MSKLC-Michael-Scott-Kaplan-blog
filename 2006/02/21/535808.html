<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2006/02/21/535808.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:40 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>Don't muck with the combining character order</title></head><body>
<h1>Don't muck with the combining character order</h1>
<p><em>by Michael S. Kaplan, published on 2006/02/21 03:11 -05:00, original URI: http://blogs.msdn.com/b/michkap/archive/2006/02/21/535808.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostNew -->
<P><FONT face=Tahoma>The communicative property of addition clearly does not apply to combing marks in Unicode.</FONT></P>
<P><FONT face=Tahoma>Or at least it is not supposed to.</FONT></P>
<P><FONT face=Tahoma>I mean, A + B is not the same as B + A, in any situation where that order is meant to enforce how they are placed in relation to each other.</FONT></P>
<P><FONT face=Tahoma>Anyway, r</FONT><FONT face=Tahoma>egular reader Mike Dunn asked in the Suggestion Box about an exception to this:</FONT></P>
<BLOCKQUOTE dir=ltr style="MARGIN-RIGHT: 0px">
<P><FONT face="Times New Roman" size=2><EM>After reading your post about putting lots of diacritics on a letter, I wondered what determines the order that they appear in. </EM></FONT></P>
<P><FONT face="Times New Roman" size=2><EM>I looked at the sequences 0065 0302 0303 and 0065 0303 0302 using Tahoma on XPSP2 in Notepad and Word 2000, and in both cases the diacritics appear in the same order (tilde above the circumflex). This is the right order for Vietnamese, but if I were writing IPA, I would&nbsp;want the circumflex on top. Can the order be changed with control characters? </EM></FONT></P></BLOCKQUOTE>
<P><FONT face=Tahoma>That, my dear Mike, is an excellent question. One that (now that you asked it) I was very curious about the answer. Why do these two sequences:</FONT></P>
<BLOCKQUOTE dir=ltr style="MARGIN-RIGHT: 0px">
<P><FONT face=Tahoma size=6><FONT size=3><IMG src="http://trigeminal.fmsinc.com/images/diacritic_order_XP.jpg"></FONT></FONT></P></BLOCKQUOTE>
<P><FONT face=Tahoma>look the same, anyway?</FONT></P>
<P><FONT face=Tahoma>Both U+0302 (COMBINING CIRCUMFLEX ACCENT) and U+0303 (COMBINING TILDE) have the same canonical combining class value -- 230, which means 'Above'. So there is no valid Unicode-type reason for them to re-order.</FONT></P>
<P><FONT face=Tahoma>Now it is true that one character is a encoded as a precomposed sequence in Unicode and one is not, but still!</FONT></P>
<P><FONT face=Tahoma>I was determined to find out what was going on.</FONT></P>
<P><FONT face=Tahoma>Luckily, down the hall is <A HREF="http://archives.miloush.net/michkap/archive/2005/03/30/403636.html">the best freaking font team in the world</A>, so all I had to do was head down the hall to ask somebody.</FONT></P>
<P><FONT face=Tahoma>Hmmmm.... seems like a lot of people are out right now. I made it all the way down to Nick's office, where he was talking to Mushegh. Aha, maybe they would be able to help.</FONT></P>
<P><FONT face=Tahoma>I&nbsp;started by apologizing to them, since although I do not consider them to be "the dregs" in any kind of quality sense, they ended up being treated as the dregs due to the distance between my office and theirs. They smiled, which I took as a good sign. And then I asked them about the above....</FONT></P>
<P><FONT face=Tahoma>This is actually a known issue, It is a side effect of a bug in the way that the code was looking for precomposed forms (on the assumption that a precomposed version is more likely to look correct if it exists). The bug was causing precomposed characters with the wrong order for combining sequences to sometimes be found....</FONT></P>
<P dir=ltr><FONT face=Tahoma>The good news is that Nick himself had checked in the fix for this bug in Vista, which now does things correctly:</FONT></P>
<BLOCKQUOTE dir=ltr style="MARGIN-RIGHT: 0px">
<P><FONT face=Tahoma><IMG src="http://trigeminal.fmsinc.com/images/diacritic_order_Vista.jpg"></FONT></P></BLOCKQUOTE>
<P><FONT face=Tahoma>It has not been backported to the prior versions of Windows, though that is the sort of thing which can of course be considered and triaged appropriately....</FONT></P>
<P><FONT face=Tahoma>Now the other part of the question -- how to force the right behavior on the downlevel platforms, there were not too many ideas forthcoming.</FONT></P>
<P><FONT face=Tahoma>Obviously if you are building the font you decide what precomposed characters will exist in it -- you can even have none exist and rely on the attachment points and such to build up the right character.</FONT></P>
<P><FONT face=Tahoma>If you are not doing the font building yourself, you would have to find a way to break up the sequences without changing the display, which can be a real challenge (no one thought of anything offhand).</FONT></P>
<P><FONT face=Tahoma>One way that I did find was putting together U+1ebd U+0302 (LATIN SMALL LETTER E WITH TILDE and COMBINING CIRCUMFLEX ACCENT), although I found it would work in some fonts (such as Segoe UI) and not so well in others (such as Tahoma). See below if you have these fonts both installed:</FONT></P>
<P><FONT face=Tahoma><FONT face="Segoe UI">ẽ̂ẽ̂ẽ̂ẽ̂ẽ̂ẽ̂ẽ̂ẽ̂ẽ̂ẽ̂</FONT>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ẽ̂ẽ̂ẽ̂ẽ̂ẽ̂ẽ̂ẽ̂ẽ̂ẽ̂ẽ̂</FONT></P>
<P><FONT face=Tahoma>If you do not have Segoe UI installed then it will not look good, so don't bother reporting <EM>that</EM> as a bug!</FONT></P>
<P><FONT face=Tahoma>So anyway, I headed back to my office and decided to perhaps not just rely on office locations to decide where I visit first -- because sometimes the best people to talk to would otherwise be dismissed as the dregs, and neither Mushegh nor Nick qualify as the dregs in my book. :-)</FONT></P>
<P><FONT face=Tahoma></FONT>&nbsp;</P>
<P><FONT face=Tahoma color=#ff1493><EM>This post brought to you by</EM> "<FONT size=6>ễ</FONT>" <EM>(<A href="http://www.fileformat.info/info/unicode/char/1ec5">U+1ec5</A>, a.k.a. LATIN SMALL LETTER E WITH CIRCUMFLEX AND TILDE)</EM></FONT></P>
<hr/><p><a id="535929" href="#535929">#</a> <strong>Phylyp</strong> on 21 Feb 2006 4:38 AM:</p><div style="margin-left: 1em">Michael, <br>I think you mean 'commutative', not 'communicative'. Unless there's a joke in there that I'm missing :) <br>~ Phylyp </div>
<p><a id="535987" href="#535987">#</a> <strong>Michael S. Kaplan</strong> on 21 Feb 2006 7:55 AM:</p><div style="margin-left: 1em">No, I meant communicative (cf: <a rel="nofollow" target="_new" href="http://www.uwcsea.edu.sg/elemcurriculum/g1maths.htm">http://www.uwcsea.edu.sg/elemcurriculum/g1maths.htm</a> )....</div>
<p><a id="536043" href="#536043">#</a> <strong>Andrew West</strong> on 21 Feb 2006 9:29 AM:</p><div style="margin-left: 1em">&quot;Now the other part of the question -- how to force the right behavior on the downlevel platforms, there were not too many ideas forthcoming.&quot;<br><br>On a hunch I inserted U+034F Combining Grapheme Joiner (CGJ) between the tilde and circumflex (i.e. &lt;U+0065 U+0303 U+034F U+0302&gt;), and on XP/Notepad with the Doulos SIL or Charis SIL font selected you get the circumflex above the tilde. Unfortunately it doesn't work with any other font on my system, although if you simply use the Vista version of Uniscribe on XP (the simplest solution), then it all works OK without any need to add the CGJ, but only with the SIL fonts and Code2000, not with any of the Microsft fonts.<br></div>
<p><a id="536114" href="#536114">#</a> <strong>bmm6o</strong> on 21 Feb 2006 11:31 AM:</p><div style="margin-left: 1em">Did you leave off the smiley? &nbsp;You really meant &quot;commutative&quot;. &nbsp;Just because other people are confused...<br><br>Interesting article BTW.</div>
<p><a id="536147" href="#536147">#</a> <strong>Michael S. Kaplan</strong> on 21 Feb 2006 12:04 PM:</p><div style="margin-left: 1em">No smiley intended -- if you look at the link I put up (or tons of others like it) or search for the &quot;communicative property of addition&quot; you will see lots of hits.<br><br>It is also how I remember learning it growing up.<br><br>So, am I wrong? Well, maybe. But if entire scool system curricula are wrong with me then I don't feel like I am in bad company. :-)</div>
<p><a id="536178" href="#536178">#</a> <strong>Johan Petersson</strong> on 21 Feb 2006 12:44 PM:</p><div style="margin-left: 1em">Anyone who implicitly trust what he learned in school is in bad company if you ask me.<br><br>Communicative means &quot;inclined to communicate readily&quot; (i.e. talkative).<br><br>Commutative means &quot;independent of order&quot; (e.g. order of operands).<br></div>
<p><a id="536190" href="#536190">#</a> <strong>Maurits [MSFT]</strong> on 21 Feb 2006 12:54 PM:</p><div style="margin-left: 1em">communicative property is wrong<br>commutative propery is right<br><br>Just goes to show you, no matter what kind of an idea you may have, there's a Google search to prove that others have the same idea</div>
<p><a id="536199" href="#536199">#</a> <strong>Maurits [MSFT]</strong> on 21 Feb 2006 1:02 PM:</p><div style="margin-left: 1em">But if you insist...<br><br><a rel="nofollow" target="_new" href="http://tinyurl.com/q27m7">http://tinyurl.com/q27m7</a></div>
<p><a id="536235" href="#536235">#</a> <strong>Michael S. Kaplan</strong> on 21 Feb 2006 1:46 PM:</p><div style="margin-left: 1em">Some people find me to be very talkative, which is perhaps why I prefer the word I do?<br><br>Not a matter of implicit trust, just pointing out that if I am wrong I don't seem to be alone, to a degree that ignoring this other usage may not be in anyone's best interest.<br><br>Though it would be nice to get back to the actual subject of the post now, no wordinista work is required here. :-)</div>
<p><a id="536259" href="#536259">#</a> <strong>Maurits [MSFT]</strong> on 21 Feb 2006 2:15 PM:</p><div style="margin-left: 1em">Don't take offen[cs]e... we knew what you meant, we're just trying to help.<br><br>You're not to blame if your teacher was using a flawed curriculum... if enough people start using &quot;communicative&quot; it may very well become acceptable.<br><br>But... speaking as a math major... I've personally never heard the (A+B = B+A) property of addition described as anything but &quot;commutative.&quot;<br><br>Just out of curiousity... what do you call these properties?<br><br>A + B = B + A: commutative/communicative property of addition<br>(A + B) + C = A + (B + C): associative property of addition<br>A * (B + C) = (A * B) + (A * C): distributive property of multiplication over addition<br><br>A = A: reflexive property of equality<br>A = B -&gt; B = A: symmetric property of equality<br>A = B and B = C -&gt; A = C: transitive property of equality<br><br>FWIW, my pre-algebra teacher explained the word &quot;commutative&quot; in terms of the word &quot;commuter&quot; (as in people who drive to work) so I've got the old term drummed fairly well into my head. :)<br><br>Still, as Shakespeare almost said, &quot;a property of addition by any other name would smell as sweet...&quot;</div>
<p><a id="536269" href="#536269">#</a> <strong>Michael S. Kaplan</strong> on 21 Feb 2006 2:22 PM:</p><div style="margin-left: 1em">I use the same names as you for the other ones. <br><br>And I took no offense...<br><br>Plus when I did the googlefight without the quotes and with communicative first, they almost matched. :-)</div>
<p><a id="536447" href="#536447">#</a> <strong>Dean Harding</strong> on 21 Feb 2006 6:09 PM:</p><div style="margin-left: 1em">I also notice the icon for notepad has changed direction. Oooh! How exciting :p~</div>
<p><a id="536684" href="#536684">#</a> <strong>Gabe</strong> on 22 Feb 2006 2:11 AM:</p><div style="margin-left: 1em">Interestingly, I did a search for [&quot;communicative property&quot; commutative] and it seems that about a third of the people who use the term &quot;communicative property&quot; do so on pages that also use the proper term &quot;commutative&quot;. This indicates to me either a typo, a spellcheck correction error, or a mishearing (like people who write &quot;must of&quot; instead of &quot;must've&quot;).<br><br>I had a friend from Beachwood who thought that the measuring devices called calipers were actually &quot;calibrators&quot;, but I doubt it was the fault of the school district. This is all probably a case of misreading or mishearing the word.<br><br>To bring this back on topic though, my standard XPsp2 browser shows an &quot;e&quot; with a circumflex right above it and a tilde on top for U+1ec5. Is this because Tahoma has a glyph for that codepoint or does IE know how to compose it with the sequence 0065 0302 0303?</div>
<p><a id="536838" href="#536838">#</a> <strong>Michael S. Kaplan</strong> on 22 Feb 2006 7:19 AM:</p><div style="margin-left: 1em">Hi Gabe -- that is very odd (its definitely not what I see for Tamone in IE). What version of Tahoma do you have?</div>
<p><a id="537292" href="#537292">#</a> <strong>Gabe</strong> on 22 Feb 2006 4:42 PM:</p><div style="margin-left: 1em">My version of Tahoma is 3.14. To clarify, my version of U+1ec5 looks just like the one shown in the graphic at <a rel="nofollow" target="_new" href="http://www.fileformat.info/info/unicode/char/1ec5">http://www.fileformat.info/info/unicode/char/1ec5</a><br><br>It's not that I don't get what I expect, I'm just wondering how it gets to be that way.</div>
<hr/><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2006/02/21/535813.html" title="What about the Microsoft Custom Locale Builder?">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2006/02/20/535291.html" title="A chance for me to give practical advice!">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2006-02">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2006-02-21">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2006/02/21/535808.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:40 GMT -->
</html>