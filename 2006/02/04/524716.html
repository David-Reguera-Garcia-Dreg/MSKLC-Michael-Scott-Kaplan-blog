<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2006/02/04/524716.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:40 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>The answer is dependent on the question (aka Turkish Delight)</title></head><body>
<h1>The answer is dependent on the question (aka Turkish Delight)</h1>
<p><em>by Michael S. Kaplan, published on 2006/02/04 03:05 -05:00, original URI: http://blogs.msdn.com/b/michkap/archive/2006/02/04/524716.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostNew -->
<p><font face=Tahoma>The truism in the title of this post seems fairly obvious. Though in&nbsp;several situations this week, I have had to point out this fact when I explained why the answer they got turned out to not be the one they wanted....</font></p>
<p><font face=Tahoma>A lot of it comes down to the use of the <a href="http://msdn.microsoft.com/library/en-us/winui/winui/windowsuserinterface/resources/strings/stringreference/stringfunctions/lstrcmpi.asp">lstrcmpi</a> function.</font></p>
<p><font face=Tahoma><em><font size=2>(As an aside, note that </font></em><a href="http://support.microsoft.com/default.aspx?scid=kb;en-us;100366"><em><font size=2>this KB article</font></em></a><em><font size=2> is simply wrong for every 32-bit version of Windows. I will have to talk about why I think the MSKB is&nbsp;sometimes a priceless asset to be treasured and&nbsp;other times&nbsp;a pariah to be shunned!)</font></em></font></p>
<p><font face=Tahoma>Now the fact is that <a href="http://msdn.microsoft.com/library/en-us/winui/winui/windowsuserinterface/resources/strings/stringreference/stringfunctions/lstrcmpi.asp">lstrcmpi</a>&nbsp;is a wrapper around CompareString, which regular readers here know is in Windows for the pupose of doing linguistically meaningful&nbsp;comparisons. And you can fry a linguist in butter and they'd still be a linguist<sup><font size=1>1</font></sup> -- so no&nbsp;mere wrapper function is going to change the fundamental purpose....</font></p>
<p><font face=Tahoma>So, if you&nbsp;are a&nbsp;developer thinking about a case insensitive items like&nbsp;FAT/FAT32/NTFS files&nbsp;or the registry or OS objects like events/mutexes/etc., and you think that <a href="http://msdn.microsoft.com/library/en-us/winui/winui/windowsuserinterface/resources/strings/stringreference/stringfunctions/lstrcmpi.asp">lstrcmpi</a>&nbsp;looks like the perfect function to use for&nbsp;comparing two such items, what would I say?</font></p>
<p><font face=Tahoma>Well, I promise I would not call you an idiot<font size=1><sup>2</sup></font>. But if pressed I might have to call a design document that had such an implementation plan idiotic. And I would really try to convince you to fix your code. :-)</font></p>
<p><font face=Tahoma>Now here is where we get back to the title&nbsp;of this post.</font></p>
<p><font face=Tahoma>Because if you are calling <a href="http://msdn.microsoft.com/library/en-us/winui/winui/windowsuserinterface/resources/strings/stringreference/stringfunctions/lstrcmpi.asp">lstrcmpi</a>&nbsp;for appropriate reasons (i.e. you wanted to get linguistically meaningful results, say in the sorting of a list in a user interface) but you wanted to have behavior that did not vary with different locales, then <a href="http://msdn.microsoft.com/library/en-us/winui/winui/windowsuserinterface/resources/strings/stringreference/stringfunctions/comparestring.asp">CompareString</a> with LOCALE_INVARIANT is a good answer.</font></p>
<p><font face=Tahoma>But if you wanted almost anything else, including all of the non-linguistic purposes hinted at earlier, then <a href="http://msdn.microsoft.com/library/en-us/intl/nls_CompareStringOrdinal.asp">CompareStringOrdinal</a> or <a href="http://msdn.microsoft.com/library/en-us/Kernel_r/hh/Kernel_r/k109_ddeef320-7510-446b-af6f-756c3999bec1.xml.asp">RtlCompareUnicodeString</a> is a <em>much</em> better choice.</font></p>
<p><font face=Tahoma>Maybe the fact that these non-linguistic functions are so much FASTER might have some influence on people. Or the fact that if people are makingsecurity decisions based on the results they could be crafting their own security bugs? I mean, both performance and security are "sexier" than international to a lot of these people.:-)</font></p>
<p><font face=Tahoma>So, how someone asks the question (especially keeping in&nbsp;mind the fact that code already calling <a href="http://msdn.microsoft.com/library/en-us/winui/winui/windowsuserinterface/resources/strings/stringreference/stringfunctions/lstrcmpi.asp">lstrcmpi</a>&nbsp;implies a specific, requested usage) can have serious impact on the answer I would give.</font></p>
<p><font face=Tahoma>Though to be honest, for the last few years my cynical side has decided to assume that original code was probably wrong, and that neither the person who wrote the code nor the person asking me the question has really thought through the scenario.</font></p>
<p><font face=Tahoma>So perhaps now I would say that the answer is dependent on the cynicism of the person being asked? :-)</font></p>
<p><font face=Tahoma>One of my presentations at the <a href="http://archives.miloush.net/michkap/archive/2005/11/21/495389.html">29th Internationalization and Unicode Conference</a> (the one entitled <a href="http://www.unicodeconference.org/program-d.htm#Kaplan_S9">Tales of Incorrect String Comparisons</a>) actually talks about this issue and several other&nbsp;collation-type problems. I would highly recommend it to anyone who finds this type of thing to be interesting. Several cool demos, etc. :-)</font></p>
<p><font face=Tahoma></font>&nbsp;</p>
<p><font size=1><em><font face=Tahoma>1 - Apologies to Martin Cruz Smith for the slightly munged quote!<br /></font></em><font face=Tahoma><font face=Tahoma><em>2 - Well, not unless you decided </em><a href="http://msdn.microsoft.com/library/en-us/winui/winui/windowsuserinterface/resources/strings/stringreference/stringfunctions/lstrcmpi.asp"><em>lstrcmpi</em></a><em> was the function to use even after the problem was explained to you, and even then probably not to your face. :-)</em></font></font></font></p>
<p><font face=Tahoma color=#ff1493><em>This post brought to you by</em> "<font size=6>Ä°</font>" <em>(<a href="http://www.fileformat.info/info/unicode/char/0130">U+0130</a>, a.k.a. LATIN CAPITAL LETTER I WITH DOT ABOVE)</em></font></p>
<hr/><p><a id="525313" href="#525313">#</a> <strong>Dean Harding</strong> on 5 Feb 2006 6:43 PM:</p><div style="margin-left: 1em">To be fair, that KB article says it refers to Windows SDK 3.0/3.1, so it's not talking about 32-bit Windows anyway (Plus the fact that it's got such a low number should be a hint that it may be out of date as well). Though I guess it could probably be spelled out a bit more clearly... Plus, on the page it actually says &quot;last review: August 2004&quot; but then, I don't know what actually goes on in the &quot;review&quot; process (do they actually check the validitity of the data, or just fix broken links, etc?)<br /><br />To be honest, it's always been my opinion that application code should never actually make any security decisions itself anyway. You should just try it and if it doesn't work report the error. For example, rather than checking to see if a given file name is &quot;valid&quot; or not, just try to create the file - that's the only way that'll work 100% of the time.<br /><br />Of course, there are some times when you've got to be more careful. Like if you're a web server mapping request URIs to local files names, you've got to be *very* careful that you never map to a file name outside of the web server's root directory. But I'd say that's the exception, rather than the rule.</div>
<hr/><p><em>referenced by</em></p><div style="margin-left: 1em"><p>2006/03/05 <a href="http://archives.miloush.net/michkap/archive/2006/03/05/544133.html">Will I C U at the IUC?</a></p></div><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2006/02/04/524972.html" title="Have you stayed with us before, sir?">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2006/02/03/524175.html" title="Problems in the MVP world?">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2006-02">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2006-02-04">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2006/02/04/524716.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:40 GMT -->
</html>