<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2006/02/08/527375.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:40 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>They make 'em smarter than GetDateFormat</title></head><body>
<h1>They make 'em smarter than GetDateFormat</h1>
<p><em>by Michael S. Kaplan, published on 2006/02/08 03:01 -05:00, original URI: http://blogs.msdn.com/b/michkap/archive/2006/02/08/527375.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostNew -->
<p><font face=Tahoma>Last month I talked about <a href="http://msdn.microsoft.com/library/en-us/intl/nls_5w6s.asp">GetDateFormat</a> and using </font><font face=Tahoma>the DATE_LTRREADING/DATE_RTLREADING flags with it </font><font face=Tahoma>in <strong><a HREF="http://archives.miloush.net/michkap/archive/2006/01/21/515793.html">Return of the Mark</a></strong>.</font></p>
<p><font face=Tahoma>Now, there is a lot going on here when we are deciding issues of directionality. S</font><font face=Tahoma>o let us try to separate all of the issues. :-)</font></p>
<p><font face=Tahoma>I mean to say,&nbsp;if you are a developer calling <a href="http://msdn.microsoft.com/library/en-us/intl/nls_5w6s.asp">GetDateFormat</a>&nbsp;it is hard to know whether to pass one of the flags.</font></p>
<p><font face=Tahoma>And depending on the context of where the formatted string is being inserted and what is in the string, those marks could be important to include.</font></p>
<p><font face=Tahoma>If you think it sounds like another case of a bad decision to put localization decisions in the hands of developers like I pointed out in <strong><a HREF="http://archives.miloush.net/michkap/archive/2006/01/19/514656.html">Just when you think you know a function...</a></strong> then you are insightful.</font></p>
<p><font face=Tahoma>Unfortunately, you are also mistaken, since there is much more involved than localization here; there is the calendar being used, the needs of various locales, and the context where it is inserted. And there is no good way to put this one in the hands of localizers and get the right results, either.</font></p>
<p><font face=Tahoma>Because they do not have all the information.</font></p>
<p><font face=Tahoma>Basically, we have all of the following information contributors on the 'directionality' front:</font></p>
<ul>
<li><font face=Tahoma>The locale being passed into <a href="http://msdn.microsoft.com/library/en-us/intl/nls_5w6s.asp">GetDateFormat</a>&nbsp;via the LCID parameter (which is the biggest control over the calendar that is used);</font></li>
<li><font face=Tahoma>The calendar for the locale, any time DATE_USE_ALT_CALENDAR is not passed and the calendar is not CAL_GREGORIAN;</font></li>
<li><font face=Tahoma>The alternate calendar for the locale, any time DATE_USE_ALT_CALENDAR <em>is</em> passed&nbsp;and the calendar is not CAL_GREGORIAN;</font></li>
<li><font face=Tahoma>The UI language of the user, which controls the language used for day and month names any time the calendar being used is CAL_GREGORIAN (which is the localized Gregorian calendar).</font></li></ul>
<p><font face=Tahoma>Ok, so we have four factors to consider in our decision for whether to pass DATE_LTRREADING&nbsp;or DATE_RTLREADING, and if so, which one to pass.</font></p>
<p><font face=Tahoma>All of which <a href="http://msdn.microsoft.com/library/en-us/intl/nls_5w6s.asp">GetDateFormat</a>&nbsp;could do itself if there were some cool flag like DATE_PICK_APPROPRIATE_READING_PLEASE, or somesuch. :-)</font></p><font face=Tahoma>
<p><font face=Tahoma>And how&nbsp;would you get the calendar that is being used? Well, if DATE_USE_ALT_CALENDAR is passed to <a href="http://msdn.microsoft.com/library/en-us/intl/nls_5w6s.asp">GetDateFormat</a>, you would use <a href="http://msdn.microsoft.com/library/en-us/intl/nls_34rz.asp">GetLocaleInfo</a> with the LOCALE_IOPTIONALCALENDAR flag; otherwise, you would use <a href="http://msdn.microsoft.com/library/en-us/intl/nls_34rz.asp">GetLocaleInfo</a> with the LOCALE_ICALENDARTYPE flag.</font></p>
<p>So, how&nbsp;would you get the directionality from a locale? Well, you can get that from the LOCALESIGNATURE returned by LOCALE_FONTSIGNATURE (more on that parameter <a HREF="http://archives.miloush.net/michkap/archive/2005/12/19/505576.html"><strong>this post</strong></a> and <a HREF="http://archives.miloush.net/michkap/archive/2005/10/22/483573.html"><strong>this one</strong></a>), looking at bit 123 of the <a href="http://msdn.microsoft.com/library/en-us/intl/unicode_63ub.asp">Unicode Subset Bitfields</a>.</p></font>
<p><font face=Tahoma>And how do you combine these two possible locale settings and the calendar setting?</font></p>
<p><font face=Tahoma>Hmmm, that is a bit harder, isn't it?</font></p>
<p><font face=Tahoma>Actually, it turns out that things are fairly easy, believe it or not.</font></p>
<p><font face=Tahoma>The main trick to remember is that the markers are used to imply directionality in the case where directionality may be unclear.</font></p>
<p><font face=Tahoma>If all three are RTL, then obviously you could include DATE_RTLREADING (if you were also sure that the user default locale was also RTL you could perhaps pass no flags since there is no ambiguity, it is a pure RTL context).</font></p>
<p><font face=Tahoma>If any of the three are RTL, then let the calendar decide (which means that CAL_HEBREW and CAL_HIJRI lead to DATE_RTLREADING, other CAL_* leads to DATE_LTRREADING, and CAL_GREGORIAN is decided by the UI language.</font></p>
<p><font face=Tahoma>Otherwise, you could pass DATE_LTRREADING (and once again if the default user locale was also LTR you could perhaps pass no flags since there is no ambiguity, it is a pure LTR context).</font></p>
<p><font face=Tahoma>Now if I had an interview candidate who had some real NLS experience, </font><font face=Tahoma>this might&nbsp;have made&nbsp;a fascinating interview question, I think.</font></p>
<p><font face=Tahoma>And figuring out the logic above would have made an excellent conceptual question for a lunch interview! :-)</font></p>
<p><font face=Tahoma>In any case, <a href="http://msdn.microsoft.com/library/en-us/intl/nls_5w6s.asp">GetDateFormat</a> could almost certainly be smarter here.</font></p>
<p><font face=Tahoma>It is very hard for the caller to know what to do, while most of the information is available to the function -- it is a shame it&nbsp;is not set up to do the work if it is asked to.... :-(</font></p>
<p><font face=Tahoma></font>&nbsp;</p>
<p><em><font face=Tahoma color=#ff1493>This post brought to you by </font></em><a href="http://www.fileformat.info/info/unicode/char/200f"><em><font face=Tahoma>U+200f</font></em></a><em><font face=Tahoma color=#ff1493>, RIGHT-TO-LEFT MARKER</font></em></p>
<hr/><div style="margin-left: 1em"><em>no comments</em></div><hr/><p><em>referenced by</em></p><div style="margin-left: 1em"><p>2006/10/15 <a href="http://archives.miloush.net/michkap/archive/2006/10/15/827944.html">Not everything you might want out of a GetDateFormatEx, but think of it as a fixer-upper</a></p><p>2006/10/06 <a href="http://archives.miloush.net/michkap/archive/2006/10/06/795575.html">What do those marks do again?</a></p><p>2006/09/01 <a href="http://archives.miloush.net/michkap/archive/2006/09/01/735817.html">Cue the smarter version of GetDateFormat... ok, it's a wrap!</a></p></div><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2006/02/09/528297.html" title="Is RtlCompareUnicodeString used correctly?">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2006/02/07/526359.html" title="If the text is not complex, does it have to be treated like it is?">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2006-02">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2006-02-08">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2006/02/08/527375.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:40 GMT -->
</html>