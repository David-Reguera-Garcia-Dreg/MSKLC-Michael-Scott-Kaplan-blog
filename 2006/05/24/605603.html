<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2006/05/24/605603.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:39 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>Is it punctuation, symbol, or diacritic?</title></head><body>
<h1>Is it punctuation, symbol, or diacritic?</h1>
<p><em>by Michael S. Kaplan, published on 2006/05/24 13:23 -04:00, original URI: http://blogs.msdn.com/b/michkap/archive/2006/05/24/605603.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostNew -->
<P><FONT face=Tahoma>Developer Benjamin Westbrook asked me the following question yesterday (project name obscured for no reason in particular!):</FONT></P>
<BLOCKQUOTE dir=ltr style="MARGIN-RIGHT: 0px">
<P><FONT face=Tahoma size=2>Michael, I‚Äôm debugging the Find code for êøøêøøêøøêøøêøøêøøêøøêøøêøø and I wonder if you can comment on some behavior:</FONT></P>
<BLOCKQUOTE dir=ltr style="MARGIN-RIGHT: 0px">
<P><FONT face="Courier New" size=2>CultureInfo cultureInfo = new CultureInfo("ar");<BR>int index = cultureInfo.CompareInfo.IndexOf(‚Äé"ÿßŸÑŸíŸÉŸêÿ™Ÿéÿßÿ®", ‚Äé"ÿßŸÑŸÉÿ™ÿßÿ®", CompareOptions.IgnoreNonSpace);</FONT></P></BLOCKQUOTE>
<P><FONT face=Tahoma size=2>This code ends with index == -1.</FONT></P>
<P><FONT face=Tahoma size=2>I have some second hand information that in the past you told another êøøêøøêøøêøø dev there were limitations with Arabic and the IngoreNonSpace flag.&nbsp; Is this expected behavior?&nbsp; Is it possible to match the two strings with existing APIs?</P></FONT></BLOCKQUOTE>
<P><FONT face=Tahoma>This is an excellent question, one that is deeply embedded in some of the designs of the default collation table, in both Vista and in prior versions of Windows (the latter matches the .NET Framework)....</FONT></P>
<P><FONT face=Tahoma>Before we are done we will talk <A HREF="http://archives.miloush.net/michkap/archive/2005/07/31/445819.html">about FindNLSString</A>, <A HREF="http://archives.miloush.net/michkap/archive/2005/05/05/414845.html">about SORT_STRINGSORT</A>, <A HREF="http://archives.miloush.net/michkap/archive/2005/01/19/356280.html">about NORM_IGNORESYMBOLS</A>, and <A HREF="http://archives.miloush.net/michkap/archive/2005/05/05/414845.html">about NORM_IGNORENONSPACE</A>, and more.</FONT></P>
<P><FONT face=Tahoma><EM>It is actually a problem that former GIFT tester Ihab Abdelhalim had pointed out many times as the non-intuitive design for collation in Arabic, which has finally been fixed in Vista&nbsp;(now that Ihab has left the group), though the fix is not yet a part of the tables that his new group (SQL Server/WinFS) has snapshoted. Eventually, I am sure he will have a chance to appreciate the fix.</EM> :-)</FONT></P>
<P><FONT face=Tahoma>First we will look at those two strings, with "identical"&nbsp;code points lined up to highlight the similarities:</FONT></P>
<BLOCKQUOTE dir=ltr style="MARGIN-RIGHT: 0px">
<P><FONT face="Courier New" size=2><STRONG><A href="http://www.fileformat.info/info/unicode/char/0627">U+0627</A> <A href="http://www.fileformat.info/info/unicode/char/0644">U+0644</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <A href="http://www.fileformat.info/info/unicode/char/0643">U+0643</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <A href="http://www.fileformat.info/info/unicode/char/062a">U+062a</A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <A href="http://www.fileformat.info/info/unicode/char/0627">U+0627</A> <A href="http://www.fileformat.info/info/unicode/char/0628">U+0628</A></STRONG></FONT></P>
<P><FONT face="Courier New" size=2><STRONG><A href="http://www.fileformat.info/info/unicode/char/0627">U+0627</A> <A href="http://www.fileformat.info/info/unicode/char/0644">U+0644</A> <A href="http://www.fileformat.info/info/unicode/char/0652">U+0652</A> <A href="http://www.fileformat.info/info/unicode/char/0643">U+0643</A> <A href="http://www.fileformat.info/info/unicode/char/0650">U+0650</A> <A href="http://www.fileformat.info/info/unicode/char/062a">U+062a</A> <A href="http://www.fileformat.info/info/unicode/char/064e">U+064e</A> <A href="http://www.fileformat.info/info/unicode/char/0627">U+0627</A> <A href="http://www.fileformat.info/info/unicode/char/0628">U+0628</A></STRONG></FONT></P></BLOCKQUOTE>
<P><FONT face=Tahoma>Now&nbsp;obviously there was a good faith basis for believing that the second string could be found within the first -- that these three additional characters could be in some way ignored. If not, the question would not have been asked....</FONT></P>
<P><FONT face=Tahoma>We will start by getting some sort keys for these strings in order to see how they are being used, both in Server 2003 and in Vista. I'll try to line up the sort keys for easier comparison.</FONT></P>
<P><FONT face=Tahoma>The two strings&nbsp;with no special flags, Server 2003:</FONT></P>
<BLOCKQUOTE dir=ltr style="MARGIN-RIGHT: 0px">
<P><FONT face="Courier New" size=1><STRONG>13 0b 13 63 13 5f 13 13 13 0b 13 0f&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 01 08 08&nbsp;&nbsp;&nbsp; 08&nbsp;&nbsp;&nbsp; 08&nbsp;&nbsp;&nbsp; 08 08&nbsp;01 01 01&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 00<BR>13 0b 13 63 13 5f 13 13 13 0b 13 0f&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 01 08 08&nbsp;&nbsp;&nbsp; 08&nbsp;&nbsp;&nbsp; 08&nbsp;&nbsp;&nbsp; 08 08&nbsp;01 01 01 80 0f 06 a6 80 13 06 a5 80 17 06 a3 00</STRONG></FONT></P></BLOCKQUOTE>
<P><FONT face=Tahoma>The two strings&nbsp;with NORM_IGNORENONSPACE, Server 2003:</FONT></P>
<BLOCKQUOTE dir=ltr style="MARGIN-RIGHT: 0px">
<P><FONT face="Courier New" size=1><STRONG>13 0b 13 63 13 5f 13 13 13 0b 13 0f&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 01&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 01 01 01&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 00<BR>13 0b 13 63 13 5f 13 13 13 0b 13 0f&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 01&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 01 01 01 80 0f 06 a6 80 13 06 a5 80 17 06 a3 00</STRONG></FONT></P></BLOCKQUOTE>
<P><FONT face=Tahoma>The two strings with NORM_IGNORESYMBOLS, Server 2003:</FONT></P>
<BLOCKQUOTE dir=ltr style="MARGIN-RIGHT: 0px">
<P><FONT face="Courier New" size=1><STRONG>13 0b 13 63 13 5f 13 13 13 0b 13 0f&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 01 08 08&nbsp;&nbsp;&nbsp; 08&nbsp;&nbsp;&nbsp; 08&nbsp;&nbsp;&nbsp; 08 08&nbsp;01 01 01&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 00<BR>13 0b 13 63 13 5f 13 13 13 0b 13 0f&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 01 08 08&nbsp;&nbsp;&nbsp; 08&nbsp;&nbsp;&nbsp; 08&nbsp;&nbsp;&nbsp; 08 08&nbsp;01 01 01&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 00</STRONG></FONT></P></BLOCKQUOTE>
<P><FONT face=Tahoma>The two strings with SORT_STRINGSORT, Server 2003:</FONT></P>
<BLOCKQUOTE dir=ltr style="MARGIN-RIGHT: 0px">
<P><FONT face="Courier New" size=1><STRONG>13 0b 13 63 13 5f 13 13 13 0b 13 0f&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 01 08 08&nbsp;&nbsp;&nbsp; 08&nbsp;&nbsp;&nbsp; 08&nbsp;&nbsp;&nbsp; 08 08 01 01 01&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 00<BR>13 0b 13 63 06 a6 13 5f 06 a5 13 13 06 a3 13 0b 13 0f 01 08 08 02 08 02 08 02 08 08 01 01 01&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 00</STRONG></FONT></P></BLOCKQUOTE>
<P><FONT face=Tahoma>Analysis: the three additional characters that are in the middle of the one string:</FONT></P>
<UL>
<LI><FONT face=Tahoma><A href="http://www.fileformat.info/info/unicode/char/064e">U+064e</A>&nbsp;&nbsp;&nbsp;ARABIC FATHA</FONT> 
<LI><FONT face=Tahoma><A href="http://www.fileformat.info/info/unicode/char/0650">U+0650</A>&nbsp;&nbsp;&nbsp;ARABIC KASRA</FONT> 
<LI><FONT face=Tahoma><A href="http://www.fileformat.info/info/unicode/char/0652">U+0652</A>&nbsp;&nbsp;&nbsp;ARABIC SUKUN</FONT></LI></UL>
<P><FONT face=Tahoma>are being treated as that special kind of symbol known as punctuation -- thus when you pass the NORM_IGNORESYMBOLS flag they are ignore entirely, and when you pass the SORT_STRINGSORT flag, they are treated as regular symbols.</FONT></P>
<P><FONT face=Tahoma>The problem is that while it may be interesting or convenient to think of them as a type of punctuation, they are not like that unique kind of punctuation (hyphens and such) that have special "word sort" behavior, and from the feedback we have gotten it is clear that most customers generally expect that passing NORM_IGNORENONSPACE would be used to ignore them, rather than NORM_IGNORESYMBOLS.</FONT></P>
<P><FONT face=Tahoma>So, let's look at the Vista weights:</FONT></P>
<P><FONT face=Tahoma>The two strings&nbsp;with no special flags, Vista:</FONT></P>
<BLOCKQUOTE dir=ltr style="MARGIN-RIGHT: 0px">
<P><FONT face="Courier New" size=2><STRONG>29 0b 29 a7 29 8f 29 20 29 0b 29 0e 01&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 01 01 01 00<BR>29 0b 29 a7 29 8f 29 20 29 0b 29 0e 01 02 e4 e3 e1 01 01 01 00</STRONG></FONT></P></BLOCKQUOTE>
<P><FONT face=Tahoma>The two strings&nbsp;with NORM_IGNORENONSPACE, Vista:</FONT></P>
<BLOCKQUOTE dir=ltr style="MARGIN-RIGHT: 0px">
<P><FONT face="Courier New" size=2><STRONG>29 0b 29 a7 29 8f 29 20 29 0b 29 0e 01&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 01 01 01 00<BR>29 0b 29 a7 29 8f 29 20 29 0b 29 0e 01&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 01 01 01 00</STRONG></FONT></P></BLOCKQUOTE>
<P><FONT face=Tahoma>The two strings with NORM_IGNORESYMBOLS, Vista:</FONT></P>
<BLOCKQUOTE dir=ltr style="MARGIN-RIGHT: 0px">
<P><FONT face="Courier New" size=2><STRONG>29 0b 29 a7 29 8f 29 20 29 0b 29 0e&nbsp;01&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 01 01 01 00<BR>29 0b 29 a7 29 8f 29 20 29 0b 29 0e 01 02 e4 e3 e1 01 01 01 00</STRONG></FONT></P></BLOCKQUOTE>
<P><FONT face=Tahoma>The two strings with SORT_STRINGSORT, Vista:</FONT></P>
<BLOCKQUOTE dir=ltr style="MARGIN-RIGHT: 0px">
<P><FONT face="Courier New" size=2><STRONG>29 0b 29 a7 29 8f 29 20 29 0b 29 0e 01&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 01 01 01 00<BR>29 0b 29 a7 29 8f 29 20 29 0b 29 0e 01 02 e4 e3 e1 01 01 01 00</STRONG></FONT></P></BLOCKQUOTE>
<P><FONT face=Tahoma>Summary -- these three different characters are now treated as diacritics or non-spacing marks, so that NORM_IGNORENONSPACE will give the appropriate behavior to ignore them, and both NORM_IGNORESYMBOLS and SORT_STRINGSORT&nbsp;will have no effect.</FONT></P>
<P><FONT face=Tahoma>Now of course you can use the new FindNLSString to get the right answer on Benjamin's original question (with the special bonus being that you can have the length of the string that was found (which will be a few characters different than the string that was being looked for!).</FONT></P>
<P><FONT face=Tahoma>If you need the answer in managed code, there are two possible answers:</FONT></P>
<UL>
<LI><FONT face=Tahoma>If there is a Windows-only culture that will give the same results, then you can create a new CompareInfo from that and then IndexOf will give the results from the new table;</FONT> 
<LI><FONT face=Tahoma>If you p/invoke to FindNLSString, then you can get the new table results for all cultures, with the aforementioned bonus of the found string length.</FONT></LI></UL>
<P><FONT face=Tahoma>But this was indeed an excellent question, and the kind of behavior that is good to dig into and explain from time to time, as the effort to improve linguistically appropriate results continues....</FONT></P>
<P><FONT face=Tahoma></FONT>&nbsp;</P>
<P><FONT face=Tahoma color=#ff1493><EM>This post brought to you by</EM> "&nbsp;Ÿê&nbsp;" <EM>(<A href="http://www.fileformat.info/info/unicode/char/0650">U+0650</A>, a.k.a. ARABIC KASRA)</EM></FONT></P>
<hr/><p><strong>Erika Qualls</strong> on 4 May 2011 8:02 AM:</p><div style="margin-left: 1em"><p>What do it really mean</p>
</div>
<hr/><p><em>referenced by</em></p><div style="margin-left: 1em"><p>2008/11/11 <a href="http://archives.miloush.net/michkap/archive/2008/11/11/9056745.html">Trying to ignore the small stuff is harder, if you're Arabic</a></p><p>2007/08/12 <a href="http://archives.miloush.net/michkap/archive/2007/08/12/4352905.html">Hello Madda, Hello Father (Iranian style)</a></p></div><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2006/05/25/607504.html" title="SQL Server&#39;s cross-version collation support">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2006/05/24/605599.html" title="Invariant vs. Ordinal, the third">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2006-05">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2006-05-24">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2006/05/24/605603.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:39 GMT -->
</html>