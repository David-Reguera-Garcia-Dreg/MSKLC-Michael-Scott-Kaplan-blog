<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2006/05/21/603374.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:39 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>SetLocaleInfo works without notification</title></head><body>
<h1>SetLocaleInfo works without notification</h1>
<p><em>by Michael S. Kaplan, published on 2006/05/21 15:41 -04:00, original URI: http://blogs.msdn.com/b/michkap/archive/2006/05/21/603374.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostNew -->
<P><FONT face=Tahoma>For pretty much its entire natural life, Regional and Language Options has passed a <A href="http://msdn.microsoft.com/library/en-us/sysinfo/base/wm_settingchange.asp">WM_SETTINGCHANGE</A> message with an LPARAM value pointing to the string "intl" -- though in earlier versions, it passed <A href="http://msdn.microsoft.com/library/en-us/sysinfo/base/wm_wininichange.asp">WM_WININICHANGE</A>, but astute header file readers who look at winuser.h will note the following definitions:</FONT></P>
<BLOCKQUOTE dir=ltr style="MARGIN-RIGHT: 0px">
<P><FONT face="Consolas,Courier New"><STRONG>#define WM_WININICHANGE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0x001A<BR>#if(WINVER &gt;= 0x0400)<BR>#define WM_SETTINGCHANGE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; WM_WININICHANGE<BR>#endif /* WINVER &gt;= 0x0400 */</STRONG></FONT></P></BLOCKQUOTE>
<P><FONT face=Tahoma>People will very naturally ask questions at this point when settings are changed, such as they are when <A href="http://msdn.microsoft.com/library/en-us/intl/nls_7w1b.asp">SetLocaleInfo</A> (<A HREF="http://archives.miloush.net/michkap/archive/2005/04/23/411074.html">which still stinks!</A>) is called:</FONT></P>
<BLOCKQUOTE dir=ltr style="MARGIN-RIGHT: 0px">
<P><FONT face="Times New Roman" size=2>Time displayed in the Task bar is not updated when LOCALE_STIMEFORMAT is updated via SetLocaleInfo.<BR><BR></FONT><FONT face="Times New Roman" size=2>Even though we're trying to discourage people from calling SetLocaleInfo, it still is a public API, and a user could change the time format in this manner. Not having the time updated seems like something we should fix.</FONT></P></BLOCKQUOTE>
<P><FONT face=Tahoma>Ah, but if you read the documentation for the <A href="http://msdn.microsoft.com/library/en-us/sysinfo/base/wm_settingchange.asp">WM_SETTINGCHANGE</A> message is explains who is not doing the right thing here:</FONT></P>
<BLOCKQUOTE dir=ltr style="MARGIN-RIGHT: 0px">
<BLOCKQUOTE dir=ltr style="MARGIN-RIGHT: 0px">
<P><FONT face=Tahoma><FONT size=2>Applications should send <B>WM_SETTINGCHANGE</B> to all top-level windows when they make changes to system parameters. (This message cannot be sent directly to a window.) To send the <B>WM_SETTINGCHANGE</B> message to all top-level windows, use the </FONT><A href="http://msdn.microsoft.com/library/en-us/winui/winui/windowsuserinterface/windowing/messagesandmessagequeues/messagesandmessagequeuesreference/messagesandmessagequeuesfunctions/sendmessagetimeout.asp"><B><FONT size=2>SendMessageTimeout</FONT></B></A><FONT size=2> function with the <I>hwnd</I> parameter set to HWND_BROADCAST.</FONT></FONT></P></BLOCKQUOTE></BLOCKQUOTE>
<P><FONT face=Tahoma>So, it is the job of the&nbsp;application&nbsp;that is calling the <A HREF="http://archives.miloush.net/michkap/archive/2005/04/23/411074.html">stinky</A>&nbsp;<A href="http://msdn.microsoft.com/library/en-us/intl/nls_7w1b.asp">SetLocaleInfo</A>&nbsp;to let the other applications know that an "intl" change has been made....</FONT></P>
<P><FONT face=Tahoma></FONT>&nbsp;</P>
<P><FONT face=Tahoma color=#ff1493><EM>This post brought to you by</EM> "<FONT size=8>à¿ˆ</FONT>"&nbsp;<EM>(<A href="http://www.fileformat.info/info/unicode/char/0fc8">U+0fc8</A>, a.k.a. TIBETAN SYMBOL PHUR PA)</EM></FONT></P>
<hr/><div style="margin-left: 1em"><em>no comments</em></div><hr/><p><em>referenced by</em></p><div style="margin-left: 1em"><p>2006/06/25 <a href="http://archives.miloush.net/michkap/archive/2006/06/25/646701.html">About the Fonts folder in Windows, Part 1 (aka What are we talking about?)</a></p><p>2006/05/30 <a href="http://archives.miloush.net/michkap/archive/2006/05/30/610505.html">Unattend for Regional and Language Options in Vista</a></p></div><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2006/05/21/603425.html" title="What&#39;s Next?">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2006/05/21/603288.html" title="Amount owed: $0.00">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2006-05">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2006-05-21">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2006/05/21/603374.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:39 GMT -->
</html>