<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2006/05/31/611340.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:39 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>Did he say shaping? It's not in the script!</title></head><body>
<h1>Did he say shaping? It's not in the script!</h1>
<p><em>by Michael S. Kaplan, published on 2006/05/31 04:01 -04:00, original URI: http://blogs.msdn.com/b/michkap/archive/2006/05/31/611340.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostNew -->
<P><FONT face=Tahoma>Back in early 2005 (in the post <STRONG><A href="http://archives.miloush.net/michkap/archive/2005/01/17/354279.html">Keeping it simple with complex scripts</A></STRONG>), I talked a little bit about the way that the Uniscribe documentation gave several examples of how complex script shaping rules would be used by giving examples with Latin script cursive writing.</FONT></P>
<P><FONT face=Tahoma>In retrospect this is kind of ironic, since Latin is not conventionally thought of as a 'complex script', certainly not when this documentation was written and to most people not even now.</FONT></P>
<P><EM><FONT face="Segoe Script,Tahoma">(most of what I talk about here applies in interesting ways to complex scripts in general)</FONT></EM></P>
<P><FONT face=Tahoma>It is a funny thing, but if you use a Latin script language like English and you read the language that someone wrote out using cursive writing, you do not give the subtle change in the differences in how many letters connect a second though. You just assume that these small differences exist, and have no problem reading it.</FONT></P>
<P><FONT face=Tahoma>And clearly the person writing has no trouble with these small difference</FONT></P>
<P><FONT face=Tahoma>Developing a font that uses cursive (basically a 'handwriting' font) is a bit more challenging.</FONT></P>
<P><FONT face=Tahoma>There is clearly no way, for example, to emulate the writer, who often needs to change the shape of the current letter based on the next letter. Because no rendering engine can read minds, the simple truth is that the initial form of the letter that is written may not match the final form once the next letter is typed -- unless you sacrifice the quality of what the final rendering will be by producing "position neutral cursive."</FONT></P>
<P><FONT face=Tahoma>Of course if you choose to sacrifice&nbsp;that quality, it affects the reader's experience.</FONT></P>
<P><FONT face=Tahoma>You could think of these two different methods, where one favors the writer by keeping the letters consistent and the other favors the reader by looking more like actual handwriting as a typography issue that lots of people don't really consider very often....</FONT></P>
<P><FONT face=Tahoma>In general the font has to choose one of these two approches.</FONT></P>
<P><FONT face=Tahoma>With that said, let's take a look at <FONT face="Segoe Script,Tahoma"><STRONG>Segoe Script</STRONG></FONT>, one of the new fonts that ships with Vista.</FONT></P>
<P><FONT face=Tahoma>Let's take a simple, common phrase that I am sure you find yourself using all the time, such as <STRONG>we welcome werewolves</STRONG>. Let's type it into Notepad on Vista. Every pharse starts with the first letter....</FONT></P>
<P><FONT face=Tahoma><IMG height=213 src="http://trigeminal.fmsinc.com/images/segoescript1.jpg" width=404></FONT></P>
<P><FONT face=Tahoma>Ok, simple enough. Now let's add that second letter -- note that the connection points between <STRONG>w</STRONG> and <STRONG>e</STRONG> are such that they should be at the midpoint of the letter, not the baseline. So we can watch the <STRONG>w</STRONG> glyph change:</FONT></P>
<P><FONT face=Tahoma><IMG src="http://trigeminal.fmsinc.com/images/segoescript2.jpg"></FONT></P>
<P><FONT face=Tahoma>Just like one might do in handwriting. Ok, we'll finish the sentence:</FONT></P>
<P><FONT face=Tahoma><IMG src="http://trigeminal.fmsinc.com/images/segoescript3.jpg"></FONT></P>
<P><FONT face=Tahoma>And there are a few other examples there with other letters, too. Ok, so clearly Segoe Script is one of those fonts that is better for the readers than the writers.</FONT></P>
<P><FONT face=Tahoma>Or is it?</FONT></P>
<P><FONT face=Tahoma>Let's do the same thing in Wordpad, which uses a RICHEDIT control rather than an EDIT control:</FONT></P>
<P><FONT face=Tahoma><IMG src="http://trigeminal.fmsinc.com/images/segoescript4.jpg"></FONT></P>
<P><FONT face=Tahoma>Hmmm... right out of the gate there is something different. I'm almost afraid to continue:</FONT></P>
<P><FONT face=Tahoma><IMG src="http://trigeminal.fmsinc.com/images/segoescript5.jpg"></FONT></P>
<P><FONT face=Tahoma>It looks the that <STRONG>w</STRONG> did not even blink! Let's look at the whole phrase:</FONT></P>
<P><IMG src="http://trigeminal.fmsinc.com/images/segoescript6.jpg"></P>
<P><FONT face=Tahoma>Clearly, our "reader" font has become a "writer" font. What happened?</FONT></P>
<P><FONT face=Tahoma>It get's worse, actually. Let's look at&nbsp;a small managed application that renders our phrase using four different techniques and the two different kinds of Edit controls:</FONT></P>
<P><IMG src="http://trigeminal.fmsinc.com/images/segoescript7.jpg"></P>
<P><FONT face=Tahoma>Suddenly everything looks more complicated than it did a moment ago, doesn't it? The EDIT control with <A href="http://msdn.microsoft.com/library/en-us/gdi/fontext_2ks4.asp">ExtTextOutW</A>&nbsp;betrays&nbsp;the pattern for the EDIT control, just the same kind of way that <A href="http://msdn.microsoft.com/library/en-us/gdi/fontext_001g.asp">TabbedTextOutW</A> does for RICHEDIT.</FONT></P>
<P><FONT face=Tahoma><STRONG>What is the underlying issue causing these seemingly pathologically diverse results?</STRONG></FONT></P>
<P><FONT face=Tahoma>Well, the issue is simple enough, and&nbsp;it is that Latin, unlike Arabic, Devanagrai, Tibetan, Sinhalese, and many others, is only sometimes considered to be a complex script. And by sometimes it is clear that I am saying in some code paths.</FONT></P>
<P><FONT face=Tahoma>Fun wrappers around text rendering like <A href="http://msdn.microsoft.com/library/en-us/intl/uniscrib_35k5.asp">Uniscribe</A>, <A href="http://msdn.microsoft.com/library/en-us/gdi/fontext_001g.asp">TabbedTextOutW</A>, and <A href="http://msdn.microsoft.com/library/en-us/gdi/fontext_4pbs.asp">DrawTextExW</A>, will end up being treated in XP SP2, Vista, and other recent platforms as a complex script, while both the simpler (e.g. <A href="http://msdn.microsoft.com/library/en-us/winui/winui/windowsuserinterface/windowing/windows/windowreference/windowfunctions/setwindowtext.asp">SetWindowTextW</A>) and lower level (e.g. <A href="http://msdn.microsoft.com/library/en-us/gdi/fontext_2ks4.asp">ExtTextOutW</A>) functions will treat it like it is not.</FONT></P>
<P><FONT face=Tahoma>And although <A href="http://msdn.microsoft.com/library/en-us/gdi/fontext_2ks4.asp">ExtTextOutW</A>&nbsp;has ETO_IGNORELANGUAGE, which is essentially an ETO_STOPTREATINGMELIKEIAMSOCOMPLEXYOUMISERABLECONTROLFREAK flag, it has no ETO_DONTIGNORELANGUAGE, which would be more of an ETO_IAMCOMPLEXHEARMEROARYOUMISERABLESIMPLETON kind of flag.</FONT></P>
<P><FONT face="Segoe Script,Tahoma">(Hard to believe that they don't have me authoring the names of more constants in the Platform SDK headers, isn't it?)</FONT></P>
<P><FONT face=Tahoma>So the behavior you get here will be very much dependent on what method you use to get the text drawn and what control you use.</FONT></P>
<P><FONT face=Tahoma>Unlike the situation in scripts that are pretty much always considered complex, which do not depend on the function called to know this extra work is needed....</FONT></P>
<P><FONT face=Tahoma>Of course treating Latin as a complex script was not done exlusively for the sake of cursive Latin fonts, it was instead done for the support so many African languages that need the text to be considered complex to get all of the right shaping for diacritics.</FONT></P>
<P><FONT face=Tahoma>Which means that the controls and functions that screw this up are being all that they can be for some languages, a topic I will talk about more another day.</FONT></P>
<P><FONT face=Tahoma>Another topic I'll hit on in a future post is some of the additional issues with cursive fonts.</FONT></P>
<P><FONT face="Segoe Script,Tahoma">(Special thanks to MVP 'Ted' for first pointing out this issue to me, and Peter Constable for his help in&nbsp;getting the understandable if not intuitive explanation together!)</FONT></P>
<P><FONT face=Tahoma></FONT>&nbsp;</P>
<P><FONT face=Tahoma color=#ff1493><EM>This post brought to you by</EM> <STRONG>w</STRONG> <EM>(<A href="http://www.fileformat.info/info/unicode/char/0077">U+0077</A>, a.k.a. LATIN SMALL LETTER W)</EM></FONT></P>
<hr/><p><a id="611492" href="#611492">#</a> <strong>SDiZ</strong> on 31 May 2006 5:02 AM:</p><div style="margin-left: 1em">Will shaping work with CJK vertical-writing-style?<br>Somthing simliar to this =&gt; <a rel="nofollow" target="_new" href="http://en.wikipedia.org/wiki/Cursive_script_(East_Asia)">http://en.wikipedia.org/wiki/Cursive_script_%28East_Asia%29</a></div>
<p><a id="611494" href="#611494">#</a> <strong>Phylyp</strong> on 31 May 2006 5:09 AM:</p><div style="margin-left: 1em">Wow, this is a really interesting post!</div>
<p><a id="611631" href="#611631">#</a> <strong>Michael S. Kaplan</strong> on 31 May 2006 10:22 AM:</p><div style="margin-left: 1em">Hi SDiZ -- Vertical text is indeed posible (not just for CJK but in Vista for Mongolian!), but I do not know of any Grass script fonts (MS does not ship any as far as I know). So you would probably have to find your own.....<br><br><br>Hi Phylyp -- thanks!</div>
<p><a id="613193" href="#613193">#</a> <strong>Ruben</strong> on 1 Jun 2006 2:53 PM:</p><div style="margin-left: 1em">Cool. But is it just me, or does Segoe Script look exceptionally ugly and hard to read, with letters jumping up and down like that?</div>
<p><a id="613929" href="#613929">#</a> <strong>Michael S. Kaplan</strong> on 2 Jun 2006 12:29 AM:</p><div style="margin-left: 1em">Hi Ruben,<br><br>You have clearly never seen my handwriting before if you think Segoe Script is hard to read. :-)</div>
<p><a id="614687" href="#614687">#</a> <strong>Ruben</strong> on 2 Jun 2006 5:12 PM:</p><div style="margin-left: 1em">Let's hope we're not going to see a Kaplan Script on Windows in the future then ;-)<br><br>But seriously, I think the offending script is a great showcase of OpenType features; it's an example to font designers as to what you can accomplish. Technically, that is. But by Bodoni, that's ugly. (Linotype's Zapfino, available on OSX, looks a lot better, BTW.)</div>
<p><a id="618491" href="#618491">#</a> <strong>Dean Harding</strong> on 5 Jun 2006 8:34 PM:</p><div style="margin-left: 1em">I don't think Zapfino has contextual shaping, though does it?</div>
<p><a id="619389" href="#619389">#</a> <strong>Ruben</strong> on 6 Jun 2006 4:16 PM:</p><div style="margin-left: 1em">OK, Zapfino doesn't have contextual features as far as I can see. I must have been confusing it with Zapfino Extra (<a rel="nofollow" target="_new" href="http://www.linotype.com/zapfino">http://www.linotype.com/zapfino</a>). Tr&#232;s cool.</div>
<p><a id="619440" href="#619440">#</a> <strong>Michael S. Kaplan</strong> on 6 Jun 2006 4:54 PM:</p><div style="margin-left: 1em">Bickham Script Pro also does this sort of thing, I believe....</div>
<p><a id="621065" href="#621065">#</a> <strong>Ruben</strong> on 7 Jun 2006 3:31 PM:</p><div style="margin-left: 1em">Now, if only GDI+ could be convinced to support OpenType fonts, we could actually use them under .NET! As luck would have it, GDI+/WinForms is firmly TrueType-only. Yet these fonts are Postscript based OpenType fonts. So WinForms bends over backwards to disallow these wondeful fonts.<br><br>[rant]Judging by the number of MS programs that refuse to support this type of fonts properly (or at all), MS must truly hate Adobe, even long before the Office 2007/PDF debacle. And chuckle over us poor souls buying into the OpenType propaganda. The only places where you'll find real support for OpenType is in Adobe programs and on Apple's OSX. Office 2007 STILL doesn't support OpenType fully![/rant]<br><br>Oh well, gonna have to wait for WPF then...</div>
<p><a id="621093" href="#621093">#</a> <strong>Michael S. Kaplan</strong> on 7 Jun 2006 4:06 PM:</p><div style="margin-left: 1em">Hi Ruben,<br><br>Sorry, I am not going to swing at a pitch in the dirt like this one.<br><br>But if you think that GDI+ does not support many of the various language/script tables defined in OpenType, then you don't know as much about GDI+ as you think....<br><br>No one hates anyone on this blog though. If you want to discuss that sort of thing you may want to find a different place to hold such a discussion. :-)</div>
<p><a id="622724" href="#622724">#</a> <strong>Ruben</strong> on 8 Jun 2006 3:42 PM:</p><div style="margin-left: 1em">This is getting waaay off topic, but GDI+ really doesn't support OpenType. (According to my defintion of 'support', that is.) So maybe MS doesn't hate Adobe. Sorry about the wording--as you can see, I'm slightly passionate about this subject. <br><br>Sure, it partially supports some predefined tables. Ha!<br><br>One of the crucial parts of the OpenType specification is the dual outline format: TrueType vs. CFF/PostScript. The Bickham Script you mentioned is a CFF/PostScript based OpenType font. And GDI+ really won't allow such fonts. If you try to access such a font by name, you'll get Microsoft Sans Serif (System.Drawing.Font does that anyway). And if you try to load the .otf file, you'll get a file not found exception under .NET (that's right: file not found, not even file not supported). WinForms even goes so far as to disallow installed OpenType and Type 1 fonts, even when using GDI for rendering!<br><br>Another selling point of OpenType is the availability of optional tables for advanced typography, such as small caps, all caps, swash, oldstyle figures, discretionary ligatures, etc. (like the Cleartype fonts or Palatino Linotype have). Not a single MS product or platform apart from WPF supports this. And if you can't/won't use WPF, you'll need to mess around with Uniscribe yourself, if I'm correct, because neither GDI nor GDI+ support this.<br><br>So, from the OpenType specs, the following is not supported by GDI+:<br><br>- CFF outlines (80% of all OpenType fonts, not counting the oldstyle TrueType fonts you can buy everywhere at $1.99 that don't even support Latin 1 fully)<br>- selection of active features (aka tables)<br>- kerning (TrueType or OpenType style)<br><br>which pretty much leaves us with TrueType + (some) advanced script support, at best. But that's not OpenType support by a long shot.<br><br>So, as far as full blown OpenType typography support on Windows: it's going to be a loooong wait. Even though it's been six years after the introduction of OpenType.</div>
<p><a id="622727" href="#622727">#</a> <strong>Michael S. Kaplan</strong> on 8 Jun 2006 3:47 PM:</p><div style="margin-left: 1em">Well, on an internationalization blog such as this one, it is easy and consistent to define OpenType support along the lines of the language/script support that exists -- and while GDI+ does not support as much as Vista or XPSP2 GDI/Uniscribe, it does support a great deal here.<br><br>But yes, this is incredibly off topic.... :-)</div>
<p><a id="624147" href="#624147">#</a> <strong>Ted.</strong> on 9 Jun 2006 2:30 PM:</p><div style="margin-left: 1em">Thanks for this - I want to address two points: SetWindowTextW is not a text rendering function, it simply sets the internal text buffer to the text you pass it. &nbsp;Some other API is still responsible for rendering the text to screen (whatever the control happens to be using internally). &nbsp;<br><br>Second, you mentioned that ExtTextOut has no ETO_DONTIGNORELANGUAGE, but how about if it did? How likely would it be for something like that to be added to Vista? &nbsp;It seems to be that would be the ideal solution, i.e. allow an app to force it to assume complex all the time. &nbsp;I guess another would be to change over to TabbedTextOut (using a preprocessor macro remapping ExtTextOut to TabbedTextOut). &nbsp;Other than that, what's your solution (i.e. shouldn't you get the Word 2007 guys to at least fix it!)</div>
<hr/><p><em>referenced by</em></p><div style="margin-left: 1em"><p>2009/06/09 <a href="http://archives.miloush.net/michkap/archive/2009/06/09/9712595.html">When keeping things on a level Plane[ 1] doesn't work anymore</a></p><p>2008/07/26 <a href="http://archives.miloush.net/michkap/archive/2008/07/26/8773862.html">When the lines get too complex, the characters may go off script</a></p><p>2007/03/13 <a href="http://archives.miloush.net/michkap/archive/2007/03/13/1871045.html">We need to be optimizing for more than just the simple cases</a></p><p>2006/08/11 <a href="http://archives.miloush.net/michkap/archive/2006/08/11/695147.html">Are ligatures supposed to be thought of as 'single characters' ?</a></p><p>2006/07/10 <a href="http://archives.miloush.net/michkap/archive/2006/07/10/661427.html">The PUA isn't complex enough</a></p><p>2006/06/29 <a href="http://archives.miloush.net/michkap/archive/2006/06/29/650680.html">Working beyond the BMP is going off script (according to GDI)</a></p><p>2006/06/16 <a href="http://archives.miloush.net/michkap/archive/2006/06/16/634291.html">Microsoft *does* support OpenType!</a></p><p>2006/06/16 <a href="http://archives.miloush.net/michkap/archive/2006/06/16/634124.html">Neither GDI nor Uniscribe solve the ultimate font problem completely, either</a></p></div><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2006/05/31/611648.html" title="Beware of the whining!">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2006/05/30/610889.html" title="Avoiding SQL Server collation woes in the TempDB">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2006-05">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2006-05-31">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2006/05/31/611340.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:39 GMT -->
</html>