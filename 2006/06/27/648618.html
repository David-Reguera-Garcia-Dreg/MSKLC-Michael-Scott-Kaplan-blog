<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2006/06/27/648618.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:39 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>Keyboards under LUA</title></head><body>
<h1>Keyboards under LUA</h1>
<p><em>by Michael S. Kaplan, published on 2006/06/27 12:13 -04:00, original URI: http://blogs.msdn.com/b/michkap/archive/2006/06/27/648618.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostNew -->
<P><FONT face=Tahoma>People have been noticing that attempting install an <A href="http://www.microsoft.com/globaldev/tools/msklc.mspx">MSKLC</A>-generated keyboard layout on Vista has some problems. Say you take your handy dandy custom Bulgarian keyboard created by <A href="http://www.microsoft.com/globaldev/tools/msklc.mspx">MSKLC</A>:</FONT></P>
<P><FONT face=Tahoma><IMG src="http://trigeminal.fmsinc.com/images/msklclua0.jpg"></FONT></P>
<P><FONT face=Tahoma>You try to double click on the Bulg.msi file, and you may or may not get the LUA dialog:</FONT></P>
<P><IMG src="http://trigeminal.fmsinc.com/images/msklclua1.jpg"></P>
<P><FONT face=Tahoma>However, whether you get it or not, and no matter which option you choose if you do, the final result is unfortunately the same. :-(</FONT></P>
<P><FONT face=Tahoma><IMG src="http://trigeminal.fmsinc.com/images/msklclua2.jpg"></FONT></P>
<P><FONT face=Tahoma>Now&nbsp;it may or may not be a bug that if you are running a recent enough build to get the LUA dialog that clicking "Allow" doesn't allow the install to proceed. We'll figure that out later.</FONT></P>
<P><FONT face=Tahoma>For now, the easy workaround!</FONT></P>
<P><FONT face=Tahoma>Just run from an elevated command prompt, by right clicking on the Comand Prompt option on the Start Menu and choosing to <STRONG>Run as administrator</STRONG>:</FONT></P>
<P><FONT face=Tahoma><IMG src="http://trigeminal.fmsinc.com/images/msklclua3.jpg"></FONT></P>
<P><FONT face=Tahoma>After saying <STRONG>Continue</STRONG> when that User Account Control dialog comes up:</FONT></P>
<P><IMG src="http://trigeminal.fmsinc.com/images/msklclua4.jpg"></P>
<P><FONT face=Tahoma>you will then have a command prompt that you can run Bulg.msi from, and it will install just fine!</FONT></P>
<P><FONT face=Tahoma><IMG src="http://trigeminal.fmsinc.com/images/msklclua5.jpg"></FONT></P>
<P><FONT face=Tahoma>Don't you love happy endings?</FONT></P>
<P><FONT face=Tahoma>Now LUA (Least-privileged User Account) or UAC (User Account Control) is serving an important purpose here -- to make sure that you are okay with the changes this installer tries to make to your system -- a file in your system32 directory, and registry keys under KEY_LOCAL_MACHINE. So it is a pretty invasive little bugger, an MSKLC generated&nbsp;keyboard layout install. The key is making sure that you give it the right permissions to get its work done. :-)</FONT></P>
<P><FONT face=Tahoma>Now the other question, the one I tabled earlier -- whether, if you say "Allow" to a LUA dialog should it still fail? I assume this would be a bug (the same thing happens if I run <STRONG>msiexec /i Bulg.msi</STRONG> from an unelevated command prompt). Probably someone ought to fix that. :-)</FONT></P>
<P><FONT face=Tahoma></FONT>&nbsp;</P>
<P><FONT face=Tahoma color=#ff1493><EM>This post brought to you by</EM> <STRONG><FONT size=6>K</FONT></STRONG> <EM>(<A href="http://www.fileformat.info/info/unicode/char/004b">U+004b</A>, a.k.a. LATIN CAPITAL LETTER K)</EM></FONT></P>
<hr/><p><a id="648695" href="#648695">#</a> <strong>Heath Stewart</strong> on 27 Jun 2006 1:30 PM:</p><div style="margin-left: 1em">It's because your custom action (CA) is impersonating the invoking user, which is the default behavior unless you OR msidbCustomActionTypeNoImpersonate (0x0800) with the Attributes column in the CustomAction table. So, the CA will run with permissions of the non-elevated user which won't be able to write to locations that the RegisterKeyboard.E22081490D44493C878A575C57EFDC36 CA will attempt to do.<br><br>In fact, those custom actions should be deferred and should have corresponding commit (if necessary - probably not) and rollback CAs if they fail. Immediate custom actions should never modify machine state because they can't undo changes if an error occurs during the deferred installation (where machine state is supposed to be changed).<br><br>In fact, your MSI generation doesn't output the _Validation table and doesn't set the Template summary property to the correct language corresponding to the ProductLanguage property in the Property table. You should run ICE Validation (in Orca, from the Tools-&gt;Validate menu).</div>
<p><a id="648733" href="#648733">#</a> <strong>Michael S. Kaplan</strong> on 27 Jun 2006 2:14 PM:</p><div style="margin-left: 1em">Hi Heath, <br><br>Ok, this is very good info. And the bug is definitely back on the MSKLC-generated install package, not on Vista. <br><br>Stuff to change for next version.... is there an OpenLanguage PM reading comments here? :-)<br><br>Thanks!</div>
<p><a id="8579116" href="#8579116">#</a> <strong>Philip Tagg</strong> on 6 Jun 2008 6:50 PM:</p><div style="margin-left: 1em"><P>Instructions for installing MSKLC-generated keyboards in Vista very clear and useful. Sincere thanks! </P>
<P>Want an .msi to run English, French, Italian, German, Danish, Swedish, Spanish and Portuguesewithout changing layout? Didn't think so: go to <A href="http://tagg.org/zmisc/KbdPT01.htm" target=_new rel=nofollow>http://tagg.org/zmisc/KbdPT01.htm</A>... </P></div>
<p><a id="8592598" href="#8592598">#</a> <strong>Philip Tagg</strong> on 12 Jun 2008 12:16 AM:</p><div style="margin-left: 1em"><P>Thanks again for this. I have to write stuff in English, French, Swedish and Italian, so the DOS "Run as administrator" work-around was great. Now I can do </P>
<BLOCKQUOTE>
<P>~` !1 @2 #3 $4 %5 ^6 &amp;7 *8 (9)0 _- += Qq Ww Rr Tt Yy Uu Ii Oo Pp {[ }] Aa Ss Dd Ff Gg Hh Jj Kk Ll :; "' Zz Xx Cc Vv Bb Nn Mm &lt;, &gt;. ?/ plus Á À Â Ã Å Ä Æ Ç Ð É È Ê Ë Í Ì Î Ï Ñ Ó Ò Ô Õ Ö Ø Œ Š Þ Ú Ù Û Ü Ý &nbsp;á à â ã å ä æ ç ð &nbsp;é è ê ë í ì î ï &nbsp;ñ ó ò ô õ ö ø œ &nbsp;ß š þ ú ù û ü ý ÿ ¡ ¿ ‘ ’ “ ” « » &nbsp;… ¹ ² ³ ¼ ½ ¾ ‰ ° ª ¶ § † ‡ ¬ </P></BLOCKQUOTE>
<P>without having to change keyboard layout. The *.msi download is at <A href="http://tagg.org/zmisc/KbdPT01.htm" target=_new rel=nofollow>http://tagg.org/zmisc/KbdPT01.htm</A> for the amusement of any other insane scribal polyglot.</P></div>
<hr/><p><em>referenced by</em></p><div style="margin-left: 1em"><p>2007/01/30 <a href="http://archives.miloush.net/michkap/archive/2007/01/30/1557184.html">Not the coolest, but</a></p><p>2006/12/22 <a href="http://archives.miloush.net/michkap/archive/2006/12/22/1349745.html">Thumb twiddling?</a></p><p>2006/11/30 <a href="http://archives.miloush.net/michkap/archive/2006/11/30/1179268.html">Keyboards under LUA (the MSKLC 1.3 workaround!)</a></p><p>2006/11/22 <a href="http://archives.miloush.net/michkap/archive/2006/11/22/1121257.html">That problem with MSKLC created layouts and Vista, again</a></p><p>2006/11/17 <a href="http://archives.miloush.net/michkap/archive/2006/11/17/1097666.html">What happened on Thursday morning?</a></p><p>2006/10/17 <a href="http://archives.miloush.net/michkap/archive/2006/10/17/834208.html">The version of App Locale that runs on Vista?</a></p><p>2006/09/13 <a href="http://archives.miloush.net/michkap/archive/2006/09/13/752086.html">MSKLC and Vista? MSKLC and 64-bit? Darn, we're 0 for 2....</a></p><p>2006/06/27 <a href="http://archives.miloush.net/michkap/archive/2006/06/27/648723.html">MSKLC under Vista (or MSKLC under .NET 2.0)</a></p></div><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2006/06/27/648723.html" title="MSKLC under Vista (or MSKLC under .NET 2.0)">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2006/06/27/648333.html" title="I Tswana know what you&#39;re thinking">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2006-06">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2006-06-27">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2006/06/27/648618.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:39 GMT -->
</html>