<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2006/06/28/649791.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:39 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>WYSIWYG font dropdowns</title></head><body>
<h1>WYSIWYG font dropdowns</h1>
<p><em>by Michael S. Kaplan, published on 2006/06/28 12:18 -04:00, original URI: http://blogs.msdn.com/b/michkap/archive/2006/06/28/649791.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostNew -->
<P><FONT face=Tahoma>So, the question that Bill asked was clear:</FONT></P>
<BLOCKQUOTE dir=ltr style="MARGIN-RIGHT: 0px">
<P><FONT face="Times New Roman" size=2>I have a WYSIWYG font dropdown in my toolbar. Some international fonts (like Estrangelo Edessa) show up as squares, apparently because they don’t support all Unicode ranges. I need to detect these fonts and display them in the WYSIWYG list using Tahoma (like Office does). What’s the best solution? <BR><BR></FONT><FONT size=2>My app is a managed app but I’m assuming I’ll need to use native interop to solve this problem.<BR><BR></FONT><FONT size=2>Thanks,<BR><BR>Bill</FONT></P></BLOCKQUOTE>
<P><FONT face=Tahoma>The list he is referring to is like the one you see in Word's font dropdown:</FONT></P>
<P><FONT face=Tahoma><IMG height=428 src="http://trigeminal.fmsinc.com/images/WordFontList.jpg" width=963></FONT></P>
<P><FONT face=Tahoma>Or&nbsp; even in Outlook's mail message dropdown:</FONT></P>
<P><IMG src="http://trigeminal.fmsinc.com/images/MailDropDown.jpg"></P>
<P><FONT face=Tahoma>So, the real question here is even simpler: "How can one determine if a font supports the characters in a string?"</FONT></P>
<P><FONT face=Tahoma>The easiest way is via the <A href="http://msdn.microsoft.com/library/en-us/gdi/fontext_4svn.asp">GetGlyphIndices</A> function, which has in the initial description:</FONT></P>
<BLOCKQUOTE dir=ltr style="MARGIN-RIGHT: 0px">
<P><FONT face=Tahoma size=2>The <STRONG>GetGlyphIndices</STRONG> function translates a string into an array of glyph indices. The function can be used to determine whether a glyph exists in a font.</FONT></P></BLOCKQUOTE>
<P><FONT face=Tahoma>So you can pass the name you were going to use to the function (making sure to pass the GGI_MARK_NONEXISTING_GLYPHS flag), and then look at the glyph indices for the 0xffff marker.</FONT></P>
<P><FONT face=Tahoma>If it shows up for any of the characters, then you know you should use some other font.</FONT></P>
<P><FONT face=Tahoma>Now the Office dropdown has a few more tricks up its sleeve that I scrolled to avoid, so I should probably mention them now....</FONT></P>
<P><FONT face=Tahoma>If you look, some of the fonts have some additional stuff next to the names:</FONT></P>
<P><IMG src="http://trigeminal.fmsinc.com/images/MailDropDown2.jpg"></P>
<P><FONT face=Tahoma>All of the Hebrew fonts have the first eight letters of the Hebrew alphabet (<A href="http://www.fileformat.info/info/unicode/char/05d0">U+05d0</A> to <A href="http://www.fileformat.info/info/unicode/char/05d7">U+05d7</A>), and all of the symbol fonts have a sampling of the symbols. And this extra feature is done even when there is a fallback done for the font name itself (due to the&nbsp;letters in the name not being supported).</FONT></P>
<P><FONT face=Tahoma>Incidentally, Arabic fonts do the same sort of thing that the Hebrew fonts do....</FONT></P>
<P><FONT face=Tahoma>Now it is easy enough to detect a symbol font, but figuring out that a font is specifically a Hebrew or an Arabic&nbsp;font (e.g. Miriam Fixed or Arabic Transparent) rather than just a font that contains Hebrew or Arabic (e.g. Arial Unicode MS) is a bit more complicated.</FONT></P>
<P><FONT face=Tahoma>I have no idea how they actually do it -- perhaps they are calling the&nbsp;<A href="http://msdn.microsoft.com/library/en-us/gdi/fontext_2alv.asp">GetFontUnicodeRanges</A> function, perhaps they are grabbing the <A href="http://msdn.microsoft.com/library/en-us/intl/unicode_3h0y.asp">FONTSIGNATURE</A>-like info that is inside the font and using it to find out. Though of course this is the kind of feature that one could quickly go wild with in showing the characters of many different language-specific fonts, from Tibetan to Sinhalese.</FONT></P>
<P><FONT face=Tahoma>Paradoxically,&nbsp;the only "boring" fonts on the list would be ones that support multiple scripts!</FONT></P>
<P><FONT face=Tahoma>At some point, there are also performance concerns, plus there are people who find the list somewhat visually distracting (not to mention the list as it exists in Word has an obvious bias for the myriad of ways one might display the&nbsp;Latin script!)....</FONT></P>
<P><FONT face=Tahoma></FONT>&nbsp;</P>
<P><FONT face=Tahoma color=#ff1493><EM>This post brought to you by</EM>&nbsp;<STRONG><FONT size=6>ܨ</FONT></STRONG> <EM>(<A href="http://www.fileformat.info/info/unicode/char/0728">U+0728</A>, a.k.a. SYRIAC LETTER SADHE)<BR><FONT size=1>(A character that is well-supported by Estrangelo Edessa!)</FONT></EM></FONT></P>
<hr/><p><a id="649868" href="#649868">#</a> <strong>Mihai</strong> on 28 Jun 2006 1:43 PM:</p><div style="margin-left: 1em">But you should be aware of the limitations<br><br>- GetFontUnicodeRanges and FONTSIGNATURE-gives generic blocks that are supported, but does not mean all the characters in the block are supported (&quot;granularity&quot;). So you might still get rectangles.<br>Plus this is info set by the font creator, and might match or not the reality<br><br>- GetGlyphIndices does not handle chars outside BMP (true in XP SP2 and an older Vista build)<br><br>Depending on what is needed, one of the solutions might be good enough. If not, one can always directly parse the cmap table of the font.<br></div>
<p><a id="649881" href="#649881">#</a> <strong>Michael S. Kaplan</strong> on 28 Jun 2006 2:00 PM:</p><div style="margin-left: 1em">Ah, but you still have to do the other work, I was just answering the &quot;how can you tell a ____ font from a font that happens to support ____&quot; question. :-)</div>
<p><a id="650092" href="#650092">#</a> <strong>Sebastian</strong> on 28 Jun 2006 5:30 PM:</p><div style="margin-left: 1em">The callback function EnumFontFamExProc from EnumFontFamiliesEx tells you the charset of a Font. So you can easily find out if a font is hebrew or arabic.<br><br>function EnumFontFamExProc(<br> &nbsp;const AEnumLogFontEx: TEnumLogFontEx; &nbsp; &nbsp; &nbsp; &nbsp;// logical-font data<br> &nbsp;const ATextMetricEx : TTextMetric; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // physical-font data<br> &nbsp;FontType: DWORD; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // type of font<br> &nbsp;FontCombo: TFontComboBox): Integer; stdcall; // application-defined data<br>begin<br> &nbsp;//...<br> &nbsp;if (AEnumLogFontEx.elfLogFont.lfCharSet = HEBREW_CHARSET) or<br> &nbsp; &nbsp; &nbsp; &nbsp;(AEnumLogFontEx.elfLogFont.lfCharSet = ARABIC_CHARSET) then<br> &nbsp; &nbsp; &nbsp; &nbsp;begin<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;// Hebrew or Arabic Font<br> &nbsp; &nbsp; &nbsp; &nbsp;end;<br>end;<br></div>
<p><a id="650115" href="#650115">#</a> <strong>Michael S. Kaplan</strong> on 28 Jun 2006 5:58 PM:</p><div style="margin-left: 1em">Hi Sebatsian,<br><br>Yes, but doesn't a font that claims to support multiple scripts show up for more than one of these? I mean, if you enumerate all of the Arabic fonts, won't Tahoma, Microsoft Sans Serif, and Arial Unicode MS all be there, since they all claim to support Arabic?</div>
<p><a id="650255" href="#650255">#</a> <strong>Daniel Yacob</strong> on 28 Jun 2006 8:10 PM:</p><div style="margin-left: 1em">Perhaps the in-script example text should be put into locale data?<br><br>While speaking of font menus... I've always wished that in the &quot;Windows\Fonts&quot; folders we would add sub-folders to organize our fonts, which would then map to step-out sub-menus in the font dropdowns. This should be really useful when you have hundreds of fonts, saves scrolling...<br><br>The &quot;Start&quot; menu has a similar relationship with the file system. &nbsp;I'm certain this isn't a new idea, has this been tried at MS before and been deemed not not viable? Why?</div>
<p><a id="650377" href="#650377">#</a> <strong>Michael S. Kaplan</strong> on 28 Jun 2006 10:37 PM:</p><div style="margin-left: 1em">Hey Daniel! <br><br>That is an interesting idea... even better if it had wider usage than just fonts. People have talked a lot lately about exemplar characters; is there another usage for sample exemplar characters?<br><br>The submenu idea is tougher since the mechanisms for enumeration are not as clear, and probably would not be backward compatible. And for the average user it would be too complicated to even use, even ignoring the difficulty on the developer side....<br><br>The older start menu has had lots of usability problems (the Vista version has gotten some better usability feedback). The key would be deciding how to make that apply to fonts, perhaps?</div>
<p><a id="654703" href="#654703">#</a> <strong>Aaron Ballman</strong> on 2 Jul 2006 5:56 PM:</p><div style="margin-left: 1em">For determining whether the font is a symbol font or not, would it make sense to look at the PANTOSE numbers using GetOutlineTextMetrics? &nbsp;If the bFamilyType is PAN_FAMILY_PICTORIAL, that would mean it's a symbol font, correct?</div>
<p><a id="654760" href="#654760">#</a> <strong>Michael S. Kaplan</strong> on 2 Jul 2006 8:25 PM:</p><div style="margin-left: 1em">Hi Aaron, <BR><BR>I think that a PANOSE family type of PAN_FAMILY_PICTORIAL is the easiest way, but I am not 100% sure that all fonts follow the convention. It may also be worthwhile to look at other secondary indications to verify, like the exclusive use of the particular piece of the PUA that symbol fonts use, just to be sure?</div>
<p><a id="654781" href="#654781">#</a> <strong>Aaron Ballman</strong> on 2 Jul 2006 8:57 PM:</p><div style="margin-left: 1em">I'm not certain I'm familiar of how to get that secondary information. &nbsp;By the looks of things, you're right that not all fonts follow the convention. &nbsp;For instance, the Symbol font is correct, but Marlett returns PAN_ANY instead of PAN_FAMILY_PICTORIAL.<br><br>What would be a good alternative to double-check?</div>
<p><a id="654899" href="#654899">#</a> <strong>Michael S. Kaplan</strong> on 2 Jul 2006 11:24 PM:</p><div style="margin-left: 1em">Well, there is the GetGlyphIndices function that the post talks about that you can use to see if the font supports a given character? In this case you are looking at that symbol range....</div>
<p><a id="655023" href="#655023">#</a> <strong>Aaron Ballman</strong> on 3 Jul 2006 2:09 AM:</p><div style="margin-left: 1em">True -- that's what I'm using to tell whether the text can be displayed with the given font. &nbsp;Now I'm just trying to mimic the symbol font behavior you described later in your post.<br><br>Another way which may work is to use GetTextCharset API and check the return value to see if it's SYMBOL_CHARSET. &nbsp;Or do you think that falls prey to the same problem as the PANTOSE attempt?<br><br>Thanks for the information!</div>
<hr/><p><em>referenced by</em></p><div style="margin-left: 1em"><p>2007/12/16 <a href="http://archives.miloush.net/michkap/archive/2007/12/16/6780417.html">How best to keep the font switcheroo from happening?</a></p><p>2006/06/29 <a href="http://archives.miloush.net/michkap/archive/2006/06/29/650680.html">Working beyond the BMP is going off script (according to GDI)</a></p></div><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2006/06/29/650680.html" title="Working beyond the BMP is going off script (according to GDI)">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2006/06/28/648940.html" title="Every character has a story #21: U+0f77 U+0f79 (TIBETAN VOWEL SIGN VOCALIC [RR|LL])">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2006-06">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2006-06-28">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2006/06/28/649791.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:39 GMT -->
</html>