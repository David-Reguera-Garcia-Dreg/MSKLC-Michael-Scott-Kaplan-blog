<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2006/06/14/631016.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:39 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>Behind 'How to break Windows Notepad'</title></head><body>
<h1>Behind 'How to break Windows Notepad'</h1>
<p><em>by Michael S. Kaplan, published on 2006/06/14 11:47 -04:00, original URI: http://blogs.msdn.com/b/michkap/archive/2006/06/14/631016.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostNew -->
<P><FONT face=Tahoma><A href="http://blogs.msdn.com/LarryOsterman/">Larry Osterman</A> pointed me at an article entitled <A href="http://www.wincustomize.com/articles.aspx?aid=117870&amp;c=1">How to break Windows Notepad</A> that makes for an interesting experiment:</FONT></P>
<BLOCKQUOTE dir=ltr style="MARGIN-RIGHT: 0px">
<P><FONT face=Arial size=2>Here's how to do it:<BR>1. Open up Notepad (not Wordpad, not Word or any other </FONT><FONT face=Arial size=2>word processor</FONT><FONT face=Arial size=2>)<BR>2. Type in this sentence exactly (without quotes): "this app can break"<BR>3. Save the file to your </FONT><FONT face=Arial size=2>hard drive</FONT><FONT face=Arial size=2>.<BR>4. Close Notepad<BR>5. Open the saved file by double clicking it.<BR><BR>Instead of seeing your sentence, you should see a series of squares. For whatever reason, Notepad can't figure out what to do with that series of characters and breaks</FONT></P></BLOCKQUOTE>
<P><FONT face=Tahoma>Now if you have East Asian language support installed, instead of seeing squares (NULL glyphs), you will see:</FONT></P>
<BLOCKQUOTE dir=ltr style="MARGIN-RIGHT: 0px">
<P><FONT face=Tahoma size=6>桴獩愠灰挠湡戠敲歡</FONT></P></BLOCKQUOTE>
<P><FONT face=Tahoma>An if you look at the&nbsp;code points&nbsp;under those characters, you will likely see what happened:</FONT></P>
<BLOCKQUOTE dir=ltr style="MARGIN-RIGHT: 0px">
<P><FONT face=Tahoma><A href="http://www.fileformat.info/info/unicode/char/6874">6874</A> <A href="http://www.fileformat.info/info/unicode/char/7369">7369</A> <A href="http://www.fileformat.info/info/unicode/char/6120">6120</A> <A href="http://www.fileformat.info/info/unicode/char/7070">7070</A> <A href="http://www.fileformat.info/info/unicode/char/6320">6320</A> <A href="http://www.fileformat.info/info/unicode/char/6e61">6e61</A> <A href="http://www.fileformat.info/info/unicode/char/6220">6220</A> <A href="http://www.fileformat.info/info/unicode/char/6572">6572</A> <A href="http://www.fileformat.info/info/unicode/char/6b61">6b61</A></FONT></P></BLOCKQUOTE>
<P><FONT face=Tahoma>Ah, each byte is a letter that when combined just so happens to line up with a CJK ideograph!</FONT></P>
<P><FONT face=Tahoma>I have talked about the encoding detection mechanisms that notepad uses <A href="http://archives.miloush.net/michkap/archive/2006/05/27/608351.html">recently</A>, and this is another example of the problem, one that is more fun since the repro steps are so much fun (in fact the only improvement would be text insulting Microsoft or one of its rivals, which notepad appears to censor in an example of a big bad monopoly, etc.!).</FONT></P>
<P><FONT face=Tahoma>Now I have pointed out that&nbsp;I do not like the IsTextUnicode function <A href="http://archives.miloush.net/michkap/archive/2005/01/30/363308.html"><STRONG>in the past</STRONG></A>, and I suppose this could be considered a good reason (<A href="http://msdn.microsoft.com/library/en-us/intl/unicode_81np.asp">IsTextUnicode</A> returns TRUE here, which is why Notepad guesses as it does).</FONT></P>
<P><FONT face=Tahoma></FONT>&nbsp;</P>
<P><FONT face=Tahoma color=#ff1493><EM>This post brought to you by</EM> <FONT size=6><STRONG>桴</STRONG></FONT> <EM>(<A href="http://www.fileformat.info/info/unicode/char/6874">U+6874</A>, a CJK ideograph)</EM></FONT></P>
<hr/><p><a id="631043" href="#631043">#</a> <strong>TP</strong> on 14 Jun 2006 12:07 PM:</p><div style="margin-left: 1em">Cool post man. I like it...</div>
<p><a id="631087" href="#631087">#</a> <strong>Lionel Fourquaux</strong> on 14 Jun 2006 12:47 PM:</p><div style="margin-left: 1em">Maybe Notepad should offer an option to bypass encoding detection?</div>
<p><a id="631280" href="#631280">#</a> <strong>Maurits</strong> on 14 Jun 2006 3:30 PM:</p><div style="margin-left: 1em">select cast(0x687473696120707063206e61622065726b61 as varchar)<br><br>htsia ppc nab erka<br></div>
<p><a id="631282" href="#631282">#</a> <strong>Maurits</strong> on 14 Jun 2006 3:34 PM:</p><div style="margin-left: 1em">Note that the lengths of the words are reversed:<br><br>Original: 4 3 3 5<br>Changed: 5 3 3 4<br><br>Ignoring spaces, note that the characters within each word are scrambled, but the order of the words themselves remain the same<br><br>thisappcanbreak<br>htsiappcnaberka<br><br>A question to ponder... did the two &quot;p&quot;s switch places?</div>
<p><a id="631298" href="#631298">#</a> <strong>Michael S. Kaplan</strong> on 14 Jun 2006 3:47 PM:</p><div style="margin-left: 1em">That's just endian-ness, I have talked about that before. :-)</div>
<p><a id="631301" href="#631301">#</a> <strong>Michael S. Kaplan</strong> on 14 Jun 2006 3:49 PM:</p><div style="margin-left: 1em">Hi Lionel -- well, I'd personally prefer if they added &quot;BOM-free UTF-8 supoort&quot; as a save option prior to &quot;no detection&quot; as a load option. :-)</div>
<p><a id="631305" href="#631305">#</a> <strong>Maurits [MSFT]</strong> on 14 Jun 2006 3:52 PM:</p><div style="margin-left: 1em">&gt; did the two &quot;ps&quot; switch places?<br><br>Yup, I think they did. &nbsp;The scrambling is simple:<br><br>Scramble each word individually<br><br>To scramble a word, start at the end.<br>Switch the last two letters of the word.<br>Switch the previous two letters of the word.<br>Keep switching letter pairs until you have either scrambled the whole word (if there were an even number of letters) or there's a single letter left.</div>
<p><a id="631309" href="#631309">#</a> <strong>Maurits [MSFT]</strong> on 14 Jun 2006 3:54 PM:</p><div style="margin-left: 1em">&gt; That's just endian-ness<br><br>Oh, duh.<br><br>Switch byte-pairs:<br><br>select cast(0x74686973206170702063616e20627265616b as varchar(20))<br><br>this app can break<br></div>
<p><a id="631321" href="#631321">#</a> <strong>Maurits [MSFT]</strong> on 14 Jun 2006 4:04 PM:</p><div style="margin-left: 1em">This still leaves open the question of why IsTextUnicode(&quot;this app can break&quot;) == TRUE -- looks like ASCII to me. &nbsp;Maybe some of the component tests will reveal a clue.</div>
<p><a id="631389" href="#631389">#</a> <strong>Maurits [MSFT]</strong> on 14 Jun 2006 5:12 PM:</p><div style="margin-left: 1em">Huh... I don't have a IS_TEXT_UNICODE_BUFFER_TOO_SMALL test on my W2K system. &nbsp;Do I have to include something special to get it? &nbsp;I've got all the others.<br><br>Barring that, the only tests that fire for that string are:<br>IS_TEXT_UNICODE_STATISTICS<br>IS_TEXT_UNICODE_UNICODE_MASK</div>
<p><a id="631501" href="#631501">#</a> <strong>Maurits [MSFT]</strong> on 14 Jun 2006 6:30 PM:</p><div style="margin-left: 1em">Looks like wine couldn't find the IS_TEXT_BUFFER_TOO_SMALL test either!<br><br><a rel="nofollow" target="_new" href="http://cvs.winehq.org/patch.py?id=17837">http://cvs.winehq.org/patch.py?id=17837</a><br>/* FIXME: MSDN documents IS_TEXT_UNICODE_BUFFER_TOO_SMALL but there is no such thing... */<br><br>Those wacky docs guys, always making up flags ;)</div>
<p><a id="631574" href="#631574">#</a> <strong>Dean Harding</strong> on 14 Jun 2006 7:33 PM:</p><div style="margin-left: 1em">This will never be a fixable problem... <br><br>If you made IsTextUnicode(&quot;this app can break&quot;) return FALSE, then you'd just have some Chinese guy saying &quot;when I type '桴獩愠灰挠湡戠敲歡' into notepad, save it and reopen it, it just displays some funny English characters!&quot;<br><br>Actually, I think it would save with a BOM in that case, so it probably wouldn't do that. But you get the idea :-)</div>
<p><a id="631616" href="#631616">#</a> <strong>Maurits [MSFT]</strong> on 14 Jun 2006 8:02 PM:</p><div style="margin-left: 1em">I think I know why IS_TEXT_UNICODE_BUFFER_TOO_SMALL is missing.<br><br>Looking at winnt.h, the four &quot;masks&quot; are defined as 0x000f, 0x00f0, 0x0f00, and 0xf000. &nbsp;There seems to be an unwillingness to break the 17th bit for some reason; and IS_TEXT_UNICODE_BUFFER_TOO_SMALL doesn't fit any of the masks; so it was dropped. &nbsp;But it's still in the documentation, which is a documentation error.</div>
<p><strong>Michael S. Kaplan</strong> on 15 Jun 2006 12:11 AM:</p><div style="margin-left: 1em"></div>
<p><strong>Michael S. Kaplan</strong> on 15 Jun 2006 12:14 AM:</p><div style="margin-left: 1em"></div>
<p><strong>Michael S. Kaplan</strong> on 15 Jun 2006 12:19 AM:</p><div style="margin-left: 1em"></div>
<p><strong>Michael S. Kaplan</strong> on 15 Jun 2006 12:20 AM:</p><div style="margin-left: 1em"></div>
<p><a id="631931" href="#631931">#</a> <strong>Pavanaja U B</strong> on 15 Jun 2006 2:30 AM:</p><div style="margin-left: 1em">When I save the file as Unicode, the problem disappears, as expected !?<br><br>Regards,<br>Pavanaja</div>
<p><a id="632191" href="#632191">#</a> <strong>Michael S. Kaplan</strong> on 15 Jun 2006 9:15 AM:</p><div style="margin-left: 1em">Certainly, Pavanaja -- same results if you save as UTF-8 or UTF-16 (Big Endian) -- all three of those formats are unambiguous due when saved in Notepad due to the BOM being there, so there is no confusion....</div>
<p><a id="632376" href="#632376">#</a> <strong>dragonfrog</strong> on 15 Jun 2006 11:48 AM:</p><div style="margin-left: 1em">A possible improvement - it's not insulting a software firm, but &quot;Bush hid the facts&quot; has the same effect as &quot;this app can break&quot;</div>
<p><a id="632476" href="#632476">#</a> <strong>borky</strong> on 15 Jun 2006 12:55 PM:</p><div style="margin-left: 1em">Also works for the following string:<br><br>Bush hid the facts</div>
<p><a id="635679" href="#635679">#</a> <strong>q^-o|o-^p</strong> on 17 Jun 2006 8:38 PM:</p><div style="margin-left: 1em">Here's a good one -- use the following line:<br><br>We can blast Microsoft for a new bug</div>
<p><a id="636629" href="#636629">#</a> <strong>A fish called blue</strong> on 19 Jun 2006 3:28 AM:</p><div style="margin-left: 1em">A colleuge noted that NOTEPAD.EXE is not the only affected application. MORE is also affected (but not TYPE) , possibly also other commands and tools in windows.</div>
<p><a id="636840" href="#636840">#</a> <strong>Rajesh Shenoy</strong> on 19 Jun 2006 10:24 AM:</p><div style="margin-left: 1em">Any string with 4-3-3-5 letters in the words does it.</div>
<p><a id="637391" href="#637391">#</a> <strong>east</strong> on 19 Jun 2006 4:18 PM:</p><div style="margin-left: 1em">ds</div>
<p><a id="637393" href="#637393">#</a> <strong>grsws</strong> on 19 Jun 2006 4:19 PM:</p><div style="margin-left: 1em">Bush hid the facts</div>
<p><a id="643592" href="#643592">#</a> <strong>Anuj</strong> on 22 Jun 2006 10:43 PM:</p><div style="margin-left: 1em">It happens with any string of characters of the form<br>aaaa aaa aaa aaaaa</div>
<p><a id="650240" href="#650240">#</a> <strong>Mircea</strong> on 28 Jun 2006 7:56 PM:</p><div style="margin-left: 1em">Put this in a notepad &nbsp;&quot;muie fut cur maine&quot; &nbsp;widowth &quot; &quot; &nbsp;</div>
<p><a id="655481" href="#655481">#</a> <strong>Skews Me</strong> on 3 Jul 2006 3:56 PM:</p><div style="margin-left: 1em">I RECOMMEND NOT TRYING TO REPRODUCE THIS BUG.<br><br>Ever since I tried the &quot;bush hid the facts&quot; Easter Egg, Notepad has been having trouble with some of my html files. Some of the problems disappear if I restart Notepad and reload the file, but there are still other problems that appear and can be reproduced.<br><br></div>
<p><a id="655523" href="#655523">#</a> <strong>Michael S. Kaplan</strong> on 3 Jul 2006 4:53 PM:</p><div style="margin-left: 1em">I recommend <STRONG>not</STRONG> placing too much stock in the recommendation by Skews Me -- there are no long term consequences to this issue....</div>
<p><a id="662129" href="#662129">#</a> <strong>Sanjay Vyas</strong> on 11 Jul 2006 6:23 AM:</p><div style="margin-left: 1em">Not all combinations of 4-3-3-5 will produce it. For example, Bush hid the truth does not work while Bush hid the facts does. Any explanation?</div>
<p><a id="686656" href="#686656">#</a> <strong>proxy</strong> on 2 Aug 2006 12:57 PM:</p><div style="margin-left: 1em">"We can blast Microsoft for a new bug" is nice one <BR>You can find your own. <BR>Read <BR><A href='http://dhilung.blogspot.com/2006/08/technotepad-facts-behind-bush-hid.html">http://dhilung.blogspot.com/2006/08/technotepad-facts-behind-bush-hid.html</a>' target=_new rel=nofollow>http://dhilung.blogspot.com/2006/08/technotepad-facts-behind-bush-hid.html</A></div>
<p><a id="6053443" href="#6053443">#</a> <strong>South Korean Man</strong> on 10 Nov 2007 7:10 AM:</p><div style="margin-left: 1em"><P>Wow I`m from south korean </P>
<P>IT`S SurpRISE </P>
<P>because Internet Chat Can</P>
<P>OKAY? </P>
<P>I`M 15 YEARS OLD </P>
<P>NAME:Kim Dong UK </P>
<P>LIVE:SEOUL</P>
<P>VERY THANK YOU </P></div>
<p><a id="6646218" href="#6646218">#</a> <strong>Morbo</strong> on 3 Dec 2007 10:45 AM:</p><div style="margin-left: 1em"><P>A different one:</P>
<UL>
<LI>Type a few lines. </LI>
<LI>Make sure the last line is zero length, with a newline at the end.</LI>
<LI>Put the cursor at the beginning of that last line.</LI>
<LI>Double click the empty window BELOW the end of file.</LI>
<LI>The cursor will jump to the start of file.</LI></UL>
<P>Now if you type a newline, all the CrLFs are rendered as square blocks.</P></div>
<p><a id="8334493" href="#8334493">#</a> <strong>Erzengel</strong> on 24 Mar 2008 7:12 PM:</p><div style="margin-left: 1em"><p>I can't repro in Vista. Fixed?</p></div>
<p><a id="8335233" href="#8335233">#</a> <strong>Michael S. Kaplan</strong> on 25 Mar 2008 3:01 AM:</p><div style="margin-left: 1em"><p>Funny you should ask. I'll bet you have Sp1 installed! :-)</p>
</div>
<p><strong>Sameera R.</strong> on 19 Apr 2010 2:38 AM:</p><div style="margin-left: 1em"><p>It doesn't happen in Win7.</p>
<p>Check it.</p></div>
<p><strong>Michael S. Kaplan</strong> on 19 Apr 2010 6:59 AM:</p><div style="margin-left: 1em"><p>Check what?</p>
<p>If you read the comment just before yours, it points to a blog I wrote that explains how and where this was &quot;fixed&quot;. Perhaps I should suggest you check *that*? :-)</p>
</div>
<hr/><p><em>referenced by</em></p><div style="margin-left: 1em"><p>2010/08/14 <a href="http://archives.miloush.net/michkap/archive/2010/08/14/10050078.html">(It wasn't me)</a></p><p>2010/04/01 <a href="http://archives.miloush.net/michkap/archive/2010/04/01/9988607.html">Is the text in XKCD broken?</a></p><p>2008/03/25 <a href="http://archives.miloush.net/michkap/archive/2008/03/25/8334796.html">Bush might've still hid the facts, but he can't hide them from Vista SP1/Server 2008 Notepad!</a></p><p>2008/03/24 <a href="http://archives.miloush.net/michkap/archive/2008/03/24/8331966.html">Unicode not being the default is slower and leads to bugs; maybe it ought to change?</a></p><p>2007/12/11 <a href="http://archives.miloush.net/michkap/archive/2007/12/11/6726647.html">How to get yourself imprisoned [by/for talking about Unicode]</a></p><p>2007/04/22 <a href="http://archives.miloush.net/michkap/archive/2007/04/22/2239345.html">The Notepad encoding detection issues keep coming up</a></p><p>2006/12/23 <a href="http://archives.miloush.net/michkap/archive/2006/12/23/1354366.html">Do not adjust your browser, a.k.a. sometimes two wrongs DO make a right, a.k.a. dumb quotes</a></p><p>2006/08/02 <a href="http://archives.miloush.net/michkap/archive/2006/08/02/686384.html">Hang on just a [Hansel]Minute!</a></p><p>2006/07/11 <a href="http://archives.miloush.net/michkap/archive/2006/07/11/662342.html">More on that which breaks Windows Notepad</a></p><p>2006/07/04 <a href="http://archives.miloush.net/michkap/archive/2006/07/04/656051.html">Behind Norman's 'Who needs Unicode?' post</a></p><p>2006/06/22 <a href="http://archives.miloush.net/michkap/archive/2006/06/22/643461.html">Things I [don't] like about blogging</a></p></div><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2006/06/15/632765.html" title="Hindu != Hindi">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2006/06/13/629804.html" title="Size matters (when it comes to day names, at least)">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2006-06">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2006-06-14">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2006/06/14/631016.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:39 GMT -->
</html>