<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2006/06/02/615536.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:39 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>Je, for sure, from Sweden.</title></head><body>
<h1>Je, for sure, from Sweden.</h1>
<p><em>by Michael S. Kaplan, published on 2006/06/02 22:33 -04:00, original URI: http://blogs.msdn.com/b/michkap/archive/2006/06/02/615536.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostNew -->
<P><FONT face=Tahoma><EM>(Apologies for the title; despite the fact that I am not nearly as attractive, there are times I cannot avoid channeling my inner Jamie Lee Curtis!)</EM></FONT></P>
<P><FONT face=Tahoma>Alexey Sadomov asked me (via the contact link):</FONT></P>
<BLOCKQUOTE dir=ltr style="MARGIN-RIGHT: 0px">
<BLOCKQUOTE dir=ltr style="MARGIN-RIGHT: 0px">
<P><FONT face="Times New Roman" size=2>Hi, Michael.<BR><BR>I've encountered with a problem in sql server related with SQL_SwedishStd_Pref_CP1_CI_AS collation and found your acrticle (</FONT><A HREF="http://archives.miloush.net/michkap/archive/2006/04/25/583307.html"><FONT size=2>http://blogs.msdn.com/michkap/archive/2006/04/25/583307.aspx</FONT></A><FONT size=2>).<BR><BR>The problem is that sql server 2000 (and 2005) has different sorting behaviour for VARCHAR and NVARCHAR data:<BR><BR><STRONG><EM>(Sample truncated, I will show it below -- michael)</EM></STRONG><BR><BR>As you can see, 'V'='W' rule is working only for NVARCHAR column. Can&nbsp; you explain this behaviour?</FONT></P></BLOCKQUOTE></BLOCKQUOTE>
<P><FONT face=Tahoma>Ok, let's build up the sample first. Run the following code in SQL Server 2000 or SQL Server 2005 (to do it in SQL Server 7.0 you would have to install the server, so we'll avoid that for now; the basic results are the same):</FONT></P>
<BLOCKQUOTE dir=ltr style="MARGIN-RIGHT: 0px">
<BLOCKQUOTE dir=ltr style="MARGIN-RIGHT: 0px">
<P><FONT face="Consolas,Courier New" size=2><STRONG>USE master;<BR>IF DB_ID (N'swed_test') IS NOT NULL<BR>&nbsp;&nbsp;&nbsp; DROP DATABASE swed_test;<BR>CREATE DATABASE swed_test;<BR>GO<BR>use swed_test<BR>CREATE TABLE swed_compat (<BR>&nbsp;&nbsp;&nbsp; col varchar (50) COLLATE SQL_SwedishStd_Pref_CP1_CI_AS NULL, <BR>&nbsp;&nbsp;&nbsp; colN nvarchar (50) COLLATE SQL_SwedishStd_Pref_CP1_CI_AS NULL<BR>)<BR>CREATE TABLE swed_win (<BR>&nbsp;&nbsp;&nbsp; col varchar (50) COLLATE Finnish_Swedish_CI_AS NULL, <BR>&nbsp;&nbsp;&nbsp; colN nvarchar (50) COLLATE Finnish_Swedish_CI_AS NULL<BR>)<BR>GO<BR>INSERT INTO swed_compat (col, colN) VALUES ('Val', 'Val')<BR>INSERT INTO swed_compat (col, colN) VALUES ('Wal', 'Wal')<BR>INSERT INTO swed_compat (col, colN) VALUES ('Vel', 'Vel')<BR>INSERT INTO swed_compat (col, colN) VALUES ('Wel', 'Wel')<BR>INSERT INTO swed_win (col, colN) VALUES ('Val', 'Val')<BR>INSERT INTO swed_win (col, colN) VALUES ('Wal', 'Wal')<BR>INSERT INTO swed_win (col, colN) VALUES ('Vel', 'Vel')<BR>INSERT INTO swed_win (col, colN) VALUES ('Wel', 'Wel')</STRONG></FONT></P></BLOCKQUOTE></BLOCKQUOTE>
<P><FONT face=Tahoma>Ok, there is our data, put in two different tables, </FONT><FONT face=Tahoma>one with the Windows collation and the other with the SQL compatibility collation. And each table has two columns, one Unicode and one not.</FONT></P>
<P><FONT face=Tahoma>First we will look at the results with the Windows collation (Finnish_Swedish_CI_AS)</FONT></P>
<BLOCKQUOTE dir=ltr style="MARGIN-RIGHT: 0px">
<P><FONT face="Consolas,Courier New"><STRONG>SELECT col, colN FROM swed_win ORDER BY col<BR>SELECT col, colN FROM swed_win ORDER BY colN<BR><BR>&nbsp;&nbsp;&nbsp; Val&nbsp;Val<BR>&nbsp;&nbsp;&nbsp; Wal&nbsp;Wal<BR>&nbsp;&nbsp;&nbsp; Vel&nbsp;Vel<BR>&nbsp;&nbsp;&nbsp; Wel&nbsp;Wel<BR><BR>&nbsp;&nbsp;&nbsp; Val&nbsp;Val<BR>&nbsp;&nbsp;&nbsp; Wal&nbsp;Wal<BR>&nbsp;&nbsp;&nbsp; Vel&nbsp;Vel<BR>&nbsp;&nbsp;&nbsp; Wel&nbsp;Wel</STRONG></FONT></P></BLOCKQUOTE>
<P><FONT face=Tahoma>Look familiar? (cf: <STRONG><A HREF="http://archives.miloush.net/michkap/archive/2006/06/02/615509.html">It is only of SECONDARY importance</A></STRONG>)</FONT></P>
<P><FONT face=Tahoma>Ok, now we will look at the SQL Compatibility collation (SQL_SwedishStd_Pref_CP1_CI_AS):</FONT></P>
<BLOCKQUOTE dir=ltr style="MARGIN-RIGHT: 0px">
<P><FONT face="Consolas,Courier New"><STRONG>SELECT col, colN FROM swed_compat ORDER BY col<BR>SELECT col, colN FROM swed_compat ORDER BY colN<BR><BR>&nbsp;&nbsp;&nbsp; Val&nbsp;Val<BR>&nbsp;&nbsp;&nbsp; Vel&nbsp;Vel<BR>&nbsp;&nbsp;&nbsp; Wal&nbsp;Wal<BR>&nbsp;&nbsp;&nbsp; Wel&nbsp;Wel<BR><BR>&nbsp;&nbsp;&nbsp; Val&nbsp;Val<BR>&nbsp;&nbsp;&nbsp; Wal&nbsp;Wal<BR>&nbsp;&nbsp;&nbsp; Vel&nbsp;Vel<BR>&nbsp;&nbsp;&nbsp; Wel&nbsp;Wel</STRONG></FONT></P></BLOCKQUOTE>
<P><FONT face=Tahoma>Uh oh, what happened? Why does sorting by the non-Unicode column break the Swedish/Finnish sort behavior for the SQL compatibility collation?</FONT></P>
<P><FONT face=Tahoma>Or perhaps&nbsp;it never worked properly in prior versions and the bug is that the newer support of Unicode is where the incompatibility is coming from?</FONT></P>
<P><FONT face=Tahoma>Between the two theories, the second seems a bit more likely to me, but </FONT><FONT face=Tahoma>I do not have a SQL Server 6.5 handy to install with the older collation to test this theory out; does anyone have one nearby? :-)</FONT></P>
<P><FONT face=Tahoma>In any case, pile this on as another reason that I think <STRONG><A HREF="http://archives.miloush.net/michkap/archive/2005/11/08/490305.html">SQL Compatibility collations are a bit too retro for me</A></STRONG>!</FONT></P>
<P><FONT face=Tahoma></FONT>&nbsp;</P>
<P><FONT face=Tahoma color=#ff1493><EM>This post brought to you by</EM> ï¼¶ <EM>(<A href="http://www.fileformat.info/info/unicode/char/ff36">U+ff36</A>, a.k.a. FULLWIDTH LATIN CAPITAL LETTER V)</EM></FONT></P>
<hr/><div style="margin-left: 1em"><em>no comments</em></div><hr/><p><em>referenced by</em></p><div style="margin-left: 1em"><p>2007/10/25 <a href="http://archives.miloush.net/michkap/archive/2007/10/25/5686727.html">Not all in sync quite yet (aka SQL and the CLR and Windows and .NET)</a></p><p>2006/10/29 <a href="http://archives.miloush.net/michkap/archive/2006/10/29/897317.html">SQL Server: compatibility collations vs. Window collations</a></p><p>2006/06/06 <a href="http://archives.miloush.net/michkap/archive/2006/06/06/618798.html">Unicode and SQL Collations have nothing to do with each other</a></p></div><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2006/06/02/615571.html" title="What the @!#$% is the TERTIARY_WEIGHTS() function for?">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2006/06/02/615509.html" title="It is only of SECONDARY importance">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2006-06">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2006-06-02">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2006/06/02/615536.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:39 GMT -->
</html>