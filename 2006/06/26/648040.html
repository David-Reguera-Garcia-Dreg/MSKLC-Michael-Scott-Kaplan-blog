<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2006/06/26/648040.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:39 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>Not all GetUnicodeCategory methods are created equal</title></head><body>
<h1>Not all GetUnicodeCategory methods are created equal</h1>
<p><em>by Michael S. Kaplan, published on 2006/06/26 22:40 -04:00, original URI: http://blogs.msdn.com/b/michkap/archive/2006/06/26/648040.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostNew -->
<P><FONT face=Tahoma>So the question that Matt asked was something like this:</FONT></P>
<BLOCKQUOTE dir=ltr style="MARGIN-RIGHT: 0px">
<P><FONT face=Tahoma size=2>Why is it that calling GetUnicodeCategory on character '00ad' returns a category of DashPunctuation? I&nbsp;expected the Unicode 4.1 category of Format. Here is the code I used:</FONT></P>
<P><FONT face="Consolas,Courier New" size=1><STRONG>using System;<BR>using System.Text;<BR><BR>namespace ConsoleApplication2 {<BR>&nbsp;&nbsp;&nbsp; class Program {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; static void Main(string[] args) {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; TestChar(Convert.ToChar(Convert.ToInt32("00ad", 16)));<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<BR><BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public static void TestChar(char testing) {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Console.WriteLine("Categorys for char 0x" + Convert.ToInt32(testing).ToString("x4"));<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Console.WriteLine("\tUCD&nbsp; Category : " + Char.GetUnicodeCategory(testing));<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Console.WriteLine("\tNLS+ Category : IsPunctuation=" + Char.IsPunctuation(testing));<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<BR>&nbsp;&nbsp;&nbsp; }<BR>}</STRONG></FONT></P>
<P><FONT face=Tahoma size=2>Do you know what is going on here?</FONT><FONT face=Tahoma><FONT size=1></P></BLOCKQUOTE></FONT></FONT>
<P><FONT face=Tahoma>Indeed, the problem is sort of the root of the title of this post. The simple fact is that not all GetUnicodeCategory() methods are created equal!</FONT></P>
<P><FONT face=Tahoma>There is <A href="http://search.msdn.microsoft.com/search/Redirect.aspx?title=GetUnicodeCategory+Method&amp;url=http://msdn.microsoft.com/library/en-us/cpref/html/frlrfSystemCharClassGetUnicodeCategoryTopic.asp">char.GetUnicodeCategory</A> that has been around all along, and starting with version 2.0 of the .NET Framework there is <A href="http://msdn2.microsoft.com/en-us/library/system.globalization.charunicodeinfo.getunicodecategory.aspx">CharUnicodeInfo.GetUnicodeCategory</A>, which I have talked about <A href="http://archives.miloush.net/michkap/archive/2005/01/28/362305.html"><STRONG>previously</STRONG></A> (though in fairness not with 100% accuracy!).</FONT></P>
<P><FONT face=Tahoma>They are different for some sort of backcompat reason related to programs that are just assuming certain behavior. Let's see how different they are, with code like this:</FONT></P>
<BLOCKQUOTE dir=ltr style="MARGIN-RIGHT: 0px">
<BLOCKQUOTE dir=ltr style="MARGIN-RIGHT: 0px">
<P><FONT face="Consolas,Courier New" size=1><STRONG>using System;<BR>using System.Text;<BR>using System.Globalization;<BR><BR>namespace ConsoleApplication2 {<BR>&nbsp;&nbsp;&nbsp; class Program {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; static void Main(string[] args) {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; for(ushort ich = 0x0000; ich &lt; 0xffff; ich++) {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;UnicodeCategory ucC = char.GetUnicodeCategory((char)ich);<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;UnicodeCategory ucCui = CharUnicodeInfo.GetUnicodeCategory((char)ich);<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(ucC != ucCui) {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Console.WriteLine("{0}\t{1}\t{2}", ich.ToString("x4"), ucC, ucCui);<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<BR>&nbsp;&nbsp;&nbsp; }<BR>}</STRONG></FONT></P></BLOCKQUOTE></BLOCKQUOTE>
<P><FONT face=Tahoma>If you run it, it will, amazingly enough, return just that one character that is different:</FONT></P>
<BLOCKQUOTE dir=ltr style="MARGIN-RIGHT: 0px">
<P><STRONG><FONT face="Consolas,Courier New">00ad&nbsp;&nbsp;&nbsp; DashPunctuation Format</FONT></STRONG></P></BLOCKQUOTE>
<P><FONT face=Tahoma>Although in the future, the plan is that <A href="http://msdn2.microsoft.com/en-us/library/system.globalization.charunicodeinfo.getunicodecategory.aspx">CharUnicodeInfo.GetUnicodeCategory</A>&nbsp;will be updated when Unicode is, while <A href="http://search.msdn.microsoft.com/search/Redirect.aspx?title=GetUnicodeCategory+Method&amp;url=http://msdn.microsoft.com/library/en-us/cpref/html/frlrfSystemCharClassGetUnicodeCategoryTopic.asp">char.GetUnicodeCategory</A>&nbsp;will usually also be updated though occasionally there may be some sort of application dependency that would force it to not change for specific characters.</FONT></P>
<P><FONT face=Tahoma>Kind of a whole new way to solve the <STRONG><A href="http://archives.miloush.net/michkap/archive/2005/03/25/402444.html">consistency vs. correctness</A></STRONG> argument -- support both? :-)</FONT></P>
<P><FONT face=Tahoma></FONT>&nbsp;</P>
<P><FONT face=Tahoma color=#ff1493><EM>This post brought to you by <A href="http://www.fileformat.info/info/unicode/char/00ad">U+00ad</A>, a.k.a. SOFT HYPHEN</EM></FONT></P>
<hr/><p><a id="649099" href="#649099">#</a> <strong>Mihai</strong> on 27 Jun 2006 7:28 PM:</p><div style="margin-left: 1em">&lt;&lt;Although in the future, the plan is that CharUnicodeInfo.GetUnicodeCategory will be updated when Unicode is, while char.GetUnicodeCategory will usually also be updated though occasionally there may be some sort of application dependency that would force it to not change for specific characters.&gt;&gt;<br><br>Kind of a mess, if you ask me.<br>Maybe keeping the two in sync and adding CharUnicodeLatestInfo would be an idea? And (in time) deprecating CharUnicodeInfo?</div>
<p><a id="649303" href="#649303">#</a> <strong>Michael S. Kaplan</strong> on 27 Jun 2006 11:44 PM:</p><div style="margin-left: 1em">Nah, CharUnicodeInfo was specifically added to always match what the Unicode Standard has in it when it shipped -- deprecating that would make no sense!<br><br>And notice that there is only one character that freaked everyone out to change in the System.Char method -- all of the other changes happened and everyone lived....</div>
<p><a id="649863" href="#649863">#</a> <strong>Mihai</strong> on 28 Jun 2006 1:36 PM:</p><div style="margin-left: 1em">If this was the idea, then maybe clearly spelling this out in the MSDN doc would be enough.<br>Nothing tells me what the difference is, or that CharUnicodeInfo.GetUnicodeCategory contains the latest info, while char.GetUnicodeCategory gives &quot;compatibility&quot; info.<br><br>Reading the current doc it feels like char.GetUnicodeCategory is just syntactic suggar for CharUnicodeInfo.GetUnicodeCategory, maybe even implemented by using that :-)<br><br>I was trying to make the name self-documented, but a note in the doc might be enough (and does not break any code :-)<br></div>
<p><a id="650059" href="#650059">#</a> <strong>Michael S. Kaplan</strong> on 28 Jun 2006 4:56 PM:</p><div style="margin-left: 1em">Thats what this blog post and the other one were all about! :-)</div>
<hr/><p><em>referenced by</em></p><div style="margin-left: 1em"><p>2006/09/02 <a href="http://archives.miloush.net/michkap/archive/2006/09/02/736881.html">Every character has a story #23: U+00ad (SOFT HYPHEN)</a></p></div><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2006/06/27/648333.html" title="I Tswana know what you&#39;re thinking">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2006/06/25/646769.html" title="Access object name limits">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2006-06">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2006-06-26">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2006/06/26/648040.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:39 GMT -->
</html>