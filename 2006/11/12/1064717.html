<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2006/11/12/1064717.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:39 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>Maybe it is the name that is 'Undesirable' ?</title></head><body>
<h1>Maybe it is the name that is 'Undesirable' ?</h1>
<p><em>by Michael S. Kaplan, published on 2006/11/12 17:53 -05:00, original URI: http://blogs.msdn.com/b/michkap/archive/2006/11/12/1064717.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostNew -->
<FONT face=Tahoma size=3>
<P>This last May, I talked about <STRONG><A class="" href="http://archives.miloush.net/michkap/archive/2006/05/31/612544.html" mce_href="http://archives.miloush.net/michkap/archive/2006/05/31/612544.html">Keeping out the undesirables</A></STRONG> and talked about how the <A class="" href="http://msdn.microsoft.com/library/en-us/intl/nls_19ev.asp" mce_href="http://msdn.microsoft.com/library/en-us/intl/nls_19ev.asp">IsNLSDefinedString</A> function took some extra conditions that it required in order to consider a string to be <STRONG>defined</STRONG> by its standards (in that case, no PUA and&nbsp;no unpaired surrogates, in addition to being unknown to the collation data). The same conditions apply to the managed <A class="" href="http://msdn2.microsoft.com/en-us/library/system.globalization.compareinfo.issortable.aspx" mce_href="http://msdn2.microsoft.com/en-us/library/system.globalization.compareinfo.issortable.aspx">CompareInfo.IsSortable</A> method, by the way....</P>
<P>And then yesterday in <STRONG><A class="" href="http://archives.miloush.net/michkap/archive/2006/11/11/1061686.html" mce_href="http://archives.miloush.net/michkap/archive/2006/11/11/1061686.html">Keeping out more of the undesirables</A></STRONG>, I talked about how the the <A class="" href="http://msdn2.microsoft.com/en-us/library/system.string.normalize.aspx" mce_href="http://msdn2.microsoft.com/en-us/library/system.string.normalize.aspx">System.String.Normalize</A>&nbsp;method and the <A class="" href="http://msdn.microsoft.com/library/en-us/intl/nls_normalize_string.asp" mce_href="http://msdn.microsoft.com/library/en-us/intl/nls_normalize_string.asp">NormalizeString</A> function take the law (well, the Unicode conformance rules)&nbsp;into their own hands by reporting an error in the case of noncharacters (I believe they also reject unpaired surrogates, which should help with <A class="" href="http://archives.miloush.net/michkap/archive/2006/11/11/1061686.html#1061863" mce_href="http://archives.miloush.net/michkap/archive/2006/11/11/1061686.html#1061863">Doug's concerns</A> here!).</P>
<P>Although I believe the operations and conditions that these various functions and methods perform and work under are justified, one could feel that they are a bit heavy handed in their judgment. After all, PUA characters are people too and such, right? :-) </P>
<P>Now let's move into the encoding space for a moment, with the <A class="" href="http://msdn.microsoft.com/library/en-us/intl/unicode_17si.asp" mce_href="http://msdn.microsoft.com/library/en-us/intl/unicode_17si.asp">MultiByteToWideChar</A>/<A class="" href="http://msdn.microsoft.com/library/en-us/intl/unicode_2bj9.asp" mce_href="http://msdn.microsoft.com/library/en-us/intl/unicode_2bj9.asp">WideCharToMultiByte</A> functions and the <A class="" href="http://msdn2.microsoft.com/en-us/library/system.text.encoding.unicode.aspx" mce_href="http://msdn2.microsoft.com/en-us/library/system.text.encoding.unicode.aspx">System.Text.Encoding</A> class. </P>
<P>All of these methods have pretty much had the notion of doing something special in the case of text that is improper,&nbsp;and in prior versions the rule was simple:</P>
<UL>
<LI>Replace characters found in the source text that are unknown within the definition of the target encoding&nbsp;with the default character;</LI>
<LI>If a special flag was passed, treat those cases as an error.</LI></UL>
<P>This may seem like the same thing, but usually it isn't; if is simply when one is told to convert using rules that consider some of the text to be undefined, deciding how to proceed.</P>
<P>Now there are several "code pages" used by the Encoding class that cover the entire Unicode space:</P>
<UL>
<LI>GB18030 (code page 54936)</LI>
<LI>UTF-7 (code page 65000 or <A class="" href="http://msdn.microsoft.com/library/en-us/cpref/html/frlrfsystemtextencodingclassutf7topic.asp" mce_href="http://msdn.microsoft.com/library/en-us/cpref/html/frlrfsystemtextencodingclassutf7topic.asp">Encoding.UTF7</A>)</LI>
<LI>UTF-8 (code page 65001 or <A class="" href="http://msdn.microsoft.com/library/en-us/cpref/html/frlrfsystemtextencodingclassutf8topic.asp" mce_href="http://msdn.microsoft.com/library/en-us/cpref/html/frlrfsystemtextencodingclassutf8topic.asp">Encoding.UTF8</A>)</LI>
<LI>Big Endian UTF-16 (.NET Framework only, <A class="" href="http://msdn.microsoft.com/library/en-us/cpref/html/frlrfsystemtextencodingclassbigendianunicodetopic.asp" mce_href="http://msdn.microsoft.com/library/en-us/cpref/html/frlrfsystemtextencodingclassbigendianunicodetopic.asp">Encoding.BigEndianUnicode</A>)</LI>
<LI>UTF-16 (.NET Framework only, <A class="" href="http://msdn.microsoft.com/library/en-us/cpref/html/frlrfsystemtextencodingclassunicodetopic.asp" mce_href="http://msdn.microsoft.com/library/en-us/cpref/html/frlrfsystemtextencodingclassunicodetopic.asp">Encoding.Unicode</A>)</LI>
<LI>Big Endian UTF-32 (.NET Framework only, <A class="" href="http://msdn2.microsoft.com/en-us/library/system.text.utf32encoding.aspx" mce_href="http://msdn2.microsoft.com/en-us/library/system.text.utf32encoding.aspx">UTF32Encoding class</A>)</LI>
<LI>UTF-32 (.NET Framework only, <A class="" href="http://msdn2.microsoft.com/en-us/library/system.text.utf32encoding.aspx" mce_href="http://msdn2.microsoft.com/en-us/library/system.text.utf32encoding.aspx">UTF32Encoding class</A>)</LI></UL>
<P>In these cases, one could argue that the "undefined" rule does not apply, since anything you can express in one of them can be expressed in any of the others.</P>
<P>The older behavior of all of these methods was to either let&nbsp;text pass through&nbsp;unchanged or consider it an error, depending on how the function was instructed to deal with that case.</P>
<P>The newer behavior, however, is to replace these invalid pieces with <A class="" href="http://www.fileformat.info/info/unicode/char/fffd" mce_href="http://www.fileformat.info/info/unicode/char/fffd">U+fffd</A> (REPLACEMENT CHARACTER) rather than letting them pass through as is. A bit more social engineering here -- an effort to have a say in what one wishes to pass through here, whether one likes it or not. </P>
<P>Now this is a behavior change, for invalid text. And definitely worth taking note of (it is not necessarily&nbsp;a change for the better, in my opinion -- though that is simply a matter of opinion, and considering how easy the old way made it to emit bad text I can understand the argument, even if it does seem a little heavy-handed).</P>
<P>Since it is the only operation that a "UTF-16 encoding" does in its "UTF-16 LE to UTF-16 LE" conversion, it really if the only good purpose for the encoding at all in that case. Kind of a text colonic of some sort? :-)</P>
<P>Anyway, in looking to future versions of Windows, the question of whether to support those last four operations comes up, and then inevitably how to do so also comes up. It is kind of a good-natures argument I have with Shawn, that <A class="" href="http://blogs.msdn.com/shawnste/" mce_href="http://blogs.msdn.com/shawnste/">"not a Klingon"</A>&nbsp; across the hall from me.</P>
<P>Both of us believe&nbsp;it makes sense to have some function that will act as a "colonic" for these various forms and schemes for Unicode text to clean out this garbage. No disagreement there. :-)</P>
<P>I'm just not sure whether treating all of them like "multibyte" encodings (which is the semantic that <A class="" href="http://msdn.microsoft.com/library/en-us/intl/unicode_17si.asp" mce_href="http://msdn.microsoft.com/library/en-us/intl/unicode_17si.asp">MultiByteToWideChar</A>/<A class="" href="http://msdn.microsoft.com/library/en-us/intl/unicode_2bj9.asp" mce_href="http://msdn.microsoft.com/library/en-us/intl/unicode_2bj9.asp">WideCharToMultiByte</A>&nbsp;calls would lend to them) is the&nbsp;best way to go. </P>
<P>I mean, since UTF-32 and Big Endian UTF-32 are the least multibyte of all the encodings, it kind of feels like a perversion of the English language to consider as UTF-16 --&gt; UTF-32 conversion to be one of "wide char to multi byte" since if anything UTF-16 is multibyte in the case of supplementary characters when UTF-32 is not.</P>
<P>Perhaps I am&nbsp;getting hung up on the language semantic&nbsp;here, but it just feels wrong from a descriptive perspective, if nothing else....</P>
<P>One could argue that UTF7 and UTF8 are indeed multibyte encodings so that the longstanding decision to make them "code pages" makes some sense -- though they sort of sent us down this path of weird language that was doing conversions from Unicode to Unicode (albeit different forms). One could maybe think of UTF-16 and UTF-32 "code pages" as being a proof by <STRONG>reductio ad absurdum</STRONG> that even the original notion of doing any sort of Unicode conversion that simply goes to Unicode and treaying it like a code page&nbsp;was flawed.</P>
<P>Anyway, lazy thoughts for a Sunday afternoon. It's not like any of this would be shipping any time soon, but if you have opinions for or against any of this then please feel free to make them known; information like that can always help with planning, after all!</P>
<P>(And I would humbly suggest that the word <EM>colonic</EM> not appear in any suggested function names!)</P>
<P mce_keep="true">&nbsp;</P>
<P><FONT color=#ff00ff><EM>This post brought to you by</EM>&nbsp;<FONT face="Arial Unicode MS" size=6>�</FONT> <EM>(<A class="" href="http://www.fileformat.info/info/unicode/char/fffd" mce_href="http://www.fileformat.info/info/unicode/char/fffd">U+fffd</A>, a.k.a. REPLACEMENT CHARACTER)</EM></FONT></P></FONT>
<hr/><p><strong>Xenia Tchoumitcheva</strong> on 13 Nov 2006 11:11 AM:</p><div style="margin-left: 1em"><P>How about the following name for the home edition of the "Longhorn Server":</P>
<P>Windows Home Server</P>
<P>Microsoft has just registered all international domains</P>
<P><A href="http://whois.domaintools.com/windowshomeserver.it" target=_new rel=nofollow>http://whois.domaintools.com/windowshomeserver.it</A></P>
<P><A href="http://whois.domaintools.com/windowshomeserver.de" target=_new rel=nofollow>http://whois.domaintools.com/windowshomeserver.de</A></P>
<P><A href="http://whois.domaintools.com/windowshomeserver.nl" target=_new rel=nofollow>http://whois.domaintools.com/windowshomeserver.nl</A></P>
<P><A href="http://whois.domaintools.com/windowshomeserver.ch" target=_new rel=nofollow>http://whois.domaintools.com/windowshomeserver.ch</A></P>
<P>and so one. So finally a home version of the upcoming new server OS.</P>
<P>Regards, Xenia</P></div>
<p><strong>Michael S. Kaplan</strong> on 13 Nov 2006 12:10 PM:</p><div style="margin-left: 1em"><p>Hmmm...... not sure if that counts as a desirable prodcuct name or not. :-)</p>
</div>
<hr/><p><em>referenced by</em></p><div style="margin-left: 1em"><p>2006/12/05 <a href="http://archives.miloush.net/michkap/archive/2006/12/05/1212917.html">Validation of Unicode text is growing up</a></p></div><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2006/11/14/1074214.html" title="It seems that discrimination is the official policy at the WA Dept. of Licensing">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2006/11/12/1031784.html" title="If I wasn&#39;t watching her blog, could you really claim I was filtering the list of blogs I read?">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2006-11">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2006-11-12">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2006/11/12/1064717.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:39 GMT -->
</html>