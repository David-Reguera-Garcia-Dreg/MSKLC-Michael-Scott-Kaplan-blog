<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2006/11/03/941420.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:39 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>Identifying illegal characters before they cross the border?</title></head><body>
<h1>Identifying illegal characters before they cross the border?</h1>
<p><em>by Michael S. Kaplan, published on 2006/11/03 05:32 -05:00, original URI: http://blogs.msdn.com/b/michkap/archive/2006/11/03/941420.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostNew -->
<FONT face=Tahoma size=3>
<P>Developer Lei Tan asked a question that comes up fairly often these days: </P>
<BLOCKQUOTE><FONT face="Times New Roman,Times" size=2>
<P>Is there a SDK document to tell what characters are not valid for file name, i.e., cannot be used in APIs to create directory, file, etc. When I try to rename a file to, say “&lt;”, I got a tooltip saying “file name cannot have \/:*?”&lt;&gt;|”. Is this a complete list of invalid chars for file/dir name?</P></FONT></BLOCKQUOTE>
<P>Josh Poley (a man with the fascinating address book title of EMULATION NINJA! I'd love to see the CSP on this one, and plan to ask about the possibility of a job title like LINGUISTIC NINJA myself...) pointed out the MSDN topic entitled <A class="" href="http://msdn.microsoft.com/library/en-us/fileio/fs/naming_a_file.asp" mce_href="http://msdn.microsoft.com/library/en-us/fileio/fs/naming_a_file.asp">Naming a File</A> which I'll get&nbsp;back to in a moment, and <A class="" href="http://blogs.msdn.com/mgrier/" mce_href="http://blogs.msdn.com/mgrier/">Michael Grier</A> gave a concise reality check on the notion of the hopes of a "complete" answer:</P>
<BLOCKQUOTE><FONT face="Times New Roman,Times" size=2>
<P>The answer is per-volume and there does not seem to be any programmatic way to get this information.<BR><BR>So the basic answer is “no” if you’re serious about “complete”.<BR><BR>In practice, files can’t have slashes in them and if you use the win32 APIs ... they also can’t have trailing spaces and a bunch of other canonicalization rules apply.</P></FONT></BLOCKQUOTE>
<P>Now this answer points out the core issue, which is that any attempt to capture all the rules will always be massively&nbsp;incomplete, probably misleading, possibly incorrect, and certainly misleading to the bulk of people who read it. And mainly because there is no simple function with one can to query a particular volume to ask what its rules are!</P>
<P>"But Michael," you may complain, "What about .NET's <A class="" href="http://msdn2.microsoft.com/en-us/library/system.io.path.getinvalidpathchars.aspx" mce_href="http://msdn2.microsoft.com/en-us/library/system.io.path.getinvalidpathchars.aspx">Path.GetInvalidPathChars</A> and <A class="" href="http://msdn2.microsoft.com/en-us/library/system.io.path.getinvalidfilenamechars.aspx" mce_href="http://msdn2.microsoft.com/en-us/library/system.io.path.getinvalidfilenamechars.aspx">Path.GetInvalidFileNameChars</A>?"</P>
<P>To you (if you are one of those people!) I have to suggest that you read the topics, both of which are very clear about the fact that:</P>
<BLOCKQUOTE><FONT face="Times New Roman,Times" size=2>
<P>The array returned from this method is not guaranteed to contain the complete set of characters that are invalid in file and directory names. The full set of invalid characters can vary by file system. For example, on Windows-based desktop platforms, invalid path characters might include ASCII/Unicode characters 1 through 31, as well as quote ("), less than (&lt;), greater than (&gt;), pipe (|), backspace (\b), null (\0) and tab (\t).&nbsp;</P></FONT></BLOCKQUOTE>
<P>The problem here is a general and hopeful tendency to try and help developers by providing an answer, knowing that the answer is basically incomplete but only noting this fact remarks that may never be seen and which are certainly not as visible as the methods themselves. It may serve often, but is never really a complete answer.</P>
<P>"But Michael," you may point out, not being dissuaded by your last attempt, "can't you&nbsp;just try and create a file&nbsp;with the characters and see what succeeds, then delete the file?"</P>
<P>To&nbsp;you (if you are one of those people!) &nbsp; I would recommend taking a look at the "attempt at codifying the uincodifiable"&nbsp;<A class="" href="http://msdn.microsoft.com/library/en-us/fileio/fs/naming_a_file.asp" mce_href="http://msdn.microsoft.com/library/en-us/fileio/fs/naming_a_file.asp">Naming a File</A>&nbsp;topic that our Emulation Ninja pointed out, and then adding to it all of the additional issues like security (what if you have no create permissions, or even worse no delete permissions and you are littering the user's system&nbsp;with many files?</P>
<P>So now that I have said that the attempts to either write functions or&nbsp;documentation to capture the&nbsp;problem won't solve it, what do I think would solve it?</P>
<P>Well, if you go back and time and actually require a method to be&nbsp;implemented in the actual file system drivers that return the rules and/or validates a particular name, and then at higher levels create a Win32 API function that adds to this list any additional rules that it would apply to such a creation, then it may have been possible to try and solve. Of course, trying to create such a requirement now will not help very much since one can always access older volumes over a network and thus there is no 100% coverage guarantee anyway.</P>
<P>So we will limp along with partial solutions....</P>
<P>You can probably guess what I think about and text from <A class="" href="http://msdn.microsoft.com/library/en-us/fileio/fs/naming_a_file.asp" mce_href="http://msdn.microsoft.com/library/en-us/fileio/fs/naming_a_file.asp">Naming a File</A>&nbsp;like </P>
<BLOCKQUOTE><FONT face="Times New Roman,Times" size=2>
<P>"Use any character in the current code page for a name, including Unicode characters, except characters in the range of 0 (zero) through 31, or any character that the file system does not allow. A name can contain characters in the extended character set (128–255)." </P></FONT></BLOCKQUOTE>
<P>and it will therefore save me some time not having to talk about it.:-)</P>
<P>Just kidding. I'll post another time about all of my locale and case related concerns here....</P>
<P class=MsoNormal mce_keep="true">&nbsp;</P>
<P mce_keep="true"><FONT color=#ff00ff><EM>This post brought to you by</EM> <FONT size=6><STRONG>／</STRONG></FONT> <EM>and</EM> <FONT size=6><STRONG>＼</STRONG></FONT> <EM>(<A class="" href="http://www.fileformat.info/info/unicode/char/ff0c" mce_href="http://www.fileformat.info/info/unicode/char/ff0c">U+ff0c</A> and <A class="" href="http://www.fileformat.info/info/unicode/char/ff3c" mce_href="http://www.fileformat.info/info/unicode/char/ff3c">U+ffec</A>, a.k.a. FULLWIDTH SOLIDUS and FULLWIDTH REVERSE SOLIDUS)</EM></FONT></P></FONT>
<hr/><p><a id="942604" href="#942604">#</a> <strong>alaw</strong> on 3 Nov 2006 8:33 AM:</p><div style="margin-left: 1em"><p>Your comments about trying to identify all the 'bad' characters are familiar. With ASP.NET, an Anti Cross Site Scripting library was created recently which tries to address this - by starting with EVERYTHING being invalid, and then adding the valid characters.</p>
<p>Here is the link, and I think a 1.5 version will come out soon with many more capabilities</p>
<p><a rel="nofollow" target="_new" href="http://www.microsoft.com/downloads/details.aspx?familyid=9a2b9c92-7ad9-496c-9a89-af08de2e5982&amp;displaylang=en">http://www.microsoft.com/downloads/details.aspx?familyid=9a2b9c92-7ad9-496c-9a89-af08de2e5982&amp;displaylang=en</a></p>
</div>
<p><a id="942636" href="#942636">#</a> <strong>Adam</strong> on 3 Nov 2006 8:55 AM:</p><div style="margin-left: 1em"><p>Could you try to create a &quot;FileInfo&quot; for the requested full path? That is supposed to return an ArgumentException() if the filename &quot;is empty, contains only white spaces, or contains invalid characters.&quot; If that doesn't know what characters are valid for the volume you're trying to create the file on, but it is filesystem-specific (as you seem to imply), how does it know when to throw that exception?</p>
<p>Although....how would this work with filesystems that allow filenames that consist only of whitespace (i.e., All unix filesystems) - does it throw the exception or not?. Or filesystems that allow a colon in the middle of a path? (The FileInfo constructor is supposed to throw a NotSupportedException() in this case)</p>
<p>Or is the .NET documentation incorrect/incomplete here?</p></div>
<p><a id="942666" href="#942666">#</a> <strong>Adam</strong> on 3 Nov 2006 9:14 AM:</p><div style="margin-left: 1em"><p>Actually... according to the Wikipedia comparison of file systems[0], FAT and NTFS all actually allow chars 1-31, as well as &lt; &gt;, etc... (but not ':' for NTFS) as filename characters.</p>
<p>So, if the set of invalid characters varies by file system, and all the underlying file systems for .NET on NT allow these characters, how come these characters are *not* allowed in .NET on NT?</p>
<p>Is it MSDN or Wikipedia at fault here?</p>
<p>[0] <a rel="nofollow" target="_new" href="http://en.wikipedia.org/wiki/Comparison_of_file_systems">http://en.wikipedia.org/wiki/Comparison_of_file_systems</a></p></div>
<p><a id="943129" href="#943129">#</a> <strong>Michael S. Kaplan</strong> on 3 Nov 2006 11:54 AM:</p><div style="margin-left: 1em"><P>Hi Adam, </P>
<P>So you see the problems once you go down the path of trying to capture this in documentation? :-)</P></div>
<p><a id="945676" href="#945676">#</a> <strong>Nick Lamb</strong> on 3 Nov 2006 4:01 PM:</p><div style="margin-left: 1em"><p>Adam, Wikipedia is telling you what is permitted by the filesystem itself, but .NET is usually run on top of Win32 and Win64, which in turn are mostly based on the Win16 APIs, which inherits various semantics from MS DOS in the 1980s.</p>
<p>Each layer (.NET, Win32, NT kernel VFS, NTFS driver) has its own restrictions in addition to those imposed by lower layers, and the Win32 layer in particular has a lot of restrictions intended as backwards compatibility or (especially in shell related code) as ill conceived &quot;ease of use&quot; improvements.</p>
<p>Applications written to use other subsystems (where they exist) or the NT system calls directly, have a much broader selection of file names available to them.</p></div>
<hr/><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2006/11/04/961822.html" title="On Thokks who don&#39;t give a Frigg, under the mistletoe">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2006/11/03/939272.html" title="Concatenating display names correctly?">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2006-11">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2006-11-03">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2006/11/03/941420.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:39 GMT -->
</html>