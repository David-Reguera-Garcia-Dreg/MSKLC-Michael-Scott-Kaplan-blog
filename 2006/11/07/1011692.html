<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2006/11/07/1011692.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:39 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>How ConvertDefaultLocale sorta broke backward compatibility in Vista, and why</title></head><body>
<h1>How ConvertDefaultLocale sorta broke backward compatibility in Vista, and why</h1>
<p><em>by Michael S. Kaplan, published on 2006/11/07 03:01 -05:00, original URI: http://blogs.msdn.com/b/michkap/archive/2006/11/07/1011692.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostNew -->
<FONT face=Tahoma size=3>
<P>The whole situation reminded me of some dialog from a West Wing episode, the one where some politico was complaining to President Josiah Bartlett about women wanting equal opportunities in athletics. When Jed pointed out that Title IX was passed thirty years ago, the politico responded "Yes, Mr. President. But now it looks like they want those laws enforced."</P>
<P>It's a world gone mad, I say.</P>
<P>Anyway, enforcing consistency can be quite painful at times. Especially trying to be consistent with something that never worked right anyway.</P>
<P>It all started with the issue I first mentioned in <A class="" href="http://archives.miloush.net/michkap/archive/2005/07/05/435885.html" mce_href="http://archives.miloush.net/michkap/archive/2005/07/05/435885.html"><STRONG>Change is in the cards for ConvertDefaultLocale...</STRONG></A> though its roots go way back to <STRONG><A class="" href="http://archives.miloush.net/michkap/archive/2004/12/29/343557.html" mce_href="http://archives.miloush.net/michkap/archive/2004/12/29/343557.html">What is a neutral culture? What is a neutral locale?</A></STRONG> and some&nbsp;odd decisions made for the LCID values in the .NET Framework, specifically the one that caused the Traditional Chinese neutral culture's LCID to be 0x7c04 and the Simplified Chinese neutral culture's LCID to be 0x0004.</P>
<P>Now&nbsp;over in Windows, LCID 0x0004 is actually LANG_CHINESE and is the neutral for all of the Chinese LCIDs, both joint and severally. But that is a lame answer, based on the fact that NLS never cared about neutrals and never supported them anyway. But the .NET Framework needed (or at least wanted)&nbsp;unique values for Traditional and Simplified Chinese, and only one of them could be 0x0004. The decision was made to make that the Simplified Chinese LCID, and then a new one was added for Traditional.</P>
<P>Arbitrary, but since all of the Windows locales used 0x0004 as their neutral, it does not matter, right?</P>
<P>Well, no.</P>
<P>Because any time you passed LANG_CHINESE to an NLS function that took an LCID, it would assume you meant MAKELANGID(LANG_CHINESE, SUBLANG_DEFAULT) which also happens to return the same results as MAKELANGID(LANG_CHINESE, SUBLANG_CHINESE_TRADITIONAL), which has a comment in winnt.h and ntdef.h of "// Chinese (Taiwan)". And then the longstanding constant for PRC was SUBLANG_CHINESE_SIMPLIFIED with a comment of "// Chinese (PR China)". </P>
<P>So even though the neutral made no warranty and no decision as to its meaning, using the neutral in an NLS function called itself Traditional Chinese and there was no neutral that would do the same for Simplified Chinese. Which makes the decision for how to allocate LCIDs in .NET (which supposedly only existed for backcompat with Windows) in retrospect a less than stellar choice.</P>
<P>So, swinging back around to Windows and Vista, there are now three versions of the .NET Framework that have shipped and which actually support the notion of neutrals. And even if it was the wrong decision, the decision is out there now, and changing the values to be compatible with a platform that does not support the concept of neutral locales anyway would also be a bad decision, and a definite case of two wrongs not making a right.</P>
<P>So in the Vista version of <A class="" href="http://msdn.microsoft.com/library/en-us/intl/nls_80o5.asp" mce_href="http://msdn.microsoft.com/library/en-us/intl/nls_80o5.asp">ConvertDefaultLocale</A>, 0x7c04 is converted to 0x0404 and 0x0004 is converted to 0x0804, so&nbsp;<A class="" href="http://msdn.microsoft.com/library/en-us/intl/nls_80o5.asp" mce_href="http://msdn.microsoft.com/library/en-us/intl/nls_80o5.asp">ConvertDefaultLocale</A> now behaves just like the unmanaged equivalent of the managed <A class="" href="http://msdn.microsoft.com/library/en-us/cpref/html/frlrfsystemglobalizationcultureinfoclasscreatespecificculturetopic.asp" mce_href="http://msdn.microsoft.com/library/en-us/cpref/html/frlrfsystemglobalizationcultureinfoclasscreatespecificculturetopic.asp">CreateSpecificCulture</A>.</P>
<P>For some, this might be a case of two wrongs making a "well, I guess it's a little better than nothing". And at least the to platforms are moving towards consistency.</P>
<P>Though if you are one of the many people who use to rely on LANG_CHINESE returning the same results in NLS functions as 0x0404, you will probably not even agree with that, and it is probably just better to call it a mess and leave it where it is.... </P>
<P>Though to be honest, if you ever relied on the old behavior of 0x0004 in Windows then you were probably doomed anyway, given that from a resource standpoint that means you were wrong at least 40% of the time already. In the end it probably is better to support the crowd of people who use something correctly 100% of the time than to support the people whio use something incorrectly that only partially worked 60% of the time. :-)</P>
<P mce_keep="true">&nbsp;</P>
<P mce_keep="true"><FONT color=#ff00ff><EM>This post brought to you by</EM>&nbsp;<FONT size=6>ê„¬</FONT> <EM>(<A class="" href="http://www.fileformat.info/info/unicode/char/a12c" mce_href="http://www.fileformat.info/info/unicode/char/a12c">U+a12c</A>, a.k.a. YI SYLLABLE TOP)</EM></FONT></P></FONT>
<hr/><p><a id="1012492" href="#1012492">#</a> <strong>Maurits [MSFT]</strong> on 7 Nov 2006 3:33 AM:</p><div style="margin-left: 1em"><p>The West Wing stole that exchange from the 1995 movie The American President. :)</p>
</div>
<p><a id="1012502" href="#1012502">#</a> <strong>Michael S. Kaplan</strong> on 7 Nov 2006 3:38 AM:</p><div style="margin-left: 1em"><p>Actually, it may have just been me confusing my Sorkin references. :-)</p>
</div>
<hr/><p><em>referenced by</em></p><div style="margin-left: 1em"><p>2009/09/02 <a href="http://archives.miloush.net/michkap/archive/2009/09/02/9890204.html">How ConvertDefaultLocale sorta broke backward compatibility in Windows 7, and why</a></p><p>2008/11/12 <a href="http://archives.miloush.net/michkap/archive/2008/11/12/9061211.html">You can either be intuitive and completely inconsistent, or consistent and completely unintuitive!</a></p></div><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2006/11/07/1013908.html" title="When it comes to duration, the little things can mean a lot">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2006/11/06/993944.html" title="Who owns English, exactly?">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2006-11">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2006-11-07">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2006/11/07/1011692.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:39 GMT -->
</html>