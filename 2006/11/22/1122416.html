<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2006/11/22/1122416.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:39 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>Fixing the sample code for getting ELK cultures on other platforms</title></head><body>
<h1>Fixing the sample code for getting ELK cultures on other platforms</h1>
<p><em>by Michael S. Kaplan, published on 2006/11/22 08:46 -05:00, original URI: http://blogs.msdn.com/b/michkap/archive/2006/11/22/1122416.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostNew -->
<FONT face=Tahoma size=3>
<P>Sometimes one blog post leads to something that explains a problem someone was seeing with another blog post. </P>
<P>For example. take <STRONG><A class="" href="http://archives.miloush.net/michkap/archive/2006/04/20/579579.html" mce_href="http://archives.miloush.net/michkap/archive/2006/04/20/579579.html">Sample code for getting ELK cultures on other platforms</A></STRONG>, which was based on <STRONG><A class="" href="http://archives.miloush.net/michkap/archive/2006/02/07/526339.html" mce_href="http://archives.miloush.net/michkap/archive/2006/02/07/526339.html">ELK cultures for other platforms</A></STRONG>.</P>
<P>There was a <A class="" href="http://archives.miloush.net/michkap/archive/2006/04/20/579579.html#610337" mce_href="http://archives.miloush.net/michkap/archive/2006/04/20/579579.html#610337">comment</A> in the post that I missed from <A href="http://blogs.msdn.com/utility/Redirect.aspx?U=http%3a%2f%2fwww.k2nenergy.com" target=_blank rel=nofollow>Andy Brown</A> which explained that there was a problem getting the code to work right on Server 2003. I really wish I had noticed the comment (I am not sure what happened there, sorry about that Andy!), but my more recent <STRONG><A class="" href="http://archives.miloush.net/michkap/archive/2006/10/09/807446.html" mce_href="http://archives.miloush.net/michkap/archive/2006/10/09/807446.html">Where the hell did Replacement Locales come from?</A></STRONG> post does explain what is going on here....</P>
<P>A replacement locale (which is what cy-GB is on XP SP2 and Vista) cannot change the <A class="" href="http://msdn2.microsoft.com/en-us/library/system.globalization.cultureandregioninfobuilder.textinfo.aspx" mce_href="http://msdn2.microsoft.com/en-us/library/system.globalization.cultureandregioninfobuilder.textinfo.aspx">TextInfo</A> or <A class="" href="http://msdn2.microsoft.com/en-us/library/system.globalization.cultureandregioninfobuilder.compareinfo.aspx" mce_href="http://msdn2.microsoft.com/en-us/library/system.globalization.cultureandregioninfobuilder.compareinfo.aspx">CompareInfo</A> properties, for the reasons the later post gives. And of course those two properties are cy-GB in the LDML file. </P>
<P>But on Server 2003, cy-GB is not a replacement culture, and further its TextInfo and CompareInfo properties are set to something invalid (since it is not built in and the install of it by this whole process has not happened yet. So it will fail with the error Andy pointed out.</P>
<P>To fix, you have to set these two properties to something valid either in LDML as <A class="" href="http://murmur.bangor.ac.uk/?p=4" mce_href="http://murmur.bangor.ac.uk/?p=4">this&nbsp;post</A> suggests, or programatically as I would suggest since you are writing code anyway:</P>
<BLOCKQUOTE><STRONG><FONT face="Consolas,Lucida Console,Courier New,Courier" size=2>
<P>using System;<BR>using System.Globalization;<BR><BR>namespace Testing {<BR>&nbsp;&nbsp;&nbsp; class Test {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; [STAThread]<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; static void Main(string[] args) {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; CultureAndRegionInfoBuilder carib = CultureAndRegionInfoBuilder.CreateFromLdml(@"c:\cy-GB.ldml");<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; CultureInfo ci = new CultureInfo("en-GB");<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; carib.TextInfo = ci.TextInfo;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; carib.CompareInfo = ci.CompareInfo;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; carib.Register();<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<BR>&nbsp;&nbsp;&nbsp; }<BR>}</P></FONT></STRONG></BLOCKQUOTE>
<P>And there you have it, the code that will work here! (Or you can hand-edit the LDML file if the extra two lines of code scare you!)</P>
<P mce_keep="true">&nbsp;</P>
<P><FONT color=#ff1493><FONT face=Tahoma><EM>This post brought to you by</EM> "</FONT><FONT face="Mongolian Baiti" size=6>рай</FONT><FONT face=Tahoma>" <EM>(</EM></FONT></FONT><A href="http://www.fileformat.info/info/unicode/char/183d"><EM><FONT face=Tahoma>U+183d</FONT></EM></A><EM><FONT face=Tahoma color=#ff1493>, a.k.a. MONGOLIAN LETTER ZA)&nbsp;</FONT></EM></P></FONT>
<hr/><p><a id="1613974" href="#1613974">#</a> <strong>Andy Brown</strong> on 6 Feb 2007 4:16 PM:</p><div style="margin-left: 1em"><p>Fantastic, I'm off to try that ... thanks!</p>
<p>Andy</p></div>
<hr/><p><em>referenced by</em></p><div style="margin-left: 1em"><p>2010/09/10 <a href="http://archives.miloush.net/michkap/archive/2010/09/10/10060138.html">Doing the minimum isn't always the best plan...</a></p></div><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2006/11/23/1136924.html" title="Whither U+0081?">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2006/11/22/1121257.html" title="That problem with MSKLC created layouts and Vista, again">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2006-11">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2006-11-22">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2006/11/22/1122416.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:39 GMT -->
</html>