<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2006/11/20/1108172.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:39 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>No byte order marks when using encodings in StreamWriters?</title></head><body>
<h1>No byte order marks when using encodings in StreamWriters?</h1>
<p><em>by Michael S. Kaplan, published on 2006/11/20 05:40 -05:00, original URI: http://blogs.msdn.com/b/michkap/archive/2006/11/20/1108172.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostNew -->
<FONT face=Tahoma size=3>
<P>Sometimes the convenient shortcuts blind us to the functionality we actually need, forcing us to work a bit harder than we have to. Like when David asked not too long ago:</P>
<BLOCKQUOTE><FONT face="Times New Roman,Times" size=2>
<P>There are a handful of Encodings that have a preamble (byte order marks that get written to the file to identify the encoding).<BR><BR>Suppose I want to create a StreamWriter using a utf-8 encoding (or some other encoding that has a preamble) but do not want the byte order marks written to the stream. What is the easiest way to do it?<BR><BR>Can anyone suggest something better than defining the following and using new NoPreambleEncoding(Encoding.UTF8) as the encoding for the StreamWriter?<BR><BR><FONT face="Consolas,Lucida Console,Courier New,Courier" size=1><STRONG>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; class NoPreambleEncoding : Encoding {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Encoding _e;<BR><BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public NoPreambleEncoding(Encoding e) : base(e.CodePage) {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _e = e;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public override byte[] GetPreamble() {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return new byte[] { };<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public override int GetByteCount(char[] chars, int index, int count) {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return _e.GetByteCount(chars, index, count);<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public override int GetBytes(char[] chars, int charIndex, int charCount, byte[] bytes, int byteIndex) {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return _e.GetBytes(chars, charIndex, charCount, bytes, byteIndex);<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public override int GetCharCount(byte[] bytes, int index, int count) {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return _e.GetCharCount(bytes, index, count);<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public override int GetChars(byte[] bytes, int byteIndex, int byteCount, char[] chars, int charIndex) {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return _e.GetChars(bytes, byteIndex, byteCount, chars, charIndex);<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public override int GetMaxByteCount(int charCount) {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return _e.GetMaxByteCount(charCount);<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public override int GetMaxCharCount(int byteCount) {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return _e.GetMaxCharCount(byteCount);<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }&nbsp;</STRONG></FONT></P></FONT></BLOCKQUOTE>
<P>Now of course the above could be made to&nbsp;work with a bit more effort, but it is way more complicated than the actual answer, which would be to not use the static <A class="" href="http://msdn2.microsoft.com/en-us/library/system.text.encoding.utf8.aspx" mce_href="http://msdn2.microsoft.com/en-us/library/system.text.encoding.utf8.aspx">Encoding.UTF8</A> property&nbsp;the built-in <A class="" href="http://msdn2.microsoft.com/en-us/library/system.text.utf8encoding.aspx" mce_href="http://msdn2.microsoft.com/en-us/library/system.text.utf8encoding.aspx">UTF8Encoding class</A>, which has a specific <A class="" href="http://msdn2.microsoft.com/en-us/library/s064f8w2.aspx" mce_href="http://msdn2.microsoft.com/en-us/library/s064f8w2.aspx">UTF8Encoding(bool encodeShouldEmitUTF8Identifier)</A> constructor overload. :-)</P>
<P>I often find myself trash talking these shortcut properties which make some things easier, at the cost of making it appear like certain other things are impossible. This is probably unfair to them since this approach only speaks to the people I see who have trouble due to specialized requirements; it says nothing to those whose problems are solved with the shortcuts....</P>
<P><EM>(Perhaps others would have been happier if the default had been <A class="" href="http://archives.miloush.net/michkap/archive/2005/01/20/357028.html" mce_href="http://archives.miloush.net/michkap/archive/2005/01/20/357028.html">to not include the BOM</A>, but that particular ship has long since sailed of course!)</EM></P>
<P mce_keep="true">&nbsp;</P>
<P><FONT color=#ff00ff><EM>This post brought to you by&nbsp; "ï»¿" (U+feff, a.k.a.&nbsp;ZERO WIDTH NO-BREAK SPACE, of course)</EM></FONT></P></FONT>
<hr/><p><a id="1108735" href="#1108735">#</a> <strong>b6s</strong> on 20 Nov 2006 8:12 AM:</p><div style="margin-left: 1em"><p>To my knowledge, the static property UTF8Encoding.UTF8 was without BOM in .NET 1.1; however, it is inherited from Encoding.UTF8 now in .NET 2.0 and certainly with BOM. This difference makes me have to revise my several file I/O codes... :(</p></div>
<p><a id="1108983" href="#1108983">#</a> <strong>Michael S. Kaplan</strong> on 20 Nov 2006 9:48 AM:</p><div style="margin-left: 1em"><p>UTF8Encoding.UTF8 and Encoding.UTF8 are kind of the same thing, so if one changed they both probably would. Hmmm.... that's not very backward compatible, if it's true. That should not have changed....</p>
</div>
<p><a id="1111393" href="#1111393">#</a> <strong>Dean Harding</strong> on 20 Nov 2006 5:40 PM:</p><div style="margin-left: 1em"><p>I like shortcuts... after all, if programming languages didn't ever have shortcuts, we'd be stuck with &quot;if&quot; and &quot;goto&quot; and nothing else :-)</p>
</div>
<hr/><p><em>referenced by</em></p><div style="margin-left: 1em"><p>2007/01/13 <a href="http://archives.miloush.net/michkap/archive/2007/01/13/1460188.html">RichTextBox breaking ranks?</a></p></div><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2006/11/20/1112734.html" title="Putting the *backward* in backward compatibility">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2006/11/19/1106351.html" title="Another satisfied customer!">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2006-11">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2006-11-20">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2006/11/20/1108172.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:39 GMT -->
</html>