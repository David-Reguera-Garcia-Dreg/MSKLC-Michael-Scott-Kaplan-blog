<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2006/04/15/577006.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:40 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>MFC/CRT build instructions tweaklets</title></head><body>
<h1>MFC/CRT build instructions tweaklets</h1>
<p><em>by Michael S. Kaplan, published on 2006/04/15 19:01 -04:00, original URI: http://blogs.msdn.com/b/michkap/archive/2006/04/15/577006.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostNew -->
<P><FONT face=Tahoma>The other day I got some mail about the instructions for rebuilding the Microsoft Foundation Classes and the C Runtime with the MS Layer for Unicode:</FONT></P><FONT face=Tahoma><FONT face="Times New Roman" size=2>
<BLOCKQUOTE dir=ltr style="MARGIN-RIGHT: 0px">
<P>Hi Michael, two things need to be tweaked in the (otherwise, delightfully clear) docs on rebuilding the CRT and MFC libs. For 7.1, the atl path for the location of atlmfc.mak is given as "vc7/atlmfc", when I found it in "/vc7/atlmfc/src".<BR><BR><FONT size=2>And second, and much more important, is that when compiling the MFC portion, please specify that a new Command Prompt window should be used after compiling the CRT libs. I gather that the make process twiddles with a lot of the env vars, corrupting them for the MFC make, causing a bunch of C2220 errors. That cose me a better part of a day trying to track that down:</FONT></P>
<BLOCKQUOTE dir=ltr style="MARGIN-RIGHT: 0px">
<P><FONT face="Times New Roman" size=2><FONT size=2>...while the CRT stuff worked just as expected, my recompile of the ATL threw some errors. Specifically, this is for the 7.1 libs. And I am getting the error:<BR><BR>D:\MSVC .Net\Vc7\atlmfc\src&gt;nmake -f atlmfc.mak MFC libname=MFC71L <BR><BR>setting PLATFORM=INTEL<BR><BR>if not exist ..\lib\INTEL md ..\lib\INTEL<BR><BR>cd mfc<BR><BR>nmake / DEBUG=0 _OD_EXT= PLATFORM=INTEL<BR><BR>cl @C:\DOCUME~1\MSMITH~1.COR\LOCALS~1\Temp\nm6773.tmp<BR><BR>objcore.cpp<BR><BR>D:\MSVC .Net\Vc7\atlmfc\include\afxv_w32.h(134) : error C2220: warning treated as error - no object file generated<BR><BR>D:\MSVC .Net\Vc7\atlmfc\include\afxv_w32.h(134) : warning C4005: 'NOSERVICE' : macro redefinition<BR><BR>command-line arguments : see previous definition of 'NOSERVICE'<BR><BR>D:\MSVC .Net\Vc7\atlmfc\include\atldef.h(261) : warning C4005: 'WIN32_LEAN_AND_MEAN' : macro redefinition<BR><BR>command-line arguments : see previous definition of 'WIN32_LEAN_AND_MEAN'</P></BLOCKQUOTE></FONT></FONT></BLOCKQUOTE></FONT></FONT>
<P><FONT face=Tahoma>I talked to the author if the instructions, and&nbsp;I</FONT><FONT face=Tahoma> did take care of that first part, the error in the path.</FONT></P>
<P><FONT face=Tahoma>But he noticed that the second part was already covered in the instructions, for all four versions (</FONT><FONT face=Tahoma><A id=bp___v___bs___lcl___Categories__ctl6_Links__ctl1_Link HREF="http://archives.miloush.net/michkap/archive/2004/12/06/276122.html">6.0</A>, <A id=bp___v___bs___lcl___Categories__ctl6_Links__ctl2_Link HREF="http://archives.miloush.net/michkap/archive/2004/12/06/276123.html">7.0</A>, <A id=bp___v___bs___lcl___Categories__ctl6_Links__ctl3_Link HREF="http://archives.miloush.net/michkap/archive/2004/12/06/276124.html">7.1</A>, and <A id=bp___v___bs___lcl___Categories__ctl6_Links__ctl4_Link HREF="http://archives.miloush.net/michkap/archive/2005/10/07/478235.html">8.0</A>):</FONT></P>
<BLOCKQUOTE dir=ltr style="MARGIN-RIGHT: 0px">
<BLOCKQUOTE dir=ltr style="MARGIN-RIGHT: 0px">
<P><FONT face=Tahoma><FONT face="Times New Roman">...as the CRT build defines some&nbsp;symbols that MFC build also uses,&nbsp;a user cannot build MFC in the same command prompt "session" as the CRT.&nbsp; They must exit the command prompt and create a new&nbsp;command prompt session&nbsp;and then start the MFC build from that session..&nbsp; <BR><BR></FONT><FONT face="Times New Roman">Actually, come to think of it, we already mention this in the instructions: "<STRONG>The CRT build is now done.&nbsp; Before proceeding any further we need to close the command prompt that we used to build the CRT because it created certain environment variables that will cause compile errors in the next step, building the Unicode version of MFC</STRONG>."<BR><BR></FONT><FONT face="Times New Roman">So if the user had followed those instructions they would have succeeded beyond their wildest dreams.&nbsp;&nbsp; :)</FONT></P></BLOCKQUOTE></BLOCKQUOTE>
<P>I went ahead and made it RED in each set of instructions so that people would be able to feel embarrassed if they did not see it. :-)</FONT></P>
<hr/><div style="margin-left: 1em"><em>no comments</em></div><hr/><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2006/04/16/577083.html" title="She slipped out last Friday">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2006/04/15/576984.html" title="Offense can be a cultural thing">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2006-04">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2006-04-15">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2006/04/15/577006.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:40 GMT -->
</html>