<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2006/04/26/583390.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:39 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>How to NOT Parse Unicode Digits, or How to: Parse Unicode Digits... NOT!</title></head><body>
<h1>How to NOT Parse Unicode Digits, or How to: Parse Unicode Digits... NOT!</h1>
<p><em>by Michael S. Kaplan, published on 2006/04/26 03:01 -04:00, original URI: http://blogs.msdn.com/b/michkap/archive/2006/04/26/583390.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostNew -->
<P><FONT face=Tahoma>I have talked about digit substitution <A HREF="http://archives.miloush.net/michkap/archive/2005/04/24/411329.html">many</A> <A HREF="http://archives.miloush.net/michkap/archive/2004/12/01/272864.html">times</A> <A HREF="http://archives.miloush.net/michkap/archive/2005/09/09/462920.html">in</A> <A HREF="http://archives.miloush.net/michkap/archive/2005/07/09/437071.html">the</A> <A HREF="http://archives.miloush.net/michkap/archive/2006/01/18/514171.html">past</A>.</FONT></P>
<P><FONT face=Tahoma>I was reminded of it recently when developer Kollen pointed put a <A href="http://msdn2.microsoft.com/en-US/library/w1c0s6bb.aspx">pretty lame article</A>:</FONT></P><FONT face=Tahoma><FONT size=2>
<BLOCKQUOTE dir=ltr style="MARGIN-RIGHT: 0px">
<P>I have a bug on parsing fullwidth Unicode digits and I noticed the (poorly named) "How to: Parse Unicode Digits" section of the .NET docs that indicates this behavior is by design. Are there any alternatives? Why doesn't this API support more than just the ASCII equivalent digits in Unicode?</P></BLOCKQUOTE></FONT></FONT>
<P><FONT face=Tahoma>Kollen&nbsp;is right, this article is poorly named. But beyond that, what is the benefit of putting together a huge function with no other purpose than to <STRONG>not</STRONG> work? How many times will people not read the surrounding text and copy/paste that code into their applications?</FONT></P>
<P><FONT face=Tahoma>Yuck!</FONT></P>
<P><FONT face=Tahoma>Well, at least the answer to Kollen's other question can be found <A HREF="http://archives.miloush.net/michkap/archive/2005/04/24/411329.html">here</A>.... :-)</FONT></P>
<P><FONT face=Tahoma></FONT>&nbsp;</P>
<P><FONT face=Tahoma color=#ff1493><EM>This post brought to you by</EM> "ï¼™"&nbsp;<EM>(<A href="http://www.fileformat.info/info/unicode/char/ff19">U+ff19</A>, FULLWIDTH DIGIT NINE)<BR><FONT size=1>(a Unicode charascter that is dressed to the nines....)</FONT></EM></FONT></P>
<hr/><p><a id="584547" href="#584547">#</a> <strong>Maurits [MSFT]</strong> on 26 Apr 2006 6:01 PM:</p><div style="margin-left: 1em">&gt; what is the benefit of putting together a huge function with no other purpose than to not work?<br><br>Well, it sort of works:<br>&quot;The attempts to parse ASCII digits and ASCII digits specified as Unicode code values succeed.&quot;<br><br>So, in other words, Decimal.Parse can handle 16-bit characters.<br><br>But it can't (yet?) parse numbers higher than U+00FF.<br><br>It's good that this behavior is documented. &nbsp;This is the kind of grey area which customers swear is a bug: &quot;If you can ACCEPT U+0660, why can't you PARSE it??&quot;<br><br>... but which developers swear is creeping featurism*: &quot;It's simple for customers to modify the input string... just subtract (U+0660 - U+0030) for every character in the range U+0660 to U+0669, etc.&quot;<br><br>It doesn't seem technically difficult to write a Decimal.ParseUnicode that could handle all of these:<br><a rel="nofollow" target="_new" href="http://www.fileformat.info/info/unicode/category/Nd/list.htm">http://www.fileformat.info/info/unicode/category/Nd/list.htm</a><br><br>but it may be more trouble than it's worth!<br><br>* <a rel="nofollow" target="_new" href="http://en.wikipedia.org/wiki/Creeping_featurism">http://en.wikipedia.org/wiki/Creeping_featurism</a></div>
<p><a id="584571" href="#584571">#</a> <strong>Maurits [MSFT]</strong> on 26 Apr 2006 6:30 PM:</p><div style="margin-left: 1em">Hmmm... is there even a way to know that U+01d7ff is a digit, short of hardcoding it? GetStringTypeW(...) doesn't work for supplemental code points. &nbsp;Is there a new character-class-looker-upper-thing in Vista?</div>
<p><a id="584577" href="#584577">#</a> <strong>Maurits [MSFT]</strong> on 26 Apr 2006 6:39 PM:</p><div style="margin-left: 1em">I remember you brought up CharUnicodeInfo.GetUnicodeCategory Method (String, Int32)<br><a rel="nofollow" target="_new" href="http://msdn2.microsoft.com/en-us/library/a91e3zb6">http://msdn2.microsoft.com/en-us/library/a91e3zb6</a>(VS.80).aspx<br><br>Is there an unmanaged equivalent?<br></div>
<p><a id="584596" href="#584596">#</a> <strong>Maurits [MSFT]</strong> on 26 Apr 2006 7:20 PM:</p><div style="margin-left: 1em">Hey all those digits are assigned in consecutive blocks, zero to nine! I could write a completely [Nd]-driven Decimal.Parse as follows:<br><br>int Decimal.Parse(string) {<br>blow up if string is null or &quot;&quot;;<br>int i = 0;<br>for each Unicode character (not UTF-16 character) in the string {<br>i *= 10;<br>i += DecimalValueOf(that character);<br>}<br>}<br><br>int DecimalValueOf(Unicode character) { // not UTF-16 character<br>blow up unless character is in [Nd] class;<br>int i = 1;<br>for (;;)<br>{<br>check the character class of (character - i);<br>if it's Nd, break;<br>}<br><br>return (i - 1) % 10; // allow for consecutive blocks of 10<br><br>}<br><br>I worry about (little-endian vs. big-endian)/(LTR vs. RTL)... that should be tested.<br><br>Also this would break if a future block of digits was nonconsecutive. :(</div>
<p><a id="584708" href="#584708">#</a> <strong>Michael S. Kaplan</strong> on 26 Apr 2006 11:02 PM:</p><div style="margin-left: 1em">There is no unmanaged equivalent for full UCD information that includes supplementary characters, though it is the sort of thing that is being consdidered for the future....</div>
<p><a id="585119" href="#585119">#</a> <strong>Maurits [MSFT]</strong> on 27 Apr 2006 11:23 AM:</p><div style="margin-left: 1em">I can understand why native full support for supplementary characters would be a relatively low priority, given that<br>* Hardly anybody uses them<br>* They're hard (especially since natively everything's UTF-16)<br>* Any app who really cares could include<br><a rel="nofollow" target="_new" href="http://www.unicode.org/Public/UNIDATA/UnicodeData.txt">http://www.unicode.org/Public/UNIDATA/UnicodeData.txt</a><br>and a parsing routine</div>
<p><a id="585156" href="#585156">#</a> <strong>Maurits [MSFT]</strong> on 27 Apr 2006 12:09 PM:</p><div style="margin-left: 1em">Wow, UnicodeData.txt even includes the numeric value of the N* characters! &nbsp;That's useful.<br><br><a rel="nofollow" target="_new" href="http://www.unicode.org/Public/UNIDATA/UCD.html#UnicodeData.txt">http://www.unicode.org/Public/UNIDATA/UCD.html#UnicodeData.txt</a><br>(fields 6, 7, and 8, depending on what * is)</div>
<p><a id="585158" href="#585158">#</a> <strong>Michael S. Kaplan</strong> on 27 Apr 2006 12:10 PM:</p><div style="margin-left: 1em">Well, I am not saying that it isn't important -- but how to support it (and properties in general) given the function we have (GetStringTypeW) is not an easy task to do.<br><br>Though I have my own opinions, and I may blog about them some day....</div>
<p><a id="585348" href="#585348">#</a> <strong>Maurits [MSFT]</strong> on 27 Apr 2006 2:30 PM:</p><div style="margin-left: 1em">&gt; UnicodeData.txt even includes the numeric value of the N* characters<br><br>Except for two...<br>U+09F8 BENGALI CURRENCY NUMERATOR ONE LESS THAN THE DENOMINATOR<br>U+2183 ROMAN NUMERAL REVERSED ONE HUNDRED</div>
<p><a id="585368" href="#585368">#</a> <strong>Maurits [MSFT]</strong> on 27 Apr 2006 2:54 PM:</p><div style="margin-left: 1em">This is where it's at, right here...<br><br>U+01014E GREEK ACROPHONIC ATTIC FIVE THOUSAND TALENTS<br><br>A talent is about $500,000<br><a rel="nofollow" target="_new" href="http://en.wikipedia.org/wiki/Talent_(weight)">http://en.wikipedia.org/wiki/Talent_%28weight%29</a><br><br>So U+01014E is about $2,500,000,000 (sh-ching!)</div>
<p><a id="585611" href="#585611">#</a> <strong>Maurits [MSFT]</strong> on 27 Apr 2006 8:19 PM:</p><div style="margin-left: 1em">This is some good documentation, right here:<br><a rel="nofollow" target="_new" href="http://msdn2.microsoft.com/en-us/library/fw9t1kbk">http://msdn2.microsoft.com/en-us/library/fw9t1kbk</a>(VS.80).aspx<br><br>I especially like that it points out the U+0F33 TIBETAN DIGIT HALF ZERO case. &nbsp;Important because it illustrates the necessity of checking the return for EXACTLY the sentinel value -1, and not just broadly checking &lt; 0.<br><br>if (GetDigitValue(ch) == -1) // OK<br><br>if (GetDigitValue(ch) &lt; 0) // ERROR: misses U+0F33 !!<br><br>One of the very rare instances where using == on a double is the Right Thing... though I suppose<br><br>if (abs(GetDigitValue(ch) + 1) &lt; 0.005) // digit value is -1ish<br><br>would also work</div>
<p><a id="585617" href="#585617">#</a> <strong>Maurits [MSFT]</strong> on 27 Apr 2006 8:28 PM:</p><div style="margin-left: 1em">Er, I meant GetNumericValue(ch), of course.</div>
<hr/><p><em>referenced by</em></p><div style="margin-left: 1em"><p>2010/11/12 <a href="http://archives.miloush.net/michkap/archive/2010/11/12/10088056.html">Suddenly, in a bit more time than a blink of an eye, "standards support" becomes "less i18n support"</a></p><p>2008/10/02 <a href="http://archives.miloush.net/michkap/archive/2008/10/02/8971896.html">When swimming in a sea of CONTEXT, applications can drown (and there is no lifeguard)</a></p></div><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2006/04/27/584439.html" title="The disunification of Norwegian and Danish sorting">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2006/04/25/583307.html" title="Why do we call w &#39;double u&#39; -- doesn&#39;t it look more like a &#39;double v&#39; ?">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2006-04">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2006-04-26">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2006/04/26/583390.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:39 GMT -->
</html>