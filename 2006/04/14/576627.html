<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2006/04/14/576627.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:40 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>Long term planning is not always done</title></head><body>
<h1>Long term planning is not always done</h1>
<p><em>by Michael S. Kaplan, published on 2006/04/14 16:05 -04:00, original URI: http://blogs.msdn.com/b/michkap/archive/2006/04/14/576627.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostNew -->
<P><FONT face=Tahoma>Starting in the 2.0 version of the .NET Framework,&nbsp;Microsoft has had the <A href="http://msdn2.microsoft.com/en-us/library/system.globalization.umalquracalendar(VS.80).aspx">UmAlQuraCalendar Class</A>, which is a more secular version of the <A href="http://msdn2.microsoft.com/en-us/library/system.globalization.hijricalendar(VS.80).aspx">HijriCalendar class</A> in that it is based on a table-based algorithm, and does not support the "advance date" functionality I have talked about <A HREF="http://archives.miloush.net/michkap/archive/2005/04/03/404931.html"><STRONG>in the past</STRONG></A>.</FONT></P>
<P><FONT face=Tahoma>While still somewhat controversial with religious authorities who object to a calendar that is not based on the moon sighting </FONT><FONT face=Tahoma>(just&nbsp;as they object to technology to <A HREF="http://archives.miloush.net/michkap/archive/2005/04/26/412398.html"><STRONG>help with the sighting</STRONG></A>&nbsp;in some cases), it is to others a reasonable compromise for the need to have a more predictable calendar in the secular world.</FONT></P>
<P><FONT face=Tahoma>Which is not to say there are not some limitations.</FONT></P>
<P><FONT face=Tahoma>Try the following code:</FONT></P>
<BLOCKQUOTE dir=ltr style="MARGIN-RIGHT: 0px">
<BLOCKQUOTE dir=ltr style="MARGIN-RIGHT: 0px">
<P><FONT face="Courier New" size=2><STRONG>using System;<BR>using System.Globalization;</STRONG></FONT></P>
<P><FONT face="Courier New" size=2><STRONG>public class Test<BR>{</STRONG></FONT></P>
<P><FONT face="Courier New" size=2><STRONG>&nbsp;&nbsp;&nbsp; public static void Main()<BR>&nbsp;&nbsp;&nbsp; {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; DateTime dtLater = new DateTime(2030, 1, 1);<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; UmAlQuraCalendar uaqc = new UmAlQuraCalendar();<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; DateTime dtMuchLater = uaqc.AddMonths(dtLater, 1);<BR>&nbsp;&nbsp;&nbsp; }</STRONG></FONT></P>
<P><FONT face="Courier New" size=2><STRONG>}</STRONG></FONT></P></BLOCKQUOTE></BLOCKQUOTE>
<P><FONT face=Tahoma>The clever among you might object that this code does nothing with the date it has calculated, so what is its's point?</FONT></P>
<P><FONT face=Tahoma>Well, try it out and compile it. Once you run the small application, here is what it will say:</FONT></P>
<P><STRONG><FONT face="Courier New" size=1>Unhandled Exception: System.ArgumentOutOfRangeException: Specified time is not supported in this calendar. It should be between 04/30/1900 00:00:00 (Gregorian date) and 05/13/2029 23:59:59 (Gregorian date), inclusive.<BR>Parameter name: time<BR>&nbsp;&nbsp; at System.Globalization.UmAlQuraCalendar.CheckTicksRange(Int64 ticks)<BR>&nbsp;&nbsp; at System.Globalization.UmAlQuraCalendar.GetDatePart(DateTime time, Int32 part)<BR>&nbsp;&nbsp; at System.Globalization.UmAlQuraCalendar.AddMonths(DateTime time, Int32 months)<BR>&nbsp;&nbsp; at Test.Main()</FONT></STRONG></P>
<P><FONT face=Tahoma>Hmmm... that seems like a problem, doesn't it?</FONT></P>
<P><FONT face=Tahoma>Well, it is working as designed, per the <A href="http://msdn2.microsoft.com/en-us/library/system.globalization.umalquracalendar(VS.80).aspx">docs</A>:</FONT></P>
<BLOCKQUOTE dir=ltr style="MARGIN-RIGHT: 0px">
<P><FONT face=Tahoma><FONT face="Times New Roman">Remarks:</FONT><BR><FONT face="Times New Roman">The <B>UmAlQuraCalendar</B> class is nearly identical to the <EM>HijriCalendar</EM> class, except the Saudi Hijri calendar uses a table-based algorithm licensed from the Saudi government to calculate dates, can express dates to the year 1450 A.H., and does not support the <EM>HijriAdjustment</EM> property. </FONT></P></BLOCKQUOTE>
<P><FONT face=Tahoma>And one of the downsides of a table-based calendar is that until tables exist there is no especially good answer on what to do other than throw an exception (the moral equivalent of walking off the end of the table).</FONT></P>
<P><FONT face=Tahoma>But certainly&nbsp;such a problem&nbsp;can have an impact on being able to use the calendar in everyday secular matters, couldn't it?</FONT></P>
<P><FONT face=Tahoma>Obviously something better will have to happen here for people to be able make appropriate use of it as a calendar in many different scenarios....</FONT></P>
<P><FONT face=Tahoma></FONT>&nbsp;</P>
<P><FONT face=Tahoma color=#ff1493><EM>This post brought to you by</EM> "<FONT size=6>ޓ</FONT>" <EM>(<A href="http://www.fileformat.info/info/unicode/char/0793">U+0793</A>, a.k.a. THAANA LETTER TAVIYANI)</EM></FONT></P></FONT>
<hr/><p><a id="576735" href="#576735">#</a> <strong>Maurits [MSFT]</strong> on 14 Apr 2006 8:05 PM:</p><div style="margin-left: 1em">... well... in... principle... you... could... um...<br><br>(shudder)<br><br>(deep breath)<br><br>Create publishing points<br><a rel="nofollow" target="_new" href="http://globalization.microsoft.com/calendars/UmAlQura-Tables">http://globalization.microsoft.com/calendars/UmAlQura-Tables</a><br><a rel="nofollow" target="_new" href="http://globalization.microsoft.com/calendars/Hijri-ConfirmedMoonSightings">http://globalization.microsoft.com/calendars/Hijri-ConfirmedMoonSightings</a><br><br>Have .Net clients connect to these publishing points under controlled circumstances<br><br>Have them store the latest data in some kind of local cache so they don't have to requery every time they're run<br>(release)<br><br>Oy.<br><br>It's fun to laugh at religious control of science. &nbsp;But at least they didn't try to make π = 4<br><a rel="nofollow" target="_new" href="http://www.straightdope.com/classics/a3_341.html">http://www.straightdope.com/classics/a3_341.html</a></div>
<p><a id="576877" href="#576877">#</a> <strong>Michael S. Kaplan</strong> on 15 Apr 2006 9:35 AM:</p><div style="margin-left: 1em">Of course in Indiana (according to my sources and the article you cite) they did not make a claim based on religious grounds....</div>
<p><a id="576878" href="#576878">#</a> <strong>Michael S. Kaplan</strong> on 15 Apr 2006 9:38 AM:</p><div style="margin-left: 1em">Oh, one other thing! A web service will not help the immediate problem; it will only make updates easier. The fact that the standard for the new calendar is not going to work for reasonable dates is still a problem (and it has tried to get away from the religious overtones)....</div>
<p><a id="576925" href="#576925">#</a> <strong>Maurits [MSFT]</strong> on 15 Apr 2006 1:32 PM:</p><div style="margin-left: 1em">&gt; A web service will not help the immediate problem; it will only make updates easier<br><br>Indeed. &nbsp;The nondeterministic status of the calendar is not a problem that can be fixed. &nbsp;Updates will be more and more important to any users of this calendar as we approach 2030.<br><br>&gt; the standard for the new calendar is not going to work for reasonable dates is still a problem<br><br>But a fundamental one (rimshot)<br><br>Leap seconds have the same problem, which (I suppose) is why nobody implements them, and just leaves it to the internet NTP servers to slew our clocks by a second every 18 months or so.</div>
<hr/><p><em>referenced by</em></p><div style="margin-left: 1em"><p>2011/06/15 <a href="http://archives.miloush.net/michkap/archive/2011/06/15/10174716.html">Does your code avoid the [government sanctioned] Y1.45K bug?</a></p><p>2011/02/26 <a href="http://archives.miloush.net/michkap/archive/2011/02/26/10134403.html">Why I don't like the JapaneseCalendar class #1: Respecting (or at least admitting) the history....</a></p><p>2010/02/12 <a href="http://archives.miloush.net/michkap/archive/2010/02/12/9962835.html">Evil Date Parsing lives! Viva Evil Date Parsing!, explained</a></p><p>2008/12/16 <a href="http://archives.miloush.net/michkap/archive/2008/12/16/9225748.html">Grody to the Max[Date]!</a></p><p>2006/09/29 <a href="http://archives.miloush.net/michkap/archive/2006/09/29/776495.html">.NET is too busy being consistent with Windows to be consistent with itself....</a></p><p>2006/09/18 <a href="http://archives.miloush.net/michkap/archive/2006/09/18/760232.html">More on changes to the Hijri calendar?</a></p></div><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2006/04/15/576984.html" title="Offense can be a cultural thing">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2006/04/14/576530.html" title="Every character has a story; some of them have cartoons!">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2006-04">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2006-04-14">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2006/04/14/576627.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:40 GMT -->
</html>