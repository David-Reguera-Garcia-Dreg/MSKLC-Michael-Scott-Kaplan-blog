<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2006/04/24/581628.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:39 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>Why I am not in favor of a FileSystemInfo.Compare method</title></head><body>
<h1>Why I am not in favor of a FileSystemInfo.Compare method</h1>
<p><em>by Michael S. Kaplan, published on 2006/04/24 03:01 -04:00, original URI: http://blogs.msdn.com/b/michkap/archive/2006/04/24/581628.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostNew -->
<P><FONT face=Tahoma>Back in January of this year, reader J. Daniel Smith asked:</FONT></P>
<BLOCKQUOTE dir=ltr style="MARGIN-RIGHT: 0px">
<P><FONT face="Times New Roman" size=2>Did I miss your other blog entry on this topic? <BR>----- <BR>re: Comparing Unicode file names the right way <BR><BR>Tuesday, October 18, 2005 3:51 PM by Michael S. Kaplan <BR>Ah, the reasons I am resistant to *that* particular path are the subject of another blog entry, coming soon! :-) </FONT></P></BLOCKQUOTE><FONT face=Tahoma>
<P><FONT face=Tahoma>My sense of temporal logistics is pretty skewed compared to everyone else's. :-)</FONT></P>
<P>He was referring to <A href="http://archives.miloush.net/michkap/archive/2005/10/17/481600.html">this post</A>, which was from last October, and the question that he was asking:</P>
<BLOCKQUOTE dir=ltr style="MARGIN-RIGHT: 0px">
<P><FONT face="Times New Roman" size=2>In &lt;3 weeks, there's not going to be the big gulf between managed &amp; unmanged code (I'm talking about VS2005 &amp; C++/CLI). <BR><BR>So if you show us the unofficial 100% correct "static int Compare(FileSystemInfo a, FileSystemInfo b)" in managed code, it will soon be fairly straight-forward to use it from unmanaged code. <BR><BR>(Of course, this assumes that you're OK doing such a thing...there may be other reasons for staying completely in unmanaged code). <BR><BR>Yes, I realize Whidbey is frozen harder than the Antarctic ice pack‚Ä¶I thought the "static" function taking two arguments made things clear; I guess not. Sorry. <BR><BR>Show us the exact C# code for your FileNameCompare() utility function; that way there can be no confusion as to the proper technique. My preference would be to take stronger-typed FileSystemInfo parameters (rather than just strings)‚Ä¶and also to indicate that eventually such code should perhaps be part of that class. </FONT></P></BLOCKQUOTE>
<P>I probably would have taken after Triumph the Insult Comic Dog and said that Whidbey was frozen&nbsp;colder than an Iditarod huky's nutsack, but that is neither here nor there, he was right in any case. :-)</P>
<P>The reason why I am troubled about the development architecture path that leads to a</P>
<BLOCKQUOTE dir=ltr style="MARGIN-RIGHT: 0px">
<P><FONT face="Courier New" size=2><STRONG>static int Compare(FileSystemInfo a, FileSystemInfo b)</STRONG></FONT></P></BLOCKQUOTE>
<P>is that the <A href="http://msdn2.microsoft.com/en-us/library/system.io.filesysteminfo(VS.80).aspx">FileSystemInfo</A> class is of course just a base class for the <A href="http://msdn2.microsoft.com/en-us/library/system.io.fileinfo.aspx">FileInfo</A> and <A href="http://msdn2.microsoft.com/en-us/library/system.io.directoryinfo.aspx">DirectoryInfo</A> classes, which contains a lot of information:</P>
<UL>
<LI>the <A href="http://msdn2.microsoft.com/en-us/library/system.io.fileattributes.aspx">FileAttributes</A> of the file or directory (archived, compressed, etc. -- look at the <A href="http://msdn2.microsoft.com/en-us/library/system.io.fileattributes.aspx">FileAttributes Enumeration</A> for more details); 
<LI>the full path and the originally specified path; 
<LI>the creation time; 
<LI>the last accessed time; 
<LI>the last written time; 
<LI>the name (which gives just the last piece of a directory or a file rather than the full path to it); 
<LI>Whether the file or directory exists.</LI></UL>
<P>Given the level of complexity inherent in these objects, the exact definition of a meaningful comparison between two <A href="http://msdn2.microsoft.com/en-us/library/system.io.filesysteminfo(VS.80).aspx">FileSystemInfo</A> objects is far from clear -- in any given situation, a developer could clearly be expecting it to mean any of these things, and not all of those varied and sometimes conflicting definitions are very farfetched!</P>
<P>However, the fact that the OrdinalIgnoreCase semantic is a 100% match for what&nbsp;many of the methods and functions that make use of the&nbsp;NTFS/FAT filesystems it itself clear (to anyone who reads this blog? &lt;grin&gt;), and it really is comparing the file <STRONG>names</STRONG> (which are in fact strings), not <A href="http://msdn2.microsoft.com/en-us/library/system.io.filesysteminfo(VS.80).aspx">FileSystemInfo</A> objects, which are something else entirely.</P>
<P>Which is not to say that no one would ever add such a method; it happens all the time over in the Windows Shell -- it is why the Shell Lightweight API has so many wrappers around our stuff!</P>
<P>But this leasd (unfortunately) to another, more insidious, problem:</P>
<P>And there are theoretical benefits to such a method if the various underlying filesystems exposed their actual comparison semantics such that one could wrap up the case sensitive nature of CDFS and the case insensitive nature of NTFS/FAT32/FAT and all of the other various&nbsp;differences.</P>
<P>The problem <STRONG>there</STRONG> is that the information is simply not exposed and until it is, the only way to do such tests with 100% accuracy is to create the file, which is not always possible for a myruad of reasons related to permissions and media.</P>
<P>And what happens when you have multiple media forms connected in a single path via symbolic links? In such cases support in the underlying file systems is crucial -- since there is NO ONE TEST that would suffice.</P>
<P>I had high hopes that I could convince Kevin Phaup to require such a comparison method when he was still at Microsoft and that he could convince the people in charge of the various drivers. But now he is no longer at Microsoft and there is no one on that side of the company who I can say I have gone to a party with, or seen their house. Which for some reasons dashes my hopes a bit.... :-(</P>
<P>But anyway, these are but a few of the reasons why the direction of a <A href="http://msdn2.microsoft.com/en-us/library/system.io.filesysteminfo(VS.80).aspx">FileSystemInfo</A>&nbsp;wrapper to handle comparison is something that I am highly resistant to.</P>
<P>&nbsp;</P>
<P><FONT color=#ff1493><FONT face=Tahoma><EM>This post brought to you by</EM> "</FONT><FONT size=6>êÉ∫</FONT><FONT face=Tahoma>" <EM>(U+100fa, a.k.a. LINEAR B IDEOGRAM VESSEL B305)</EM></FONT></FONT></FONT></P>
<hr/><p><a id="585303" href="#585303">#</a> <strong>J. Daniel Smith</strong> on 27 Apr 2006 1:56 PM:</p><div style="margin-left: 1em">To some extent, strings have become what ints were in C. &nbsp;In C, everything was an &quot;int&quot;: bools, pointers, enums, etc. (yes, I'm exaggerating some).<br><br>We now use strings the same way: file system paths, a person's name, URLs, guids, etc. &nbsp;Some parts of the BCL recognize that some strings have additional semantics and provide classes like System.Guid and System.Uri.<br><br>As another example, a string which represent's a person's name should probably always compare case-insensitive and titles might be ignored: &quot;Mr. Dan Smith&quot; is often the same as &quot;DAN SMITH&quot;.<br><br>Given that, I would suggest that FileInfo (or FileSystemInfo) can be used as a more strongly typed string. &nbsp;Although, as you mention, there's more to FileSystemInfo than System.Guid.<br></div>
<p><a id="592383" href="#592383">#</a> <strong>Michael S. Kaplan</strong> on 8 May 2006 10:27 AM:</p><div style="margin-left: 1em">Well, think of it another way. Almost everyone would expect (or at least want!) the following paths to be considered equal in such a method: <BR><BR>\\machine\share\directory\filename.ext <BR>\\machine\d$\directory\filename.ext <BR>d:\directory\filename.ext <BR><BR>Though of course the filenames are not equal....</div>
<hr/><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2006/04/24/581700.html" title="When the documentation is confusing, it is often because the functionality is, too">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2006/04/23/581761.html" title="Suri [with the fringe on top]">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2006-04">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2006-04-24">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2006/04/24/581628.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:39 GMT -->
</html>