<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2006/03/18/554308.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:40 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>What about logical fonts?</title></head><body>
<h1>What about logical fonts?</h1>
<p><em>by Michael S. Kaplan, published on 2006/03/18 05:01 -05:00, original URI: http://blogs.msdn.com/b/michkap/archive/2006/03/18/554308.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostNew -->
<P><FONT face=Tahoma>I have talked in this blog about a lot of different kind of font mapping features in various Microsoft technologies.</FONT></P>
<P><FONT face=Tahoma>Like <A href="http://archives.miloush.net/michkap/archive/2005/03/20/399322.html">Windows Font Substitution</A>.</FONT></P>
<P><FONT face=Tahoma>And <A href="http://archives.miloush.net/michkap/archive/2006/01/22/515864.html">GDI's Font Linking</A>.</FONT></P>
<P><FONT face=Tahoma>And <A href="http://archives.miloush.net/michkap/archive/2005/05/16/417711.html">MLang's Font Linking</A>.</FONT></P>
<P><FONT face=Tahoma>And <A href="http://archives.miloush.net/michkap/archive/2005/10/01/476022.html">Uniscribe's Font Fallback</A>.</FONT></P>
<P><FONT face=Tahoma>And <A href="http://archives.miloush.net/michkap/archive/2005/11/20/494829.html">GDI/GDI+ Private Fonts</A>.</FONT></P>
<P><FONT face=Tahoma>This post is going to be about something else though. I am going to talk about logical fonts, specifically <STRONG>MS Shell Dlg</STRONG> and <STRONG>MS Shell Dlg 2</STRONG>, which are documednted in <A href="http://msdn.microsoft.com/library/en-us/intl/nls_4qcn.asp">this Platform SDK post</A>.</FONT></P>
<P><FONT face=Tahoma>There are many important details documented there, for example:</FONT></P>
<UL>
<LI><FONT face=Tahoma size=2>Neither of these is a physical font: instead, each Windows machine maps both MS Shell Dlg and MS Shell Dlg 2 to an appropriate physical font, based on the computer's Language for non-Unicode programs, which is set either at install time or with the Control Panel item Regional and Language Options.</FONT> 
<LI><FONT face=Tahoma size=2>The actual mappings are stored in the registry key <B>HKEY_LOCAL_MACHINE\Software\Microsoft\Windows NT\Current Version\FontSubstitutes</B>.</FONT> 
<LI><FONT face=Tahoma size=2>These logical fonts allow your application to implement dialog boxes, menus, etc., that will display well on all supported Windows operating systems and across all languages. For example, if your application uses MS Shell Dlg or MS Shell Dlg 2 for its dialog boxes, then a localization team creating Greek-language resources for your application can focus on translating text, instead of being concerned with issues like the distinction between MS Sans Serif and MS Sans Serif Greek.</FONT> 
<LI><FONT face=Tahoma size=2>MS Shell Dlg supports the "classic" Windows desktop look; MS Shell Dlg 2 supports the look that was introduced with Windows 2000.</FONT> 
<LI><FONT face=Tahoma size=2>On Windows NT 4.0/2000/XP/Server 2003/Vista, both map to Unicode-based TrueType fonts. MS Shell Dlg uses Microsoft Sans Serif (which is distinct from MS Sans Serif) for Latin, Greek, Cyrillic, Arabic, Hebrew, and Thai characters; MS UI Gothic for Japanese; Gulim for Korean; Simsun for Simplified Chinese; PMinglu for Traditional Chinese; etc.</FONT> 
<LI><FONT face=Tahoma size=2>MS Shell Dlg 2 simply uses the Tahoma font: characters that are not implemented in Tahoma are available through font linking.</FONT> 
<LI><FONT face=Tahoma size=2>The main advantage of Tahoma over Microsoft Sans Serif is that Tahoma has a native bold font face.</FONT> 
<LI><FONT face=Tahoma size=2>Its main disadvantage is that older operating systems (Windows 95/98/Me, Windows NT 4.0) may not have it installed, and may substitute a font that does not look as good.</FONT></LI></UL>
<P><FONT face=Tahoma>And there are&nbsp;some really important points that are easy to miss:</FONT></P>
<UL>
<LI><FONT face=Tahoma><STRONG>Because the font generated using MS Shell Dlg is different on different versions of Windows</STRONG>, you should check that the dialog box looks good on all versions.</FONT> 
<LI><FONT face=Tahoma><STRONG>Applications that never intend to run on Windows 95/98/Me can simply use either Microsoft Sans Serif or Tahoma explicitly</STRONG>, and save the level of indirection involved in using MS Shell Dlg or MS Shell Dlg 2. Because of font linking, specifying Microsoft Sans Serif or Tahoma will give you appropriate glyphs for all languages.</FONT></LI></UL>
<P><FONT face=Tahoma>The other interesting point is the way the mapping is documented as being one that will be different on other versions of Windows.</FONT></P>
<P><FONT face=Tahoma>Especially since the font mappings underneath are not guaranteed to stay the same.</FONT></P>
<P><FONT face=Tahoma>Add to that&nbsp;the fact that different ways to use them can cause different results, as Raymond pointed out in </FONT><A href="http://blogs.msdn.com/oldnewthing/archive/2005/02/04/366987.aspx"><FONT face=Tahoma>What's the deal with the DS_SHELLFONT flag?</FONT></A></P><FONT face=Tahoma>
<P><FONT face=Tahoma>And then it ends by reminding people that these two logical fonts, which&nbsp;are based in part on the default system locale, are not always the best choice for UI fonts when the system locale changes (since it is the UI language that covers the content language for Windows, any scenario that mixes different combinations of system locale and UI language may end up with unexpected results).</FONT></P>
<P>(This is also covered in the MSKB, article <A href="http://support.microsoft.com/?kbid=282187">282187</A>&nbsp;-- an article which highlights the difference between PSS and core development teams, as the latter would never say "<EM><FONT size=2>You can manually change the font mapping if a single font will suit the needs of both the computer dialogs and the localized programs that are having display problems.</FONT></EM>")</P>
<P>Another good source of info is <A href="http://msdn.microsoft.com/library/en-us/vsent7/html/vxconLanguageIssues.asp">this</A> page, which talks mopre about what is easy and what is hard (look at the section on Fonts specifically, for help here in development).</P></FONT>
<P><FONT face=Tahoma>In summary, on the whole, unless you are either</FONT></P>
<UL>
<LI><FONT face=Tahoma>building a UI component that ships in the Windows box, or </FONT>
<LI><FONT face=Tahoma>creating other content that matches the UI language and you do not mind testing the wide array of possible settings and the way they will vary your content</FONT></LI></UL>
<P><FONT face=Tahoma>you should probably at least consider using a font <EM>other than</EM> MS Shell Dlg/MS Shell Dlg 2....</FONT></P>
<P><FONT face=Tahoma></FONT>&nbsp;</P>
<P><FONT face=Tahoma><FONT color=#ff1493><EM>This post brought to you by</EM> "<FONT size=6>â€°</FONT>" </FONT><EM><FONT color=#ff1493>(</FONT><A href="http://www.fileformat.info/info/unicode/char/2030">U+2030</A><FONT color=#ff1493>, a.k.a. PER MILLE SIGN)</FONT></EM></FONT></P>
<hr/><p><a id="554419" href="#554419">#</a> <strong>bg</strong> on 18 Mar 2006 10:10 AM:</p><div style="margin-left: 1em">Thats interesting. Some thing to think about.<br><br>Thanks.<br></div>
<p><a id="554695" href="#554695">#</a> <strong>Michael Dunn_</strong> on 19 Mar 2006 2:50 AM:</p><div style="margin-left: 1em">I've always used MS Shell Dlg, mostly because I still support 98/Me, but I also thought MS Shell Dlg was for future-proofing. If I write an app today that has Tahoma in the dialog resources, it will have Tahoma in Longhorn and thus look dated. If I use MS Shell Dlg today, it will have Segoe UI in Longhorn too and fit right in.</div>
<p><a id="555112" href="#555112">#</a> <strong>Mihai</strong> on 19 Mar 2006 4:43 PM:</p><div style="margin-left: 1em">Not really related to MS Shell Dlg and MS Shell Dlg 2, but has something to do with logical fonts.<br><br>There is no standard way (logical font?) to honor the setting that the user does in &quot;Advanced Appearance&quot; (from &quot;Display properties&quot; dialog, &quot;Appearance&quot; tab, &quot;Advanced&quot; button).<br>In the resulting dialog change fonts to something visibly different (like a a cursive script, ex &quot;Freestyle Script&quot;)<br><br>Most of the applications (including MS ones) could not care less.<br>The only way I know to do the right thing is treat WM_INITDIALOG , call SystemParametersInfo with SPI_GETNONCLIENTMETRICS, get the right font and use it to set the font.<br><br>Not internationalization, I know, but I find it rude offering the user a way to set something, then ignoring it completely. Plus, is not about setting fancy fonts, is also about accessibility (if I set a bigger font size).<br><br>Maybe a logical font is the answer?<br>And maybe having that as default font in the dialogs created by Visual Studio?<br></div>
<p><a id="555173" href="#555173">#</a> <strong>Michael S. Kaplan</strong> on 19 Mar 2006 6:22 PM:</p><div style="margin-left: 1em">Hi Mihai,<br><br>I do not know of many cases that this setting is not respected, so I am not sure where precisely the bug is here. But virtual fonts have nothing to do with this (an app can ignore a virtual font as readily as an actual one), so this may be a better one for the suggestion box....</div>
<p><a id="555193" href="#555193">#</a> <strong>Michael S. Kaplan</strong> on 19 Mar 2006 7:06 PM:</p><div style="margin-left: 1em">Hi Mike --<br><br>I am not sure I fully understand what you mean here -- the docs are not too terribly specific about what happens between versions just yet, so I'm not sure that any part of using these font names is future proofing anything....</div>
<p><a id="555228" href="#555228">#</a> <strong>PatriotB</strong> on 19 Mar 2006 8:47 PM:</p><div style="margin-left: 1em">Mike -- MS Shell Dlg/2 *won't* map to Segoe UI.<br><br>I remember asking about this a while back on the MSDN Forums; here's an excerprt from the reply from Microsoft's Jeff Pettiross:<br><br>&quot;Regarding MS Shell Dlg, it was a good idea at the time, but it's also time to retire it. When it was introduced (and followed with MS Shell Dlg 2, and further tricks to support that), we had three font faces with very similar metrics (character sizes and shapes) at 8 points: MS Sans Serif, &nbsp;Microsoft Sans Serif, and Tahoma. Allowing a meta-name like MS Shell Dlg meant that someone could release an application that would look as good as possible on multiple versions of Windows. This solution works as long as you don't change the font's metrics. There are only so many ways you can make a new font by rearranging pixels in the same size rectangles, and we wanted to break out of those rectangles with Segoe UI.<br><br>If we tried to extend to MS Shell Dlg 3 (or whatever), long-standing dialog templates would have broken because Segoe UI has different metrics than the other three fonts. So, we will make Segoe UI available for redistribution with applications and applications can look the same regardless of Windows version. (It's slighly different from MS Shell Dlg, where dialogs would have the same layout, but different font faces across versions.)&quot;<br><br>[<a rel="nofollow" target="_new" href="http://forums.microsoft.com/MSDN/ShowPost.aspx?PostID=205554&amp;SiteID=1">http://forums.microsoft.com/MSDN/ShowPost.aspx?PostID=205554&amp;SiteID=1</a>]<br><br>An additional complicating factor is that the Vista guidelines say to use Segoe UI at *9* point font rather than 8.<br><br>Of course, what the official MSDN docs (and this blog posting) seem to say, is that MS Shell Dlg's purpose was just to support internationalization, and that it wasn't meant to be a way to have dialog boxes take on their OS's preferred font--though that was a side effect.</div>
<p><a id="555232" href="#555232">#</a> <strong>Michael S. Kaplan</strong> on 19 Mar 2006 8:57 PM:</p><div style="margin-left: 1em">FWIW, the final figuring out of licensing and other considerations has NOT been figured out, so most of what Jeff said is at best one possibility; the final plan has not been figured out yet.<br><br>I had not really moved into the world of hypothesizing about MS Shell Dlg ##, as there are significant issues in that approach, only some of which Jeff mentions....</div>
<p><a id="555659" href="#555659">#</a> <strong>Mihai</strong> on 20 Mar 2006 12:49 PM:</p><div style="margin-left: 1em">&lt;&lt;I do not know of many cases that this setting is not respected, so I am not sure where precisely the bug is here.&gt;&gt;<br><br>Do you know of any case that this setting IS respected?<br><a rel="nofollow" target="_new" href="http://www.mihai-nita.net/mix/Fonts.gif">http://www.mihai-nita.net/mix/Fonts.gif</a><br>Oups, yes, &nbsp;Firefox :-)<br></div>
<p><a id="555676" href="#555676">#</a> <strong>Michael S. Kaplan</strong> on 20 Mar 2006 1:07 PM:</p><div style="margin-left: 1em">Like I said, Mihai -- I would suggest putting more actual details in and getting it in the suggestion box.</div>
<p><a id="5964977" href="#5964977">#</a> <strong>Patrick</strong> on 7 Nov 2007 12:28 PM:</p><div style="margin-left: 1em"><p>Hi Mike, </p>
<p>You say that, </p>
<p>&quot;On Windows NT 4.0/2000/XP/Server 2003/Vista, both map to Unicode-based TrueType fonts. MS Shell Dlg uses Microsoft Sans Serif (which is distinct from MS Sans Serif) for Latin, Greek, Cyrillic, Arabic, Hebrew, and Thai characters; MS UI Gothic for Japanese; Gulim for Korean; Simsun for Simplified Chinese; PMinglu for Traditional Chinese; etc.&quot;</p>
<p>Yet when I look at the &nbsp;</p>
<p>key HKEY_LOCAL_MACHINE\Software\Microsoft\Windows NT\Current Version\FontSubstitutes on a Chinese XP SP2 or Win 2003 R2 SP1, I see that for Chinese these reference MS San Serif and Tahoma not Simsun or PMinglu.</p>
<p>Am I missing something? </p>
<p>Thanks, </p>
<p>Patrick.</p></div>
<p><strong>Roman</strong> on 2 Aug 2009 12:43 PM:</p><div style="margin-left: 1em"><p>This is a bit old but...</p>
<p>Michael, you said:</p>
<p>&gt;I do not know of many cases that this setting [&quot;Advanced Appearance&quot;] is not respected</p>
<p>But you are explicitly recommending something that completely ignores this setting: &quot;[...] simply use either Microsoft Sans Serif or Tahoma explicitly&quot;.</p>
<p>Seems like it isn't exactly easy to always do this propertly due to the amount of history, but for .NET apps at least one can use SystemFonts.MessageBoxFont (NOT DefaultFont) to respect this setting.</p></div>
<p><strong>Michael S. Kaplan</strong> on 3 Aug 2009 2:23 AM:</p><div style="margin-left: 1em"><p>The MessageBox font is a user changeable one, which can mean a very negative impact on UI if the user changes an unrelated setting -- not a good experience for an application to provide!</p>
</div>
<hr/><p><em>referenced by</em></p><div style="margin-left: 1em"><p>2007/10/16 <a href="http://archives.miloush.net/michkap/archive/2007/10/16/5467548.html">MS Shell Dlg is __________?</a></p><p>2007/06/09 <a href="http://archives.miloush.net/michkap/archive/2007/06/09/3174676.html">Guilt by [font ]association (aka The consequences of picking the wrong font #3)</a></p><p>2006/06/11 <a href="http://archives.miloush.net/michkap/archive/2006/06/11/626100.html">Why the Windows Shell can't provide the ultimate font solution for everyone (or even anyone!)</a></p><p>2006/06/06 <a href="http://archives.miloush.net/michkap/archive/2006/06/06/618628.html">Is this the Ãœber-font post? No, but it is the teaser for it!</a></p><p>2006/05/05 <a href="http://archives.miloush.net/michkap/archive/2006/05/05/590504.html">UI language of the LocalSystem account (which almost never shows UI)</a></p></div><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2006/03/18/554517.html" title="Just in case you thought I was blathering. :-)">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2006/03/18/554301.html" title="Typing those marks?">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2006-03">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2006-03-18">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2006/03/18/554308.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:40 GMT -->
</html>