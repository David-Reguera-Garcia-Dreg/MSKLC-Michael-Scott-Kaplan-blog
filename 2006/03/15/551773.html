<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2006/03/15/551773.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:40 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>Casing and IgnoreCase are still not the same thing....</title></head><body>
<h1>Casing and IgnoreCase are still not the same thing....</h1>
<p><em>by Michael S. Kaplan, published on 2006/03/15 03:50 -05:00, original URI: http://blogs.msdn.com/b/michkap/archive/2006/03/15/551773.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostNew -->
<P><FONT face=Tahoma>Rob commented in the Suggestion Box:</FONT></P>
<BLOCKQUOTE dir=ltr style="MARGIN-RIGHT: 0px">
<P><FONT face="Times New Roman" size=2>It might be worthwhile to address this article: <BR><BR></FONT><A href="http://www.codeproject.com/buglist/comparenocase.asp" target=_new rel=nofollow><FONT size=2>http://www.codeproject.com/buglist/comparenocase.asp</FONT></A><FONT size=2> <BR><BR>The author doesn't quite "get it" in that he thinks that you could, say, uppercase a string without caring about the locale (sharp S? dotted I?) but he does seem to have found some confusing documentation. </FONT></P></BLOCKQUOTE>
<P><FONT face=Tahoma>As Rob pointed out, there are a few problems here, mainly in perception. Add to that a few bugs, mainly in documentation, to help add to the confusion....</FONT></P>
<P><FONT face=Tahoma>To start with, as I have pointed out previously, <A HREF="http://archives.miloush.net/michkap/archive/2006/01/11/511557.html"><STRONG>Collation != Case</STRONG></A>. And more importantly in this case, ignoring case in a linguistic comparison is not exactly&nbsp;</FONT><FONT face=Tahoma>the same as either uppercasing a string to make a binary comparison or lowercasing it.</FONT></P>
<P><FONT face=Tahoma>Perhaps the best way to look at it is to realize that ignoring case is not guaranteed to be the same as trying to force the case to be identical....</FONT></P>
<P><FONT face=Tahoma><EM>(As you can see in a </EM><A HREF="http://archives.miloush.net/michkap/archive/2006/01/11/511557.html#511902"><EM>comment</EM></A><EM> to that article by </EM><A HREF="http://blogs.msdn.com/abhinaba/"><EM>Abhinaba</EM></A><EM>, there is&nbsp;confusion on this issue and the relation to the file system over on the SQL Server team as well, sometimes.)</EM></FONT></P>
<P><FONT face=Tahoma>Then, as I pointed out last May in <A HREF="http://archives.miloush.net/michkap/archive/2005/05/08/415522.html">this article</A>, there are some locale specific behaviors in some collation operations that claim to be independent of such matters. Though it really is easy enough to look at this as the docs thinking about locale sensitivity in the collation, not the casing. Perhaps it should more explicitly point out what is happening here (I am sure it is too late to change the behavior, though I am loathe to suggest that yet another comparison method be added to the CRT to capture the OS comparison behavior)....</FONT></P>
<P><FONT face=Tahoma>Now admittedly the various CString methods that Geert Delmeiren pointed out like <A href="http://msdn.microsoft.com/library/en-us/vcmfc98/html/vcrefcstringcollatenocase.asp">CString::CollateNoCase</A> and <A href="http://msdn.microsoft.com/library/en-us/vcmfc98/html/_mfc_cstring.3a3a.comparenocase.asp">CString::CompareNoCase</A> don't make it any easier to try discern what is happening. With such interesting text as:</FONT></P>
<BLOCKQUOTE dir=ltr style="MARGIN-RIGHT: 0px">
<P><FONT face="Times New Roman" size=2>The generic-text function _tcscoll, which is defined in TCHAR.H, maps to either stricoll, wcsicoll, or _mbsicoll depending on the character set that is defined at compile time. Each of these functions performs a case-insensitive comparison of the strings, according to the code page currently in use.</FONT></P></BLOCKQUOTE>
<P><FONT face=Tahoma>for CollateNoCase and </FONT></P>
<BLOCKQUOTE dir=ltr style="MARGIN-RIGHT: 0px">
<P><FONT face="Times New Roman" size=2>Compares this CString object with another string using the generic-text function _tcsicmp. The generic-text function _tcsicmp, which is defined in TCHAR.H, maps to either _stricmp, _wcsicmp, _mbsicmp depending on the character set that is defined at compile time. Each of these functions performs a case-insensitive comparison of the strings, and is not affected by locale. </FONT></P></BLOCKQUOTE>
<P><FONT face=Tahoma>for CompareNoCase, it is easy to see why anyone could get confused if they do not selectuvely ignore the docs and read blog entries here. :-)</FONT></P>
<P><FONT face=Tahoma>However, I would not suggest using Geert's suggested MyCompareNoCase function as a solution generically since the exact soluion depends on the context and anyattempt at a "one size fits all" solution is bound to fail....</FONT></P>
<P><FONT face=Tahoma></FONT>&nbsp;</P>
<P><FONT face=Tahoma color=#ff1493><EM>This post brought to you by</EM> "Ã©" <EM>(<A href="http://www.fileformat.info/info/unicode/char/00e9">U+00e9</A>, a.k.a. LATIN SMALL LETTER E WITH ACUTE)</EM></FONT></P>
<hr/><p><a id="551805" href="#551805">#</a> <strong>Gabe</strong> on 15 Mar 2006 5:27 AM:</p><div style="margin-left: 1em">I can understand how it's possible to get unexpected matches with CompareNoCase. For example, I would expect the word &quot;r&#232;sum&#233;&quot; to uppercase with accents but compare as equal to &quot;resume&quot; because in my locale (us-en) accents don't matter.<br><br>What I don't understand is why CompareNoCase finds two strings different even though they roundtrip properly between cases? The only thing I can conclude is that CompareNoCase is using a different canonicalization function than strupr.</div>
<p><a id="551874" href="#551874">#</a> <strong>Michael S. Kaplan</strong> on 15 Mar 2006 9:28 AM:</p><div style="margin-left: 1em">Well I believe source is available for CString for those who doubt? :-)</div>
<p><a id="552323" href="#552323">#</a> <strong>Dean Harding</strong> on 15 Mar 2006 6:12 PM:</p><div style="margin-left: 1em">You got the documentation around the wrong way: CompareNoCase uses xxxicmp and CollateNoCase uses xxxicoll :-)<br><br>I was looking through the source, and if you use the C locale, then _wcsicmp uses an internal function __ascii_towlower, which is #define'd as:<br><br>#define __ascii_towlower(c) &nbsp; &nbsp; ( (((c) &gt;= L'A') &amp;&amp; ((c) &lt;= L'Z')) ? ((c) - L'A' + L'a') : (c) )<br><br>So that's obviously why it didn't work for him in the first place. If you change the locale (with setlocale, like he did towards the end) then instead of this #define, it ends up calling LCMapString to do the lowercasing.<br><br>On the other hand, I believe _wcsicoll uses CompareString. But it depends on how the LC_CTYPE and LC_COLLATE settings are set by default.<br><br>It's all very confusing!! I'd much prefer to just use CompareString/LCMapString directly. At least then you're being explicit about how you want the comparison/casing to work. I'd say you should only use the CRT functions if you want to port to other operating systems.</div>
<p><a id="552343" href="#552343">#</a> <strong>Michael S. Kaplan</strong> on 15 Mar 2006 6:50 PM:</p><div style="margin-left: 1em">Hi Dean, <BR><BR>Actually, I got the documentation right -- note that the one it points to comes right after the quote in both cases. :-) <BR><BR>I agree that the CRT stuff is way too confusing here....</div>
<p><a id="552372" href="#552372">#</a> <strong>Dean Harding</strong> on 15 Mar 2006 8:01 PM:</p><div style="margin-left: 1em">Oh sorry, you're right heh :-) I saw the link CString::CompareNoCase right above the text for the collate one and got mixed up...</div>
<hr/><p><em>referenced by</em></p><div style="margin-left: 1em"><p>2007/10/25 <a href="http://archives.miloush.net/michkap/archive/2007/10/25/5664770.html">Jokes that aren't really all that funny in the end (aka At least SQL Server isn't on our case)</a></p><p>2006/08/08 <a href="http://archives.miloush.net/michkap/archive/2006/08/08/692390.html">Collation != case, still</a></p></div><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2006/03/15/552031.html" title="Multilingual keyboards and Microsoft Word">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2006/03/14/551112.html" title="Wait til you see my &#39;O&#39; [pattern]">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2006-03">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2006-03-15">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2006/03/15/551773.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:40 GMT -->
</html>