<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2006/01/14/512530.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:40 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>Brother, can you spare a time[zone]?</title></head><body>
<h1>Brother, can you spare a time[zone]?</h1>
<p><em>by Michael S. Kaplan, published on 2006/01/14 03:01 -05:00, original URI: http://blogs.msdn.com/b/michkap/archive/2006/01/14/512530.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostNew -->
<P><FONT face=Tahoma>Ishan Bhalla asked in the microsoft.public.dotnet.internationalization newsgroup:</FONT></P>
<BLOCKQUOTE dir=ltr style="MARGIN-RIGHT: 0px">
<BLOCKQUOTE dir=ltr style="MARGIN-RIGHT: 0px">
<P><EM><FONT size=2>Hello everyone,</FONT></EM></P>
<P><EM><FONT size=2>Is there any framework or API function i can use to get the date and time of&nbsp; any city in the world?</FONT></EM></P>
<P><EM><FONT size=2>Basically our server is based in Sydney and we need to know time in Perth&nbsp;when any scanning information comes from there. The server time is always Sydney time. </FONT></EM></P>
<P><EM><FONT size=2>Thanks in advance<BR>Ishan</FONT></EM></P></BLOCKQUOTE></BLOCKQUOTE>
<P><FONT face=Tahoma>Well, there are two functions that can be used to actually convert between Universal Coordinated Time (UTC) and the local time in a specific time zone, and they can be useful in situations where you cannot do this work on the client side where the user's settings can be the best guide for conversion.</FONT></P>
<P><FONT face=Tahoma>They are <A href="http://msdn.microsoft.com/library/en-us/sysinfo/base/systemtimetotzspecificlocaltime.asp">SystemTimeToTzSpecificLocalTime</A> and <A href="http://msdn.microsoft.com/library/en-us/sysinfo/base/tzspecificlocaltimetosystemtime.asp">TzSpecificLocalTimeToSystemTime</A>, each of which takes a pointer to a specific&nbsp;<A href="http://msdn.microsoft.com/library/en-us/sysinfo/base/time_zone_information_str.asp">TIME_ZONE_INFORMATION structure</A> to use for conversion (the first function has been around since Windows NT 3.5, while the second only since Windows XP).</FONT></P>
<P><FONT face=Tahoma>Of course this only leads to more questions, since there is no function that retrieves a list of <A href="http://msdn.microsoft.com/library/en-us/sysinfo/base/time_zone_information_str.asp">TIME_ZONE_INFORMATION</A> structures to use (the only functions that support the structure are <A href="http://msdn.microsoft.com/library/en-us/sysinfo/base/gettimezoneinformation.asp">GetTimeZoneInformation</A> and <A href="http://msdn.microsoft.com/library/en-us/sysinfo/base/settimezoneinformation.asp">SetTimeZoneInformation</A> and they deal with retrieving and setting the current time zone setting on a machine). You are left with either using undocumented registry keys or storing the time zone to use as it is reported&nbsp;by the client (note that the latter solution is a better one anyway since if the goal is towork with the client's settings then it is the only way to guarantee that you are in fact using the client's settings!).</FONT></P>
<P><FONT face=Tahoma>And then of course there are all the issues about <a href="http://blogs.msdn.com/oldnewthing/55413.aspx">why Daylight Savings Time is not intuitive</A> that Raymond Chen posted years ago in his blog (and internally long before that!).</FONT></P>
<P><FONT face=Tahoma>Don't even get me started on the intense interest that&nbsp;some people have on adding time zone support to the .NET Framework that really has to be carefully planned out to make sure that it solves problems rather than causes them (or at least that it solves more problems than it causes!). I will talk more about this when there is more to talk about. :-)</FONT></P>
<P><FONT face=Tahoma>There is some earlier mention I made of the <a href="http://archives.miloush.net/michkap/archive/2004/12/20/328040.html">Date and Time FAQ</A> that helps explain a lot about the situation in the .NET Framework today -- a document that is very helpful for the managed side of this equation.</FONT></P>
<P><FONT face=Tahoma>And I do owe people a fuller conversation on time zone support on Windows in general, which is coming....</FONT></P>
<P><FONT face=Tahoma></FONT>&nbsp;</P>
<P><FONT face=Tahoma color=#ff1493><EM>This post brought to you by</EM> "<FONT size=6>à·ž</FONT>" <EM>(<A href="http://www.fileformat.info/info/unicode/char/0dde">U+0dde</A>, a.k.a. SINHALA VOWEL SIGN KOMBUVA HAA GAYANUKITTA)</EM></FONT></P>
<hr/><p><a id="512839" href="#512839">#</a> <strong>gabr</strong> on 14 Jan 2006 4:08 AM:</p><div style="margin-left: 1em">An old article on time zones: <a rel="nofollow" target="_new" href="http://www.thedelphimagazine.com/samples/1175/1175.htm">http://www.thedelphimagazine.com/samples/1175/1175.htm</a><br><br>(in Delphi, but underlaying APIs and registry entries are same for all languages anyway)<br></div>
<p><a id="512910" href="#512910">#</a> <strong>Michael S. Kaplan</strong> on 14 Jan 2006 1:12 PM:</p><div style="margin-left: 1em">Yes, I remember that one. Quite a nice article (the author and I share a cynical outlook!). The only real flaw is that it is so purely Delphi focused, which for some makes the code samples harder to follow.</div>
<p><a id="512937" href="#512937">#</a> <strong>gabr</strong> on 14 Jan 2006 3:40 PM:</p><div style="margin-left: 1em">Well, I never did much work in C[++|#]. Pascal was my primary language and I do most of my programming in Delphi so ...</div>
<p><a id="512949" href="#512949">#</a> <strong>Michael S. Kaplan</strong> on 14 Jan 2006 4:38 PM:</p><div style="margin-left: 1em">I know, I know. And I can follow it, it just makes it easy for people to dismiss it even though it is a really good piece.</div>
<p><a id="513985" href="#513985">#</a> <strong>Maurits [MSFT]</strong> on 17 Jan 2006 5:01 PM:</p><div style="margin-left: 1em">The cheap solution is to store all dates in UTC+offset form<br><br>For example right now in my time zone it's:<br><br>Tue, 17 Jan 2006 14:01:35 -0800</div>
<hr/><p><em>referenced by</em></p><div style="margin-left: 1em"><p>2008/06/29 <a href="http://archives.miloush.net/michkap/archive/2008/06/29/8667900.html">Did someone break GetTimeZoneInformation in XP?</a></p><p>2006/05/24 <a href="http://archives.miloush.net/michkap/archive/2006/05/24/605569.html">Did somebody say time zones were intuitive?</a></p></div><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2006/01/14/512985.html" title="Getting out of the compatibility zone, redux">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2006/01/13/512408.html" title="Some date conversions are evil in other ways">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2006-01">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2006-01-14">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2006/01/14/512530.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:40 GMT -->
</html>