<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2006/01/19/514656.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:40 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>Just when you think you know a function...</title></head><body>
<h1>Just when you think you know a function...</h1>
<p><em>by Michael S. Kaplan, published on 2006/01/19 03:01 -05:00, original URI: http://blogs.msdn.com/b/michkap/archive/2006/01/19/514656.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostNew -->
<P><FONT face=Tahoma>Since the earliest days of Win32, there has been the <A href="http://msdn.microsoft.com/library/en-us/winui/winui/windowsuserinterface/windowing/dialogboxes/dialogboxreference/dialogboxfunctions/messagebox.asp">MessageBox</A> function.</FONT></P>
<P><FONT face=Tahoma>And one would think after having so many years to play with it, I would have figured everything out about it.</FONT></P>
<P><FONT face=Tahoma>But I did learn something new today about it.</FONT></P>
<P><FONT face=Tahoma>There is a particular flag you can pass to it to (MB_RTLREADING) which according to the docs "Displays message and caption text using right-to-left reading order on Hebrew and Arabic systems."</FONT></P>
<P><FONT face=Tahoma><EM>(I already knew that line in the docs was wrong since it works fine on my XP English system, too --&nbsp;so that's not what I learned today!)</EM></FONT></P>
<P><FONT face=Tahoma>Beyond the slightly out of date documentation issue, this flag has a serious limitation.</FONT></P>
<P><FONT face=Tahoma>And that is that the developer is the one who writes the code but in many cases she is simply loading a string from a resource that a localizer is providing and thus&nbsp;the developer&nbsp;is hardly in the right position to decide whether the flag is needed, now is she? It is the localizer who needs to be able to indicate that the reading order should be right-to-left, and he should be able to do it. That is how he can make sure the dialog is mirrored properly if it needs to be in a localization into&nbsp;language that needs mirroring.</FONT></P>
<P><FONT face=Tahoma>Grrrr.</FONT></P>
<P><FONT face=Tahoma>Well, wait. It turns out he does!</FONT></P>
<P><FONT face=Tahoma>If you add two <A href="http://www.fileformat.info/info/unicode/char/200f">U+200f</A> (RIGHT-TO-LEFT MARKER) code points in the front of your lpText string, then it will have the same effect as if the developer had added the flag. And there is no double-negative issue that comes up if you put in the characters <EM>and</EM> add the flag, either. It is simply a cool trick that lots of localizers know about (I checked around between the time that Yaniv told me about it and I wrote this!).</FONT></P>
<P><FONT face=Tahoma>Now given how <A href="http://www.fileformat.info/info/unicode/char/200f">U+200f</A>&nbsp;works, there is never any specific reason to have two of them (it is not like the embedding flags that have state or anything -- it is just telling a rendering engine what to do with the text that follow it, logically), so as hacks go, I give it a 9 on th safety scale and at least an 8 on the coolness scale.</FONT></P>
<P><FONT face=Tahoma>If you have already heard about it then you can shake your head and smile about all this, and if you have not but can seriously use this information then have fun!</FONT></P>
<P><FONT face=Tahoma>Here is a nice little test application you can use to play with this. In C:</FONT></P>
<BLOCKQUOTE dir=ltr style="MARGIN-RIGHT: 0px">
<BLOCKQUOTE dir=ltr style="MARGIN-RIGHT: 0px">
<P><FONT face="Courier New" size=2><STRONG>#define _UNICODE<BR>#define UNICODE<BR>#include &lt;windows.h&gt;</STRONG></FONT></P>
<P><FONT face="Courier New" size=2><STRONG>void main() <BR>{<BR>&nbsp;&nbsp;&nbsp; if (IDYES == MessageBox( NULL, <BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; L"Would you like to see a mirroring test with the documented flag?", <BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; L"Question",<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MB_YESNO | MB_ICONQUESTION))<BR>&nbsp;&nbsp;&nbsp; {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MessageBox( NULL, <BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; L"Mirrored by using the documented MB_RTLREADING flag", <BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; L"The Test",<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MB_OK | MB_ICONINFORMATION | MB_RTLREADING);<BR>&nbsp;&nbsp;&nbsp; }<BR>&nbsp;&nbsp;&nbsp; else <BR>&nbsp;&nbsp;&nbsp; {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MessageBox( NULL, <BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; L"\x200f\x200fMirrored by shoving two RLM markers in the front of the string", <BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; L"The Test",<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MB_OK | MB_ICONINFORMATION);<BR>&nbsp;&nbsp;&nbsp; }<BR>}</STRONG></FONT></P></BLOCKQUOTE></BLOCKQUOTE>
<P><FONT face=Tahoma>And also in C# (using the <A href="http://msdn.microsoft.com/library/en-us/cpref/html/frlrfSystemWindowsFormsMessageBoxClassTopic.asp">MessageBox class</A>):</FONT></P>
<BLOCKQUOTE dir=ltr style="MARGIN-RIGHT: 0px">
<BLOCKQUOTE dir=ltr style="MARGIN-RIGHT: 0px">
<P><FONT face="Courier New" size=2><STRONG>using System;<BR>using System.Windows.Forms;</STRONG></FONT></P>
<P><FONT face="Courier New" size=2><STRONG>namespace MsgBoxTest<BR>{<BR>&nbsp; class MsgBox<BR>&nbsp; {<BR>&nbsp;&nbsp;&nbsp; [STAThread]<BR>&nbsp;&nbsp;&nbsp; static void Main(string[] args)<BR>&nbsp;&nbsp;&nbsp; {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (DialogResult.Yes == MessageBox.Show(<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; "Would you like to see a mirroring test with the documented flag?",&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"Question",<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MessageBoxButtons.YesNo,<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MessageBoxIcon.Question,<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MessageBoxDefaultButton.Button1))<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MessageBox.Show(<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; "Mirrored by using the documented MB_RTLREADING flag",&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"The Test",<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MessageBoxButtons.OK,<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MessageBoxIcon.Information,<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MessageBoxDefaultButton.Button1,<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MessageBoxOptions.RtlReading);<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; else <BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MessageBox.Show(<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; "\x200f\x200fMirrored by shoving two RLM markers in the front of the string",&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"The Test",<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MessageBoxButtons.OK,<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MessageBoxIcon.Information,<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MessageBoxDefaultButton.Button1);<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<BR>&nbsp;&nbsp;&nbsp; }<BR>&nbsp; }<BR>}</STRONG></FONT></P></BLOCKQUOTE></BLOCKQUOTE>
<P><FONT face=Tahoma>Everyone I talked to swore it was common knowledge, </FONT><FONT face=Tahoma>and that they thought it was even documented in MSDN or on the web (but I could not find it, and my search results ran into other problems that I will probably blog about another time).</FONT></P>
<P><FONT face=Tahoma>Here is what the two message boxes in the above applications look like:</FONT></P>
<P><FONT face=Tahoma><IMG src="http://trigeminal.fmsinc.com/images/msgbox01.jpg">&nbsp;&nbsp;&nbsp;&nbsp; <IMG src="http://trigeminal.fmsinc.com/images/msgbox02.jpg"></FONT></P>
<P><FONT face=Tahoma>Enjoy!</FONT></P>
<P><FONT face=Tahoma></FONT>&nbsp;</P>
<P><FONT face=Tahoma color=#ff1493><EM>This post brought to you by </EM><EM><A href="http://www.fileformat.info/info/unicode/char/200f">U+200f</A>, RIGHT-TO-LEFT MARKER</EM></FONT></P>
<hr/><p><a id="514797" href="#514797">#</a> <strong>Michael S. Kaplan</strong> on 19 Jan 2006 7:47 AM:</p><div style="margin-left: 1em">Of course if you knew about this convention already then feel free to point out how out of the loop I was on this one. :-)</div>
<p><a id="514944" href="#514944">#</a> <strong>Mihai</strong> on 19 Jan 2006 1:31 PM:</p><div style="margin-left: 1em">Main question: is it safe to add 2 RLMs in front of every single string, no matter if it ends up in menus, dialogs, status bar, etc.?<br>Because otherwise this meand localization has to hunt down only the strings that are used for MessageBox. Not really a solution.<br>I still think a wrapper is a safe enough solution.<br><br>I cannot say this is really &quot;common knowledge&quot;. I was unable to find it documented anywhere. The only thing related is adding 2 RLM in the FileDescription of the version info, which causes the full application to be mirrored. This is documented in &quot;Developing International Software, 2nd Ed.&quot;<br></div>
<p><a id="514962" href="#514962">#</a> <strong>Michael S. Kaplan</strong> on 19 Jan 2006 1:59 PM:</p><div style="margin-left: 1em">It is actually entirely safe -- they are basically two invisible letters with directionality (I talk about it in the other post!).</div>
<p><a id="515542" href="#515542">#</a> <strong>Michael Dunn_</strong> on 20 Jan 2006 5:16 PM:</p><div style="margin-left: 1em">That line from the docs is a bit confusing  for me - if you're running an Arabic/Hebrew language OS, isn't all the text RTL anyway? It seems like you would only need an RTL or LTR flag if you needed to display text that ran in the opposite direction of the OS's language.<br> <br>Something else of note is the light source gets reversed too, so it's coming from the top-right of the screen.</div>
<p><a id="515552" href="#515552">#</a> <strong>Michael S. Kaplan</strong> on 20 Jan 2006 5:33 PM:</p><div style="margin-left: 1em">Hi Mike!<br><br>Usually, but for mirroring the extra work has to happen so that there is an indication that even though the dev laid out the dialog in on direction that it should be flipped to be in the other direction....</div>
<hr/><p><em>referenced by</em></p><div style="margin-left: 1em"><p>2009/04/09 <a href="http://archives.miloush.net/michkap/archive/2009/04/09/9539475.html">Two wrongs don't make a right, but two lefts can take a good whack at it</a></p><p>2006/05/28 <a href="http://archives.miloush.net/michkap/archive/2006/05/28/609369.html">Mirror, mirror... before whom I fuss, does mirroring work well in GDI+?</a></p><p>2006/02/08 <a href="http://archives.miloush.net/michkap/archive/2006/02/08/527375.html">They make 'em smarter than GetDateFormat</a></p><p>2006/02/01 <a href="http://archives.miloush.net/michkap/archive/2006/02/01/522164.html">On [not] localizing a MessageBox from code</a></p><p>2006/01/21 <a href="http://archives.miloush.net/michkap/archive/2006/01/21/515793.html">Return of the Mark</a></p><p>2006/01/19 <a href="http://archives.miloush.net/michkap/archive/2006/01/19/514718.html">What are directional marks -- chumps who point?</a></p></div><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2006/01/19/514718.html" title="What are directional marks -- chumps who point?">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2006/01/18/514314.html" title="What do U+0223 and U+0657 have in common?">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2006-01">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2006-01-19">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2006/01/19/514656.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:40 GMT -->
</html>