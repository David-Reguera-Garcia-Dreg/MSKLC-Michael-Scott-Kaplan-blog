<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2006/01/30/519760.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:40 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>Ā was unexpected at this time.</title></head><body>
<h1>Ā was unexpected at this time.</h1>
<p><em>by Michael S. Kaplan, published on 2006/01/30 17:01 -05:00, original URI: http://blogs.msdn.com/b/michkap/archive/2006/01/30/519760.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostNew -->
<p><font face=Tahoma><em>(Special thanks to Dave Poole for pointing this one out!)</em></font></p>
<p><font face=Tahoma>It was not too long ago that I got mail from Dave about a strange error he was getting in some automated tests of various SQL Server command line tools. An error that occurred with a command line including LATIN CAPITAL LETTER A WITH MACRON (Ā).</font></p>
<p><font face=Tahoma>I am used to getting random mails of a particular class from people&nbsp;(such as Unicode characters not working in the console), so I started him down the troubleshooting road with chcp and default system locale and so on.</font></p>
<p><font face=Tahoma>But he persevered and when he proved that he&nbsp;was entering things correctly&nbsp;and I looked at the problem, I&nbsp;saw&nbsp;that&nbsp;he was right. Typing an 'Ā' always had this particular problem:</font></p>
<p><img src="http://trigeminal.fmsinc.com/images/cmd01.jpg"></img></p>
<p><font face=Tahoma>while typing anything else did not:</font></p>
<p><font face=Tahoma><img src="http://trigeminal.fmsinc.com/images/cmd02.jpg"></img></font></p>
<p><font face=Tahoma>Since Dave is on the SQL Server team and I am on Windows, I figured I should go find out owns CMD.EXE.</font></p>
<p><font face=Tahoma>It turns out that is none other than Mark Zbikowski, Architect and man <a href="http://blogs.msdn.com/oldnewthing/archive/2006/01/30/519388.aspx">whose initials appear in every binary that is not one of those .COM files</a>. </font></p>
<p><font face=Tahoma>B<font face=Tahoma>y&nbsp;many accounts, he is&nbsp;the third most "senior" employee working at Microsoft today. </font></font></p>
<p><font face=Tahoma><font face=Tahoma>Even though I had actually conversed with him before (about those casing table and NTFS issues!), I did not want to waste his time or take advantage of the fact that he is by all reports and in my personal experience a really nice guy.</font></font></p>
<p><font face=Tahoma>So&nbsp;there was&nbsp;a brief delay while I tried to look into the bug a bit before sending mail to someone who had been here&nbsp;approximately&nbsp;ten times longer&nbsp;than me. :-)</font></p>
<p><font face=Tahoma>I found&nbsp;a constant with the value 0x0100 in the code but could not really tell how the lexer and parser work enough to see a problem with an&nbsp;overlap between them. So I finally sent Mark some mail and asked him.</font></p>
<p><font face=Tahoma>As it turns out, Mark and I have at least </font><font face=Tahoma>one thing in common -- he is also used to getting random mails of a particular class from people&nbsp;(such as specific characters not working in the console). So he started me down the road of troubleshooting when text is munged before it ever gets to CMD's parser.</font></p>
<p><font face=Tahoma>But&nbsp;I persevered and when I proved that&nbsp;I&nbsp;was entering things correctly&nbsp;and&nbsp;he looked at the problem, he saw that I was right. Typing an 'Ā' always had this particular problem.</font></p>
<p><font face=Tahoma><em>(to Mark's credit he realized all of this much more quickly than I did, but then he is much smarter than I am and has been here almost ten times longer than me so I think that would be expected!)</em></font></p>
<p><font face=Tahoma>This is not a regression, and has been around even longer than Unicode support in the console has been (perhaps even as far back as the OS/2 days)&nbsp;-- back when 0x0100 would have been a very sensible mark that could be used to indicate something that is not a character (since no characters were above 0xFF!).</font></p>
<p><font face=Tahoma><em>Good proof that there is always a small but measureable&nbsp;difference to be had between a nearly total rewrite and an actual rewrite. A difference that testers could make their living on if they needed to!</em></font></p>
<p><font face=Tahoma>But in any case it was a rather cool bug, if you ask me. I have no idea why it has never been reported before, but it is reported now!</font></p>
<p><font face=Tahoma></font>&nbsp;</p>
<p><font face=Tahoma color=#ff1493><em>This post brought to you by</em> "Ā" <em>(<a href="http://www.fileformat.info/info/unicode/char/0100">U+0100</a>, a.k.a. LATIN CAPITAL LETTER A WITH MACRON)</em></font></p>
<hr/><p><a id="520253" href="#520253">#</a> <strong>Gabe</strong> on 31 Jan 2006 2:14 AM:</p><div style="margin-left: 1em">So where was the bug? Was it in cmd.exe (the command prompt) or csrss.exe (the subsystem that includes the console)? Or elsewhere?<br/><br/>I should also add that I concur that Mark Z. is a nice guy. Back in 1995 my roommate (Paul) worked for him, but had no idea who he was. When Paul mentioned his boss' name, I simply had to meet him. Mark seemed impressed that I knew him as the guy who created the EXE format. At the time Mark was working on the never-to-be-released OFS, and readily answered all of my questions about the content indexing (which did ship).</div>
<p><a id="520258" href="#520258">#</a> <strong>Michael S. Kaplan</strong> on 31 Jan 2006 2:22 AM:</p><div style="margin-left: 1em">The bug was definitely in cmd.exe, not csrss....</div>
<p><a id="521209" href="#521209">#</a> <strong>Jerry Pisk</strong> on 31 Jan 2006 6:24 PM:</p><div style="margin-left: 1em">Isn't this just one case of the "magic" values and the problems associated with them? I'm just curious why was there a need to mix a command string with a value that was not a valid input at the time the code was written. Reminds you of all the mainframe programmers being lazy to express a missing year value and chosing the magic value of 99 to do that.</div>
<p><strong>Yuhong Bao</strong> on 6 Sep 2011 2:24 PM:</p><div style="margin-left: 1em"><p>I wonder why did it take more than 10 years to discover that ONE Unicode char was not working properly?</p>
</div>
<p><strong>Michael S. Kaplan</strong> on 6 Sep 2011 2:36 PM:</p><div style="margin-left: 1em"><p>I guess no one was using that letter.</p>
</div>
<hr/><p><em>referenced by</em></p><div style="margin-left: 1em"><p>2015/04/13 <a href="http://archives.miloush.net/michkap/archive/2015/04/13/8770668856267196376.html">Ā was unexpected at this time (MS-DOS Mobile edition)</a></p><p>2012/02/24 <a href="http://archives.miloush.net/michkap/archive/2012/02/24/10272498.html">The Truth was unexpected at this time</a></p><p>2011/07/18 <a href="http://archives.miloush.net/michkap/archive/2011/07/18/10187271.html">Pedantic nitpickery, turned up to 11</a></p><p>2010/10/07 <a href="http://archives.miloush.net/michkap/archive/2010/10/07/10072032.html">Myth busting in the console</a></p><p>2006/11/11 <a href="http://archives.miloush.net/michkap/archive/2006/11/11/1061686.html">Keeping out more of the undesirables</a></p></div><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2006/01/30/519993.html" title="One reason you should clean up warnings">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2006/01/30/519230.html" title="Are multilingual sorts integrated?">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2006-01">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2006-01-30">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2006/01/30/519760.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:40 GMT -->
</html>